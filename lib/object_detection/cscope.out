cscope 15 /media/2TB/Research/Code/tensorflow_models/models/object_detection               0001583503
	@__init__.py

	@anchor_generators/__init__.py

	@anchor_generators/grid_anchor_generator.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
G’”©es
 
grid
 
ªchÜs
 
Ú
 
the
 
æy
 
as
 
desüibed
 
	gš
:

20 
Shaoqšg
 
R’
, 
Kaimšg
 
	gHe
, 
Ross
 
	gGœshick
, 
ªd
 
JŸn
 
	gSun
.

23 
impÜt
 
‹nsÜæow
 
as
 
tf


25 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
ªchÜ_g’”©Ü


26 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


27 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
İs


30 
şass
 
	$GridAnchÜG’”©Ü
(
ªchÜ_g’”©Ü
.
AnchÜG’”©Ü
):

33 
def
 
	`__š™__
(
£lf
,

34 
sÿËs
=(0.5, 1.0, 2.0),

35 
a¥eù_¿tios
=(0.5, 1.0, 2.0),

36 
ba£_ªchÜ_size
=
NÚe
,

37 
ªchÜ_¡ride
=
NÚe
,

38 
ªchÜ_off£t
=
NÚe
):

41 
Args
:

42 
sÿËs
: 
a
 
li¡
 
	$of
 (è
sÿËs
, =(0.5, 1.0, 2.0)

43 
a¥eù_¿tios
: 
a
 
li¡
 
	$of
 (è
a¥eù
 
¿tios
, =(0.5, 1.0, 2.0)

44 
ba£_ªchÜ_size
: 
ba£
 
ªchÜ
 
size
 
as
 
height
, 
	`width
 (

45 (
Ëngth
-2 
æßt32
 
li¡
, =[256, 256])

46 
ªchÜ_¡ride
: 
difã»nû
 
š
 
ûÁ”s
 
b‘w“n
 
ba£
 
ªchÜs
 
adjaûÁ


47 
grid
 
	`pos™iÚs
 (
Ëngth
-2 
æßt32
 
li¡
, =[16, 16])

48 
ªchÜ_off£t
: 
ûÁ”
 
of
 
the
 
ªchÜ
 
w™h
 
sÿË
 
ªd
 
a¥eù
 
¿tio
 1 the

49 
uµ”
 
Ëá
 
–em’t
 
of
 
the
 
grid
, 
this
 
should
 
be
 
z”o
 

50 
ã©u»
 
ÃtwÜks
 
w™h
 
Úly
 
VALID
 
·ddšg
 
ªd
 
ev’
 
»û±ive


51 
f›ld
 
size
, 
but
 
may
 
Ãed
 
add™iÚ®
 
ÿlcuÏtiÚ
 
Ùh”


52 
·ddšg
 
is
 
	`u£d
 (
Ëngth
-2 
æßt32
 
‹nsÜ
, =[0, 0])

54 #HªdË 
¬gum’t
 
deçuÉs


55 
ba£_ªchÜ_size
 
is
 
NÚe
:

56 
ba£_ªchÜ_size
 = [256, 256]

57 
ba£_ªchÜ_size
 = 
tf
.
	$cÚ¡ªt
(
ba£_ªchÜ_size
, 
tf
.
æßt32
)

58 
ªchÜ_¡ride
 
is
 
NÚe
:

59 
ªchÜ_¡ride
 = [16, 16]

60 
ªchÜ_¡ride
 = 
tf
.
	$cÚ¡ªt
(
ªchÜ_¡ride
, 
dty³
=
tf
.
æßt32
)

61 
ªchÜ_off£t
 
is
 
NÚe
:

62 
ªchÜ_off£t
 = [0, 0]

63 
ªchÜ_off£t
 = 
tf
.
	$cÚ¡ªt
(
ªchÜ_off£t
, 
dty³
=
tf
.
æßt32
)

65 
£lf
.
_sÿËs
 = 
sÿËs


66 
£lf
.
_a¥eù_¿tios
 = 
a¥eù_¿tios


67 
£lf
.
_ba£_ªchÜ_size
 = 
ba£_ªchÜ_size


68 
£lf
.
_ªchÜ_¡ride
 = 
ªchÜ_¡ride


69 
£lf
.
_ªchÜ_off£t
 = 
ªchÜ_off£t


71 
def
 
	$Çme_scİe
(
£lf
):

74 
def
 
	$num_ªchÜs_³r_loÿtiÚ
(
£lf
):

77 
R‘uºs
:

78 
a
 
li¡
 
of
 
š‹g”s
, 
Úe
 
—ch
 
ex³ùed
 
ã©u»
 
m­
 
to
 
be
 
·s£d
o

79 
the
 `
g’”©e
` 
funùiÚ
.

81  [
	`Ën
(
£lf
.
_sÿËs
è*†’(£lf.
_a¥eù_¿tios
)]

83 
def
 
	$_g’”©e
(
£lf
, 
ã©u»_m­_sh­e_li¡
):

86 
Args
:

87 
ã©u»_m­_sh­e_li¡
: 
li¡
 
of
 
·œs
 oà
cÚvÃt
 
Ïy”
 
»sŞutiÚs
 
š
 
the


88 
fÜm©
 [(
height_0
, 
width_0
)]. 
FÜ
 
exam¶e
, 
£‰šg


89 
ã©u»_m­_sh­e_li¡
=[(8, 8)] 
asks
 
ªchÜs
 
th©
 
cÜ»¥Úd


90 
to
 
ª
 8x8 
Ïy”
. 
FÜ
 
this
 
ªchÜ
 
g’”©Ü
, 
Úly
 
li¡s
 
of
 
Ëngth
 1 
¬e


91 
®lowed
.

93 
R‘uºs
:

94 
boxes
: 
a
 
BoxLi¡
 
hŞdšg
‡ 
cŞËùiÚ
 
of
 
N
 
ªchÜ
 boxes

95 
Rai£s
:

96 
V®ueE¼Ü
: 
ã©u»_m­_sh­e_li¡
, 
box_¥ecs_li¡
 dØ
nÙ
 
have
 
the
 
§me


97 
Ëngth
.

98 
V®ueE¼Ü
: 
ã©u»_m­_sh­e_li¡
 
dÛs
 
nÙ
 
cÚsi¡
 
of
 
·œs
 of

99 
š‹g”s


101 
	`nÙ
 (
	$isš¡ªû
(
ã©u»_m­_sh­e_li¡
, 
li¡
)

102 
ªd
 
	`Ën
(
ã©u»_m­_sh­e_li¡
) == 1):

103 
¿i£
 
	`V®ueE¼Ü
('feature_map_shape_list must be‡†ist of†ength 1.')

104 
nÙ
 
	`®l
([
	$isš¡ªû
(
li¡_™em
, 
tu¶e
è
ªd
 
	`Ën
(list_item) == 2

105 
li¡_™em
 
š
 
ã©u»_m­_sh­e_li¡
]):

106 
¿i£
 
	`V®ueE¼Ü
('feature_map_shape_list must be‡†ist of…airs.')

107 
grid_height
, 
grid_width
 = 
ã©u»_m­_sh­e_li¡
[0]

108 
sÿËs_grid
, 
a¥eù_¿tios_grid
 = 
İs
.
	$meshgrid
(
£lf
.
_sÿËs
,

109 
£lf
.
_a¥eù_¿tios
)

110 
sÿËs_grid
 = 
tf
.
	`»sh­e
(scales_grid, [-1])

111 
a¥eù_¿tios_grid
 = 
tf
.
	`»sh­e
(aspect_ratios_grid, [-1])

112  
	$te_ªchÜs
(
grid_height
,

113 
grid_width
,

114 
sÿËs_grid
,

115 
a¥eù_¿tios_grid
,

116 
£lf
.
_ba£_ªchÜ_size
,

117 
£lf
.
_ªchÜ_¡ride
,

118 
£lf
.
_ªchÜ_off£t
)

121 
def
 
	$te_ªchÜs
(
grid_height
,

122 
grid_width
,

123 
sÿËs
,

124 
a¥eù_¿tios
,

125 
ba£_ªchÜ_size
,

126 
ªchÜ_¡ride
,

127 
ªchÜ_off£t
):

130 
This
 
İ
 
ü—‹s
 
a
 
£t
 
of
 
ªchÜ
 
boxes
 
by
 
¶acšg
‡ "basis" 
cŞËùiÚ
 of

131 
boxes
 
w™h
 
u£r
-
¥ecif›d
 
sÿËs
 
ªd
 
a¥eù
 
¿tios
 
ûÁ”ed
 
©
 
ev’ly


132 
di¡ribu‹d
 
pošts
 
®Úg
 
a
 
grid
. 
The
 
basis
 
cŞËùiÚ
 
is
 
¥ecif›d
 
vŸ
 
the


133 
sÿË
 
ªd
 
a¥eù_¿tios
 
¬gum’ts
. 
FÜ
 
exam¶e
, 
£‰šg
 
sÿËs
=[.1, .2, .2]

134 
ªd
 
a¥eù
 
¿tios
 = [2,2,1/2] 
m—ns
 
th©
 
we
 
ü—‹
 
th»e
 
boxes
: 
Úe
 
w™h
 
sÿË


135 .1, 
a¥eù
 
¿tio
 2, 
Úe
 
w™h
 
sÿË
 .2,‡¥eù„©iØ2, 
ªd
 one with scale .2

136 
ªd
 
a¥eù
 
¿tio
 1/2. 
Each
 
box
 
is
 
muÉl›d
 
by
 "ba£_ªchÜ_size" 
befÜe


137 
¶acšg
 
™
 
ov”
 
™s
 
»¥eùive
 
ûÁ”
.

139 
Grid
 
pošts
 
¬e
 
¥ecif›d
 
vŸ
 
grid_height
, 
grid_width
 
·¿m‘”s
 
as
 
w–l
‡s

140 
the
 
ªchÜ_¡ride
 
ªd
 
ªchÜ_off£t
 
·¿m‘”s
.

142 
Args
:

143 
grid_height
: 
size
 
of
 
the
 
grid
 
š
h
y
 
	$dœeùiÚ
 (
Ü
 
sÿÏr
 
‹nsÜ
)

144 
grid_width
: 
size
 
of
 
the
 
grid
 
š
h
x
 
	$dœeùiÚ
 (
Ü
 
sÿÏr
 
‹nsÜ
)

145 
sÿËs
: 
a
 1-
	$d
 (è
‹nsÜ
 
»´e£Ášg
 
the
 
sÿË
 
of
 
—ch
 
box
 
š
he

146 
basis
 
£t
.

147 
a¥eù_¿tios
: 
a
 1-
	$d
 (è
‹nsÜ
 
»´e£Ášg
 
the
 
a¥eù
 
¿tio
 
of
 
—ch


148 
box
 
š
 
the
 
basis
 
£t
. 
The
 
Ëngth
 
of
h
sÿËs
 
ªd
 
a¥eù_¿tios
 
‹nsÜs


149 
mu¡
 
be
 
equ®
.

150 
ba£_ªchÜ_size
: 
ba£
 
ªchÜ
 
size
 
as
 [
height
, 
width
]

151 (
‹nsÜ
 
of
 
sh­e
 [2])

152 
ªchÜ_¡ride
: 
difã»nû
 
š
 
ûÁ”s
 
b‘w“n
 
ba£
 
ªchÜs
 
adjaûÁ
 
grid


153 
	$pos™iÚs
 (
‹nsÜ
 
of
 
sh­e
 [2])

154 
ªchÜ_off£t
: 
ûÁ”
 
of
 
the
 
ªchÜ
 
w™h
 
sÿË
 
ªd
 
a¥eù
 
¿tio
 1 the

155 
uµ”
 
Ëá
 
–em’t
 
of
 
the
 
grid
, 
this
 
should
 
be
 
z”o
 

156 
ã©u»
 
ÃtwÜks
 
w™h
 
Úly
 
VALID
 
·ddšg
 
ªd
 
ev’
 
»û±ive


157 
f›ld
 
size
, 
but
 
may
 
Ãed
 
some
 
add™iÚ®
 
ÿlcuÏtiÚ
 
Ùh”


158 
·ddšg
 
is
 
	$u£d
 (
‹nsÜ
 
of
 
sh­e
 [2])

159 
R‘uºs
:

160 
a
 
BoxLi¡
 
hŞdšg
‡ 
cŞËùiÚ
 
of
 
N
 
ªchÜ
 
boxes


162 
¿tio_sq¹s
 = 
tf
.
	$sq¹
(
a¥eù_¿tios
)

163 
heights
 = 
sÿËs
 / 
¿tio_sq¹s
 * 
ba£_ªchÜ_size
[0]

164 
widths
 = 
sÿËs
 * 
¿tio_sq¹s
 * 
ba£_ªchÜ_size
[1]

166 #G‘ 
a
 
grid
 
of
 
box
 
ûÁ”s


167 
y_ûÁ”s
 = 
tf
.
	`to_æßt
Ñf.
	$¿nge
(
grid_height
))

168 
y_ûÁ”s
 = y_ûÁ” * 
ªchÜ_¡ride
[0] + 
ªchÜ_off£t
[0]

169 
x_ûÁ”s
 = 
tf
.
	`to_æßt
Ñf.
	$¿nge
(
grid_width
))

170 
x_ûÁ”s
 = x_ûÁ” * 
ªchÜ_¡ride
[1] + 
ªchÜ_off£t
[1]

171 
x_ûÁ”s
, 
y_ûÁ”s
 = 
İs
.
	$meshgrid
(
x_ûÁ”s
, 
y_ûÁ”s
)

173 
widths_grid
, 
x_ûÁ”s_grid
 = 
İs
.
	$meshgrid
(
widths
, 
x_ûÁ”s
)

174 
heights_grid
, 
y_ûÁ”s_grid
 = 
İs
.
	$meshgrid
(
heights
, 
y_ûÁ”s
)

175 
bbox_ûÁ”s
 = 
tf
.
	$¡ack
([
y_ûÁ”s_grid
, 
x_ûÁ”s_grid
], 
axis
=3)

176 
bbox_sizes
 = 
tf
.
	$¡ack
([
heights_grid
, 
widths_grid
], 
axis
=3)

177 
bbox_ûÁ”s
 = 
tf
.
	`»sh­e
(bbox_centers, [-1, 2])

178 
bbox_sizes
 = 
tf
.
	`»sh­e
(bbox_sizes, [-1, 2])

179 
bbox_cÜÃrs
 = 
	$_ûÁ”_size_bbox_to_cÜÃrs_bbox
(
bbox_ûÁ”s
, 
bbox_sizes
)

180  
box_li¡
.
	$BoxLi¡
(
bbox_cÜÃrs
)

183 
def
 
	$_ûÁ”_size_bbox_to_cÜÃrs_bbox
(
ûÁ”s
, 
sizes
):

186 
Args
:

187 
ûÁ”s
: 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
N
, 2] 
»´e£Ášg
 
boundšg
 
box
 centers

188 
sizes
: 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
N
, 2] 
»´e£Ášg
 
boundšg
 
boxes


190 
R‘uºs
:

191 
cÜÃrs
: 
‹nsÜ
 
w™h
 
sh­e
 [
N
, 4] 
»´e£Ášg
 
boundšg
 
boxes
 
š
 corners

192 
»´e£Á©iÚ


194  
tf
.
	`cÚÿt
([
ûÁ”s
 - .5 * 
sizes
, centers + .5 * sizes], 1)

	@anchor_generators/grid_anchor_generator_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
ªchÜ_g’”©Üs
 
impÜt
 
grid_ªchÜ_g’”©Ü


23 
şass
 
	$GridAnchÜG’”©ÜTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

25 
def
 
	$‹¡_cÚ¡ruù_sšgË_ªchÜ
(
£lf
):

27 
sÿËs
 = [0.5, 1.0, 2.0]

28 
a¥eù_¿tios
 = [0.25, 1.0, 4.0]

29 
ªchÜ_off£t
 = [7, -3]

30 
exp_ªchÜ_cÜÃrs
 = [[-121, -35, 135, 29], [-249, -67, 263, 61],

36 
ªchÜ_g’”©Ü
 = 
grid_ªchÜ_g’”©Ü
.
	$GridAnchÜG’”©Ü
(

37 
sÿËs
, 
a¥eù_¿tios
,

38 
ªchÜ_off£t
=anchor_offset)

39 
ªchÜs
 = 
ªchÜ_g’”©Ü
.
	`g’”©e
(
ã©u»_m­_sh­e_li¡
=[(1, 1)])

40 
ªchÜ_cÜÃrs
 = 
ªchÜs
.
	$g‘
()

42 
w™h
 
£lf
.
	$‹¡_£ssiÚ
():

43 
ªchÜ_cÜÃrs_out
 = 
ªchÜ_cÜÃrs
.
	$ev®
()

44 
£lf
.
	$as£¹AÎClo£
(
ªchÜ_cÜÃrs_out
, 
exp_ªchÜ_cÜÃrs
)

46 
def
 
	$‹¡_cÚ¡ruù_ªchÜ_grid
(
£lf
):

47 
ba£_ªchÜ_size
 = [10, 10]

48 
ªchÜ_¡ride
 = [19, 19]

49 
ªchÜ_off£t
 = [0, 0]

50 
sÿËs
 = [0.5, 1.0, 2.0]

51 
a¥eù_¿tios
 = [1.0]

53 
exp_ªchÜ_cÜÃrs
 = [[-2.5, -2.5, 2.5, 2.5], [-5., -5., 5., 5.],

60 
ªchÜ_g’”©Ü
 = 
grid_ªchÜ_g’”©Ü
.
	$GridAnchÜG’”©Ü
(

61 
sÿËs
,

62 
a¥eù_¿tios
,

63 
ba£_ªchÜ_size
=base_anchor_size,

64 
ªchÜ_¡ride
=anchor_stride,

65 
ªchÜ_off£t
=anchor_offset)

67 
ªchÜs
 = 
ªchÜ_g’”©Ü
.
	`g’”©e
(
ã©u»_m­_sh­e_li¡
=[(2, 2)])

68 
ªchÜ_cÜÃrs
 = 
ªchÜs
.
	$g‘
()

70 
w™h
 
£lf
.
	$‹¡_£ssiÚ
():

71 
ªchÜ_cÜÃrs_out
 = 
ªchÜ_cÜÃrs
.
	$ev®
()

72 
£lf
.
	$as£¹AÎClo£
(
ªchÜ_cÜÃrs_out
, 
exp_ªchÜ_cÜÃrs
)

75 
__Çme__
 == '__main__':

76 
tf
.
‹¡
.
	`maš
()

	@anchor_generators/multiple_grid_anchor_generator.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
G’”©es
 
grid
 
ªchÜs
 
Ú
 
the
 
æy
 
cÜ»¥Údšg
 
to
 
muÉË
 
CNN
 
Ïy”s
 
as


19 
desüibed
 
	gš
:

21 
Wei
 
Liu
, 
D¿gomœ
 
	gAngu–ov
, 
Dum™ru
 
	gErhª
, 
Chri¡Ÿn
 
	gSzegedy
, 
ScÙt
 
	gR“d
,

22 
	gCh’g
-
Yªg
 
	gFu
, 
AËxªd”
 
	gC
. 
	gB”g


23 (
£e
 
	gSeùiÚ
 2.2: 
Choosšg
 
sÿËs
 
ªd
 
a¥eù
 
¿tios
  
boxes
)

26 
impÜt
 
numpy
 
as
 
Å


28 
impÜt
 
‹nsÜæow
 
as
 
tf


30 
äom
 
objeù_d‘eùiÚ
.
ªchÜ_g’”©Üs
 
impÜt
 
grid_ªchÜ_g’”©Ü


31 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
ªchÜ_g’”©Ü


32 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡_İs


35 
şass
 
	$MuÉËGridAnchÜG’”©Ü
(
ªchÜ_g’”©Ü
.
AnchÜG’”©Ü
):

38 
def
 
	$__š™__
(
£lf
,

39 
box_¥ecs_li¡
,

40 
ba£_ªchÜ_size
=
NÚe
,

41 
ş_wšdow
=
NÚe
):

44 
To
 
cÚ¡ruù
 
ªchÜs
, 
©
 
muÉË
 
grid
 
»sŞutiÚs
, 
Úe
 
mu¡
 
´ovide
 
a


45 
li¡
 
of
 
	`ã©u»_m­_sh­e_li¡
 (
e
.
g
., [(8, 8), (4, 4)]), 
ªd
 
—ch
 
grid


46 
size
, 
a
 
cÜ»¥Údšg
 
li¡
 
	$of
 (
sÿË
, 
a¥eù
 
¿tio
è
box
 
¥ecifiÿtiÚs
.

48 
FÜ
 
exam¶e
:

49 
box_¥ecs_li¡
 = [[(.1, 1.0), (.1, 2.0)], #fÜ 8x8 
grid


50 [(.2, 1.0), (.3, 1.0), (.2, 2.0)]] #fÜ 4x4 
grid


52 
To
 
suµÜt
 
the
 
fuÎy
 
cÚvŞutiÚ®
 
£‰šg
, 
we
 
·ss
 
grid
 
sizes
 
š
 
©


53 
g’”©iÚ
 
time
, 
sÿË
 
ªd
 
a¥eù
 
¿tios
 
¬e
 
fixed
 
©
 
cÚ¡ruùiÚ


54 
time
.

56 
Args
:

57 
box_¥ecs_li¡
: 
li¡
 
of
†i¡ 
	$of
 (
sÿË
, 
a¥eù
 
¿tio
è
·œs
 
w™h
 
the


58 
outside
 
li¡
 
havšg
 
the
 
§me
 
numb”
 
of
 
’Œ›s
 
as
 
ã©u»_m­_sh­e_li¡


59 (
which
 
is
 
·s£d
 
š
 
©
 
g’”©iÚ
 
time
).

60 
ba£_ªchÜ_size
: 
ba£
 
ªchÜ
 
size
 
as
 [
height
, 
width
]

61 (
Ëngth
-2 
‹nsÜ
, =[256, 256]).

62 
ş_wšdow
: 
a
 
‹nsÜ
 
of
 
sh­e
 [4] 
¥ecifyšg
‡ 
wšdow
 
to
 
which
 
®l


63 
ªchÜs
 
should
 
be
 
ş³d
. 
If
 
ş_wšdow
 
is
 
NÚe
, 
th’
 
no
 
şpšg


64 
is
 
³rfÜmed
.

66 
Rai£s
:

67 
V®ueE¼Ü
: 
box_¥ecs_li¡
 
is
 
nÙ
 
a
 
li¡
 
of
†i¡ oà
·œs


68 
V®ueE¼Ü
: 
ş_wšdow
 
is
 
nÙ
 
e™h”
 
NÚe
 
Ü
 
a
 
‹nsÜ
 
of
 
sh­e
 [4]

70 
	$isš¡ªû
(
box_¥ecs_li¡
, 
li¡
è
ªd
 
	`®l
(

71 [
	$isš¡ªû
(
li¡_™em
, 
li¡
èli¡_™em 
š
 
box_¥ecs_li¡
]):

72 
£lf
.
_box_¥ecs
 = 
box_¥ecs_li¡


74 
¿i£
 
	`V®ueE¼Ü
('box_specs_list isƒxpectedo be‡ '

76 
ba£_ªchÜ_size
 
is
 
NÚe
:

77 
ba£_ªchÜ_size
 = 
tf
.
	$cÚ¡ªt
([256, 256], 
dty³
=
tf
.
æßt32
)

78 
£lf
.
_ba£_ªchÜ_size
 = 
ba£_ªchÜ_size


79 
ş_wšdow
 
is
 
nÙ
 
NÚe
 
ªd
 cl_wšdow.
	`g‘_sh­e
().
	`as_li¡
() != [4]:

80 
¿i£
 
	`V®ueE¼Ü
('clip_window mustƒither be None or‡ shape [4]ensor')

81 
£lf
.
_ş_wšdow
 = 
ş_wšdow


82 
£lf
.
_sÿËs
 = []

83 
£lf
.
_a¥eù_¿tios
 = []

84 
box_¥ec
 
š
 
£lf
.
_box_¥ecs
:

85 
nÙ
 
	`®l
([
	$isš¡ªû
(
’Œy
, 
tu¶e
è
ªd
 
	`Ën
(entry) == 2

86 
’Œy
 
š
 
box_¥ec
]):

87 
¿i£
 
	`V®ueE¼Ü
('box_specs_list isƒxpectedo be‡ '

89 
sÿËs
, 
a¥eù_¿tios
 = 
	$z
(*
box_¥ec
)

90 
£lf
.
_sÿËs
.
	$­³nd
(
sÿËs
)

91 
£lf
.
_a¥eù_¿tios
.
	$­³nd
(
a¥eù_¿tios
)

93 
def
 
	$Çme_scİe
(
£lf
):

96 
def
 
	$num_ªchÜs_³r_loÿtiÚ
(
£lf
):

99 
R‘uºs
:

100 
a
 
li¡
 
of
 
š‹g”s
, 
Úe
 
—ch
 
ex³ùed
 
ã©u»
 
m­
 
to
 
be
 
·s£d
o

101 
the
 
G’”©e
 
funùiÚ
.

103  [
	$Ën
(
box_¥ecs
èbox_¥ec 
š
 
£lf
.
_box_¥ecs
]

105 
def
 
	$_g’”©e
(
£lf
,

106 
ã©u»_m­_sh­e_li¡
,

107 
im_height
=1,

108 
im_width
=1,

109 
ªchÜ_¡rides
=
NÚe
,

110 
ªchÜ_off£ts
=
NÚe
):

113 
The
 
numb”
 
of
 
ªchÜs
 
g’”©ed
 
a
 
sšgË
 
grid
 
w™h
 
sh­e
 
MxM
 
wh”e
 
we


114 
¶aû
 
k
 
boxes
 
ov”
 
—ch
 
grid
 
ûÁ”
 
is
 k*
M
^2 
ªd
 
thus
 
the
 
tÙ®
 
numb”
 
of


115 
ªchÜs
 
is
 
the
 
sum
 
ov”
 
®l
 
grids
. 
In
 
our
 
box_¥ecs_li¡
 
exam¶e


116 (
£e
 
the
 
cÚ¡ruùÜ
 
doc¡ršg
), 
we
 
would
 
¶aû
 
two
 
boxes
 
ov”
 
—ch
 
grid


117 
pošt
 
Ú
 
ª
 8x8 
grid
 
ªd
 
th»e
 
boxes
 
ov”
 
—ch
 grid…ošˆÚ 
a
 4x4 grid‡nd

118 
thus
 
’d
 
up
 
w™h
 2*8^2 + 3*4^2 = 176 
ªchÜs
 
š
 
tÙ®
. 
The
 
Ïyout
 
of
 
the


119 
ouut
 
ªchÜs
 
fŞlows
 
the
 
Üd”
 
of
 
how
h
grid
 
sizes
 
ªd
 
box_¥ecs
 
¬e


120 
	`¥ecif›d
 (
w™h
 
box_¥ec
 
šdex
 
v¬yšg
 
the
 
ç¡e¡
, 
fŞlowed
 
by
 
width


121 
šdex
, 
th’
 
height
 index,h’ 
grid
 index).

123 
Args
:

124 
ã©u»_m­_sh­e_li¡
: 
li¡
 
of
 
·œs
 oà
cÚvÃt
 
Ïy”
 
»sŞutiÚs
 
š
 
the


125 
fÜm©
 [(
height_0
, 
width_0
), (
height_1
, 
width_1
), ...]. 
FÜ
 
exam¶e
,

126 
£‰šg
 
ã©u»_m­_sh­e_li¡
=[(8, 8), (7, 7)] 
asks
 
ªchÜs
 
th©


127 
cÜ»¥Úd
 
to
 
ª
 8x8 
Ïy”
 
fŞlowed
 
by
 
a
 7x7†ayer.

128 
im_height
: 
the
 
height
 
of
h
image
 
to
 
g’”©e
h
grid
 . 
If
 
bÙh


129 
im_height
 
ªd
 
im_width
 
¬e
 1, 
the
 
g’”©ed
 
ªchÜs
  
to


130 
nÜm®ized
 
coÜdš©es
, 
Ùh”wi£
 
absŞu‹
 coÜdš©e 
¬e
 
u£d
 
the


131 
grid
.

132 
im_width
: 
the
 
width
 
of
h
image
 
to
 
g’”©e
h
grid
 . 
If
 
bÙh


133 
im_height
 
ªd
 
im_width
 
¬e
 1, 
the
 
g’”©ed
 
ªchÜs
  
to


134 
nÜm®ized
 
coÜdš©es
, 
Ùh”wi£
 
absŞu‹
 coÜdš©e 
¬e
 
u£d
 
the


135 
grid
.

136 
ªchÜ_¡rides
: 
li¡
 
of
 
·œs
 oà
	`¡rides
 (
š
 
y
 
ªd
 
x
 
dœeùiÚs


137 
»¥eùiv–y
). 
FÜ
 
exam¶e
, 
£‰šg


138 
ªchÜ_¡rides
=[(.25, .25), (.5, .5)] 
m—ns
 
th©
 
we
 
wªt
 
the
 
ªchÜs


139 
cÜ»¥Údšg
 
to
 
the
 
fœ¡
 
Ïy”
Ø
be
 
¡rided
 
by
 .25 
ªd
 
tho£
 
š
he

140 
£cÚd
 
Ïy”
 
to
 
be
 
¡rided
 
by
 .5 
š
 
bÙh
 
y
 
ªd
 
x
 
dœeùiÚs
. 
By


141 , 
ªchÜ_¡rides
=
NÚe
, 
th’
 
they
 
¬e
 
£t
 
to
 
be
 
the
 
»croÿl


142 
of
 
the
 
cÜ»¥Údšg
 
grid
 
sizes
. 
The
 
·œs
 
ÿn
 
®so
 
be
 
¥ecif›d
 
as


143 
dyÇmic
 
tf
.
Ü
f.
numb”s
, 
e
.
g
. 
v¬ŸbË
 
sh­e
 
šput


144 
images
.

145 
ªchÜ_off£ts
: 
li¡
 
of
 
·œs
 oà
	`off£ts
 (
š
 
y
 
ªd
 
x
 
dœeùiÚs


146 
»¥eùiv–y
). 
The
 
off£t
 
¥ecif›s
 
wh”e
 
we
 
wªt
 
the
 
ûÁ”
 
of
he

147 (0, 0)-
th
 
ªchÜ
 
to
 
l›
 
—ch
 
Ïy”
. 
FÜ
 
exam¶e
, 
£‰šg


148 
ªchÜ_off£ts
=[(.125, .125), (.25, .25)]è
m—ns
 
th©
 
we
 
wªt
 
the


149 (0, 0)-
th
 
ªchÜ
 
of
 
the
 
fœ¡
 
Ïy”
 
to
 
l›
 
	$©
 (.125, .125è
š
 
image


150 
¥aû
 
ªd
 
likewi£
 
th©
 
we
 
wªt
 
	`the
 (0, 0)-
th
 
ªchÜ
 
of
 
the
 
£cÚd


151 
Ïy”
 
to
 
l›
 
	$©
 (.25, .25è
š
 
image
 
¥aû
. 
By
 , 

152 
ªchÜ_off£ts
=
NÚe
, 
th’
 
they
 
¬e
 
£t
 
to
 
be
 
h®f
 
of
 
the
 
cÜ»¥Údšg


153 
ªchÜ
 
¡ride
. 
The
 
·œs
 
ÿn
 
®so
 
be
 
¥ecif›d
 
as
 
dyÇmic
 
tf
.
Ü


154 
tf
.
numb”s
, 
e
.
g
. 
v¬ŸbË
 
sh­e
 
šput
 
images
.

156 
R‘uºs
:

157 
boxes
: 
a
 
BoxLi¡
 
hŞdšg
‡ 
cŞËùiÚ
 
of
 
N
 
ªchÜ
 boxes

158 
Rai£s
:

159 
V®ueE¼Ü
: 
ã©u»_m­_sh­e_li¡
, 
box_¥ecs_li¡
 dØ
nÙ
 
have
 
the
 
§me


160 
Ëngth
.

161 
V®ueE¼Ü
: 
ã©u»_m­_sh­e_li¡
 
dÛs
 
nÙ
 
cÚsi¡
 
of
 
·œs
 of

162 
š‹g”s


164 
	`nÙ
 (
	$isš¡ªû
(
ã©u»_m­_sh­e_li¡
, 
li¡
)

165 
ªd
 
	`Ën
(
ã©u»_m­_sh­e_li¡
è=ğ
	$Ën
(
£lf
.
_box_¥ecs
)):

166 
¿i£
 
	`V®ueE¼Ü
('feature_map_shape_list must be‡†ist withhe same '

168 
nÙ
 
	`®l
([
	$isš¡ªû
(
li¡_™em
, 
tu¶e
è
ªd
 
	`Ën
(list_item) == 2

169 
li¡_™em
 
š
 
ã©u»_m­_sh­e_li¡
]):

170 
¿i£
 
	`V®ueE¼Ü
('feature_map_shape_list must be‡†ist of…airs.')

171 
nÙ
 
ªchÜ_¡rides
:

172 
ªchÜ_¡rides
 = [(
tf
.
	`to_æßt
(
im_height
è/f.to_æßt(
·œ
[0]),

173 
tf
.
	`to_æßt
(
im_width
è/f.
	$to_æßt
(
·œ
[1]))

174 
·œ
 
š
 
ã©u»_m­_sh­e_li¡
]

175 
nÙ
 
ªchÜ_off£ts
:

176 
ªchÜ_off£ts
 = [(0.5 * 
¡ride
[0], 0.5 * stride[1])

177 
¡ride
 
š
 
ªchÜ_¡rides
]

178 
¬g
, 
¬g_Çme
 
š
 
	`z
([
ªchÜ_¡rides
, 
ªchÜ_off£ts
],

180 
	`nÙ
 (
	$isš¡ªû
(
¬g
, 
li¡
è
ªd
 
	`Ën
×rgè=ğ
	$Ën
(
£lf
.
_box_¥ecs
)):

181 
¿i£
 
	`V®ueE¼Ü
('%s must be‡†ist withhe same†ength '

182 'a £lf._box_¥ecs' % 
¬g_Çme
)

183 
nÙ
 
	`®l
([
	$isš¡ªû
(
li¡_™em
, 
tu¶e
è
ªd
 
	`Ën
(list_item) == 2

184 
li¡_™em
 
š
 
¬g
]):

185 
¿i£
 
	`V®ueE¼Ü
('% mu¡ b¨li¡ oà·œs.' % 
¬g_Çme
)

187 
ªchÜ_grid_li¡
 = []

188 
mš_im_sh­e
 = 
tf
.
	`to_æßt
Ñf.
	$mšimum
(
im_height
, 
im_width
))

189 
ba£_ªchÜ_size
 = 
mš_im_sh­e
 * 
£lf
.
_ba£_ªchÜ_size


190 
grid_size
, 
sÿËs
, 
a¥eù_¿tios
, 
¡ride
, 
off£t
 
š
 
	$z
(

191 
ã©u»_m­_sh­e_li¡
, 
£lf
.
_sÿËs
, s–f.
_a¥eù_¿tios
,

192 
ªchÜ_¡rides
, 
ªchÜ_off£ts
):

193 
ªchÜ_grid_li¡
.
	`­³nd
(

194 
grid_ªchÜ_g’”©Ü
.
	$te_ªchÜs
(

195 
grid_height
=
grid_size
[0],

196 
grid_width
=
grid_size
[1],

197 
sÿËs
=scales,

198 
a¥eù_¿tios
=aspect_ratios,

199 
ba£_ªchÜ_size
=base_anchor_size,

200 
ªchÜ_¡ride
=
¡ride
,

201 
ªchÜ_off£t
=
off£t
))

202 
cÚÿ‹Ç‹d_ªchÜs
 = 
box_li¡_İs
.
	$cÚÿ‹Ç‹
(
ªchÜ_grid_li¡
)

203 
num_ªchÜs
 = 
cÚÿ‹Ç‹d_ªchÜs
.
	$num_boxes_¡©ic
()

204 
num_ªchÜs
 
is
 
NÚe
:

205 
num_ªchÜs
 = 
cÚÿ‹Ç‹d_ªchÜs
.
	$num_boxes
()

206 
£lf
.
_ş_wšdow
 
is
 
nÙ
 
NÚe
:

207 
ş_wšdow
 = 
tf
.
	`muÉly
(

208 
tf
.
	`to_æßt
([
im_height
, 
im_width
, im_height, im_width]),

209 
£lf
.
_ş_wšdow
)

210 
cÚÿ‹Ç‹d_ªchÜs
 = 
box_li¡_İs
.
	$ş_to_wšdow
(

211 
cÚÿ‹Ç‹d_ªchÜs
, 
ş_wšdow
, 
f‹r_nÚov”Ïµšg
=
F®£
)

212 #TODO: 
make
 
»sh­e
 
ª
 
İtiÚ
 
the
 
ş_to_wšdow
 
İ


213 
cÚÿ‹Ç‹d_ªchÜs
.
	`£t
(

214 
tf
.
	`»sh­e
(
cÚÿ‹Ç‹d_ªchÜs
.
	`g‘
(), [
num_ªchÜs
, 4]))

216 
¡ddevs_‹nsÜ
 = 0.01 * 
tf
.
	`Úes
(

217 [
num_ªchÜs
, 4], 
dty³
=
tf
.
æßt32
, 
Çme
='stddevs')

218 
cÚÿ‹Ç‹d_ªchÜs
.
	`add_f›ld
('¡ddev', 
¡ddevs_‹nsÜ
)

220  
cÚÿ‹Ç‹d_ªchÜs


223 
def
 
	`ü—‹_ssd_ªchÜs
(
num_Ïy”s
=6,

224 
mš_sÿË
=0.2,

225 
max_sÿË
=0.95,

226 
a¥eù_¿tios
=(1.0, 2.0, 3.0, 1.0/2, 1.0/3),

227 
ba£_ªchÜ_size
=
NÚe
,

228 
»duû_boxes_š_lowe¡_Ïy”
=
True
):

231 
This
 
funùiÚ
 
š¡ªtŸ‹s
 
a
 
MuÉËGridAnchÜG’”©Ü
 
th©
 
»´oduûs


232 `` 
box
`` 
cÚ¡ruùiÚ
 
´İo£d
 
by
 
Liu
 
‘
 
®
 
š
 
the
 
SSD
 
·³r
.

233 
S“
 
SeùiÚ
 2.2 
d‘as
. 
Grid
 
sizes
 
¬e
 
assumed
 
to
 
be
 
·s£d
 
š


234 
©
 
g’”©iÚ
 
time
 
äom
 
fše¡
 
»sŞutiÚ
 
to
 
cßr£¡
„esŞutiÚ --- 
this
 
is


235 
u£d
 
	$to
 (
lš—¾y
è
š‹½Ş©e
 
sÿËs
 
of
 
ªchÜ
 
boxes
 
cÜ»¥Údšg
 
to
 
the


236 
š‹rmedŸ‹
 
grid
 
sizes
.

238 
AnchÜs
 
th©
 
¬e
 
»tuºed
 
by
 
ÿÎšg
 
the
 `
g’”©e
` 
m‘hod
 
Ú
he„eturned

239 
MuÉËGridAnchÜG’”©Ü
 
objeù
 
¬e
 
®ways
 
š
 
nÜm®ized
 
coÜdš©es


240 
ªd
 
ş³d
 
to
 
the
 
un™
 
squ¬e
: (
i
.
e
. 
®l
 
coÜdš©es
 
l›
 
š
 [0, 1]
x
[0, 1]).

242 
Args
:

243 
num_Ïy”s
: 
š‹g”
 
numb”
 
of
 
grid
 
Ïy”s
 
to
 
ü—‹
 
ªchÜs
 
aùu®


244 
grid
 
sizes
 
·s£d
 
š
 
©
 
g’”©iÚ
 
time
)

245 
mš_sÿË
: 
sÿË
 
of
 
ªchÜs
 
cÜ»¥Údšg
 
to
 
fše¡
 
	$»sŞutiÚ
 ()

246 
max_sÿË
: 
sÿË
 
of
 
ªchÜs
 
cÜ»¥Údšg
 
to
 
cßr£¡
 
	$»sŞutiÚ
 ()

247 
a¥eù_¿tios
: 
li¡
 
Ü
 
tu¶e
 
	$of
 (è
a¥eù
 
¿tios
 
to
 
¶aû
 
Ú
 
—ch


248 
grid
 
pošt
.

249 
ba£_ªchÜ_size
: 
ba£
 
ªchÜ
 
size
 
as
 [
height
, 
width
].

250 
»duû_boxes_š_lowe¡_Ïy”
: 
a
 
boŞ—n
 
to
 
šdiÿ‹
 
wh‘h”
 
the
 
fixed
 3

251 
boxes
 
³r
 
loÿtiÚ
 
is
 
u£d
 
š
 
the
 
lowe¡
 
Ïy”
.

253 
R‘uºs
:

254 
a
 
MuÉËGridAnchÜG’”©Ü


256 
ba£_ªchÜ_size
 
is
 
NÚe
:

257 
ba£_ªchÜ_size
 = [1.0, 1.0]

258 
ba£_ªchÜ_size
 = 
tf
.
	$cÚ¡ªt
(
ba£_ªchÜ_size
, 
dty³
=
tf
.
æßt32
)

259 
box_¥ecs_li¡
 = []

260 
sÿËs
 = [
mš_sÿË
 + (
max_sÿË
 - mš_sÿËè* 
i
 / (
num_Ïy”s
 - 1)

261 
i
 
š
 
	`¿nge
(
num_Ïy”s
)] + [1.0]

262 
Ïy”
, 
sÿË
, 
sÿË_Ãxt
 
š
 
	`z
(

263 
	`¿nge
(
num_Ïy”s
), 
sÿËs
[:-1], scales[1:]):

264 
Ïy”_box_¥ecs
 = []

265 
Ïy”
 =ğ0 
ªd
 
»duû_boxes_š_lowe¡_Ïy”
:

266 
Ïy”_box_¥ecs
 = [(0.1, 1.0), (
sÿË
, 2.0), (scale, 0.5)]

268 
a¥eù_¿tio
 
š
 
a¥eù_¿tios
:

269 
Ïy”_box_¥ecs
.
	`­³nd
((
sÿË
, 
a¥eù_¿tio
))

270 
a¥eù_¿tio
 == 1.0:

271 
Ïy”_box_¥ecs
.
	`­³nd
((
Å
.
	`sq¹
(
sÿË
*
sÿË_Ãxt
), 1.0))

272 
box_¥ecs_li¡
.
	$­³nd
(
Ïy”_box_¥ecs
)

273  
	`MuÉËGridAnchÜG’”©Ü
(
box_¥ecs_li¡
, 
ba£_ªchÜ_size
)

	@anchor_generators/multiple_grid_anchor_generator_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
numpy
 
as
 
Å


20 
impÜt
 
‹nsÜæow
 
as
 
tf


22 
äom
 
	gobjeù_d‘eùiÚ
.
ªchÜ_g’”©Üs
 
impÜt
 
muÉË_grid_ªchÜ_g’”©Ü
 
as
 
ag


25 
şass
 
	$MuÉËGridAnchÜG’”©ÜTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

27 
def
 
	$‹¡_cÚ¡ruù_sšgË_ªchÜ_grid
(
£lf
):

29 
exp_ªchÜ_cÜÃrs
 = [[-121, -35, 135, 29], [-249, -67, 263, 61],

35 
ba£_ªchÜ_size
 = 
tf
.
	$cÚ¡ªt
([256, 256], 
dty³
=
tf
.
æßt32
)

36 
box_¥ecs_li¡
 = [[(.5, .25), (1.0, .25), (2.0, .25),

39 
ªchÜ_g’”©Ü
 = 
ag
.
	$MuÉËGridAnchÜG’”©Ü
(

40 
box_¥ecs_li¡
, 
ba£_ªchÜ_size
)

41 
ªchÜs
 = 
ªchÜ_g’”©Ü
.
	`g’”©e
(
ã©u»_m­_sh­e_li¡
=[(1, 1)],

42 
ªchÜ_¡rides
=[(16, 16)],

43 
ªchÜ_off£ts
=[(7, -3)])

44 
ªchÜ_cÜÃrs
 = 
ªchÜs
.
	$g‘
()

45 
w™h
 
£lf
.
	$‹¡_£ssiÚ
():

46 
ªchÜ_cÜÃrs_out
 = 
ªchÜ_cÜÃrs
.
	$ev®
()

47 
£lf
.
	$as£¹AÎClo£
(
ªchÜ_cÜÃrs_out
, 
exp_ªchÜ_cÜÃrs
)

49 
def
 
	$‹¡_cÚ¡ruù_ªchÜ_grid
(
£lf
):

50 
ba£_ªchÜ_size
 = 
tf
.
	$cÚ¡ªt
([10, 10], 
dty³
=
tf
.
æßt32
)

51 
box_¥ecs_li¡
 = [[(0.5, 1.0), (1.0, 1.0), (2.0, 1.0)]]

53 
exp_ªchÜ_cÜÃrs
 = [[-2.5, -2.5, 2.5, 2.5], [-5., -5., 5., 5.],

60 
ªchÜ_g’”©Ü
 = 
ag
.
	$MuÉËGridAnchÜG’”©Ü
(

61 
box_¥ecs_li¡
, 
ba£_ªchÜ_size
)

62 
ªchÜs
 = 
ªchÜ_g’”©Ü
.
	`g’”©e
(
ã©u»_m­_sh­e_li¡
=[(2, 2)],

63 
ªchÜ_¡rides
=[(19, 19)],

64 
ªchÜ_off£ts
=[(0, 0)])

65 
ªchÜ_cÜÃrs
 = 
ªchÜs
.
	$g‘
()

67 
w™h
 
£lf
.
	$‹¡_£ssiÚ
():

68 
ªchÜ_cÜÃrs_out
 = 
ªchÜ_cÜÃrs
.
	$ev®
()

69 
£lf
.
	$as£¹AÎClo£
(
ªchÜ_cÜÃrs_out
, 
exp_ªchÜ_cÜÃrs
)

71 
def
 
	$‹¡_cÚ¡ruù_ªchÜ_grid_nÚ_squ¬e
(
£lf
):

72 
ba£_ªchÜ_size
 = 
tf
.
	$cÚ¡ªt
([1, 1], 
dty³
=
tf
.
æßt32
)

73 
box_¥ecs_li¡
 = [[(1.0, 1.0)]]

75 
exp_ªchÜ_cÜÃrs
 = [[0., -0.25, 1., 0.75], [0., 0.25, 1., 1.25]]

77 
ªchÜ_g’”©Ü
 = 
ag
.
	$MuÉËGridAnchÜG’”©Ü
(
box_¥ecs_li¡
,

78 
ba£_ªchÜ_size
)

79 
ªchÜs
 = 
ªchÜ_g’”©Ü
.
	`g’”©e
(
ã©u»_m­_sh­e_li¡
=[(
tf
.
	`cÚ¡ªt
(

80 1, 
dty³
=
tf
.
št32
),f.
	`cÚ¡ªt
(2, dtype=tf.int32))])

81 
ªchÜ_cÜÃrs
 = 
ªchÜs
.
	$g‘
()

83 
w™h
 
£lf
.
	$‹¡_£ssiÚ
():

84 
ªchÜ_cÜÃrs_out
 = 
ªchÜ_cÜÃrs
.
	$ev®
()

85 
£lf
.
	$as£¹AÎClo£
(
ªchÜ_cÜÃrs_out
, 
exp_ªchÜ_cÜÃrs
)

87 
def
 
	$‹¡_cÚ¡ruù_ªchÜ_grid_uÂÜm®ized
(
£lf
):

88 
ba£_ªchÜ_size
 = 
tf
.
	$cÚ¡ªt
([1, 1], 
dty³
=
tf
.
æßt32
)

89 
box_¥ecs_li¡
 = [[(1.0, 1.0)]]

91 
exp_ªchÜ_cÜÃrs
 = [[0., 0., 320., 320.], [0., 320., 320., 640.]]

93 
ªchÜ_g’”©Ü
 = 
ag
.
	$MuÉËGridAnchÜG’”©Ü
(
box_¥ecs_li¡
,

94 
ba£_ªchÜ_size
)

95 
ªchÜs
 = 
ªchÜ_g’”©Ü
.
	`g’”©e
(

96 
ã©u»_m­_sh­e_li¡
=[(
tf
.
	`cÚ¡ªt
(1, 
dty³
ñf.
št32
),f.constant(

97 2, 
dty³
=
tf
.
št32
))],

98 
im_height
=320,

99 
im_width
=640)

100 
ªchÜ_cÜÃrs
 = 
ªchÜs
.
	$g‘
()

102 
w™h
 
£lf
.
	$‹¡_£ssiÚ
():

103 
ªchÜ_cÜÃrs_out
 = 
ªchÜ_cÜÃrs
.
	$ev®
()

104 
£lf
.
	$as£¹AÎClo£
(
ªchÜ_cÜÃrs_out
, 
exp_ªchÜ_cÜÃrs
)

106 
def
 
	$‹¡_cÚ¡ruù_muÉË_grids
(
£lf
):

107 
ba£_ªchÜ_size
 = 
tf
.
	$cÚ¡ªt
([1.0, 1.0], 
dty³
=
tf
.
æßt32
)

108 
box_¥ecs_li¡
 = [[(1.0, 1.0), (2.0, 1.0), (1.0, 0.5)],

111 #heighˆ
ªd
 
width
 
of
 
box
 
w™h
 .5 
a¥eù
 
¿tio


112 
h
 = 
Å
.
	$sq¹
(2)

113 
w
 = 1.0/
Å
.
	$sq¹
(2)

114 
exp_sm®l_grid_cÜÃrs
 = [[-.25, -.25, .75, .75],

115 [.25-.5*
h
, .25-.5*
w
, .25+.5*h, .25+.5*w],

117 [.25-.5*
h
, .75-.5*
w
, .25+.5*h, .75+.5*w],

119 [.75-.5*
h
, .25-.5*
w
, .75+.5*h, .25+.5*w],

121 [.75-.5*
h
, .75-.5*
w
, .75+.5*h, .75+.5*w]]

122 #Úly 
‹¡
 
fœ¡
 
’Œy
 
of
 
Ïrg”
 
£t
 oà
ªchÜs


123 
exp_big_grid_cÜÃrs
 = [[.125-.5, .125-.5, .125+.5, .125+.5],

125 [.125-.5*
h
, .125-.5*
w
, .125+.5*h, .125+.5*w],]

127 
ªchÜ_g’”©Ü
 = 
ag
.
	$MuÉËGridAnchÜG’”©Ü
(

128 
box_¥ecs_li¡
, 
ba£_ªchÜ_size
)

129 
ªchÜs
 = 
ªchÜ_g’”©Ü
.
	`g’”©e
(
ã©u»_m­_sh­e_li¡
=[(4, 4), (2, 2)],

130 
ªchÜ_¡rides
=[(.25, .25), (.5, .5)],

131 
ªchÜ_off£ts
=[(.125, .125),

133 
ªchÜ_cÜÃrs
 = 
ªchÜs
.
	$g‘
()

135 
w™h
 
£lf
.
	$‹¡_£ssiÚ
():

136 
ªchÜ_cÜÃrs_out
 = 
ªchÜ_cÜÃrs
.
	$ev®
()

137 
£lf
.
	`as£¹Equ®s
(
ªchÜ_cÜÃrs_out
.
sh­e
, (56, 4))

138 
big_grid_cÜÃrs
 = 
ªchÜ_cÜÃrs_out
[0:3, :]

139 
sm®l_grid_cÜÃrs
 = 
ªchÜ_cÜÃrs_out
[48:, :]

140 
£lf
.
	$as£¹AÎClo£
(
sm®l_grid_cÜÃrs
, 
exp_sm®l_grid_cÜÃrs
)

141 
£lf
.
	$as£¹AÎClo£
(
big_grid_cÜÃrs
, 
exp_big_grid_cÜÃrs
)

143 
def
 
	$‹¡_cÚ¡ruù_muÉË_grids_w™h_şpšg
(
£lf
):

144 
ba£_ªchÜ_size
 = 
tf
.
	$cÚ¡ªt
([1.0, 1.0], 
dty³
=
tf
.
æßt32
)

145 
box_¥ecs_li¡
 = [[(1.0, 1.0), (2.0, 1.0), (1.0, 0.5)],

148 #heighˆ
ªd
 
width
 
of
 
box
 
w™h
 .5 
a¥eù
 
¿tio


149 
h
 = 
Å
.
	$sq¹
(2)

150 
w
 = 1.0/
Å
.
	$sq¹
(2)

151 
exp_sm®l_grid_cÜÃrs
 = [[0, 0, .75, .75],

152 [0, 0, .25+.5*
h
, .25+.5*
w
],

154 [0, .75-.5*
w
, .25+.5*
h
, 1],

156 [.75-.5*
h
, 0, 1, .25+.5*
w
],

158 [.75-.5*
h
, .75-.5*
w
, 1, 1]]

160 
ş_wšdow
 = 
tf
.
	$cÚ¡ªt
([0, 0, 1, 1], 
dty³
=
tf
.
æßt32
)

161 
ªchÜ_g’”©Ü
 = 
ag
.
	$MuÉËGridAnchÜG’”©Ü
(

162 
box_¥ecs_li¡
, 
ba£_ªchÜ_size
, 
ş_wšdow
=clip_window)

163 
ªchÜs
 = 
ªchÜ_g’”©Ü
.
	`g’”©e
(
ã©u»_m­_sh­e_li¡
=[(4, 4), (2, 2)])

164 
ªchÜ_cÜÃrs
 = 
ªchÜs
.
	$g‘
()

166 
w™h
 
£lf
.
	$‹¡_£ssiÚ
():

167 
ªchÜ_cÜÃrs_out
 = 
ªchÜ_cÜÃrs
.
	$ev®
()

168 
sm®l_grid_cÜÃrs
 = 
ªchÜ_cÜÃrs_out
[48:, :]

169 
£lf
.
	$as£¹AÎClo£
(
sm®l_grid_cÜÃrs
, 
exp_sm®l_grid_cÜÃrs
)

171 
def
 
	$‹¡_šv®id_box_¥ecs
(
£lf
):

172 #nÙ 
®l
 
box
 
¥ecs
 
¬e
 
·œs


173 
box_¥ecs_li¡
 = [[(1.0, 1.0), (2.0, 1.0), (1.0, 0.5)],

175 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

176 
ag
.
	$MuÉËGridAnchÜG’”©Ü
(
box_¥ecs_li¡
)

178 #box_¥ecs_li¡ 
is
 
nÙ
 
a
 
li¡
 
of
 
li¡s


179 
box_¥ecs_li¡
 = [(1.0, 1.0), (2.0, 1.0), (1.0, 0.5)]

180 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

181 
ag
.
	$MuÉËGridAnchÜG’”©Ü
(
box_¥ecs_li¡
)

183 
def
 
	$‹¡_šv®id_g’”©e_¬gum’ts
(
£lf
):

184 
ba£_ªchÜ_size
 = 
tf
.
	$cÚ¡ªt
([1.0, 1.0], 
dty³
=
tf
.
æßt32
)

185 
box_¥ecs_li¡
 = [[(1.0, 1.0), (2.0, 1.0), (1.0, 0.5)],

187 
ªchÜ_g’”©Ü
 = 
ag
.
	$MuÉËGridAnchÜG’”©Ü
(

188 
box_¥ecs_li¡
, 
ba£_ªchÜ_size
)

190 #šcom·tibË 
Ëngths
 
w™h
 
box_¥ecs_li¡


191 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

192 
ªchÜ_g’”©Ü
.
	`g’”©e
(
ã©u»_m­_sh­e_li¡
=[(4, 4), (2, 2)],

193 
ªchÜ_¡rides
=[(.25, .25)],

194 
ªchÜ_off£ts
=[(.125, .125), (.25, .25)])

195 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

196 
ªchÜ_g’”©Ü
.
	`g’”©e
(
ã©u»_m­_sh­e_li¡
=[(4, 4), (2, 2), (1, 1)],

197 
ªchÜ_¡rides
=[(.25, .25), (.5, .5)],

198 
ªchÜ_off£ts
=[(.125, .125), (.25, .25)])

199 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

200 
ªchÜ_g’”©Ü
.
	`g’”©e
(
ã©u»_m­_sh­e_li¡
=[(4, 4), (2, 2)],

201 
ªchÜ_¡rides
=[(.5, .5)],

202 
ªchÜ_off£ts
=[(.25, .25)])

204 #nÙ 
·œs


205 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

206 
ªchÜ_g’”©Ü
.
	`g’”©e
(
ã©u»_m­_sh­e_li¡
=[(4, 4, 4), (2, 2)],

207 
ªchÜ_¡rides
=[(.25, .25), (.5, .5)],

208 
ªchÜ_off£ts
=[(.125, .125), (.25, .25)])

209 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

210 
ªchÜ_g’”©Ü
.
	`g’”©e
(
ã©u»_m­_sh­e_li¡
=[(4, 4), (2, 2)],

211 
ªchÜ_¡rides
=[(.25, .25, .1), (.5, .5)],

212 
ªchÜ_off£ts
=[(.125, .125),

214 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

215 
ªchÜ_g’”©Ü
.
	`g’”©e
(
ã©u»_m­_sh­e_li¡
=[(4), (2, 2)],

216 
ªchÜ_¡rides
=[(.25, .25), (.5, .5)],

217 
ªchÜ_off£ts
=[(.125), (.25)])

220 
şass
 
	$C»©eSSDAnchÜsTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

222 
def
 
	$‹¡_ü—‹_ssd_ªchÜs_»tuºs_cÜ»ù_sh­e
(
£lf
):

223 
ªchÜ_g’”©Ü
 = 
ag
.
	`ü—‹_ssd_ªchÜs
(

224 
num_Ïy”s
=6, 
mš_sÿË
=0.2, 
max_sÿË
=0.95,

225 
a¥eù_¿tios
=(1.0, 2.0, 3.0, 1.0/2, 1.0/3),

226 
»duû_boxes_š_lowe¡_Ïy”
=
True
)

228 
ã©u»_m­_sh­e_li¡
 = [(38, 38), (19, 19), (10, 10),

230 
ªchÜs
 = 
ªchÜ_g’”©Ü
.
	$g’”©e
(

231 
ã©u»_m­_sh­e_li¡
=feature_map_shape_list)

232 
ªchÜ_cÜÃrs
 = 
ªchÜs
.
	$g‘
()

233 
w™h
 
£lf
.
	$‹¡_£ssiÚ
():

234 
ªchÜ_cÜÃrs_out
 = 
ªchÜ_cÜÃrs
.
	$ev®
()

235 
£lf
.
	`as£¹Equ®s
(
ªchÜ_cÜÃrs_out
.
sh­e
, (7308, 4))

237 
ªchÜ_g’”©Ü
 = 
ag
.
	`ü—‹_ssd_ªchÜs
(

238 
num_Ïy”s
=6, 
mš_sÿË
=0.2, 
max_sÿË
=0.95,

239 
a¥eù_¿tios
=(1.0, 2.0, 3.0, 1.0/2, 1.0/3),

240 
»duû_boxes_š_lowe¡_Ïy”
=
F®£
)

242 
ã©u»_m­_sh­e_li¡
 = [(38, 38), (19, 19), (10, 10),

244 
ªchÜs
 = 
ªchÜ_g’”©Ü
.
	$g’”©e
(

245 
ã©u»_m­_sh­e_li¡
=feature_map_shape_list)

246 
ªchÜ_cÜÃrs
 = 
ªchÜs
.
	$g‘
()

247 
w™h
 
£lf
.
	$‹¡_£ssiÚ
():

248 
ªchÜ_cÜÃrs_out
 = 
ªchÜ_cÜÃrs
.
	$ev®
()

249 
£lf
.
	`as£¹Equ®s
(
ªchÜ_cÜÃrs_out
.
sh­e
, (11640, 4))

252 
__Çme__
 == '__main__':

253 
tf
.
‹¡
.
	`maš
()

	@box_coders/__init__.py

	@box_coders/faster_rcnn_box_coder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
Fa¡”
 
RCNN
 
box
 
cod”
 
fŞlows
 
the
 
codšg
 
schema
 
desüibed
 
	gb–ow
:

19 
ty
 = (
y
 - 
ya
è/ 
ha


20 
tx
 = (
x
 - 
xa
è/ 
wa


21 
th
 = 
log
(
h
 / 
ha
)

22 
tw
 = 
log
(
w
 / 
wa
)

23 
wh”e
 
x
, 
	gy
, 
	gw
, 
h
 
d’Ùe
 
the
 
	gbox
's center coordinates, width‡nd height

24 
	g»¥eùiv–y
. 
	gSim¬ly
, 
	gxa
, 
	gya
, 
	gwa
, 
ha
 
d’Ùe
 
the
 
	gªchÜ
's center

25 
	gcoÜdš©es
, 
width
 
ªd
 
	gheight
. 
	gtx
, 
	gty
, 
tw
‡nd 
th
 
d’Ùe
 
the
 
	gªchÜ
-
’coded


26 
	gûÁ”
, 
width
 
ªd
 
height
 
	g»¥eùiv–y
.

28 
S“
 
	gh‰p
:

31 
impÜt
 
‹nsÜæow
 
as
 
tf


33 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_cod”


34 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


36 
EPSILON
 = 1e-8

39 
şass
 
	$Fa¡”RúnBoxCod”
(
box_cod”
.
BoxCod”
):

42 
def
 
	$__š™__
(
£lf
, 
sÿË_çùÜs
=
NÚe
):

45 
Args
:

46 
sÿË_çùÜs
: 
Li¡
 
of
 4 
pos™ive
 
sÿÏrs
 
to
 
sÿË
 
ty
, 
tx
, 
th
 
ªd
 
tw
.

47 
If
 
£t
 
to
 
NÚe
, 
dÛs
 
nÙ
 
³rfÜm
 
sÿlšg
. 
FÜ
 
Fa¡”
 
RCNN
,

48 
the
 
İ’
-
sourû
 
im¶em’tiÚ
 
»comm’ds
 
usšg
 [10.0, 10.0, 5.0, 5.0].

50 
sÿË_çùÜs
:

51 
as£¹
 
	`Ën
(
sÿË_çùÜs
) == 4

52 
sÿÏr
 
š
 
sÿË_çùÜs
:

53 
as£¹
 
sÿÏr
 > 0

54 
£lf
.
_sÿË_çùÜs
 = 
sÿË_çùÜs


56 @
´İ”ty


57 
def
 
	$code_size
(
£lf
):

60 
def
 
	$_’code
(
£lf
, 
boxes
, 
ªchÜs
):

63 
Args
:

64 
boxes
: 
BoxLi¡
 
hŞdšg
 
N
 boxe 
to
 
be
 
’coded
.

65 
ªchÜs
: 
BoxLi¡
 
of
‡nchors.

67 
R‘uºs
:

68 
a
 
‹nsÜ
 
»´e£Ášg
 
N
 
ªchÜ
-
’coded
 
boxes
 
of
 
the
 
fÜm©


69 [
ty
, 
tx
, 
th
, 
tw
].

71 #CÚv”ˆ
ªchÜs
 
to
 
the
 
ûÁ”
 
coÜdš©e
 
»´e£Á©iÚ
.

72 
yûÁ”_a
, 
xûÁ”_a
, 
ha
, 
wa
 = 
ªchÜs
.
	$g‘_ûÁ”_coÜdš©es_ªd_sizes
()

73 
yûÁ”
, 
xûÁ”
, 
h
, 
w
 = 
boxes
.
	$g‘_ûÁ”_coÜdš©es_ªd_sizes
()

74 #Avoid 
NaN
 
š
 
divisiÚ
 
ªd
 
log
 
b–ow
.

75 
ha
 +ğ
EPSILON


76 
wa
 +ğ
EPSILON


77 
h
 +ğ
EPSILON


78 
w
 +ğ
EPSILON


80 
tx
 = (
xûÁ”
 - 
xûÁ”_a
è/ 
wa


81 
ty
 = (
yûÁ”
 - 
yûÁ”_a
è/ 
ha


82 
tw
 = 
tf
.
	`log
(
w
 / 
wa
)

83 
th
 = 
tf
.
	`log
(
h
 / 
ha
)

84 #SÿË 
loÿtiÚ
 
rg‘s
 
as
 
u£d
 
š
 
·³r
 
jošt
 
Œaššg
.

85 
£lf
.
_sÿË_çùÜs
:

86 
ty
 *ğ
£lf
.
_sÿË_çùÜs
[0]

87 
tx
 *ğ
£lf
.
_sÿË_çùÜs
[1]

88 
th
 *ğ
£lf
.
_sÿË_çùÜs
[2]

89 
tw
 *ğ
£lf
.
_sÿË_çùÜs
[3]

90  
tf
.
	`Œª¥o£
Ñf.
	$¡ack
([
ty
, 
tx
, 
th
, 
tw
]))

92 
def
 
	$_decode
(
£lf
, 
»l_codes
, 
ªchÜs
):

95 
Args
:

96 
»l_codes
: 
a
 
‹nsÜ
 
»´e£Ášg
 
N
 
ªchÜ
-
’coded
 
boxes
.

97 
ªchÜs
: 
BoxLi¡
 
of
‡nchors.

99 
R‘uºs
:

100 
boxes
: 
BoxLi¡
 
hŞdšg
 
N
 
boundšg
 boxes.

102 
yûÁ”_a
, 
xûÁ”_a
, 
ha
, 
wa
 = 
ªchÜs
.
	$g‘_ûÁ”_coÜdš©es_ªd_sizes
()

104 
ty
, 
tx
, 
th
, 
tw
 = 
tf
.
	`un¡ack
Ñf.
	$Œª¥o£
(
»l_codes
))

105 
£lf
.
_sÿË_çùÜs
:

106 
ty
 /ğ
£lf
.
_sÿË_çùÜs
[0]

107 
tx
 /ğ
£lf
.
_sÿË_çùÜs
[1]

108 
th
 /ğ
£lf
.
_sÿË_çùÜs
[2]

109 
tw
 /ğ
£lf
.
_sÿË_çùÜs
[3]

110 
w
 = 
tf
.
	`exp
(
tw
è* 
wa


111 
h
 = 
tf
.
	`exp
(
th
è* 
ha


112 
yûÁ”
 = 
ty
 * 
ha
 + 
yûÁ”_a


113 
xûÁ”
 = 
tx
 * 
wa
 + 
xûÁ”_a


114 
ymš
 = 
yûÁ”
 - 
h
 / 2.

115 
xmš
 = 
xûÁ”
 - 
w
 / 2.

116 
ymax
 = 
yûÁ”
 + 
h
 / 2.

117 
xmax
 = 
xûÁ”
 + 
w
 / 2.

118  
box_li¡
.
	`BoxLi¡
(
tf
.
	`Œª¥o£
Ñf.
	`¡ack
([
ymš
, 
xmš
, 
ymax
, 
xmax
])))

	@box_coders/faster_rcnn_box_coder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
box_cod”s
 
impÜt
 
ç¡”_rún_box_cod”


21 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


24 
şass
 
	$Fa¡”RúnBoxCod”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$‹¡_g‘_cÜ»ù_»Ïtive_codes_aá”_’codšg
(
£lf
):

27 
boxes
 = [[10.0, 10.0, 20.0, 15.0], [0.2, 0.1, 0.5, 0.4]]

28 
ªchÜs
 = [[15.0, 12.0, 30.0, 18.0], [0.1, 0.0, 0.7, 0.9]]

29 
ex³ùed_»l_codes
 = [[-0.5, -0.416666, -0.405465, -0.182321],

31 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
boxes
))

32 
ªchÜs
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
ªchÜs
))

33 
cod”
 = 
ç¡”_rún_box_cod”
.
	$Fa¡”RúnBoxCod”
()

34 
»l_codes
 = 
cod”
.
	$’code
(
boxes
, 
ªchÜs
)

35 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

36 
»l_codes_out
, = 
£ss
.
	$run
([
»l_codes
])

37 
£lf
.
	$as£¹AÎClo£
(
»l_codes_out
, 
ex³ùed_»l_codes
)

39 
def
 
	$‹¡_g‘_cÜ»ù_»Ïtive_codes_aá”_’codšg_w™h_sÿlšg
(
£lf
):

40 
boxes
 = [[10.0, 10.0, 20.0, 15.0], [0.2, 0.1, 0.5, 0.4]]

41 
ªchÜs
 = [[15.0, 12.0, 30.0, 18.0], [0.1, 0.0, 0.7, 0.9]]

42 
sÿË_çùÜs
 = [2, 3, 4, 5]

43 
ex³ùed_»l_codes
 = [[-1., -1.25, -1.62186, -0.911608],

45 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
boxes
))

46 
ªchÜs
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
ªchÜs
))

47 
cod”
 = 
ç¡”_rún_box_cod”
.
	$Fa¡”RúnBoxCod”
(

48 
sÿË_çùÜs
=scale_factors)

49 
»l_codes
 = 
cod”
.
	$’code
(
boxes
, 
ªchÜs
)

50 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

51 
»l_codes_out
, = 
£ss
.
	$run
([
»l_codes
])

52 
£lf
.
	$as£¹AÎClo£
(
»l_codes_out
, 
ex³ùed_»l_codes
)

54 
def
 
	$‹¡_g‘_cÜ»ù_boxes_aá”_decodšg
(
£lf
):

55 
ªchÜs
 = [[15.0, 12.0, 30.0, 18.0], [0.1, 0.0, 0.7, 0.9]]

56 
»l_codes
 = [[-0.5, -0.416666, -0.405465, -0.182321],

58 
ex³ùed_boxes
 = [[10.0, 10.0, 20.0, 15.0], [0.2, 0.1, 0.5, 0.4]]

59 
ªchÜs
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
ªchÜs
))

60 
cod”
 = 
ç¡”_rún_box_cod”
.
	$Fa¡”RúnBoxCod”
()

61 
boxes
 = 
cod”
.
	$decode
(
»l_codes
, 
ªchÜs
)

62 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

63 
boxes_out
, = 
£ss
.
	`run
([
boxes
.
	`g‘
()])

64 
£lf
.
	$as£¹AÎClo£
(
boxes_out
, 
ex³ùed_boxes
)

66 
def
 
	$‹¡_g‘_cÜ»ù_boxes_aá”_decodšg_w™h_sÿlšg
(
£lf
):

67 
ªchÜs
 = [[15.0, 12.0, 30.0, 18.0], [0.1, 0.0, 0.7, 0.9]]

68 
»l_codes
 = [[-1., -1.25, -1.62186, -0.911608],

70 
sÿË_çùÜs
 = [2, 3, 4, 5]

71 
ex³ùed_boxes
 = [[10.0, 10.0, 20.0, 15.0], [0.2, 0.1, 0.5, 0.4]]

72 
ªchÜs
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
ªchÜs
))

73 
cod”
 = 
ç¡”_rún_box_cod”
.
	$Fa¡”RúnBoxCod”
(

74 
sÿË_çùÜs
=scale_factors)

75 
boxes
 = 
cod”
.
	$decode
(
»l_codes
, 
ªchÜs
)

76 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

77 
boxes_out
, = 
£ss
.
	`run
([
boxes
.
	`g‘
()])

78 
£lf
.
	$as£¹AÎClo£
(
boxes_out
, 
ex³ùed_boxes
)

80 
def
 
	$‹¡_v”y_sm®l_Width_Çn_aá”_’codšg
(
£lf
):

81 
boxes
 = [[10.0, 10.0, 10.0000001, 20.0]]

82 
ªchÜs
 = [[15.0, 12.0, 30.0, 18.0]]

83 
ex³ùed_»l_codes
 = [[-0.833333, 0., -21.128731, 0.510826]]

84 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
boxes
))

85 
ªchÜs
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
ªchÜs
))

86 
cod”
 = 
ç¡”_rún_box_cod”
.
	$Fa¡”RúnBoxCod”
()

87 
»l_codes
 = 
cod”
.
	$’code
(
boxes
, 
ªchÜs
)

88 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

89 
»l_codes_out
, = 
£ss
.
	$run
([
»l_codes
])

90 
£lf
.
	$as£¹AÎClo£
(
»l_codes_out
, 
ex³ùed_»l_codes
)

93 
__Çme__
 == '__main__':

94 
tf
.
‹¡
.
	`maš
()

	@box_coders/keypoint_box_coder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
The
 
keypošt
 
box
 
cod”
 
fŞlows
 
the
 
codšg
 
schema
 
desüibed
 
	$b–ow
 (
this
 
is


19 
sim¬
 
to
 
the
 
Fa¡”RúnBoxCod”
, 
exû±
 
th©
 
™
 
’codes
 
keypošts
 
š
 
add™iÚ


20 
to
 
box
 
coÜdš©es
):

21 
ty
 = (
y
 - 
ya
è/ 
ha


22 
tx
 = (
x
 - 
xa
è/ 
wa


23 
th
 = 
	`log
(
h
 / 
ha
)

24 
tw
 = 
	`log
(
w
 / 
wa
)

25 
tky0
 = (
ky0
 - 
ya
è/ 
ha


26 
tkx0
 = (
kx0
 - 
xa
è/ 
ha


27 
tky1
 = (
ky1
 - 
ya
è/ 
ha


28 
tkx1
 = (
kx1
 - 
xa
è/ 
ha


30 
wh”e
 
x
, 
y
, 
w
, 
h
 
d’Ùe
 
the
 
box
's center coordinates, width‡nd height

31 
»¥eùiv–y
. 
Sim¬ly
, 
xa
, 
ya
, 
wa
, 
ha
 
d’Ùe
 
the
 
ªchÜ
's center

32 
coÜdš©es
, 
width
 
ªd
 
height
. 
tx
, 
ty
, 
tw
‡nd 
th
 
d’Ùe
 
the
 
ªchÜ
-
’coded


33 
ûÁ”
, 
width
 
ªd
 
height
 
»¥eùiv–y
. 
ky0
, 
kx0
, 
ky1
, 
kx1
, ... 
d’Ùe
 
the


34 
keypošts
' coordinates,‡ndky0,kx0,ky1,kx1, ... denotehe

35 
ªchÜ
-
’coded
 
keypošt
 
coÜdš©es
.

38 
impÜt
 
‹nsÜæow
 
as
 
tf


40 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_cod”


41 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


42 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
¡ªd¬d_f›lds
 
as
 
f›lds


44 
EPSILON
 = 1e-8

47 
şass
 
	$KeypoštBoxCod”
(
box_cod”
.
BoxCod”
):

50 
def
 
	$__š™__
(
£lf
, 
num_keypošts
, 
sÿË_çùÜs
=
NÚe
):

53 
Args
:

54 
num_keypošts
: 
Numb”
 
of
 
keypošts
 
to
 
’code
/
decode
.

55 
sÿË_çùÜs
: 
Li¡
 
of
 4 
pos™ive
 
sÿÏrs
 
to
 
sÿË
 
ty
, 
tx
, 
th
 
ªd
 
tw
.

56 
In
 
add™iÚ
 
to
 
sÿlšg
 
ty
 
ªd
 
tx
, 
the
 
fœ¡
 2 
sÿÏrs
 
¬e
 
u£d
Ø
sÿË


57 
the
 
y
 
ªd
 
x
 
coÜdš©es
 
of
h
keypošts
 
as
 
w–l
. 
If
 
£t
 
to
 
NÚe
, 
dÛs


58 
nÙ
 
³rfÜm
 
sÿlšg
.

60 
£lf
.
_num_keypošts
 = 
num_keypošts


62 
sÿË_çùÜs
:

63 
as£¹
 
	`Ën
(
sÿË_çùÜs
) == 4

64 
sÿÏr
 
š
 
sÿË_çùÜs
:

65 
as£¹
 
sÿÏr
 > 0

66 
£lf
.
_sÿË_çùÜs
 = 
sÿË_çùÜs


67 
£lf
.
_keypošt_sÿË_çùÜs
 = 
NÚe


68 
sÿË_çùÜs
 
is
 
nÙ
 
NÚe
:

69 
£lf
.
_keypošt_sÿË_çùÜs
 = 
tf
.
	`ex·nd_dims
Ñf.
	`te
(

70 [
tf
.
	`to_æßt
(
sÿË_çùÜs
[0]),f.to_float(scale_factors[1])],

71 [
num_keypošts
]), 1)

73 @
´İ”ty


74 
def
 
	$code_size
(
£lf
):

75  4 + 
£lf
.
_num_keypošts
 * 2

77 
def
 
	$_’code
(
£lf
, 
boxes
, 
ªchÜs
):

80 
Args
:

81 
boxes
: 
BoxLi¡
 
hŞdšg
 
N
 boxe 
ªd
 
keypošts
 
to
 
be
 
’coded
. 
Boxes
 
¬e


82 
‹nsÜs
 
w™h
 
the
 
sh­e
 [
N
, 4], 
ªd
 
keypošts
 
¬e
ensors withhe shape

83 [
N
, 
num_keypošts
, 2].

84 
ªchÜs
: 
BoxLi¡
 
of
‡nchors.

86 
R‘uºs
:

87 
a
 
‹nsÜ
 
»´e£Ášg
 
N
 
ªchÜ
-
’coded
 
boxes
 
of
 
the
 
fÜm©


88 [
ty
, 
tx
, 
th
, 
tw
, 
tky0
, 
tkx0
, 
tky1
, 
tkx1
, ...] 
wh”e
ky0 
ªd
kx0

89 
»´e£Á
 
the
 
y
 
ªd
 
x
 
coÜdš©es
 
of
h
fœ¡
 
keypošt
, 
tky1
‡nd 
tkx1


90 
»´e£Á
 
the
 
y
 
ªd
 
x
 
coÜdš©es
 
of
h
£cÚd
 
keypošt
,‡nd 
so
 
Ú
.

92 #CÚv”ˆ
ªchÜs
 
to
 
the
 
ûÁ”
 
coÜdš©e
 
»´e£Á©iÚ
.

93 
yûÁ”_a
, 
xûÁ”_a
, 
ha
, 
wa
 = 
ªchÜs
.
	$g‘_ûÁ”_coÜdš©es_ªd_sizes
()

94 
yûÁ”
, 
xûÁ”
, 
h
, 
w
 = 
boxes
.
	$g‘_ûÁ”_coÜdš©es_ªd_sizes
()

95 
keypošts
 = 
boxes
.
	$g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
keypošts
)

96 
keypošts
 = 
tf
.
	`Œª¥o£
Ñf.
	`»sh­e
(keypoints,

97 [-1, 
£lf
.
_num_keypošts
 * 2]))

98 
num_boxes
 = 
boxes
.
	$num_boxes
()

100 #Avoid 
NaN
 
š
 
divisiÚ
 
ªd
 
log
 
b–ow
.

101 
ha
 +ğ
EPSILON


102 
wa
 +ğ
EPSILON


103 
h
 +ğ
EPSILON


104 
w
 +ğ
EPSILON


106 
tx
 = (
xûÁ”
 - 
xûÁ”_a
è/ 
wa


107 
ty
 = (
yûÁ”
 - 
yûÁ”_a
è/ 
ha


108 
tw
 = 
tf
.
	`log
(
w
 / 
wa
)

109 
th
 = 
tf
.
	`log
(
h
 / 
ha
)

111 
ted_ªchÜ_ûÁ”s
 = 
tf
.
	`te
(

112 
tf
.
	`¡ack
([
yûÁ”_a
, 
xûÁ”_a
]), [
£lf
.
_num_keypošts
, 1])

113 
ted_ªchÜ_sizes
 = 
tf
.
	`te
(

114 
tf
.
	`¡ack
([
ha
, 
wa
]), [
£lf
.
_num_keypošts
, 1])

115 
tkeypošts
 = (
keypošts
 - 
ted_ªchÜ_ûÁ”s
è/ 
ted_ªchÜ_sizes


117 #SÿË 
loÿtiÚ
 
rg‘s
 
as
 
u£d
 
š
 
·³r
 
jošt
 
Œaššg
.

118 
£lf
.
_sÿË_çùÜs
:

119 
ty
 *ğ
£lf
.
_sÿË_çùÜs
[0]

120 
tx
 *ğ
£lf
.
_sÿË_çùÜs
[1]

121 
th
 *ğ
£lf
.
_sÿË_çùÜs
[2]

122 
tw
 *ğ
£lf
.
_sÿË_çùÜs
[3]

123 
tkeypošts
 *ğ
tf
.
	$te
(
£lf
.
_keypošt_sÿË_çùÜs
, [1, 
num_boxes
])

125 
tboxes
 = 
tf
.
	$¡ack
([
ty
, 
tx
, 
th
, 
tw
])

126  
tf
.
	`Œª¥o£
Ñf.
	$cÚÿt
([
tboxes
, 
tkeypošts
], 0))

128 
def
 
	$_decode
(
£lf
, 
»l_codes
, 
ªchÜs
):

131 
Args
:

132 
»l_codes
: 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
N
, 4 + 2 * 
num_keypošts
] 
»´e£Ášg
 N

133 
ªchÜ
-
’coded
 
boxes
 
ªd
 
keypošts


134 
ªchÜs
: 
BoxLi¡
 
of
‡nchors.

136 
R‘uºs
:

137 
boxes
: 
BoxLi¡
 
hŞdšg
 
N
 
boundšg
 boxe 
ªd
 
keypošts
.

139 
yûÁ”_a
, 
xûÁ”_a
, 
ha
, 
wa
 = 
ªchÜs
.
	$g‘_ûÁ”_coÜdš©es_ªd_sizes
()

141 
num_codes
 = 
tf
.
	`sh­e
(
»l_codes
)[0]

142 
»suÉ
 = 
tf
.
	`un¡ack
Ñf.
	$Œª¥o£
(
»l_codes
))

143 
ty
, 
tx
, 
th
, 
tw
 = 
»suÉ
[:4]

144 
tkeypošts
 = 
»suÉ
[4:]

145 
£lf
.
_sÿË_çùÜs
:

146 
ty
 /ğ
£lf
.
_sÿË_çùÜs
[0]

147 
tx
 /ğ
£lf
.
_sÿË_çùÜs
[1]

148 
th
 /ğ
£lf
.
_sÿË_çùÜs
[2]

149 
tw
 /ğ
£lf
.
_sÿË_çùÜs
[3]

150 
tkeypošts
 /ğ
tf
.
	$te
(
£lf
.
_keypošt_sÿË_çùÜs
, [1, 
num_codes
])

152 
w
 = 
tf
.
	`exp
(
tw
è* 
wa


153 
h
 = 
tf
.
	`exp
(
th
è* 
ha


154 
yûÁ”
 = 
ty
 * 
ha
 + 
yûÁ”_a


155 
xûÁ”
 = 
tx
 * 
wa
 + 
xûÁ”_a


156 
ymš
 = 
yûÁ”
 - 
h
 / 2.

157 
xmš
 = 
xûÁ”
 - 
w
 / 2.

158 
ymax
 = 
yûÁ”
 + 
h
 / 2.

159 
xmax
 = 
xûÁ”
 + 
w
 / 2.

160 
decoded_boxes_keypošts
 = 
box_li¡
.
	`BoxLi¡
(

161 
tf
.
	`Œª¥o£
Ñf.
	$¡ack
([
ymš
, 
xmš
, 
ymax
, 
xmax
])))

163 
ted_ªchÜ_ûÁ”s
 = 
tf
.
	`te
(

164 
tf
.
	`¡ack
([
yûÁ”_a
, 
xûÁ”_a
]), [
£lf
.
_num_keypošts
, 1])

165 
ted_ªchÜ_sizes
 = 
tf
.
	`te
(

166 
tf
.
	`¡ack
([
ha
, 
wa
]), [
£lf
.
_num_keypošts
, 1])

167 
keypošts
 = 
tkeypošts
 * 
ted_ªchÜ_sizes
 + 
ted_ªchÜ_ûÁ”s


168 
keypošts
 = 
tf
.
	`»sh­e
Ñf.
	`Œª¥o£
(keypoints),

169 [-1, 
£lf
.
_num_keypošts
, 2])

170 
decoded_boxes_keypošts
.
	$add_f›ld
(
f›lds
.
BoxLi¡F›lds
.
keypošts
, keypoints)

171  
decoded_boxes_keypošts


	@box_coders/keypoint_box_coder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
box_cod”s
 
impÜt
 
keypošt_box_cod”


21 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


22 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
¡ªd¬d_f›lds
 
as
 
f›lds


25 
şass
 
	$KeypoštBoxCod”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

27 
def
 
	$‹¡_g‘_cÜ»ù_»Ïtive_codes_aá”_’codšg
(
£lf
):

28 
boxes
 = [[10., 10., 20., 15.],

30 
keypošts
 = [[[15., 12.], [10., 15.]],

32 
num_keypošts
 = 
	$Ën
(
keypošts
[0])

33 
ªchÜs
 = [[15., 12., 30., 18.],

35 
ex³ùed_»l_codes
 = [

41 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
boxes
))

42 
boxes
.
	`add_f›ld
(
f›lds
.
BoxLi¡F›lds
.
keypošts
, 
tf
.
	$cÚ¡ªt
(
keypošts
))

43 
ªchÜs
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
ªchÜs
))

44 
cod”
 = 
keypošt_box_cod”
.
	$KeypoštBoxCod”
(
num_keypošts
)

45 
»l_codes
 = 
cod”
.
	$’code
(
boxes
, 
ªchÜs
)

46 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

47 
»l_codes_out
, = 
£ss
.
	$run
([
»l_codes
])

48 
£lf
.
	$as£¹AÎClo£
(
»l_codes_out
, 
ex³ùed_»l_codes
)

50 
def
 
	$‹¡_g‘_cÜ»ù_»Ïtive_codes_aá”_’codšg_w™h_sÿlšg
(
£lf
):

51 
boxes
 = [[10., 10., 20., 15.],

53 
keypošts
 = [[[15., 12.], [10., 15.]],

55 
num_keypošts
 = 
	$Ën
(
keypošts
[0])

56 
ªchÜs
 = [[15., 12., 30., 18.],

58 
sÿË_çùÜs
 = [2, 3, 4, 5]

59 
ex³ùed_»l_codes
 = [

65 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
boxes
))

66 
boxes
.
	`add_f›ld
(
f›lds
.
BoxLi¡F›lds
.
keypošts
, 
tf
.
	$cÚ¡ªt
(
keypošts
))

67 
ªchÜs
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
ªchÜs
))

68 
cod”
 = 
keypošt_box_cod”
.
	$KeypoštBoxCod”
(

69 
num_keypošts
, 
sÿË_çùÜs
=scale_factors)

70 
»l_codes
 = 
cod”
.
	$’code
(
boxes
, 
ªchÜs
)

71 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

72 
»l_codes_out
, = 
£ss
.
	$run
([
»l_codes
])

73 
£lf
.
	$as£¹AÎClo£
(
»l_codes_out
, 
ex³ùed_»l_codes
)

75 
def
 
	$‹¡_g‘_cÜ»ù_boxes_aá”_decodšg
(
£lf
):

76 
ªchÜs
 = [[15., 12., 30., 18.],

78 
»l_codes
 = [

84 
ex³ùed_boxes
 = [[10., 10., 20., 15.],

86 
ex³ùed_keypošts
 = [[[15., 12.], [10., 15.]],

88 
num_keypošts
 = 
	$Ën
(
ex³ùed_keypošts
[0])

89 
ªchÜs
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
ªchÜs
))

90 
cod”
 = 
keypošt_box_cod”
.
	$KeypoštBoxCod”
(
num_keypošts
)

91 
boxes
 = 
cod”
.
	$decode
(
»l_codes
, 
ªchÜs
)

92 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

93 
boxes_out
, 
keypošts_out
 = 
£ss
.
	`run
(

94 [
boxes
.
	`g‘
(), boxes.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
keypošts
)])

95 
£lf
.
	$as£¹AÎClo£
(
boxes_out
, 
ex³ùed_boxes
)

96 
£lf
.
	$as£¹AÎClo£
(
keypošts_out
, 
ex³ùed_keypošts
)

98 
def
 
	$‹¡_g‘_cÜ»ù_boxes_aá”_decodšg_w™h_sÿlšg
(
£lf
):

99 
ªchÜs
 = [[15., 12., 30., 18.],

101 
»l_codes
 = [

107 
sÿË_çùÜs
 = [2, 3, 4, 5]

108 
ex³ùed_boxes
 = [[10., 10., 20., 15.],

110 
ex³ùed_keypošts
 = [[[15., 12.], [10., 15.]],

112 
num_keypošts
 = 
	$Ën
(
ex³ùed_keypošts
[0])

113 
ªchÜs
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
ªchÜs
))

114 
cod”
 = 
keypošt_box_cod”
.
	$KeypoštBoxCod”
(

115 
num_keypošts
, 
sÿË_çùÜs
=scale_factors)

116 
boxes
 = 
cod”
.
	$decode
(
»l_codes
, 
ªchÜs
)

117 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

118 
boxes_out
, 
keypošts_out
 = 
£ss
.
	`run
(

119 [
boxes
.
	`g‘
(), boxes.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
keypošts
)])

120 
£lf
.
	$as£¹AÎClo£
(
boxes_out
, 
ex³ùed_boxes
)

121 
£lf
.
	$as£¹AÎClo£
(
keypošts_out
, 
ex³ùed_keypošts
)

123 
def
 
	$‹¡_v”y_sm®l_width_Çn_aá”_’codšg
(
£lf
):

124 
boxes
 = [[10., 10., 10.0000001, 20.]]

125 
keypošts
 = [[[10., 10.], [10.0000001, 20.]]]

126 
ªchÜs
 = [[15., 12., 30., 18.]]

127 
ex³ùed_»l_codes
 = [[-0.833333, 0., -21.128731, 0.510826,

129 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
boxes
))

130 
boxes
.
	`add_f›ld
(
f›lds
.
BoxLi¡F›lds
.
keypošts
, 
tf
.
	$cÚ¡ªt
(
keypošts
))

131 
ªchÜs
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
ªchÜs
))

132 
cod”
 = 
keypošt_box_cod”
.
	$KeypoštBoxCod”
(2)

133 
»l_codes
 = 
cod”
.
	$’code
(
boxes
, 
ªchÜs
)

134 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

135 
»l_codes_out
, = 
£ss
.
	$run
([
»l_codes
])

136 
£lf
.
	$as£¹AÎClo£
(
»l_codes_out
, 
ex³ùed_»l_codes
)

139 
__Çme__
 == '__main__':

140 
tf
.
‹¡
.
	`maš
()

	@box_coders/mean_stddev_box_coder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
This
 
box
 
cod”
 
u£
 
the
 
fŞlowšg
 
codšg
 
schema
 
to
 
’code
 
	gboxes
:

19 
»l_code
 = (
box_cÜÃr
 - 
ªchÜ_cÜÃr_m—n
è/ 
ªchÜ_cÜÃr_¡ddev
.

21 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_cod”


22 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


25 
şass
 
	$M—nStddevBoxCod”
(
box_cod”
.
BoxCod”
):

28 @
´İ”ty


29 
def
 
	$code_size
(
£lf
):

32 
def
 
	$_’code
(
£lf
, 
boxes
, 
ªchÜs
):

35 
Args
:

36 
boxes
: 
BoxLi¡
 
hŞdšg
 
N
 boxe 
to
 
be
 
’coded
.

37 
ªchÜs
: 
BoxLi¡
 
of
 
N
‡nchÜs. 
We
 
assume
 
th©
‡nchÜ 
has
 
ª
 
assocŸ‹d


38 
¡ddev
 
f›ld
.

40 
R‘uºs
:

41 
a
 
‹nsÜ
 
»´e£Ášg
 
N
 
ªchÜ
-
’coded
 
boxes


42 
Rai£s
:

43 
V®ueE¼Ü
: 
the
 
ªchÜs
 
BoxLi¡
 
dÛs
 
nÙ
 
have
 
a
 
¡ddev
 
f›ld


45 
nÙ
 
ªchÜs
.
	`has_f›ld
('stddev'):

46 
¿i£
 
	`V®ueE¼Ü
('anchors must have‡ stddev field')

47 
box_cÜÃrs
 = 
boxes
.
	$g‘
()

48 
m—ns
 = 
ªchÜs
.
	$g‘
()

49 
¡ddev
 = 
ªchÜs
.
	`g‘_f›ld
('stddev')

50  (
box_cÜÃrs
 - 
m—ns
è/ 
¡ddev


52 
def
 
	$_decode
(
£lf
, 
»l_codes
, 
ªchÜs
):

55 
Args
:

56 
»l_codes
: 
a
 
‹nsÜ
 
»´e£Ášg
 
N
 
ªchÜ
-
’coded
 
boxes
.

57 
ªchÜs
: 
BoxLi¡
 
of
‡nchÜs. 
We
 
assume
 
th©
‡nchÜ 
has
 
ª
 
assocŸ‹d


58 
¡ddev
 
f›ld
.

60 
R‘uºs
:

61 
boxes
: 
BoxLi¡
 
hŞdšg
 
N
 
boundšg
 boxes

62 
Rai£s
:

63 
V®ueE¼Ü
: 
the
 
ªchÜs
 
BoxLi¡
 
dÛs
 
nÙ
 
have
 
a
 
¡ddev
 
f›ld


65 
nÙ
 
ªchÜs
.
	`has_f›ld
('stddev'):

66 
¿i£
 
	`V®ueE¼Ü
('anchors must have‡ stddev field')

67 
m—ns
 = 
ªchÜs
.
	$g‘
()

68 
¡ddevs
 = 
ªchÜs
.
	`g‘_f›ld
('stddev')

69 
box_cÜÃrs
 = 
»l_codes
 * 
¡ddevs
 + 
m—ns


70  
box_li¡
.
	`BoxLi¡
(
box_cÜÃrs
)

	@box_coders/mean_stddev_box_coder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
box_cod”s
 
impÜt
 
m—n_¡ddev_box_cod”


21 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


24 
şass
 
	$M—nStddevBoxCod”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$‹¡G‘CÜ»ùR–©iveCodesAá”Encodšg
(
£lf
):

27 
box_cÜÃrs
 = [[0.0, 0.0, 0.5, 0.5], [0.0, 0.0, 0.5, 0.5]]

28 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
box_cÜÃrs
))

29 
ex³ùed_»l_codes
 = [[0.0, 0.0, 0.0, 0.0], [-5.0, -5.0, -5.0, -3.0]]

30 
´iÜ_m—ns
 = 
tf
.
	$cÚ¡ªt
([[0.0, 0.0, 0.5, 0.5], [0.5, 0.5, 1.0, 0.8]])

31 
´iÜ_¡ddevs
 = 
tf
.
	$cÚ¡ªt
(2 * [4 * [.1]])

32 
´iÜs
 = 
box_li¡
.
	$BoxLi¡
(
´iÜ_m—ns
)

33 
´iÜs
.
	`add_f›ld
('¡ddev', 
´iÜ_¡ddevs
)

35 
cod”
 = 
m—n_¡ddev_box_cod”
.
	$M—nStddevBoxCod”
()

36 
»l_codes
 = 
cod”
.
	$’code
(
boxes
, 
´iÜs
)

37 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

38 
»l_codes_out
 = 
£ss
.
	$run
(
»l_codes
)

39 
£lf
.
	$as£¹AÎClo£
(
»l_codes_out
, 
ex³ùed_»l_codes
)

41 
def
 
	$‹¡G‘CÜ»ùBoxesAá”Decodšg
(
£lf
):

42 
»l_codes
 = 
tf
.
	`cÚ¡ªt
([[0.0, 0.0, 0.0, 0.0], [-5.0, -5.0, -5.0, -3.0]])

43 
ex³ùed_box_cÜÃrs
 = [[0.0, 0.0, 0.5, 0.5], [0.0, 0.0, 0.5, 0.5]]

44 
´iÜ_m—ns
 = 
tf
.
	$cÚ¡ªt
([[0.0, 0.0, 0.5, 0.5], [0.5, 0.5, 1.0, 0.8]])

45 
´iÜ_¡ddevs
 = 
tf
.
	$cÚ¡ªt
(2 * [4 * [.1]])

46 
´iÜs
 = 
box_li¡
.
	$BoxLi¡
(
´iÜ_m—ns
)

47 
´iÜs
.
	`add_f›ld
('¡ddev', 
´iÜ_¡ddevs
)

49 
cod”
 = 
m—n_¡ddev_box_cod”
.
	$M—nStddevBoxCod”
()

50 
decoded_boxes
 = 
cod”
.
	$decode
(
»l_codes
, 
´iÜs
)

51 
decoded_box_cÜÃrs
 = 
decoded_boxes
.
	$g‘
()

52 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

53 
decoded_out
 = 
£ss
.
	$run
(
decoded_box_cÜÃrs
)

54 
£lf
.
	$as£¹AÎClo£
(
decoded_out
, 
ex³ùed_box_cÜÃrs
)

57 
__Çme__
 == '__main__':

58 
tf
.
‹¡
.
	`maš
()

	@box_coders/square_box_coder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
Squ¬e
 
box
 
cod”
 
fŞlows
 
the
 
codšg
 
schema
 
desüibed
 
	gb–ow
:

19 
l
 = 
	$sq¹
(
h
 * 
w
)

20 
Ï
 = 
	$sq¹
(
ha
 * 
wa
)

21 
ty
 = (
y
 - 
ya
è/ 
Ï


22 
tx
 = (
x
 - 
xa
è/ 
Ï


23 

 = 
	`log
(
l
 / 
Ï
)

24 
wh”e
 
x
, 
y
, 
w
, 
h
 
d’Ùe
 
the
 
box
's center coordinates, width,‡nd height,

25 
»¥eùiv–y
. 
Sim¬ly
, 
xa
, 
ya
, 
wa
, 
ha
 
d’Ùe
 
the
 
ªchÜ
's center

26 
coÜdš©es
, 
width
 
ªd
 
height
. 
tx
, 
ty
, 

 
d’Ùe
 
the
 
ªchÜ
-
’coded


27 
ûÁ”
, 
ªd
 
Ëngth
, 
»¥eùiv–y
. 
Beÿu£
 
the
 
’coded
 
box
 
is
 
a
 
squ¬e
, 
Úly


28 
Úe
 
Ëngth
 
is
 
’coded
.

30 
This
 
has
 
shown
 
to
 
´ovide
 
³rfÜmªû
 
im´ovem’ts
 
ov”
 
the
 
Fa¡”
 
RCNN
 
box


31 
cod”
 
wh’
 
the
 
objeùs
 
bešg
 
d‘eùed
 
‹nd
 
to
 
be
 
	$squ¬e
 (
e
.
g
. 
çûs
è
ªd
 
wh’


32 
the
 
šput
 
images
 
¬e
 
nÙ
 
di¡Ü‹d
 
vŸ
 
»sizšg
.

35 
impÜt
 
‹nsÜæow
 
as
 
tf


37 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_cod”


38 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


40 
EPSILON
 = 1e-8

43 
şass
 
	$Squ¬eBoxCod”
(
box_cod”
.
BoxCod”
):

46 
def
 
	$__š™__
(
£lf
, 
sÿË_çùÜs
=
NÚe
):

49 
Args
:

50 
sÿË_çùÜs
: 
Li¡
 
of
 3 
pos™ive
 
sÿÏrs
 
to
 
sÿË
 
ty
, 
tx
, 
ªd
 

.

51 
If
 
£t
 
to
 
NÚe
, 
dÛs
 
nÙ
 
³rfÜm
 
sÿlšg
. 
FÜ
 
ç¡”
 
RCNN
,

52 
the
 
İ’
-
sourû
 
im¶em’tiÚ
 
»comm’ds
 
usšg
 [10.0, 10.0, 5.0].

54 
Rai£s
:

55 
V®ueE¼Ü
: 
If
 
sÿË_çùÜs
 
is
 
nÙ
 
Ëngth
 3 
Ü
 
cÚšs
 
v®ues
 
Ëss
 
thª


56 
Ü
 
equ®
 
to
 0.

58 
sÿË_çùÜs
:

59 
	`Ën
(
sÿË_çùÜs
) != 3:

60 
¿i£
 
	`V®ueE¼Ü
('The‡rgument scale_factors must be‡†ist of†ength '

62 
	`ªy
(
sÿÏr
 <ğ0 sÿÏ¸
š
 
sÿË_çùÜs
):

63 
¿i£
 
	`V®ueE¼Ü
('The values in scale_factors must‡ll be greater '

65 
£lf
.
_sÿË_çùÜs
 = 
sÿË_çùÜs


67 @
´İ”ty


68 
def
 
	$code_size
(
£lf
):

71 
def
 
	$_’code
(
£lf
, 
boxes
, 
ªchÜs
):

74 
Args
:

75 
boxes
: 
BoxLi¡
 
hŞdšg
 
N
 boxe 
to
 
be
 
’coded
.

76 
ªchÜs
: 
BoxLi¡
 
of
‡nchors.

78 
R‘uºs
:

79 
a
 
‹nsÜ
 
»´e£Ášg
 
N
 
ªchÜ
-
’coded
 
boxes
 
of
 
the
 
fÜm©


80 [
ty
, 
tx
, 

].

82 #CÚv”ˆ
ªchÜs
 
to
 
the
 
ûÁ”
 
coÜdš©e
 
»´e£Á©iÚ
.

83 
yûÁ”_a
, 
xûÁ”_a
, 
ha
, 
wa
 = 
ªchÜs
.
	$g‘_ûÁ”_coÜdš©es_ªd_sizes
()

84 
Ï
 = 
tf
.
	$sq¹
(
ha
 * 
wa
)

85 
yûÁ”
, 
xûÁ”
, 
h
, 
w
 = 
boxes
.
	$g‘_ûÁ”_coÜdš©es_ªd_sizes
()

86 
l
 = 
tf
.
	$sq¹
(
h
 * 
w
)

87 #Avoid 
NaN
 
š
 
divisiÚ
 
ªd
 
log
 
b–ow
.

88 
Ï
 +ğ
EPSILON


89 
l
 +ğ
EPSILON


91 
tx
 = (
xûÁ”
 - 
xûÁ”_a
è/ 
Ï


92 
ty
 = (
yûÁ”
 - 
yûÁ”_a
è/ 
Ï


93 

 = 
tf
.
	`log
(
l
 / 
Ï
)

94 #SÿË 
loÿtiÚ
 
rg‘s
 
jošt
 
Œaššg
.

95 
£lf
.
_sÿË_çùÜs
:

96 
ty
 *ğ
£lf
.
_sÿË_çùÜs
[0]

97 
tx
 *ğ
£lf
.
_sÿË_çùÜs
[1]

98 

 *ğ
£lf
.
_sÿË_çùÜs
[2]

99  
tf
.
	`Œª¥o£
Ñf.
	$¡ack
([
ty
, 
tx
, 

]))

101 
def
 
	$_decode
(
£lf
, 
»l_codes
, 
ªchÜs
):

104 
Args
:

105 
»l_codes
: 
a
 
‹nsÜ
 
»´e£Ášg
 
N
 
ªchÜ
-
’coded
 
boxes
.

106 
ªchÜs
: 
BoxLi¡
 
of
‡nchors.

108 
R‘uºs
:

109 
boxes
: 
BoxLi¡
 
hŞdšg
 
N
 
boundšg
 boxes.

111 
yûÁ”_a
, 
xûÁ”_a
, 
ha
, 
wa
 = 
ªchÜs
.
	$g‘_ûÁ”_coÜdš©es_ªd_sizes
()

112 
Ï
 = 
tf
.
	$sq¹
(
ha
 * 
wa
)

114 
ty
, 
tx
, 

 = 
tf
.
	`un¡ack
Ñf.
	$Œª¥o£
(
»l_codes
))

115 
£lf
.
_sÿË_çùÜs
:

116 
ty
 /ğ
£lf
.
_sÿË_çùÜs
[0]

117 
tx
 /ğ
£lf
.
_sÿË_çùÜs
[1]

118 

 /ğ
£lf
.
_sÿË_çùÜs
[2]

119 
l
 = 
tf
.
	`exp
(

è* 
Ï


120 
yûÁ”
 = 
ty
 * 
Ï
 + 
yûÁ”_a


121 
xûÁ”
 = 
tx
 * 
Ï
 + 
xûÁ”_a


122 
ymš
 = 
yûÁ”
 - 
l
 / 2.

123 
xmš
 = 
xûÁ”
 - 
l
 / 2.

124 
ymax
 = 
yûÁ”
 + 
l
 / 2.

125 
xmax
 = 
xûÁ”
 + 
l
 / 2.

126  
box_li¡
.
	`BoxLi¡
(
tf
.
	`Œª¥o£
Ñf.
	`¡ack
([
ymš
, 
xmš
, 
ymax
, 
xmax
])))

	@box_coders/square_box_coder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
box_cod”s
 
impÜt
 
squ¬e_box_cod”


21 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


24 
şass
 
	$Squ¬eBoxCod”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$‹¡_cÜ»ù_»Ïtive_codes_w™h_deçuÉ_sÿË
(
£lf
):

27 
boxes
 = [[10.0, 10.0, 20.0, 15.0], [0.2, 0.1, 0.5, 0.4]]

28 
ªchÜs
 = [[15.0, 12.0, 30.0, 18.0], [0.1, 0.0, 0.7, 0.9]]

29 
sÿË_çùÜs
 = 
NÚe


30 
ex³ùed_»l_codes
 = [[-0.790569, -0.263523, -0.293893],

33 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
boxes
))

34 
ªchÜs
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
ªchÜs
))

35 
cod”
 = 
squ¬e_box_cod”
.
	$Squ¬eBoxCod”
(
sÿË_çùÜs
=scale_factors)

36 
»l_codes
 = 
cod”
.
	$’code
(
boxes
, 
ªchÜs
)

37 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

38 (
»l_codes_out
,èğ
£ss
.
	$run
([
»l_codes
])

39 
£lf
.
	$as£¹AÎClo£
(
»l_codes_out
, 
ex³ùed_»l_codes
)

41 
def
 
	$‹¡_cÜ»ù_»Ïtive_codes_w™h_nÚ_deçuÉ_sÿË
(
£lf
):

42 
boxes
 = [[10.0, 10.0, 20.0, 15.0], [0.2, 0.1, 0.5, 0.4]]

43 
ªchÜs
 = [[15.0, 12.0, 30.0, 18.0], [0.1, 0.0, 0.7, 0.9]]

44 
sÿË_çùÜs
 = [2, 3, 4]

45 
ex³ùed_»l_codes
 = [[-1.581139, -0.790569, -1.175573],

47 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
boxes
))

48 
ªchÜs
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
ªchÜs
))

49 
cod”
 = 
squ¬e_box_cod”
.
	$Squ¬eBoxCod”
(
sÿË_çùÜs
=scale_factors)

50 
»l_codes
 = 
cod”
.
	$’code
(
boxes
, 
ªchÜs
)

51 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

52 (
»l_codes_out
,èğ
£ss
.
	$run
([
»l_codes
])

53 
£lf
.
	$as£¹AÎClo£
(
»l_codes_out
, 
ex³ùed_»l_codes
)

55 
def
 
	$‹¡_cÜ»ù_»Ïtive_codes_w™h_sm®l_width
(
£lf
):

56 
boxes
 = [[10.0, 10.0, 10.0000001, 20.0]]

57 
ªchÜs
 = [[15.0, 12.0, 30.0, 18.0]]

58 
sÿË_çùÜs
 = 
NÚe


59 
ex³ùed_»l_codes
 = [[-1.317616, 0., -20.670586]]

60 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
boxes
))

61 
ªchÜs
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
ªchÜs
))

62 
cod”
 = 
squ¬e_box_cod”
.
	$Squ¬eBoxCod”
(
sÿË_çùÜs
=scale_factors)

63 
»l_codes
 = 
cod”
.
	$’code
(
boxes
, 
ªchÜs
)

64 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

65 (
»l_codes_out
,èğ
£ss
.
	$run
([
»l_codes
])

66 
£lf
.
	$as£¹AÎClo£
(
»l_codes_out
, 
ex³ùed_»l_codes
)

68 
def
 
	$‹¡_cÜ»ù_boxes_w™h_deçuÉ_sÿË
(
£lf
):

69 
ªchÜs
 = [[15.0, 12.0, 30.0, 18.0], [0.1, 0.0, 0.7, 0.9]]

70 
»l_codes
 = [[-0.5, -0.416666, -0.405465],

72 
sÿË_çùÜs
 = 
NÚe


73 
ex³ùed_boxes
 = [[14.594306, 7.884875, 20.918861, 14.209432],

75 
ªchÜs
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
ªchÜs
))

76 
cod”
 = 
squ¬e_box_cod”
.
	$Squ¬eBoxCod”
(
sÿË_çùÜs
=scale_factors)

77 
boxes
 = 
cod”
.
	$decode
(
»l_codes
, 
ªchÜs
)

78 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

79 (
boxes_out
,èğ
£ss
.
	`run
([
boxes
.
	`g‘
()])

80 
£lf
.
	$as£¹AÎClo£
(
boxes_out
, 
ex³ùed_boxes
)

82 
def
 
	$‹¡_cÜ»ù_boxes_w™h_nÚ_deçuÉ_sÿË
(
£lf
):

83 
ªchÜs
 = [[15.0, 12.0, 30.0, 18.0], [0.1, 0.0, 0.7, 0.9]]

84 
»l_codes
 = [[-1., -1.25, -1.62186], [-0.166667, -0.666667, -2.772588]]

85 
sÿË_çùÜs
 = [2, 3, 4]

86 
ex³ùed_boxes
 = [[14.594306, 7.884875, 20.918861, 14.209432],

88 
ªchÜs
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
ªchÜs
))

89 
cod”
 = 
squ¬e_box_cod”
.
	$Squ¬eBoxCod”
(
sÿË_çùÜs
=scale_factors)

90 
boxes
 = 
cod”
.
	$decode
(
»l_codes
, 
ªchÜs
)

91 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

92 (
boxes_out
,èğ
£ss
.
	`run
([
boxes
.
	`g‘
()])

93 
£lf
.
	$as£¹AÎClo£
(
boxes_out
, 
ex³ùed_boxes
)

96 
__Çme__
 == '__main__':

97 
tf
.
‹¡
.
	`maš
()

	@builders/__init__.py

	@builders/anchor_generator_builder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
äom
 
	gobjeù_d‘eùiÚ
.
ªchÜ_g’”©Üs
 
impÜt
 
grid_ªchÜ_g’”©Ü


19 
äom
 
	gobjeù_d‘eùiÚ
.
ªchÜ_g’”©Üs
 
impÜt
 
muÉË_grid_ªchÜ_g’”©Ü


20 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
ªchÜ_g’”©Ü_pb2


23 
def
 
	$bud
(
ªchÜ_g’”©Ü_cÚfig
):

26 
Args
:

27 
ªchÜ_g’”©Ü_cÚfig
: 
An
 
ªchÜ_g’”©Ü
.
´Ùo
 
objeù
 
cÚššg
 
the


28 
cÚfig
 
the
 
desœed
 
ªchÜ
 
g’”©Ü
.

30 
R‘uºs
:

31 
AnchÜ
 
g’”©Ü
 
ba£d
 
Ú
 
the
 
cÚfig
.

33 
Rai£s
:

34 
V®ueE¼Ü
: 
On
 
em±y
 
ªchÜ
 
g’”©Ü
 
´Ùo
.

36 
nÙ
 
	$isš¡ªû
(
ªchÜ_g’”©Ü_cÚfig
,

37 
ªchÜ_g’”©Ü_pb2
.
AnchÜG’”©Ü
):

38 
¿i£
 
	`V®ueE¼Ü
('anchor_generator_config‚ot ofype '

40 
ªchÜ_g’”©Ü_cÚfig
.
	`WhichOÃof
(

42 
grid_ªchÜ_g’”©Ü_cÚfig
 = 
ªchÜ_g’”©Ü_cÚfig
.
grid_ªchÜ_g’”©Ü


43  
grid_ªchÜ_g’”©Ü
.
	`GridAnchÜG’”©Ü
(

44 
sÿËs
=[(
sÿË
èsÿË 
š
 
grid_ªchÜ_g’”©Ü_cÚfig
.scales],

45 
a¥eù_¿tios
=[(
a¥eù_¿tio
)

46 
a¥eù_¿tio


47 
š
 
grid_ªchÜ_g’”©Ü_cÚfig
.
a¥eù_¿tios
],

48 
ba£_ªchÜ_size
=[
grid_ªchÜ_g’”©Ü_cÚfig
.
height
,

49 
grid_ªchÜ_g’”©Ü_cÚfig
.
width
],

50 
ªchÜ_¡ride
=[
grid_ªchÜ_g’”©Ü_cÚfig
.
height_¡ride
,

51 
grid_ªchÜ_g’”©Ü_cÚfig
.
width_¡ride
],

52 
ªchÜ_off£t
=[
grid_ªchÜ_g’”©Ü_cÚfig
.
height_off£t
,

53 
grid_ªchÜ_g’”©Ü_cÚfig
.
width_off£t
])

54 
–if
 
ªchÜ_g’”©Ü_cÚfig
.
	`WhichOÃof
(

56 
ssd_ªchÜ_g’”©Ü_cÚfig
 = 
ªchÜ_g’”©Ü_cÚfig
.
ssd_ªchÜ_g’”©Ü


57  
muÉË_grid_ªchÜ_g’”©Ü
.
	`ü—‹_ssd_ªchÜs
(

58 
num_Ïy”s
=
ssd_ªchÜ_g’”©Ü_cÚfig
.num_layers,

59 
mš_sÿË
=
ssd_ªchÜ_g’”©Ü_cÚfig
.min_scale,

60 
max_sÿË
=
ssd_ªchÜ_g’”©Ü_cÚfig
.max_scale,

61 
a¥eù_¿tios
=
ssd_ªchÜ_g’”©Ü_cÚfig
.aspect_ratios,

62 
»duû_boxes_š_lowe¡_Ïy”
=(
ssd_ªchÜ_g’”©Ü_cÚfig


63 .
»duû_boxes_š_lowe¡_Ïy”
))

65 
¿i£
 
	`V®ueE¼Ü
('Empty‡nchor generator.')

	@builders/anchor_generator_builder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	ggoogË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


21 
äom
 
	gobjeù_d‘eùiÚ
.
ªchÜ_g’”©Üs
 
impÜt
 
grid_ªchÜ_g’”©Ü


22 
äom
 
	gobjeù_d‘eùiÚ
.
ªchÜ_g’”©Üs
 
impÜt
 
muÉË_grid_ªchÜ_g’”©Ü


23 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
ªchÜ_g’”©Ü_bud”


24 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
ªchÜ_g’”©Ü_pb2


27 
şass
 
	$AnchÜG’”©ÜBud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

29 
def
 
	$as£¹_®mo¡_li¡_equ®
(
£lf
, 
ex³ùed_li¡
, 
aùu®_li¡
, 
d–
=
NÚe
):

30 
£lf
.
	`as£¹Equ®
(
	`Ën
(
ex³ùed_li¡
), 
	$Ën
(
aùu®_li¡
))

31 
ex³ùed_™em
, 
aùu®_™em
 
š
 
	$z
(
ex³ùed_li¡
, 
aùu®_li¡
):

32 
£lf
.
	$as£¹Almo¡Equ®
(
ex³ùed_™em
, 
aùu®_™em
, 
d–
=delta)

34 
def
 
	$‹¡_bud_grid_ªchÜ_g’”©Ü_w™h_deçuÉs
(
£lf
):

35 
ªchÜ_g’”©Ü_‹xt_´Ùo
 = """

36 
grid_ªchÜ_g’”©Ü
 {

37 
	}
}

39 
ªchÜ_g’”©Ü_´Ùo
 = 
ªchÜ_g’”©Ü_pb2
.
	$AnchÜG’”©Ü
()

40 
‹xt_fÜm©
.
	$M”ge
(
ªchÜ_g’”©Ü_‹xt_´Ùo
, 
ªchÜ_g’”©Ü_´Ùo
)

41 
ªchÜ_g’”©Ü_objeù
 = 
ªchÜ_g’”©Ü_bud”
.
	$bud
(

42 
ªchÜ_g’”©Ü_´Ùo
)

43 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
ªchÜ_g’”©Ü_objeù
,

44 
grid_ªchÜ_g’”©Ü
.
GridAnchÜG’”©Ü
))

45 
£lf
.
	$as£¹Li¡Equ®
(
ªchÜ_g’”©Ü_objeù
.
_sÿËs
, [])

46 
£lf
.
	$as£¹Li¡Equ®
(
ªchÜ_g’”©Ü_objeù
.
_a¥eù_¿tios
, [])

47 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

48 
ba£_ªchÜ_size
, 
ªchÜ_off£t
, 
ªchÜ_¡ride
 = 
£ss
.
	$run
(

49 [
ªchÜ_g’”©Ü_objeù
.
_ba£_ªchÜ_size
,

50 
ªchÜ_g’”©Ü_objeù
.
_ªchÜ_off£t
,

51 
ªchÜ_g’”©Ü_objeù
.
_ªchÜ_¡ride
])

52 
£lf
.
	$as£¹AÎEqu®
(
ªchÜ_off£t
, [0, 0])

53 
£lf
.
	$as£¹AÎEqu®
(
ªchÜ_¡ride
, [16, 16])

54 
£lf
.
	$as£¹AÎEqu®
(
ba£_ªchÜ_size
, [256, 256])

56 
def
 
	$‹¡_bud_grid_ªchÜ_g’”©Ü_w™h_nÚ_deçuÉ_·¿m‘”s
(
£lf
):

57 
ªchÜ_g’”©Ü_‹xt_´Ùo
 = """

58 
grid_ªchÜ_g’”©Ü
 {

59 
height
: 128

60 
width
: 512

61 
height_¡ride
: 10

62 
width_¡ride
: 20

63 
height_off£t
: 30

64 
width_off£t
: 40

65 
sÿËs
: [0.4, 2.2]

66 
a¥eù_¿tios
: [0.3, 4.5]

67 
	}
}

69 
ªchÜ_g’”©Ü_´Ùo
 = 
ªchÜ_g’”©Ü_pb2
.
	$AnchÜG’”©Ü
()

70 
‹xt_fÜm©
.
	$M”ge
(
ªchÜ_g’”©Ü_‹xt_´Ùo
, 
ªchÜ_g’”©Ü_´Ùo
)

71 
ªchÜ_g’”©Ü_objeù
 = 
ªchÜ_g’”©Ü_bud”
.
	$bud
(

72 
ªchÜ_g’”©Ü_´Ùo
)

73 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
ªchÜ_g’”©Ü_objeù
,

74 
grid_ªchÜ_g’”©Ü
.
GridAnchÜG’”©Ü
))

75 
£lf
.
	$as£¹_®mo¡_li¡_equ®
(
ªchÜ_g’”©Ü_objeù
.
_sÿËs
,

77 
£lf
.
	$as£¹_®mo¡_li¡_equ®
(
ªchÜ_g’”©Ü_objeù
.
_a¥eù_¿tios
,

79 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

80 
ba£_ªchÜ_size
, 
ªchÜ_off£t
, 
ªchÜ_¡ride
 = 
£ss
.
	$run
(

81 [
ªchÜ_g’”©Ü_objeù
.
_ba£_ªchÜ_size
,

82 
ªchÜ_g’”©Ü_objeù
.
_ªchÜ_off£t
,

83 
ªchÜ_g’”©Ü_objeù
.
_ªchÜ_¡ride
])

84 
£lf
.
	$as£¹AÎEqu®
(
ªchÜ_off£t
, [30, 40])

85 
£lf
.
	$as£¹AÎEqu®
(
ªchÜ_¡ride
, [10, 20])

86 
£lf
.
	$as£¹AÎEqu®
(
ba£_ªchÜ_size
, [128, 512])

88 
def
 
	$‹¡_bud_ssd_ªchÜ_g’”©Ü_w™h_deçuÉs
(
£lf
):

89 
ªchÜ_g’”©Ü_‹xt_´Ùo
 = """

90 
ssd_ªchÜ_g’”©Ü
 {

91 
a¥eù_¿tios
: [1.0]

92 
	}
}

94 
ªchÜ_g’”©Ü_´Ùo
 = 
ªchÜ_g’”©Ü_pb2
.
	$AnchÜG’”©Ü
()

95 
‹xt_fÜm©
.
	$M”ge
(
ªchÜ_g’”©Ü_‹xt_´Ùo
, 
ªchÜ_g’”©Ü_´Ùo
)

96 
ªchÜ_g’”©Ü_objeù
 = 
ªchÜ_g’”©Ü_bud”
.
	$bud
(

97 
ªchÜ_g’”©Ü_´Ùo
)

98 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
ªchÜ_g’”©Ü_objeù
,

99 
muÉË_grid_ªchÜ_g’”©Ü
.

100 
MuÉËGridAnchÜG’”©Ü
))

101 
aùu®_sÿËs
, 
ex³ùed_sÿËs
 
š
 
	`z
(

102 
	`li¡
(
ªchÜ_g’”©Ü_objeù
.
_sÿËs
),

109 
£lf
.
	`as£¹_®mo¡_li¡_equ®
(
ex³ùed_sÿËs
, 
aùu®_sÿËs
, 
d–
=1e-2)

110 
aùu®_a¥eù_¿tio
, 
ex³ùed_a¥eù_¿tio
 
š
 
	`z
(

111 
	`li¡
(
ªchÜ_g’”©Ü_objeù
.
_a¥eù_¿tios
),

113 
£lf
.
	$as£¹_®mo¡_li¡_equ®
(
ex³ùed_a¥eù_¿tio
, 
aùu®_a¥eù_¿tio
)

115 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

116 
ba£_ªchÜ_size
 = 
£ss
.
	$run
(
ªchÜ_g’”©Ü_objeù
.
_ba£_ªchÜ_size
)

117 
£lf
.
	$as£¹AÎClo£
(
ba£_ªchÜ_size
, [1.0, 1.0])

119 
def
 
	$‹¡_bud_ssd_ªchÜ_g’”©Ü_w™houd_»duûd_boxes
(
£lf
):

120 
ªchÜ_g’”©Ü_‹xt_´Ùo
 = """

121 
ssd_ªchÜ_g’”©Ü
 {

122 
a¥eù_¿tios
: [1.0]

123 
»duû_boxes_š_lowe¡_Ïy”
: 
çl£


124 
	}
}

126 
ªchÜ_g’”©Ü_´Ùo
 = 
ªchÜ_g’”©Ü_pb2
.
	$AnchÜG’”©Ü
()

127 
‹xt_fÜm©
.
	$M”ge
(
ªchÜ_g’”©Ü_‹xt_´Ùo
, 
ªchÜ_g’”©Ü_´Ùo
)

128 
ªchÜ_g’”©Ü_objeù
 = 
ªchÜ_g’”©Ü_bud”
.
	$bud
(

129 
ªchÜ_g’”©Ü_´Ùo
)

130 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
ªchÜ_g’”©Ü_objeù
,

131 
muÉË_grid_ªchÜ_g’”©Ü
.

132 
MuÉËGridAnchÜG’”©Ü
))

134 
aùu®_sÿËs
, 
ex³ùed_sÿËs
 
š
 
	`z
(

135 
	`li¡
(
ªchÜ_g’”©Ü_objeù
.
_sÿËs
),

142 
£lf
.
	`as£¹_®mo¡_li¡_equ®
(
ex³ùed_sÿËs
, 
aùu®_sÿËs
, 
d–
=1e-2)

144 
aùu®_a¥eù_¿tio
, 
ex³ùed_a¥eù_¿tio
 
š
 
	`z
(

145 
	`li¡
(
ªchÜ_g’”©Ü_objeù
.
_a¥eù_¿tios
),

147 
£lf
.
	$as£¹_®mo¡_li¡_equ®
(
ex³ùed_a¥eù_¿tio
, 
aùu®_a¥eù_¿tio
)

149 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

150 
ba£_ªchÜ_size
 = 
£ss
.
	$run
(
ªchÜ_g’”©Ü_objeù
.
_ba£_ªchÜ_size
)

151 
£lf
.
	$as£¹AÎClo£
(
ba£_ªchÜ_size
, [1.0, 1.0])

153 
def
 
	$‹¡_bud_ssd_ªchÜ_g’”©Ü_w™h_nÚ_deçuÉ_·¿m‘”s
(
£lf
):

154 
ªchÜ_g’”©Ü_‹xt_´Ùo
 = """

155 
ssd_ªchÜ_g’”©Ü
 {

156 
num_Ïy”s
: 2

157 
mš_sÿË
: 0.3

158 
max_sÿË
: 0.8

159 
a¥eù_¿tios
: [2.0]

160 
	}
}

162 
ªchÜ_g’”©Ü_´Ùo
 = 
ªchÜ_g’”©Ü_pb2
.
	$AnchÜG’”©Ü
()

163 
‹xt_fÜm©
.
	$M”ge
(
ªchÜ_g’”©Ü_‹xt_´Ùo
, 
ªchÜ_g’”©Ü_´Ùo
)

164 
ªchÜ_g’”©Ü_objeù
 = 
ªchÜ_g’”©Ü_bud”
.
	$bud
(

165 
ªchÜ_g’”©Ü_´Ùo
)

166 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
ªchÜ_g’”©Ü_objeù
,

167 
muÉË_grid_ªchÜ_g’”©Ü
.

168 
MuÉËGridAnchÜG’”©Ü
))

170 
aùu®_sÿËs
, 
ex³ùed_sÿËs
 
š
 
	`z
(

171 
	`li¡
(
ªchÜ_g’”©Ü_objeù
.
_sÿËs
),

173 
£lf
.
	`as£¹_®mo¡_li¡_equ®
(
ex³ùed_sÿËs
, 
aùu®_sÿËs
, 
d–
=1e-2)

175 
aùu®_a¥eù_¿tio
, 
ex³ùed_a¥eù_¿tio
 
š
 
	`z
(

176 
	`li¡
(
ªchÜ_g’”©Ü_objeù
.
_a¥eù_¿tios
),

178 
£lf
.
	$as£¹_®mo¡_li¡_equ®
(
ex³ùed_a¥eù_¿tio
, 
aùu®_a¥eù_¿tio
)

180 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

181 
ba£_ªchÜ_size
 = 
£ss
.
	$run
(
ªchÜ_g’”©Ü_objeù
.
_ba£_ªchÜ_size
)

182 
£lf
.
	$as£¹AÎClo£
(
ba£_ªchÜ_size
, [1.0, 1.0])

184 
def
 
	$‹¡_¿i£_v®ue_”rÜ_Ú_em±y_ªchÜ_g’”tÜ
(
£lf
):

185 
ªchÜ_g’”©Ü_‹xt_´Ùo
 = """

187 
ªchÜ_g’”©Ü_´Ùo
 = 
ªchÜ_g’”©Ü_pb2
.
	$AnchÜG’”©Ü
()

188 
‹xt_fÜm©
.
	$M”ge
(
ªchÜ_g’”©Ü_‹xt_´Ùo
, 
ªchÜ_g’”©Ü_´Ùo
)

189 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

190 
ªchÜ_g’”©Ü_bud”
.
	$bud
(
ªchÜ_g’”©Ü_´Ùo
)

193 
__Çme__
 == '__main__':

194 
tf
.
‹¡
.
	`maš
()

	@builders/box_coder_builder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
äom
 
	gobjeù_d‘eùiÚ
.
box_cod”s
 
impÜt
 
ç¡”_rún_box_cod”


18 
äom
 
	gobjeù_d‘eùiÚ
.
box_cod”s
 
impÜt
 
m—n_¡ddev_box_cod”


19 
äom
 
	gobjeù_d‘eùiÚ
.
box_cod”s
 
impÜt
 
squ¬e_box_cod”


20 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
box_cod”_pb2


23 
def
 
	$bud
(
box_cod”_cÚfig
):

26 
Args
:

27 
box_cod”_cÚfig
: 
A
 
box_cod”
.
´Ùo
 
objeù
 
cÚššg
 
the
 
cÚfig
 the

28 
desœed
 
box
 
cod”
.

30 
R‘uºs
:

31 
BoxCod”
 
ba£d
 
Ú
 
the
 
cÚfig
.

33 
Rai£s
:

34 
V®ueE¼Ü
: 
On
 
em±y
 
box
 
cod”
 
´Ùo
.

36 
nÙ
 
	$isš¡ªû
(
box_cod”_cÚfig
, 
box_cod”_pb2
.
BoxCod”
):

37 
¿i£
 
	`V®ueE¼Ü
('box_coder_config‚ot ofype box_coder_pb2.BoxCoder.')

39 
box_cod”_cÚfig
.
	`WhichOÃof
('box_coder_oneof') == 'faster_rcnn_box_coder':

40  
ç¡”_rún_box_cod”
.
	$Fa¡”RúnBoxCod”
(
sÿË_çùÜs
=[

41 
box_cod”_cÚfig
.
ç¡”_rún_box_cod”
.
y_sÿË
,

42 
box_cod”_cÚfig
.
ç¡”_rún_box_cod”
.
x_sÿË
,

43 
box_cod”_cÚfig
.
ç¡”_rún_box_cod”
.
height_sÿË
,

44 
box_cod”_cÚfig
.
ç¡”_rún_box_cod”
.
width_sÿË


46 ià(
box_cod”_cÚfig
.
	`WhichOÃof
('box_coder_oneof') ==

48  
m—n_¡ddev_box_cod”
.
	$M—nStddevBoxCod”
()

49 
box_cod”_cÚfig
.
	`WhichOÃof
('box_coder_oneof') == 'square_box_coder':

50  
squ¬e_box_cod”
.
	$Squ¬eBoxCod”
(
sÿË_çùÜs
=[

51 
box_cod”_cÚfig
.
squ¬e_box_cod”
.
y_sÿË
,

52 
box_cod”_cÚfig
.
squ¬e_box_cod”
.
x_sÿË
,

53 
box_cod”_cÚfig
.
squ¬e_box_cod”
.
Ëngth_sÿË


55 
¿i£
 
	`V®ueE¼Ü
('Empty box coder.')

	@builders/box_coder_builder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	ggoogË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


21 
äom
 
	gobjeù_d‘eùiÚ
.
box_cod”s
 
impÜt
 
ç¡”_rún_box_cod”


22 
äom
 
	gobjeù_d‘eùiÚ
.
box_cod”s
 
impÜt
 
m—n_¡ddev_box_cod”


23 
äom
 
	gobjeù_d‘eùiÚ
.
box_cod”s
 
impÜt
 
squ¬e_box_cod”


24 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
box_cod”_bud”


25 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
box_cod”_pb2


28 
şass
 
	$BoxCod”Bud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

30 
def
 
	$‹¡_bud_ç¡”_rún_box_cod”_w™h_deçuÉs
(
£lf
):

31 
box_cod”_‹xt_´Ùo
 = """

32 
ç¡”_rún_box_cod”
 {

33 
	}
}

35 
box_cod”_´Ùo
 = 
box_cod”_pb2
.
	$BoxCod”
()

36 
‹xt_fÜm©
.
	$M”ge
(
box_cod”_‹xt_´Ùo
, 
box_cod”_´Ùo
)

37 
box_cod”_objeù
 = 
box_cod”_bud”
.
	$bud
(
box_cod”_´Ùo
)

38 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
box_cod”_objeù
,

39 
ç¡”_rún_box_cod”
.
Fa¡”RúnBoxCod”
))

40 
£lf
.
	$as£¹Equ®
(
box_cod”_objeù
.
_sÿË_çùÜs
, [10.0, 10.0, 5.0, 5.0])

42 
def
 
	$‹¡_bud_ç¡”_rún_box_cod”_w™h_nÚ_deçuÉ_·¿m‘”s
(
£lf
):

43 
box_cod”_‹xt_´Ùo
 = """

44 
ç¡”_rún_box_cod”
 {

45 
y_sÿË
: 6.0

46 
x_sÿË
: 3.0

47 
height_sÿË
: 7.0

48 
width_sÿË
: 8.0

49 
	}
}

51 
box_cod”_´Ùo
 = 
box_cod”_pb2
.
	$BoxCod”
()

52 
‹xt_fÜm©
.
	$M”ge
(
box_cod”_‹xt_´Ùo
, 
box_cod”_´Ùo
)

53 
box_cod”_objeù
 = 
box_cod”_bud”
.
	$bud
(
box_cod”_´Ùo
)

54 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
box_cod”_objeù
,

55 
ç¡”_rún_box_cod”
.
Fa¡”RúnBoxCod”
))

56 
£lf
.
	$as£¹Equ®
(
box_cod”_objeù
.
_sÿË_çùÜs
, [6.0, 3.0, 7.0, 8.0])

58 
def
 
	$‹¡_bud_m—n_¡ddev_box_cod”
(
£lf
):

59 
box_cod”_‹xt_´Ùo
 = """

60 
m—n_¡ddev_box_cod”
 {

61 
	}
}

63 
box_cod”_´Ùo
 = 
box_cod”_pb2
.
	$BoxCod”
()

64 
‹xt_fÜm©
.
	$M”ge
(
box_cod”_‹xt_´Ùo
, 
box_cod”_´Ùo
)

65 
box_cod”_objeù
 = 
box_cod”_bud”
.
	$bud
(
box_cod”_´Ùo
)

66 
£lf
.
	`as£¹True
(

67 
	$isš¡ªû
(
box_cod”_objeù
,

68 
m—n_¡ddev_box_cod”
.
M—nStddevBoxCod”
))

70 
def
 
	$‹¡_bud_squ¬e_box_cod”_w™h_deçuÉs
(
£lf
):

71 
box_cod”_‹xt_´Ùo
 = """

72 
squ¬e_box_cod”
 {

73 
	}
}

75 
box_cod”_´Ùo
 = 
box_cod”_pb2
.
	$BoxCod”
()

76 
‹xt_fÜm©
.
	$M”ge
(
box_cod”_‹xt_´Ùo
, 
box_cod”_´Ùo
)

77 
box_cod”_objeù
 = 
box_cod”_bud”
.
	$bud
(
box_cod”_´Ùo
)

78 
£lf
.
	`as£¹True
(

79 
	$isš¡ªû
(
box_cod”_objeù
, 
squ¬e_box_cod”
.
Squ¬eBoxCod”
))

80 
£lf
.
	$as£¹Equ®
(
box_cod”_objeù
.
_sÿË_çùÜs
, [10.0, 10.0, 5.0])

82 
def
 
	$‹¡_bud_squ¬e_box_cod”_w™h_nÚ_deçuÉ_·¿m‘”s
(
£lf
):

83 
box_cod”_‹xt_´Ùo
 = """

84 
squ¬e_box_cod”
 {

85 
y_sÿË
: 6.0

86 
x_sÿË
: 3.0

87 
Ëngth_sÿË
: 7.0

88 
	}
}

90 
box_cod”_´Ùo
 = 
box_cod”_pb2
.
	$BoxCod”
()

91 
‹xt_fÜm©
.
	$M”ge
(
box_cod”_‹xt_´Ùo
, 
box_cod”_´Ùo
)

92 
box_cod”_objeù
 = 
box_cod”_bud”
.
	$bud
(
box_cod”_´Ùo
)

93 
£lf
.
	`as£¹True
(

94 
	$isš¡ªû
(
box_cod”_objeù
, 
squ¬e_box_cod”
.
Squ¬eBoxCod”
))

95 
£lf
.
	$as£¹Equ®
(
box_cod”_objeù
.
_sÿË_çùÜs
, [6.0, 3.0, 7.0])

97 
def
 
	$‹¡_¿i£_”rÜ_Ú_em±y_box_cod”
(
£lf
):

98 
box_cod”_‹xt_´Ùo
 = """

100 
box_cod”_´Ùo
 = 
box_cod”_pb2
.
	$BoxCod”
()

101 
‹xt_fÜm©
.
	$M”ge
(
box_cod”_‹xt_´Ùo
, 
box_cod”_´Ùo
)

102 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

103 
box_cod”_bud”
.
	$bud
(
box_cod”_´Ùo
)

106 
__Çme__
 == '__main__':

107 
tf
.
‹¡
.
	`maš
()

	@builders/box_predictor_builder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_´ediùÜ


19 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
box_´ediùÜ_pb2


22 
def
 
	$bud
(
¬gscİe_â
, 
box_´ediùÜ_cÚfig
, 
is_Œaššg
, 
num_şas£s
):

25 
Buds
 
box
 
´ediùÜ
 
ba£d
 
Ú
 
the
 
cÚfigu¿tiÚ
. 
S“
 
box_´ediùÜ
.
´Ùo
 

26 
cÚfigu¿bË
 
İtiÚs
. 
Also
, 
£e
 
box_´ediùÜ
.
py
 
mÜe
 
d‘as
.

28 
Args
:

29 
¬gscİe_â
: 
A
 
funùiÚ
 
th©
 
kes
 
the
 
fŞlowšg
 
šputs
:

30 * 
hy³½¬ams_pb2
.
Hy³½¬ams
 
´Ùo


31 * 
a
 
boŞ—n
 
šdiÿtšg
 
the
 
mod–
 
is
 
š
 
Œaššg
 
mode
.

32 
ªd
 
»tuºs
 
a
 
tf
 
¦im
 
¬gscİe
 
CÚv
‡nd 
FC
 
hy³½¬am‘”s
.

33 
box_´ediùÜ_cÚfig
: 
box_´ediùÜ_pb2
.
BoxP»diùÜ
 
´Ùo
 
cÚššg


34 
cÚfigu¿tiÚ
.

35 
is_Œaššg
: 
Wh‘h”
 
the
 
mod–s
 
is
 
š
 
Œaššg
 
mode
.

36 
num_şas£s
: 
Numb”
 
of
 
şas£s
 
to
 
´ediù
.

38 
R‘uºs
:

39 
box_´ediùÜ
: box_´ediùÜ.
BoxP»diùÜ
 
objeù
.

41 
Rai£s
:

42 
V®ueE¼Ü
: 
On
 
unknown
 
box
 
´ediùÜ
.

44 
nÙ
 
	$isš¡ªû
(
box_´ediùÜ_cÚfig
, 
box_´ediùÜ_pb2
.
BoxP»diùÜ
):

45 
¿i£
 
	`V®ueE¼Ü
('box_predictor_config‚ot ofype '

48 
box_´ediùÜ_Úeof
 = 
box_´ediùÜ_cÚfig
.
	`WhichOÃof
('box_predictor_oneof')

50 
box_´ediùÜ_Úeof
 == 'convolutional_box_predictor':

51 
cÚv_box_´ediùÜ
 = 
box_´ediùÜ_cÚfig
.
cÚvŞutiÚ®_box_´ediùÜ


52 
cÚv_hy³½¬ams
 = 
	$¬gscİe_â
(
cÚv_box_´ediùÜ
.
cÚv_hy³½¬ams
,

53 
is_Œaššg
)

54 
box_´ediùÜ_objeù
 = 
box_´ediùÜ
.
	`CÚvŞutiÚ®BoxP»diùÜ
(

55 
is_Œaššg
=is_training,

56 
num_şas£s
=num_classes,

57 
cÚv_hy³½¬ams
=conv_hyperparams,

58 
mš_d•th
=
cÚv_box_´ediùÜ
.min_depth,

59 
max_d•th
=
cÚv_box_´ediùÜ
.max_depth,

60 
num_Ïy”s_befÜe_´ediùÜ
=(
cÚv_box_´ediùÜ
.

61 
num_Ïy”s_befÜe_´ediùÜ
),

62 
u£_drİout
=
cÚv_box_´ediùÜ
.use_dropout,

63 
drİout_k“p_´ob
=
cÚv_box_´ediùÜ
.
drİout_k“p_´obab™y
,

64 
k”Ãl_size
=
cÚv_box_´ediùÜ
.kernel_size,

65 
box_code_size
=
cÚv_box_´ediùÜ
.box_code_size,

66 
­¶y_sigmoid_to_scÜes
=
cÚv_box_´ediùÜ
.apply_sigmoid_to_scores)

67  
box_´ediùÜ_objeù


69 
box_´ediùÜ_Úeof
 == 'mask_rcnn_box_predictor':

70 
mask_rún_box_´ediùÜ
 = 
box_´ediùÜ_cÚfig
.mask_rcnn_box_predictor

71 
fc_hy³½¬ams
 = 
	$¬gscİe_â
(
mask_rún_box_´ediùÜ
.
fc_hy³½¬ams
,

72 
is_Œaššg
)

73 
cÚv_hy³½¬ams
 = 
NÚe


74 
mask_rún_box_´ediùÜ
.
	`HasF›ld
('conv_hyperparams'):

75 
cÚv_hy³½¬ams
 = 
	$¬gscİe_â
(
mask_rún_box_´ediùÜ
.
cÚv_hy³½¬ams
,

76 
is_Œaššg
)

77 
box_´ediùÜ_objeù
 = 
box_´ediùÜ
.
	`MaskRCNNBoxP»diùÜ
(

78 
is_Œaššg
=is_training,

79 
num_şas£s
=num_classes,

80 
fc_hy³½¬ams
=fc_hyperparams,

81 
u£_drİout
=
mask_rún_box_´ediùÜ
.use_dropout,

82 
drİout_k“p_´ob
=
mask_rún_box_´ediùÜ
.
drİout_k“p_´obab™y
,

83 
box_code_size
=
mask_rún_box_´ediùÜ
.box_code_size,

84 
cÚv_hy³½¬ams
=conv_hyperparams,

85 
´ediù_š¡ªû_masks
=
mask_rún_box_´ediùÜ
.predict_instance_masks,

86 
mask_´ediùiÚ_cÚv_d•th
=(
mask_rún_box_´ediùÜ
.

87 
mask_´ediùiÚ_cÚv_d•th
),

88 
´ediù_keypošts
=
mask_rún_box_´ediùÜ
.predict_keypoints)

89  
box_´ediùÜ_objeù


91 
box_´ediùÜ_Úeof
 == 'rfcn_box_predictor':

92 
rfú_box_´ediùÜ
 = 
box_´ediùÜ_cÚfig
.rfcn_box_predictor

93 
cÚv_hy³½¬ams
 = 
	$¬gscİe_â
(
rfú_box_´ediùÜ
.
cÚv_hy³½¬ams
,

94 
is_Œaššg
)

95 
box_´ediùÜ_objeù
 = 
box_´ediùÜ
.
	$RfúBoxP»diùÜ
(

96 
is_Œaššg
=is_training,

97 
num_şas£s
=num_classes,

98 
cÚv_hy³½¬ams
=conv_hyperparams,

99 
üİ_size
=[
rfú_box_´ediùÜ
.
üİ_height
,

100 
rfú_box_´ediùÜ
.
üİ_width
],

101 
num_¥©Ÿl_bšs
=[
rfú_box_´ediùÜ
.
num_¥©Ÿl_bšs_height
,

102 
rfú_box_´ediùÜ
.
num_¥©Ÿl_bšs_width
],

103 
d•th
=
rfú_box_´ediùÜ
.depth,

104 
box_code_size
=
rfú_box_´ediùÜ
.box_code_size)

105  
box_´ediùÜ_objeù


106 
¿i£
 
	`V®ueE¼Ü
('UnknowÀbox…»diùÜ: {}'.
	`fÜm©
(
box_´ediùÜ_Úeof
))

	@builders/box_predictor_builder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
mock


18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	ggoogË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


21 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
box_´ediùÜ_bud”


22 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
hy³½¬ams_bud”


23 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
box_´ediùÜ_pb2


24 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
hy³½¬ams_pb2


27 
şass
 
	$CÚvŞutiÚ®BoxP»diùÜBud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

29 
def
 
	$‹¡_box_´ediùÜ_ÿÎs_cÚv_¬gscİe_â
(
£lf
):

30 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

31 
»guÏriz”
 {

32 
l1_»guÏriz”
 {

33 
weight
: 0.0003

35 
	}
}

36 
š™Ÿliz”
 {

37 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

38 
m—n
: 0.0

39 
¡ddev
: 0.3

42 
aùiv©iÚ
: 
RELU_6


44 
hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

45 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
hy³½¬ams_´Ùo
)

46 
def
 
	$mock_cÚv_¬gscİe_bud”
(
cÚv_hy³½¬ams_¬g
, 
is_Œaššg
):

47  (
cÚv_hy³½¬ams_¬g
, 
is_Œaššg
)

49 
box_´ediùÜ_´Ùo
 = 
box_´ediùÜ_pb2
.
	$BoxP»diùÜ
()

50 
box_´ediùÜ_´Ùo
.
cÚvŞutiÚ®_box_´ediùÜ
.
cÚv_hy³½¬ams
.
	$CİyFrom
(

51 
hy³½¬ams_´Ùo
)

52 
box_´ediùÜ
 = 
box_´ediùÜ_bud”
.
	$bud
(

53 
¬gscİe_â
=
mock_cÚv_¬gscİe_bud”
,

54 
box_´ediùÜ_cÚfig
=
box_´ediùÜ_´Ùo
,

55 
is_Œaššg
=
F®£
,

56 
num_şas£s
=10)

57 (
cÚv_hy³½¬ams_aùu®
, 
is_Œaššg
èğ
box_´ediùÜ
.
_cÚv_hy³½¬ams


58 
£lf
.
	`as£¹Almo¡Equ®
((
hy³½¬ams_´Ùo
.
»guÏriz”
.

59 
l1_»guÏriz”
.
weight
),

60 (
cÚv_hy³½¬ams_aùu®
.
»guÏriz”
.
l1_»guÏriz”
.

61 
weight
))

62 
£lf
.
	`as£¹Almo¡Equ®
((
hy³½¬ams_´Ùo
.
š™Ÿliz”
.

63 
Œunÿ‹d_nÜm®_š™Ÿliz”
.
¡ddev
),

64 (
cÚv_hy³½¬ams_aùu®
.
š™Ÿliz”
.

65 
Œunÿ‹d_nÜm®_š™Ÿliz”
.
¡ddev
))

66 
£lf
.
	`as£¹Almo¡Equ®
((
hy³½¬ams_´Ùo
.
š™Ÿliz”
.

67 
Œunÿ‹d_nÜm®_š™Ÿliz”
.
m—n
),

68 (
cÚv_hy³½¬ams_aùu®
.
š™Ÿliz”
.

69 
Œunÿ‹d_nÜm®_š™Ÿliz”
.
m—n
))

70 
£lf
.
	$as£¹Equ®
(
hy³½¬ams_´Ùo
.
aùiv©iÚ
,

71 
cÚv_hy³½¬ams_aùu®
.
aùiv©iÚ
)

72 
£lf
.
	$as£¹F®£
(
is_Œaššg
)

74 
def
 
	$‹¡_cÚ¡ruù_nÚ_deçuÉ_cÚv_box_´ediùÜ
(
£lf
):

75 
box_´ediùÜ_‹xt_´Ùo
 = """

76 
cÚvŞutiÚ®_box_´ediùÜ
 {

77 
mš_d•th
: 2

78 
max_d•th
: 16

79 
num_Ïy”s_befÜe_´ediùÜ
: 2

80 
u£_drİout
: 
çl£


81 
drİout_k“p_´obab™y
: 0.4

82 
k”Ãl_size
: 3

83 
box_code_size
: 3

84 
­¶y_sigmoid_to_scÜes
: 
Œue


85 
	}
}

87 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

88 
»guÏriz”
 {

89 
l1_»guÏriz”
 {

92 
š™Ÿliz”
 {

93 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

97 
hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

98 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
hy³½¬ams_´Ùo
)

99 
def
 
	$mock_cÚv_¬gscİe_bud”
(
cÚv_hy³½¬ams_¬g
, 
is_Œaššg
):

100  (
cÚv_hy³½¬ams_¬g
, 
is_Œaššg
)

102 
box_´ediùÜ_´Ùo
 = 
box_´ediùÜ_pb2
.
	$BoxP»diùÜ
()

103 
‹xt_fÜm©
.
	$M”ge
(
box_´ediùÜ_‹xt_´Ùo
, 
box_´ediùÜ_´Ùo
)

104 
box_´ediùÜ_´Ùo
.
cÚvŞutiÚ®_box_´ediùÜ
.
cÚv_hy³½¬ams
.
	$CİyFrom
(

105 
hy³½¬ams_´Ùo
)

106 
box_´ediùÜ
 = 
box_´ediùÜ_bud”
.
	$bud
(

107 
¬gscİe_â
=
mock_cÚv_¬gscİe_bud”
,

108 
box_´ediùÜ_cÚfig
=
box_´ediùÜ_´Ùo
,

109 
is_Œaššg
=
F®£
,

110 
num_şas£s
=10)

111 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
_mš_d•th
, 2)

112 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
_max_d•th
, 16)

113 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
_num_Ïy”s_befÜe_´ediùÜ
, 2)

114 
£lf
.
	$as£¹F®£
(
box_´ediùÜ
.
_u£_drİout
)

115 
£lf
.
	$as£¹Almo¡Equ®
(
box_´ediùÜ
.
_drİout_k“p_´ob
, 0.4)

116 
£lf
.
	$as£¹True
(
box_´ediùÜ
.
_­¶y_sigmoid_to_scÜes
)

117 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
num_şas£s
, 10)

118 
£lf
.
	$as£¹F®£
(
box_´ediùÜ
.
_is_Œaššg
)

120 
def
 
	$‹¡_cÚ¡ruù_deçuÉ_cÚv_box_´ediùÜ
(
£lf
):

121 
box_´ediùÜ_‹xt_´Ùo
 = """

122 
cÚvŞutiÚ®_box_´ediùÜ
 {

123 
cÚv_hy³½¬ams
 {

124 
»guÏriz”
 {

125 
l1_»guÏriz”
 {

128 
š™Ÿliz”
 {

129 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

133 
	}
}"""

134 
box_´ediùÜ_´Ùo
 = 
box_´ediùÜ_pb2
.
	$BoxP»diùÜ
()

135 
‹xt_fÜm©
.
	$M”ge
(
box_´ediùÜ_‹xt_´Ùo
, 
box_´ediùÜ_´Ùo
)

136 
box_´ediùÜ
 = 
box_´ediùÜ_bud”
.
	$bud
(

137 
¬gscİe_â
=
hy³½¬ams_bud”
.
bud
,

138 
box_´ediùÜ_cÚfig
=
box_´ediùÜ_´Ùo
,

139 
is_Œaššg
=
True
,

140 
num_şas£s
=90)

141 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
_mš_d•th
, 0)

142 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
_max_d•th
, 0)

143 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
_num_Ïy”s_befÜe_´ediùÜ
, 0)

144 
£lf
.
	$as£¹True
(
box_´ediùÜ
.
_u£_drİout
)

145 
£lf
.
	$as£¹Almo¡Equ®
(
box_´ediùÜ
.
_drİout_k“p_´ob
, 0.8)

146 
£lf
.
	$as£¹F®£
(
box_´ediùÜ
.
_­¶y_sigmoid_to_scÜes
)

147 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
num_şas£s
, 90)

148 
£lf
.
	$as£¹True
(
box_´ediùÜ
.
_is_Œaššg
)

151 
şass
 
	$MaskRCNNBoxP»diùÜBud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

153 
def
 
	$‹¡_box_´ediùÜ_bud”_ÿÎs_fc_¬gscİe_â
(
£lf
):

154 
fc_hy³½¬ams_‹xt_´Ùo
 = """

155 
»guÏriz”
 {

156 
l1_»guÏriz”
 {

157 
weight
: 0.0003

159 
	}
}

160 
š™Ÿliz”
 {

161 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

162 
m—n
: 0.0

163 
¡ddev
: 0.3

166 
aùiv©iÚ
: 
RELU_6


167 
İ
: 
FC


169 
hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

170 
‹xt_fÜm©
.
	$M”ge
(
fc_hy³½¬ams_‹xt_´Ùo
, 
hy³½¬ams_´Ùo
)

171 
box_´ediùÜ_´Ùo
 = 
box_´ediùÜ_pb2
.
	$BoxP»diùÜ
()

172 
box_´ediùÜ_´Ùo
.
mask_rún_box_´ediùÜ
.
fc_hy³½¬ams
.
	$CİyFrom
(

173 
hy³½¬ams_´Ùo
)

174 
mock_¬gscİe_â
 = 
mock
.
	`Mock
(
»tuº_v®ue
='arg_scope')

175 
box_´ediùÜ
 = 
box_´ediùÜ_bud”
.
	$bud
(

176 
¬gscİe_â
=
mock_¬gscİe_â
,

177 
box_´ediùÜ_cÚfig
=
box_´ediùÜ_´Ùo
,

178 
is_Œaššg
=
F®£
,

179 
num_şas£s
=10)

180 
mock_¬gscİe_â
.
	$as£¹_ÿÎed_w™h
(
hy³½¬ams_´Ùo
, 
F®£
)

181 
£lf
.
	`as£¹Equ®
(
box_´ediùÜ
.
_fc_hy³½¬ams
, 'arg_scope')

183 
def
 
	$‹¡_nÚ_deçuÉ_mask_rún_box_´ediùÜ
(
£lf
):

184 
fc_hy³½¬ams_‹xt_´Ùo
 = """

185 
»guÏriz”
 {

186 
l1_»guÏriz”
 {

188 
	}
}

189 
š™Ÿliz”
 {

190 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

193 
aùiv©iÚ
: 
RELU_6


194 
İ
: 
FC


196 
box_´ediùÜ_‹xt_´Ùo
 = """

197 
mask_rún_box_´ediùÜ
 {

198 
u£_drİout
: 
Œue


199 
drİout_k“p_´obab™y
: 0.8

200 
box_code_size
: 3

203 
hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

204 
‹xt_fÜm©
.
	$M”ge
(
fc_hy³½¬ams_‹xt_´Ùo
, 
hy³½¬ams_´Ùo
)

205 
def
 
	$mock_fc_¬gscİe_bud”
(
fc_hy³½¬ams_¬g
, 
is_Œaššg
):

206  (
fc_hy³½¬ams_¬g
, 
is_Œaššg
)

208 
box_´ediùÜ_´Ùo
 = 
box_´ediùÜ_pb2
.
	$BoxP»diùÜ
()

209 
‹xt_fÜm©
.
	$M”ge
(
box_´ediùÜ_‹xt_´Ùo
, 
box_´ediùÜ_´Ùo
)

210 
box_´ediùÜ_´Ùo
.
mask_rún_box_´ediùÜ
.
fc_hy³½¬ams
.
	$CİyFrom
(

211 
hy³½¬ams_´Ùo
)

212 
box_´ediùÜ
 = 
box_´ediùÜ_bud”
.
	$bud
(

213 
¬gscİe_â
=
mock_fc_¬gscİe_bud”
,

214 
box_´ediùÜ_cÚfig
=
box_´ediùÜ_´Ùo
,

215 
is_Œaššg
=
True
,

216 
num_şas£s
=90)

217 
£lf
.
	$as£¹True
(
box_´ediùÜ
.
_u£_drİout
)

218 
£lf
.
	$as£¹Almo¡Equ®
(
box_´ediùÜ
.
_drİout_k“p_´ob
, 0.8)

219 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
num_şas£s
, 90)

220 
£lf
.
	$as£¹True
(
box_´ediùÜ
.
_is_Œaššg
)

221 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
_box_code_size
, 3)

223 
def
 
	$‹¡_bud_deçuÉ_mask_rún_box_´ediùÜ
(
£lf
):

224 
box_´ediùÜ_´Ùo
 = 
box_´ediùÜ_pb2
.
	$BoxP»diùÜ
()

225 
box_´ediùÜ_´Ùo
.
mask_rún_box_´ediùÜ
.
fc_hy³½¬ams
.
İ
 = (

226 
hy³½¬ams_pb2
.
Hy³½¬ams
.
FC
)

227 
box_´ediùÜ
 = 
box_´ediùÜ_bud”
.
	`bud
(

228 
¬gscİe_â
=
mock
.
	`Mock
(
»tuº_v®ue
='arg_scope'),

229 
box_´ediùÜ_cÚfig
=
box_´ediùÜ_´Ùo
,

230 
is_Œaššg
=
True
,

231 
num_şas£s
=90)

232 
£lf
.
	$as£¹F®£
(
box_´ediùÜ
.
_u£_drİout
)

233 
£lf
.
	$as£¹Almo¡Equ®
(
box_´ediùÜ
.
_drİout_k“p_´ob
, 0.5)

234 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
num_şas£s
, 90)

235 
£lf
.
	$as£¹True
(
box_´ediùÜ
.
_is_Œaššg
)

236 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
_box_code_size
, 4)

237 
£lf
.
	$as£¹F®£
(
box_´ediùÜ
.
_´ediù_š¡ªû_masks
)

238 
£lf
.
	$as£¹F®£
(
box_´ediùÜ
.
_´ediù_keypošts
)

240 
def
 
	$‹¡_bud_box_´ediùÜ_w™h_mask_b¿nch
(
£lf
):

241 
box_´ediùÜ_´Ùo
 = 
box_´ediùÜ_pb2
.
	$BoxP»diùÜ
()

242 
box_´ediùÜ_´Ùo
.
mask_rún_box_´ediùÜ
.
fc_hy³½¬ams
.
İ
 = (

243 
hy³½¬ams_pb2
.
Hy³½¬ams
.
FC
)

244 
box_´ediùÜ_´Ùo
.
mask_rún_box_´ediùÜ
.
cÚv_hy³½¬ams
.
İ
 = (

245 
hy³½¬ams_pb2
.
Hy³½¬ams
.
CONV
)

246 
box_´ediùÜ_´Ùo
.
mask_rún_box_´ediùÜ
.
´ediù_š¡ªû_masks
 = 
True


247 
box_´ediùÜ_´Ùo
.
mask_rún_box_´ediùÜ
.
mask_´ediùiÚ_cÚv_d•th
 = 512

248 
mock_¬gscİe_â
 = 
mock
.
	`Mock
(
»tuº_v®ue
='arg_scope')

249 
box_´ediùÜ
 = 
box_´ediùÜ_bud”
.
	$bud
(

250 
¬gscİe_â
=
mock_¬gscİe_â
,

251 
box_´ediùÜ_cÚfig
=
box_´ediùÜ_´Ùo
,

252 
is_Œaššg
=
True
,

253 
num_şas£s
=90)

254 
mock_¬gscİe_â
.
	`as£¹_has_ÿÎs
(

255 [
mock
.
	`ÿÎ
(
box_´ediùÜ_´Ùo
.
mask_rún_box_´ediùÜ
.
fc_hy³½¬ams
,

256 
True
),

257 
mock
.
	`ÿÎ
(
box_´ediùÜ_´Ùo
.
mask_rún_box_´ediùÜ
.
cÚv_hy³½¬ams
,

258 
True
)], 
ªy_Üd”
=True)

259 
£lf
.
	$as£¹F®£
(
box_´ediùÜ
.
_u£_drİout
)

260 
£lf
.
	$as£¹Almo¡Equ®
(
box_´ediùÜ
.
_drİout_k“p_´ob
, 0.5)

261 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
num_şas£s
, 90)

262 
£lf
.
	$as£¹True
(
box_´ediùÜ
.
_is_Œaššg
)

263 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
_box_code_size
, 4)

264 
£lf
.
	$as£¹True
(
box_´ediùÜ
.
_´ediù_š¡ªû_masks
)

265 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
_mask_´ediùiÚ_cÚv_d•th
, 512)

266 
£lf
.
	$as£¹F®£
(
box_´ediùÜ
.
_´ediù_keypošts
)

269 
şass
 
	$RfúBoxP»diùÜBud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

271 
def
 
	$‹¡_box_´ediùÜ_ÿÎs_fc_¬gscİe_â
(
£lf
):

272 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

273 
»guÏriz”
 {

274 
l1_»guÏriz”
 {

275 
weight
: 0.0003

277 
	}
}

278 
š™Ÿliz”
 {

279 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

280 
m—n
: 0.0

281 
¡ddev
: 0.3

284 
aùiv©iÚ
: 
RELU_6


286 
hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

287 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
hy³½¬ams_´Ùo
)

288 
def
 
	$mock_cÚv_¬gscİe_bud”
(
cÚv_hy³½¬ams_¬g
, 
is_Œaššg
):

289  (
cÚv_hy³½¬ams_¬g
, 
is_Œaššg
)

291 
box_´ediùÜ_´Ùo
 = 
box_´ediùÜ_pb2
.
	$BoxP»diùÜ
()

292 
box_´ediùÜ_´Ùo
.
rfú_box_´ediùÜ
.
cÚv_hy³½¬ams
.
	$CİyFrom
(

293 
hy³½¬ams_´Ùo
)

294 
box_´ediùÜ
 = 
box_´ediùÜ_bud”
.
	$bud
(

295 
¬gscİe_â
=
mock_cÚv_¬gscİe_bud”
,

296 
box_´ediùÜ_cÚfig
=
box_´ediùÜ_´Ùo
,

297 
is_Œaššg
=
F®£
,

298 
num_şas£s
=10)

299 (
cÚv_hy³½¬ams_aùu®
, 
is_Œaššg
èğ
box_´ediùÜ
.
_cÚv_hy³½¬ams


300 
£lf
.
	`as£¹Almo¡Equ®
((
hy³½¬ams_´Ùo
.
»guÏriz”
.

301 
l1_»guÏriz”
.
weight
),

302 (
cÚv_hy³½¬ams_aùu®
.
»guÏriz”
.
l1_»guÏriz”
.

303 
weight
))

304 
£lf
.
	`as£¹Almo¡Equ®
((
hy³½¬ams_´Ùo
.
š™Ÿliz”
.

305 
Œunÿ‹d_nÜm®_š™Ÿliz”
.
¡ddev
),

306 (
cÚv_hy³½¬ams_aùu®
.
š™Ÿliz”
.

307 
Œunÿ‹d_nÜm®_š™Ÿliz”
.
¡ddev
))

308 
£lf
.
	`as£¹Almo¡Equ®
((
hy³½¬ams_´Ùo
.
š™Ÿliz”
.

309 
Œunÿ‹d_nÜm®_š™Ÿliz”
.
m—n
),

310 (
cÚv_hy³½¬ams_aùu®
.
š™Ÿliz”
.

311 
Œunÿ‹d_nÜm®_š™Ÿliz”
.
m—n
))

312 
£lf
.
	$as£¹Equ®
(
hy³½¬ams_´Ùo
.
aùiv©iÚ
,

313 
cÚv_hy³½¬ams_aùu®
.
aùiv©iÚ
)

314 
£lf
.
	$as£¹F®£
(
is_Œaššg
)

316 
def
 
	$‹¡_nÚ_deçuÉ_rfú_box_´ediùÜ
(
£lf
):

317 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

318 
»guÏriz”
 {

319 
l1_»guÏriz”
 {

321 
	}
}

322 
š™Ÿliz”
 {

323 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

326 
aùiv©iÚ
: 
RELU_6


328 
box_´ediùÜ_‹xt_´Ùo
 = """

329 
rfú_box_´ediùÜ
 {

330 
num_¥©Ÿl_bšs_height
: 4

331 
num_¥©Ÿl_bšs_width
: 4

332 
d•th
: 4

333 
box_code_size
: 3

334 
üİ_height
: 16

335 
üİ_width
: 16

338 
hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

339 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
hy³½¬ams_´Ùo
)

340 
def
 
	$mock_cÚv_¬gscİe_bud”
(
cÚv_hy³½¬ams_¬g
, 
is_Œaššg
):

341  (
cÚv_hy³½¬ams_¬g
, 
is_Œaššg
)

343 
box_´ediùÜ_´Ùo
 = 
box_´ediùÜ_pb2
.
	$BoxP»diùÜ
()

344 
‹xt_fÜm©
.
	$M”ge
(
box_´ediùÜ_‹xt_´Ùo
, 
box_´ediùÜ_´Ùo
)

345 
box_´ediùÜ_´Ùo
.
rfú_box_´ediùÜ
.
cÚv_hy³½¬ams
.
	$CİyFrom
(

346 
hy³½¬ams_´Ùo
)

347 
box_´ediùÜ
 = 
box_´ediùÜ_bud”
.
	$bud
(

348 
¬gscİe_â
=
mock_cÚv_¬gscİe_bud”
,

349 
box_´ediùÜ_cÚfig
=
box_´ediùÜ_´Ùo
,

350 
is_Œaššg
=
True
,

351 
num_şas£s
=90)

352 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
num_şas£s
, 90)

353 
£lf
.
	$as£¹True
(
box_´ediùÜ
.
_is_Œaššg
)

354 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
_box_code_size
, 3)

355 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
_num_¥©Ÿl_bšs
, [4, 4])

356 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
_üİ_size
, [16, 16])

358 
def
 
	$‹¡_deçuÉ_rfú_box_´ediùÜ
(
£lf
):

359 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

360 
»guÏriz”
 {

361 
l1_»guÏriz”
 {

363 
	}
}

364 
š™Ÿliz”
 {

365 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

368 
aùiv©iÚ
: 
RELU_6


370 
hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

371 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
hy³½¬ams_´Ùo
)

372 
def
 
	$mock_cÚv_¬gscİe_bud”
(
cÚv_hy³½¬ams_¬g
, 
is_Œaššg
):

373  (
cÚv_hy³½¬ams_¬g
, 
is_Œaššg
)

375 
box_´ediùÜ_´Ùo
 = 
box_´ediùÜ_pb2
.
	$BoxP»diùÜ
()

376 
box_´ediùÜ_´Ùo
.
rfú_box_´ediùÜ
.
cÚv_hy³½¬ams
.
	$CİyFrom
(

377 
hy³½¬ams_´Ùo
)

378 
box_´ediùÜ
 = 
box_´ediùÜ_bud”
.
	$bud
(

379 
¬gscİe_â
=
mock_cÚv_¬gscİe_bud”
,

380 
box_´ediùÜ_cÚfig
=
box_´ediùÜ_´Ùo
,

381 
is_Œaššg
=
True
,

382 
num_şas£s
=90)

383 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
num_şas£s
, 90)

384 
£lf
.
	$as£¹True
(
box_´ediùÜ
.
_is_Œaššg
)

385 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
_box_code_size
, 4)

386 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
_num_¥©Ÿl_bšs
, [3, 3])

387 
£lf
.
	$as£¹Equ®
(
box_´ediùÜ
.
_üİ_size
, [12, 12])

390 
__Çme__
 == '__main__':

391 
tf
.
‹¡
.
	`maš
()

	@builders/hyperparams_builder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
‹nsÜæow
 
as
 
tf


19 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
hy³½¬ams_pb2


21 
	g¦im
 = 
tf
.
cÚŒib
.
¦im


24 
def
 
	$bud
(
hy³½¬ams_cÚfig
, 
is_Œaššg
):

27 
R‘uºs
 
ª
 
¬g_scİe
 
to
 
u£
 
cÚvŞutiÚ
 
İs
 
cÚššg
 
weights


28 
š™Ÿliz”
, 
weights
 
»guÏriz”
, 
aùiv©iÚ
 
funùiÚ
, 
b©ch
 
nÜm
 function

29 
ªd
 
b©ch
 
nÜm
 
·¿m‘”s
 
ba£d
 
Ú
 
the
 
cÚfigu¿tiÚ
.

31 
NÙe
 
th©
 
the
 
b©ch_nÜm
 
·¿m‘”es
 
¬e
 
nÙ
 
¥ecif›d
 
š
h
cÚfig


32 (
i
.
e
. 
Ëá
 
to
 è
th’
 
b©ch
 
nÜm
 
is
 
exşuded
 
äom
 
the
 
¬g_scİe
.

34 
The
 
b©ch
 
nÜm
 
·¿m‘”s
 
¬e
 
£t
 
upd©es
 
ba£d
 
Ú
 `
is_Œaššg
` 
¬gum’t


35 
ªd
 
cÚv_hy³½¬ams_cÚfig
.
b©ch_nÜm
.
Œaš
 
·¿m‘”
. 
Duršg
 
Œaššg
, 
they


36 
¬e
 
upd©ed
 
Úly
 
b©ch_nÜm
.
Œaš
 
·¿m‘”
 
is
 
Œue
. 
Howev”
, 
duršg
 
ev®
,

37 
no
 
upd©es
 
¬e
 
made
 
to
 
the
 
b©ch
 
nÜm
 
v¬ŸbËs
. 
In
 
bÙh
 
ÿ£s
, 
theœ
 
cu¼’t


38 
v®ues
 
¬e
 
u£d
 
duršg
 
fÜw¬d
 
·ss
.

40 
Args
:

41 
hy³½¬ams_cÚfig
: 
hy³½¬ams
.
´Ùo
 
objeù
 
cÚššg


42 
hy³½¬am‘”s
.

43 
is_Œaššg
: 
Wh‘h”
 
the
 
ÃtwÜk
 
is
 
š
 
Œaššg
 
mode
.

45 
R‘uºs
:

46 
¬g_scİe
: 
tf
-
¦im
‡rg_scİ
cÚššg
 
hy³½¬am‘”s
 
İs
.

48 
Rai£s
:

49 
V®ueE¼Ü
: 
hy³½¬ams_cÚfig
 
is
 
nÙ
 
of
 
ty³
 
hy³½¬ams
.
Hy³½¬ams
.

51 
nÙ
 
	$isš¡ªû
(
hy³½¬ams_cÚfig
,

52 
hy³½¬ams_pb2
.
Hy³½¬ams
):

53 
¿i£
 
	`V®ueE¼Ü
('hyperparams_config‚ot ofype '

56 
b©ch_nÜm
 = 
NÚe


57 
b©ch_nÜm_·¿ms
 = 
NÚe


58 
hy³½¬ams_cÚfig
.
	`HasF›ld
('batch_norm'):

59 
b©ch_nÜm
 = 
¦im
.batch_norm

60 
b©ch_nÜm_·¿ms
 = 
	$_bud_b©ch_nÜm_·¿ms
(

61 
hy³½¬ams_cÚfig
.
b©ch_nÜm
, 
is_Œaššg
)

63 
afãùed_İs
 = [
¦im
.
cÚv2d
, slim.
£·¿bË_cÚv2d
, slim.
cÚv2d_Œª¥o£
]

64 
hy³½¬ams_cÚfig
.
	`HasF›ld
('İ'è
	$ªd
 (

65 
hy³½¬ams_cÚfig
.
İ
 =ğ
hy³½¬ams_pb2
.
Hy³½¬ams
.
FC
):

66 
afãùed_İs
 = [
¦im
.
fuÎy_cÚÃùed
]

67 
w™h
 
¦im
.
	`¬g_scİe
(

68 
afãùed_İs
,

69 
weights_»guÏriz”
=
	`_bud_»guÏriz”
(

70 
hy³½¬ams_cÚfig
.
»guÏriz”
),

71 
weights_š™Ÿliz”
=
	`_bud_š™Ÿliz”
(

72 
hy³½¬ams_cÚfig
.
š™Ÿliz”
),

73 
aùiv©iÚ_â
=
	`_bud_aùiv©iÚ_â
(
hy³½¬ams_cÚfig
.
aùiv©iÚ
),

74 
nÜm®iz”_â
=
b©ch_nÜm
,

75 
nÜm®iz”_·¿ms
=
b©ch_nÜm_·¿ms
è
as
 
sc
:

76  
sc


79 
def
 
	$_bud_aùiv©iÚ_â
(
aùiv©iÚ_â
):

82 
Args
:

83 
aùiv©iÚ_â
: 
hy³½¬ams_pb2
.
Hy³½¬ams
.
aùiv©iÚ


85 
R‘uºs
:

86 
C®ÏbË
 
aùiv©iÚ
 
funùiÚ
.

88 
Rai£s
:

89 
V®ueE¼Ü
: 
On
 
unknown
 
aùiv©iÚ
 
funùiÚ
.

91 
aùiv©iÚ_â
 =ğ
hy³½¬ams_pb2
.
Hy³½¬ams
.
NONE
:

92  
NÚe


93 
aùiv©iÚ_â
 =ğ
hy³½¬ams_pb2
.
Hy³½¬ams
.
RELU
:

94  
tf
.
Â
.
»lu


95 
aùiv©iÚ_â
 =ğ
hy³½¬ams_pb2
.
Hy³½¬ams
.
RELU_6
:

96  
tf
.
Â
.
»lu6


97 
¿i£
 
	`V®ueE¼Ü
('UnknowÀaùiv©iÚ funùiÚ: {}'.
	$fÜm©
(
aùiv©iÚ_â
))

100 
def
 
	$_bud_»guÏriz”
(
»guÏriz”
):

103 
Args
:

104 
»guÏriz”
: 
hy³½¬ams_pb2
.
Hy³½¬ams
.»guÏriz” 
´Ùo
.

106 
R‘uºs
:

107 
tf
-
¦im
 
»guÏriz”
.

109 
Rai£s
:

110 
V®ueE¼Ü
: 
On
 
unknown
 
»guÏriz”
.

112 
»guÏriz”_Úeof
 = 
»guÏriz”
.
	`WhichOÃof
('regularizer_oneof')

113 
»guÏriz”_Úeof
 == 'l1_regularizer':

114  
¦im
.
	`l1_»guÏriz”
(
sÿË
=(
»guÏriz”
.
l1_»guÏriz”
.
weight
))

115 
»guÏriz”_Úeof
 == 'l2_regularizer':

116  
¦im
.
	`l2_»guÏriz”
(
sÿË
=(
»guÏriz”
.
l2_»guÏriz”
.
weight
))

117 
¿i£
 
	`V®ueE¼Ü
('UnknowÀ»guÏriz” funùiÚ: {}'.
	$fÜm©
(
»guÏriz”_Úeof
))

120 
def
 
	$_bud_š™Ÿliz”
(
š™Ÿliz”
):

123 
Args
:

124 
š™Ÿliz”
: 
hy³½¬ams_pb2
.
Hy³½¬ams
.
»guÏriz”
 
´Ùo
.

126 
R‘uºs
:

127 
tf
 
š™Ÿliz”
.

129 
Rai£s
:

130 
V®ueE¼Ü
: 
On
 
unknown
 
š™Ÿliz”
.

132 
š™Ÿliz”_Úeof
 = 
š™Ÿliz”
.
	`WhichOÃof
('initializer_oneof')

133 
š™Ÿliz”_Úeof
 == 'truncated_normal_initializer':

134  
tf
.
	$Œunÿ‹d_nÜm®_š™Ÿliz”
(

135 
m—n
=
š™Ÿliz”
.
Œunÿ‹d_nÜm®_š™Ÿliz”
.mean,

136 
¡ddev
=
š™Ÿliz”
.
Œunÿ‹d_nÜm®_š™Ÿliz”
.stddev)

137 
š™Ÿliz”_Úeof
 == 'variance_scaling_initializer':

138 
’um_desütÜ
 = (
hy³½¬ams_pb2
.
V¬ŸnûSÿlšgIn™Ÿliz”
.

139 
DESCRIPTOR
.
’um_ty³s_by_Çme
['Mode'])

140 
mode
 = 
’um_desütÜ
.
v®ues_by_numb”
[
š™Ÿliz”
.

141 
v¬Ÿnû_sÿlšg_š™Ÿliz”
.

142 
mode
].
Çme


143  
¦im
.
	$v¬Ÿnû_sÿlšg_š™Ÿliz”
(

144 
çùÜ
=
š™Ÿliz”
.
v¬Ÿnû_sÿlšg_š™Ÿliz”
.factor,

145 
mode
=mode,

146 
unifÜm
=
š™Ÿliz”
.
v¬Ÿnû_sÿlšg_š™Ÿliz”
.uniform)

147 
¿i£
 
	`V®ueE¼Ü
('UnknowÀš™Ÿliz” funùiÚ: {}'.
	$fÜm©
(

148 
š™Ÿliz”_Úeof
))

151 
def
 
	$_bud_b©ch_nÜm_·¿ms
(
b©ch_nÜm
, 
is_Œaššg
):

154 
Args
:

155 
b©ch_nÜm
: 
hy³½¬ams_pb2
.
CÚvHy³½¬ams
.b©ch_nÜm 
´Ùo
.

156 
is_Œaššg
: 
Wh‘h”
 
the
 
mod–s
 
is
 
š
 
Œaššg
 
mode
.

158 
R‘uºs
:

159 
A
 
diùiÚ¬y
 
cÚššg
 
b©ch_nÜm
 
·¿m‘”s
.

161 
b©ch_nÜm_·¿ms
 = {

162 'deÿy': 
b©ch_nÜm
.
deÿy
,

163 'ûÁ”': 
b©ch_nÜm
.
ûÁ”
,

164 'sÿË': 
b©ch_nÜm
.
sÿË
,

165 '•sÚ': 
b©ch_nÜm
.
•sÚ
,

166 'fu£d': 
True
,

167 'is_Œaššg': 
is_Œaššg
 
ªd
 
b©ch_nÜm
.
Œaš
,

168 
	}
}

169  
b©ch_nÜm_·¿ms


	@builders/hyperparams_builder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
numpy
 
as
 
Å


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	ggoogË
.
´Ùobuf
 
impÜt
 
	g‹xt_fÜm©


23 #TODO: 
Rewr™e
 
thœd_·¹y
 
impÜts
.

24 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
hy³½¬ams_bud”


25 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
hy³½¬ams_pb2


27 
	g¦im
 = 
tf
.
cÚŒib
.
¦im


30 
şass
 
	$Hy³½¬amsBud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

32 #TODO: 
Make
 
this
 
a
 
public
 
­i
 
š
 
¦im
 
¬g_scİe
.
py
.

33 
def
 
	$_g‘_scİe_key
(
£lf
, 
İ
):

34  
	`g‘©Œ
(
İ
, '_key_İ', 
	$¡r
(
İ
))

36 
def
 
	$‹¡_deçuÉ_¬g_scİe_has_cÚv2d_İ
(
£lf
):

37 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

38 
»guÏriz”
 {

39 
l1_»guÏriz”
 {

41 
	}
}

42 
š™Ÿliz”
 {

43 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

47 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

48 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

49 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
True
)

50 
£lf
.
	`as£¹True
(£lf.
	$_g‘_scİe_key
(
¦im
.
cÚv2d
è
š
 
scİe
)

52 
def
 
	$‹¡_deçuÉ_¬g_scİe_has_£·¿bË_cÚv2d_İ
(
£lf
):

53 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

54 
»guÏriz”
 {

55 
l1_»guÏriz”
 {

57 
	}
}

58 
š™Ÿliz”
 {

59 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

63 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

64 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

65 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
True
)

66 
£lf
.
	`as£¹True
(£lf.
	$_g‘_scİe_key
(
¦im
.
£·¿bË_cÚv2d
è
š
 
scİe
)

68 
def
 
	$‹¡_deçuÉ_¬g_scİe_has_cÚv2d_Œª¥o£_İ
(
£lf
):

69 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

70 
»guÏriz”
 {

71 
l1_»guÏriz”
 {

73 
	}
}

74 
š™Ÿliz”
 {

75 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

79 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

80 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

81 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
True
)

82 
£lf
.
	`as£¹True
(£lf.
	$_g‘_scİe_key
(
¦im
.
cÚv2d_Œª¥o£
è
š
 
scİe
)

84 
def
 
	$‹¡_ex¶ic™_fc_İ_¬g_scİe_has_fuÎy_cÚÃùed_İ
(
£lf
):

85 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

86 
İ
: 
FC


87 
»guÏriz”
 {

88 
l1_»guÏriz”
 {

90 
	}
}

91 
š™Ÿliz”
 {

92 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

96 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

97 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

98 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
True
)

99 
£lf
.
	`as£¹True
(£lf.
	$_g‘_scİe_key
(
¦im
.
fuÎy_cÚÃùed
è
š
 
scİe
)

101 
def
 
	$‹¡_£·¿bË_cÚv2d_ªd_cÚv2d_ªd_Œª¥o£_have_§me_·¿m‘”s
(
£lf
):

102 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

103 
»guÏriz”
 {

104 
l1_»guÏriz”
 {

106 
	}
}

107 
š™Ÿliz”
 {

108 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

112 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

113 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

114 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
True
)

115 
kw¬gs_1
, 
kw¬gs_2
, 
kw¬gs_3
 = 
scİe
.
	$v®ues
()

116 
£lf
.
	$as£¹DiùEqu®
(
kw¬gs_1
, 
kw¬gs_2
)

117 
£lf
.
	$as£¹DiùEqu®
(
kw¬gs_1
, 
kw¬gs_3
)

119 
def
 
	$‹¡_»tuº_l1_»guÏrized_weights
(
£lf
):

120 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

121 
»guÏriz”
 {

122 
l1_»guÏriz”
 {

123 
weight
: 0.5

125 
	}
}

126 
š™Ÿliz”
 {

127 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

131 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

132 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

133 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
True
)

134 
cÚv_scİe_¬gum’ts
 = 
scİe
.
	`v®ues
()[0]

135 
»guÏriz”
 = 
cÚv_scİe_¬gum’ts
['weights_regularizer']

136 
weights
 = 
Å
.
	`¬¿y
([1., -1, 4., 2.])

137 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

138 
»suÉ
 = 
£ss
.
	`run
(
	`»guÏriz”
(
tf
.
	$cÚ¡ªt
(
weights
)))

139 
£lf
.
	`as£¹AÎClo£
(
Å
.
	`abs
(
weights
).
	`sum
(è* 0.5, 
»suÉ
)

141 
def
 
	$‹¡_»tuº_l2_»guÏriz”_weights
(
£lf
):

142 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

143 
»guÏriz”
 {

144 
l2_»guÏriz”
 {

145 
weight
: 0.42

147 
	}
}

148 
š™Ÿliz”
 {

149 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

153 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

154 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

155 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
True
)

156 
cÚv_scİe_¬gum’ts
 = 
scİe
.
	`v®ues
()[0]

158 
»guÏriz”
 = 
cÚv_scİe_¬gum’ts
['weights_regularizer']

159 
weights
 = 
Å
.
	`¬¿y
([1., -1, 4., 2.])

160 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

161 
»suÉ
 = 
£ss
.
	`run
(
	`»guÏriz”
(
tf
.
	$cÚ¡ªt
(
weights
)))

162 
£lf
.
	`as£¹AÎClo£
(
Å
.
	`pow”
(
weights
, 2).
	`sum
(è/ 2.0 * 0.42, 
»suÉ
)

164 
def
 
	$‹¡_»tuº_nÚ_deçuÉ_b©ch_nÜm_·¿ms_w™h_Œaš_duršg_Œaš
(
£lf
):

165 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

166 
»guÏriz”
 {

167 
l2_»guÏriz”
 {

169 
	}
}

170 
š™Ÿliz”
 {

171 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

174 
b©ch_nÜm
 {

175 
deÿy
: 0.7

176 
ûÁ”
: 
çl£


177 
sÿË
: 
Œue


178 
•sÚ
: 0.03

179 
Œaš
: 
Œue


182 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

183 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

184 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
True
)

185 
cÚv_scİe_¬gum’ts
 = 
scİe
.
	`v®ues
()[0]

186 
£lf
.
	`as£¹Equ®
(
cÚv_scİe_¬gum’ts
['nÜm®iz”_â'], 
¦im
.
b©ch_nÜm
)

187 
b©ch_nÜm_·¿ms
 = 
cÚv_scİe_¬gum’ts
['normalizer_params']

188 
£lf
.
	`as£¹Almo¡Equ®
(
b©ch_nÜm_·¿ms
['decay'], 0.7)

189 
£lf
.
	`as£¹Almo¡Equ®
(
b©ch_nÜm_·¿ms
['epsilon'], 0.03)

190 
£lf
.
	`as£¹F®£
(
b©ch_nÜm_·¿ms
['center'])

191 
£lf
.
	`as£¹True
(
b©ch_nÜm_·¿ms
['scale'])

192 
£lf
.
	`as£¹True
(
b©ch_nÜm_·¿ms
['is_training'])

194 
def
 
	$‹¡_»tuº_b©ch_nÜm_·¿ms_w™h_nÙ¿š_duršg_ev®
(
£lf
):

195 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

196 
»guÏriz”
 {

197 
l2_»guÏriz”
 {

199 
	}
}

200 
š™Ÿliz”
 {

201 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

204 
b©ch_nÜm
 {

205 
deÿy
: 0.7

206 
ûÁ”
: 
çl£


207 
sÿË
: 
Œue


208 
•sÚ
: 0.03

209 
Œaš
: 
Œue


212 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

213 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

214 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
F®£
)

215 
cÚv_scİe_¬gum’ts
 = 
scİe
.
	`v®ues
()[0]

216 
£lf
.
	`as£¹Equ®
(
cÚv_scİe_¬gum’ts
['nÜm®iz”_â'], 
¦im
.
b©ch_nÜm
)

217 
b©ch_nÜm_·¿ms
 = 
cÚv_scİe_¬gum’ts
['normalizer_params']

218 
£lf
.
	`as£¹Almo¡Equ®
(
b©ch_nÜm_·¿ms
['decay'], 0.7)

219 
£lf
.
	`as£¹Almo¡Equ®
(
b©ch_nÜm_·¿ms
['epsilon'], 0.03)

220 
£lf
.
	`as£¹F®£
(
b©ch_nÜm_·¿ms
['center'])

221 
£lf
.
	`as£¹True
(
b©ch_nÜm_·¿ms
['scale'])

222 
£lf
.
	`as£¹F®£
(
b©ch_nÜm_·¿ms
['is_training'])

224 
def
 
	$‹¡_»tuº_b©ch_nÜm_·¿ms_w™h_nÙ¿š_wh’_Œaš_is_çl£
(
£lf
):

225 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

226 
»guÏriz”
 {

227 
l2_»guÏriz”
 {

229 
	}
}

230 
š™Ÿliz”
 {

231 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

234 
b©ch_nÜm
 {

235 
deÿy
: 0.7

236 
ûÁ”
: 
çl£


237 
sÿË
: 
Œue


238 
•sÚ
: 0.03

239 
Œaš
: 
çl£


242 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

243 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

244 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
True
)

245 
cÚv_scİe_¬gum’ts
 = 
scİe
.
	`v®ues
()[0]

246 
£lf
.
	`as£¹Equ®
(
cÚv_scİe_¬gum’ts
['nÜm®iz”_â'], 
¦im
.
b©ch_nÜm
)

247 
b©ch_nÜm_·¿ms
 = 
cÚv_scİe_¬gum’ts
['normalizer_params']

248 
£lf
.
	`as£¹Almo¡Equ®
(
b©ch_nÜm_·¿ms
['decay'], 0.7)

249 
£lf
.
	`as£¹Almo¡Equ®
(
b©ch_nÜm_·¿ms
['epsilon'], 0.03)

250 
£lf
.
	`as£¹F®£
(
b©ch_nÜm_·¿ms
['center'])

251 
£lf
.
	`as£¹True
(
b©ch_nÜm_·¿ms
['scale'])

252 
£lf
.
	`as£¹F®£
(
b©ch_nÜm_·¿ms
['is_training'])

254 
def
 
	$‹¡_do_nÙ_u£_b©ch_nÜm_if_deçuÉ
(
£lf
):

255 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

256 
»guÏriz”
 {

257 
l2_»guÏriz”
 {

259 
	}
}

260 
š™Ÿliz”
 {

261 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

265 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

266 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

267 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
True
)

268 
cÚv_scİe_¬gum’ts
 = 
scİe
.
	`v®ues
()[0]

269 
£lf
.
	`as£¹Equ®
(
cÚv_scİe_¬gum’ts
['nÜm®iz”_â'], 
NÚe
)

270 
£lf
.
	`as£¹Equ®
(
cÚv_scİe_¬gum’ts
['nÜm®iz”_·¿ms'], 
NÚe
)

272 
def
 
	$‹¡_u£_nÚe_aùiv©iÚ
(
£lf
):

273 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

274 
»guÏriz”
 {

275 
l2_»guÏriz”
 {

277 
	}
}

278 
š™Ÿliz”
 {

279 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

282 
aùiv©iÚ
: 
NONE


284 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

285 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

286 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
True
)

287 
cÚv_scİe_¬gum’ts
 = 
scİe
.
	`v®ues
()[0]

288 
£lf
.
	`as£¹Equ®
(
cÚv_scİe_¬gum’ts
['aùiv©iÚ_â'], 
NÚe
)

290 
def
 
	$‹¡_u£_»lu_aùiv©iÚ
(
£lf
):

291 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

292 
»guÏriz”
 {

293 
l2_»guÏriz”
 {

295 
	}
}

296 
š™Ÿliz”
 {

297 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

300 
aùiv©iÚ
: 
RELU


302 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

303 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

304 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
True
)

305 
cÚv_scİe_¬gum’ts
 = 
scİe
.
	`v®ues
()[0]

306 
£lf
.
	`as£¹Equ®
(
cÚv_scİe_¬gum’ts
['aùiv©iÚ_â'], 
tf
.
Â
.
»lu
)

308 
def
 
	$‹¡_u£_»lu_6_aùiv©iÚ
(
£lf
):

309 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

310 
»guÏriz”
 {

311 
l2_»guÏriz”
 {

313 
	}
}

314 
š™Ÿliz”
 {

315 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

318 
aùiv©iÚ
: 
RELU_6


320 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

321 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

322 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
True
)

323 
cÚv_scİe_¬gum’ts
 = 
scİe
.
	`v®ues
()[0]

324 
£lf
.
	`as£¹Equ®
(
cÚv_scİe_¬gum’ts
['aùiv©iÚ_â'], 
tf
.
Â
.
»lu6
)

326 
def
 
	`_as£¹_v¬Ÿnû_š_¿nge
(
£lf
, 
š™Ÿliz”
, 
sh­e
, 
v¬Ÿnû
,

327 
tŞ
=1e-2):

328 
w™h
 
tf
.
	`G¿ph
().
	$as_deçuÉ
(è
as
 
g
:

329 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(
g¿ph
=
g
è
as
 
£ss
:

330 
v¬
 = 
tf
.
	`g‘_v¬ŸbË
(

331 
Çme
='test',

332 
sh­e
=shape,

333 
dty³
=
tf
.
æßt32
,

334 
š™Ÿliz”
=initializer)

335 
£ss
.
	`run
(
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
())

336 
v®ues
 = 
£ss
.
	$run
(
v¬
)

337 
£lf
.
	`as£¹AÎClo£
(
Å
.
	`v¬
(
v®ues
), 
v¬Ÿnû
, 
tŞ
,ol)

339 
def
 
	$‹¡_v¬Ÿnû_š_¿nge_w™h_v¬Ÿnû_sÿlšg_š™Ÿliz”_çn_š
(
£lf
):

340 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

341 
»guÏriz”
 {

342 
l2_»guÏriz”
 {

344 
	}
}

345 
š™Ÿliz”
 {

346 
v¬Ÿnû_sÿlšg_š™Ÿliz”
 {

347 
çùÜ
: 2.0

348 
mode
: 
FAN_IN


349 
unifÜm
: 
çl£


353 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

354 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

355 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
True
)

356 
cÚv_scİe_¬gum’ts
 = 
scİe
.
	`v®ues
()[0]

357 
š™Ÿliz”
 = 
cÚv_scİe_¬gum’ts
['weights_initializer']

358 
£lf
.
	`_as£¹_v¬Ÿnû_š_¿nge
(
š™Ÿliz”
, 
sh­e
=[100, 40],

359 
v¬Ÿnû
=2. / 100.)

361 
def
 
	$‹¡_v¬Ÿnû_š_¿nge_w™h_v¬Ÿnû_sÿlšg_š™Ÿliz”_çn_out
(
£lf
):

362 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

363 
»guÏriz”
 {

364 
l2_»guÏriz”
 {

366 
	}
}

367 
š™Ÿliz”
 {

368 
v¬Ÿnû_sÿlšg_š™Ÿliz”
 {

369 
çùÜ
: 2.0

370 
mode
: 
FAN_OUT


371 
unifÜm
: 
çl£


375 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

376 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

377 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
True
)

378 
cÚv_scİe_¬gum’ts
 = 
scİe
.
	`v®ues
()[0]

379 
š™Ÿliz”
 = 
cÚv_scİe_¬gum’ts
['weights_initializer']

380 
£lf
.
	`_as£¹_v¬Ÿnû_š_¿nge
(
š™Ÿliz”
, 
sh­e
=[100, 40],

381 
v¬Ÿnû
=2. / 40.)

383 
def
 
	$‹¡_v¬Ÿnû_š_¿nge_w™h_v¬Ÿnû_sÿlšg_š™Ÿliz”_çn_avg
(
£lf
):

384 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

385 
»guÏriz”
 {

386 
l2_»guÏriz”
 {

388 
	}
}

389 
š™Ÿliz”
 {

390 
v¬Ÿnû_sÿlšg_š™Ÿliz”
 {

391 
çùÜ
: 2.0

392 
mode
: 
FAN_AVG


393 
unifÜm
: 
çl£


397 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

398 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

399 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
True
)

400 
cÚv_scİe_¬gum’ts
 = 
scİe
.
	`v®ues
()[0]

401 
š™Ÿliz”
 = 
cÚv_scİe_¬gum’ts
['weights_initializer']

402 
£lf
.
	`_as£¹_v¬Ÿnû_š_¿nge
(
š™Ÿliz”
, 
sh­e
=[100, 40],

403 
v¬Ÿnû
=4. / (100. + 40.))

405 
def
 
	$‹¡_v¬Ÿnû_š_¿nge_w™h_v¬Ÿnû_sÿlšg_š™Ÿliz”_unifÜm
(
£lf
):

406 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

407 
»guÏriz”
 {

408 
l2_»guÏriz”
 {

410 
	}
}

411 
š™Ÿliz”
 {

412 
v¬Ÿnû_sÿlšg_š™Ÿliz”
 {

413 
çùÜ
: 2.0

414 
mode
: 
FAN_IN


415 
unifÜm
: 
Œue


419 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

420 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

421 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
True
)

422 
cÚv_scİe_¬gum’ts
 = 
scİe
.
	`v®ues
()[0]

423 
š™Ÿliz”
 = 
cÚv_scİe_¬gum’ts
['weights_initializer']

424 
£lf
.
	`_as£¹_v¬Ÿnû_š_¿nge
(
š™Ÿliz”
, 
sh­e
=[100, 40],

425 
v¬Ÿnû
=2. / 100.)

427 
def
 
	$‹¡_v¬Ÿnû_š_¿nge_w™h_Œunÿ‹d_nÜm®_š™Ÿliz”
(
£lf
):

428 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

429 
»guÏriz”
 {

430 
l2_»guÏriz”
 {

432 
	}
}

433 
š™Ÿliz”
 {

434 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

435 
m—n
: 0.0

436 
¡ddev
: 0.8

440 
cÚv_hy³½¬ams_´Ùo
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

441 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams_´Ùo
)

442 
scİe
 = 
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams_´Ùo
, 
is_Œaššg
=
True
)

443 
cÚv_scİe_¬gum’ts
 = 
scİe
.
	`v®ues
()[0]

444 
š™Ÿliz”
 = 
cÚv_scİe_¬gum’ts
['weights_initializer']

445 
£lf
.
	`_as£¹_v¬Ÿnû_š_¿nge
(
š™Ÿliz”
, 
sh­e
=[100, 40],

446 
v¬Ÿnû
=0.49, 
tŞ
=1e-1)

449 
__Çme__
 == '__main__':

450 
tf
.
‹¡
.
	`maš
()

	@builders/image_resizer_builder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
funùoŞs


19 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
´•roûssÜ


20 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
image_»siz”_pb2


23 
def
 
	$bud
(
image_»siz”_cÚfig
):

26 
Args
:

27 
image_»siz”_cÚfig
: 
image_»siz”
.
´Ùo
 
objeù
 
cÚššg
 
·¿m‘”s
 

28 
ª
 
image
 
»sizšg
 
İ”©iÚ
.

30 
R‘uºs
:

31 
image_»siz”_â
: 
C®ÏbË
 
image
 
»sizšg
. 
This
 
ÿÎabË
 
®ways
 
kes


32 
a
 
¿nk
-3 
image
 
	$‹nsÜ
 (
cÜ»¥Údšg
 
to
 
a
 
sšgË
 
image
è
ªd
 
»tuºs
‡

33 
¿nk
-3 
image
 
‹nsÜ
, 
possibly
 
w™h
 
Ãw
 
¥©Ÿl
 
dim’siÚs
.

35 
Rai£s
:

36 
V®ueE¼Ü
: `
image_»siz”_cÚfig
` 
is
 
of
 
šcÜ»ù
 
ty³
.

37 
V®ueE¼Ü
: `
image_»siz”_cÚfig
.
image_»siz”_Úeof
` 
is
 
of
 
ex³ùed


38 
ty³
.

39 
V®ueE¼Ü
: 
mš_dim’siÚ
 > 
max_dim’siÚ
 
wh’
 
k“p_a¥eù_¿tio_»siz”


40 
is
 
u£d
.

42 
nÙ
 
	$isš¡ªû
(
image_»siz”_cÚfig
, 
image_»siz”_pb2
.
ImageResiz”
):

43 
¿i£
 
	`V®ueE¼Ü
('image_resizer_config‚ot ofype '

46 
image_»siz”_cÚfig
.
	`WhichOÃof
(

48 
k“p_a¥eù_¿tio_cÚfig
 = 
image_»siz”_cÚfig
.
k“p_a¥eù_¿tio_»siz”


49 
	`nÙ
 (
k“p_a¥eù_¿tio_cÚfig
.
mš_dim’siÚ


50 <ğ
k“p_a¥eù_¿tio_cÚfig
.
max_dim’siÚ
):

51 
¿i£
 
	`V®ueE¼Ü
('min_dimension > max_dimension')

52  
funùoŞs
.
	$·¹Ÿl
(

53 
´•roûssÜ
.
»size_to_¿nge
,

54 
mš_dim’siÚ
=
k“p_a¥eù_¿tio_cÚfig
.min_dimension,

55 
max_dim’siÚ
=
k“p_a¥eù_¿tio_cÚfig
.max_dimension)

56 
image_»siz”_cÚfig
.
	`WhichOÃof
(

58 
fixed_sh­e_»siz”_cÚfig
 = 
image_»siz”_cÚfig
.
fixed_sh­e_»siz”


59  
funùoŞs
.
	$·¹Ÿl
(
´•roûssÜ
.
»size_image
,

60 
Ãw_height
=
fixed_sh­e_»siz”_cÚfig
.
height
,

61 
Ãw_width
=
fixed_sh­e_»siz”_cÚfig
.
width
)

62 
¿i£
 
	`V®ueE¼Ü
('Invalid image„esizer option.')

	@builders/image_resizer_builder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
‹nsÜæow
 
as
 
tf


18 
äom
 
	ggoogË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


19 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
image_»siz”_bud”


20 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
image_»siz”_pb2


23 
şass
 
	$ImageResiz”Bud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

25 
def
 
	$_sh­e_of_»sized_¿ndom_image_giv’_‹xt_´Ùo
(

26 
£lf
, 
šput_sh­e
, 
‹xt_´Ùo
):

27 
image_»siz”_cÚfig
 = 
image_»siz”_pb2
.
	$ImageResiz”
()

28 
‹xt_fÜm©
.
	$M”ge
(
‹xt_´Ùo
, 
image_»siz”_cÚfig
)

29 
image_»siz”_â
 = 
image_»siz”_bud”
.
	$bud
(
image_»siz”_cÚfig
)

30 
images
 = 
tf
.
	`to_æßt
Ñf.
	$¿ndom_unifÜm
(

31 
šput_sh­e
, 
mšv®
=0, 
maxv®
=255, 
dty³
=
tf
.
št32
))

32 
»sized_images
 = 
	$image_»siz”_â
(
images
)

33 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

34  
£ss
.
	`run
(
»sized_images
).
sh­e


36 
def
 
	$‹¡_but_k“p_a¥eù_¿tio_»siz”_»tuºs_ex³ùed_sh­e
(
£lf
):

37 
image_»siz”_‹xt_´Ùo
 = """

38 
k“p_a¥eù_¿tio_»siz”
 {

39 
mš_dim’siÚ
: 10

40 
max_dim’siÚ
: 20

41 
	}
}

43 
šput_sh­e
 = (50, 25, 3)

44 
	gex³ùed_ouut_sh­e
 = (20, 10, 3)

45 
	gouut_sh­e
 = 
£lf
.
	$_sh­e_of_»sized_¿ndom_image_giv’_‹xt_´Ùo
(

46 
šput_sh­e
, 
image_»siz”_‹xt_´Ùo
)

47 
£lf
.
	$as£¹Equ®
(
ouut_sh­e
, 
ex³ùed_ouut_sh­e
)

49 
def
 
	$‹¡_but_fixed_sh­e_»siz”_»tuºs_ex³ùed_sh­e
(
£lf
):

50 
image_»siz”_‹xt_´Ùo
 = """

51 
fixed_sh­e_»siz”
 {

52 
height
: 10

53 
width
: 20

54 
	}
}

56 
šput_sh­e
 = (50, 25, 3)

57 
	gex³ùed_ouut_sh­e
 = (10, 20, 3)

58 
	gouut_sh­e
 = 
£lf
.
	$_sh­e_of_»sized_¿ndom_image_giv’_‹xt_´Ùo
(

59 
šput_sh­e
, 
image_»siz”_‹xt_´Ùo
)

60 
£lf
.
	$as£¹Equ®
(
ouut_sh­e
, 
ex³ùed_ouut_sh­e
)

62 
def
 
	$‹¡_¿i£s_”rÜ_Ú_šv®id_šput
(
£lf
):

63 
šv®id_šput
 = 'invalid_input'

64 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

65 
image_»siz”_bud”
.
	$bud
(
šv®id_šput
)

68 
__Çme__
 == '__main__':

69 
tf
.
‹¡
.
	`maš
()

	@builders/input_reader_builder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
C»©es
 
d©a
 
sourûs
 
D‘eùiÚMod–s
 
äom
 
ª
 
IÅutR—d”
 
	gcÚfig
. 
S“


19 
	gšput_»ad”
.
´Ùo
 
	gİtiÚs
.

21 
	gNÙe
: 
If
 
u£rs
 
wishes
 
to
 
®so
 
u£
 
theœ
 
own
 
IÅutR—d”s
 
w™h
 
the
 
Objeù


22 
D‘eùiÚ
 
cÚfigu¿tiÚ
 
äamewÜk
, 
they
 
should
 
defše
 
theœ
 
own
 
bud”
 
funùiÚ


23 
th©
 
w¿ps
 
the
 
bud
 
	gfunùiÚ
.

26 
impÜt
 
‹nsÜæow
 
as
 
tf


28 
äom
 
	gobjeù_d‘eùiÚ
.
d©a_decod”s
 
impÜt
 
tf_exam¶e_decod”


29 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
šput_»ad”_pb2


31 
	g·¿Î–_»ad”
 = 
tf
.
cÚŒib
.
¦im
.
·¿Î–_»ad”


34 
def
 
	$bud
(
šput_»ad”_cÚfig
):

37 
Args
:

38 
šput_»ad”_cÚfig
: 
A
 
šput_»ad”_pb2
.
IÅutR—d”
 
objeù
.

40 
R‘uºs
:

41 
A
 
‹nsÜ
 
diù
 
ba£d
 
Ú
 
the
 
šput_»ad”_cÚfig
.

43 
Rai£s
:

44 
V®ueE¼Ü
: 
On
 
šv®id
 
šput
 
»ad”
 
´Ùo
.

46 
nÙ
 
	$isš¡ªû
(
šput_»ad”_cÚfig
, 
šput_»ad”_pb2
.
IÅutR—d”
):

47 
¿i£
 
	`V®ueE¼Ü
('input_reader_config‚ot ofype '

50 
šput_»ad”_cÚfig
.
	`WhichOÃof
('input_reader') == 'tf_record_input_reader':

51 
cÚfig
 = 
šput_»ad”_cÚfig
.
tf_»cÜd_šput_»ad”


52 
_
, 
¡ršg_‹nsÜ
 = 
·¿Î–_»ad”
.
	`·¿Î–_»ad
(

53 
cÚfig
.
šput_·th
,

54 
»ad”_şass
=
tf
.
TFRecÜdR—d”
,

55 
num_•ochs
=(
šput_»ad”_cÚfig
.num_epochs

56 
šput_»ad”_cÚfig
.
num_•ochs
 
NÚe
),

57 
num_»ad”s
=
šput_»ad”_cÚfig
.num_readers,

58 
shufæe
=
šput_»ad”_cÚfig
.shuffle,

59 
dty³s
=[
tf
.
¡ršg
,f.string],

60 
ÿ·c™y
=
šput_»ad”_cÚfig
.
queue_ÿ·c™y
,

61 
mš_aá”_dequeue
=
šput_»ad”_cÚfig
.min_after_dequeue)

63  
tf_exam¶e_decod”
.
	`TfExam¶eDecod”
().
	$decode
(
¡ršg_‹nsÜ
)

65 
¿i£
 
	`V®ueE¼Ü
('Unsupported input_reader_config.')

	@builders/input_reader_builder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
os


19 
impÜt
 
numpy
 
as
 
Å


20 
impÜt
 
‹nsÜæow
 
as
 
tf


22 
äom
 
	ggoogË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


24 
äom
 
	g‹nsÜæow
.
	gcÜe
.
exam¶e
 
impÜt
 
exam¶e_pb2


25 
äom
 
	g‹nsÜæow
.
	gcÜe
.
exam¶e
 
impÜt
 
ã©u»_pb2


26 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
šput_»ad”_bud”


27 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
¡ªd¬d_f›lds
 
as
 
f›lds


28 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
šput_»ad”_pb2


31 
şass
 
	$IÅutR—d”Bud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

33 
def
 
	$ü—‹_tf_»cÜd
(
£lf
):

34 
·th
 = 
os
.·th.
	`još
(
£lf
.
	`g‘_‹mp_dœ
(), 'tfrecord')

35 
wr™”
 = 
tf
.
pythÚ_io
.
	$TFRecÜdWr™”
(
·th
)

37 
image_‹nsÜ
 = 
Å
.
¿ndom
.
	`¿ndšt
(255, 
size
=(4, 5, 3)).
	$a¡y³
(
Å
.
ušt8
)

38 
w™h
 
£lf
.
	$‹¡_£ssiÚ
():

39 
’coded_j³g
 = 
tf
.
image
.
	`’code_j³g
Ñf.
	`cÚ¡ªt
(
image_‹nsÜ
)).
	$ev®
()

40 
exam¶e
 = 
exam¶e_pb2
.
	`Exam¶e
(
ã©u»s
=
ã©u»_pb2
.
	`F—tu»s
(
ã©u»
={

41 'image/’coded': 
ã©u»_pb2
.
	`F—tu»
(

42 
by‹s_li¡
=
ã©u»_pb2
.
	`By‹sLi¡
(
v®ue
=[
’coded_j³g
])),

43 'image/fÜm©': 
ã©u»_pb2
.
	`F—tu»
(

44 
by‹s_li¡
=
ã©u»_pb2
.
	`By‹sLi¡
(
v®ue
=['j³g'.
	`’code
('utf-8')])),

45 'image/objeù/bbox/xmš': 
ã©u»_pb2
.
	`F—tu»
(

46 
æßt_li¡
=
ã©u»_pb2
.
	`FlßtLi¡
(
v®ue
=[0.0])),

47 'image/objeù/bbox/xmax': 
ã©u»_pb2
.
	`F—tu»
(

48 
æßt_li¡
=
ã©u»_pb2
.
	`FlßtLi¡
(
v®ue
=[1.0])),

49 'image/objeù/bbox/ymš': 
ã©u»_pb2
.
	`F—tu»
(

50 
æßt_li¡
=
ã©u»_pb2
.
	`FlßtLi¡
(
v®ue
=[0.0])),

51 'image/objeù/bbox/ymax': 
ã©u»_pb2
.
	`F—tu»
(

52 
æßt_li¡
=
ã©u»_pb2
.
	`FlßtLi¡
(
v®ue
=[1.0])),

53 'image/objeù/şass/Ïb–': 
ã©u»_pb2
.
	`F—tu»
(

54 
št64_li¡
=
ã©u»_pb2
.
	`IÁ64Li¡
(
v®ue
=[2])),

55 
	}
}))

56 
	gwr™”
.
wr™e
(
exam¶e
.
	$S”ŸlizeToSŒšg
())

57 
wr™”
.
	$şo£
()

59  
·th


61 
def
 
	$‹¡_bud_tf_»cÜd_šput_»ad”
(
£lf
):

62 
tf_»cÜd_·th
 = 
£lf
.
	$ü—‹_tf_»cÜd
()

64 
šput_»ad”_‹xt_´Ùo
 = """

65 
shufæe
: 
çl£


66 
num_»ad”s
: 1

67 
tf_»cÜd_šput_»ad”
 {{

68 
šput_·th
: '{0}'

69 }
	}
}

71 
šput_»ad”_´Ùo
 = 
šput_»ad”_pb2
.
	$IÅutR—d”
()

72 
‹xt_fÜm©
.
	$M”ge
(
šput_»ad”_‹xt_´Ùo
, 
šput_»ad”_´Ùo
)

73 
‹nsÜ_diù
 = 
šput_»ad”_bud”
.
	$bud
(
šput_»ad”_´Ùo
)

75 
sv
 = 
tf
.
Œaš
.
	`Su³rvisÜ
(
logdœ
=
£lf
.
	$g‘_‹mp_dœ
())

76 
w™h
 
sv
.
	$´•¬e_Ü_wa™_fÜ_£ssiÚ
(è
as
 
£ss
:

77 
sv
.
	$¡¬t_queue_ruÂ”s
(
£ss
)

78 
ouut_diù
 = 
£ss
.
	$run
(
‹nsÜ_diù
)

80 
£lf
.
	`as£¹Equ®s
(

81 (4, 5, 3), 
ouut_diù
[
f›lds
.
IÅutD©aF›lds
.
image
].
sh­e
)

82 
£lf
.
	$as£¹Equ®s
(

83 [2], 
ouut_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
])

84 
£lf
.
	`as£¹Equ®s
(

85 (1, 4), 
ouut_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
].
sh­e
)

86 
£lf
.
	$as£¹AÎEqu®
(

88 
ouut_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
][0])

91 
__Çme__
 == '__main__':

92 
tf
.
‹¡
.
	`maš
()

	@builders/losses_builder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
los£s


19 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
los£s_pb2


22 
def
 
	$bud
(
loss_cÚfig
):

25 
Buds
 
şassifiÿtiÚ
, 
loÿliz©iÚ
 
los£s
 
ªd
 
İtiÚ®ly
 
a
 
h¬d
 
exam¶e
 
mš”


26 
ba£d
 
Ú
 
the
 
cÚfig
.

28 
Args
:

29 
loss_cÚfig
: 
A
 
los£s_pb2
.
Loss
 
objeù
.

31 
R‘uºs
:

32 
şassifiÿtiÚ_loss
: 
CÏssifiÿtiÚ
 
loss
 
objeù
.

33 
loÿliz©iÚ_loss
: 
Loÿliz©iÚ
 
loss
 
objeù
.

34 
şassifiÿtiÚ_weight
: 
CÏssifiÿtiÚ
 
loss
 
weight
.

35 
loÿliz©iÚ_weight
: 
Loÿliz©iÚ
 
loss
 
weight
.

36 
h¬d_exam¶e_mš”
: 
H¬d
 
exam¶e
 
mš”
 
objeù
.

38 
şassifiÿtiÚ_loss
 = 
	$_bud_şassifiÿtiÚ_loss
(

39 
loss_cÚfig
.
şassifiÿtiÚ_loss
)

40 
loÿliz©iÚ_loss
 = 
	$_bud_loÿliz©iÚ_loss
(

41 
loss_cÚfig
.
loÿliz©iÚ_loss
)

42 
şassifiÿtiÚ_weight
 = 
loss_cÚfig
.classification_weight

43 
loÿliz©iÚ_weight
 = 
loss_cÚfig
.localization_weight

44 
h¬d_exam¶e_mš”
 = 
NÚe


45 
loss_cÚfig
.
	`HasF›ld
('hard_example_miner'):

46 
h¬d_exam¶e_mš”
 = 
	$bud_h¬d_exam¶e_mš”
(

47 
loss_cÚfig
.
h¬d_exam¶e_mš”
,

48 
şassifiÿtiÚ_weight
,

49 
loÿliz©iÚ_weight
)

50  (
şassifiÿtiÚ_loss
, 
loÿliz©iÚ_loss
,

51 
şassifiÿtiÚ_weight
,

52 
loÿliz©iÚ_weight
, 
h¬d_exam¶e_mš”
)

55 
def
 
	$bud_h¬d_exam¶e_mš”
(
cÚfig
,

56 
şassifiÿtiÚ_weight
,

57 
loÿliz©iÚ_weight
):

60 
Args
:

61 
cÚfig
: 
A
 
los£s_pb2
.
H¬dExam¶eMš”
 
objeù
.

62 
şassifiÿtiÚ_weight
: 
CÏssifiÿtiÚ
 
loss
 
weight
.

63 
loÿliz©iÚ_weight
: 
Loÿliz©iÚ
 
loss
 
weight
.

65 
R‘uºs
:

66 
H¬d
 
exam¶e
 
mš”
.

69 
loss_ty³
 = 
NÚe


70 
cÚfig
.
loss_ty³
 =ğ
los£s_pb2
.
H¬dExam¶eMš”
.
BOTH
:

71 
loss_ty³
 = 'both'

72 
cÚfig
.
loss_ty³
 =ğ
los£s_pb2
.
H¬dExam¶eMš”
.
CLASSIFICATION
:

73 
loss_ty³
 = 'cls'

74 
cÚfig
.
loss_ty³
 =ğ
los£s_pb2
.
H¬dExam¶eMš”
.
LOCALIZATION
:

75 
loss_ty³
 = 'loc'

77 
max_Ãg©ives_³r_pos™ive
 = 
NÚe


78 
num_h¬d_exam¶es
 = 
NÚe


79 
cÚfig
.
max_Ãg©ives_³r_pos™ive
 > 0:

80 
max_Ãg©ives_³r_pos™ive
 = 
cÚfig
.max_negatives_per_positive

81 
cÚfig
.
num_h¬d_exam¶es
 > 0:

82 
num_h¬d_exam¶es
 = 
cÚfig
.num_hard_examples

83 
h¬d_exam¶e_mš”
 = 
los£s
.
	$H¬dExam¶eMš”
(

84 
num_h¬d_exam¶es
=num_hard_examples,

85 
iou_th»shŞd
=
cÚfig
.iou_threshold,

86 
loss_ty³
=loss_type,

87 
şs_loss_weight
=
şassifiÿtiÚ_weight
,

88 
loc_loss_weight
=
loÿliz©iÚ_weight
,

89 
max_Ãg©ives_³r_pos™ive
=max_negatives_per_positive,

90 
mš_Ãg©ives_³r_image
=
cÚfig
.min_negatives_per_image)

91  
h¬d_exam¶e_mš”


94 
def
 
	$_bud_loÿliz©iÚ_loss
(
loss_cÚfig
):

97 
Args
:

98 
loss_cÚfig
: 
A
 
los£s_pb2
.
Loÿliz©iÚLoss
 
objeù
.

100 
R‘uºs
:

101 
Loss
 
ba£d
 
Ú
 
the
 
cÚfig
.

103 
Rai£s
:

104 
V®ueE¼Ü
: 
On
 
šv®id
 
loss_cÚfig
.

106 
nÙ
 
	$isš¡ªû
(
loss_cÚfig
, 
los£s_pb2
.
Loÿliz©iÚLoss
):

107 
¿i£
 
	`V®ueE¼Ü
('loss_config‚ot ofype†osses_pb2.LocalizationLoss.')

109 
loss_ty³
 = 
loss_cÚfig
.
	`WhichOÃof
('localization_loss')

111 
loss_ty³
 == 'weighted_l2':

112 
cÚfig
 = 
loss_cÚfig
.
weigh‹d_l2


113  
los£s
.
	$Weigh‹dL2Loÿliz©iÚLoss
(

114 
ªchÜwi£_ouut
=
cÚfig
.anchorwise_output)

116 
loss_ty³
 == 'weighted_smooth_l1':

117 
cÚfig
 = 
loss_cÚfig
.
weigh‹d_smoÙh_l1


118  
los£s
.
	$Weigh‹dSmoÙhL1Loÿliz©iÚLoss
(

119 
ªchÜwi£_ouut
=
cÚfig
.anchorwise_output)

121 
loss_ty³
 == 'weighted_iou':

122  
los£s
.
	$Weigh‹dIOULoÿliz©iÚLoss
()

124 
¿i£
 
	`V®ueE¼Ü
('Empty†oss config.')

127 
def
 
	$_bud_şassifiÿtiÚ_loss
(
loss_cÚfig
):

130 
Args
:

131 
loss_cÚfig
: 
A
 
los£s_pb2
.
CÏssifiÿtiÚLoss
 
objeù
.

133 
R‘uºs
:

134 
Loss
 
ba£d
 
Ú
 
the
 
cÚfig
.

136 
Rai£s
:

137 
V®ueE¼Ü
: 
On
 
šv®id
 
loss_cÚfig
.

139 
nÙ
 
	$isš¡ªû
(
loss_cÚfig
, 
los£s_pb2
.
CÏssifiÿtiÚLoss
):

140 
¿i£
 
	`V®ueE¼Ü
('loss_config‚ot ofype†osses_pb2.ClassificationLoss.')

142 
loss_ty³
 = 
loss_cÚfig
.
	`WhichOÃof
('classification_loss')

144 
loss_ty³
 == 'weighted_sigmoid':

145 
cÚfig
 = 
loss_cÚfig
.
weigh‹d_sigmoid


146  
los£s
.
	$Weigh‹dSigmoidCÏssifiÿtiÚLoss
(

147 
ªchÜwi£_ouut
=
cÚfig
.anchorwise_output)

149 
loss_ty³
 == 'weighted_softmax':

150 
cÚfig
 = 
loss_cÚfig
.
weigh‹d_soámax


151  
los£s
.
	$Weigh‹dSoámaxCÏssifiÿtiÚLoss
(

152 
ªchÜwi£_ouut
=
cÚfig
.anchorwise_output)

154 
loss_ty³
 == 'bootstrapped_sigmoid':

155 
cÚfig
 = 
loss_cÚfig
.
boÙ¡¿µed_sigmoid


156  
los£s
.
	`BoÙ¡¿µedSigmoidCÏssifiÿtiÚLoss
(

157 
®pha
=
cÚfig
.alpha,

158 
boÙ¡¿p_ty³
=('h¬d' 
cÚfig
.
h¬d_boÙ¡¿p
 'soft'),

159 
ªchÜwi£_ouut
=
cÚfig
.anchorwise_output)

161 
¿i£
 
	`V®ueE¼Ü
('Empty†oss config.')

	@builders/losses_builder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	ggoogË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


21 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
los£s_bud”


22 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
los£s


23 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
los£s_pb2


26 
şass
 
	$Loÿliz©iÚLossBud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

28 
def
 
	$‹¡_bud_weigh‹d_l2_loÿliz©iÚ_loss
(
£lf
):

29 
los£s_‹xt_´Ùo
 = """

30 
loÿliz©iÚ_loss
 {

31 
weigh‹d_l2
 {

33 
	}
}

34 
şassifiÿtiÚ_loss
 {

35 
weigh‹d_soámax
 {

39 
los£s_´Ùo
 = 
los£s_pb2
.
	$Loss
()

40 
‹xt_fÜm©
.
	$M”ge
(
los£s_‹xt_´Ùo
, 
los£s_´Ùo
)

41 
_
, 
loÿliz©iÚ_loss
, _, _, _ = 
los£s_bud”
.
	$bud
(
los£s_´Ùo
)

42 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
loÿliz©iÚ_loss
,

43 
los£s
.
Weigh‹dL2Loÿliz©iÚLoss
))

45 
def
 
	$‹¡_bud_weigh‹d_smoÙh_l1_loÿliz©iÚ_loss
(
£lf
):

46 
los£s_‹xt_´Ùo
 = """

47 
loÿliz©iÚ_loss
 {

48 
weigh‹d_smoÙh_l1
 {

50 
	}
}

51 
şassifiÿtiÚ_loss
 {

52 
weigh‹d_soámax
 {

56 
los£s_´Ùo
 = 
los£s_pb2
.
	$Loss
()

57 
‹xt_fÜm©
.
	$M”ge
(
los£s_‹xt_´Ùo
, 
los£s_´Ùo
)

58 
_
, 
loÿliz©iÚ_loss
, _, _, _ = 
los£s_bud”
.
	$bud
(
los£s_´Ùo
)

59 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
loÿliz©iÚ_loss
,

60 
los£s
.
Weigh‹dSmoÙhL1Loÿliz©iÚLoss
))

62 
def
 
	$‹¡_bud_weigh‹d_iou_loÿliz©iÚ_loss
(
£lf
):

63 
los£s_‹xt_´Ùo
 = """

64 
loÿliz©iÚ_loss
 {

65 
weigh‹d_iou
 {

67 
	}
}

68 
şassifiÿtiÚ_loss
 {

69 
weigh‹d_soámax
 {

73 
los£s_´Ùo
 = 
los£s_pb2
.
	$Loss
()

74 
‹xt_fÜm©
.
	$M”ge
(
los£s_‹xt_´Ùo
, 
los£s_´Ùo
)

75 
_
, 
loÿliz©iÚ_loss
, _, _, _ = 
los£s_bud”
.
	$bud
(
los£s_´Ùo
)

76 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
loÿliz©iÚ_loss
,

77 
los£s
.
Weigh‹dIOULoÿliz©iÚLoss
))

79 
def
 
	$‹¡_ªchÜwi£_ouut
(
£lf
):

80 
los£s_‹xt_´Ùo
 = """

81 
loÿliz©iÚ_loss
 {

82 
weigh‹d_smoÙh_l1
 {

83 
ªchÜwi£_ouut
: 
Œue


85 
	}
}

86 
şassifiÿtiÚ_loss
 {

87 
weigh‹d_soámax
 {

91 
los£s_´Ùo
 = 
los£s_pb2
.
	$Loss
()

92 
‹xt_fÜm©
.
	$M”ge
(
los£s_‹xt_´Ùo
, 
los£s_´Ùo
)

93 
_
, 
loÿliz©iÚ_loss
, _, _, _ = 
los£s_bud”
.
	$bud
(
los£s_´Ùo
)

94 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
loÿliz©iÚ_loss
,

95 
los£s
.
Weigh‹dSmoÙhL1Loÿliz©iÚLoss
))

96 
´ediùiÚs
 = 
tf
.
	$cÚ¡ªt
([[[0.0, 0.0, 1.0, 1.0], [0.0, 0.0, 1.0, 1.0]]])

97 
rg‘s
 = 
tf
.
	$cÚ¡ªt
([[[0.0, 0.0, 1.0, 1.0], [0.0, 0.0, 1.0, 1.0]]])

98 
weights
 = 
tf
.
	$cÚ¡ªt
([[1.0, 1.0]])

99 
loss
 = 
	$loÿliz©iÚ_loss
(
´ediùiÚs
, 
rg‘s
, 
weights
=weights)

100 
£lf
.
	$as£¹Equ®
(
loss
.
sh­e
, [1, 2])

102 
def
 
	$‹¡_¿i£_”rÜ_Ú_em±y_loÿliz©iÚ_cÚfig
(
£lf
):

103 
los£s_‹xt_´Ùo
 = """

104 
şassifiÿtiÚ_loss
 {

105 
weigh‹d_soámax
 {

107 
	}
}

109 
los£s_´Ùo
 = 
los£s_pb2
.
	$Loss
()

110 
‹xt_fÜm©
.
	$M”ge
(
los£s_‹xt_´Ùo
, 
los£s_´Ùo
)

111 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

112 
los£s_bud”
.
	$_bud_loÿliz©iÚ_loss
(
los£s_´Ùo
)

115 
şass
 
	$CÏssifiÿtiÚLossBud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

117 
def
 
	$‹¡_bud_weigh‹d_sigmoid_şassifiÿtiÚ_loss
(
£lf
):

118 
los£s_‹xt_´Ùo
 = """

119 
şassifiÿtiÚ_loss
 {

120 
weigh‹d_sigmoid
 {

122 
	}
}

123 
loÿliz©iÚ_loss
 {

124 
weigh‹d_l2
 {

128 
los£s_´Ùo
 = 
los£s_pb2
.
	$Loss
()

129 
‹xt_fÜm©
.
	$M”ge
(
los£s_‹xt_´Ùo
, 
los£s_´Ùo
)

130 
şassifiÿtiÚ_loss
, 
_
, _, _, _ = 
los£s_bud”
.
	$bud
(
los£s_´Ùo
)

131 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
şassifiÿtiÚ_loss
,

132 
los£s
.
Weigh‹dSigmoidCÏssifiÿtiÚLoss
))

134 
def
 
	$‹¡_bud_weigh‹d_soámax_şassifiÿtiÚ_loss
(
£lf
):

135 
los£s_‹xt_´Ùo
 = """

136 
şassifiÿtiÚ_loss
 {

137 
weigh‹d_soámax
 {

139 
	}
}

140 
loÿliz©iÚ_loss
 {

141 
weigh‹d_l2
 {

145 
los£s_´Ùo
 = 
los£s_pb2
.
	$Loss
()

146 
‹xt_fÜm©
.
	$M”ge
(
los£s_‹xt_´Ùo
, 
los£s_´Ùo
)

147 
şassifiÿtiÚ_loss
, 
_
, _, _, _ = 
los£s_bud”
.
	$bud
(
los£s_´Ùo
)

148 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
şassifiÿtiÚ_loss
,

149 
los£s
.
Weigh‹dSoámaxCÏssifiÿtiÚLoss
))

151 
def
 
	$‹¡_bud_boÙ¡¿µed_sigmoid_şassifiÿtiÚ_loss
(
£lf
):

152 
los£s_‹xt_´Ùo
 = """

153 
şassifiÿtiÚ_loss
 {

154 
boÙ¡¿µed_sigmoid
 {

155 
®pha
: 0.5

157 
	}
}

158 
loÿliz©iÚ_loss
 {

159 
weigh‹d_l2
 {

163 
los£s_´Ùo
 = 
los£s_pb2
.
	$Loss
()

164 
‹xt_fÜm©
.
	$M”ge
(
los£s_‹xt_´Ùo
, 
los£s_´Ùo
)

165 
şassifiÿtiÚ_loss
, 
_
, _, _, _ = 
los£s_bud”
.
	$bud
(
los£s_´Ùo
)

166 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
şassifiÿtiÚ_loss
,

167 
los£s
.
BoÙ¡¿µedSigmoidCÏssifiÿtiÚLoss
))

169 
def
 
	$‹¡_ªchÜwi£_ouut
(
£lf
):

170 
los£s_‹xt_´Ùo
 = """

171 
şassifiÿtiÚ_loss
 {

172 
weigh‹d_sigmoid
 {

173 
ªchÜwi£_ouut
: 
Œue


175 
	}
}

176 
loÿliz©iÚ_loss
 {

177 
weigh‹d_l2
 {

181 
los£s_´Ùo
 = 
los£s_pb2
.
	$Loss
()

182 
‹xt_fÜm©
.
	$M”ge
(
los£s_‹xt_´Ùo
, 
los£s_´Ùo
)

183 
şassifiÿtiÚ_loss
, 
_
, _, _, _ = 
los£s_bud”
.
	$bud
(
los£s_´Ùo
)

184 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
şassifiÿtiÚ_loss
,

185 
los£s
.
Weigh‹dSigmoidCÏssifiÿtiÚLoss
))

186 
´ediùiÚs
 = 
tf
.
	$cÚ¡ªt
([[[0.0, 1.0, 0.0], [0.0, 0.5, 0.5]]])

187 
rg‘s
 = 
tf
.
	$cÚ¡ªt
([[[0.0, 1.0, 0.0], [0.0, 0.0, 1.0]]])

188 
weights
 = 
tf
.
	$cÚ¡ªt
([[1.0, 1.0]])

189 
loss
 = 
	$şassifiÿtiÚ_loss
(
´ediùiÚs
, 
rg‘s
, 
weights
=weights)

190 
£lf
.
	$as£¹Equ®
(
loss
.
sh­e
, [1, 2])

192 
def
 
	$‹¡_¿i£_”rÜ_Ú_em±y_cÚfig
(
£lf
):

193 
los£s_‹xt_´Ùo
 = """

194 
loÿliz©iÚ_loss
 {

195 
weigh‹d_l2
 {

197 
	}
}

199 
los£s_´Ùo
 = 
los£s_pb2
.
	$Loss
()

200 
‹xt_fÜm©
.
	$M”ge
(
los£s_‹xt_´Ùo
, 
los£s_´Ùo
)

201 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

202 
los£s_bud”
.
	$bud
(
los£s_´Ùo
)

205 
şass
 
	$H¬dExam¶eMš”Bud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

207 
def
 
	$‹¡_do_nÙ_bud_h¬d_exam¶e_mš”_by_deçuÉ
(
£lf
):

208 
los£s_‹xt_´Ùo
 = """

209 
loÿliz©iÚ_loss
 {

210 
weigh‹d_l2
 {

212 
	}
}

213 
şassifiÿtiÚ_loss
 {

214 
weigh‹d_soámax
 {

218 
los£s_´Ùo
 = 
los£s_pb2
.
	$Loss
()

219 
‹xt_fÜm©
.
	$M”ge
(
los£s_‹xt_´Ùo
, 
los£s_´Ùo
)

220 
_
, _, _, _, 
h¬d_exam¶e_mš”
 = 
los£s_bud”
.
	$bud
(
los£s_´Ùo
)

221 
£lf
.
	$as£¹Equ®
(
h¬d_exam¶e_mš”
, 
NÚe
)

223 
def
 
	$‹¡_bud_h¬d_exam¶e_mš”_fÜ_şassifiÿtiÚ_loss
(
£lf
):

224 
los£s_‹xt_´Ùo
 = """

225 
loÿliz©iÚ_loss
 {

226 
weigh‹d_l2
 {

228 
	}
}

229 
şassifiÿtiÚ_loss
 {

230 
weigh‹d_soámax
 {

233 
h¬d_exam¶e_mš”
 {

234 
loss_ty³
: 
CLASSIFICATION


237 
los£s_´Ùo
 = 
los£s_pb2
.
	$Loss
()

238 
‹xt_fÜm©
.
	$M”ge
(
los£s_‹xt_´Ùo
, 
los£s_´Ùo
)

239 
_
, _, _, _, 
h¬d_exam¶e_mš”
 = 
los£s_bud”
.
	$bud
(
los£s_´Ùo
)

240 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
h¬d_exam¶e_mš”
, 
los£s
.
H¬dExam¶eMš”
))

241 
£lf
.
	`as£¹Equ®
(
h¬d_exam¶e_mš”
.
_loss_ty³
, 'cls')

243 
def
 
	$‹¡_bud_h¬d_exam¶e_mš”_fÜ_loÿliz©iÚ_loss
(
£lf
):

244 
los£s_‹xt_´Ùo
 = """

245 
loÿliz©iÚ_loss
 {

246 
weigh‹d_l2
 {

248 
	}
}

249 
şassifiÿtiÚ_loss
 {

250 
weigh‹d_soámax
 {

253 
h¬d_exam¶e_mš”
 {

254 
loss_ty³
: 
LOCALIZATION


257 
los£s_´Ùo
 = 
los£s_pb2
.
	$Loss
()

258 
‹xt_fÜm©
.
	$M”ge
(
los£s_‹xt_´Ùo
, 
los£s_´Ùo
)

259 
_
, _, _, _, 
h¬d_exam¶e_mš”
 = 
los£s_bud”
.
	$bud
(
los£s_´Ùo
)

260 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
h¬d_exam¶e_mš”
, 
los£s
.
H¬dExam¶eMš”
))

261 
£lf
.
	`as£¹Equ®
(
h¬d_exam¶e_mš”
.
_loss_ty³
, 'loc')

263 
def
 
	$‹¡_bud_h¬d_exam¶e_mš”_w™h_nÚ_deçuÉ_v®ues
(
£lf
):

264 
los£s_‹xt_´Ùo
 = """

265 
loÿliz©iÚ_loss
 {

266 
weigh‹d_l2
 {

268 
	}
}

269 
şassifiÿtiÚ_loss
 {

270 
weigh‹d_soámax
 {

273 
h¬d_exam¶e_mš”
 {

274 
num_h¬d_exam¶es
: 32

275 
iou_th»shŞd
: 0.5

276 
loss_ty³
: 
LOCALIZATION


277 
max_Ãg©ives_³r_pos™ive
: 10

278 
mš_Ãg©ives_³r_image
: 3

281 
los£s_´Ùo
 = 
los£s_pb2
.
	$Loss
()

282 
‹xt_fÜm©
.
	$M”ge
(
los£s_‹xt_´Ùo
, 
los£s_´Ùo
)

283 
_
, _, _, _, 
h¬d_exam¶e_mš”
 = 
los£s_bud”
.
	$bud
(
los£s_´Ùo
)

284 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
h¬d_exam¶e_mš”
, 
los£s
.
H¬dExam¶eMš”
))

285 
£lf
.
	$as£¹Equ®
(
h¬d_exam¶e_mš”
.
_num_h¬d_exam¶es
, 32)

286 
£lf
.
	$as£¹Almo¡Equ®
(
h¬d_exam¶e_mš”
.
_iou_th»shŞd
, 0.5)

287 
£lf
.
	$as£¹Equ®
(
h¬d_exam¶e_mš”
.
_max_Ãg©ives_³r_pos™ive
, 10)

288 
£lf
.
	$as£¹Equ®
(
h¬d_exam¶e_mš”
.
_mš_Ãg©ives_³r_image
, 3)

291 
şass
 
	$LossBud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

293 
def
 
	$‹¡_bud_®l_loss_·¿m‘”s
(
£lf
):

294 
los£s_‹xt_´Ùo
 = """

295 
loÿliz©iÚ_loss
 {

296 
weigh‹d_l2
 {

298 
	}
}

299 
şassifiÿtiÚ_loss
 {

300 
weigh‹d_soámax
 {

303 
h¬d_exam¶e_mš”
 {

305 
şassifiÿtiÚ_weight
: 0.8

306 
loÿliz©iÚ_weight
: 0.2

308 
los£s_´Ùo
 = 
los£s_pb2
.
	$Loss
()

309 
‹xt_fÜm©
.
	$M”ge
(
los£s_‹xt_´Ùo
, 
los£s_´Ùo
)

310 (
şassifiÿtiÚ_loss
, 
loÿliz©iÚ_loss
,

311 
şassifiÿtiÚ_weight
, 
loÿliz©iÚ_weight
,

312 
h¬d_exam¶e_mš”
èğ
los£s_bud”
.
	$bud
(
los£s_´Ùo
)

313 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
h¬d_exam¶e_mš”
, 
los£s
.
H¬dExam¶eMš”
))

314 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
şassifiÿtiÚ_loss
,

315 
los£s
.
Weigh‹dSoámaxCÏssifiÿtiÚLoss
))

316 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
loÿliz©iÚ_loss
,

317 
los£s
.
Weigh‹dL2Loÿliz©iÚLoss
))

318 
£lf
.
	$as£¹Almo¡Equ®
(
şassifiÿtiÚ_weight
, 0.8)

319 
£lf
.
	$as£¹Almo¡Equ®
(
loÿliz©iÚ_weight
, 0.2)

322 
__Çme__
 == '__main__':

323 
tf
.
‹¡
.
	`maš
()

	@builders/matcher_builder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
äom
 
	gobjeù_d‘eùiÚ
.
m©ch”s
 
impÜt
 
¬gmax_m©ch”


19 
äom
 
	gobjeù_d‘eùiÚ
.
m©ch”s
 
impÜt
 
b¬t™e_m©ch”


20 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
m©ch”_pb2


23 
def
 
	$bud
(
m©ch”_cÚfig
):

26 
Args
:

27 
m©ch”_cÚfig
: 
A
 
m©ch”
.
´Ùo
 
objeù
 
cÚššg
 
the
 
cÚfig
 th
desœed


28 
M©ch”
.

30 
R‘uºs
:

31 
M©ch”
 
ba£d
 
Ú
 
the
 
cÚfig
.

33 
Rai£s
:

34 
V®ueE¼Ü
: 
On
 
em±y
 
m©ch”
 
´Ùo
.

36 
nÙ
 
	$isš¡ªû
(
m©ch”_cÚfig
, 
m©ch”_pb2
.
M©ch”
):

37 
¿i£
 
	`V®ueE¼Ü
('matcher_config‚ot ofype matcher_pb2.Matcher.')

38 
m©ch”_cÚfig
.
	`WhichOÃof
('matcher_oneof') == 'argmax_matcher':

39 
m©ch”
 = 
m©ch”_cÚfig
.
¬gmax_m©ch”


40 
m©ched_th»shŞd
 = 
unm©ched_th»shŞd
 = 
NÚe


41 
nÙ
 
m©ch”
.
ignÜe_th»shŞds
:

42 
m©ched_th»shŞd
 = 
m©ch”
.matched_threshold

43 
unm©ched_th»shŞd
 = 
m©ch”
.unmatched_threshold

44  
¬gmax_m©ch”
.
	$ArgMaxM©ch”
(

45 
m©ched_th»shŞd
=matched_threshold,

46 
unm©ched_th»shŞd
=unmatched_threshold,

47 
Ãg©ives_low”_thª_unm©ched
=
m©ch”
.negatives_lower_than_unmatched,

48 
fÜû_m©ch_fÜ_—ch_row
=
m©ch”
.force_match_for_each_row)

49 
m©ch”_cÚfig
.
	`WhichOÃof
('matcher_oneof') == 'bipartite_matcher':

50  
b¬t™e_m©ch”
.
	$G»edyB¬t™eM©ch”
()

51 
¿i£
 
	`V®ueE¼Ü
('Empty matcher.')

	@builders/matcher_builder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	ggoogË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


21 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
m©ch”_bud”


22 
äom
 
	gobjeù_d‘eùiÚ
.
m©ch”s
 
impÜt
 
¬gmax_m©ch”


23 
äom
 
	gobjeù_d‘eùiÚ
.
m©ch”s
 
impÜt
 
b¬t™e_m©ch”


24 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
m©ch”_pb2


27 
şass
 
	$M©ch”Bud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

29 
def
 
	$‹¡_bud_¬g_max_m©ch”_w™h_deçuÉs
(
£lf
):

30 
m©ch”_‹xt_´Ùo
 = """

31 
¬gmax_m©ch”
 {

32 
	}
}

34 
m©ch”_´Ùo
 = 
m©ch”_pb2
.
	$M©ch”
()

35 
‹xt_fÜm©
.
	$M”ge
(
m©ch”_‹xt_´Ùo
, 
m©ch”_´Ùo
)

36 
m©ch”_objeù
 = 
m©ch”_bud”
.
	$bud
(
m©ch”_´Ùo
)

37 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
m©ch”_objeù
, 
¬gmax_m©ch”
.
ArgMaxM©ch”
))

38 
£lf
.
	$as£¹Almo¡Equ®
(
m©ch”_objeù
.
_m©ched_th»shŞd
, 0.5)

39 
£lf
.
	$as£¹Almo¡Equ®
(
m©ch”_objeù
.
_unm©ched_th»shŞd
, 0.5)

40 
£lf
.
	$as£¹True
(
m©ch”_objeù
.
_Ãg©ives_low”_thª_unm©ched
)

41 
£lf
.
	$as£¹F®£
(
m©ch”_objeù
.
_fÜû_m©ch_fÜ_—ch_row
)

43 
def
 
	$‹¡_bud_¬g_max_m©ch”_w™hout_th»shŞds
(
£lf
):

44 
m©ch”_‹xt_´Ùo
 = """

45 
¬gmax_m©ch”
 {

46 
ignÜe_th»shŞds
: 
Œue


47 
	}
}

49 
m©ch”_´Ùo
 = 
m©ch”_pb2
.
	$M©ch”
()

50 
‹xt_fÜm©
.
	$M”ge
(
m©ch”_‹xt_´Ùo
, 
m©ch”_´Ùo
)

51 
m©ch”_objeù
 = 
m©ch”_bud”
.
	$bud
(
m©ch”_´Ùo
)

52 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
m©ch”_objeù
, 
¬gmax_m©ch”
.
ArgMaxM©ch”
))

53 
£lf
.
	$as£¹Equ®
(
m©ch”_objeù
.
_m©ched_th»shŞd
, 
NÚe
)

54 
£lf
.
	$as£¹Equ®
(
m©ch”_objeù
.
_unm©ched_th»shŞd
, 
NÚe
)

55 
£lf
.
	$as£¹True
(
m©ch”_objeù
.
_Ãg©ives_low”_thª_unm©ched
)

56 
£lf
.
	$as£¹F®£
(
m©ch”_objeù
.
_fÜû_m©ch_fÜ_—ch_row
)

58 
def
 
	$‹¡_bud_¬g_max_m©ch”_w™h_nÚ_deçuÉ_·¿m‘”s
(
£lf
):

59 
m©ch”_‹xt_´Ùo
 = """

60 
¬gmax_m©ch”
 {

61 
m©ched_th»shŞd
: 0.7

62 
unm©ched_th»shŞd
: 0.3

63 
Ãg©ives_low”_thª_unm©ched
: 
çl£


64 
fÜû_m©ch_fÜ_—ch_row
: 
Œue


65 
	}
}

67 
m©ch”_´Ùo
 = 
m©ch”_pb2
.
	$M©ch”
()

68 
‹xt_fÜm©
.
	$M”ge
(
m©ch”_‹xt_´Ùo
, 
m©ch”_´Ùo
)

69 
m©ch”_objeù
 = 
m©ch”_bud”
.
	$bud
(
m©ch”_´Ùo
)

70 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
m©ch”_objeù
, 
¬gmax_m©ch”
.
ArgMaxM©ch”
))

71 
£lf
.
	$as£¹Almo¡Equ®
(
m©ch”_objeù
.
_m©ched_th»shŞd
, 0.7)

72 
£lf
.
	$as£¹Almo¡Equ®
(
m©ch”_objeù
.
_unm©ched_th»shŞd
, 0.3)

73 
£lf
.
	$as£¹F®£
(
m©ch”_objeù
.
_Ãg©ives_low”_thª_unm©ched
)

74 
£lf
.
	$as£¹True
(
m©ch”_objeù
.
_fÜû_m©ch_fÜ_—ch_row
)

76 
def
 
	$‹¡_bud_b¬t™e_m©ch”
(
£lf
):

77 
m©ch”_‹xt_´Ùo
 = """

78 
b¬t™e_m©ch”
 {

79 
	}
}

81 
m©ch”_´Ùo
 = 
m©ch”_pb2
.
	$M©ch”
()

82 
‹xt_fÜm©
.
	$M”ge
(
m©ch”_‹xt_´Ùo
, 
m©ch”_´Ùo
)

83 
m©ch”_objeù
 = 
m©ch”_bud”
.
	$bud
(
m©ch”_´Ùo
)

84 
£lf
.
	`as£¹True
(

85 
	$isš¡ªû
(
m©ch”_objeù
, 
b¬t™e_m©ch”
.
G»edyB¬t™eM©ch”
))

87 
def
 
	$‹¡_¿i£_”rÜ_Ú_em±y_m©ch”
(
£lf
):

88 
m©ch”_‹xt_´Ùo
 = """

90 
m©ch”_´Ùo
 = 
m©ch”_pb2
.
	$M©ch”
()

91 
‹xt_fÜm©
.
	$M”ge
(
m©ch”_‹xt_´Ùo
, 
m©ch”_´Ùo
)

92 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

93 
m©ch”_bud”
.
	$bud
(
m©ch”_´Ùo
)

96 
__Çme__
 == '__main__':

97 
tf
.
‹¡
.
	`maš
()

	@builders/model_builder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
ªchÜ_g’”©Ü_bud”


18 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
box_cod”_bud”


19 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
box_´ediùÜ_bud”


20 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
hy³½¬ams_bud”


21 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
image_»siz”_bud”


22 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
los£s_bud”


23 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
m©ch”_bud”


24 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
po¡_´oûssšg_bud”


25 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
»giÚ_sim¬™y_ÿlcuÏtÜ_bud”
 
as
 
sim_ÿlc


26 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_´ediùÜ


27 
äom
 
	gobjeù_d‘eùiÚ
.
m‘a_¬ch™eùu»s
 
impÜt
 
ç¡”_rún_m‘a_¬ch


28 
äom
 
	gobjeù_d‘eùiÚ
.
m‘a_¬ch™eùu»s
 
impÜt
 
rfú_m‘a_¬ch


29 
äom
 
	gobjeù_d‘eùiÚ
.
m‘a_¬ch™eùu»s
 
impÜt
 
ssd_m‘a_¬ch


30 
äom
 
	gobjeù_d‘eùiÚ
.
mod–s
 
impÜt
 
ç¡”_rún_šû±iÚ_»¢‘_v2_ã©u»_exŒaùÜ
 
as
 
äún_šc_»s


31 
äom
 
	gobjeù_d‘eùiÚ
.
mod–s
 
impÜt
 
ç¡”_rún_»¢‘_v1_ã©u»_exŒaùÜ
 
as
 
äún_»¢‘_v1


32 
äom
 
	gobjeù_d‘eùiÚ
.
	gmod–s
.
ssd_šû±iÚ_v2_ã©u»_exŒaùÜ
 
impÜt
 
SSDInû±iÚV2F—tu»ExŒaùÜ


33 
äom
 
	gobjeù_d‘eùiÚ
.
	gmod–s
.
ssd_mob’‘_v1_ã©u»_exŒaùÜ
 
impÜt
 
SSDMobeN‘V1F—tu»ExŒaùÜ


34 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
	gmod–_pb2


36 #A 
m­
 
of
 
Çmes
 
to
 
SSD
 
ã©u»
 
exŒaùÜs
.

37 
	gSSD_FEATURE_EXTRACTOR_CLASS_MAP
 = {

38 'ssd_šû±iÚ_v2': 
SSDInû±iÚV2F—tu»ExŒaùÜ
,

39 'ssd_mob’‘_v1': 
SSDMobeN‘V1F—tu»ExŒaùÜ
,

42 #A 
m­
 
of
 
Çmes
 
to
 
Fa¡”
 
R
-
CNN
 
ã©u»
 
exŒaùÜs
.

43 
FASTER_RCNN_FEATURE_EXTRACTOR_CLASS_MAP
 = {

45 
äún_»¢‘_v1
.
Fa¡”RCNNRe¢‘50F—tu»ExŒaùÜ
,

47 
äún_»¢‘_v1
.
Fa¡”RCNNRe¢‘101F—tu»ExŒaùÜ
,

49 
äún_»¢‘_v1
.
Fa¡”RCNNRe¢‘152F—tu»ExŒaùÜ
,

51 
äún_šc_»s
.
Fa¡”RCNNInû±iÚRe¢‘V2F—tu»ExŒaùÜ


55 
def
 
	$bud
(
mod–_cÚfig
, 
is_Œaššg
):

58 
Args
:

59 
mod–_cÚfig
: 
A
 
mod–
.
´Ùo
 
objeù
 
cÚššg
 
the
 
cÚfig
 th
desœed


60 
D‘eùiÚMod–
.

61 
is_Œaššg
: 
True
 
this
 
mod–
 
is
 
bešg
 
but
 
Œaššg
 
pu½o£s
.

63 
R‘uºs
:

64 
D‘eùiÚMod–
 
ba£d
 
Ú
 
the
 
cÚfig
.

66 
Rai£s
:

67 
V®ueE¼Ü
: 
On
 
šv®id
 
m‘a
 
¬ch™eùu»
 
Ü
 
mod–
.

69 
nÙ
 
	$isš¡ªû
(
mod–_cÚfig
, 
mod–_pb2
.
D‘eùiÚMod–
):

70 
¿i£
 
	`V®ueE¼Ü
('model_config‚ot ofype model_pb2.DetectionModel.')

71 
m‘a_¬ch™eùu»
 = 
mod–_cÚfig
.
	`WhichOÃof
('model')

72 
m‘a_¬ch™eùu»
 == 'ssd':

73  
	$_bud_ssd_mod–
(
mod–_cÚfig
.
ssd
, 
is_Œaššg
)

74 
m‘a_¬ch™eùu»
 == 'faster_rcnn':

75  
	$_bud_ç¡”_rún_mod–
(
mod–_cÚfig
.
ç¡”_rún
, 
is_Œaššg
)

76 
¿i£
 
	`V®ueE¼Ü
('UnknowÀm‘¨¬ch™eùu»: {}'.
	$fÜm©
(
m‘a_¬ch™eùu»
))

79 
def
 
	$_bud_ssd_ã©u»_exŒaùÜ
(
ã©u»_exŒaùÜ_cÚfig
, 
is_Œaššg
,

80 
»u£_weights
=
NÚe
):

83 
Args
:

84 
ã©u»_exŒaùÜ_cÚfig
: 
A
 
SSDF—tu»ExŒaùÜ
 
´Ùo
 
cÚfig
 
äom
 
ssd
.proto.

85 
is_Œaššg
: 
True
 
this
 
ã©u»
 
exŒaùÜ
 
is
 
bešg
 
but
 
Œaššg
.

86 
»u£_weights
: 
the
 
ã©u»
 
exŒaùÜ
 
should
 
»u£
 
weights
.

88 
R‘uºs
:

89 
ssd_m‘a_¬ch
.
SSDF—tu»ExŒaùÜ
 
ba£d
 
Ú
 
cÚfig
.

91 
Rai£s
:

92 
V®ueE¼Ü
: 
On
 
šv®id
 
ã©u»
 
exŒaùÜ
 
ty³
.

94 
ã©u»_ty³
 = 
ã©u»_exŒaùÜ_cÚfig
.
ty³


95 
d•th_muÉl›r
 = 
ã©u»_exŒaùÜ_cÚfig
.depth_multiplier

96 
mš_d•th
 = 
ã©u»_exŒaùÜ_cÚfig
.min_depth

97 
cÚv_hy³½¬ams
 = 
hy³½¬ams_bud”
.
	$bud
(

98 
ã©u»_exŒaùÜ_cÚfig
.
cÚv_hy³½¬ams
, 
is_Œaššg
)

100 
ã©u»_ty³
 
nÙ
 
š
 
SSD_FEATURE_EXTRACTOR_CLASS_MAP
:

101 
¿i£
 
	`V®ueE¼Ü
('UnknowÀssd f—tu»_exŒaùÜ: {}'.
	$fÜm©
(
ã©u»_ty³
))

103 
ã©u»_exŒaùÜ_şass
 = 
SSD_FEATURE_EXTRACTOR_CLASS_MAP
[
ã©u»_ty³
]

104  
	$ã©u»_exŒaùÜ_şass
(
d•th_muÉl›r
, 
mš_d•th
, 
cÚv_hy³½¬ams
,

105 
»u£_weights
)

108 
def
 
	$_bud_ssd_mod–
(
ssd_cÚfig
, 
is_Œaššg
):

111 
Args
:

112 
ssd_cÚfig
: 
A
 
ssd
.
´Ùo
 
objeù
 
cÚššg
 
the
 
cÚfig
 th
desœed


113 
SSDM‘aArch
.

114 
is_Œaššg
: 
True
 
this
 
mod–
 
is
 
bešg
 
but
 
Œaššg
 
pu½o£s
.

116 
R‘uºs
:

117 
SSDM‘aArch
 
ba£d
 
Ú
 
the
 
cÚfig
.

118 
Rai£s
:

119 
V®ueE¼Ü
: 
If
 
ssd_cÚfig
.
ty³
 
is
 
nÙ
 
	`»cognized
 (
i
.
e
.‚Ù 
»gi¡”ed
 
š


120 
mod–_şass_m­
).

122 
num_şas£s
 = 
ssd_cÚfig
.num_classes

124 #F—tu» 
exŒaùÜ


125 
ã©u»_exŒaùÜ
 = 
	$_bud_ssd_ã©u»_exŒaùÜ
(
ssd_cÚfig
.
ã©u»_exŒaùÜ
,

126 
is_Œaššg
)

128 
box_cod”
 = 
box_cod”_bud”
.
	$bud
(
ssd_cÚfig
.
box_cod”
)

129 
m©ch”
 = 
m©ch”_bud”
.
	$bud
(
ssd_cÚfig
.
m©ch”
)

130 
»giÚ_sim¬™y_ÿlcuÏtÜ
 = 
sim_ÿlc
.
	$bud
(

131 
ssd_cÚfig
.
sim¬™y_ÿlcuÏtÜ
)

132 
ssd_box_´ediùÜ
 = 
box_´ediùÜ_bud”
.
	$bud
(
hy³½¬ams_bud”
.
bud
,

133 
ssd_cÚfig
.
box_´ediùÜ
,

134 
is_Œaššg
, 
num_şas£s
)

135 
ªchÜ_g’”©Ü
 = 
ªchÜ_g’”©Ü_bud”
.
	$bud
(

136 
ssd_cÚfig
.
ªchÜ_g’”©Ü
)

137 
image_»siz”_â
 = 
image_»siz”_bud”
.
	$bud
(
ssd_cÚfig
.
image_»siz”
)

138 
nÚ_max_suµ»ssiÚ_â
, 
scÜe_cÚv”siÚ_â
 = 
po¡_´oûssšg_bud”
.
	$bud
(

139 
ssd_cÚfig
.
po¡_´oûssšg
)

140 (
şassifiÿtiÚ_loss
, 
loÿliz©iÚ_loss
, 
şassifiÿtiÚ_weight
,

141 
loÿliz©iÚ_weight
,

142 
h¬d_exam¶e_mš”
èğ
los£s_bud”
.
	$bud
(
ssd_cÚfig
.
loss
)

143 
nÜm®ize_loss_by_num_m©ches
 = 
ssd_cÚfig
.normalize_loss_by_num_matches

145  
ssd_m‘a_¬ch
.
	$SSDM‘aArch
(

146 
is_Œaššg
,

147 
ªchÜ_g’”©Ü
,

148 
ssd_box_´ediùÜ
,

149 
box_cod”
,

150 
ã©u»_exŒaùÜ
,

151 
m©ch”
,

152 
»giÚ_sim¬™y_ÿlcuÏtÜ
,

153 
image_»siz”_â
,

154 
nÚ_max_suµ»ssiÚ_â
,

155 
scÜe_cÚv”siÚ_â
,

156 
şassifiÿtiÚ_loss
,

157 
loÿliz©iÚ_loss
,

158 
şassifiÿtiÚ_weight
,

159 
loÿliz©iÚ_weight
,

160 
nÜm®ize_loss_by_num_m©ches
,

161 
h¬d_exam¶e_mš”
)

164 
def
 
	$_bud_ç¡”_rún_ã©u»_exŒaùÜ
(

165 
ã©u»_exŒaùÜ_cÚfig
, 
is_Œaššg
, 
»u£_weights
=
NÚe
):

168 
Args
:

169 
ã©u»_exŒaùÜ_cÚfig
: 
A
 
Fa¡”RúnF—tu»ExŒaùÜ
 
´Ùo
 
cÚfig
 
äom


170 
ç¡”_rún
.
´Ùo
.

171 
is_Œaššg
: 
True
 
this
 
ã©u»
 
exŒaùÜ
 
is
 
bešg
 
but
 
Œaššg
.

172 
»u£_weights
: 
the
 
ã©u»
 
exŒaùÜ
 
should
 
»u£
 
weights
.

174 
R‘uºs
:

175 
ç¡”_rún_m‘a_¬ch
.
Fa¡”RCNNF—tu»ExŒaùÜ
 
ba£d
 
Ú
 
cÚfig
.

177 
Rai£s
:

178 
V®ueE¼Ü
: 
On
 
šv®id
 
ã©u»
 
exŒaùÜ
 
ty³
.

180 
ã©u»_ty³
 = 
ã©u»_exŒaùÜ_cÚfig
.
ty³


181 
fœ¡_¡age_ã©u»s_¡ride
 = (

182 
ã©u»_exŒaùÜ_cÚfig
.
fœ¡_¡age_ã©u»s_¡ride
)

184 
ã©u»_ty³
 
nÙ
 
š
 
FASTER_RCNN_FEATURE_EXTRACTOR_CLASS_MAP
:

185 
¿i£
 
	`V®ueE¼Ü
('UnknowÀFa¡” R-CNN f—tu»_exŒaùÜ: {}'.
	$fÜm©
(

186 
ã©u»_ty³
))

187 
ã©u»_exŒaùÜ_şass
 = 
FASTER_RCNN_FEATURE_EXTRACTOR_CLASS_MAP
[

188 
ã©u»_ty³
]

189  
	$ã©u»_exŒaùÜ_şass
(

190 
is_Œaššg
, 
fœ¡_¡age_ã©u»s_¡ride
, 
»u£_weights
)

193 
def
 
	$_bud_ç¡”_rún_mod–
(
äún_cÚfig
, 
is_Œaššg
):

196 
Buds
 
R
-
FCN
 
mod–
 
the
 
£cÚd_¡age_box_´ediùÜ
 
š
h
cÚfig
 
is
 
of
 
ty³


197 `
rfú_box_´ediùÜ
` 
buds
 
a
 
Fa¡”
 
R
-
CNN
 
mod–
.

199 
Args
:

200 
äún_cÚfig
: 
A
 
ç¡”_rún
.
´Ùo
 
objeù
 
cÚššg
 
the
 
cÚfig
 the

201 
desœed
 
Fa¡”RCNNM‘aArch
 
Ü
 
RFCNM‘aArch
.

202 
is_Œaššg
: 
True
 
this
 
mod–
 
is
 
bešg
 
but
 
Œaššg
 
pu½o£s
.

204 
R‘uºs
:

205 
Fa¡”RCNNM‘aArch
 
ba£d
 
Ú
 
the
 
cÚfig
.

206 
Rai£s
:

207 
V®ueE¼Ü
: 
If
 
äún_cÚfig
.
ty³
 
is
 
nÙ
 
	`»cognized
 (
i
.
e
.‚Ù 
»gi¡”ed
 
š


208 
mod–_şass_m­
).

210 
num_şas£s
 = 
äún_cÚfig
.num_classes

211 
image_»siz”_â
 = 
image_»siz”_bud”
.
	$bud
(
äún_cÚfig
.
image_»siz”
)

213 
ã©u»_exŒaùÜ
 = 
	$_bud_ç¡”_rún_ã©u»_exŒaùÜ
(

214 
äún_cÚfig
.
ã©u»_exŒaùÜ
, 
is_Œaššg
)

216 
fœ¡_¡age_Úly
 = 
äún_cÚfig
.first_stage_only

217 
fœ¡_¡age_ªchÜ_g’”©Ü
 = 
ªchÜ_g’”©Ü_bud”
.
	$bud
(

218 
äún_cÚfig
.
fœ¡_¡age_ªchÜ_g’”©Ü
)

220 
fœ¡_¡age_©rous_¿‹
 = 
äún_cÚfig
.first_stage_atrous_rate

221 
fœ¡_¡age_box_´ediùÜ_¬g_scİe
 = 
hy³½¬ams_bud”
.
	$bud
(

222 
äún_cÚfig
.
fœ¡_¡age_box_´ediùÜ_cÚv_hy³½¬ams
, 
is_Œaššg
)

223 
fœ¡_¡age_box_´ediùÜ_k”Ãl_size
 = (

224 
äún_cÚfig
.
fœ¡_¡age_box_´ediùÜ_k”Ãl_size
)

225 
fœ¡_¡age_box_´ediùÜ_d•th
 = 
äún_cÚfig
.first_stage_box_predictor_depth

226 
fœ¡_¡age_mšib©ch_size
 = 
äún_cÚfig
.first_stage_minibatch_size

227 
fœ¡_¡age_pos™ive_b®ªû_äaùiÚ
 = (

228 
äún_cÚfig
.
fœ¡_¡age_pos™ive_b®ªû_äaùiÚ
)

229 
fœ¡_¡age_nms_scÜe_th»shŞd
 = 
äún_cÚfig
.first_stage_nms_score_threshold

230 
fœ¡_¡age_nms_iou_th»shŞd
 = 
äún_cÚfig
.first_stage_nms_iou_threshold

231 
fœ¡_¡age_max_´İo§ls
 = 
äún_cÚfig
.first_stage_max_proposals

232 
fœ¡_¡age_loc_loss_weight
 = (

233 
äún_cÚfig
.
fœ¡_¡age_loÿliz©iÚ_loss_weight
)

234 
fœ¡_¡age_obj_loss_weight
 = 
äún_cÚfig
.
fœ¡_¡age_objeùÃss_loss_weight


236 
š™Ÿl_üİ_size
 = 
äún_cÚfig
.initial_crop_size

237 
maxpoŞ_k”Ãl_size
 = 
äún_cÚfig
.maxpool_kernel_size

238 
maxpoŞ_¡ride
 = 
äún_cÚfig
.maxpool_stride

240 
£cÚd_¡age_box_´ediùÜ
 = 
box_´ediùÜ_bud”
.
	$bud
(

241 
hy³½¬ams_bud”
.
bud
,

242 
äún_cÚfig
.
£cÚd_¡age_box_´ediùÜ
,

243 
is_Œaššg
=is_training,

244 
num_şas£s
=num_classes)

245 
£cÚd_¡age_b©ch_size
 = 
äún_cÚfig
.second_stage_batch_size

246 
£cÚd_¡age_b®ªû_äaùiÚ
 = 
äún_cÚfig
.second_stage_balance_fraction

247 (
£cÚd_¡age_nÚ_max_suµ»ssiÚ_â
, 
£cÚd_¡age_scÜe_cÚv”siÚ_â


248 èğ
po¡_´oûssšg_bud”
.
	$bud
(
äún_cÚfig
.
£cÚd_¡age_po¡_´oûssšg
)

249 
£cÚd_¡age_loÿliz©iÚ_loss_weight
 = (

250 
äún_cÚfig
.
£cÚd_¡age_loÿliz©iÚ_loss_weight
)

251 
£cÚd_¡age_şassifiÿtiÚ_loss_weight
 = (

252 
äún_cÚfig
.
£cÚd_¡age_şassifiÿtiÚ_loss_weight
)

254 
h¬d_exam¶e_mš”
 = 
NÚe


255 
äún_cÚfig
.
	`HasF›ld
('hard_example_miner'):

256 
h¬d_exam¶e_mš”
 = 
los£s_bud”
.
	$bud_h¬d_exam¶e_mš”
(

257 
äún_cÚfig
.
h¬d_exam¶e_mš”
,

258 
£cÚd_¡age_şassifiÿtiÚ_loss_weight
,

259 
£cÚd_¡age_loÿliz©iÚ_loss_weight
)

261 
commÚ_kw¬gs
 = {

262 'is_Œaššg': 
is_Œaššg
,

263 'num_şas£s': 
num_şas£s
,

264 'image_»siz”_â': 
image_»siz”_â
,

265 'ã©u»_exŒaùÜ': 
ã©u»_exŒaùÜ
,

266 'fœ¡_¡age_Úly': 
fœ¡_¡age_Úly
,

267 'fœ¡_¡age_ªchÜ_g’”©Ü': 
fœ¡_¡age_ªchÜ_g’”©Ü
,

268 'fœ¡_¡age_©rous_¿‹': 
fœ¡_¡age_©rous_¿‹
,

270 
fœ¡_¡age_box_´ediùÜ_¬g_scİe
,

272 
fœ¡_¡age_box_´ediùÜ_k”Ãl_size
,

273 'fœ¡_¡age_box_´ediùÜ_d•th': 
fœ¡_¡age_box_´ediùÜ_d•th
,

274 'fœ¡_¡age_mšib©ch_size': 
fœ¡_¡age_mšib©ch_size
,

276 
fœ¡_¡age_pos™ive_b®ªû_äaùiÚ
,

277 'fœ¡_¡age_nms_scÜe_th»shŞd': 
fœ¡_¡age_nms_scÜe_th»shŞd
,

278 'fœ¡_¡age_nms_iou_th»shŞd': 
fœ¡_¡age_nms_iou_th»shŞd
,

279 'fœ¡_¡age_max_´İo§ls': 
fœ¡_¡age_max_´İo§ls
,

280 'fœ¡_¡age_loÿliz©iÚ_loss_weight': 
fœ¡_¡age_loc_loss_weight
,

281 'fœ¡_¡age_objeùÃss_loss_weight': 
fœ¡_¡age_obj_loss_weight
,

282 '£cÚd_¡age_b©ch_size': 
£cÚd_¡age_b©ch_size
,

283 '£cÚd_¡age_b®ªû_äaùiÚ': 
£cÚd_¡age_b®ªû_äaùiÚ
,

285 
£cÚd_¡age_nÚ_max_suµ»ssiÚ_â
,

286 '£cÚd_¡age_scÜe_cÚv”siÚ_â': 
£cÚd_¡age_scÜe_cÚv”siÚ_â
,

288 
£cÚd_¡age_loÿliz©iÚ_loss_weight
,

290 
£cÚd_¡age_şassifiÿtiÚ_loss_weight
,

291 'h¬d_exam¶e_mš”': 
h¬d_exam¶e_mš”
}

293 
	$isš¡ªû
(
£cÚd_¡age_box_´ediùÜ
, 
box_´ediùÜ
.
RfúBoxP»diùÜ
):

294  
rfú_m‘a_¬ch
.
	$RFCNM‘aArch
(

295 
£cÚd_¡age_rfú_box_´ediùÜ
=
£cÚd_¡age_box_´ediùÜ
,

296 **
commÚ_kw¬gs
)

298  
ç¡”_rún_m‘a_¬ch
.
	`Fa¡”RCNNM‘aArch
(

299 
š™Ÿl_üİ_size
=initial_crop_size,

300 
maxpoŞ_k”Ãl_size
=maxpool_kernel_size,

301 
maxpoŞ_¡ride
=maxpool_stride,

302 
£cÚd_¡age_mask_rún_box_´ediùÜ
=
£cÚd_¡age_box_´ediùÜ
,

303 **
commÚ_kw¬gs
)

	@builders/model_builder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	ggoogË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


21 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
mod–_bud”


22 
äom
 
	gobjeù_d‘eùiÚ
.
m‘a_¬ch™eùu»s
 
impÜt
 
ç¡”_rún_m‘a_¬ch


23 
äom
 
	gobjeù_d‘eùiÚ
.
m‘a_¬ch™eùu»s
 
impÜt
 
rfú_m‘a_¬ch


24 
äom
 
	gobjeù_d‘eùiÚ
.
m‘a_¬ch™eùu»s
 
impÜt
 
ssd_m‘a_¬ch


25 
äom
 
	gobjeù_d‘eùiÚ
.
mod–s
 
impÜt
 
ç¡”_rún_šû±iÚ_»¢‘_v2_ã©u»_exŒaùÜ
 
as
 
äún_šc_»s


26 
äom
 
	gobjeù_d‘eùiÚ
.
mod–s
 
impÜt
 
ç¡”_rún_»¢‘_v1_ã©u»_exŒaùÜ
 
as
 
äún_»¢‘_v1


27 
äom
 
	gobjeù_d‘eùiÚ
.
	gmod–s
.
ssd_šû±iÚ_v2_ã©u»_exŒaùÜ
 
impÜt
 
SSDInû±iÚV2F—tu»ExŒaùÜ


28 
äom
 
	gobjeù_d‘eùiÚ
.
	gmod–s
.
ssd_mob’‘_v1_ã©u»_exŒaùÜ
 
impÜt
 
SSDMobeN‘V1F—tu»ExŒaùÜ


29 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
mod–_pb2


31 
	gFEATURE_EXTRACTOR_MAPS
 = {

33 
äún_»¢‘_v1
.
Fa¡”RCNNRe¢‘50F—tu»ExŒaùÜ
,

35 
äún_»¢‘_v1
.
Fa¡”RCNNRe¢‘101F—tu»ExŒaùÜ
,

37 
äún_»¢‘_v1
.
Fa¡”RCNNRe¢‘152F—tu»ExŒaùÜ


41 
şass
 
	$Mod–Bud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

43 
def
 
	$ü—‹_mod–
(
£lf
, 
mod–_cÚfig
):

46 
Args
:

47 
mod–_cÚfig
: 
A
 
mod–
.
´Ùo
 
objeù
 
cÚššg
 
the
 
cÚfig
 th
desœed


48 
D‘eùiÚMod–
.

50 
R‘uºs
:

51 
D‘eùiÚMod–
 
ba£d
 
Ú
 
the
 
cÚfig
.

53  
mod–_bud”
.
	$bud
(
mod–_cÚfig
, 
is_Œaššg
=
True
)

55 
def
 
	$‹¡_ü—‹_ssd_šû±iÚ_v2_mod–_äom_cÚfig
(
£lf
):

56 
mod–_‹xt_´Ùo
 = """

57 
ssd
 {

58 
ã©u»_exŒaùÜ
 {

59 
ty³
: 'ssd_inception_v2'

60 
cÚv_hy³½¬ams
 {

61 
»guÏriz”
 {

62 
l2_»guÏriz”
 {

65 
š™Ÿliz”
 {

66 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

71 
box_cod”
 {

72 
ç¡”_rún_box_cod”
 {

75 
m©ch”
 {

76 
¬gmax_m©ch”
 {

79 
sim¬™y_ÿlcuÏtÜ
 {

80 
iou_sim¬™y
 {

83 
ªchÜ_g’”©Ü
 {

84 
ssd_ªchÜ_g’”©Ü
 {

85 
a¥eù_¿tios
: 1.0

88 
image_»siz”
 {

89 
fixed_sh­e_»siz”
 {

90 
height
: 320

91 
width
: 320

94 
box_´ediùÜ
 {

95 
cÚvŞutiÚ®_box_´ediùÜ
 {

96 
cÚv_hy³½¬ams
 {

97 
»guÏriz”
 {

98 
l2_»guÏriz”
 {

101 
š™Ÿliz”
 {

102 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

108 
loss
 {

109 
şassifiÿtiÚ_loss
 {

110 
weigh‹d_soámax
 {

113 
loÿliz©iÚ_loss
 {

114 
weigh‹d_smoÙh_l1
 {

118 
	}
}"""

119 
mod–_´Ùo
 = 
mod–_pb2
.
	$D‘eùiÚMod–
()

120 
‹xt_fÜm©
.
	$M”ge
(
mod–_‹xt_´Ùo
, 
mod–_´Ùo
)

121 
mod–
 = 
£lf
.
	$ü—‹_mod–
(
mod–_´Ùo
)

122 
£lf
.
	$as£¹IsIn¡ªû
(
mod–
, 
ssd_m‘a_¬ch
.
SSDM‘aArch
)

123 
£lf
.
	$as£¹IsIn¡ªû
(
mod–
.
_ã©u»_exŒaùÜ
,

124 
SSDInû±iÚV2F—tu»ExŒaùÜ
)

126 
def
 
	$‹¡_ü—‹_ssd_mob’‘_v1_mod–_äom_cÚfig
(
£lf
):

127 
mod–_‹xt_´Ùo
 = """

128 
ssd
 {

129 
ã©u»_exŒaùÜ
 {

130 
ty³
: 'ssd_mobilenet_v1'

131 
cÚv_hy³½¬ams
 {

132 
»guÏriz”
 {

133 
l2_»guÏriz”
 {

136 
š™Ÿliz”
 {

137 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

142 
box_cod”
 {

143 
ç¡”_rún_box_cod”
 {

146 
m©ch”
 {

147 
¬gmax_m©ch”
 {

150 
sim¬™y_ÿlcuÏtÜ
 {

151 
iou_sim¬™y
 {

154 
ªchÜ_g’”©Ü
 {

155 
ssd_ªchÜ_g’”©Ü
 {

156 
a¥eù_¿tios
: 1.0

159 
image_»siz”
 {

160 
fixed_sh­e_»siz”
 {

161 
height
: 320

162 
width
: 320

165 
box_´ediùÜ
 {

166 
cÚvŞutiÚ®_box_´ediùÜ
 {

167 
cÚv_hy³½¬ams
 {

168 
»guÏriz”
 {

169 
l2_»guÏriz”
 {

172 
š™Ÿliz”
 {

173 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

179 
loss
 {

180 
şassifiÿtiÚ_loss
 {

181 
weigh‹d_soámax
 {

184 
loÿliz©iÚ_loss
 {

185 
weigh‹d_smoÙh_l1
 {

189 
	}
}"""

190 
mod–_´Ùo
 = 
mod–_pb2
.
	$D‘eùiÚMod–
()

191 
‹xt_fÜm©
.
	$M”ge
(
mod–_‹xt_´Ùo
, 
mod–_´Ùo
)

192 
mod–
 = 
£lf
.
	$ü—‹_mod–
(
mod–_´Ùo
)

193 
£lf
.
	$as£¹IsIn¡ªû
(
mod–
, 
ssd_m‘a_¬ch
.
SSDM‘aArch
)

194 
£lf
.
	$as£¹IsIn¡ªû
(
mod–
.
_ã©u»_exŒaùÜ
,

195 
SSDMobeN‘V1F—tu»ExŒaùÜ
)

197 
def
 
	$‹¡_ü—‹_ç¡”_rún_»¢‘_v1_mod–s_äom_cÚfig
(
£lf
):

198 
mod–_‹xt_´Ùo
 = """

199 
ç¡”_rún
 {

200 
num_şas£s
: 3

201 
image_»siz”
 {

202 
k“p_a¥eù_¿tio_»siz”
 {

203 
mš_dim’siÚ
: 600

204 
max_dim’siÚ
: 1024

207 
ã©u»_exŒaùÜ
 {

208 
ty³
: 'faster_rcnn_resnet101'

210 
fœ¡_¡age_ªchÜ_g’”©Ü
 {

211 
grid_ªchÜ_g’”©Ü
 {

212 
sÿËs
: [0.25, 0.5, 1.0, 2.0]

213 
a¥eù_¿tios
: [0.5, 1.0, 2.0]

214 
height_¡ride
: 16

215 
width_¡ride
: 16

218 
fœ¡_¡age_box_´ediùÜ_cÚv_hy³½¬ams
 {

219 
»guÏriz”
 {

220 
l2_»guÏriz”
 {

223 
š™Ÿliz”
 {

224 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

228 
š™Ÿl_üİ_size
: 14

229 
maxpoŞ_k”Ãl_size
: 2

230 
maxpoŞ_¡ride
: 2

231 
£cÚd_¡age_box_´ediùÜ
 {

232 
mask_rún_box_´ediùÜ
 {

233 
fc_hy³½¬ams
 {

234 
İ
: 
FC


235 
»guÏriz”
 {

236 
l2_»guÏriz”
 {

239 
š™Ÿliz”
 {

240 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

246 
£cÚd_¡age_po¡_´oûssšg
 {

247 
b©ch_nÚ_max_suµ»ssiÚ
 {

248 
scÜe_th»shŞd
: 0.01

249 
iou_th»shŞd
: 0.6

250 
max_d‘eùiÚs_³r_şass
: 100

251 
max_tÙ®_d‘eùiÚs
: 300

253 
scÜe_cÚv”‹r
: 
SOFTMAX


255 
	}
}"""

256 
mod–_´Ùo
 = 
mod–_pb2
.
	$D‘eùiÚMod–
()

257 
‹xt_fÜm©
.
	$M”ge
(
mod–_‹xt_´Ùo
, 
mod–_´Ùo
)

258 
exŒaùÜ_ty³
, 
exŒaùÜ_şass
 
š
 
FEATURE_EXTRACTOR_MAPS
.
	$™ems
():

259 
mod–_´Ùo
.
ç¡”_rún
.
ã©u»_exŒaùÜ
.
ty³
 = 
exŒaùÜ_ty³


260 
mod–
 = 
mod–_bud”
.
	$bud
(
mod–_´Ùo
, 
is_Œaššg
=
True
)

261 
£lf
.
	$as£¹IsIn¡ªû
(
mod–
, 
ç¡”_rún_m‘a_¬ch
.
Fa¡”RCNNM‘aArch
)

262 
£lf
.
	$as£¹IsIn¡ªû
(
mod–
.
_ã©u»_exŒaùÜ
, 
exŒaùÜ_şass
)

264 
def
 
	$‹¡_ü—‹_ç¡”_rún_šû±iÚ_»¢‘_v2_mod–_äom_cÚfig
(
£lf
):

265 
mod–_‹xt_´Ùo
 = """

266 
ç¡”_rún
 {

267 
num_şas£s
: 3

268 
image_»siz”
 {

269 
k“p_a¥eù_¿tio_»siz”
 {

270 
mš_dim’siÚ
: 600

271 
max_dim’siÚ
: 1024

274 
ã©u»_exŒaùÜ
 {

275 
ty³
: 'faster_rcnn_inception_resnet_v2'

277 
fœ¡_¡age_ªchÜ_g’”©Ü
 {

278 
grid_ªchÜ_g’”©Ü
 {

279 
sÿËs
: [0.25, 0.5, 1.0, 2.0]

280 
a¥eù_¿tios
: [0.5, 1.0, 2.0]

281 
height_¡ride
: 16

282 
width_¡ride
: 16

285 
fœ¡_¡age_box_´ediùÜ_cÚv_hy³½¬ams
 {

286 
»guÏriz”
 {

287 
l2_»guÏriz”
 {

290 
š™Ÿliz”
 {

291 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

295 
š™Ÿl_üİ_size
: 17

296 
maxpoŞ_k”Ãl_size
: 1

297 
maxpoŞ_¡ride
: 1

298 
£cÚd_¡age_box_´ediùÜ
 {

299 
mask_rún_box_´ediùÜ
 {

300 
fc_hy³½¬ams
 {

301 
İ
: 
FC


302 
»guÏriz”
 {

303 
l2_»guÏriz”
 {

306 
š™Ÿliz”
 {

307 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

313 
£cÚd_¡age_po¡_´oûssšg
 {

314 
b©ch_nÚ_max_suµ»ssiÚ
 {

315 
scÜe_th»shŞd
: 0.01

316 
iou_th»shŞd
: 0.6

317 
max_d‘eùiÚs_³r_şass
: 100

318 
max_tÙ®_d‘eùiÚs
: 300

320 
scÜe_cÚv”‹r
: 
SOFTMAX


322 
	}
}"""

323 
mod–_´Ùo
 = 
mod–_pb2
.
	$D‘eùiÚMod–
()

324 
‹xt_fÜm©
.
	$M”ge
(
mod–_‹xt_´Ùo
, 
mod–_´Ùo
)

325 
mod–
 = 
mod–_bud”
.
	$bud
(
mod–_´Ùo
, 
is_Œaššg
=
True
)

326 
£lf
.
	$as£¹IsIn¡ªû
(
mod–
, 
ç¡”_rún_m‘a_¬ch
.
Fa¡”RCNNM‘aArch
)

327 
£lf
.
	$as£¹IsIn¡ªû
(

328 
mod–
.
_ã©u»_exŒaùÜ
,

329 
äún_šc_»s
.
Fa¡”RCNNInû±iÚRe¢‘V2F—tu»ExŒaùÜ
)

331 
def
 
	$‹¡_ü—‹_ç¡”_rún_mod–_äom_cÚfig_w™h_exam¶e_mš”
(
£lf
):

332 
mod–_‹xt_´Ùo
 = """

333 
ç¡”_rún
 {

334 
num_şas£s
: 3

335 
ã©u»_exŒaùÜ
 {

336 
ty³
: 'faster_rcnn_inception_resnet_v2'

338 
image_»siz”
 {

339 
k“p_a¥eù_¿tio_»siz”
 {

340 
mš_dim’siÚ
: 600

341 
max_dim’siÚ
: 1024

344 
fœ¡_¡age_ªchÜ_g’”©Ü
 {

345 
grid_ªchÜ_g’”©Ü
 {

346 
sÿËs
: [0.25, 0.5, 1.0, 2.0]

347 
a¥eù_¿tios
: [0.5, 1.0, 2.0]

348 
height_¡ride
: 16

349 
width_¡ride
: 16

352 
fœ¡_¡age_box_´ediùÜ_cÚv_hy³½¬ams
 {

353 
»guÏriz”
 {

354 
l2_»guÏriz”
 {

357 
š™Ÿliz”
 {

358 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

362 
£cÚd_¡age_box_´ediùÜ
 {

363 
mask_rún_box_´ediùÜ
 {

364 
fc_hy³½¬ams
 {

365 
İ
: 
FC


366 
»guÏriz”
 {

367 
l2_»guÏriz”
 {

370 
š™Ÿliz”
 {

371 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

377 
h¬d_exam¶e_mš”
 {

378 
num_h¬d_exam¶es
: 10

379 
iou_th»shŞd
: 0.99

381 
	}
}"""

382 
mod–_´Ùo
 = 
mod–_pb2
.
	$D‘eùiÚMod–
()

383 
‹xt_fÜm©
.
	$M”ge
(
mod–_‹xt_´Ùo
, 
mod–_´Ùo
)

384 
mod–
 = 
mod–_bud”
.
	$bud
(
mod–_´Ùo
, 
is_Œaššg
=
True
)

385 
£lf
.
	$as£¹IsNÙNÚe
(
mod–
.
_h¬d_exam¶e_mš”
)

387 
def
 
	$‹¡_ü—‹_rfú_»¢‘_v1_mod–_äom_cÚfig
(
£lf
):

388 
mod–_‹xt_´Ùo
 = """

389 
ç¡”_rún
 {

390 
num_şas£s
: 3

391 
image_»siz”
 {

392 
k“p_a¥eù_¿tio_»siz”
 {

393 
mš_dim’siÚ
: 600

394 
max_dim’siÚ
: 1024

397 
ã©u»_exŒaùÜ
 {

398 
ty³
: 'faster_rcnn_resnet101'

400 
fœ¡_¡age_ªchÜ_g’”©Ü
 {

401 
grid_ªchÜ_g’”©Ü
 {

402 
sÿËs
: [0.25, 0.5, 1.0, 2.0]

403 
a¥eù_¿tios
: [0.5, 1.0, 2.0]

404 
height_¡ride
: 16

405 
width_¡ride
: 16

408 
fœ¡_¡age_box_´ediùÜ_cÚv_hy³½¬ams
 {

409 
»guÏriz”
 {

410 
l2_»guÏriz”
 {

413 
š™Ÿliz”
 {

414 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

418 
š™Ÿl_üİ_size
: 14

419 
maxpoŞ_k”Ãl_size
: 2

420 
maxpoŞ_¡ride
: 2

421 
£cÚd_¡age_box_´ediùÜ
 {

422 
rfú_box_´ediùÜ
 {

423 
cÚv_hy³½¬ams
 {

424 
İ
: 
CONV


425 
»guÏriz”
 {

426 
l2_»guÏriz”
 {

429 
š™Ÿliz”
 {

430 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

436 
£cÚd_¡age_po¡_´oûssšg
 {

437 
b©ch_nÚ_max_suµ»ssiÚ
 {

438 
scÜe_th»shŞd
: 0.01

439 
iou_th»shŞd
: 0.6

440 
max_d‘eùiÚs_³r_şass
: 100

441 
max_tÙ®_d‘eùiÚs
: 300

443 
scÜe_cÚv”‹r
: 
SOFTMAX


445 
	}
}"""

446 
mod–_´Ùo
 = 
mod–_pb2
.
	$D‘eùiÚMod–
()

447 
‹xt_fÜm©
.
	$M”ge
(
mod–_‹xt_´Ùo
, 
mod–_´Ùo
)

448 
exŒaùÜ_ty³
, 
exŒaùÜ_şass
 
š
 
FEATURE_EXTRACTOR_MAPS
.
	$™ems
():

449 
mod–_´Ùo
.
ç¡”_rún
.
ã©u»_exŒaùÜ
.
ty³
 = 
exŒaùÜ_ty³


450 
mod–
 = 
mod–_bud”
.
	$bud
(
mod–_´Ùo
, 
is_Œaššg
=
True
)

451 
£lf
.
	$as£¹IsIn¡ªû
(
mod–
, 
rfú_m‘a_¬ch
.
RFCNM‘aArch
)

452 
£lf
.
	$as£¹IsIn¡ªû
(
mod–
.
_ã©u»_exŒaùÜ
, 
exŒaùÜ_şass
)

455 
__Çme__
 == '__main__':

456 
tf
.
‹¡
.
	`maš
()

	@builders/optimizer_builder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


19 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
Ë¬nšg_scheduËs


21 
	g¦im
 = 
tf
.
cÚŒib
.
¦im


24 
def
 
	$bud
(
İtimiz”_cÚfig
, 
glob®_summ¬›s
):

27 
Args
:

28 
İtimiz”_cÚfig
: 
A
 
O±imiz”
 
´Ùo
 
mes§ge
.

29 
glob®_summ¬›s
: 
A
 
£t
 
to
 
©ch
 
Ë¬nšg
 
¿‹
 
summ¬y
o.

31 
R‘uºs
:

32 
An
 
İtimiz”
.

34 
Rai£s
:

35 
V®ueE¼Ü
: 
wh’
 
usšg
 
ª
 
unsuµÜ‹d
 
šput
 
d©a
 
ty³
.

37 
İtimiz”_ty³
 = 
İtimiz”_cÚfig
.
	`WhichOÃof
('optimizer')

38 
İtimiz”
 = 
NÚe


40 
İtimiz”_ty³
 == 'rms_prop_optimizer':

41 
cÚfig
 = 
İtimiz”_cÚfig
.
rms_´İ_İtimiz”


42 
İtimiz”
 = 
tf
.
Œaš
.
	`RMSPrİO±imiz”
(

43 
	`_ü—‹_Ë¬nšg_¿‹
(
cÚfig
.
Ë¬nšg_¿‹
, 
glob®_summ¬›s
),

44 
deÿy
=
cÚfig
.decay,

45 
mom’tum
=
cÚfig
.
mom’tum_İtimiz”_v®ue
,

46 
•sÚ
=
cÚfig
.epsilon)

48 
İtimiz”_ty³
 == 'momentum_optimizer':

49 
cÚfig
 = 
İtimiz”_cÚfig
.
mom’tum_İtimiz”


50 
İtimiz”
 = 
tf
.
Œaš
.
	`Mom’tumO±imiz”
(

51 
	`_ü—‹_Ë¬nšg_¿‹
(
cÚfig
.
Ë¬nšg_¿‹
, 
glob®_summ¬›s
),

52 
mom’tum
=
cÚfig
.
mom’tum_İtimiz”_v®ue
)

54 
İtimiz”_ty³
 == 'adam_optimizer':

55 
cÚfig
 = 
İtimiz”_cÚfig
.
adam_İtimiz”


56 
İtimiz”
 = 
tf
.
Œaš
.
	`AdamO±imiz”
(

57 
	$_ü—‹_Ë¬nšg_¿‹
(
cÚfig
.
Ë¬nšg_¿‹
, 
glob®_summ¬›s
))

59 
İtimiz”
 
is
 
NÚe
:

60 
¿i£
 
	`V®ueE¼Ü
('O±imiz” % nÙ suµÜ‹d.' % 
İtimiz”_ty³
)

62 
İtimiz”_cÚfig
.
u£_movšg_av”age
:

63 
İtimiz”
 = 
tf
.
cÚŒib
.
İt
.
	$MovšgAv”ageO±imiz”
(

64 
İtimiz”
, 
av”age_deÿy
=
İtimiz”_cÚfig
.
movšg_av”age_deÿy
)

66  
İtimiz”


69 
def
 
	$_ü—‹_Ë¬nšg_¿‹
(
Ë¬nšg_¿‹_cÚfig
, 
glob®_summ¬›s
):

72 
Args
:

73 
Ë¬nšg_¿‹_cÚfig
: 
A
 
L—ºšgR©e
 
´Ùo
 
mes§ge
.

74 
glob®_summ¬›s
: 
A
 
£t
 
to
 
©ch
 
Ë¬nšg
 
¿‹
 
summ¬y
o.

76 
R‘uºs
:

77 
A
 
Ë¬nšg
 
¿‹
.

79 
Rai£s
:

80 
V®ueE¼Ü
: 
wh’
 
usšg
 
ª
 
unsuµÜ‹d
 
šput
 
d©a
 
ty³
.

82 
Ë¬nšg_¿‹
 = 
NÚe


83 
Ë¬nšg_¿‹_ty³
 = 
Ë¬nšg_¿‹_cÚfig
.
	`WhichOÃof
('learning_rate')

84 
Ë¬nšg_¿‹_ty³
 == 'constant_learning_rate':

85 
cÚfig
 = 
Ë¬nšg_¿‹_cÚfig
.
cÚ¡ªt_Ë¬nšg_¿‹


86 
Ë¬nšg_¿‹
 = 
cÚfig
.learning_rate

88 
Ë¬nšg_¿‹_ty³
 == 'exponential_decay_learning_rate':

89 
cÚfig
 = 
Ë¬nšg_¿‹_cÚfig
.
expÚ’tŸl_deÿy_Ë¬nšg_¿‹


90 
Ë¬nšg_¿‹
 = 
tf
.
Œaš
.
	`expÚ’tŸl_deÿy
(

91 
cÚfig
.
š™Ÿl_Ë¬nšg_¿‹
,

92 
¦im
.
	`g‘_Ü_ü—‹_glob®_¡•
(),

93 
cÚfig
.
deÿy_¡•s
,

94 
cÚfig
.
deÿy_çùÜ
,

95 
¡aœÿ£
=
cÚfig
.staircase)

97 
Ë¬nšg_¿‹_ty³
 == 'manual_step_learning_rate':

98 
cÚfig
 = 
Ë¬nšg_¿‹_cÚfig
.
mªu®_¡•_Ë¬nšg_¿‹


99 
nÙ
 
cÚfig
.
scheduË
:

100 
¿i£
 
	`V®ueE¼Ü
('Empty†earning„ate schedule.')

101 
Ë¬nšg_¿‹_¡•_bound¬›s
 = [
x
.
¡•
 x 
š
 
cÚfig
.
scheduË
]

102 
Ë¬nšg_¿‹_£qu’û
 = [
cÚfig
.
š™Ÿl_Ë¬nšg_¿‹
]

103 
Ë¬nšg_¿‹_£qu’û
 +ğ[
x
.
Ë¬nšg_¿‹
 x 
š
 
cÚfig
.
scheduË
]

104 
Ë¬nšg_¿‹
 = 
Ë¬nšg_scheduËs
.
	`mªu®_¡•pšg
(

105 
¦im
.
	`g‘_Ü_ü—‹_glob®_¡•
(), 
Ë¬nšg_¿‹_¡•_bound¬›s
,

106 
Ë¬nšg_¿‹_£qu’û
)

108 
Ë¬nšg_¿‹
 
is
 
NÚe
:

109 
¿i£
 
	`V®ueE¼Ü
('L—ºšg_¿‹ % nÙ suµÜ‹d.' % 
Ë¬nšg_¿‹_ty³
)

111 
glob®_summ¬›s
.
	`add
(
tf
.
summ¬y
.
	`sÿÏr
('L—ºšg R©e', 
Ë¬nšg_¿‹
))

112  
Ë¬nšg_¿‹


	@builders/optimizer_builder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	ggoogË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


22 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
İtimiz”_bud”


23 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
İtimiz”_pb2


26 
şass
 
	$L—ºšgR©eBud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

28 
def
 
	$‹¡BudCÚ¡ªtL—ºšgR©e
(
£lf
):

29 
Ë¬nšg_¿‹_‹xt_´Ùo
 = """

30 
cÚ¡ªt_Ë¬nšg_¿‹
 {

31 
Ë¬nšg_¿‹
: 0.004

32 
	}
}

34 
glob®_summ¬›s
 = 
	$£t
([])

35 
Ë¬nšg_¿‹_´Ùo
 = 
İtimiz”_pb2
.
	$L—ºšgR©e
()

36 
‹xt_fÜm©
.
	$M”ge
(
Ë¬nšg_¿‹_‹xt_´Ùo
, 
Ë¬nšg_¿‹_´Ùo
)

37 
Ë¬nšg_¿‹
 = 
İtimiz”_bud”
.
	$_ü—‹_Ë¬nšg_¿‹
(

38 
Ë¬nšg_¿‹_´Ùo
, 
glob®_summ¬›s
)

39 
£lf
.
	$as£¹Almo¡Equ®
(
Ë¬nšg_¿‹
, 0.004)

41 
def
 
	$‹¡BudExpÚ’tŸlDeÿyL—ºšgR©e
(
£lf
):

42 
Ë¬nšg_¿‹_‹xt_´Ùo
 = """

43 
expÚ’tŸl_deÿy_Ë¬nšg_¿‹
 {

44 
š™Ÿl_Ë¬nšg_¿‹
: 0.004

45 
deÿy_¡•s
: 99999

46 
deÿy_çùÜ
: 0.85

47 
¡aœÿ£
: 
çl£


48 
	}
}

50 
glob®_summ¬›s
 = 
	$£t
([])

51 
Ë¬nšg_¿‹_´Ùo
 = 
İtimiz”_pb2
.
	$L—ºšgR©e
()

52 
‹xt_fÜm©
.
	$M”ge
(
Ë¬nšg_¿‹_‹xt_´Ùo
, 
Ë¬nšg_¿‹_´Ùo
)

53 
Ë¬nšg_¿‹
 = 
İtimiz”_bud”
.
	$_ü—‹_Ë¬nšg_¿‹
(

54 
Ë¬nšg_¿‹_´Ùo
, 
glob®_summ¬›s
)

55 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
Ë¬nšg_¿‹
, 
tf
.
T’sÜ
))

57 
def
 
	$‹¡BudMªu®S‹pL—ºšgR©e
(
£lf
):

58 
Ë¬nšg_¿‹_‹xt_´Ùo
 = """

59 
mªu®_¡•_Ë¬nšg_¿‹
 {

60 
scheduË
 {

61 
¡•
: 0

62 
Ë¬nšg_¿‹
: 0.006

64 
scheduË
 {

65 
¡•
: 90000

66 
Ë¬nšg_¿‹
: 0.00006

68 
	}
}

70 
glob®_summ¬›s
 = 
	$£t
([])

71 
Ë¬nšg_¿‹_´Ùo
 = 
İtimiz”_pb2
.
	$L—ºšgR©e
()

72 
‹xt_fÜm©
.
	$M”ge
(
Ë¬nšg_¿‹_‹xt_´Ùo
, 
Ë¬nšg_¿‹_´Ùo
)

73 
Ë¬nšg_¿‹
 = 
İtimiz”_bud”
.
	$_ü—‹_Ë¬nšg_¿‹
(

74 
Ë¬nšg_¿‹_´Ùo
, 
glob®_summ¬›s
)

75 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
Ë¬nšg_¿‹
, 
tf
.
T’sÜ
))

77 
def
 
	$‹¡Rai£E¼ÜOnEm±yL—ºšgR©e
(
£lf
):

78 
Ë¬nšg_¿‹_‹xt_´Ùo
 = """

80 
glob®_summ¬›s
 = 
	$£t
([])

81 
Ë¬nšg_¿‹_´Ùo
 = 
İtimiz”_pb2
.
	$L—ºšgR©e
()

82 
‹xt_fÜm©
.
	$M”ge
(
Ë¬nšg_¿‹_‹xt_´Ùo
, 
Ë¬nšg_¿‹_´Ùo
)

83 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

84 
İtimiz”_bud”
.
	$_ü—‹_Ë¬nšg_¿‹
(

85 
Ë¬nšg_¿‹_´Ùo
, 
glob®_summ¬›s
)

88 
şass
 
	$O±imiz”Bud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

90 
def
 
	$‹¡BudRMSPrİO±imiz”
(
£lf
):

91 
İtimiz”_‹xt_´Ùo
 = """

92 
rms_´İ_İtimiz”
: {

93 
Ë¬nšg_¿‹
: {

94 
expÚ’tŸl_deÿy_Ë¬nšg_¿‹
 {

95 
š™Ÿl_Ë¬nšg_¿‹
: 0.004

96 
deÿy_¡•s
: 800720

97 
deÿy_çùÜ
: 0.95

100 
mom’tum_İtimiz”_v®ue
: 0.9

101 
deÿy
: 0.9

102 
•sÚ
: 1.0

103 
	}
}

104 
u£_movšg_av”age
: 
çl£


106 
glob®_summ¬›s
 = 
	$£t
([])

107 
İtimiz”_´Ùo
 = 
İtimiz”_pb2
.
	$O±imiz”
()

108 
‹xt_fÜm©
.
	$M”ge
(
İtimiz”_‹xt_´Ùo
, 
İtimiz”_´Ùo
)

109 
İtimiz”
 = 
İtimiz”_bud”
.
	$bud
(
İtimiz”_´Ùo
, 
glob®_summ¬›s
)

110 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
İtimiz”
, 
tf
.
Œaš
.
RMSPrİO±imiz”
))

112 
def
 
	$‹¡BudMom’tumO±imiz”
(
£lf
):

113 
İtimiz”_‹xt_´Ùo
 = """

114 
mom’tum_İtimiz”
: {

115 
Ë¬nšg_¿‹
: {

116 
cÚ¡ªt_Ë¬nšg_¿‹
 {

117 
Ë¬nšg_¿‹
: 0.001

120 
mom’tum_İtimiz”_v®ue
: 0.99

121 
	}
}

122 
u£_movšg_av”age
: 
çl£


124 
glob®_summ¬›s
 = 
	$£t
([])

125 
İtimiz”_´Ùo
 = 
İtimiz”_pb2
.
	$O±imiz”
()

126 
‹xt_fÜm©
.
	$M”ge
(
İtimiz”_‹xt_´Ùo
, 
İtimiz”_´Ùo
)

127 
İtimiz”
 = 
İtimiz”_bud”
.
	$bud
(
İtimiz”_´Ùo
, 
glob®_summ¬›s
)

128 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
İtimiz”
, 
tf
.
Œaš
.
Mom’tumO±imiz”
))

130 
def
 
	$‹¡BudAdamO±imiz”
(
£lf
):

131 
İtimiz”_‹xt_´Ùo
 = """

132 
adam_İtimiz”
: {

133 
Ë¬nšg_¿‹
: {

134 
cÚ¡ªt_Ë¬nšg_¿‹
 {

135 
Ë¬nšg_¿‹
: 0.002

138 
	}
}

139 
u£_movšg_av”age
: 
çl£


141 
glob®_summ¬›s
 = 
	$£t
([])

142 
İtimiz”_´Ùo
 = 
İtimiz”_pb2
.
	$O±imiz”
()

143 
‹xt_fÜm©
.
	$M”ge
(
İtimiz”_‹xt_´Ùo
, 
İtimiz”_´Ùo
)

144 
İtimiz”
 = 
İtimiz”_bud”
.
	$bud
(
İtimiz”_´Ùo
, 
glob®_summ¬›s
)

145 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
İtimiz”
, 
tf
.
Œaš
.
AdamO±imiz”
))

147 
def
 
	$‹¡BudMovšgAv”ageO±imiz”
(
£lf
):

148 
İtimiz”_‹xt_´Ùo
 = """

149 
adam_İtimiz”
: {

150 
Ë¬nšg_¿‹
: {

151 
cÚ¡ªt_Ë¬nšg_¿‹
 {

152 
Ë¬nšg_¿‹
: 0.002

155 
	}
}

156 
u£_movšg_av”age
: 
True


158 
glob®_summ¬›s
 = 
	$£t
([])

159 
İtimiz”_´Ùo
 = 
İtimiz”_pb2
.
	$O±imiz”
()

160 
‹xt_fÜm©
.
	$M”ge
(
İtimiz”_‹xt_´Ùo
, 
İtimiz”_´Ùo
)

161 
İtimiz”
 = 
İtimiz”_bud”
.
	$bud
(
İtimiz”_´Ùo
, 
glob®_summ¬›s
)

162 
£lf
.
	`as£¹True
(

163 
	$isš¡ªû
(
İtimiz”
, 
tf
.
cÚŒib
.
İt
.
MovšgAv”ageO±imiz”
))

165 
def
 
	$‹¡BudMovšgAv”ageO±imiz”W™hNÚDeçuÉDeÿy
(
£lf
):

166 
İtimiz”_‹xt_´Ùo
 = """

167 
adam_İtimiz”
: {

168 
Ë¬nšg_¿‹
: {

169 
cÚ¡ªt_Ë¬nšg_¿‹
 {

170 
Ë¬nšg_¿‹
: 0.002

173 
	}
}

174 
u£_movšg_av”age
: 
True


175 
movšg_av”age_deÿy
: 0.2

177 
glob®_summ¬›s
 = 
	$£t
([])

178 
İtimiz”_´Ùo
 = 
İtimiz”_pb2
.
	$O±imiz”
()

179 
‹xt_fÜm©
.
	$M”ge
(
İtimiz”_‹xt_´Ùo
, 
İtimiz”_´Ùo
)

180 
İtimiz”
 = 
İtimiz”_bud”
.
	$bud
(
İtimiz”_´Ùo
, 
glob®_summ¬›s
)

181 
£lf
.
	`as£¹True
(

182 
	$isš¡ªû
(
İtimiz”
, 
tf
.
cÚŒib
.
İt
.
MovšgAv”ageO±imiz”
))

183 #TODO: 
Fšd
 
a
 
way
 
to
 
nÙ
 
d•’d
 
Ú
 
the
 
´iv©e
 
memb”s
.

184 
£lf
.
	$as£¹Almo¡Equ®
(
İtimiz”
.
_ema
.
_deÿy
, 0.2)

186 
def
 
	$‹¡BudEm±yO±imiz”
(
£lf
):

187 
İtimiz”_‹xt_´Ùo
 = """

189 
glob®_summ¬›s
 = 
	$£t
([])

190 
İtimiz”_´Ùo
 = 
İtimiz”_pb2
.
	$O±imiz”
()

191 
‹xt_fÜm©
.
	$M”ge
(
İtimiz”_‹xt_´Ùo
, 
İtimiz”_´Ùo
)

192 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

193 
İtimiz”_bud”
.
	$bud
(
İtimiz”_´Ùo
, 
glob®_summ¬›s
)

196 
__Çme__
 == '__main__':

197 
tf
.
‹¡
.
	`maš
()

	@builders/post_processing_builder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
funùoŞs


19 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
po¡_´oûssšg


21 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
po¡_´oûssšg_pb2


24 
def
 
	$bud
(
po¡_´oûssšg_cÚfig
):

27 
Buds
 
ÿÎabËs
 
nÚ
-
max
 
suµ»ssiÚ
 
ªd
 
scÜe
 
cÚv”siÚ
 
ba£d
 
Ú
 
the


28 
cÚfigu¿tiÚ
.

30 
NÚ
-
max
 
suµ»ssiÚ
 
ÿÎabË
 
kes
 `
boxes
`, `
scÜes
`, 
ªd
 
İtiÚ®ly


31 `
ş_wšdow
`, `
·¿Î–_™”©iÚs
` 
ªd
 `
scİe
` 
as
 
šputs
. 
It
 
»tuºs


32 `
nms_boxes
`, `
nms_scÜes
`, `
nms_nms_şas£s
` 
ªd
 `
num_d‘eùiÚs
`. 
S“


33 
po¡_´oûssšg
.
b©ch_muÉişass_nÚ_max_suµ»ssiÚ
 
the
 
ty³
 
ªd
 
sh­e


34 
of
 
the£
 
‹nsÜs
.

36 
ScÜe
 
cÚv”‹r
 
ÿÎabË
 
should
 
be
 
ÿÎed
 
w™h
 `
šput
` 
‹nsÜ
. 
The
 callable

37 
»tuºs
 
the
 
ouut
 
äom
 
Úe
 
of
 3 
tf
 
İ”©iÚs
 
ba£d
 
Ú
h
cÚfigu¿tiÚ
 -

38 
tf
.
id’t™y
,f.
sigmoid
 
Ü
f.
Â
.
soámax
. 
S“
 
‹nsÜæow
 
docum’tiÚ
 

39 
¬gum’t
 
ªd
  
v®ue
 
desütiÚs
.

41 
Args
:

42 
po¡_´oûssšg_cÚfig
: 
po¡_´oûssšg
.
´Ùo
 
objeù
 
cÚššg
 
the


43 
·¿m‘”s
 
the
 
po¡
-
´oûssšg
 
İ”©iÚs
.

45 
R‘uºs
:

46 
nÚ_max_suµ»ssÜ_â
: 
C®ÏbË
 
nÚ
-
max
 
suµ»ssiÚ
.

47 
scÜe_cÚv”‹r_â
: 
C®ÏbË
 
scÜe
 
cÚv”siÚ
.

49 
Rai£s
:

50 
V®ueE¼Ü
: 
the
 
po¡_´oûssšg_cÚfig
 
is
 
of
 
šcÜ»ù
 
ty³
.

52 
nÙ
 
	$isš¡ªû
(
po¡_´oûssšg_cÚfig
, 
po¡_´oûssšg_pb2
.
Po¡Proûssšg
):

53 
¿i£
 
	`V®ueE¼Ü
('post_processing_config‚ot ofype '

55 
nÚ_max_suµ»ssÜ_â
 = 
	$_bud_nÚ_max_suµ»ssÜ
(

56 
po¡_´oûssšg_cÚfig
.
b©ch_nÚ_max_suµ»ssiÚ
)

57 
scÜe_cÚv”‹r_â
 = 
	$_bud_scÜe_cÚv”‹r
(

58 
po¡_´oûssšg_cÚfig
.
scÜe_cÚv”‹r
)

59  
nÚ_max_suµ»ssÜ_â
, 
scÜe_cÚv”‹r_â


62 
def
 
	$_bud_nÚ_max_suµ»ssÜ
(
nms_cÚfig
):

65 
Args
:

66 
nms_cÚfig
: 
po¡_´oûssšg_pb2
.
Po¡Proûssšg
.
B©chNÚMaxSuµ»ssiÚ
 
´Ùo
.

68 
R‘uºs
:

69 
nÚ_max_suµ»ssÜ_â
: 
C®ÏbË
 
nÚ
-
max
 
suµ»ssÜ
.

71 
Rai£s
:

72 
V®ueE¼Ü
: 
On
 
šcÜ»ù
 
iou_th»shŞd
 
Ü
 
Ú
 
šcom·tibË
 
v®ues
 
of


73 
max_tÙ®_d‘eùiÚs
 
ªd
 
max_d‘eùiÚs_³r_şass
.

75 
nms_cÚfig
.
iou_th»shŞd
 < 0 
Ü
‚ms_config.iou_threshold > 1.0:

76 
¿i£
 
	`V®ueE¼Ü
('iou_threshold‚ot in [0, 1.0].')

77 
nms_cÚfig
.
max_d‘eùiÚs_³r_şass
 >‚ms_cÚfig.
max_tÙ®_d‘eùiÚs
:

78 
¿i£
 
	`V®ueE¼Ü
('max_detections_per_class should be‚o greaterhan '

81 
nÚ_max_suµ»ssÜ_â
 = 
funùoŞs
.
	$·¹Ÿl
(

82 
po¡_´oûssšg
.
b©ch_muÉişass_nÚ_max_suµ»ssiÚ
,

83 
scÜe_th»sh
=
nms_cÚfig
.
scÜe_th»shŞd
,

84 
iou_th»sh
=
nms_cÚfig
.
iou_th»shŞd
,

85 
max_size_³r_şass
=
nms_cÚfig
.
max_d‘eùiÚs_³r_şass
,

86 
max_tÙ®_size
=
nms_cÚfig
.
max_tÙ®_d‘eùiÚs
)

87  
nÚ_max_suµ»ssÜ_â


90 
def
 
	$_bud_scÜe_cÚv”‹r
(
scÜe_cÚv”‹r_cÚfig
):

93 
Buds
 
Úe
 
of
 [
tf
.
id’t™y
,f.
sigmoid
,f.
soámax
] 
scÜe
 
cÚv”‹rs
 
ba£d
 
Ú


94 
the
 
cÚfig
.

96 
Args
:

97 
scÜe_cÚv”‹r_cÚfig
: 
po¡_´oûssšg_pb2
.
Po¡Proûssšg
.
scÜe_cÚv”‹r
.

99 
R‘uºs
:

100 
C®ÏbË
 
scÜe
 
cÚv”‹r
 
İ
.

102 
Rai£s
:

103 
V®ueE¼Ü
: 
On
 
unknown
 
scÜe
 
cÚv”‹r
.

105 
scÜe_cÚv”‹r_cÚfig
 =ğ
po¡_´oûssšg_pb2
.
Po¡Proûssšg
.
IDENTITY
:

106  
tf
.
id’t™y


107 
scÜe_cÚv”‹r_cÚfig
 =ğ
po¡_´oûssšg_pb2
.
Po¡Proûssšg
.
SIGMOID
:

108  
tf
.
sigmoid


109 
scÜe_cÚv”‹r_cÚfig
 =ğ
po¡_´oûssšg_pb2
.
Po¡Proûssšg
.
SOFTMAX
:

110  
tf
.
Â
.
soámax


111 
¿i£
 
	`V®ueE¼Ü
('Unknown score converter.')

	@builders/post_processing_builder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


19 
äom
 
	ggoogË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


20 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
po¡_´oûssšg_bud”


21 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
po¡_´oûssšg_pb2


24 
şass
 
	$Po¡ProûssšgBud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$‹¡_bud_nÚ_max_suµ»ssÜ_w™h_cÜ»ù_·¿m‘”s
(
£lf
):

27 
po¡_´oûssšg_‹xt_´Ùo
 = """

28 
b©ch_nÚ_max_suµ»ssiÚ
 {

29 
scÜe_th»shŞd
: 0.7

30 
iou_th»shŞd
: 0.6

31 
max_d‘eùiÚs_³r_şass
: 100

32 
max_tÙ®_d‘eùiÚs
: 300

33 
	}
}

35 
po¡_´oûssšg_cÚfig
 = 
po¡_´oûssšg_pb2
.
	$Po¡Proûssšg
()

36 
‹xt_fÜm©
.
	$M”ge
(
po¡_´oûssšg_‹xt_´Ùo
, 
po¡_´oûssšg_cÚfig
)

37 
nÚ_max_suµ»ssÜ
, 
_
 = 
po¡_´oûssšg_bud”
.
	$bud
(

38 
po¡_´oûssšg_cÚfig
)

39 
£lf
.
	`as£¹Equ®
(
nÚ_max_suµ»ssÜ
.
keywÜds
['max_size_per_class'], 100)

40 
£lf
.
	`as£¹Equ®
(
nÚ_max_suµ»ssÜ
.
keywÜds
['max_total_size'], 300)

41 
£lf
.
	`as£¹Almo¡Equ®
(
nÚ_max_suµ»ssÜ
.
keywÜds
['score_thresh'], 0.7)

42 
£lf
.
	`as£¹Almo¡Equ®
(
nÚ_max_suµ»ssÜ
.
keywÜds
['iou_thresh'], 0.6)

44 
def
 
	$‹¡_bud_id’t™y_scÜe_cÚv”‹r
(
£lf
):

45 
po¡_´oûssšg_‹xt_´Ùo
 = """

46 
scÜe_cÚv”‹r
: 
IDENTITY


48 
po¡_´oûssšg_cÚfig
 = 
po¡_´oûssšg_pb2
.
	$Po¡Proûssšg
()

49 
‹xt_fÜm©
.
	$M”ge
(
po¡_´oûssšg_‹xt_´Ùo
, 
po¡_´oûssšg_cÚfig
)

50 
_
, 
scÜe_cÚv”‹r
 = 
po¡_´oûssšg_bud”
.
	$bud
(
po¡_´oûssšg_cÚfig
)

51 
£lf
.
	$as£¹Equ®
(
scÜe_cÚv”‹r
, 
tf
.
id’t™y
)

53 
def
 
	$‹¡_bud_sigmoid_scÜe_cÚv”‹r
(
£lf
):

54 
po¡_´oûssšg_‹xt_´Ùo
 = """

55 
scÜe_cÚv”‹r
: 
SIGMOID


57 
po¡_´oûssšg_cÚfig
 = 
po¡_´oûssšg_pb2
.
	$Po¡Proûssšg
()

58 
‹xt_fÜm©
.
	$M”ge
(
po¡_´oûssšg_‹xt_´Ùo
, 
po¡_´oûssšg_cÚfig
)

59 
_
, 
scÜe_cÚv”‹r
 = 
po¡_´oûssšg_bud”
.
	$bud
(
po¡_´oûssšg_cÚfig
)

60 
£lf
.
	$as£¹Equ®
(
scÜe_cÚv”‹r
, 
tf
.
sigmoid
)

62 
def
 
	$‹¡_bud_soámax_scÜe_cÚv”‹r
(
£lf
):

63 
po¡_´oûssšg_‹xt_´Ùo
 = """

64 
scÜe_cÚv”‹r
: 
SOFTMAX


66 
po¡_´oûssšg_cÚfig
 = 
po¡_´oûssšg_pb2
.
	$Po¡Proûssšg
()

67 
‹xt_fÜm©
.
	$M”ge
(
po¡_´oûssšg_‹xt_´Ùo
, 
po¡_´oûssšg_cÚfig
)

68 
_
, 
scÜe_cÚv”‹r
 = 
po¡_´oûssšg_bud”
.
	$bud
(
po¡_´oûssšg_cÚfig
)

69 
£lf
.
	$as£¹Equ®
(
scÜe_cÚv”‹r
, 
tf
.
Â
.
soámax
)

72 
__Çme__
 == '__main__':

73 
tf
.
‹¡
.
	`maš
()

	@builders/preprocessor_builder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
´•roûssÜ


21 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
´•roûssÜ_pb2


24 
def
 
	$_g‘_¡•_cÚfig_äom_´Ùo
(
´•roûssÜ_¡•_cÚfig
, 
¡•_Çme
):

27 
Args
:

28 
´•roûssÜ_¡•_cÚfig
: 
A
 
´•roûssÜ_pb2
.
P»´oûssšgS‹p
 
objeù
.

29 
¡•_Çme
: 
Name
 
of
 
the
 
f›ld
 
to
 
g‘
 
v®ue
 
äom
.

31 
R‘uºs
:

32 
»suÉ_diù
: 
a
 
sub
 
´Ùo
 
mes§ge
 
äom
 
´•roûssÜ_¡•_cÚfig
 
which
 
wl
 
be


33 
Ï‹r
 
cÚv”‹d
 
to
 
a
 
diùiÚ¬y
.

35 
Rai£s
:

36 
V®ueE¼Ü
: 
If
 
f›ld
 
dÛs
 
nÙ
 
exi¡
 
š
 
´Ùo
.

38 
f›ld
, 
v®ue
 
š
 
´•roûssÜ_¡•_cÚfig
.
	$Li¡F›lds
():

39 
f›ld
.
Çme
 =ğ
¡•_Çme
:

40  
v®ue


42 
¿i£
 
	`V®ueE¼Ü
('Could‚Ù g‘ f›ld % äom…rÙo!', 
¡•_Çme
)

45 
def
 
	$_g‘_diù_äom_´Ùo
(
cÚfig
):

48 
FÜ
 
mªy
 
´•roûssšg
 
¡•s
, 
th”e
's‡nrivial 1-1 mapping from…roto fields

49 
to
 
funùiÚ
 
¬gum’ts
. 
This
 funùiÚ 
autom©iÿÎy
 
pİuÏ‹s
 
a
 
diùiÚ¬y
 
w™h


50 
the
 
¬gum’ts
 
äom
h
´Ùo
.

52 
PrÙos
 
th©
 
CANNOT
 
be
 
ŒivŸÎy
 
pİuÏ‹d
 
šşude
:

53 * 
Ã¡ed
 
mes§ges
.

54 * 
¡•s
 
th©
 
check
 
ª
 
İtiÚ®
 
f›ld
 
is
 
	`£t
 (
›
. 
wh”e
 
NÚe
 != 0).

55 * 
´Ùos
 
th©
 
dÚ
't map 1-1o‡rguments (ie.†ist should be„eshaped).

56 * 
f›lds
 
»quœšg
 
add™iÚ®
 
	`v®id©iÚ
 (
›
. 
»³©ed
 
f›ld
 
has
 
n
 
–em’ts
).

58 
Args
:

59 
cÚfig
: 
A
 
´Ùobuf
 
objeù
 
th©
 
dÛs
 
nÙ
 
viŞ©e
 
the
 
cÚd™iÚs
 
above
.

61 
R‘uºs
:

62 
»suÉ_diù
: |
cÚfig
| 
cÚv”‹d
 
što
 
a
 
pythÚ
 
diùiÚ¬y
.

64 
»suÉ_diù
 = {
	}
}

65 
f›ld
, 
v®ue
 
š
 
	gcÚfig
.
	$Li¡F›lds
():

66 
»suÉ_diù
[
f›ld
.
Çme
] = 
v®ue


67  
»suÉ_diù


70 #A 
m­
 
äom
 
a
 
P»´oûssšgS‹p
 
´Ùo
 
cÚfig
 
f›ld
 
Çme
 
to
 
the
 
´•roûssšg


71 #funùiÚ 
th©
 
should
 
be
 
u£d
. 
The
 
P»´oûssšgS‹p
 
´Ùo
 should b
·r§bË


72 #w™h 
_g‘_diù_äom_´Ùo
.

73 
PREPROCESSING_FUNCTION_MAP
 = {

74 'nÜm®ize_image': 
´•roûssÜ
.
nÜm®ize_image
,

75 '¿ndom_hÜizÚl_æ': 
´•roûssÜ
.
¿ndom_hÜizÚl_æ
,

76 '¿ndom_pix–_v®ue_sÿË': 
´•roûssÜ
.
¿ndom_pix–_v®ue_sÿË
,

77 '¿ndom_image_sÿË': 
´•roûssÜ
.
¿ndom_image_sÿË
,

78 '¿ndom_rgb_to_g¿y': 
´•roûssÜ
.
¿ndom_rgb_to_g¿y
,

79 '¿ndom_adju¡_brighŠess': 
´•roûssÜ
.
¿ndom_adju¡_brighŠess
,

80 '¿ndom_adju¡_cÚŒa¡': 
´•roûssÜ
.
¿ndom_adju¡_cÚŒa¡
,

81 '¿ndom_adju¡_hue': 
´•roûssÜ
.
¿ndom_adju¡_hue
,

82 '¿ndom_adju¡_§tu¿tiÚ': 
´•roûssÜ
.
¿ndom_adju¡_§tu¿tiÚ
,

83 '¿ndom_di¡Üt_cŞÜ': 
´•roûssÜ
.
¿ndom_di¡Üt_cŞÜ
,

84 '¿ndom_j™‹r_boxes': 
´•roûssÜ
.
¿ndom_j™‹r_boxes
,

85 '¿ndom_üİ_to_a¥eù_¿tio': 
´•roûssÜ
.
¿ndom_üİ_to_a¥eù_¿tio
,

86 '¿ndom_bÏck_·tches': 
´•roûssÜ
.
¿ndom_bÏck_·tches
,

88 
´•roûssÜ
.
sÿË_boxes_to_pix–_coÜdš©es
),

89 'subŒaù_chªÃl_m—n': 
´•roûssÜ
.
subŒaù_chªÃl_m—n
,

90 
	}
}

93 #A 
m­
 
to
 
cÚv”t
 
äom
 
´•roûssÜ_pb2
.
ResizeImage
.
M‘hod
 to

94 #tf.
image
.
ResizeM‘hod
.

95 
RESIZE_METHOD_MAP
 = {

96 
´•roûssÜ_pb2
.
ResizeImage
.
AREA
: 
tf
.
image
.
ResizeM‘hod
.AREA,

97 
´•roûssÜ_pb2
.
ResizeImage
.
BICUBIC
: 
tf
.
image
.
ResizeM‘hod
.BICUBIC,

98 
´•roûssÜ_pb2
.
ResizeImage
.
BILINEAR
: 
tf
.
image
.
ResizeM‘hod
.BILINEAR,

99 
´•roûssÜ_pb2
.
ResizeImage
.
NEAREST_NEIGHBOR
: (

100 
tf
.
image
.
ResizeM‘hod
.
NEAREST_NEIGHBOR
),

104 
def
 
	$bud
(
´•roûssÜ_¡•_cÚfig
):

107 
Args
:

108 
´•roûssÜ_¡•_cÚfig
: 
P»´oûssšgS‹p
 
cÚfigu¿tiÚ
 
´Ùo
.

110 
R‘uºs
:

111 
funùiÚ
, 
¬gm­
: 
A
 
ÿÎabË
 funùiÚ 
ªd
 
ª
 
¬gum’t
 
m­
 
to
 
ÿÎ
 function

112 
w™h
.

114 
Rai£s
:

115 
V®ueE¼Ü
: 
On
 
šv®id
 
cÚfigu¿tiÚ
.

117 
¡•_ty³
 = 
´•roûssÜ_¡•_cÚfig
.
	`WhichOÃof
('preprocessing_step')

119 
¡•_ty³
 
š
 
PREPROCESSING_FUNCTION_MAP
:

120 
´•roûssšg_funùiÚ
 = 
PREPROCESSING_FUNCTION_MAP
[
¡•_ty³
]

121 
¡•_cÚfig
 = 
	$_g‘_¡•_cÚfig_äom_´Ùo
(
´•roûssÜ_¡•_cÚfig
,

122 
¡•_ty³
)

123 
funùiÚ_¬gs
 = 
	$_g‘_diù_äom_´Ùo
(
¡•_cÚfig
)

124  (
´•roûssšg_funùiÚ
, 
funùiÚ_¬gs
)

126 
¡•_ty³
 == 'random_crop_image':

127 
cÚfig
 = 
´•roûssÜ_¡•_cÚfig
.
¿ndom_üİ_image


128  (
´•roûssÜ
.
¿ndom_üİ_image
,

130 'mš_objeù_cov”ed': 
cÚfig
.
mš_objeù_cov”ed
,

131 'a¥eù_¿tio_¿nge': (
cÚfig
.
mš_a¥eù_¿tio
,

132 
cÚfig
.
max_a¥eù_¿tio
),

133 '¬—_¿nge': (
cÚfig
.
mš_¬—
, cÚfig.
max_¬—
),

134 'ov”Ïp_th»sh': 
cÚfig
.
ov”Ïp_th»sh
,

135 '¿ndom_cÛf': 
cÚfig
.
¿ndom_cÛf
,

136 
	}
})

138 
	g¡•_ty³
 == 'random_pad_image':

139 
cÚfig
 = 
´•roûssÜ_¡•_cÚfig
.
¿ndom_·d_image


140 
mš_image_size
 = 
NÚe


141 ià(
cÚfig
.
HasF›ld
('min_image_height') !=

142 
cÚfig
.
HasF›ld
('min_image_width')):

143 
¿i£
 
V®ueE¼Ü
('min_image_height‡nd min_image_width should beƒither '

145 
cÚfig
.
HasF›ld
('min_image_height'):

146 
mš_image_size
 = (
cÚfig
.
mš_image_height
, 
	gcÚfig
.
	gmš_image_width
)

148 
	gmax_image_size
 = 
NÚe


149 ià(
cÚfig
.
HasF›ld
('max_image_height') !=

150 
cÚfig
.
HasF›ld
('max_image_width')):

151 
¿i£
 
V®ueE¼Ü
('max_image_height‡nd max_image_width should beƒither '

153 
cÚfig
.
HasF›ld
('max_image_height'):

154 
max_image_size
 = (
cÚfig
.
max_image_height
, 
	gcÚfig
.
	gmax_image_width
)

156 
	g·d_cŞÜ
 = 
cÚfig
.
·d_cŞÜ


157 
·d_cŞÜ
 
ªd
 
Ën
(pad_color) != 3:

158 
¿i£
 
V®ueE¼Ü
('pad_color should have 3ƒlements (RGB) if set!')

159 
nÙ
 
·d_cŞÜ
:

160 
·d_cŞÜ
 = 
NÚe


161  (
´•roûssÜ
.
¿ndom_·d_image
,

163 'mš_image_size': 
mš_image_size
,

164 'max_image_size': 
max_image_size
,

165 '·d_cŞÜ': 
·d_cŞÜ
,

168 
	g¡•_ty³
 == 'random_crop_pad_image':

169 
cÚfig
 = 
´•roûssÜ_¡•_cÚfig
.
¿ndom_üİ_·d_image


170 
mš_·dded_size_¿tio
 = 
cÚfig
.min_padded_size_ratio

171 
mš_·dded_size_¿tio
 
ªd
 
Ën
(min_padded_size_ratio) != 2:

172 
¿i£
 
V®ueE¼Ü
('min_padded_size_ratio should have 3ƒlements if set!')

173 
max_·dded_size_¿tio
 = 
cÚfig
.max_padded_size_ratio

174 
max_·dded_size_¿tio
 
ªd
 
Ën
(max_padded_size_ratio) != 2:

175 
¿i£
 
V®ueE¼Ü
('max_padded_size_ratio should have 3ƒlements if set!')

176 
·d_cŞÜ
 = 
cÚfig
.pad_color

177 
·d_cŞÜ
 
ªd
 
Ën
(pad_color) != 3:

178 
¿i£
 
V®ueE¼Ü
('pad_color should have 3ƒlements if set!')

179  (
´•roûssÜ
.
¿ndom_üİ_·d_image
,

181 'mš_objeù_cov”ed': 
cÚfig
.
mš_objeù_cov”ed
,

182 'a¥eù_¿tio_¿nge': (
cÚfig
.
mš_a¥eù_¿tio
,

183 
	gcÚfig
.
	gmax_a¥eù_¿tio
),

184 '¬—_¿nge': (
cÚfig
.
mš_¬—
, 
	gcÚfig
.
	gmax_¬—
),

185 'ov”Ïp_th»sh': 
cÚfig
.
ov”Ïp_th»sh
,

186 '¿ndom_cÛf': 
cÚfig
.
¿ndom_cÛf
,

187 'mš_·dded_size_¿tio': (
mš_·dded_size_¿tio
 

188 
mš_·dded_size_¿tio
 
NÚe
),

189 'max_·dded_size_¿tio': (
max_·dded_size_¿tio
 

190 
max_·dded_size_¿tio
 
NÚe
),

191 '·d_cŞÜ': (
·d_cŞÜ
 ·d_cŞÜ 
NÚe
),

194 
	g¡•_ty³
 == 'random_resize_method':

195 
cÚfig
 = 
´•roûssÜ_¡•_cÚfig
.
¿ndom_»size_m‘hod


196  (
´•roûssÜ
.
¿ndom_»size_m‘hod
,

198 'rg‘_size': [
cÚfig
.
rg‘_height
, cÚfig.
rg‘_width
],

201 
	g¡•_ty³
 == 'resize_image':

202 
cÚfig
 = 
´•roûssÜ_¡•_cÚfig
.
»size_image


203 
m‘hod
 = 
RESIZE_METHOD_MAP
[
cÚfig
.method]

204  (
´•roûssÜ
.
»size_image
,

206 'Ãw_height': 
cÚfig
.
Ãw_height
,

207 'Ãw_width': 
cÚfig
.
Ãw_width
,

208 'm‘hod': 
m‘hod


211 
¡•_ty³
 == 'ssd_random_crop':

212 
cÚfig
 = 
´•roûssÜ_¡•_cÚfig
.
ssd_¿ndom_üİ


213 
cÚfig
.
İ”©iÚs
:

214 
mš_objeù_cov”ed
 = [
İ
.mš_objeù_cov”ed İ 
š
 
cÚfig
.
İ”©iÚs
]

215 
a¥eù_¿tio_¿nge
 = [(
İ
.
mš_a¥eù_¿tio
, op.
max_a¥eù_¿tio
)

216 
İ
 
š
 
cÚfig
.
İ”©iÚs
]

217 
	g¬—_¿nge
 = [(
İ
.
mš_¬—
, op.
max_¬—
èİ 
š
 
cÚfig
.
İ”©iÚs
]

218 
	gov”Ïp_th»sh
 = [
İ
.
ov”Ïp_th»sh
 İ 
š
 
cÚfig
.
İ”©iÚs
]

219 
¿ndom_cÛf
 = [
İ
.¿ndom_cÛàİ 
š
 
cÚfig
.
İ”©iÚs
]

220  (
´•roûssÜ
.
ssd_¿ndom_üİ
,

222 'mš_objeù_cov”ed': 
mš_objeù_cov”ed
,

223 'a¥eù_¿tio_¿nge': 
a¥eù_¿tio_¿nge
,

224 '¬—_¿nge': 
¬—_¿nge
,

225 'ov”Ïp_th»sh': 
ov”Ïp_th»sh
,

226 '¿ndom_cÛf': 
¿ndom_cÛf
,

228  (
	g´•roûssÜ
.
	gssd_¿ndom_üİ
, {})

230 
	g¡•_ty³
 == 'ssd_random_crop_pad':

231 
cÚfig
 = 
´•roûssÜ_¡•_cÚfig
.
ssd_¿ndom_üİ_·d


232 
cÚfig
.
İ”©iÚs
:

233 
mš_objeù_cov”ed
 = [
İ
.mš_objeù_cov”ed İ 
š
 
cÚfig
.
İ”©iÚs
]

234 
a¥eù_¿tio_¿nge
 = [(
İ
.
mš_a¥eù_¿tio
, op.
max_a¥eù_¿tio
)

235 
İ
 
š
 
cÚfig
.
İ”©iÚs
]

236 
	g¬—_¿nge
 = [(
İ
.
mš_¬—
, op.
max_¬—
èİ 
š
 
cÚfig
.
İ”©iÚs
]

237 
	gov”Ïp_th»sh
 = [
İ
.
ov”Ïp_th»sh
 İ 
š
 
cÚfig
.
İ”©iÚs
]

238 
¿ndom_cÛf
 = [
İ
.¿ndom_cÛàİ 
š
 
cÚfig
.
İ”©iÚs
]

239 
mš_·dded_size_¿tio
 = [

240 (
İ
.
mš_·dded_size_¿tio
[0], 
	gİ
.
	gmš_·dded_size_¿tio
[1])

241 
İ
 
š
 
	gcÚfig
.
	gİ”©iÚs
]

242 
	gmax_·dded_size_¿tio
 = [

243 (
İ
.
max_·dded_size_¿tio
[0], 
	gİ
.
	gmax_·dded_size_¿tio
[1])

244 
İ
 
š
 
	gcÚfig
.
	gİ”©iÚs
]

245 
	g·d_cŞÜ
 = [(
İ
.
·d_cŞÜ_r
, op.
·d_cŞÜ_g
, op.
·d_cŞÜ_b
)

246 
İ
 
š
 
cÚfig
.
İ”©iÚs
]

247  (
	g´•roûssÜ
.
	gssd_¿ndom_üİ_·d
,

249 'mš_objeù_cov”ed': 
mš_objeù_cov”ed
,

250 'a¥eù_¿tio_¿nge': 
a¥eù_¿tio_¿nge
,

251 '¬—_¿nge': 
¬—_¿nge
,

252 'ov”Ïp_th»sh': 
ov”Ïp_th»sh
,

253 '¿ndom_cÛf': 
¿ndom_cÛf
,

254 'mš_·dded_size_¿tio': 
mš_·dded_size_¿tio
,

255 'max_·dded_size_¿tio': 
max_·dded_size_¿tio
,

256 '·d_cŞÜ': 
·d_cŞÜ
,

258  (
	g´•roûssÜ
.
	gssd_¿ndom_üİ_·d
, {})

260 
	g¡•_ty³
 == 'ssd_random_crop_fixed_aspect_ratio':

261 
cÚfig
 = 
´•roûssÜ_¡•_cÚfig
.
ssd_¿ndom_üİ_fixed_a¥eù_¿tio


262 
cÚfig
.
İ”©iÚs
:

263 
mš_objeù_cov”ed
 = [
İ
.mš_objeù_cov”ed İ 
š
 
cÚfig
.
İ”©iÚs
]

264 
¬—_¿nge
 = [(
İ
.
mš_¬—
, op.
max_¬—
èİ 
š
 
cÚfig
.
İ”©iÚs
]

265 
	gov”Ïp_th»sh
 = [
İ
.
ov”Ïp_th»sh
 İ 
š
 
cÚfig
.
İ”©iÚs
]

266 
¿ndom_cÛf
 = [
İ
.¿ndom_cÛàİ 
š
 
cÚfig
.
İ”©iÚs
]

267  (
´•roûssÜ
.
ssd_¿ndom_üİ_fixed_a¥eù_¿tio
,

269 'mš_objeù_cov”ed': 
mš_objeù_cov”ed
,

270 'a¥eù_¿tio': 
cÚfig
.
a¥eù_¿tio
,

271 '¬—_¿nge': 
¬—_¿nge
,

272 'ov”Ïp_th»sh': 
ov”Ïp_th»sh
,

273 '¿ndom_cÛf': 
¿ndom_cÛf
,

275  (
	g´•roûssÜ
.
	gssd_¿ndom_üİ_fixed_a¥eù_¿tio
, {})

277 
¿i£
 
V®ueE¼Ü
('Unknown…reprocessing step.')

	@builders/preprocessor_builder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	ggoogË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


22 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
´•roûssÜ_bud”


23 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
´•roûssÜ


24 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
´•roûssÜ_pb2


27 
şass
 
	$P»´oûssÜBud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

29 
def
 
	$as£¹_diùiÚ¬y_şo£
(
£lf
, 
diù1
, 
diù2
):

31 
£lf
.
	`as£¹Equ®
(
	`sÜ‹d
(
diù1
.
	`keys
()), sÜ‹d(
diù2
.
	$keys
()))

32 
key
 
š
 
diù1
:

33 
v®ue
 = 
diù1
[
key
]

34 
	$isš¡ªû
(
v®ue
, ):

35 
£lf
.
	$as£¹Almo¡Equ®
(
v®ue
, 
diù2
[
key
])

37 
£lf
.
	$as£¹Equ®
(
v®ue
, 
diù2
[
key
])

39 
def
 
	$‹¡_bud_nÜm®ize_image
(
£lf
):

40 
´•roûssÜ_‹xt_´Ùo
 = """

41 
nÜm®ize_image
 {

42 
Üigš®_mšv®
: 0.0

43 
Üigš®_maxv®
: 255.0

44 
rg‘_mšv®
: -1.0

45 
rg‘_maxv®
: 1.0

46 
	}
}

48 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

49 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

50 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

51 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
nÜm®ize_image
)

52 
£lf
.
	`as£¹Equ®
(
¬gs
, {

57 
	}
})

59 
def
 
	$‹¡_bud_¿ndom_hÜizÚl_æ
(
£lf
):

60 
´•roûssÜ_‹xt_´Ùo
 = """

61 
¿ndom_hÜizÚl_æ
 {

62 
	}
}

64 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

65 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

66 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

67 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
¿ndom_hÜizÚl_æ
)

68 
£lf
.
	`as£¹Equ®
(
¬gs
, {
	}
})

70 
def
 
	$‹¡_bud_¿ndom_pix–_v®ue_sÿË
(
£lf
):

71 
´•roûssÜ_‹xt_´Ùo
 = """

72 
¿ndom_pix–_v®ue_sÿË
 {

73 
mšv®
: 0.8

74 
maxv®
: 1.2

75 
	}
}

77 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

78 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

79 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

80 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
¿ndom_pix–_v®ue_sÿË
)

81 
£lf
.
	`as£¹_diùiÚ¬y_şo£
(
¬gs
, {'mšv®': 0.8, 'maxv®': 1.2
	}
})

83 
def
 
	$‹¡_bud_¿ndom_image_sÿË
(
£lf
):

84 
´•roûssÜ_‹xt_´Ùo
 = """

85 
¿ndom_image_sÿË
 {

86 
mš_sÿË_¿tio
: 0.8

87 
max_sÿË_¿tio
: 2.2

88 
	}
}

90 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

91 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

92 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

93 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
¿ndom_image_sÿË
)

94 
£lf
.
	`as£¹_diùiÚ¬y_şo£
(
¬gs
, {'min_scale_ratio': 0.8,

95 'max_sÿË_¿tio': 2.2
	}
})

97 
def
 
	$‹¡_bud_¿ndom_rgb_to_g¿y
(
£lf
):

98 
´•roûssÜ_‹xt_´Ùo
 = """

99 
¿ndom_rgb_to_g¿y
 {

100 
´obab™y
: 0.8

101 
	}
}

103 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

104 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

105 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

106 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
¿ndom_rgb_to_g¿y
)

107 
£lf
.
	`as£¹_diùiÚ¬y_şo£
(
¬gs
, {'´obab™y': 0.8
	}
})

109 
def
 
	$‹¡_bud_¿ndom_adju¡_brighŠess
(
£lf
):

110 
´•roûssÜ_‹xt_´Ùo
 = """

111 
¿ndom_adju¡_brighŠess
 {

112 
max_d–
: 0.2

113 
	}
}

115 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

116 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

117 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

118 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
¿ndom_adju¡_brighŠess
)

119 
£lf
.
	`as£¹_diùiÚ¬y_şo£
(
¬gs
, {'max_d–': 0.2
	}
})

121 
def
 
	$‹¡_bud_¿ndom_adju¡_cÚŒa¡
(
£lf
):

122 
´•roûssÜ_‹xt_´Ùo
 = """

123 
¿ndom_adju¡_cÚŒa¡
 {

124 
mš_d–
: 0.7

125 
max_d–
: 1.1

126 
	}
}

128 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

129 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

130 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

131 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
¿ndom_adju¡_cÚŒa¡
)

132 
£lf
.
	`as£¹_diùiÚ¬y_şo£
(
¬gs
, {'mš_d–': 0.7, 'max_d–': 1.1
	}
})

134 
def
 
	$‹¡_bud_¿ndom_adju¡_hue
(
£lf
):

135 
´•roûssÜ_‹xt_´Ùo
 = """

136 
¿ndom_adju¡_hue
 {

137 
max_d–
: 0.01

138 
	}
}

140 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

141 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

142 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

143 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
¿ndom_adju¡_hue
)

144 
£lf
.
	`as£¹_diùiÚ¬y_şo£
(
¬gs
, {'max_d–': 0.01
	}
})

146 
def
 
	$‹¡_bud_¿ndom_adju¡_§tu¿tiÚ
(
£lf
):

147 
´•roûssÜ_‹xt_´Ùo
 = """

148 
¿ndom_adju¡_§tu¿tiÚ
 {

149 
mš_d–
: 0.75

150 
max_d–
: 1.15

151 
	}
}

153 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

154 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

155 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

156 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
¿ndom_adju¡_§tu¿tiÚ
)

157 
£lf
.
	`as£¹_diùiÚ¬y_şo£
(
¬gs
, {'mš_d–': 0.75, 'max_d–': 1.15
	}
})

159 
def
 
	$‹¡_bud_¿ndom_di¡Üt_cŞÜ
(
£lf
):

160 
´•roûssÜ_‹xt_´Ùo
 = """

161 
¿ndom_di¡Üt_cŞÜ
 {

162 
cŞÜ_Üd”šg
: 1

163 
	}
}

165 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

166 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

167 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

168 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
¿ndom_di¡Üt_cŞÜ
)

169 
£lf
.
	`as£¹Equ®
(
¬gs
, {'cŞÜ_Üd”šg': 1
	}
})

171 
def
 
	$‹¡_bud_¿ndom_j™‹r_boxes
(
£lf
):

172 
´•roûssÜ_‹xt_´Ùo
 = """

173 
¿ndom_j™‹r_boxes
 {

174 
¿tio
: 0.1

175 
	}
}

177 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

178 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

179 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

180 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
¿ndom_j™‹r_boxes
)

181 
£lf
.
	`as£¹_diùiÚ¬y_şo£
(
¬gs
, {'¿tio': 0.1
	}
})

183 
def
 
	$‹¡_bud_¿ndom_üİ_image
(
£lf
):

184 
´•roûssÜ_‹xt_´Ùo
 = """

185 
¿ndom_üİ_image
 {

186 
mš_objeù_cov”ed
: 0.75

187 
mš_a¥eù_¿tio
: 0.75

188 
max_a¥eù_¿tio
: 1.5

189 
mš_¬—
: 0.25

190 
max_¬—
: 0.875

191 
ov”Ïp_th»sh
: 0.5

192 
¿ndom_cÛf
: 0.125

193 
	}
}

195 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

196 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

197 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

198 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
¿ndom_üİ_image
)

199 
£lf
.
	`as£¹Equ®
(
¬gs
, {

205 
	}
})

207 
def
 
	$‹¡_bud_¿ndom_·d_image
(
£lf
):

208 
´•roûssÜ_‹xt_´Ùo
 = """

209 
¿ndom_·d_image
 {

210 
	}
}

212 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

213 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

214 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

215 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
¿ndom_·d_image
)

216 
£lf
.
	`as£¹Equ®
(
¬gs
, {

217 'mš_image_size': 
NÚe
,

218 'max_image_size': 
NÚe
,

219 '·d_cŞÜ': 
NÚe
,

220 
	}
})

222 
def
 
	$‹¡_bud_¿ndom_üİ_·d_image
(
£lf
):

223 
´•roûssÜ_‹xt_´Ùo
 = """

224 
¿ndom_üİ_·d_image
 {

225 
mš_objeù_cov”ed
: 0.75

226 
mš_a¥eù_¿tio
: 0.75

227 
max_a¥eù_¿tio
: 1.5

228 
mš_¬—
: 0.25

229 
max_¬—
: 0.875

230 
ov”Ïp_th»sh
: 0.5

231 
¿ndom_cÛf
: 0.125

232 
	}
}

234 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

235 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

236 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

237 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
¿ndom_üİ_·d_image
)

238 
£lf
.
	`as£¹Equ®
(
¬gs
, {

244 'mš_·dded_size_¿tio': 
NÚe
,

245 'max_·dded_size_¿tio': 
NÚe
,

246 '·d_cŞÜ': 
NÚe
,

247 
	}
})

249 
def
 
	$‹¡_bud_¿ndom_üİ_to_a¥eù_¿tio
(
£lf
):

250 
´•roûssÜ_‹xt_´Ùo
 = """

251 
¿ndom_üİ_to_a¥eù_¿tio
 {

252 
a¥eù_¿tio
: 0.85

253 
ov”Ïp_th»sh
: 0.35

254 
	}
}

256 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

257 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

258 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

259 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
¿ndom_üİ_to_a¥eù_¿tio
)

260 
£lf
.
	`as£¹_diùiÚ¬y_şo£
(
¬gs
, {'aspect_ratio': 0.85,

261 'ov”Ïp_th»sh': 0.35
	}
})

263 
def
 
	$‹¡_bud_¿ndom_bÏck_·tches
(
£lf
):

264 
´•roûssÜ_‹xt_´Ùo
 = """

265 
¿ndom_bÏck_·tches
 {

266 
max_bÏck_·tches
: 20

267 
´obab™y
: 0.95

268 
size_to_image_¿tio
: 0.12

269 
	}
}

271 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

272 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

273 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

274 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
¿ndom_bÏck_·tches
)

275 
£lf
.
	`as£¹_diùiÚ¬y_şo£
(
¬gs
, {'max_black_patches': 20,

277 'size_to_image_¿tio': 0.12
	}
})

279 
def
 
	$‹¡_bud_¿ndom_»size_m‘hod
(
£lf
):

280 
´•roûssÜ_‹xt_´Ùo
 = """

281 
¿ndom_»size_m‘hod
 {

282 
rg‘_height
: 75

283 
rg‘_width
: 100

284 
	}
}

286 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

287 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

288 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

289 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
¿ndom_»size_m‘hod
)

290 
£lf
.
	`as£¹_diùiÚ¬y_şo£
(
¬gs
, {'rg‘_size': [75, 100]
	}
})

292 
def
 
	$‹¡_bud_sÿË_boxes_to_pix–_coÜdš©es
(
£lf
):

293 
´•roûssÜ_‹xt_´Ùo
 = """

294 
sÿË_boxes_to_pix–_coÜdš©es
 {
	}
}

296 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

297 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

298 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

299 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
sÿË_boxes_to_pix–_coÜdš©es
)

300 
£lf
.
	`as£¹Equ®
(
¬gs
, {
	}
})

302 
def
 
	$‹¡_bud_»size_image
(
£lf
):

303 
´•roûssÜ_‹xt_´Ùo
 = """

304 
»size_image
 {

305 
Ãw_height
: 75

306 
Ãw_width
: 100

307 
m‘hod
: 
BICUBIC


308 
	}
}

310 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

311 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

312 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

313 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
»size_image
)

314 
£lf
.
	`as£¹Equ®
(
¬gs
, {'new_height': 75,

316 'm‘hod': 
tf
.
image
.
ResizeM‘hod
.
BICUBIC
})

318 
def
 
	$‹¡_bud_subŒaù_chªÃl_m—n
(
£lf
):

319 
´•roûssÜ_‹xt_´Ùo
 = """

320 
subŒaù_chªÃl_m—n
 {

321 
m—ns
: [1.0, 2.0, 3.0]

322 
	}
}

324 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

325 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

326 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

327 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
subŒaù_chªÃl_m—n
)

328 
£lf
.
	`as£¹Equ®
(
¬gs
, {'m—ns': [1.0, 2.0, 3.0]
	}
})

330 
def
 
	$‹¡_bud_ssd_¿ndom_üİ
(
£lf
):

331 
´•roûssÜ_‹xt_´Ùo
 = """

332 
ssd_¿ndom_üİ
 {

333 
İ”©iÚs
 {

334 
mš_objeù_cov”ed
: 0.0

335 
mš_a¥eù_¿tio
: 0.875

336 
max_a¥eù_¿tio
: 1.125

337 
mš_¬—
: 0.5

338 
max_¬—
: 1.0

339 
ov”Ïp_th»sh
: 0.0

340 
¿ndom_cÛf
: 0.375

342 
İ”©iÚs
 {

343 
mš_objeù_cov”ed
: 0.25

344 
mš_a¥eù_¿tio
: 0.75

345 
max_a¥eù_¿tio
: 1.5

346 
mš_¬—
: 0.5

347 
max_¬—
: 1.0

348 
ov”Ïp_th»sh
: 0.25

349 
¿ndom_cÛf
: 0.375

351 
	}
}

353 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

354 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

355 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

356 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
ssd_¿ndom_üİ
)

357 
£lf
.
	`as£¹Equ®
(
¬gs
, {'min_object_covered': [0.0, 0.25],

361 '¿ndom_cÛf': [0.375, 0.375]
	}
})

363 
def
 
	$‹¡_bud_ssd_¿ndom_üİ_em±y_İ”©iÚs
(
£lf
):

364 
´•roûssÜ_‹xt_´Ùo
 = """

365 
ssd_¿ndom_üİ
 {

366 
	}
}

368 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

369 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

370 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

371 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
ssd_¿ndom_üİ
)

372 
£lf
.
	`as£¹Equ®
(
¬gs
, {
	}
})

374 
def
 
	$‹¡_bud_ssd_¿ndom_üİ_·d
(
£lf
):

375 
´•roûssÜ_‹xt_´Ùo
 = """

376 
ssd_¿ndom_üİ_·d
 {

377 
İ”©iÚs
 {

378 
mš_objeù_cov”ed
: 0.0

379 
mš_a¥eù_¿tio
: 0.875

380 
max_a¥eù_¿tio
: 1.125

381 
mš_¬—
: 0.5

382 
max_¬—
: 1.0

383 
ov”Ïp_th»sh
: 0.0

384 
¿ndom_cÛf
: 0.375

385 
mš_·dded_size_¿tio
: [0.0, 0.0]

386 
max_·dded_size_¿tio
: [2.0, 2.0]

387 
·d_cŞÜ_r
: 0.5

388 
·d_cŞÜ_g
: 0.5

389 
·d_cŞÜ_b
: 0.5

391 
İ”©iÚs
 {

392 
mš_objeù_cov”ed
: 0.25

393 
mš_a¥eù_¿tio
: 0.75

394 
max_a¥eù_¿tio
: 1.5

395 
mš_¬—
: 0.5

396 
max_¬—
: 1.0

397 
ov”Ïp_th»sh
: 0.25

398 
¿ndom_cÛf
: 0.375

399 
mš_·dded_size_¿tio
: [0.0, 0.0]

400 
max_·dded_size_¿tio
: [2.0, 2.0]

401 
·d_cŞÜ_r
: 0.5

402 
·d_cŞÜ_g
: 0.5

403 
·d_cŞÜ_b
: 0.5

405 
	}
}

407 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

408 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

409 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

410 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
ssd_¿ndom_üİ_·d
)

411 
£lf
.
	`as£¹Equ®
(
¬gs
, {'min_object_covered': [0.0, 0.25],

418 '·d_cŞÜ': [(0.5, 0.5, 0.5), (0.5, 0.5, 0.5)]
	}
})

420 
def
 
	$‹¡_bud_ssd_¿ndom_üİ_fixed_a¥eù_¿tio
(
£lf
):

421 
´•roûssÜ_‹xt_´Ùo
 = """

422 
ssd_¿ndom_üİ_fixed_a¥eù_¿tio
 {

423 
İ”©iÚs
 {

424 
mš_objeù_cov”ed
: 0.0

425 
mš_¬—
: 0.5

426 
max_¬—
: 1.0

427 
ov”Ïp_th»sh
: 0.0

428 
¿ndom_cÛf
: 0.375

430 
İ”©iÚs
 {

431 
mš_objeù_cov”ed
: 0.25

432 
mš_¬—
: 0.5

433 
max_¬—
: 1.0

434 
ov”Ïp_th»sh
: 0.25

435 
¿ndom_cÛf
: 0.375

437 
a¥eù_¿tio
: 0.875

438 
	}
}

440 
´•roûssÜ_´Ùo
 = 
´•roûssÜ_pb2
.
	$P»´oûssšgS‹p
()

441 
‹xt_fÜm©
.
	$M”ge
(
´•roûssÜ_‹xt_´Ùo
, 
´•roûssÜ_´Ùo
)

442 
funùiÚ
, 
¬gs
 = 
´•roûssÜ_bud”
.
	$bud
(
´•roûssÜ_´Ùo
)

443 
£lf
.
	$as£¹Equ®
(
funùiÚ
, 
´•roûssÜ
.
ssd_¿ndom_üİ_fixed_a¥eù_¿tio
)

444 
£lf
.
	`as£¹Equ®
(
¬gs
, {'min_object_covered': [0.0, 0.25],

448 '¿ndom_cÛf': [0.375, 0.375]
	}
})

451 
	g__Çme__
 == '__main__':

452 
tf
.
‹¡
.
maš
()

	@builders/region_similarity_calculator_builder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
»giÚ_sim¬™y_ÿlcuÏtÜ


19 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
»giÚ_sim¬™y_ÿlcuÏtÜ_pb2


22 
def
 
	$bud
(
»giÚ_sim¬™y_ÿlcuÏtÜ_cÚfig
):

25 
Buds
 
Úe
 
of
 [
IouSim¬™y
, 
IßSim¬™y
, 
NegSqDi¡Sim¬™y
] 
objeùs
. 
S“


26 
cÜe
/
»giÚ_sim¬™y_ÿlcuÏtÜ
.
´Ùo
 
d‘as
.

28 
Args
:

29 
»giÚ_sim¬™y_ÿlcuÏtÜ_cÚfig
: 
RegiÚSim¬™yC®cuÏtÜ


30 
cÚfigu¿tiÚ
 
´Ùo
.

32 
R‘uºs
:

33 
»giÚ_sim¬™y_ÿlcuÏtÜ
: 
RegiÚSim¬™yC®cuÏtÜ
 
objeù
.

35 
Rai£s
:

36 
V®ueE¼Ü
: 
On
 
unknown
 
»giÚ
 
sim¬™y
 
ÿlcuÏtÜ
.

39 
nÙ
 
	$isš¡ªû
(

40 
»giÚ_sim¬™y_ÿlcuÏtÜ_cÚfig
,

41 
»giÚ_sim¬™y_ÿlcuÏtÜ_pb2
.
RegiÚSim¬™yC®cuÏtÜ
):

42 
¿i£
 
	`V®ueE¼Ü
(

46 
sim¬™y_ÿlcuÏtÜ
 = 
»giÚ_sim¬™y_ÿlcuÏtÜ_cÚfig
.
	`WhichOÃof
(

48 
sim¬™y_ÿlcuÏtÜ
 == 'iou_similarity':

49  
»giÚ_sim¬™y_ÿlcuÏtÜ
.
	$IouSim¬™y
()

50 
sim¬™y_ÿlcuÏtÜ
 == 'ioa_similarity':

51  
»giÚ_sim¬™y_ÿlcuÏtÜ
.
	$IßSim¬™y
()

52 
sim¬™y_ÿlcuÏtÜ
 == 'neg_sq_dist_similarity':

53  
»giÚ_sim¬™y_ÿlcuÏtÜ
.
	$NegSqDi¡Sim¬™y
()

55 
¿i£
 
	`V®ueE¼Ü
('Unknown„egion similarity calculator.')

	@builders/region_similarity_calculator_builder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	ggoogË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


21 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
»giÚ_sim¬™y_ÿlcuÏtÜ_bud”


22 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
»giÚ_sim¬™y_ÿlcuÏtÜ


23 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
»giÚ_sim¬™y_ÿlcuÏtÜ_pb2
 
as
 
sim_ÿlc_pb2


26 
şass
 
	$RegiÚSim¬™yC®cuÏtÜBud”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

28 
def
 
	$‹¡BudIßSim¬™yC®cuÏtÜ
(
£lf
):

29 
sim¬™y_ÿlc_‹xt_´Ùo
 = """

30 
iß_sim¬™y
 {

31 
	}
}

33 
sim¬™y_ÿlc_´Ùo
 = 
sim_ÿlc_pb2
.
	$RegiÚSim¬™yC®cuÏtÜ
()

34 
‹xt_fÜm©
.
	$M”ge
(
sim¬™y_ÿlc_‹xt_´Ùo
, 
sim¬™y_ÿlc_´Ùo
)

35 
sim¬™y_ÿlc
 = 
»giÚ_sim¬™y_ÿlcuÏtÜ_bud”
.
	$bud
(

36 
sim¬™y_ÿlc_´Ùo
)

37 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
sim¬™y_ÿlc
,

38 
»giÚ_sim¬™y_ÿlcuÏtÜ
.
IßSim¬™y
))

40 
def
 
	$‹¡BudIouSim¬™yC®cuÏtÜ
(
£lf
):

41 
sim¬™y_ÿlc_‹xt_´Ùo
 = """

42 
iou_sim¬™y
 {

43 
	}
}

45 
sim¬™y_ÿlc_´Ùo
 = 
sim_ÿlc_pb2
.
	$RegiÚSim¬™yC®cuÏtÜ
()

46 
‹xt_fÜm©
.
	$M”ge
(
sim¬™y_ÿlc_‹xt_´Ùo
, 
sim¬™y_ÿlc_´Ùo
)

47 
sim¬™y_ÿlc
 = 
»giÚ_sim¬™y_ÿlcuÏtÜ_bud”
.
	$bud
(

48 
sim¬™y_ÿlc_´Ùo
)

49 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
sim¬™y_ÿlc
,

50 
»giÚ_sim¬™y_ÿlcuÏtÜ
.
IouSim¬™y
))

52 
def
 
	$‹¡BudNegSqDi¡Sim¬™yC®cuÏtÜ
(
£lf
):

53 
sim¬™y_ÿlc_‹xt_´Ùo
 = """

54 
Ãg_sq_di¡_sim¬™y
 {

55 
	}
}

57 
sim¬™y_ÿlc_´Ùo
 = 
sim_ÿlc_pb2
.
	$RegiÚSim¬™yC®cuÏtÜ
()

58 
‹xt_fÜm©
.
	$M”ge
(
sim¬™y_ÿlc_‹xt_´Ùo
, 
sim¬™y_ÿlc_´Ùo
)

59 
sim¬™y_ÿlc
 = 
»giÚ_sim¬™y_ÿlcuÏtÜ_bud”
.
	$bud
(

60 
sim¬™y_ÿlc_´Ùo
)

61 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
sim¬™y_ÿlc
,

62 
»giÚ_sim¬™y_ÿlcuÏtÜ
.

63 
NegSqDi¡Sim¬™y
))

66 
__Çme__
 == '__main__':

67 
tf
.
‹¡
.
	`maš
()

	@core/__init__.py

	@core/anchor_generator.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
The
 
job
 
of
 
the
 
ªchÜ
 
g’”©Ü
 
is
 
to
 
	$ü—‹
 (
Ü
 
lßd
è
a
 
cŞËùiÚ


19 
of
 
boundšg
 
boxes
 
to
 
be
 
u£d
 
as
 
ªchÜs
.

21 
G’”©ed
 
ªchÜs
 
¬e
 
assumed
 
to
 
m©ch
 
some
 
cÚvŞutiÚ®
 
grid
 
Ü
 
li¡
 
of
 grid

22 
sh­es
. 
FÜ
 
exam¶e
, 
we
 
might
 
wªt
 
to
 
g’”©e
 
ªchÜs
 
m©chšg
 
ª
 8x8

23 
ã©u»
 
m­
 
ªd
 
a
 4x4 f—tu» m­. 
If
 
we
 
¶aû
 3 
ªchÜs
 
³r
 
grid
 
loÿtiÚ


24 
Ú
 
the
 
fœ¡
 
ã©u»
 
m­
 
ªd
 6 
ªchÜs
 
³r
 
grid
 
loÿtiÚ
 oÀth
£cÚd
 feature

25 
m­
, 
th’
 3*8*8 + 6*4*4 = 288 
ªchÜs
 
¬e
 
g’”©ed
 
š
 
tÙ®
.

27 
To
 
suµÜt
 
fuÎy
 
cÚvŞutiÚ®
 
£‰šgs
, 
ã©u»
 
m­
 
sh­es
 
¬e
 
·s£d


28 
dyÇmiÿÎy
 
©
 
g’”©iÚ
 
time
. 
The
 
numb”
 
of
 
ªchÜs
 
to
 
¶aû
‡ˆ
—ch
 
loÿtiÚ


29 
is
 --- 
im¶em’tiÚs
 
of
 
AnchÜG’”©Ü
 
mu¡
 
®ways
 
be
 
abË
 

30 
the
 
numb”
 
of
 
ªchÜs
 
th©
 
™
 
u£s
 
³r
 
loÿtiÚ
 
—ch
 
ã©u»
 
m­
.

32 
äom
 
abc
 
impÜt
 
ABCM‘a


33 
äom
 
abc
 
impÜt
 
ab¡¿ùm‘hod


35 
impÜt
 
‹nsÜæow
 
as
 
tf


38 
şass
 
	$AnchÜG’”©Ü
(
objeù
):

40 
__m‘aşass__
 = 
ABCM‘a


42 @
ab¡¿ùm‘hod


43 
def
 
	$Çme_scİe
(
£lf
):

46 
Mu¡
 
be
 
defšed
 
by
 
im¶em’tiÚs
.

48 
R‘uºs
:

49 
a
 
¡ršg
 
»´e£Ášg
 
the
 
Çme
 
scİe
 
of
h
ªchÜ
 
g’”©iÚ
 
İ”©iÚ
.

51 
·ss


53 @
´İ”ty


54 
def
 
	$check_num_ªchÜs
(
£lf
):

57 
Cª
 
be
 
ov”ridd’
 
by
 
im¶em’tiÚs
 
th©
 
would
 
like
 
to
 
di§bË
 
this


58 
behaviÜ
.

60 
R‘uºs
:

61 
a
 
boŞ—n
 
cÚŒŞlšg
 
wh‘h”
 
the
 
G’”©e
 
funùiÚ
 
should
 
dyÇmiÿÎy


62 
check
 
the
 
numb”
 
of
 
ªchÜs
 
g’”©ed
 
agaš¡
h
m©hem©iÿÎy


63 
ex³ùed
 
numb”
 
of
 
ªchÜs
.

65  
True


67 @
ab¡¿ùm‘hod


68 
def
 
	$num_ªchÜs_³r_loÿtiÚ
(
£lf
):

71 
R‘uºs
:

72 
a
 
li¡
 
of
 
š‹g”s
, 
Úe
 
—ch
 
ex³ùed
 
ã©u»
 
m­
 
to
 
be
 
·s£d
o

73 
the
 `
g’”©e
` 
funùiÚ
.

75 
·ss


77 
def
 
	$g’”©e
(
£lf
, 
ã©u»_m­_sh­e_li¡
, **
·¿ms
):

80 
TODO
: 
»move
 **
·¿ms
 
äom
 
¬gum’t
 
li¡
 
ªd
 
make
 
¡ride
‡nd 
	$off£ts
 (

81 
muÉË_grid_ªchÜ_g’”©Ü
è
cÚ¡ruùÜ
 
¬gum’ts
.

83 
Args
:

84 
ã©u»_m­_sh­e_li¡
: 
li¡
 
	$of
 (
height
, 
width
è
·œs
 
š
 
the
 
fÜm©


85 [(
height_0
, 
width_0
), (
height_1
, 
width_1
), ...] 
th©
 
the
 
g’”©ed


86 
ªchÜs
 
mu¡
 
®ign
 
w™h
. 
Paœs
 
ÿn
 
be
 
´ovided
 
as
 1-
dim’siÚ®


87 
š‹g”
 
‹nsÜs
 
of
 
Ëngth
 2 
Ü
 
sim¶y
 
as
 
tu¶es
 oà
š‹g”s
.

88 **
·¿ms
: 
·¿m‘”s
 
ªchÜ
 
g’”©iÚ
 
İ


90 
R‘uºs
:

91 
boxes
: 
a
 
BoxLi¡
 
hŞdšg
‡ 
cŞËùiÚ
 
of
 
N
 
ªchÜ
 boxes

92 
Rai£s
:

93 
V®ueE¼Ü
: 
the
 
numb”
 
of
 
ã©u»
 
m­
 
sh­es
 
dÛs
 
nÙ
 
m©ch
h
Ëngth


94 
of
 
NumAnchÜsP”LoÿtiÚ
.

96 
£lf
.
check_num_ªchÜs
 
	`ªd
 (

97 
	`Ën
(
ã©u»_m­_sh­e_li¡
è!ğËn(
£lf
.
	$num_ªchÜs_³r_loÿtiÚ
())):

98 
¿i£
 
	`V®ueE¼Ü
('Number of feature maps isƒxpectedoƒqualhe†ength '

100 
w™h
 
tf
.
	`Çme_scİe
(
£lf
.
	$Çme_scİe
()):

101 
ªchÜs
 = 
£lf
.
	$_g’”©e
(
ã©u»_m­_sh­e_li¡
, **
·¿ms
)

102 
£lf
.
check_num_ªchÜs
:

103 
w™h
 
tf
.
	`cÚŒŞ_d•’d’c›s
([

104 
£lf
.
	`_as£¹_cÜ»ù_numb”_of_ªchÜs
(

105 
ªchÜs
, 
ã©u»_m­_sh­e_li¡
)]):

106 
ªchÜs
.
	`£t
(
tf
.
	`id’t™y
×nchÜs.
	$g‘
()))

107  
ªchÜs


109 @
ab¡¿ùm‘hod


110 
def
 
	$_g’”©e
(
£lf
, 
ã©u»_m­_sh­e_li¡
, **
·¿ms
):

113 
Args
:

114 
ã©u»_m­_sh­e_li¡
: 
li¡
 
	$of
 (
height
, 
width
è
·œs
 
š
 
the
 
fÜm©


115 [(
height_0
, 
width_0
), (
height_1
, 
width_1
), ...] 
th©
 
the
 
g’”©ed


116 
ªchÜs
 
mu¡
 
®ign
 
w™h
.

117 **
·¿ms
: 
·¿m‘”s
 
ªchÜ
 
g’”©iÚ
 
İ


119 
R‘uºs
:

120 
boxes
: 
a
 
BoxLi¡
 
hŞdšg
‡ 
cŞËùiÚ
 
of
 
N
 
ªchÜ
 boxes

122 
·ss


124 
def
 
	$_as£¹_cÜ»ù_numb”_of_ªchÜs
(
£lf
, 
ªchÜs
, 
ã©u»_m­_sh­e_li¡
):

127 
Args
:

128 
ªchÜs
: 
box_li¡
.
BoxLi¡
 
objeù
 
hŞdšg
‡nchÜ 
g’”©ed


129 
ã©u»_m­_sh­e_li¡
: 
li¡
 
	$of
 (
height
, 
width
è
·œs
 
š
 
the
 
fÜm©


130 [(
height_0
, 
width_0
), (
height_1
, 
width_1
), ...] 
th©
 
the
 
g’”©ed


131 
ªchÜs
 
mu¡
 
®ign
 
w™h
.

132 
R‘uºs
:

133 
Op
 
th©
 
¿i£s
 
Inv®idArgum’tE¼Ü
 
the
 
numb”
 
of
 
ªchÜs
 
dÛs
 
nÙ


134 
m©ch
 
the
 
numb”
 
of
 
ex³ùed
 
ªchÜs
.

136 
ex³ùed_num_ªchÜs
 = 0

137 
num_ªchÜs_³r_loÿtiÚ
, 
ã©u»_m­_sh­e
 
š
 
	`z
(

138 
£lf
.
	`num_ªchÜs_³r_loÿtiÚ
(), 
ã©u»_m­_sh­e_li¡
):

139 
ex³ùed_num_ªchÜs
 +ğ(
num_ªchÜs_³r_loÿtiÚ


140 * 
ã©u»_m­_sh­e
[0]

141 * 
ã©u»_m­_sh­e
[1])

142  
tf
.
	`as£¹_equ®
(
ex³ùed_num_ªchÜs
, 
ªchÜs
.
	`num_boxes
())

	@core/balanced_positive_negative_sampler.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
Sub§m¶es
 
mšib©ches
 
ba£d
 
Ú
 
a
 
	g´e
-
¥ecif›d
 
pos™ive
 
äaùiÚ
 
š
 
	g¿nge


19 [0,1]. 
The
 
şass
 
´esumes
 
th”e
 
¬e
 
mªy
 
mÜe
 
Ãg©ives
 
thª
 
pos™ive
 
	gexam¶es
:

20 
the
 
desœed
 
b©ch_size
 
ÿÂÙ
 
be
 
ach›ved
 
w™h
h
´e
-
¥ecif›d
 
pos™ive


21 
äaùiÚ
, 
™
 
fls
 
the
 
»¡
 
w™h
 
Ãg©ive
 
	gexam¶es
. 
If
 
this
 
is
 
nÙ
 
suffic›Á


22 
obššg
 
the
 
desœed
 
	gb©ch_size
, 
™
 
»tuºs
 
ãw”
 
	gexam¶es
.

24 
The
 
maš
 
funùiÚ
 
to
 
ÿÎ
 
is
 
Sub§m¶e
(
£lf
, 
šdiÿtÜ
, 
Ïb–s
). 
FÜ
 
cÚv’›nû


25 
Úe
 
ÿn
 
®so
 
ÿÎ
 
	$Sub§m¶eWeights
(
£lf
, 
weights
, 
Ïb–s
è
which
 
is
 
defšed
 
š


26 
the
 
mšib©ch_§m¶”
 
ba£
 
şass
.

29 
impÜt
 
‹nsÜæow
 
as
 
tf


31 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
mšib©ch_§m¶”


34 
şass
 
	$B®ªûdPos™iveNeg©iveSam¶”
(
mšib©ch_§m¶”
.
Mšib©chSam¶”
):

37 
def
 
	$__š™__
(
£lf
, 
pos™ive_äaùiÚ
=0.5):

40 
Args
:

41 
pos™ive_äaùiÚ
: 
desœed
 
äaùiÚ
 
of
 
pos™ive
 
	$exam¶es
 (
sÿÏr
 
š
 [0,1])

43 
Rai£s
:

44 
V®ueE¼Ü
: 
pos™ive_äaùiÚ
 < 0, 
Ü
…ositive_fraction > 1

46 
pos™ive_äaùiÚ
 < 0 
Ü
…ositive_fraction > 1:

47 
¿i£
 
	`V®ueE¼Ü
('positive_fraction should be in„ange [0,1]. '

48 'Reûived: %s.' % 
pos™ive_äaùiÚ
)

49 
£lf
.
_pos™ive_äaùiÚ
 = 
pos™ive_äaùiÚ


51 
def
 
	$sub§m¶e
(
£lf
, 
šdiÿtÜ
, 
b©ch_size
, 
Ïb–s
):

54 
Args
:

55 
šdiÿtÜ
: 
boŞ—n
 
‹nsÜ
 
of
 
sh­e
 [
N
] 
who£
 
True
 
’Œ›s
 
ÿn
 
be
 
§m¶ed
.

56 
b©ch_size
: 
desœed
 
b©ch
 
size
.

57 
Ïb–s
: 
boŞ—n
 
‹nsÜ
 
of
 
sh­e
 [
N
] 
d’Ùšg
 
	$pos™ive
(=
True
è
ªd
 
Ãg©ive


58 (=
F®£
è
exam¶es
.

60 
R‘uºs
:

61 
is_§m¶ed
: 
boŞ—n
 
‹nsÜ
 
of
 
sh­e
 [
N
], 
True
 
’Œ›s
 
which
 
¬e


62 
§m¶ed
.

64 
Rai£s
:

65 
V®ueE¼Ü
: 
Ïb–s
 
ªd
 
šdiÿtÜ
 
¬e
 
nÙ
 1D 
boŞ—n
 
‹nsÜs
.

67 
	`Ën
(
šdiÿtÜ
.
	`g‘_sh­e
().
	`as_li¡
()) != 1:

68 
¿i£
 
	`V®ueE¼Ü
('indicator must be 1 dimensional, got‡ensor of '

69 'sh­%s' % 
šdiÿtÜ
.
	$g‘_sh­e
())

70 
	`Ën
(
Ïb–s
.
	`g‘_sh­e
().
	`as_li¡
()) != 1:

71 
¿i£
 
	`V®ueE¼Ü
('labels must be 1 dimensional, got‡ensor of '

72 'sh­%s' % 
Ïb–s
.
	$g‘_sh­e
())

73 
Ïb–s
.
dty³
 !ğ
tf
.
boŞ
:

74 
¿i£
 
	`V®ueE¼Ü
('labels should be ofype bool. Received: %s' %

75 
Ïb–s
.
dty³
)

76 
šdiÿtÜ
.
dty³
 !ğ
tf
.
boŞ
:

77 
¿i£
 
	`V®ueE¼Ü
('indicator should be ofype bool. Received: %s' %

78 
šdiÿtÜ
.
dty³
)

80 #OÆy 
§m¶e
 
äom
 
šdiÿ‹d
 
§m¶es


81 
Ãg©ive_idx
 = 
tf
.
	$logiÿl_nÙ
(
Ïb–s
)

82 
pos™ive_idx
 = 
tf
.
	$logiÿl_ªd
(
Ïb–s
, 
šdiÿtÜ
)

83 
Ãg©ive_idx
 = 
tf
.
	$logiÿl_ªd
(
Ãg©ive_idx
, 
šdiÿtÜ
)

85 #Sam¶
pos™ive
 
ªd
 
Ãg©ive
 
§m¶es
 
£·¿‹ly


86 
max_num_pos
 = (
£lf
.
_pos™ive_äaùiÚ
 * 
b©ch_size
)

87 
§m¶ed_pos_idx
 = 
£lf
.
	$sub§m¶e_šdiÿtÜ
(
pos™ive_idx
, 
max_num_pos
)

88 
max_num_Ãg
 = 
b©ch_size
 - 
tf
.
	`»duû_sum
Ñf.
	$ÿ¡
(
§m¶ed_pos_idx
, 
tf
.
št32
))

89 
§m¶ed_Ãg_idx
 = 
£lf
.
	$sub§m¶e_šdiÿtÜ
(
Ãg©ive_idx
, 
max_num_Ãg
)

91 
§m¶ed_idx
 = 
tf
.
	$logiÿl_Ü
(
§m¶ed_pos_idx
, 
§m¶ed_Ãg_idx
)

92  
§m¶ed_idx


	@core/balanced_positive_negative_sampler_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
numpy
 
as
 
Å


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
b®ªûd_pos™ive_Ãg©ive_§m¶”


24 
şass
 
	$B®ªûdPos™iveNeg©iveSam¶”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$‹¡_sub§m¶e_®l_exam¶es
(
£lf
):

27 
numpy_Ïb–s
 = 
Å
.
¿ndom
.
	$³rmutiÚ
(300)

28 
šdiÿtÜ
 = 
tf
.
	`cÚ¡ªt
(
Å
.
	`Úes
(300) == 1)

29 
numpy_Ïb–s
 = (numpy_labels - 200) > 0

31 
Ïb–s
 = 
tf
.
	$cÚ¡ªt
(
numpy_Ïb–s
)

33 
§m¶”
 = (
b®ªûd_pos™ive_Ãg©ive_§m¶”
.

34 
	$B®ªûdPos™iveNeg©iveSam¶”
())

35 
is_§m¶ed
 = 
§m¶”
.
	$sub§m¶e
(
šdiÿtÜ
, 64, 
Ïb–s
)

36 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

37 
is_§m¶ed
 = 
£ss
.
	$run
(
is_§m¶ed
)

38 
£lf
.
	`as£¹True
(
	`sum
(
is_§m¶ed
) == 64)

39 
£lf
.
	`as£¹True
(
	`sum
(
Å
.
	`logiÿl_ªd
(
numpy_Ïb–s
, 
is_§m¶ed
)) == 32)

40 
£lf
.
	`as£¹True
(
	`sum
(
Å
.
	`logiÿl_ªd
(

41 
Å
.
	`logiÿl_nÙ
(
numpy_Ïb–s
), 
is_§m¶ed
)) == 32)

43 
def
 
	$‹¡_sub§m¶e_£ËùiÚ
(
£lf
):

44 #Te¡ 
¿ndom
 
§m¶šg
 
wh’
 
Úly
 
some
 
exam¶es
 
ÿn
 
be
 
§m¶ed
:

45 #100 
§m¶es
, 20 
pos™ives
, 10…os™ive 
ÿÂÙ
 
be
 
§m¶ed


46 
numpy_Ïb–s
 = 
Å
.
	$¬ªge
(100)

47 
numpy_šdiÿtÜ
 = 
numpy_Ïb–s
 < 90

48 
šdiÿtÜ
 = 
tf
.
	$cÚ¡ªt
(
numpy_šdiÿtÜ
)

49 
numpy_Ïb–s
 = (numpy_labels - 80) >= 0

51 
Ïb–s
 = 
tf
.
	$cÚ¡ªt
(
numpy_Ïb–s
)

53 
§m¶”
 = (
b®ªûd_pos™ive_Ãg©ive_§m¶”
.

54 
	$B®ªûdPos™iveNeg©iveSam¶”
())

55 
is_§m¶ed
 = 
§m¶”
.
	$sub§m¶e
(
šdiÿtÜ
, 64, 
Ïb–s
)

56 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

57 
is_§m¶ed
 = 
£ss
.
	$run
(
is_§m¶ed
)

58 
£lf
.
	`as£¹True
(
	`sum
(
is_§m¶ed
) == 64)

59 
£lf
.
	`as£¹True
(
	`sum
(
Å
.
	`logiÿl_ªd
(
numpy_Ïb–s
, 
is_§m¶ed
)) == 10)

60 
£lf
.
	`as£¹True
(
	`sum
(
Å
.
	`logiÿl_ªd
(

61 
Å
.
	`logiÿl_nÙ
(
numpy_Ïb–s
), 
is_§m¶ed
)) == 54)

62 
£lf
.
	`as£¹AÎEqu®
(
is_§m¶ed
, 
Å
.
	$logiÿl_ªd
(
is_§m¶ed
,

63 
numpy_šdiÿtÜ
))

65 
def
 
	$‹¡_¿i£s_”rÜ_w™h_šcÜ»ù_Ïb–_sh­e
(
£lf
):

66 
Ïb–s
 = 
tf
.
	$cÚ¡ªt
([[
True
, 
F®£
, False]])

67 
šdiÿtÜ
 = 
tf
.
	$cÚ¡ªt
([
True
, 
F®£
, True])

68 
§m¶”
 = (
b®ªûd_pos™ive_Ãg©ive_§m¶”
.

69 
	$B®ªûdPos™iveNeg©iveSam¶”
())

70 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

71 
§m¶”
.
	$sub§m¶e
(
šdiÿtÜ
, 64, 
Ïb–s
)

73 
def
 
	$‹¡_¿i£s_”rÜ_w™h_šcÜ»ù_šdiÿtÜ_sh­e
(
£lf
):

74 
Ïb–s
 = 
tf
.
	$cÚ¡ªt
([
True
, 
F®£
, False])

75 
šdiÿtÜ
 = 
tf
.
	$cÚ¡ªt
([[
True
, 
F®£
, True]])

76 
§m¶”
 = (
b®ªûd_pos™ive_Ãg©ive_§m¶”
.

77 
	$B®ªûdPos™iveNeg©iveSam¶”
())

78 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

79 
§m¶”
.
	$sub§m¶e
(
šdiÿtÜ
, 64, 
Ïb–s
)

82 
__Çme__
 == '__main__':

83 
tf
.
‹¡
.
	`maš
()

	@core/batcher.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
cŞËùiÚs


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
´eãtch”


23 
	g¹_sh­e_¡r
 = '_runtime_shapes'

26 
şass
 
	$B©chQueue
(
objeù
):

29 
This
 
şass
 
ü—‹s
 
a
 
b©ch
 
queue
 
to
 
asynchrÚou¦y
 
’queue
 
‹nsÜs_diù
.

30 
It
 
®so
 
adds
 
a
 
FIFO
 
´eãtch”
 
so
 
th©
 
the
 
b©ches
 
¬e
 
»ady
 
avaabË


31 
the
 
cÚsum”s
. 
Dequeue
 
İs
 
a
 
B©chQueue
 
objeù
 
ÿn
 
be
 
ü—‹d
 
vŸ


32 
the
 
Dequeue
 
m‘hod
 
which
 
ev®u©es
 
to
 
a
 
b©ch
 
of
 
‹nsÜ_diù
.

34 
Exam¶e
 
šput
 
p–še
 
w™h
 
b©chšg
:

36 
key
, 
¡ršg_‹nsÜ
 = 
¦im
.
·¿Î–_»ad”
.
	$·¿Î–_»ad
(...)

37 
‹nsÜ_diù
 = 
decod”
.
	$decode
(
¡ršg_‹nsÜ
)

38 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
, ...)

39 
b©ch_queue
 = 
b©ch”
.
	$B©chQueue
(
‹nsÜ_diù
,

40 
b©ch_size
=32,

41 
b©ch_queue_ÿ·c™y
=2000,

42 
num_b©ch_queue_th»ads
=8,

43 
´eãtch_queue_ÿ·c™y
=20)

44 
‹nsÜ_diù
 = 
b©ch_queue
.
	$dequeue
()

45 
ouuts
 = 
	`Mod–
(
‹nsÜ_diù
)

49 
NÙes
:

51 
This
 
şass
 
b©ches
 
‹nsÜs
 
of
 
uÃqu®
 
sizes
 
by
 
z”o
 
·ddšg
 
ªd
 
uÅaddšg


52 
them
 
aá”
 
g’”©šg
 
a
 
b©ch
. 
This
 
ÿn
 
be
 
computiÚ®ly
 
ex³nsive
 
wh’


53 
b©chšg
 
	$‹nsÜs
 (
such
 
as
 
images
è
th©
 
¬e
 
of
 
va¡ly
 
difã»Á
 
sizes
. 
So
 
™
 
is


54 
»comm’ded
 
th©
 
the
 
sh­es
 
of
 
such
 
‹nsÜs
 
be
 
fuÎy
 
defšed
 
š
 
‹nsÜ_diù


55 
Ùh”
 
lightweight
 
‹nsÜs
 
such
 
as
 
boundšg
 
box
 
cÜÃrs
 
ªd
 
şass
 
Ïb–s


56 
ÿn
 
be
 
of
 
v¬yšg
 
sizes
. 
U£
 
e™h”
 
üİ
 
Ü
 
»size
 
İ”©iÚs
 
to
 
fuÎy
 
defše


57 
the
 
sh­e
 
of
 
ª
 
image
 
š
 
‹nsÜ_diù
.

59 
It
 
is
 
®so
 
»comm’ded
 
to
 
³rfÜm
 
ªy
 
´•roûssšg
 
İ”©iÚs
 
Ú
 
‹nsÜs


60 
befÜe
 
·ssšg
 
to
 
B©chQueue
 
ªd
 
sub£qu’y
 
ÿÎšg
 
the
 
Dequeue
 
m‘hod
.

62 
AnÙh”
 
ÿv—t
 
is
 
th©
 
this
 
şass
 
dÛs
 
nÙ
 
»ad
 
the
 
Ï¡
 
b©ch
 
™
 is‚ot

63 
fuÎ
. 
The
 
cu¼’t
 
im¶em’tiÚ
 
makes
 
™
 
h¬d
 
to
 
suµÜt
 
th©
 
u£
 . 
So
,

64 
ev®u©iÚ
, 
wh’
 
™
 
is
 
ü™iÿl
 
to
 
run
 
®l
 
the
 
exam¶es
 
through
 
your


65 
ÃtwÜk
 
u£
 
the
 
šput
 
p–še
 
exam¶e
 
m’tiÚed
 
š
 
cÜe
/
´eãtch”
.
py
.

68 
def
 
	$__š™__
(
£lf
, 
‹nsÜ_diù
, 
b©ch_size
, 
b©ch_queue_ÿ·c™y
,

69 
num_b©ch_queue_th»ads
, 
´eãtch_queue_ÿ·c™y
):

72 
Args
:

73 
‹nsÜ_diù
: 
diùiÚ¬y
 
of
 
‹nsÜs
 
to
 
b©ch
.

74 
b©ch_size
: 
b©ch
 
size
.

75 
b©ch_queue_ÿ·c™y
: 
max
 
ÿ·c™y
 
of
 
the
 
queue
 
äom
 
which
h
‹nsÜs
 
¬e


76 
b©ched
.

77 
num_b©ch_queue_th»ads
: 
numb”
 
of
 
th»ads
 
to
 
u£
 
b©chšg
.

78 
´eãtch_queue_ÿ·c™y
: 
max
 
ÿ·c™y
 
of
 
the
 
queue
 
u£d
 
to
 
´eãtch


79 
as£mbËd
 
b©ches
.

81 #Rememb” 
sh­es
 
to
 
£t
 sh­e 
of
 
b©ched
 
‹nsÜs
.

82 
¡©ic_sh­es
 = 
cŞËùiÚs
.
	`Ord”edDiù
(

83 {
key
: 
‹nsÜ
.
	`g‘_sh­e
(èkey,’sÜ 
š
 
‹nsÜ_diù
.
	`™ems
()
	}
})

84 #Rememb” 
ruÁime
 
sh­es
 
to
 
uÅad
 
‹nsÜs
 
aá”
 
b©chšg
.

85 
ruÁime_sh­es
 = 
cŞËùiÚs
.
Ord”edDiù
(

86 {(
key
 + 
¹_sh­e_¡r
): 
tf
.
sh­e
(
‹nsÜ
)

87 
key
, 
‹nsÜ
 
š
 
‹nsÜ_diù
.
™ems
()})

89 
®l_‹nsÜs
 = 
‹nsÜ_diù


90 
®l_‹nsÜs
.
	$upd©e
(
ruÁime_sh­es
)

91 
b©ched_‹nsÜs
 = 
tf
.
Œaš
.
	$b©ch
(

92 
®l_‹nsÜs
,

93 
ÿ·c™y
=
b©ch_queue_ÿ·c™y
,

94 
b©ch_size
=batch_size,

95 
dyÇmic_·d
=
True
,

96 
num_th»ads
=
num_b©ch_queue_th»ads
)

98 
£lf
.
_queue
 = 
´eãtch”
.
	$´eãtch
(
b©ched_‹nsÜs
,

99 
´eãtch_queue_ÿ·c™y
)

100 
£lf
.
_¡©ic_sh­es
 = 
¡©ic_sh­es


101 
£lf
.
_b©ch_size
 = 
b©ch_size


103 
def
 
	$dequeue
(
£lf
):

106 
TODO
: 
u£
 
®low_sm®Ër_fš®_b©ch
 
to
 
®low
 
ruÂšg
 
ov”
 
the
 
whŞe
 
ev®
 
£t


108 
R‘uºs
:

109 
A
 
li¡
 
of
 
‹nsÜ_diùs
 oà
the
 
»que¡ed
 
b©ch_size
.

111 
b©ched_‹nsÜs
 = 
£lf
.
_queue
.
	$dequeue
()

112 #S•¬©
šput
 
‹nsÜs
 
äom
’sÜ 
cÚššg
 
theœ
 
ruÁime
 
sh­es
.

113 
‹nsÜs
 = {
	}
}

114 
sh­es
 = {}

115 
key
, 
b©ched_‹nsÜ
 
š
 
	gb©ched_‹nsÜs
.
	$™ems
():

116 
unb©ched_‹nsÜ_li¡
 = 
tf
.
	$un¡ack
(
b©ched_‹nsÜ
)

117 
i
, 
unb©ched_‹nsÜ
 
š
 
	$’um”©e
(
unb©ched_‹nsÜ_li¡
):

118 
¹_sh­e_¡r
 
š
 
key
:

119 
sh­es
[(
key
[:-
	`Ën
(
¹_sh­e_¡r
)], 
i
)] = 
unb©ched_‹nsÜ


121 
‹nsÜs
[(
key
, 
i
)] = 
unb©ched_‹nsÜ


123 #UndØ
th©
 
·ddšg
 
usšg
 
sh­es
 
ªd
 
ü—‹
 
a
 
li¡
 
of
 
size
 `
b©ch_size
`hat

124 #cÚš 
‹nsÜ
 
diùiÚ¬›s
.

125 
‹nsÜ_diù_li¡
 = []

126 
b©ch_size
 = 
£lf
.
_b©ch_size


127 
b©ch_id
 
š
 
	$¿nge
(
b©ch_size
):

128 
‹nsÜ_diù
 = {
	}
}

129 
key
 
š
 
£lf
.
_¡©ic_sh­es
:

130 
‹nsÜ_diù
[
key
] = 
tf
.
¦iû
(
‹nsÜs
[(key, 
b©ch_id
)],

131 
tf
.
z”os_like
(
sh­es
[(
key
, 
b©ch_id
)]),

132 
sh­es
[(
key
, 
b©ch_id
)])

133 
	g‹nsÜ_diù
[
key
].
	$£t_sh­e
(
£lf
.
_¡©ic_sh­es
[
key
])

134 
‹nsÜ_diù_li¡
.
	$­³nd
(
‹nsÜ_diù
)

136  
‹nsÜ_diù_li¡


	@core/batcher_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
numpy
 
as
 
Å


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
b©ch”


23 
	g¦im
 = 
tf
.
cÚŒib
.
¦im


26 
şass
 
	$B©ch”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

28 
def
 
	$‹¡_b©ch_ªd_uÅad_2d_‹nsÜs_of_difã»Á_sizes_š_1¡_dim’siÚ
(
£lf
):

29 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

30 
b©ch_size
 = 3

31 
num_b©ches
 = 2

32 
exam¶es
 = 
tf
.
	`V¬ŸbË
Ñf.
	$cÚ¡ªt
(2, 
dty³
=
tf
.
št32
))

33 
couÁ”
 = 
exam¶es
.
	`couÁ_up_to
(
num_b©ches
 * 
b©ch_size
 + 2)

34 
boxes
 = 
tf
.
	`te
(

35 
tf
.
	`»sh­e
Ñf.
	`¿nge
(4), [1, 4]),f.
	`¡ack
([
couÁ”
,f.
	`cÚ¡ªt
(1)]))

36 
b©ch_queue
 = 
b©ch”
.
	`B©chQueue
(

37 
‹nsÜ_diù
={'boxes': 
boxes
},

38 
	gb©ch_size
=
b©ch_size
,

39 
	gb©ch_queue_ÿ·c™y
=100,

40 
	gnum_b©ch_queue_th»ads
=1,

41 
	g´eãtch_queue_ÿ·c™y
=100)

42 
b©ch
 = 
b©ch_queue
.
	$dequeue
()

44 
‹nsÜ_diù
 
š
 
b©ch
:

45 
‹nsÜ
 
š
 
‹nsÜ_diù
.
	$v®ues
():

46 
£lf
.
	`as£¹AÎEqu®
([
NÚe
, 4], 
‹nsÜ
.
	`g‘_sh­e
().
	$as_li¡
())

48 
tf
.
	`š™Ÿlize_®l_v¬ŸbËs
().
	$run
()

49 
w™h
 
¦im
.
queues
.
	$QueueRuÂ”s
(
£ss
):

50 
i
 = 2

51 
_
 
š
 
	$¿nge
(
num_b©ches
):

52 
b©ch_Å
 = 
£ss
.
	$run
(
b©ch
)

53 
‹nsÜ_diù
 
š
 
b©ch_Å
:

54 
‹nsÜ
 
š
 
‹nsÜ_diù
.
	$v®ues
():

55 
£lf
.
	`as£¹AÎEqu®
(
‹nsÜ
, 
Å
.
	`te
Òp.
	`¬ªge
(4), (
i
, 1)))

56 
i
 += 1

57 
w™h
 
£lf
.
	$as£¹Rai£s
(
tf
.
”rÜs
.
OutOfRªgeE¼Ü
):

58 
£ss
.
	$run
(
b©ch
)

60 
def
 
	$‹¡_b©ch_ªd_uÅad_2d_‹nsÜs_of_difã»Á_sizes_š_®l_dim’siÚs
(

61 
£lf
):

62 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

63 
b©ch_size
 = 3

64 
num_b©ches
 = 2

65 
exam¶es
 = 
tf
.
	`V¬ŸbË
Ñf.
	$cÚ¡ªt
(2, 
dty³
=
tf
.
št32
))

66 
couÁ”
 = 
exam¶es
.
	`couÁ_up_to
(
num_b©ches
 * 
b©ch_size
 + 2)

67 
image
 = 
tf
.
	`»sh­e
(

68 
tf
.
	`¿nge
(
couÁ”
 * couÁ”),f.
	$¡ack
([
couÁ”
, counter]))

69 
b©ch_queue
 = 
b©ch”
.
	`B©chQueue
(

70 
‹nsÜ_diù
={'image': 
image
},

71 
	gb©ch_size
=
b©ch_size
,

72 
	gb©ch_queue_ÿ·c™y
=100,

73 
	gnum_b©ch_queue_th»ads
=1,

74 
	g´eãtch_queue_ÿ·c™y
=100)

75 
b©ch
 = 
b©ch_queue
.
	$dequeue
()

77 
‹nsÜ_diù
 
š
 
b©ch
:

78 
‹nsÜ
 
š
 
‹nsÜ_diù
.
	$v®ues
():

79 
£lf
.
	`as£¹AÎEqu®
([
NÚe
, NÚe], 
‹nsÜ
.
	`g‘_sh­e
().
	$as_li¡
())

81 
tf
.
	`š™Ÿlize_®l_v¬ŸbËs
().
	$run
()

82 
w™h
 
¦im
.
queues
.
	$QueueRuÂ”s
(
£ss
):

83 
i
 = 2

84 
_
 
š
 
	$¿nge
(
num_b©ches
):

85 
b©ch_Å
 = 
£ss
.
	$run
(
b©ch
)

86 
‹nsÜ_diù
 
š
 
b©ch_Å
:

87 
‹nsÜ
 
š
 
‹nsÜ_diù
.
	$v®ues
():

88 
£lf
.
	`as£¹AÎEqu®
(
‹nsÜ
, 
Å
.
	`¬ªge
(
i
 * i).
	`»sh­e
((i, i)))

89 
i
 += 1

90 
w™h
 
£lf
.
	$as£¹Rai£s
(
tf
.
”rÜs
.
OutOfRªgeE¼Ü
):

91 
£ss
.
	$run
(
b©ch
)

93 
def
 
	$‹¡_b©ch_ªd_uÅad_2d_‹nsÜs_of_§me_size_š_®l_dim’siÚs
(
£lf
):

94 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

95 
b©ch_size
 = 3

96 
num_b©ches
 = 2

97 
exam¶es
 = 
tf
.
	`V¬ŸbË
Ñf.
	$cÚ¡ªt
(1, 
dty³
=
tf
.
št32
))

98 
couÁ”
 = 
exam¶es
.
	`couÁ_up_to
(
num_b©ches
 * 
b©ch_size
 + 1)

99 
image
 = 
tf
.
	`»sh­e
Ñf.
	`¿nge
(1, 13), [4, 3]è* 
couÁ”


100 
b©ch_queue
 = 
b©ch”
.
	`B©chQueue
(

101 
‹nsÜ_diù
={'image': 
image
},

102 
	gb©ch_size
=
b©ch_size
,

103 
	gb©ch_queue_ÿ·c™y
=100,

104 
	gnum_b©ch_queue_th»ads
=1,

105 
	g´eãtch_queue_ÿ·c™y
=100)

106 
b©ch
 = 
b©ch_queue
.
	$dequeue
()

108 
‹nsÜ_diù
 
š
 
b©ch
:

109 
‹nsÜ
 
š
 
‹nsÜ_diù
.
	$v®ues
():

110 
£lf
.
	`as£¹AÎEqu®
([4, 3], 
‹nsÜ
.
	`g‘_sh­e
().
	$as_li¡
())

112 
tf
.
	`š™Ÿlize_®l_v¬ŸbËs
().
	$run
()

113 
w™h
 
¦im
.
queues
.
	$QueueRuÂ”s
(
£ss
):

114 
i
 = 1

115 
_
 
š
 
	$¿nge
(
num_b©ches
):

116 
b©ch_Å
 = 
£ss
.
	$run
(
b©ch
)

117 
‹nsÜ_diù
 
š
 
b©ch_Å
:

118 
‹nsÜ
 
š
 
‹nsÜ_diù
.
	$v®ues
():

119 
£lf
.
	`as£¹AÎEqu®
(
‹nsÜ
, 
Å
.
	`¬ªge
(1, 13).
	`»sh­e
((4, 3)è* 
i
)

120 
i
 += 1

121 
w™h
 
£lf
.
	$as£¹Rai£s
(
tf
.
”rÜs
.
OutOfRªgeE¼Ü
):

122 
£ss
.
	$run
(
b©ch
)

124 
def
 
	$‹¡_b©ch”_wh’_b©ch_size_is_Úe
(
£lf
):

125 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

126 
b©ch_size
 = 1

127 
num_b©ches
 = 2

128 
exam¶es
 = 
tf
.
	`V¬ŸbË
Ñf.
	$cÚ¡ªt
(2, 
dty³
=
tf
.
št32
))

129 
couÁ”
 = 
exam¶es
.
	`couÁ_up_to
(
num_b©ches
 * 
b©ch_size
 + 2)

130 
image
 = 
tf
.
	`»sh­e
(

131 
tf
.
	`¿nge
(
couÁ”
 * couÁ”),f.
	$¡ack
([
couÁ”
, counter]))

132 
b©ch_queue
 = 
b©ch”
.
	`B©chQueue
(

133 
‹nsÜ_diù
={'image': 
image
},

134 
	gb©ch_size
=
b©ch_size
,

135 
	gb©ch_queue_ÿ·c™y
=100,

136 
	gnum_b©ch_queue_th»ads
=1,

137 
	g´eãtch_queue_ÿ·c™y
=100)

138 
b©ch
 = 
b©ch_queue
.
	$dequeue
()

140 
‹nsÜ_diù
 
š
 
b©ch
:

141 
‹nsÜ
 
š
 
‹nsÜ_diù
.
	$v®ues
():

142 
£lf
.
	`as£¹AÎEqu®
([
NÚe
, NÚe], 
‹nsÜ
.
	`g‘_sh­e
().
	$as_li¡
())

144 
tf
.
	`š™Ÿlize_®l_v¬ŸbËs
().
	$run
()

145 
w™h
 
¦im
.
queues
.
	$QueueRuÂ”s
(
£ss
):

146 
i
 = 2

147 
_
 
š
 
	$¿nge
(
num_b©ches
):

148 
b©ch_Å
 = 
£ss
.
	$run
(
b©ch
)

149 
‹nsÜ_diù
 
š
 
b©ch_Å
:

150 
‹nsÜ
 
š
 
‹nsÜ_diù
.
	$v®ues
():

151 
£lf
.
	`as£¹AÎEqu®
(
‹nsÜ
, 
Å
.
	`¬ªge
(
i
 * i).
	`»sh­e
((i, i)))

152 
i
 += 1

153 
w™h
 
£lf
.
	$as£¹Rai£s
(
tf
.
”rÜs
.
OutOfRªgeE¼Ü
):

154 
£ss
.
	$run
(
b©ch
)

157 
__Çme__
 == '__main__':

158 
tf
.
‹¡
.
	`maš
()

	@core/box_coder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
Box
 
cod”s
 
cÚv”t
 
b‘w“n
 
coÜdš©e
 
	gäames
, 
Çm–y
 
	gimage
-
	gûÁric


19 (
	$w™h
 (0,0è
Ú
 
the
 
tİ
 
Ëá
 
of
 
image
è
ªd
 
ªchÜ
-
	`ûÁric
 (
	$w™h
 (0,0è
bešg


20 
defšed
 
by
 
a
 
¥ecific
 
ªchÜ
).

22 
U£rs
 
of
 
a
 
BoxCod”
 
ÿn
 
ÿÎ
 
two
 
m‘hods
:

23 
’code
: 
which
 
’codes
 
a
 
box
 
w™h
 
»¥eù
 
to
‡ 
giv’
 
ªchÜ


24 (
Ü
 
¿th”
, 
a
 
‹nsÜ
 
of
 
boxes
 
w¹
‡ 
cÜ»¥Údšg
’sÜ oà
ªchÜs
è
ªd


25 
decode
: 
which
 
šv”ts
 
this
 
’codšg
 
w™h
 
a
 decod
İ”©iÚ
.

26 
In
 
bÙh
 
ÿ£s
, 
the
 
¬gum’ts
 
¬e
 
assumed
 
to
 
be
 
š
 1-1 
cÜ»¥Úd’û
 
®»ady
;

27 
™
 
is
 
nÙ
 
the
 
job
 
of
 
a
 
BoxCod”
 
to
 
³rfÜm
 
m©chšg
.

29 
äom
 
abc
 
impÜt
 
ABCM‘a


30 
äom
 
abc
 
impÜt
 
ab¡¿ùm‘hod


31 
äom
 
abc
 
impÜt
 
ab¡¿ù´İ”ty


33 
impÜt
 
‹nsÜæow
 
as
 
tf


36 #Box 
cod”
 
ty³s
.

37 
FASTER_RCNN
 = 'faster_rcnn'

38 
KEYPOINT
 = 'keypoint'

39 
MEAN_STDDEV
 = 'mean_stddev'

40 
SQUARE
 = 'square'

43 
şass
 
	$BoxCod”
(
objeù
):

45 
__m‘aşass__
 = 
ABCM‘a


47 @
ab¡¿ù´İ”ty


48 
def
 
	$code_size
(
£lf
):

51 
This
 
numb”
 
is
 
a
 
cÚ¡ªt
 
ªd
 
should
 
ag»e
 
w™h
 
the
 
ouut
 
of
h`
’code
`

52 
	`İ
 (
e
.
g
. 
»l_codes
 
is
 
the
 
ouut
 
of
 
£lf
.
	`’code
(...), 
th’
 
™
 
should
 
have


53 
sh­e
 [
N
, 
	`code_size
()]). 
This
 
ab¡¿ù´İ”ty
 
should
 
be
 
ov”ridd’
 
by


54 
im¶em’tiÚs
.

56 
R‘uºs
:

57 
ª
 
š‹g”
 
cÚ¡ªt


59 
·ss


61 
def
 
	$’code
(
£lf
, 
boxes
, 
ªchÜs
):

64 
Args
:

65 
boxes
: 
BoxLi¡
 
hŞdšg
 
N
 boxe 
to
 
be
 
’coded


66 
ªchÜs
: 
BoxLi¡
 
of
 
N
‡nchors

68 
R‘uºs
:

69 
a
 
‹nsÜ
 
»´e£Ášg
 
N
 
»Ïtive
-
’coded
 
boxes


71 
w™h
 
tf
.
	`Çme_scİe
('Encode'):

72  
£lf
.
	$_’code
(
boxes
, 
ªchÜs
)

74 
def
 
	$decode
(
£lf
, 
»l_codes
, 
ªchÜs
):

77 
Args
:

78 
»l_codes
: 
a
 
‹nsÜ
 
»´e£Ášg
 
N
 
»Ïtive
-
’coded
 
boxes


79 
ªchÜs
: 
BoxLi¡
 
of
‡nchors

81 
R‘uºs
:

82 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes
 
’coded
 
š
 
the
 
Üdš¬y
 
	`way
 (
i
.
e
.,

83 
w™h
 
cÜÃrs
 
y_mš
, 
x_mš
, 
y_max
, 
x_max
)

85 
w™h
 
tf
.
	`Çme_scİe
('Decode'):

86  
£lf
.
	`_decode
(
»l_codes
, 
ªchÜs
)

88 @
ab¡¿ùm‘hod


89 
def
 
	$_’code
(
£lf
, 
boxes
, 
ªchÜs
):

92 
Args
:

93 
boxes
: 
BoxLi¡
 
hŞdšg
 
N
 boxe 
to
 
be
 
’coded


94 
ªchÜs
: 
BoxLi¡
 
of
 
N
‡nchors

96 
R‘uºs
:

97 
a
 
‹nsÜ
 
»´e£Ášg
 
N
 
»Ïtive
-
’coded
 
boxes


99 
·ss


101 @
ab¡¿ùm‘hod


102 
def
 
	$_decode
(
£lf
, 
»l_codes
, 
ªchÜs
):

105 
Args
:

106 
»l_codes
: 
a
 
‹nsÜ
 
»´e£Ášg
 
N
 
»Ïtive
-
’coded
 
boxes


107 
ªchÜs
: 
BoxLi¡
 
of
‡nchors

109 
R‘uºs
:

110 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes
 
’coded
 
š
 
the
 
Üdš¬y
 
	`way
 (
i
.
e
.,

111 
w™h
 
cÜÃrs
 
y_mš
, 
x_mš
, 
y_max
, 
x_max
)

113 
·ss


116 
def
 
	$b©ch_decode
(
’coded_boxes
, 
box_cod”
, 
ªchÜs
):

119 
This
 
İ
 
kes
 
a
 
b©ch
 
of
 
’coded
 
boundšg
 
boxes
 
ªd
 
ŒªsfÜms


120 
them
 
to
 
a
 
b©ch
 
of
 
boundšg
 
boxes
 
¥ecif›d
 
by
 
theœ
 
cÜÃrs
 
š


121 
the
 
Üd”
 
of
 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
].

123 
Args
:

124 
’coded_boxes
: 
a
 
æßt32
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

125 
code_size
] 
»´e£Ášg
 
the
 
loÿtiÚ
 
of
h
objeùs
.

126 
box_cod”
: 
a
 
BoxCod”
 
objeù
.

127 
ªchÜs
: 
a
 
BoxLi¡
 
of
‡nchÜ 
u£d
 
to
 
’code
 `
’coded_boxes
`.

129 
R‘uºs
:

130 
decoded_boxes
: 
a
 
æßt32
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

131 
cod”_size
] 
»´e£Ášg
 
the
 
cÜÃrs
 
of
h
objeùs
 
š
h
Üd”


132 
of
 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
].

134 
Rai£s
:

135 
V®ueE¼Ü
: 
b©ch
 
sizes
 
of
 
the
 
šputs
 
¬e
 
šcÚsi¡’t
, 
Ü
 

136 
the
 
numb”
 
of
 
ªchÜs
 
šã¼ed
 
äom
 
’coded_boxes
 
ªd
‡nchÜ 
¬e


137 
šcÚsi¡’t
.

139 
’coded_boxes
.
	`g‘_sh­e
().
	$as£¹_has_¿nk
(3)

140 
’coded_boxes
.
	`g‘_sh­e
()[1].
v®ue
 !ğ
ªchÜs
.
	$num_boxes_¡©ic
():

141 
¿i£
 
	`V®ueE¼Ü
('The‚umber of‡nchors inferred fromƒncoded_boxes'

144 (
’coded_boxes
.
	`g‘_sh­e
()[1].
v®ue
,

145 
ªchÜs
.
	$num_boxes_¡©ic
()))

147 
decoded_boxes
 = 
tf
.
	`¡ack
([

148 
box_cod”
.
	`decode
(
boxes
, 
ªchÜs
).
	$g‘
()

149 
boxes
 
š
 
tf
.
	`un¡ack
(
’coded_boxes
)

151  
decoded_boxes


	@core/box_coder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_cod”


21 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


24 
şass
 
	$MockBoxCod”
(
box_cod”
.
BoxCod”
):

27 
def
 
	$code_size
(
£lf
):

30 
def
 
	$_’code
(
£lf
, 
boxes
, 
ªchÜs
):

31  2.0 * 
boxes
.
	$g‘
()

33 
def
 
	$_decode
(
£lf
, 
»l_codes
, 
ªchÜs
):

34  
box_li¡
.
	`BoxLi¡
(
»l_codes
 / 2.0)

37 
şass
 
	$BoxCod”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

39 
def
 
	$‹¡_b©ch_decode
(
£lf
):

40 
mock_ªchÜ_cÜÃrs
 = 
tf
.
	$cÚ¡ªt
(

41 [[0, 0.1, 0.2, 0.3], [0.2, 0.4, 0.4, 0.6]], 
tf
.
æßt32
)

42 
mock_ªchÜs
 = 
box_li¡
.
	$BoxLi¡
(
mock_ªchÜ_cÜÃrs
)

43 
mock_box_cod”
 = 
	$MockBoxCod”
()

45 
ex³ùed_boxes
 = [[[0.0, 0.1, 0.5, 0.6], [0.5, 0.6, 0.7, 0.8]],

48 
’coded_boxes_li¡
 = [
mock_box_cod”
.
	`’code
(

49 
box_li¡
.
	`BoxLi¡
(
tf
.
	`cÚ¡ªt
(
boxes
)), 
mock_ªchÜs
)

50 
boxes
 
š
 
ex³ùed_boxes
]

51 
’coded_boxes
 = 
tf
.
	$¡ack
(
’coded_boxes_li¡
)

52 
decoded_boxes
 = 
box_cod”
.
	$b©ch_decode
(

53 
’coded_boxes
, 
mock_box_cod”
, 
mock_ªchÜs
)

55 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

56 
decoded_boxes_»suÉ
 = 
£ss
.
	$run
(
decoded_boxes
)

57 
£lf
.
	$as£¹AÎClo£
(
ex³ùed_boxes
, 
decoded_boxes_»suÉ
)

60 
__Çme__
 == '__main__':

61 
tf
.
‹¡
.
	`maš
()

	@core/box_list.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
BoxLi¡
 
»´e£Ás
 
a
 
li¡
 
of
 
boundšg
 
boxes
 
as
 
‹nsÜæow


19 
	g‹nsÜs
, 
wh”e
 
—ch
 
boundšg
 
box
 
is
 
»´e£Áed
 
as
 
a
 
row
 
	gof
 4 
	gnumb”s
,

20 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
]. 
It
 
is
 
assumed
 
th©
 
®l
 
boundšg
 
boxes


21 
w™hš
 
a
 
giv’
 
li¡
 
cÜ»¥Úd
 
to
‡ 
sšgË
 
	gimage
. 
S“
 
®so


22 
	gbox_li¡_İs
.
py
 
commÚ
 
box
 
»Ï‹d
 
İ”©iÚs
 (
such
 
as
 
¬—
, 
iou
, 
‘c
).

24 
	gO±iÚ®ly
, 
u£rs
 
ÿn
 
add
 
add™iÚ®
 
»Ï‹d
 
f›lds
 (
such
 
as
 
weights
).

25 
We
 
assume
 
the
 
fŞlowšg
 
thšgs
 
to
 
be
 
Œue
 
about
 
	gf›lds
:

26 * 
they
 
cÜ»¥Úd
 
to
 
boxes
 
š
 
the
 
box_li¡
 
®Úg
h0
th
 
dim’siÚ


27 * 
they
 
have
 
šã¼abË
 
¿nk
 
©
 
g¿ph
 
cÚ¡ruùiÚ
 
time


28 * 
®l
 
dim’siÚs
 
exû±
 
possibly
 
the
 0
th
 
ÿn
 
be
 
šã¼ed


29 (
i
.
e
., 
nÙ
 
	gNÚe
è
©
 
g¿ph
 
cÚ¡ruùiÚ
 
	gtime
.

31 
Some
 
Ùh”
 
	gnÙes
:

32 * 
FŞlowšg
 
‹nsÜæow
 
cÚv’tiÚs
, 
we
 
u£
 
	gheight
, 
width
 
	gÜd”šg
,

33 
ªd
 
	gcÜ»¥Údšgly
, 
	gy
,
	$x
 (
Ü
 
ymš
, 
xmš
, 
ymax
, 
xmax
è
Üd”šg


34 * 
T’sÜs
 
¬e
 
®ways
 
´ovided
 
	`as
 (
æ©
è[
N
, 4] 
‹nsÜs
.

37 
impÜt
 
‹nsÜæow
 
as
 
tf


40 
şass
 
	$BoxLi¡
(
objeù
):

43 
def
 
	$__š™__
(
£lf
, 
boxes
):

46 
Args
:

47 
boxes
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
N
, 4] 
»´e£Ášg
 
box
 
cÜÃrs


49 
Rai£s
:

50 
V®ueE¼Ü
: 
šv®id
 
dim’siÚs
 
bbox
 
d©a
 
Ü
 bbox d©¨
is
 
nÙ
 
š


51 
æßt32
 
fÜm©
.

53 
	`Ën
(
boxes
.
	`g‘_sh­e
()è!ğ2 
Ü
 boxes.get_shape()[-1] != 4:

54 
¿i£
 
	`V®ueE¼Ü
('Invalid dimensions for box data.')

55 
boxes
.
dty³
 !ğ
tf
.
æßt32
:

56 
¿i£
 
	`V®ueE¼Ü
('Invalidensorype: should bef.float32')

57 
£lf
.
d©a
 = {'boxes': 
boxes
}

59 
def
 
	$num_boxes
(
£lf
):

62 
R‘uºs
:

63 
a
 
‹nsÜ
 
»´e£Ášg
 
the
 
numb”
 
of
 
boxes
 
h–d
 
š
h
cŞËùiÚ
.

65  
tf
.
	`sh­e
(
£lf
.
d©a
['boxes'])[0]

67 
def
 
	$num_boxes_¡©ic
(
£lf
):

70 
This
 
numb”
 
is
 
šã¼ed
 
©
 
g¿ph
 
cÚ¡ruùiÚ
 
time
 
¿th”
 
thª
 
run
-time.

72 
R‘uºs
:

73 
Numb”
 
of
 
boxes
 
h–d
 
š
 
	$cŞËùiÚ
 (
š‹g”
è
Ü
 
NÚe
 
this
 
is
 
nÙ


74 
šã¼abË
 
©
 
g¿ph
 
cÚ¡ruùiÚ
 
time
.

76  
£lf
.
d©a
['boxes'].
	`g‘_sh­e
()[0].
v®ue


78 
def
 
	$g‘_®l_f›lds
(
£lf
):

80  
£lf
.
d©a
.
	$keys
()

82 
def
 
	$g‘_exŒa_f›lds
(
£lf
):

84  [
k
 k 
š
 
£lf
.
d©a
.
	$keys
(è
k
 != 'boxes']

86 
def
 
	$add_f›ld
(
£lf
, 
f›ld
, 
f›ld_d©a
):

89 
This
 
m‘hod
 
ÿn
 
be
 
u£d
 
to
 
add
 
»Ï‹d
 
box
 
d©a
 
such
 
as


90 
weights
/
Ïb–s
, 
‘c
.

92 
Args
:

93 
f›ld
: 
a
 
¡ršg
 
key
 
to
 
acûss
 
the
 
d©a
 
vŸ
 `
g‘
`

94 
f›ld_d©a
: 
a
 
‹nsÜ
 
cÚššg
 
the
 
d©a
 
to
 
¡Üe
 
š
h
BoxLi¡


96 
£lf
.
d©a
[
f›ld
] = 
f›ld_d©a


98 
def
 
	$has_f›ld
(
£lf
, 
f›ld
):

99  
f›ld
 
š
 
£lf
.
d©a


101 
def
 
	$g‘
(
£lf
):

104 
R‘uºs
:

105 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
N
, 4] 
»´e£Ášg
 
box
 
coÜdš©es
.

107  
£lf
.
	`g‘_f›ld
('boxes')

109 
def
 
	$£t
(
£lf
, 
boxes
):

112 
Args
:

113 
boxes
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
N
, 4] 
»´e£Ášg
 
box
 
cÜÃrs


115 
Rai£s
:

116 
V®ueE¼Ü
: 
šv®id
 
dim’siÚs
 
bbox
 
d©a


118 
	`Ën
(
boxes
.
	`g‘_sh­e
()è!ğ2 
Ü
 boxes.get_shape()[-1] != 4:

119 
¿i£
 
	`V®ueE¼Ü
('Invalid dimensions for box data.')

120 
£lf
.
d©a
['boxes'] = 
boxes


122 
def
 
	$g‘_f›ld
(
£lf
, 
f›ld
):

125 
This
 
funùiÚ
 
»tuºs
 
¥ecif›d
 
f›ld
 
w™h
 
objeù
; 
no
 f›ld 
is
 specified,

126 
™
 
»tuºs
 
the
 
box
 
coÜdš©es
.

128 
Args
:

129 
f›ld
: 
this
 
İtiÚ®
 
¡ršg
 
·¿m‘”
 
ÿn
 
be
 
u£d
 
to
 
¥ecify


130 
a
 
»Ï‹d
 
f›ld
 
to
 
be
 
acûs£d
.

132 
R‘uºs
:

133 
a
 
‹nsÜ
 
»´e£Ášg
 
the
 
box
 
cŞËùiÚ
 
Ü
 
ª
 
assocŸ‹d
 
f›ld
.

135 
Rai£s
:

136 
V®ueE¼Ü
: 
šv®id
 
f›ld


138 
nÙ
 
£lf
.
	$has_f›ld
(
f›ld
):

139 
¿i£
 
	`V®ueE¼Ü
('f›ld ' + 
	`¡r
(
f›ld
) + ' does‚otƒxist')

140  
£lf
.
d©a
[
f›ld
]

142 
def
 
	$£t_f›ld
(
£lf
, 
f›ld
, 
v®ue
):

145 
Upd©es
 
the
 
f›ld
 
of
 
a
 
box_li¡
 
w™h
‡ 
giv’
 
v®ue
.

147 
Args
:

148 
f›ld
: (
¡ršg
è
Çme
 
of
 
the
 f›ld 
to
 
£t
 
v®ue
.

149 
v®ue
: 
the
 v®u
to
 
assign
Øth
f›ld
.

151 
Rai£s
:

152 
V®ueE¼Ü
: 
the
 
box_li¡
 
dÛs
 
nÙ
 
have
 
¥ecif›d
 
f›ld
.

154 
nÙ
 
£lf
.
	$has_f›ld
(
f›ld
):

155 
¿i£
 
	`V®ueE¼Ü
('f›ld % dÛ nÙƒxi¡' % 
f›ld
)

156 
£lf
.
d©a
[
f›ld
] = 
v®ue


158 
def
 
	$g‘_ûÁ”_coÜdš©es_ªd_sizes
(
£lf
, 
scİe
=
NÚe
):

161 
Args
:

162 
scİe
: 
Çme
 scİ
of
 
the
 
funùiÚ
.

164 
R‘uºs
:

165 
a
 
li¡
 
of
 4 1-
D
 
‹nsÜs
 [
yûÁ”
, 
xûÁ”
, 
height
, 
width
].

167 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'get_center_coordinates_and_sizes'):

168 
box_cÜÃrs
 = 
£lf
.
	$g‘
()

169 
ymš
, 
xmš
, 
ymax
, 
xmax
 = 
tf
.
	`un¡ack
Ñf.
	$Œª¥o£
(
box_cÜÃrs
))

170 
width
 = 
xmax
 - 
xmš


171 
height
 = 
ymax
 - 
ymš


172 
yûÁ”
 = 
ymš
 + 
height
 / 2.

173 
xûÁ”
 = 
xmš
 + 
width
 / 2.

174  [
yûÁ”
, 
xûÁ”
, 
height
, 
width
]

176 
def
 
	$Œª¥o£_coÜdš©es
(
£lf
, 
scİe
=
NÚe
):

179 
Args
:

180 
scİe
: 
Çme
 scİ
of
 
the
 
funùiÚ
.

182 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'transpose_coordinates'):

183 
y_mš
, 
x_mš
, 
y_max
, 
x_max
 = 
tf
.
	`¥l™
(

184 
v®ue
=
£lf
.
	`g‘
(), 
num_Ü_size_¥l™s
=4, 
axis
=1)

185 
£lf
.
	`£t
(
tf
.
	$cÚÿt
([
x_mš
, 
y_mš
, 
x_max
, 
y_max
], 1))

187 
def
 
	$as_‹nsÜ_diù
(
£lf
, 
f›lds
=
NÚe
):

190 
Args
:

191 
f›lds
: (
İtiÚ®
è
li¡
 
of
 f›ld 
to
  
š
 
the
 
diùiÚ¬y
.

192 
If
 
	`NÚe
 (), 
®l
 
f›lds
 
¬e
 
»tuºed
.

194 
R‘uºs
:

195 
‹nsÜ_diù
: 
A
 
diùiÚ¬y
 
of
 
‹nsÜs
 
¥ecif›d
 
by
 
f›lds
.

197 
Rai£s
:

198 
V®ueE¼Ü
: 
¥ecif›d
 
f›ld
 
is
 
nÙ
 
cÚšed
 
š
 
boxli¡
.

200 
‹nsÜ_diù
 = {
	}
}

201 
f›lds
 
is
 
NÚe
:

202 
f›lds
 = 
£lf
.
	$g‘_®l_f›lds
()

203 
f›ld
 
š
 
f›lds
:

204 
nÙ
 
£lf
.
	$has_f›ld
(
f›ld
):

205 
¿i£
 
	`V®ueE¼Ü
('boxlist must contain‡ll specified fields')

206 
‹nsÜ_diù
[
f›ld
] = 
£lf
.
	$g‘_f›ld
(
f›ld
)

207  
‹nsÜ_diù


	@core/box_list_ops.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
Exam¶e
 
box
 
İ”©iÚs
 
th©
 
¬e
 
	gsuµÜ‹d
:

19 * 
¬—s
: 
compu‹
 
boundšg
 
box
‡reas

20 * 
iou
: 
·œwi£
 
š‹r£ùiÚ
-
ov”
-
scÜes


21 * 
sq_di¡
: 
·œwi£
 
di¡ªûs
 
b‘w“n
 
boundšg
 
boxes


23 
Wh’ev”
 
box_li¡_İs
 
funùiÚs
 
ouut
 
a
 
BoxLi¡
, 
the
 
f›lds
 
of
h
šcomšg


24 
BoxLi¡
 
¬e
 
»šed
 
uÆess
 
docum’‹d
 
	gÙh”wi£
.

26 
impÜt
 
‹nsÜæow
 
as
 
tf


28 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


29 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
sh­e_uts


32 
şass
 
	$SÜtOrd”
(
objeù
):

35 
A‰ribu‹s
:

36 
asûnd
:‡sûnd 
Üd”
.

37 
desûnd
: desûnd 
Üd”
.

39 
asûnd
 = 1

40 
desûnd
 = 2

43 
def
 
	$¬—
(
boxli¡
, 
scİe
=
NÚe
):

46 
Args
:

47 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


48 
scİe
: 
Çme
 scope.

50 
R‘uºs
:

51 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
N
] 
»´e£Ášg
 
box
 
¬—s
.

53 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'Area'):

54 
y_mš
, 
x_mš
, 
y_max
, 
x_max
 = 
tf
.
	`¥l™
(

55 
v®ue
=
boxli¡
.
	`g‘
(), 
num_Ü_size_¥l™s
=4, 
axis
=1)

56  
tf
.
	`squ“ze
((
y_max
 - 
y_mš
è* (
x_max
 - 
x_mš
), [1])

59 
def
 
	$height_width
(
boxli¡
, 
scİe
=
NÚe
):

62 
Args
:

63 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


64 
scİe
: 
Çme
 scope.

66 
R‘uºs
:

67 
Height
: 
A
 
‹nsÜ
 
w™h
 
sh­e
 [
N
] 
»´e£Ášg
 
box
 
heights
.

68 
Width
: 
A
 
‹nsÜ
 
w™h
 
sh­e
 [
N
] 
»´e£Ášg
 
box
 
widths
.

70 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'HeightWidth'):

71 
y_mš
, 
x_mš
, 
y_max
, 
x_max
 = 
tf
.
	`¥l™
(

72 
v®ue
=
boxli¡
.
	`g‘
(), 
num_Ü_size_¥l™s
=4, 
axis
=1)

73  
tf
.
	`squ“ze
(
y_max
 - 
y_mš
, [1]),f.squ“ze(
x_max
 - 
x_mš
, [1])

76 
def
 
	$sÿË
(
boxli¡
, 
y_sÿË
, 
x_sÿË
, 
scİe
=
NÚe
):

79 
Args
:

80 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


81 
y_sÿË
: (è
sÿÏr
 
‹nsÜ


82 
x_sÿË
: (è
sÿÏr
 
‹nsÜ


83 
scİe
: 
Çme
 scope.

85 
R‘uºs
:

86 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


88 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'Scale'):

89 
y_sÿË
 = 
tf
.
	$ÿ¡
(
y_sÿË
, 
tf
.
æßt32
)

90 
x_sÿË
 = 
tf
.
	$ÿ¡
(
x_sÿË
, 
tf
.
æßt32
)

91 
y_mš
, 
x_mš
, 
y_max
, 
x_max
 = 
tf
.
	`¥l™
(

92 
v®ue
=
boxli¡
.
	`g‘
(), 
num_Ü_size_¥l™s
=4, 
axis
=1)

93 
y_mš
 = 
y_sÿË
 * y_min

94 
y_max
 = 
y_sÿË
 * y_max

95 
x_mš
 = 
x_sÿË
 * x_min

96 
x_max
 = 
x_sÿË
 * x_max

97 
sÿËd_boxli¡
 = 
box_li¡
.
	`BoxLi¡
(

98 
tf
.
	$cÚÿt
([
y_mš
, 
x_mš
, 
y_max
, 
x_max
], 1))

99  
	$_cİy_exŒa_f›lds
(
sÿËd_boxli¡
, 
boxli¡
)

102 
def
 
	$ş_to_wšdow
(
boxli¡
, 
wšdow
, 
f‹r_nÚov”Ïµšg
=
True
, 
scİe
=
NÚe
):

105 
This
 
İ
 
şs
 
ªy
 
šput
 
boundšg
 
	$boxes
 (
»´e£Áed
 
by
 
boundšg
 
box


106 
cÜÃrs
è
to
 
a
 
wšdow
, 
İtiÚ®ly
 
f‹ršg
 
out
 
boxes
 
th©
 dØ
nÙ


107 
ov”Ïp
 
©
 
®l
 
w™h
 
the
 
wšdow
.

109 
Args
:

110 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
M_š
 
boxes


111 
wšdow
: 
a
 
‹nsÜ
 
of
 
sh­e
 [4] 
»´e£Ášg
 
the
 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
]

112 
wšdow
 
to
 
which
 
the
 
İ
 
should
 
ş
 
boxes
.

113 
f‹r_nÚov”Ïµšg
: 
wh‘h”
 
to
 
f‹r
 
out
 
boxes
 
th©
 dØ
nÙ
 
ov”Ïp
 
©


114 
®l
 
w™h
 
the
 
wšdow
.

115 
scİe
: 
Çme
 scope.

117 
R‘uºs
:

118 
a
 
BoxLi¡
 
hŞdšg
 
M_out
 
boxes
 
wh”e
 M_ouˆ<ğ
M_š


120 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'ClipToWindow'):

121 
y_mš
, 
x_mš
, 
y_max
, 
x_max
 = 
tf
.
	`¥l™
(

122 
v®ue
=
boxli¡
.
	`g‘
(), 
num_Ü_size_¥l™s
=4, 
axis
=1)

123 
wš_y_mš
, 
wš_x_mš
, 
wš_y_max
, 
wš_x_max
 = 
tf
.
	$un¡ack
(
wšdow
)

124 
y_mš_ş³d
 = 
tf
.
	`maximum
Ñf.
	`mšimum
(
y_mš
, 
wš_y_max
), 
wš_y_mš
)

125 
y_max_ş³d
 = 
tf
.
	`maximum
Ñf.
	`mšimum
(
y_max
, 
wš_y_max
), 
wš_y_mš
)

126 
x_mš_ş³d
 = 
tf
.
	`maximum
Ñf.
	`mšimum
(
x_mš
, 
wš_x_max
), 
wš_x_mš
)

127 
x_max_ş³d
 = 
tf
.
	`maximum
Ñf.
	`mšimum
(
x_max
, 
wš_x_max
), 
wš_x_mš
)

128 
ş³d
 = 
box_li¡
.
	`BoxLi¡
(

129 
tf
.
	$cÚÿt
([
y_mš_ş³d
, 
x_mš_ş³d
, 
y_max_ş³d
, 
x_max_ş³d
],

131 
ş³d
 = 
	$_cİy_exŒa_f›lds
(
ş³d
, 
boxli¡
)

132 
f‹r_nÚov”Ïµšg
:

133 
¬—s
 = 
	$¬—
(
ş³d
)

134 
nÚz”o_¬—_šdiûs
 = 
tf
.
	`ÿ¡
(

135 
tf
.
	`»sh­e
Ñf.
	`wh”e
Ñf.
	`g»©”
(
¬—s
, 0.0)), [-1]),f.
št32
)

136 
ş³d
 = 
	$g©h”
(
ş³d
, 
nÚz”o_¬—_šdiûs
)

137  
ş³d


140 
def
 
	$´uÃ_outside_wšdow
(
boxli¡
, 
wšdow
, 
scİe
=
NÚe
):

143 
This
 
funùiÚ
 
´uÃs
 
boundšg
 
boxes
 
th©
 
ev’
 
·¹ŸÎy
 
çÎ
 
outside
 
the
 
giv’


144 
wšdow
. 
S“
 
®so
 
ş_to_wšdow
 
which
 
Úly
 
´uÃs
 
boundšg
 
boxes
 
th©
 
çÎ


145 
com¶‘–y
 
outside
 
the
 
wšdow
, 
ªd
 
şs
 
ªy
 
boundšg
 
boxes
 
th©
 
·¹ŸÎy


146 
ov”æow
.

148 
Args
:

149 
boxli¡
: 
a
 
BoxLi¡
 
hŞdšg
 
M_š
 
boxes
.

150 
wšdow
: 
a
 
‹nsÜ
 
of
 
sh­e
 [4] 
»´e£Ášg
 [
ymš
, 
xmš
, 
ymax
, 
xmax
]

151 
of
 
the
 
wšdow


152 
scİe
: 
Çme
 scope.

154 
R‘uºs
:

155 
´uÃd_cÜÃrs
: 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
M_out
, 4] 
wh”e
 M_ouˆ<ğ
M_š


156 
v®id_šdiûs
: 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
M_out
] 
šdexšg
 
the
 
v®id
 
boundšg
 
boxes


157 
š
 
the
 
šput
 
‹nsÜ
.

159 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'PruneOutsideWindow'):

160 
y_mš
, 
x_mš
, 
y_max
, 
x_max
 = 
tf
.
	`¥l™
(

161 
v®ue
=
boxli¡
.
	`g‘
(), 
num_Ü_size_¥l™s
=4, 
axis
=1)

162 
wš_y_mš
, 
wš_x_mš
, 
wš_y_max
, 
wš_x_max
 = 
tf
.
	$un¡ack
(
wšdow
)

163 
coÜdš©e_viŞ©iÚs
 = 
tf
.
	`cÚÿt
([

164 
tf
.
	`Ëss
(
y_mš
, 
wš_y_mš
),f.Ëss(
x_mš
, 
wš_x_mš
),

165 
tf
.
	`g»©”
(
y_max
, 
wš_y_max
),f.g»©”(
x_max
, 
wš_x_max
)

167 
v®id_šdiûs
 = 
tf
.
	`»sh­e
(

168 
tf
.
	`wh”e
Ñf.
	`logiÿl_nÙ
Ñf.
	`»duû_ªy
(
coÜdš©e_viŞ©iÚs
, 1))), [-1])

169  
	`g©h”
(
boxli¡
, 
v®id_šdiûs
), valid_indices

172 
def
 
	$´uÃ_com¶‘–y_outside_wšdow
(
boxli¡
, 
wšdow
, 
scİe
=
NÚe
):

175 
The
 
funùiÚ
 
ş_to_wšdow
 
´uÃs
 
boundšg
 
boxes
 
th©
 
çÎ


176 
com¶‘–y
 
outside
 
the
 
wšdow
, 
but
 
®so
 
şs
 
ªy
 
boundšg
 
boxes
 
th©


177 
·¹ŸÎy
 
ov”æow
. 
This
 
funùiÚ
 
dÛs
 
nÙ
 
ş
…¬tŸÎy 
ov”æowšg
 
boxes
.

179 
Args
:

180 
boxli¡
: 
a
 
BoxLi¡
 
hŞdšg
 
M_š
 
boxes
.

181 
wšdow
: 
a
 
‹nsÜ
 
of
 
sh­e
 [4] 
»´e£Ášg
 [
ymš
, 
xmš
, 
ymax
, 
xmax
]

182 
of
 
the
 
wšdow


183 
scİe
: 
Çme
 scope.

185 
R‘uºs
:

186 
´uÃd_cÜÃrs
: 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
M_out
, 4] 
wh”e
 M_ouˆ<ğ
M_š


187 
v®id_šdiûs
: 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
M_out
] 
šdexšg
 
the
 
v®id
 
boundšg
 
boxes


188 
š
 
the
 
šput
 
‹nsÜ
.

190 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'PruneCompleteleyOutsideWindow'):

191 
y_mš
, 
x_mš
, 
y_max
, 
x_max
 = 
tf
.
	`¥l™
(

192 
v®ue
=
boxli¡
.
	`g‘
(), 
num_Ü_size_¥l™s
=4, 
axis
=1)

193 
wš_y_mš
, 
wš_x_mš
, 
wš_y_max
, 
wš_x_max
 = 
tf
.
	$un¡ack
(
wšdow
)

194 
coÜdš©e_viŞ©iÚs
 = 
tf
.
	`cÚÿt
([

195 
tf
.
	`g»©”_equ®
(
y_mš
, 
wš_y_max
),f.g»©”_equ®(
x_mš
, 
wš_x_max
),

196 
tf
.
	`Ëss_equ®
(
y_max
, 
wš_y_mš
),f.Ëss_equ®(
x_max
, 
wš_x_mš
)

198 
v®id_šdiûs
 = 
tf
.
	`»sh­e
(

199 
tf
.
	`wh”e
Ñf.
	`logiÿl_nÙ
Ñf.
	`»duû_ªy
(
coÜdš©e_viŞ©iÚs
, 1))), [-1])

200  
	`g©h”
(
boxli¡
, 
v®id_šdiûs
), valid_indices

203 
def
 
	$š‹r£ùiÚ
(
boxli¡1
, 
boxli¡2
, 
scİe
=
NÚe
):

206 
Args
:

207 
boxli¡1
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


208 
boxli¡2
: 
BoxLi¡
 
hŞdšg
 
M
 
boxes


209 
scİe
: 
Çme
 scope.

211 
R‘uºs
:

212 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
N
, 
M
] 
»´e£Ášg
 
·œwi£
 
š‹r£ùiÚs


214 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'Intersection'):

215 
y_mš1
, 
x_mš1
, 
y_max1
, 
x_max1
 = 
tf
.
	`¥l™
(

216 
v®ue
=
boxli¡1
.
	`g‘
(), 
num_Ü_size_¥l™s
=4, 
axis
=1)

217 
y_mš2
, 
x_mš2
, 
y_max2
, 
x_max2
 = 
tf
.
	`¥l™
(

218 
v®ue
=
boxli¡2
.
	`g‘
(), 
num_Ü_size_¥l™s
=4, 
axis
=1)

219 
®l_·œs_mš_ymax
 = 
tf
.
	`mšimum
(
y_max1
,f.
	$Œª¥o£
(
y_max2
))

220 
®l_·œs_max_ymš
 = 
tf
.
	`maximum
(
y_mš1
,f.
	$Œª¥o£
(
y_mš2
))

221 
š‹r£ù_heights
 = 
tf
.
	`maximum
(0.0, 
®l_·œs_mš_ymax
 - 
®l_·œs_max_ymš
)

222 
®l_·œs_mš_xmax
 = 
tf
.
	`mšimum
(
x_max1
,f.
	$Œª¥o£
(
x_max2
))

223 
®l_·œs_max_xmš
 = 
tf
.
	`maximum
(
x_mš1
,f.
	$Œª¥o£
(
x_mš2
))

224 
š‹r£ù_widths
 = 
tf
.
	`maximum
(0.0, 
®l_·œs_mš_xmax
 - 
®l_·œs_max_xmš
)

225  
š‹r£ù_heights
 * 
š‹r£ù_widths


228 
def
 
	$m©ched_š‹r£ùiÚ
(
boxli¡1
, 
boxli¡2
, 
scİe
=
NÚe
):

231 
Args
:

232 
boxli¡1
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


233 
boxli¡2
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


234 
scİe
: 
Çme
 scope.

236 
R‘uºs
:

237 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
N
] 
»´e£Ášg
 
·œwi£
 
š‹r£ùiÚs


239 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'MatchedIntersection'):

240 
y_mš1
, 
x_mš1
, 
y_max1
, 
x_max1
 = 
tf
.
	`¥l™
(

241 
v®ue
=
boxli¡1
.
	`g‘
(), 
num_Ü_size_¥l™s
=4, 
axis
=1)

242 
y_mš2
, 
x_mš2
, 
y_max2
, 
x_max2
 = 
tf
.
	`¥l™
(

243 
v®ue
=
boxli¡2
.
	`g‘
(), 
num_Ü_size_¥l™s
=4, 
axis
=1)

244 
mš_ymax
 = 
tf
.
	$mšimum
(
y_max1
, 
y_max2
)

245 
max_ymš
 = 
tf
.
	$maximum
(
y_mš1
, 
y_mš2
)

246 
š‹r£ù_heights
 = 
tf
.
	`maximum
(0.0, 
mš_ymax
 - 
max_ymš
)

247 
mš_xmax
 = 
tf
.
	$mšimum
(
x_max1
, 
x_max2
)

248 
max_xmš
 = 
tf
.
	$maximum
(
x_mš1
, 
x_mš2
)

249 
š‹r£ù_widths
 = 
tf
.
	`maximum
(0.0, 
mš_xmax
 - 
max_xmš
)

250  
tf
.
	`»sh­e
(
š‹r£ù_heights
 * 
š‹r£ù_widths
, [-1])

253 
def
 
	$iou
(
boxli¡1
, 
boxli¡2
, 
scİe
=
NÚe
):

256 
Args
:

257 
boxli¡1
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


258 
boxli¡2
: 
BoxLi¡
 
hŞdšg
 
M
 
boxes


259 
scİe
: 
Çme
 scope.

261 
R‘uºs
:

262 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
N
, 
M
] 
»´e£Ášg
 
·œwi£
 
iou
 
scÜes
.

264 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'IOU'):

265 
š‹r£ùiÚs
 = 
	$š‹r£ùiÚ
(
boxli¡1
, 
boxli¡2
)

266 
¬—s1
 = 
	$¬—
(
boxli¡1
)

267 
¬—s2
 = 
	$¬—
(
boxli¡2
)

268 
uniÚs
 = (

269 
tf
.
	`ex·nd_dims
(
¬—s1
, 1è+f.ex·nd_dims(
¬—s2
, 0è- 
š‹r£ùiÚs
)

270  
tf
.
	`wh”e
(

271 
tf
.
	`equ®
(
š‹r£ùiÚs
, 0.0),

272 
tf
.
	`z”os_like
(
š‹r£ùiÚs
),f.
	$Œuediv
(
š‹r£ùiÚs
, 
uniÚs
))

275 
def
 
	$m©ched_iou
(
boxli¡1
, 
boxli¡2
, 
scİe
=
NÚe
):

278 
Args
:

279 
boxli¡1
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


280 
boxli¡2
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


281 
scİe
: 
Çme
 scope.

283 
R‘uºs
:

284 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
N
] 
»´e£Ášg
 
·œwi£
 
iou
 
scÜes
.

286 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'MatchedIOU'):

287 
š‹r£ùiÚs
 = 
	$m©ched_š‹r£ùiÚ
(
boxli¡1
, 
boxli¡2
)

288 
¬—s1
 = 
	$¬—
(
boxli¡1
)

289 
¬—s2
 = 
	$¬—
(
boxli¡2
)

290 
uniÚs
 = 
¬—s1
 + 
¬—s2
 - 
š‹r£ùiÚs


291  
tf
.
	`wh”e
(

292 
tf
.
	`equ®
(
š‹r£ùiÚs
, 0.0),

293 
tf
.
	`z”os_like
(
š‹r£ùiÚs
),f.
	$Œuediv
(
š‹r£ùiÚs
, 
uniÚs
))

296 
def
 
	$iß
(
boxli¡1
, 
boxli¡2
, 
scİe
=
NÚe
):

299 
š‹r£ùiÚ
-
ov”
-
	$¬—
 (
IOA
è
b‘w“n
 
two
 
boxes
 
box1
 
ªd
 
box2
 
is
 
defšed
 
as


300 
theœ
 
š‹r£ùiÚ
 
¬—
 
ov”
 
box2
's‡rea. Notehat ioa is‚ot symmetric,

301 
th©
 
is
, 
	`iß
(
box1
, 
box2
) != ioa(box2, box1).

303 
Args
:

304 
boxli¡1
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


305 
boxli¡2
: 
BoxLi¡
 
hŞdšg
 
M
 
boxes


306 
scİe
: 
Çme
 scope.

308 
R‘uºs
:

309 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
N
, 
M
] 
»´e£Ášg
 
·œwi£
 
iß
 
scÜes
.

311 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'IOA'):

312 
š‹r£ùiÚs
 = 
	$š‹r£ùiÚ
(
boxli¡1
, 
boxli¡2
)

313 
¬—s
 = 
tf
.
	`ex·nd_dims
(
	`¬—
(
boxli¡2
), 0)

314  
tf
.
	$Œuediv
(
š‹r£ùiÚs
, 
¬—s
)

317 
def
 
	$´uÃ_nÚ_ov”Ïµšg_boxes
(

318 
boxli¡1
, 
boxli¡2
, 
mš_ov”Ïp
=0.0, 
scİe
=
NÚe
):

321 
FÜ
 
—ch
 
box
 
š
 
boxli¡1
, 
we
 
wªt
 
™s
 
IOA
 
to
 
be
 
mÜe
 
thª
 
mšov”Ïp
 
w™h


322 
©
 
Ëa¡
 
Úe
 
of
 
the
 
boxes
 
š
 
boxli¡2
. 
If
 
™
 
dÛs
 
nÙ
, 
we
 
»move
 it.

324 
Args
:

325 
boxli¡1
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes
.

326 
boxli¡2
: 
BoxLi¡
 
hŞdšg
 
M
 
boxes
.

327 
mš_ov”Ïp
: 
Mšimum
 
»quœed
 
ov”Ïp
 
b‘w“n
 
boxes
, 
to
 
couÁ
 
them
 
as


328 
ov”Ïµšg
.

329 
scİe
: 
Çme
 scope.

331 
R‘uºs
:

332 
Ãw_boxli¡1
: 
A
 
´uÃd
 
boxli¡
 
w™h
 
size
 [
N
', 4].

333 
k“p_šds
: 
A
 
‹nsÜ
 
w™h
 
sh­e
 [
N
'] indexing kept bounding boxes inhe

334 
fœ¡
 
šput
 
BoxLi¡
 `
boxli¡1
`.

336 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'PruneNonOverlappingBoxes'):

337 
iß_
 = 
	$iß
(
boxli¡2
, 
boxli¡1
è#[
M
, 
N
] 
‹nsÜ


338 
iß_
 = 
tf
.
	$»duû_max
(
iß_
, 
»duùiÚ_šdiûs
=[0]è#[
N
] 
‹nsÜ


339 
k“p_boŞ
 = 
tf
.
	`g»©”_equ®
(
iß_
,f.
	$cÚ¡ªt
(
mš_ov”Ïp
))

340 
k“p_šds
 = 
tf
.
	`squ“ze
Ñf.
	`wh”e
(
k“p_boŞ
), 
squ“ze_dims
=[1])

341 
Ãw_boxli¡1
 = 
	$g©h”
(
boxli¡1
, 
k“p_šds
)

342  
Ãw_boxli¡1
, 
k“p_šds


345 
def
 
	$´uÃ_sm®l_boxes
(
boxli¡
, 
mš_side
, 
scİe
=
NÚe
):

348 
Args
:

349 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes
.

350 
mš_side
: 
Mšimum
 
width
 
AND
 
height
 
of
 
box
 
to
 
survive
 
´unšg
.

351 
scİe
: 
Çme
 scope.

353 
R‘uºs
:

354 
A
 
´uÃd
 
boxli¡
.

356 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'PruneSmallBoxes'):

357 
height
, 
width
 = 
	$height_width
(
boxli¡
)

358 
is_v®id
 = 
tf
.
	`logiÿl_ªd
Ñf.
	`g»©”_equ®
(
width
, 
mš_side
),

359 
tf
.
	$g»©”_equ®
(
height
, 
mš_side
))

360  
	`g©h”
(
boxli¡
, 
tf
.
	`»sh­e
Ñf.
	`wh”e
(
is_v®id
), [-1]))

363 
def
 
	$chªge_coÜdš©e_äame
(
boxli¡
, 
wšdow
, 
scİe
=
NÚe
):

366 
Giv’
 
a
 
wšdow
 
of
 
the
 
fÜm
 [
ymš
, 
xmš
, 
ymax
, 
xmax
],

367 
chªges
 
boundšg
 
box
 
coÜdš©es
 
äom
 
boxli¡
 
to
 
be
 
»Ïtive
Ø
this
 
wšdow


368 (
e
.
g
., 
the
 
mš
 
cÜÃr
 
m­s
 
	$to
 (0,0è
ªd
 
the
 
max
 
cÜÃr
 
m­s
 
	`to
 (1,1)).

370 
An
 
exam¶e
 
u£
 
is
 
d©a
 
augm’tiÚ
: 
wh”e
 
we
 
¬e
 
giv’
 
groundŒuth


371 
	$boxes
 (
boxli¡
è
ªd
 
would
 
like
 
to
 
¿ndomly
 
üİ
 
the
 
image
Ø
some


372 
	`wšdow
 (
wšdow
). 
In
 
this
 
we
 
Ãed
 
to
 
chªge
 
the
 
coÜdš©e
 
äame
 
of


373 
—ch
 
groundŒuth
 
box
 
to
 
be
 
»Ïtive
Ø
this
 
Ãw
 
wšdow
.

375 
Args
:

376 
boxli¡
: 
A
 
BoxLi¡
 
objeù
 
hŞdšg
 
N
 
boxes
.

377 
wšdow
: 
A
 
¿nk
 1 
‹nsÜ
 [4].

378 
scİe
: 
Çme
 scope.

380 
R‘uºs
:

381 
R‘uºs
 
a
 
BoxLi¡
 
objeù
 
w™h
 
N
 
boxes
.

383 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'ChangeCoordinateFrame'):

384 
wš_height
 = 
wšdow
[2] - window[0]

385 
wš_width
 = 
wšdow
[3] - window[1]

386 
boxli¡_Ãw
 = 
	`sÿË
(
box_li¡
.
	`BoxLi¡
(

387 
boxli¡
.
	`g‘
(è- [
wšdow
[0], window[1], window[0], window[1]]),

388 1.0 / 
wš_height
, 1.0 / 
wš_width
)

389 
boxli¡_Ãw
 = 
	$_cİy_exŒa_f›lds
(
boxli¡_Ãw
, 
boxli¡
)

390  
boxli¡_Ãw


393 
def
 
	$sq_di¡
(
boxli¡1
, 
boxli¡2
, 
scİe
=
NÚe
):

396 
This
 
İ
 
Œ—ts
 
—ch
 
box
 
as
 
™
 
w”e
 
a
 
pošt
 
š
‡ 4d 
Euşid—n
 
¥aû
 
ªd


397 
compu‹s
 
·œwi£
 
squ¬ed
 
di¡ªûs
.

399 
M©hem©iÿÎy
, 
we
 
¬e
 
giv’
 
two
 
m©riûs
 
of
 
box
 
coÜdš©es
 
X
 
ªd
 
Y
,

400 
wh”e
 
	$X
(
i
,:è
is
 
the
 i'th„ow of X, containinghe 4‚umbers defininghe

401 
cÜÃrs
 
of
 
the
 
i
'th box in boxlist1. Similarly Y(j,:) correspondso

402 
boxli¡2
. 
We
 
compu‹


403 
	`Z
(
i
,
j
èğ||
	`X
(i,:è- 
	`Y
(j,:)||^2

404 ğ||
	`X
(
i
,:)||^2 + ||
	`Y
(
j
,:)||^2 - 2 X(i,:)' * Y(j,:),

406 
Args
:

407 
boxli¡1
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


408 
boxli¡2
: 
BoxLi¡
 
hŞdšg
 
M
 
boxes


409 
scİe
: 
Çme
 scope.

411 
R‘uºs
:

412 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
N
, 
M
] 
»´e£Ášg
 
·œwi£
 
di¡ªûs


414 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'SqDist'):

415 
sqnÜm1
 = 
tf
.
	`»duû_sum
Ñf.
	`squ¬e
(
boxli¡1
.
	`g‘
()), 1, 
k“p_dims
=
True
)

416 
sqnÜm2
 = 
tf
.
	`»duû_sum
Ñf.
	`squ¬e
(
boxli¡2
.
	`g‘
()), 1, 
k“p_dims
=
True
)

417 
šÃ½rod
 = 
tf
.
	`m©mul
(
boxli¡1
.
	`g‘
(), 
boxli¡2
.get(),

418 
Œª¥o£_a
=
F®£
, 
Œª¥o£_b
=
True
)

419  
sqnÜm1
 + 
tf
.
	`Œª¥o£
(
sqnÜm2
è- 2.0 * 
šÃ½rod


422 
def
 
	$boŞ—n_mask
(
boxli¡
, 
šdiÿtÜ
, 
f›lds
=
NÚe
, 
scİe
=None):

425 `
boŞ—n_mask
` 
»tuºs
 
the
 
sub£t
 
of
 
boxes
 
th©
 
¬e
 
m¬ked
 
as
 "True" 
by
he

426 
šdiÿtÜ
 
‹nsÜ
. 
By
 , `
boŞ—n_mask
` 
»tuºs
 
boxes
 
cÜ»¥Údšg
 
to


427 
the
 
šput
 
šdex
 
li¡
, 
as
 
w–l
‡ 
®l
 
add™iÚ®
 
f›lds
 
¡Üed
 
š
h
boxli¡


428 (
šdexšg
 
što
 
the
 
fœ¡
 
dim’siÚ
). 
Howev”
 
Úe
 
ÿn
 
İtiÚ®ly
 
Úly
 
d¿w


429 
äom
 
a
 
sub£t
 
of
 
f›lds
.

431 
Args
:

432 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


433 
šdiÿtÜ
: 
a
 
¿nk
-1 
boŞ—n
 
‹nsÜ


434 
f›lds
: (
İtiÚ®
è
li¡
 
of
 f›ld 
to
 
®so
 
g©h”
 
äom
. 
If
 
	`NÚe
 (),

435 
®l
 
f›lds
 
¬e
 
g©h”ed
 
äom
. 
Pass
 
ª
 
em±y
 f›ld 
li¡
 
to
 
Úly
 
g©h”


436 
the
 
box
 
coÜdš©es
.

437 
scİe
: 
Çme
 scope.

439 
R‘uºs
:

440 
subboxli¡
: 
a
 
BoxLi¡
 
cÜ»¥Údšg
 
to
 
the
 
sub£t
 
of
h
šput
 BoxList

441 
¥ecif›d
 
by
 
šdiÿtÜ


442 
Rai£s
:

443 
V®ueE¼Ü
: `
šdiÿtÜ
` 
is
 
nÙ
 
a
 
¿nk
-1 
boŞ—n
 
‹nsÜ
.

445 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'BooleanMask'):

446 
šdiÿtÜ
.
sh­e
.
ndims
 != 1:

447 
¿i£
 
	`V®ueE¼Ü
('indicator should have„ank 1')

448 
šdiÿtÜ
.
dty³
 !ğ
tf
.
boŞ
:

449 
¿i£
 
	`V®ueE¼Ü
('indicator should be‡ booleanensor')

450 
subboxli¡
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	`boŞ—n_mask
(
boxli¡
.
	`g‘
(), 
šdiÿtÜ
))

451 
f›lds
 
is
 
NÚe
:

452 
f›lds
 = 
boxli¡
.
	$g‘_exŒa_f›lds
()

453 
f›ld
 
š
 
f›lds
:

454 
nÙ
 
boxli¡
.
	$has_f›ld
(
f›ld
):

455 
¿i£
 
	`V®ueE¼Ü
('boxlist must contain‡ll specified fields')

456 
subf›ldli¡
 = 
tf
.
	`boŞ—n_mask
(
boxli¡
.
	`g‘_f›ld
(
f›ld
), 
šdiÿtÜ
)

457 
subboxli¡
.
	$add_f›ld
(
f›ld
, 
subf›ldli¡
)

458  
subboxli¡


461 
def
 
	$g©h”
(
boxli¡
, 
šdiûs
, 
f›lds
=
NÚe
, 
scİe
=None):

464 
By
 , `
g©h”
` 
»tuºs
 
boxes
 
cÜ»¥Údšg
 
to
 
the
 
šput
 
šdex
 
li¡
, 
as


465 
w–l
 
as
 
®l
 
add™iÚ®
 
f›lds
 
¡Üed
 
š
 
the
 
	`boxli¡
 (
šdexšg
 
što
he

466 
fœ¡
 
dim’siÚ
). 
Howev”
 
Úe
 
ÿn
 
İtiÚ®ly
 
Úly
 
g©h”
 
äom
 
a


467 
sub£t
 
of
 
f›lds
.

469 
Args
:

470 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


471 
šdiûs
: 
a
 
¿nk
-1 
‹nsÜ
 
of
 
ty³
 
št32
 / 
št64


472 
f›lds
: (
İtiÚ®
è
li¡
 
of
 f›ld 
to
 
®so
 
g©h”
 
äom
. 
If
 
	`NÚe
 (),

473 
®l
 
f›lds
 
¬e
 
g©h”ed
 
äom
. 
Pass
 
ª
 
em±y
 f›ld 
li¡
 
to
 
Úly
 
g©h”


474 
the
 
box
 
coÜdš©es
.

475 
scİe
: 
Çme
 scope.

477 
R‘uºs
:

478 
subboxli¡
: 
a
 
BoxLi¡
 
cÜ»¥Údšg
 
to
 
the
 
sub£t
 
of
h
šput
 BoxList

479 
¥ecif›d
 
by
 
šdiûs


480 
Rai£s
:

481 
V®ueE¼Ü
: 
¥ecif›d
 
f›ld
 
is
 
nÙ
 
cÚšed
 
š
 
boxli¡
 
Ü
 
the


482 
šdiûs
 
¬e
 
nÙ
 
of
 
ty³
 
št32


484 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'Gather'):

485 
	`Ën
(
šdiûs
.
sh­e
.
	`as_li¡
()) != 1:

486 
¿i£
 
	`V®ueE¼Ü
('indices should have„ank 1')

487 
šdiûs
.
dty³
 !ğ
tf
.
št32
 
ªd
 indiûs.dty³ !ğtf.
št64
:

488 
¿i£
 
	`V®ueE¼Ü
('indices should be‡n int32 / int64ensor')

489 
subboxli¡
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	`g©h”
(
boxli¡
.
	`g‘
(), 
šdiûs
))

490 
f›lds
 
is
 
NÚe
:

491 
f›lds
 = 
boxli¡
.
	$g‘_exŒa_f›lds
()

492 
f›ld
 
š
 
f›lds
:

493 
nÙ
 
boxli¡
.
	$has_f›ld
(
f›ld
):

494 
¿i£
 
	`V®ueE¼Ü
('boxlist must contain‡ll specified fields')

495 
subf›ldli¡
 = 
tf
.
	`g©h”
(
boxli¡
.
	`g‘_f›ld
(
f›ld
), 
šdiûs
)

496 
subboxli¡
.
	$add_f›ld
(
f›ld
, 
subf›ldli¡
)

497  
subboxli¡


500 
def
 
	$cÚÿ‹Ç‹
(
boxli¡s
, 
f›lds
=
NÚe
, 
scİe
=None):

503 
This
 
İ
 
cÚÿ‹Ç‹s
 
a
 
li¡
 
of
 
šput
 
BoxLi¡s
 
što
‡ 
Ïrg”
 
BoxLi¡
. 
It
 
®so


504 
hªdËs
 
cÚÿ‹ÇtiÚ
 
of
 
BoxLi¡
 
f›lds
 
as
 a 
the
 
f›ld
 
‹nsÜ
 
sh­es


505 
¬e
 
equ®
 
exû±
 
the
 
fœ¡
 
dim’siÚ
.

507 
Args
:

508 
boxli¡s
: 
li¡
 
of
 
BoxLi¡
 
objeùs


509 
f›lds
: 
İtiÚ®
 
li¡
 
of
 f›ld 
to
 
®so
 
cÚÿ‹Ç‹
. 
By
 , 
®l


510 
f›lds
 
äom
 
the
 
fœ¡
 
BoxLi¡
 
š
h
li¡
 
¬e
 
šşuded
 inhe

511 
cÚÿ‹ÇtiÚ
.

512 
scİe
: 
Çme
 scope.

514 
R‘uºs
:

515 
a
 
BoxLi¡
 
w™h
 
numb”
 
of
 
boxes
 
equ®
 
to


516 
	`sum
([
boxli¡
.
	$num_boxes
(è
boxli¡
 
š
 
BoxLi¡
])

517 
Rai£s
:

518 
V®ueE¼Ü
: 
boxli¡s
 
is
 
	`šv®id
 (
i
.
e
., i 
nÙ
 
a
 
li¡
, i 
em±y
, 
Ü


519 
cÚšs
 
nÚ
 
BoxLi¡
 
objeùs
), 
Ü
 
»que¡ed
 
f›lds
 
¬e
 
nÙ
 
cÚšed
 
š


520 
®l
 
boxli¡s


522 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'Concatenate'):

523 
nÙ
 
	$isš¡ªû
(
boxli¡s
, 
li¡
):

524 
¿i£
 
	`V®ueE¼Ü
('boxlists should be‡†ist')

525 
nÙ
 
boxli¡s
:

526 
¿i£
 
	`V®ueE¼Ü
('boxlists should have‚onzero†ength')

527 
boxli¡
 
š
 
boxli¡s
:

528 
nÙ
 
	$isš¡ªû
(
boxli¡
, 
box_li¡
.
BoxLi¡
):

529 
¿i£
 
	`V®ueE¼Ü
('allƒlements of boxlists should be BoxList objects')

530 
cÚÿ‹Ç‹d
 = 
box_li¡
.
	`BoxLi¡
(

531 
tf
.
	`cÚÿt
([
boxli¡
.
	$g‘
(è
boxli¡
 
š
 
boxli¡s
], 0))

532 
f›lds
 
is
 
NÚe
:

533 
f›lds
 = 
boxli¡s
[0].
	$g‘_exŒa_f›lds
()

534 
f›ld
 
š
 
f›lds
:

535 
fœ¡_f›ld_sh­e
 = 
boxli¡s
[0].
	`g‘_f›ld
(
f›ld
).
	`g‘_sh­e
().
	$as_li¡
()

536 
fœ¡_f›ld_sh­e
[0] = -1

537 
NÚe
 
š
 
fœ¡_f›ld_sh­e
:

538 
¿i£
 
	`V®ueE¼Ü
('field %s must have fully defined shapeƒxcept forhe'

539 ' 0th dim’siÚ.' % 
f›ld
)

540 
boxli¡
 
š
 
boxli¡s
:

541 
nÙ
 
boxli¡
.
	$has_f›ld
(
f›ld
):

542 
¿i£
 
	`V®ueE¼Ü
('boxlist must contain‡ll„equested fields')

543 
f›ld_sh­e
 = 
boxli¡
.
	`g‘_f›ld
(
f›ld
).
	`g‘_sh­e
().
	$as_li¡
()

544 
f›ld_sh­e
[0] = -1

545 
f›ld_sh­e
 !ğ
fœ¡_f›ld_sh­e
:

546 
¿i£
 
	`V®ueE¼Ü
('field %s must have same shape for‡ll boxlists '

547 'exû± fÜh0th dim’siÚ.' % 
f›ld
)

548 
cÚÿ‹Ç‹d_f›ld
 = 
tf
.
	`cÚÿt
(

549 [
boxli¡
.
	$g‘_f›ld
(
f›ld
è
boxli¡
 
š
 
boxli¡s
], 0)

550 
cÚÿ‹Ç‹d
.
	$add_f›ld
(
f›ld
, 
cÚÿ‹Ç‹d_f›ld
)

551  
cÚÿ‹Ç‹d


554 
def
 
	$sÜt_by_f›ld
(
boxli¡
, 
f›ld
, 
Üd”
=
SÜtOrd”
.
desûnd
, 
scİe
=
NÚe
):

557 
A
 
commÚ
 
u£
 
is
 
»Üd”šg
 
the
 
boxes
 
accÜdšg
 
to
 
desûndšg
 
scÜes
.

559 
Args
:

560 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes
.

561 
f›ld
: 
A
 
BoxLi¡
 f›ld 
sÜtšg
 
ªd
 
»Üd”šg
 
the
 BoxList.

562 
Üd”
: (
O±iÚ®
è
desûnd
 
Ü
 
asûnd
. 
DeçuÉ
 
is
 descend.

563 
scİe
: 
Çme
 scope.

565 
R‘uºs
:

566 
sÜ‹d_boxli¡
: 
A
 
sÜ‹d
 
BoxLi¡
 
w™h
 
the
 
f›ld
 
š
h
¥ecif›d
 
Üd”
.

568 
Rai£s
:

569 
V®ueE¼Ü
: 
¥ecif›d
 
f›ld
 
dÛs
 
nÙ
 
exi¡


570 
V®ueE¼Ü
: 
the
 
Üd”
 
is
 
nÙ
 
e™h”
 
desûnd
 
Ü
 
asûnd


572 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'SortByField'):

573 
Üd”
 !ğ
SÜtOrd”
.
desûnd
 
ªd
 ord” !ğSÜtOrd”.
asûnd
:

574 
¿i£
 
	`V®ueE¼Ü
('Invalid sort order')

576 
f›ld_to_sÜt
 = 
boxli¡
.
	$g‘_f›ld
(
f›ld
)

577 
	`Ën
(
f›ld_to_sÜt
.
sh­e
.
	`as_li¡
()) != 1:

578 
¿i£
 
	`V®ueE¼Ü
('Field should have„ank 1')

580 
num_boxes
 = 
boxli¡
.
	$num_boxes
()

581 
num_’Œ›s
 = 
tf
.
	$size
(
f›ld_to_sÜt
)

582 
Ëngth_as£¹
 = 
tf
.
	`As£¹
(

583 
tf
.
	`equ®
(
num_boxes
, 
num_’Œ›s
),

584 ['IncÜ»ù f›ld size:‡ùu® v ex³ùed.', 
num_’Œ›s
, 
num_boxes
])

586 
w™h
 
tf
.
	$cÚŒŞ_d•’d’c›s
([
Ëngth_as£¹
]):

587 #TODO: 
Remove
 
w™h
 
tf
.
deviû
 
wh’
 
tİ_k
 
İ”©iÚ
 
runs
 
cÜ»ùly
 
Ú
 
GPU
.

588 
w™h
 
tf
.
	`deviû
('/cpu:0'):

589 
_
, 
sÜ‹d_šdiûs
 = 
tf
.
Â
.
	$tİ_k
(
f›ld_to_sÜt
, 
num_boxes
, 
sÜ‹d
=
True
)

591 
Üd”
 =ğ
SÜtOrd”
.
asûnd
:

592 
sÜ‹d_šdiûs
 = 
tf
.
	$»v”£_v2
(
sÜ‹d_šdiûs
, [0])

594  
	$g©h”
(
boxli¡
, 
sÜ‹d_šdiûs
)

597 
def
 
	$visu®ize_boxes_š_image
(
image
, 
boxli¡
, 
nÜm®ized
=
F®£
, 
scİe
=
NÚe
):

600 
Cu¼’y
 
this
 
visu®iz©iÚ
 
¶Ùs
 
a
 1 
pix–
 
thick
 
»d
 
boundšg
 
box
 
Ú
 
tİ


601 
of
 
the
 
image
. 
NÙe
 
th©
 
tf
.image.
d¿w_boundšg_boxes
 
es£ÁŸÎy
 
is


602 1 
šdexed
.

604 
Args
:

605 
image
: 
ª
 imag
‹nsÜ
 
w™h
 
sh­e
 [
height
, 
width
, 3]

606 
boxli¡
: 
a
 
BoxLi¡


607 
nÜm®ized
: (
boŞ—n
è
¥ecify
 
wh‘h”
 
cÜÃrs
 
¬e
 
to
 
be
 
š‹½»‹d


608 
as
 
absŞu‹
 
coÜdš©es
 
š
 
image
 
¥aû
 
Ü
 
nÜm®ized
 
w™h
 
»¥eù
 
to
 
the


609 
image
 
size
.

610 
scİe
: 
Çme
 scope.

612 
R‘uºs
:

613 
image_ªd_boxes
: 
ª
 
image
 
‹nsÜ
 
w™h
 
sh­e
 [
height
, 
width
, 3]

615 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'VisualizeBoxesInImage'):

616 
nÙ
 
nÜm®ized
:

617 
height
, 
width
, 
_
 = 
tf
.
	`un¡ack
Ñf.
	$sh­e
(
image
))

618 
boxli¡
 = 
	`sÿË
(boxlist,

619 1.0 / 
tf
.
	`ÿ¡
(
height
,f.
æßt32
),

620 1.0 / 
tf
.
	$ÿ¡
(
width
, 
tf
.
æßt32
))

621 
cÜÃrs
 = 
tf
.
	`ex·nd_dims
(
boxli¡
.
	`g‘
(), 0)

622 
image
 = 
tf
.
	$ex·nd_dims
(
image
, 0)

623  
tf
.
	`squ“ze
Ñf.
image
.
	`d¿w_boundšg_boxes
(image, 
cÜÃrs
), [0])

626 
def
 
	$f‹r_f›ld_v®ue_equ®s
(
boxli¡
, 
f›ld
, 
v®ue
, 
scİe
=
NÚe
):

629 
Args
:

630 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes
.

631 
f›ld
: f›ld 
Çme
 
f‹ršg
.

632 
v®ue
: 
sÿÏr
 value.

633 
scİe
: 
Çme
 scope.

635 
R‘uºs
:

636 
a
 
BoxLi¡
 
hŞdšg
 
M
 
boxes
 
wh”e
 M <ğ
N


638 
Rai£s
:

639 
V®ueE¼Ü
: 
boxli¡
 
nÙ
 
a
 
BoxLi¡
 
objeù
 
Ü
 
™
 
dÛs
‚Ù 
have


640 
the
 
¥ecif›d
 
f›ld
.

642 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'FilterFieldValueEquals'):

643 
nÙ
 
	$isš¡ªû
(
boxli¡
, 
box_li¡
.
BoxLi¡
):

644 
¿i£
 
	`V®ueE¼Ü
('boxlist must be‡ BoxList')

645 
nÙ
 
boxli¡
.
	$has_f›ld
(
f›ld
):

646 
¿i£
 
	`V®ueE¼Ü
('boxlist must containhe specified field')

647 
f‹r_f›ld
 = 
boxli¡
.
	$g‘_f›ld
(
f›ld
)

648 
g©h”_šdex
 = 
tf
.
	`»sh­e
Ñf.
	`wh”e
Ñf.
	`equ®
(
f‹r_f›ld
, 
v®ue
)), [-1])

649  
	$g©h”
(
boxli¡
, 
g©h”_šdex
)

652 
def
 
	$f‹r_g»©”_thª
(
boxli¡
, 
th»sh
, 
scİe
=
NÚe
):

655 
This
 
İ
 
k“ps
 
the
 
cŞËùiÚ
 
of
 
boxes
 
who£
 
cÜ»¥Údšg
 
scÜes
 
¬e


656 
g»©”
 
thª
 
the
 
šput
 
th»shŞd
.

658 
TODO
: 
Chªge
 
funùiÚ
 
Çme
 
to
 
F‹rScÜesG»©”Thª


660 
Args
:

661 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes
. 
Mu¡
 
cÚš
 
a
 'scÜes' 
f›ld


662 
»´e£Ášg
 
d‘eùiÚ
 
scÜes
.

663 
th»sh
: 
sÿÏr
 
th»shŞd


664 
scİe
: 
Çme
 scope.

666 
R‘uºs
:

667 
a
 
BoxLi¡
 
hŞdšg
 
M
 
boxes
 
wh”e
 M <ğ
N


669 
Rai£s
:

670 
V®ueE¼Ü
: 
boxli¡
 
nÙ
 
a
 
BoxLi¡
 
objeù
 
Ü
 
™
 
dÛs
‚ot

671 
have
 
a
 
scÜes
 
f›ld


673 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'FilterGreaterThan'):

674 
nÙ
 
	$isš¡ªû
(
boxli¡
, 
box_li¡
.
BoxLi¡
):

675 
¿i£
 
	`V®ueE¼Ü
('boxlist must be‡ BoxList')

676 
nÙ
 
boxli¡
.
	`has_f›ld
('scores'):

677 
¿i£
 
	`V®ueE¼Ü
('input boxlist must have \'scores\' field')

678 
scÜes
 = 
boxli¡
.
	`g‘_f›ld
('scores')

679 
	`Ën
(
scÜes
.
sh­e
.
	`as_li¡
()) > 2:

680 
¿i£
 
	`V®ueE¼Ü
('Scores should have„ank 1 or 2')

681 
	`Ën
(
scÜes
.
sh­e
.
	`as_li¡
()è=ğ2 
ªd
 scores.shape.as_list()[1] != 1:

682 
¿i£
 
	`V®ueE¼Ü
('Scores should have„ank 1 or have shape '

684 
high_scÜe_šdiûs
 = 
tf
.
	`ÿ¡
Ñf.
	`»sh­e
(

685 
tf
.
	`wh”e
Ñf.
	`g»©”
(
scÜes
, 
th»sh
)),

686 [-1]), 
tf
.
št32
)

687  
	$g©h”
(
boxli¡
, 
high_scÜe_šdiûs
)

690 
def
 
	$nÚ_max_suµ»ssiÚ
(
boxli¡
, 
th»sh
, 
max_ouut_size
, 
scİe
=
NÚe
):

693 
This
 
İ
 
g»edy
 
£Ëùs
 
a
 
sub£t
 
of
 
d‘eùiÚ
 
boundšg
 
boxes
, 
´unšg


694 
away
 
boxes
 
th©
 
have
 
high
 
	$IOU
 (
š‹r£ùiÚ
 
ov”
 è
	`ov”Ïp
 (> 
th»sh
)

695 
w™h
 
®»ady
 
£Ëùed
 
boxes
. 
NÙe
 
th©
 
this
 
Úly
 
wÜks
 
a
 
sšgË
 
şass
 ---

696 
to
 
­¶y
 
NMS
Ø
muÉi
-
şass
 
´ediùiÚs
, 
u£
 
MuÉiCÏssNÚMaxSuµ»ssiÚ
.

698 
Args
:

699 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes
. 
Mu¡
 
cÚš
 
a
 'scÜes' 
f›ld


700 
»´e£Ášg
 
d‘eùiÚ
 
scÜes
.

701 
th»sh
: 
sÿÏr
 
th»shŞd


702 
max_ouut_size
: 
maximum
 
numb”
 
of
 
»šed
 
boxes


703 
scİe
: 
Çme
 scope.

705 
R‘uºs
:

706 
a
 
BoxLi¡
 
hŞdšg
 
M
 
boxes
 
wh”e
 M <ğ
max_ouut_size


707 
Rai£s
:

708 
V®ueE¼Ü
: 
th»sh
 
is
 
nÙ
 
š
 [0, 1]

710 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'NonMaxSuppression'):

711 
nÙ
 0 <ğ
th»sh
 <= 1.0:

712 
¿i£
 
	`V®ueE¼Ü
('thresh must be between 0‡nd 1')

713 
nÙ
 
	$isš¡ªû
(
boxli¡
, 
box_li¡
.
BoxLi¡
):

714 
¿i£
 
	`V®ueE¼Ü
('boxlist must be‡ BoxList')

715 
nÙ
 
boxli¡
.
	`has_f›ld
('scores'):

716 
¿i£
 
	`V®ueE¼Ü
('input boxlist must have \'scores\' field')

717 
£Ëùed_šdiûs
 = 
tf
.
image
.
	`nÚ_max_suµ»ssiÚ
(

718 
boxli¡
.
	`g‘
(), boxli¡.
	`g‘_f›ld
('scores'),

719 
max_ouut_size
, 
iou_th»shŞd
=
th»sh
)

720  
	$g©h”
(
boxli¡
, 
£Ëùed_šdiûs
)

723 
def
 
	$_cİy_exŒa_f›lds
(
boxli¡_to_cİy_to
, 
boxli¡_to_cİy_äom
):

726 
Args
:

727 
boxli¡_to_cİy_to
: 
BoxLi¡
 
to
 
which
 
exŒa
 
f›lds
 
¬e
 
cİ›d
.

728 
boxli¡_to_cİy_äom
: 
BoxLi¡
 
äom
 
which
 
f›lds
 
¬e
 
cİ›d
.

730 
R‘uºs
:

731 
boxli¡_to_cİy_to
 
w™h
 
exŒa
 
f›lds
.

733 
f›ld
 
š
 
boxli¡_to_cİy_äom
.
	$g‘_exŒa_f›lds
():

734 
boxli¡_to_cİy_to
.
	`add_f›ld
(
f›ld
, 
boxli¡_to_cİy_äom
.
	$g‘_f›ld
(
f›ld
))

735  
boxli¡_to_cİy_to


738 
def
 
	$to_nÜm®ized_coÜdš©es
(
boxli¡
, 
height
, 
width
,

739 
check_¿nge
=
True
, 
scİe
=
NÚe
):

742 
Usu®ly
 
Úe
 
u£s
 
the
 
dyÇmic
 
sh­e
 
of
h
image
 
Ü
 
cÚv
-
Ïy”
 
‹nsÜ
:

743 
boxli¡
 = 
box_li¡_İs
.
	`to_nÜm®ized_coÜdš©es
(boxlist,

744 
tf
.
	`sh­e
(
images
)[1],

745 
tf
.
	`sh­e
(
images
)[2]),

747 
This
 
funùiÚ
 
¿i£s
 
ª
 
as£¹iÚ
 
çed
 
”rÜ
 
©
 
g¿ph
 
executiÚ
 
time
 
wh’


748 
the
 
maximum
 
coÜdš©e
 
is
 
sm®Ër
 
thª
 1.01 (
which
 
m—ns
 
th©
 
coÜdš©es
 
¬e


749 
®»ady
 
nÜm®ized
). 
The
 
v®ue
 1.01 
is
 
to
 
d—l
 
w™h
 
sm®l
 
roundšg
 
”rÜs
.

751 
Args
:

752 
boxli¡
: 
BoxLi¡
 
w™h
 
coÜdš©es
 
š
 
‹rms
 
of
 
pix–
-
loÿtiÚs
.

753 
height
: 
Maximum
 
v®ue
 heighˆ
of
 
absŞu‹
 
box
 
coÜdš©es
.

754 
width
: 
Maximum
 
v®ue
 width 
of
 
absŞu‹
 
box
 
coÜdš©es
.

755 
check_¿nge
: 
If
 
True
, 
checks
 
the
 
coÜdš©es
 
¬e
 
nÜm®ized
 
Ü
 
nÙ
.

756 
scİe
: 
Çme
 scope.

758 
R‘uºs
:

759 
boxli¡
 
w™h
 
nÜm®ized
 
coÜdš©es
 
š
 [0, 1].

761 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'ToNormalizedCoordinates'):

762 
height
 = 
tf
.
	$ÿ¡
(
height
, 
tf
.
æßt32
)

763 
width
 = 
tf
.
	$ÿ¡
(
width
, 
tf
.
æßt32
)

765 
check_¿nge
:

766 
max_v®
 = 
tf
.
	`»duû_max
(
boxli¡
.
	$g‘
())

767 
max_as£¹
 = 
tf
.
	`As£¹
Ñf.
	`g»©”
(
max_v®
, 1.01),

768 ['max v®ui low”hª 1.01: ', 
max_v®
])

769 
w™h
 
tf
.
	$cÚŒŞ_d•’d’c›s
([
max_as£¹
]):

770 
width
 = 
tf
.
	$id’t™y
(
width
)

772  
	`sÿË
(
boxli¡
, 1 / 
height
, 1 / 
width
)

775 
def
 
	$to_absŞu‹_coÜdš©es
(
boxli¡
, 
height
, 
width
,

776 
check_¿nge
=
True
, 
scİe
=
NÚe
):

779 
This
 
funùiÚ
 
¿i£s
 
ª
 
as£¹iÚ
 
çed
 
”rÜ
 
wh’
 
the
 
maximum
 
box
 
coÜdš©e


780 
v®ue
 
is
 
Ïrg”
 
thª
 1.01 (
š
 
which
 
coÜdš©es
 
¬e
 
®»ady
 
absŞu‹
).

782 
Args
:

783 
boxli¡
: 
BoxLi¡
 
w™h
 
coÜdš©es
 
š
 
¿nge
 [0, 1].

784 
height
: 
Maximum
 
v®ue
 heighˆ
of
 
absŞu‹
 
box
 
coÜdš©es
.

785 
width
: 
Maximum
 
v®ue
 width 
of
 
absŞu‹
 
box
 
coÜdš©es
.

786 
check_¿nge
: 
If
 
True
, 
checks
 
the
 
coÜdš©es
 
¬e
 
nÜm®ized
 
Ü
 
nÙ
.

787 
scİe
: 
Çme
 scope.

789 
R‘uºs
:

790 
boxli¡
 
w™h
 
absŞu‹
 
coÜdš©es
 
š
 
‹rms
 
of
 
the
 
image
 
size
.

793 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'ToAbsoluteCoordinates'):

794 
height
 = 
tf
.
	$ÿ¡
(
height
, 
tf
.
æßt32
)

795 
width
 = 
tf
.
	$ÿ¡
(
width
, 
tf
.
æßt32
)

797 #Ensu» 
¿nge
 
of
 
šput
 
boxes
 
is
 
cÜ»ù
.

798 
check_¿nge
:

799 
box_maximum
 = 
tf
.
	`»duû_max
(
boxli¡
.
	$g‘
())

800 
max_as£¹
 = 
tf
.
	`As£¹
Ñf.
	`g»©”_equ®
(1.01, 
box_maximum
),

802 'thª 1.01: ', 
box_maximum
])

803 
w™h
 
tf
.
	$cÚŒŞ_d•’d’c›s
([
max_as£¹
]):

804 
width
 = 
tf
.
	$id’t™y
(
width
)

806  
	$sÿË
(
boxli¡
, 
height
, 
width
)

809 
def
 
	$»fše_boxes_muÉi_şass
(
poŞ_boxes
,

810 
num_şas£s
,

811 
nms_iou_th»sh
,

812 
nms_max_d‘eùiÚs
,

813 
vÙšg_iou_th»sh
=0.5):

816 
Box
 
»fšem’t
 
is
 
dÚe
 
šd•’d’y
 
—ch
 
şass
.

818 
Args
:

819 
poŞ_boxes
: (
BoxLi¡
è
A
 
cŞËùiÚ
 
of
 
boxes
 
to
 
be
 
»fšed
.…oŞ_boxe 
mu¡


820 
have
 
a
 
¿nk
 1 'scÜes' 
f›ld
 
ªd
‡„ank 1 'classes' field.

821 
num_şas£s
: (
sÿÏr
è
Numb”
 
of
 
şas£s
.

822 
nms_iou_th»sh
: (
sÿÏr
è
iou
 
th»shŞd
 
nÚ
 
max
 
	`suµ»ssiÚ
 (
NMS
).

823 
nms_max_d‘eùiÚs
: (
sÿÏr
è
maximum
 
ouut
 
size
 
NMS
.

824 
vÙšg_iou_th»sh
: (
sÿÏr
è
iou
 
th»shŞd
 
box
 
vÙšg
.

826 
R‘uºs
:

827 
BoxLi¡
 
of
 
»fšed
 
boxes
.

829 
Rai£s
:

830 
V®ueE¼Ü
: 

831 
a
è
nms_iou_th»sh
 
Ü
 
vÙšg_iou_th»sh
 
is
 
nÙ
 
š
 [0, 1].

832 
b
è
poŞ_boxes
 
is
 
nÙ
 
a
 
BoxLi¡
.

833 
c
è
poŞ_boxes
 
dÛs
 
nÙ
 
have
 
a
 
scÜes
 
ªd
 
şas£s
 
f›ld
.

835 
nÙ
 0.0 <ğ
nms_iou_th»sh
 <= 1.0:

836 
¿i£
 
	`V®ueE¼Ü
('nms_iou_thresh must be between 0‡nd 1')

837 
nÙ
 0.0 <ğ
vÙšg_iou_th»sh
 <= 1.0:

838 
¿i£
 
	`V®ueE¼Ü
('voting_iou_thresh must be between 0‡nd 1')

839 
nÙ
 
	$isš¡ªû
(
poŞ_boxes
, 
box_li¡
.
BoxLi¡
):

840 
¿i£
 
	`V®ueE¼Ü
('pool_boxes must be‡ BoxList')

841 
nÙ
 
poŞ_boxes
.
	`has_f›ld
('scores'):

842 
¿i£
 
	`V®ueE¼Ü
('pool_boxes must have‡ \'scores\' field')

843 
nÙ
 
poŞ_boxes
.
	`has_f›ld
('classes'):

844 
¿i£
 
	`V®ueE¼Ü
('pool_boxes must have‡ \'classes\' field')

846 
»fšed_boxes
 = []

847 
i
 
š
 
	$¿nge
(
num_şas£s
):

848 
boxes_şass
 = 
	`f‹r_f›ld_v®ue_equ®s
(
poŞ_boxes
, 'şas£s', 
i
)

849 
»fšed_boxes_şass
 = 
	$»fše_boxes
(
boxes_şass
, 
nms_iou_th»sh
,

850 
nms_max_d‘eùiÚs
, 
vÙšg_iou_th»sh
)

851 
»fšed_boxes
.
	$­³nd
(
»fšed_boxes_şass
)

852  
	`sÜt_by_f›ld
(
	`cÚÿ‹Ç‹
(
»fšed_boxes
), 'scores')

855 
def
 
	$»fše_boxes
(
poŞ_boxes
,

856 
nms_iou_th»sh
,

857 
nms_max_d‘eùiÚs
,

858 
vÙšg_iou_th»sh
=0.5):

861 
Args
:

862 
poŞ_boxes
: (
BoxLi¡
è
A
 
cŞËùiÚ
 
of
 
boxes
 
to
 
be
 
»fšed
.…oŞ_boxe 
mu¡


863 
have
 
a
 
¿nk
 1 'scÜes' 
f›ld
.

864 
nms_iou_th»sh
: (
sÿÏr
è
iou
 
th»shŞd
 
nÚ
 
max
 
	`suµ»ssiÚ
 (
NMS
).

865 
nms_max_d‘eùiÚs
: (
sÿÏr
è
maximum
 
ouut
 
size
 
NMS
.

866 
vÙšg_iou_th»sh
: (
sÿÏr
è
iou
 
th»shŞd
 
box
 
vÙšg
.

868 
R‘uºs
:

869 
BoxLi¡
 
of
 
»fšed
 
boxes
.

871 
Rai£s
:

872 
V®ueE¼Ü
: 

873 
a
è
nms_iou_th»sh
 
Ü
 
vÙšg_iou_th»sh
 
is
 
nÙ
 
š
 [0, 1].

874 
b
è
poŞ_boxes
 
is
 
nÙ
 
a
 
BoxLi¡
.

875 
c
è
poŞ_boxes
 
dÛs
 
nÙ
 
have
 
a
 
scÜes
 
f›ld
.

877 
nÙ
 0.0 <ğ
nms_iou_th»sh
 <= 1.0:

878 
¿i£
 
	`V®ueE¼Ü
('nms_iou_thresh must be between 0‡nd 1')

879 
nÙ
 0.0 <ğ
vÙšg_iou_th»sh
 <= 1.0:

880 
¿i£
 
	`V®ueE¼Ü
('voting_iou_thresh must be between 0‡nd 1')

881 
nÙ
 
	$isš¡ªû
(
poŞ_boxes
, 
box_li¡
.
BoxLi¡
):

882 
¿i£
 
	`V®ueE¼Ü
('pool_boxes must be‡ BoxList')

883 
nÙ
 
poŞ_boxes
.
	`has_f›ld
('scores'):

884 
¿i£
 
	`V®ueE¼Ü
('pool_boxes must have‡ \'scores\' field')

886 
nms_boxes
 = 
	$nÚ_max_suµ»ssiÚ
(

887 
poŞ_boxes
, 
nms_iou_th»sh
, 
nms_max_d‘eùiÚs
)

888  
	$box_vÙšg
(
nms_boxes
, 
poŞ_boxes
, 
vÙšg_iou_th»sh
)

891 
def
 
	$box_vÙšg
(
£Ëùed_boxes
, 
poŞ_boxes
, 
iou_th»sh
=0.5):

894 
P”fÜms
 
box
 
vÙšg
 
as
 
desüibed
 
š
 'Object detection via‡ multi-region &

895 
£mªtic
 
£gm’tiÚ
-
aw¬e
 
CNN
 
mod–
', Gidaris‡nd Komodakis, ICCV 2015. For

896 
—ch
 
box
 'B' 
š
 
£Ëùed_boxes
, 
we
 
fšd
 
the
 
£t
 'S' 
of
 
boxes
 iÀ
poŞ_boxes


897 
w™h
 
iou
 
ov”Ïp
 >ğ
iou_th»sh
. 
The
 
loÿtiÚ
 
of
 
B
 
is
 
£t
 
to
 
the
 
weigh‹d


898 
av”age
 
loÿtiÚ
 
of
 
boxes
 
š
 
	`S
 (
scÜes
 
¬e
 
u£d
 
weightšg
). 
And
 
the
 
scÜe


899 
of
 
B
 
is
 
£t
 
to
 
the
 
av”age
 
scÜe
 oà
boxes
 
š
 
S
.

901 
Args
:

902 
£Ëùed_boxes
: 
BoxLi¡
 
cÚššg
 
a
 
sub£t
 
of
 
boxes
 
š
 
poŞ_boxes
. 
The£


903 
boxes
 
¬e
 
usu®ly
 
£Ëùed
 
äom
 
poŞ_boxes
 
usšg
 
nÚ
 
max
 
suµ»ssiÚ
.

904 
poŞ_boxes
: 
BoxLi¡
 
cÚššg
 
a
 
£t
 
	$of
 (
possibly
 
»dundªt
è
boxes
.

905 
iou_th»sh
: (
sÿÏr
è
iou
 
th»shŞd
 
m©chšg
 
boxes
 
š


906 
£Ëùed_boxes
 
ªd
 
poŞ_boxes
.

908 
R‘uºs
:

909 
BoxLi¡
 
cÚššg
 
av”aged
 
loÿtiÚs
 
ªd
 
scÜes
 
—ch
 
box
 
š


910 
£Ëùed_boxes
.

912 
Rai£s
:

913 
V®ueE¼Ü
: 

914 
a
è
£Ëùed_boxes
 
Ü
 
poŞ_boxes
 
is
 
nÙ
‡ 
BoxLi¡
.

915 
b
è
iou_th»sh
 
is
 
nÙ
 
š
 [0, 1].

916 
c
è
poŞ_boxes
 
dÛs
 
nÙ
 
have
 
a
 
scÜes
 
f›ld
.

918 
nÙ
 0.0 <ğ
iou_th»sh
 <= 1.0:

919 
¿i£
 
	`V®ueE¼Ü
('iou_thresh must be between 0‡nd 1')

920 
nÙ
 
	$isš¡ªû
(
£Ëùed_boxes
, 
box_li¡
.
BoxLi¡
):

921 
¿i£
 
	`V®ueE¼Ü
('selected_boxes must be‡ BoxList')

922 
nÙ
 
	$isš¡ªû
(
poŞ_boxes
, 
box_li¡
.
BoxLi¡
):

923 
¿i£
 
	`V®ueE¼Ü
('pool_boxes must be‡ BoxList')

924 
nÙ
 
poŞ_boxes
.
	`has_f›ld
('scores'):

925 
¿i£
 
	`V®ueE¼Ü
('pool_boxes must have‡ \'scores\' field')

927 
iou_
 = 
	$iou
(
£Ëùed_boxes
, 
poŞ_boxes
)

928 
m©ch_šdiÿtÜ
 = 
tf
.
	`to_æßt
Ñf.
	$g»©”
(
iou_
, 
iou_th»sh
))

929 
num_m©ches
 = 
tf
.
	$»duû_sum
(
m©ch_šdiÿtÜ
, 1)

930 #TODO: 
HªdË
 
the
 
wh”e
 
some
 
boxes
 
š
 
£Ëùed_boxes
 dØ
nÙ
 
m©ch
 
to
 
ªy


931 #boxe 
š
 
poŞ_boxes
. 
FÜ
 
such
 
boxes
 
w™hout
 
ªy
 
m©ches
, 
we
 
should
 

932 #th
Üigš®
 
boxes
 
w™hout
 
vÙšg
.

933 
m©ch_as£¹
 = 
tf
.
	`As£¹
(

934 
tf
.
	`»duû_®l
Ñf.
	`g»©”
(
num_m©ches
, 0)),

938 
scÜes
 = 
tf
.
	`ex·nd_dims
(
poŞ_boxes
.
	`g‘_f›ld
('scores'), 1)

939 
scÜes_as£¹
 = 
tf
.
	`As£¹
(

940 
tf
.
	`»duû_®l
Ñf.
	`g»©”_equ®
(
scÜes
, 0)),

943 
w™h
 
tf
.
	$cÚŒŞ_d•’d’c›s
([
scÜes_as£¹
, 
m©ch_as£¹
]):

944 
sum_scÜes
 = 
tf
.
	$m©mul
(
m©ch_šdiÿtÜ
, 
scÜes
)

945 
av”aged_scÜes
 = 
tf
.
	`»sh­e
(
sum_scÜes
, [-1]è/ 
num_m©ches


947 
box_loÿtiÚs
 = 
tf
.
	`m©mul
(
m©ch_šdiÿtÜ
,

948 
poŞ_boxes
.
	`g‘
(è* 
scÜes
è/ 
sum_scÜes


949 
av”aged_boxes
 = 
box_li¡
.
	$BoxLi¡
(
box_loÿtiÚs
)

950 
	$_cİy_exŒa_f›lds
(
av”aged_boxes
, 
£Ëùed_boxes
)

951 
av”aged_boxes
.
	`add_f›ld
('scÜes', 
av”aged_scÜes
)

952  
av”aged_boxes


955 
def
 
	$·d_Ü_ş_box_li¡
(
boxli¡
, 
num_boxes
, 
scİe
=
NÚe
):

958 
Args
:

959 
boxli¡
: 
A
 
BoxLi¡
 
w™h
 
¬b™¿ry
 
of
 
numb”
 oà
boxes
.

960 
num_boxes
: 
Fœ¡
‚um_boxe 
š
 
boxli¡
 
¬e
 
k•t
.

961 
The
 
f›lds
 
¬e
 
z”o
-
·dded
 
num_boxes
 
is
 
bigg”
 
thª
 
the


962 
aùu®
 
numb”
 
of
 
boxes
.

963 
scİe
: 
Çme
 scope.

965 
R‘uºs
:

966 
BoxLi¡
 
w™h
 
®l
 
f›lds
 
·dded
 
Ü
 
ş³d
.

968 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'PadOrClipBoxList'):

969 
subboxli¡
 = 
box_li¡
.
	`BoxLi¡
(
sh­e_uts
.
	`·d_Ü_ş_‹nsÜ
(

970 
boxli¡
.
	`g‘
(), 
num_boxes
))

971 
f›ld
 
š
 
boxli¡
.
	$g‘_exŒa_f›lds
():

972 
subf›ld
 = 
sh­e_uts
.
	`·d_Ü_ş_‹nsÜ
(

973 
boxli¡
.
	`g‘_f›ld
(
f›ld
), 
num_boxes
)

974 
subboxli¡
.
	$add_f›ld
(
f›ld
, 
subf›ld
)

975  
subboxli¡


	@core/box_list_ops_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
numpy
 
as
 
Å


18 
impÜt
 
‹nsÜæow
 
as
 
tf


19 
äom
 
	g‹nsÜæow
.
	gpythÚ
.
äamewÜk
 
impÜt
 
”rÜs


21 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


22 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡_İs


25 
şass
 
	$BoxLi¡OpsTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

28 
def
 
	$‹¡_¬—
(
£lf
):

29 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([[0.0, 0.0, 10.0, 20.0], [1.0, 2.0, 3.0, 4.0]])

30 
exp_ouut
 = [200.0, 4.0]

31 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

32 
¬—s
 = 
box_li¡_İs
.
	$¬—
(
boxes
)

33 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

34 
¬—s_ouut
 = 
£ss
.
	$run
(
¬—s
)

35 
£lf
.
	$as£¹AÎClo£
(
¬—s_ouut
, 
exp_ouut
)

37 
def
 
	$‹¡_height_width
(
£lf
):

38 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([[0.0, 0.0, 10.0, 20.0], [1.0, 2.0, 3.0, 4.0]])

39 
exp_ouut_heights
 = [10., 2.]

40 
exp_ouut_widths
 = [20., 2.]

41 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

42 
heights
, 
widths
 = 
box_li¡_İs
.
	$height_width
(
boxes
)

43 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

44 
ouut_heights
, 
ouut_widths
 = 
£ss
.
	$run
([
heights
, 
widths
])

45 
£lf
.
	$as£¹AÎClo£
(
ouut_heights
, 
exp_ouut_heights
)

46 
£lf
.
	$as£¹AÎClo£
(
ouut_widths
, 
exp_ouut_widths
)

48 
def
 
	$‹¡_sÿË
(
£lf
):

49 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 100, 200], [50, 120, 100, 140]],

50 
dty³
=
tf
.
æßt32
)

51 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

52 
boxes
.
	`add_f›ld
('exŒa_d©a', 
tf
.
	$cÚ¡ªt
([[1], [2]]))

54 
y_sÿË
 = 
tf
.
	`cÚ¡ªt
(1.0/100)

55 
x_sÿË
 = 
tf
.
	`cÚ¡ªt
(1.0/200)

56 
sÿËd_boxes
 = 
box_li¡_İs
.
	$sÿË
(
boxes
, 
y_sÿË
, 
x_sÿË
)

57 
exp_ouut
 = [[0, 0, 1, 1], [0.5, 0.6, 1.0, 0.7]]

58 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

59 
sÿËd_cÜÃrs_out
 = 
£ss
.
	`run
(
sÿËd_boxes
.
	$g‘
())

60 
£lf
.
	$as£¹AÎClo£
(
sÿËd_cÜÃrs_out
, 
exp_ouut
)

61 
exŒa_d©a_out
 = 
£ss
.
	`run
(
sÿËd_boxes
.
	`g‘_f›ld
('extra_data'))

62 
£lf
.
	$as£¹AÎEqu®
(
exŒa_d©a_out
, [[1], [2]])

64 
def
 
	$‹¡_ş_to_wšdow_f‹r_boxes_which_çÎ_outside_the_wšdow
(

65 
£lf
):

66 
wšdow
 = 
tf
.
	$cÚ¡ªt
([0, 0, 9, 14], 
tf
.
æßt32
)

67 
cÜÃrs
 = 
tf
.
	`cÚ¡ªt
([[5.0, 5.0, 6.0, 6.0],

73 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

74 
boxes
.
	`add_f›ld
('exŒa_d©a', 
tf
.
	$cÚ¡ªt
([[1], [2], [3], [4], [5], [6]]))

75 
exp_ouut
 = [[5.0, 5.0, 6.0, 6.0], [0.0, 0.0, 4.0, 5.0],

78 
´uÃd
 = 
box_li¡_İs
.
	$ş_to_wšdow
(

79 
boxes
, 
wšdow
, 
f‹r_nÚov”Ïµšg
=
True
)

80 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

81 
´uÃd_ouut
 = 
£ss
.
	`run
(
´uÃd
.
	$g‘
())

82 
£lf
.
	$as£¹AÎClo£
(
´uÃd_ouut
, 
exp_ouut
)

83 
exŒa_d©a_out
 = 
£ss
.
	`run
(
´uÃd
.
	`g‘_f›ld
('extra_data'))

84 
£lf
.
	$as£¹AÎEqu®
(
exŒa_d©a_out
, [[1], [2], [3], [4], [5]])

86 
def
 
	$‹¡_ş_to_wšdow_w™hout_f‹ršg_boxes_which_çÎ_outside_the_wšdow
(

87 
£lf
):

88 
wšdow
 = 
tf
.
	$cÚ¡ªt
([0, 0, 9, 14], 
tf
.
æßt32
)

89 
cÜÃrs
 = 
tf
.
	`cÚ¡ªt
([[5.0, 5.0, 6.0, 6.0],

95 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

96 
boxes
.
	`add_f›ld
('exŒa_d©a', 
tf
.
	$cÚ¡ªt
([[1], [2], [3], [4], [5], [6]]))

97 
exp_ouut
 = [[5.0, 5.0, 6.0, 6.0], [0.0, 0.0, 4.0, 5.0],

100 
´uÃd
 = 
box_li¡_İs
.
	$ş_to_wšdow
(

101 
boxes
, 
wšdow
, 
f‹r_nÚov”Ïµšg
=
F®£
)

102 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

103 
´uÃd_ouut
 = 
£ss
.
	`run
(
´uÃd
.
	$g‘
())

104 
£lf
.
	$as£¹AÎClo£
(
´uÃd_ouut
, 
exp_ouut
)

105 
exŒa_d©a_out
 = 
£ss
.
	`run
(
´uÃd
.
	`g‘_f›ld
('extra_data'))

106 
£lf
.
	$as£¹AÎEqu®
(
exŒa_d©a_out
, [[1], [2], [3], [4], [5], [6]])

108 
def
 
	$‹¡_´uÃ_outside_wšdow_f‹rs_boxes_which_çÎ_outside_the_wšdow
(

109 
£lf
):

110 
wšdow
 = 
tf
.
	$cÚ¡ªt
([0, 0, 9, 14], 
tf
.
æßt32
)

111 
cÜÃrs
 = 
tf
.
	`cÚ¡ªt
([[5.0, 5.0, 6.0, 6.0],

117 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

118 
boxes
.
	`add_f›ld
('exŒa_d©a', 
tf
.
	$cÚ¡ªt
([[1], [2], [3], [4], [5], [6]]))

119 
exp_ouut
 = [[5.0, 5.0, 6.0, 6.0],

122 
´uÃd
, 
k“p_šdiûs
 = 
box_li¡_İs
.
	$´uÃ_outside_wšdow
(
boxes
, 
wšdow
)

123 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

124 
´uÃd_ouut
 = 
£ss
.
	`run
(
´uÃd
.
	$g‘
())

125 
£lf
.
	$as£¹AÎClo£
(
´uÃd_ouut
, 
exp_ouut
)

126 
k“p_šdiûs_out
 = 
£ss
.
	$run
(
k“p_šdiûs
)

127 
£lf
.
	$as£¹AÎEqu®
(
k“p_šdiûs_out
, [0, 2, 3])

128 
exŒa_d©a_out
 = 
£ss
.
	`run
(
´uÃd
.
	`g‘_f›ld
('extra_data'))

129 
£lf
.
	$as£¹AÎEqu®
(
exŒa_d©a_out
, [[1], [3], [4]])

131 
def
 
	$‹¡_´uÃ_com¶‘–y_outside_wšdow
(
£lf
):

132 
wšdow
 = 
tf
.
	$cÚ¡ªt
([0, 0, 9, 14], 
tf
.
æßt32
)

133 
cÜÃrs
 = 
tf
.
	`cÚ¡ªt
([[5.0, 5.0, 6.0, 6.0],

139 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

140 
boxes
.
	`add_f›ld
('exŒa_d©a', 
tf
.
	$cÚ¡ªt
([[1], [2], [3], [4], [5], [6]]))

141 
exp_ouut
 = [[5.0, 5.0, 6.0, 6.0],

146 
´uÃd
, 
k“p_šdiûs
 = 
box_li¡_İs
.
	$´uÃ_com¶‘–y_outside_wšdow
(
boxes
,

147 
wšdow
)

148 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

149 
´uÃd_ouut
 = 
£ss
.
	`run
(
´uÃd
.
	$g‘
())

150 
£lf
.
	$as£¹AÎClo£
(
´uÃd_ouut
, 
exp_ouut
)

151 
k“p_šdiûs_out
 = 
£ss
.
	$run
(
k“p_šdiûs
)

152 
£lf
.
	$as£¹AÎEqu®
(
k“p_šdiûs_out
, [0, 1, 2, 3, 5])

153 
exŒa_d©a_out
 = 
£ss
.
	`run
(
´uÃd
.
	`g‘_f›ld
('extra_data'))

154 
£lf
.
	$as£¹AÎEqu®
(
exŒa_d©a_out
, [[1], [2], [3], [4], [6]])

156 
def
 
	$‹¡_š‹r£ùiÚ
(
£lf
):

157 
cÜÃrs1
 = 
tf
.
	$cÚ¡ªt
([[4.0, 3.0, 7.0, 5.0], [5.0, 6.0, 10.0, 7.0]])

158 
cÜÃrs2
 = 
tf
.
	$cÚ¡ªt
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0],

160 
exp_ouut
 = [[2.0, 0.0, 6.0], [1.0, 0.0, 5.0]]

161 
boxes1
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs1
)

162 
boxes2
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs2
)

163 
š‹r£ù
 = 
box_li¡_İs
.
	$š‹r£ùiÚ
(
boxes1
, 
boxes2
)

164 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

165 
š‹r£ù_ouut
 = 
£ss
.
	$run
(
š‹r£ù
)

166 
£lf
.
	$as£¹AÎClo£
(
š‹r£ù_ouut
, 
exp_ouut
)

168 
def
 
	$‹¡_m©ched_š‹r£ùiÚ
(
£lf
):

169 
cÜÃrs1
 = 
tf
.
	$cÚ¡ªt
([[4.0, 3.0, 7.0, 5.0], [5.0, 6.0, 10.0, 7.0]])

170 
cÜÃrs2
 = 
tf
.
	$cÚ¡ªt
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0]])

171 
exp_ouut
 = [2.0, 0.0]

172 
boxes1
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs1
)

173 
boxes2
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs2
)

174 
š‹r£ù
 = 
box_li¡_İs
.
	$m©ched_š‹r£ùiÚ
(
boxes1
, 
boxes2
)

175 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

176 
š‹r£ù_ouut
 = 
£ss
.
	$run
(
š‹r£ù
)

177 
£lf
.
	$as£¹AÎClo£
(
š‹r£ù_ouut
, 
exp_ouut
)

179 
def
 
	$‹¡_iou
(
£lf
):

180 
cÜÃrs1
 = 
tf
.
	$cÚ¡ªt
([[4.0, 3.0, 7.0, 5.0], [5.0, 6.0, 10.0, 7.0]])

181 
cÜÃrs2
 = 
tf
.
	$cÚ¡ªt
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0],

183 
exp_ouut
 = [[2.0 / 16.0, 0, 6.0 / 400.0], [1.0 / 16.0, 0.0, 5.0 / 400.0]]

184 
boxes1
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs1
)

185 
boxes2
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs2
)

186 
iou
 = 
box_li¡_İs
.
	$iou
(
boxes1
, 
boxes2
)

187 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

188 
iou_ouut
 = 
£ss
.
	$run
(
iou
)

189 
£lf
.
	$as£¹AÎClo£
(
iou_ouut
, 
exp_ouut
)

191 
def
 
	$‹¡_m©ched_iou
(
£lf
):

192 
cÜÃrs1
 = 
tf
.
	$cÚ¡ªt
([[4.0, 3.0, 7.0, 5.0], [5.0, 6.0, 10.0, 7.0]])

193 
cÜÃrs2
 = 
tf
.
	$cÚ¡ªt
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0]])

194 
exp_ouut
 = [2.0 / 16.0, 0]

195 
boxes1
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs1
)

196 
boxes2
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs2
)

197 
iou
 = 
box_li¡_İs
.
	$m©ched_iou
(
boxes1
, 
boxes2
)

198 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

199 
iou_ouut
 = 
£ss
.
	$run
(
iou
)

200 
£lf
.
	$as£¹AÎClo£
(
iou_ouut
, 
exp_ouut
)

202 
def
 
	$‹¡_iouwÜks_Ú_em±y_šputs
(
£lf
):

203 
cÜÃrs1
 = 
tf
.
	$cÚ¡ªt
([[4.0, 3.0, 7.0, 5.0], [5.0, 6.0, 10.0, 7.0]])

204 
cÜÃrs2
 = 
tf
.
	$cÚ¡ªt
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0],

206 
boxes1
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs1
)

207 
boxes2
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs2
)

208 
boxes_em±y
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	`z”os
((0, 4)))

209 
iou_em±y_1
 = 
box_li¡_İs
.
	$iou
(
boxes1
, 
boxes_em±y
)

210 
iou_em±y_2
 = 
box_li¡_İs
.
	$iou
(
boxes_em±y
, 
boxes2
)

211 
iou_em±y_3
 = 
box_li¡_İs
.
	$iou
(
boxes_em±y
, boxes_empty)

212 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

213 
iou_ouut_1
, 
iou_ouut_2
, 
iou_ouut_3
 = 
£ss
.
	$run
(

214 [
iou_em±y_1
, 
iou_em±y_2
, 
iou_em±y_3
])

215 
£lf
.
	`as£¹AÎEqu®
(
iou_ouut_1
.
sh­e
, (2, 0))

216 
£lf
.
	`as£¹AÎEqu®
(
iou_ouut_2
.
sh­e
, (0, 3))

217 
£lf
.
	`as£¹AÎEqu®
(
iou_ouut_3
.
sh­e
, (0, 0))

219 
def
 
	$‹¡_iß
(
£lf
):

220 
cÜÃrs1
 = 
tf
.
	$cÚ¡ªt
([[4.0, 3.0, 7.0, 5.0], [5.0, 6.0, 10.0, 7.0]])

221 
cÜÃrs2
 = 
tf
.
	$cÚ¡ªt
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0],

223 
exp_ouut_1
 = [[2.0 / 12.0, 0, 6.0 / 400.0],

225 
exp_ouut_2
 = [[2.0 / 6.0, 1.0 / 5.0],

228 
boxes1
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs1
)

229 
boxes2
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs2
)

230 
iß_1
 = 
box_li¡_İs
.
	$iß
(
boxes1
, 
boxes2
)

231 
iß_2
 = 
box_li¡_İs
.
	$iß
(
boxes2
, 
boxes1
)

232 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

233 
iß_ouut_1
, 
iß_ouut_2
 = 
£ss
.
	$run
([
iß_1
, 
iß_2
])

234 
£lf
.
	$as£¹AÎClo£
(
iß_ouut_1
, 
exp_ouut_1
)

235 
£lf
.
	$as£¹AÎClo£
(
iß_ouut_2
, 
exp_ouut_2
)

237 
def
 
	$‹¡_´uÃ_nÚ_ov”Ïµšg_boxes
(
£lf
):

238 
cÜÃrs1
 = 
tf
.
	$cÚ¡ªt
([[4.0, 3.0, 7.0, 5.0], [5.0, 6.0, 10.0, 7.0]])

239 
cÜÃrs2
 = 
tf
.
	$cÚ¡ªt
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0],

241 
boxes1
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs1
)

242 
boxes2
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs2
)

243 
mšov”Ïp
 = 0.5

245 
exp_ouut_1
 = 
boxes1


246 
exp_ouut_2
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(0.0, 
sh­e
=[0, 4]))

247 
ouut_1
, 
k“p_šdiûs_1
 = 
box_li¡_İs
.
	$´uÃ_nÚ_ov”Ïµšg_boxes
(

248 
boxes1
, 
boxes2
, 
mš_ov”Ïp
=
mšov”Ïp
)

249 
ouut_2
, 
k“p_šdiûs_2
 = 
box_li¡_İs
.
	$´uÃ_nÚ_ov”Ïµšg_boxes
(

250 
boxes2
, 
boxes1
, 
mš_ov”Ïp
=
mšov”Ïp
)

251 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

252 (
ouut_1_
, 
k“p_šdiûs_1_
, 
ouut_2_
, 
k“p_šdiûs_2_
, 
exp_ouut_1_
,

253 
exp_ouut_2_
èğ
£ss
.
	`run
(

254 [
ouut_1
.
	`g‘
(), 
k“p_šdiûs_1
,

255 
ouut_2
.
	`g‘
(), 
k“p_šdiûs_2
,

256 
exp_ouut_1
.
	`g‘
(), 
exp_ouut_2
.get()])

257 
£lf
.
	$as£¹AÎClo£
(
ouut_1_
, 
exp_ouut_1_
)

258 
£lf
.
	$as£¹AÎClo£
(
ouut_2_
, 
exp_ouut_2_
)

259 
£lf
.
	$as£¹AÎEqu®
(
k“p_šdiûs_1_
, [0, 1])

260 
£lf
.
	$as£¹AÎEqu®
(
k“p_šdiûs_2_
, [])

262 
def
 
	$‹¡_´uÃ_sm®l_boxes
(
£lf
):

263 
boxes
 = 
tf
.
	$cÚ¡ªt
([[4.0, 3.0, 7.0, 5.0],

268 
exp_boxes
 = [[3.0, 4.0, 6.0, 8.0],

270 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
boxes
)

271 
´uÃd_boxes
 = 
box_li¡_İs
.
	$´uÃ_sm®l_boxes
(
boxes
, 3)

272 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

273 
´uÃd_boxes
 = 
£ss
.
	`run
ÕruÃd_boxes.
	$g‘
())

274 
£lf
.
	$as£¹AÎEqu®
(
´uÃd_boxes
, 
exp_boxes
)

276 
def
 
	$‹¡_´uÃ_sm®l_boxes_´uÃs_boxes_w™h_Ãg©ive_side
(
£lf
):

277 
boxes
 = 
tf
.
	`cÚ¡ªt
([[4.0, 3.0, 7.0, 5.0],

282 [2.0, 3.0, 1.5, 7.0], #Ãg©iv
height


283 [2.0, 3.0, 5.0, 1.7]]è#Ãg©iv
width


284 
exp_boxes
 = [[3.0, 4.0, 6.0, 8.0],

286 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
boxes
)

287 
´uÃd_boxes
 = 
box_li¡_İs
.
	$´uÃ_sm®l_boxes
(
boxes
, 3)

288 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

289 
´uÃd_boxes
 = 
£ss
.
	`run
ÕruÃd_boxes.
	$g‘
())

290 
£lf
.
	$as£¹AÎEqu®
(
´uÃd_boxes
, 
exp_boxes
)

292 
def
 
	$‹¡_chªge_coÜdš©e_äame
(
£lf
):

293 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([[0.25, 0.5, 0.75, 0.75], [0.5, 0.0, 1.0, 1.0]])

294 
wšdow
 = 
tf
.
	$cÚ¡ªt
([0.25, 0.25, 0.75, 0.75])

295 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

297 
ex³ùed_cÜÃrs
 = 
tf
.
	`cÚ¡ªt
([[0, 0.5, 1.0, 1.0], [0.5, -0.5, 1.5, 1.5]])

298 
ex³ùed_boxes
 = 
box_li¡
.
	$BoxLi¡
(
ex³ùed_cÜÃrs
)

299 
ouut
 = 
box_li¡_İs
.
	$chªge_coÜdš©e_äame
(
boxes
, 
wšdow
)

301 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

302 
ouut_
, 
ex³ùed_boxes_
 = 
£ss
.
	`run
([
ouut
.
	`g‘
(), 
ex³ùed_boxes
.get()])

303 
£lf
.
	$as£¹AÎClo£
(
ouut_
, 
ex³ùed_boxes_
)

305 
def
 
	$‹¡_ißwÜks_Ú_em±y_šputs
(
£lf
):

306 
cÜÃrs1
 = 
tf
.
	$cÚ¡ªt
([[4.0, 3.0, 7.0, 5.0], [5.0, 6.0, 10.0, 7.0]])

307 
cÜÃrs2
 = 
tf
.
	$cÚ¡ªt
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0],

309 
boxes1
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs1
)

310 
boxes2
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs2
)

311 
boxes_em±y
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	`z”os
((0, 4)))

312 
iß_em±y_1
 = 
box_li¡_İs
.
	$iß
(
boxes1
, 
boxes_em±y
)

313 
iß_em±y_2
 = 
box_li¡_İs
.
	$iß
(
boxes_em±y
, 
boxes2
)

314 
iß_em±y_3
 = 
box_li¡_İs
.
	$iß
(
boxes_em±y
, boxes_empty)

315 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

316 
iß_ouut_1
, 
iß_ouut_2
, 
iß_ouut_3
 = 
£ss
.
	$run
(

317 [
iß_em±y_1
, 
iß_em±y_2
, 
iß_em±y_3
])

318 
£lf
.
	`as£¹AÎEqu®
(
iß_ouut_1
.
sh­e
, (2, 0))

319 
£lf
.
	`as£¹AÎEqu®
(
iß_ouut_2
.
sh­e
, (0, 3))

320 
£lf
.
	`as£¹AÎEqu®
(
iß_ouut_3
.
sh­e
, (0, 0))

322 
def
 
	$‹¡_·œwi£_di¡ªûs
(
£lf
):

323 
cÜÃrs1
 = 
tf
.
	$cÚ¡ªt
([[0.0, 0.0, 0.0, 0.0],

325 
cÜÃrs2
 = 
tf
.
	`cÚ¡ªt
([[3.0, 4.0, 1.0, 0.0],

328 
exp_ouut
 = [[26, 25, 0], [18, 27, 6]]

329 
boxes1
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs1
)

330 
boxes2
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs2
)

331 
di¡_m©rix
 = 
box_li¡_İs
.
	$sq_di¡
(
boxes1
, 
boxes2
)

332 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

333 
di¡_ouut
 = 
£ss
.
	$run
(
di¡_m©rix
)

334 
£lf
.
	$as£¹AÎClo£
(
di¡_ouut
, 
exp_ouut
)

336 
def
 
	$‹¡_boŞ—n_mask
(
£lf
):

337 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
(

339 
šdiÿtÜ
 = 
tf
.
	$cÚ¡ªt
([
True
, 
F®£
, True, F®£, True], 
tf
.
boŞ
)

340 
ex³ùed_sub£t
 = [4 * [0.0], 4 * [2.0], 4 * [4.0]]

341 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

342 
sub£t
 = 
box_li¡_İs
.
	$boŞ—n_mask
(
boxes
, 
šdiÿtÜ
)

343 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

344 
sub£t_ouut
 = 
£ss
.
	`run
(
sub£t
.
	$g‘
())

345 
£lf
.
	$as£¹AÎClo£
(
sub£t_ouut
, 
ex³ùed_sub£t
)

347 
def
 
	$‹¡_boŞ—n_mask_w™h_f›ld
(
£lf
):

348 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
(

350 
šdiÿtÜ
 = 
tf
.
	$cÚ¡ªt
([
True
, 
F®£
, True, F®£, True], 
tf
.
boŞ
)

351 
weights
 = 
tf
.
	$cÚ¡ªt
([[.1], [.3], [.5], [.7], [.9]], 
tf
.
æßt32
)

352 
ex³ùed_sub£t
 = [4 * [0.0], 4 * [2.0], 4 * [4.0]]

353 
ex³ùed_weights
 = [[.1], [.5], [.9]]

355 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

356 
boxes
.
	`add_f›ld
('weights', 
weights
)

357 
sub£t
 = 
box_li¡_İs
.
	`boŞ—n_mask
(
boxes
, 
šdiÿtÜ
, ['weights'])

358 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

359 
sub£t_ouut
, 
weights_ouut
 = 
£ss
.
	`run
(

360 [
sub£t
.
	`g‘
(), sub£t.
	`g‘_f›ld
('weights')])

361 
£lf
.
	$as£¹AÎClo£
(
sub£t_ouut
, 
ex³ùed_sub£t
)

362 
£lf
.
	$as£¹AÎClo£
(
weights_ouut
, 
ex³ùed_weights
)

364 
def
 
	$‹¡_g©h”
(
£lf
):

365 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
(

367 
šdiûs
 = 
tf
.
	$cÚ¡ªt
([0, 2, 4], 
tf
.
št32
)

368 
ex³ùed_sub£t
 = [4 * [0.0], 4 * [2.0], 4 * [4.0]]

369 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

370 
sub£t
 = 
box_li¡_İs
.
	$g©h”
(
boxes
, 
šdiûs
)

371 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

372 
sub£t_ouut
 = 
£ss
.
	`run
(
sub£t
.
	$g‘
())

373 
£lf
.
	$as£¹AÎClo£
(
sub£t_ouut
, 
ex³ùed_sub£t
)

375 
def
 
	$‹¡_g©h”_w™h_f›ld
(
£lf
):

376 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([4*[0.0], 4*[1.0], 4*[2.0], 4*[3.0], 4*[4.0]])

377 
šdiûs
 = 
tf
.
	$cÚ¡ªt
([0, 2, 4], 
tf
.
št32
)

378 
weights
 = 
tf
.
	$cÚ¡ªt
([[.1], [.3], [.5], [.7], [.9]], 
tf
.
æßt32
)

379 
ex³ùed_sub£t
 = [4 * [0.0], 4 * [2.0], 4 * [4.0]]

380 
ex³ùed_weights
 = [[.1], [.5], [.9]]

382 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

383 
boxes
.
	`add_f›ld
('weights', 
weights
)

384 
sub£t
 = 
box_li¡_İs
.
	`g©h”
(
boxes
, 
šdiûs
, ['weights'])

385 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

386 
sub£t_ouut
, 
weights_ouut
 = 
£ss
.
	`run
(

387 [
sub£t
.
	`g‘
(), sub£t.
	`g‘_f›ld
('weights')])

388 
£lf
.
	$as£¹AÎClo£
(
sub£t_ouut
, 
ex³ùed_sub£t
)

389 
£lf
.
	$as£¹AÎClo£
(
weights_ouut
, 
ex³ùed_weights
)

391 
def
 
	$‹¡_g©h”_w™h_šv®id_f›ld
(
£lf
):

392 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([4 * [0.0], 4 * [1.0]])

393 
šdiûs
 = 
tf
.
	$cÚ¡ªt
([0, 1], 
tf
.
št32
)

394 
weights
 = 
tf
.
	$cÚ¡ªt
([[.1], [.3]], 
tf
.
æßt32
)

396 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

397 
boxes
.
	`add_f›ld
('weights', 
weights
)

398 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

399 
box_li¡_İs
.
	`g©h”
(
boxes
, 
šdiûs
, ['foo', 'bar'])

401 
def
 
	$‹¡_g©h”_w™h_šv®id_šputs
(
£lf
):

402 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
(

404 
šdiûs_æßt32
 = 
tf
.
	$cÚ¡ªt
([0, 2, 4], 
tf
.
æßt32
)

405 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

406 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

407 
_
 = 
box_li¡_İs
.
	$g©h”
(
boxes
, 
šdiûs_æßt32
)

408 
šdiûs_2d
 = 
tf
.
	$cÚ¡ªt
([[0, 2, 4]], 
tf
.
št32
)

409 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

410 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

411 
_
 = 
box_li¡_İs
.
	$g©h”
(
boxes
, 
šdiûs_2d
)

413 
def
 
	$‹¡_g©h”_w™h_dyÇmic_šdexšg
(
£lf
):

414 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([4 * [0.0], 4 * [1.0], 4 * [2.0], 4 * [3.0], 4 * [4.0]

416 
weights
 = 
tf
.
	$cÚ¡ªt
([.5, .3, .7, .1, .9], 
tf
.
æßt32
)

417 
šdiûs
 = 
tf
.
	`»sh­e
Ñf.
	`wh”e
Ñf.
	`g»©”
(
weights
, 0.4)), [-1])

418 
ex³ùed_sub£t
 = [4 * [0.0], 4 * [2.0], 4 * [4.0]]

419 
ex³ùed_weights
 = [.5, .7, .9]

421 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

422 
boxes
.
	`add_f›ld
('weights', 
weights
)

423 
sub£t
 = 
box_li¡_İs
.
	`g©h”
(
boxes
, 
šdiûs
, ['weights'])

424 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

425 
sub£t_ouut
, 
weights_ouut
 = 
£ss
.
	`run
([
sub£t
.
	`g‘
(), sub£t.
	`g‘_f›ld
(

427 
£lf
.
	$as£¹AÎClo£
(
sub£t_ouut
, 
ex³ùed_sub£t
)

428 
£lf
.
	$as£¹AÎClo£
(
weights_ouut
, 
ex³ùed_weights
)

430 
def
 
	$‹¡_sÜt_by_f›ld_asûndšg_Üd”
(
£lf
):

431 
exp_cÜÃrs
 = [[0, 0, 1, 1], [0, 0.1, 1, 1.1], [0, -0.1, 1, 0.9],

433 
exp_scÜes
 = [.95, .9, .75, .6, .5, .3]

434 
exp_weights
 = [.2, .45, .6, .75, .8, .92]

435 
shufæe
 = [2, 4, 0, 5, 1, 3]

436 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([
exp_cÜÃrs
[
i
] ˜
š
 
shufæe
], 
tf
.
æßt32
)

437 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

438 
boxes
.
	`add_f›ld
('scÜes', 
tf
.
	$cÚ¡ªt
(

439 [
exp_scÜes
[
i
] ˜
š
 
shufæe
], 
tf
.
æßt32
))

440 
boxes
.
	`add_f›ld
('weights', 
tf
.
	$cÚ¡ªt
(

441 [
exp_weights
[
i
] ˜
š
 
shufæe
], 
tf
.
æßt32
))

442 
sÜt_by_weight
 = 
box_li¡_İs
.
	`sÜt_by_f›ld
(

443 
boxes
,

445 
Üd”
=
box_li¡_İs
.
SÜtOrd”
.
asûnd
)

446 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

447 
cÜÃrs_out
, 
scÜes_out
, 
weights_out
 = 
£ss
.
	`run
([

448 
sÜt_by_weight
.
	`g‘
(),

449 
sÜt_by_weight
.
	`g‘_f›ld
('scores'),

450 
sÜt_by_weight
.
	`g‘_f›ld
('weights')])

451 
£lf
.
	$as£¹AÎClo£
(
cÜÃrs_out
, 
exp_cÜÃrs
)

452 
£lf
.
	$as£¹AÎClo£
(
scÜes_out
, 
exp_scÜes
)

453 
£lf
.
	$as£¹AÎClo£
(
weights_out
, 
exp_weights
)

455 
def
 
	$‹¡_sÜt_by_f›ld_desûndšg_Üd”
(
£lf
):

456 
exp_cÜÃrs
 = [[0, 0, 1, 1], [0, 0.1, 1, 1.1], [0, -0.1, 1, 0.9],

458 
exp_scÜes
 = [.95, .9, .75, .6, .5, .3]

459 
exp_weights
 = [.2, .45, .6, .75, .8, .92]

460 
shufæe
 = [2, 4, 0, 5, 1, 3]

462 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([
exp_cÜÃrs
[
i
] ˜
š
 
shufæe
], 
tf
.
æßt32
)

463 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

464 
boxes
.
	`add_f›ld
('scÜes', 
tf
.
	$cÚ¡ªt
(

465 [
exp_scÜes
[
i
] ˜
š
 
shufæe
], 
tf
.
æßt32
))

466 
boxes
.
	`add_f›ld
('weights', 
tf
.
	$cÚ¡ªt
(

467 [
exp_weights
[
i
] ˜
š
 
shufæe
], 
tf
.
æßt32
))

469 
sÜt_by_scÜe
 = 
box_li¡_İs
.
	`sÜt_by_f›ld
(
boxes
, 'scores')

470 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

471 
cÜÃrs_out
, 
scÜes_out
, 
weights_out
 = 
£ss
.
	`run
([
sÜt_by_scÜe
.
	`g‘
(

472 ), 
sÜt_by_scÜe
.
	`g‘_f›ld
('scores'), sort_by_score.get_field('weights')])

473 
£lf
.
	$as£¹AÎClo£
(
cÜÃrs_out
, 
exp_cÜÃrs
)

474 
£lf
.
	$as£¹AÎClo£
(
scÜes_out
, 
exp_scÜes
)

475 
£lf
.
	$as£¹AÎClo£
(
weights_out
, 
exp_weights
)

477 
def
 
	$‹¡_sÜt_by_f›ld_šv®id_šputs
(
£lf
):

478 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([4 * [0.0], 4 * [0.5], 4 * [1.0], 4 * [2.0], 4 *

480 
misc
 = 
tf
.
	$cÚ¡ªt
([[.95, .9], [.5, .3]], 
tf
.
æßt32
)

481 
weights
 = 
tf
.
	$cÚ¡ªt
([.1, .2], 
tf
.
æßt32
)

482 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

483 
boxes
.
	`add_f›ld
('misc', 
misc
)

484 
boxes
.
	`add_f›ld
('weights', 
weights
)

486 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

487 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

488 
box_li¡_İs
.
	`sÜt_by_f›ld
(
boxes
, 'area')

490 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

491 
box_li¡_İs
.
	`sÜt_by_f›ld
(
boxes
, 'misc')

493 
w™h
 
£lf
.
	`as£¹Rai£sW™hP»diÿ‹M©ch
(
”rÜs
.
Inv®idArgum’tE¼Ü
,

495 
£ss
.
	`run
(
box_li¡_İs
.
	`sÜt_by_f›ld
(
boxes
, 'weights').
	$g‘
())

497 
def
 
	$‹¡_visu®ize_boxes_š_image
(
£lf
):

498 
image
 = 
tf
.
	`z”os
((6, 4, 3))

499 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 5, 3],

500 [0, 0, 3, 2]], 
tf
.
æßt32
)

501 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

502 
image_ªd_boxes
 = 
box_li¡_İs
.
	$visu®ize_boxes_š_image
(
image
, 
boxes
)

503 
image_ªd_boxes_bw
 = 
tf
.
	`to_æßt
(

504 
tf
.
	`g»©”
Ñf.
	`»duû_sum
(
image_ªd_boxes
, 2), 0.0))

505 
exp_»suÉ
 = [[1, 1, 1, 0],

511 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

512 
ouut
 = 
£ss
.
	$run
(
image_ªd_boxes_bw
)

513 
£lf
.
	`as£¹AÎEqu®
(
ouut
.
	`a¡y³
(), 
exp_»suÉ
)

515 
def
 
	$‹¡_f‹r_f›ld_v®ue_equ®s
(
£lf
):

516 
cÜÃrs
 = 
tf
.
	`cÚ¡ªt
([[0, 0, 1, 1],

521 [0, 100, 1, 101]], 
tf
.
æßt32
)

522 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

523 
boxes
.
	`add_f›ld
('şas£s', 
tf
.
	$cÚ¡ªt
([1, 2, 1, 2, 2, 1]))

524 
exp_ouut1
 = [[0, 0, 1, 1], [0, -0.1, 1, 0.9], [0, 100, 1, 101]]

525 
exp_ouut2
 = [[0, 0.1, 1, 1.1], [0, 10, 1, 11], [0, 10.1, 1, 11.1]]

527 
f‹»d_boxes1
 = 
box_li¡_İs
.
	`f‹r_f›ld_v®ue_equ®s
(

528 
boxes
, 'classes', 1)

529 
f‹»d_boxes2
 = 
box_li¡_İs
.
	`f‹r_f›ld_v®ue_equ®s
(

530 
boxes
, 'classes', 2)

531 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

532 
f‹»d_ouut1
, 
f‹»d_ouut2
 = 
£ss
.
	`run
([
f‹»d_boxes1
.
	`g‘
(),

533 
f‹»d_boxes2
.
	`g‘
()])

534 
£lf
.
	$as£¹AÎClo£
(
f‹»d_ouut1
, 
exp_ouut1
)

535 
£lf
.
	$as£¹AÎClo£
(
f‹»d_ouut2
, 
exp_ouut2
)

537 
def
 
	$‹¡_f‹r_g»©”_thª
(
£lf
):

538 
cÜÃrs
 = 
tf
.
	`cÚ¡ªt
([[0, 0, 1, 1],

543 [0, 100, 1, 101]], 
tf
.
æßt32
)

544 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

545 
boxes
.
	`add_f›ld
('scÜes', 
tf
.
	$cÚ¡ªt
([.1, .75, .9, .5, .5, .8]))

546 
th»sh
 = .6

547 
exp_ouut
 = [[0, 0.1, 1, 1.1], [0, -0.1, 1, 0.9], [0, 100, 1, 101]]

549 
f‹»d_boxes
 = 
box_li¡_İs
.
	$f‹r_g»©”_thª
(
boxes
, 
th»sh
)

550 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

551 
f‹»d_ouut
 = 
£ss
.
	`run
(
f‹»d_boxes
.
	$g‘
())

552 
£lf
.
	$as£¹AÎClo£
(
f‹»d_ouut
, 
exp_ouut
)

554 
def
 
	$‹¡_ş_box_li¡
(
£lf
):

555 
boxli¡
 = 
box_li¡
.
	`BoxLi¡
(

556 
tf
.
	$cÚ¡ªt
([[0.1, 0.1, 0.4, 0.4], [0.1, 0.1, 0.5, 0.5],

557 [0.6, 0.6, 0.8, 0.8], [0.2, 0.2, 0.3, 0.3]], 
tf
.
æßt32
))

558 
boxli¡
.
	`add_f›ld
('şas£s', 
tf
.
	$cÚ¡ªt
([0, 0, 1, 1]))

559 
boxli¡
.
	`add_f›ld
('scÜes', 
tf
.
	$cÚ¡ªt
([0.75, 0.65, 0.3, 0.2]))

560 
num_boxes
 = 2

561 
ş³d_boxli¡
 = 
box_li¡_İs
.
	$·d_Ü_ş_box_li¡
(
boxli¡
, 
num_boxes
)

563 
ex³ùed_boxes
 = [[0.1, 0.1, 0.4, 0.4], [0.1, 0.1, 0.5, 0.5]]

564 
ex³ùed_şas£s
 = [0, 0]

565 
ex³ùed_scÜes
 = [0.75, 0.65]

566 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

567 
boxes_out
, 
şas£s_out
, 
scÜes_out
 = 
£ss
.
	`run
(

568 [
ş³d_boxli¡
.
	`g‘
(), cl³d_boxli¡.
	`g‘_f›ld
('classes'),

569 
ş³d_boxli¡
.
	`g‘_f›ld
('scores')])

571 
£lf
.
	$as£¹AÎClo£
(
ex³ùed_boxes
, 
boxes_out
)

572 
£lf
.
	$as£¹AÎEqu®
(
ex³ùed_şas£s
, 
şas£s_out
)

573 
£lf
.
	$as£¹AÎClo£
(
ex³ùed_scÜes
, 
scÜes_out
)

575 
def
 
	$‹¡_·d_box_li¡
(
£lf
):

576 
boxli¡
 = 
box_li¡
.
	`BoxLi¡
(

577 
tf
.
	$cÚ¡ªt
([[0.1, 0.1, 0.4, 0.4], [0.1, 0.1, 0.5, 0.5]], 
tf
.
æßt32
))

578 
boxli¡
.
	`add_f›ld
('şas£s', 
tf
.
	$cÚ¡ªt
([0, 1]))

579 
boxli¡
.
	`add_f›ld
('scÜes', 
tf
.
	$cÚ¡ªt
([0.75, 0.2]))

580 
num_boxes
 = 4

581 
·dded_boxli¡
 = 
box_li¡_İs
.
	$·d_Ü_ş_box_li¡
(
boxli¡
, 
num_boxes
)

583 
ex³ùed_boxes
 = [[0.1, 0.1, 0.4, 0.4], [0.1, 0.1, 0.5, 0.5],

585 
ex³ùed_şas£s
 = [0, 1, 0, 0]

586 
ex³ùed_scÜes
 = [0.75, 0.2, 0, 0]

587 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

588 
boxes_out
, 
şas£s_out
, 
scÜes_out
 = 
£ss
.
	`run
(

589 [
·dded_boxli¡
.
	`g‘
(),…added_boxli¡.
	`g‘_f›ld
('classes'),

590 
·dded_boxli¡
.
	`g‘_f›ld
('scores')])

592 
£lf
.
	$as£¹AÎClo£
(
ex³ùed_boxes
, 
boxes_out
)

593 
£lf
.
	$as£¹AÎEqu®
(
ex³ùed_şas£s
, 
şas£s_out
)

594 
£lf
.
	$as£¹AÎClo£
(
ex³ùed_scÜes
, 
scÜes_out
)

597 
şass
 
	$CÚÿ‹Ç‹Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

599 
def
 
	$‹¡_šv®id_šput_box_li¡_li¡
(
£lf
):

600 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

601 
box_li¡_İs
.
	$cÚÿ‹Ç‹
(
NÚe
)

602 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

603 
box_li¡_İs
.
	$cÚÿ‹Ç‹
([])

604 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

605 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 0, 0]], 
tf
.
æßt32
)

606 
boxli¡
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

607 
box_li¡_İs
.
	$cÚÿ‹Ç‹
([
boxli¡
, 2])

609 
def
 
	$‹¡_cÚÿ‹Ç‹_w™h_missšg_f›lds
(
£lf
):

610 
cÜÃrs1
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 0, 0], [1, 2, 3, 4]], 
tf
.
æßt32
)

611 
scÜes1
 = 
tf
.
	$cÚ¡ªt
([1.0, 2.1])

612 
cÜÃrs2
 = 
tf
.
	$cÚ¡ªt
([[0, 3, 1, 6], [2, 4, 3, 8]], 
tf
.
æßt32
)

613 
boxli¡1
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs1
)

614 
boxli¡1
.
	`add_f›ld
('scÜes', 
scÜes1
)

615 
boxli¡2
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs2
)

616 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

617 
box_li¡_İs
.
	$cÚÿ‹Ç‹
([
boxli¡1
, 
boxli¡2
])

619 
def
 
	$‹¡_cÚÿ‹Ç‹_w™h_šcom·tibË_f›ld_sh­es
(
£lf
):

620 
cÜÃrs1
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 0, 0], [1, 2, 3, 4]], 
tf
.
æßt32
)

621 
scÜes1
 = 
tf
.
	$cÚ¡ªt
([1.0, 2.1])

622 
cÜÃrs2
 = 
tf
.
	$cÚ¡ªt
([[0, 3, 1, 6], [2, 4, 3, 8]], 
tf
.
æßt32
)

623 
scÜes2
 = 
tf
.
	$cÚ¡ªt
([[1.0, 1.0], [2.1, 3.2]])

624 
boxli¡1
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs1
)

625 
boxli¡1
.
	`add_f›ld
('scÜes', 
scÜes1
)

626 
boxli¡2
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs2
)

627 
boxli¡2
.
	`add_f›ld
('scÜes', 
scÜes2
)

628 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

629 
box_li¡_İs
.
	$cÚÿ‹Ç‹
([
boxli¡1
, 
boxli¡2
])

631 
def
 
	$‹¡_cÚÿ‹Ç‹_is_cÜ»ù
(
£lf
):

632 
cÜÃrs1
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 0, 0], [1, 2, 3, 4]], 
tf
.
æßt32
)

633 
scÜes1
 = 
tf
.
	$cÚ¡ªt
([1.0, 2.1])

634 
cÜÃrs2
 = 
tf
.
	$cÚ¡ªt
([[0, 3, 1, 6], [2, 4, 3, 8], [1, 0, 5, 10]],

635 
tf
.
æßt32
)

636 
scÜes2
 = 
tf
.
	$cÚ¡ªt
([1.0, 2.1, 5.6])

638 
exp_cÜÃrs
 = [[0, 0, 0, 0],

643 
exp_scÜes
 = [1.0, 2.1, 1.0, 2.1, 5.6]

645 
boxli¡1
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs1
)

646 
boxli¡1
.
	`add_f›ld
('scÜes', 
scÜes1
)

647 
boxli¡2
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs2
)

648 
boxli¡2
.
	`add_f›ld
('scÜes', 
scÜes2
)

649 
»suÉ
 = 
box_li¡_İs
.
	$cÚÿ‹Ç‹
([
boxli¡1
, 
boxli¡2
])

650 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

651 
cÜÃrs_ouut
, 
scÜes_ouut
 = 
£ss
.
	`run
(

652 [
»suÉ
.
	`g‘
(),„esuÉ.
	`g‘_f›ld
('scores')])

653 
£lf
.
	$as£¹AÎClo£
(
cÜÃrs_ouut
, 
exp_cÜÃrs
)

654 
£lf
.
	$as£¹AÎClo£
(
scÜes_ouut
, 
exp_scÜes
)

657 
şass
 
	$NÚMaxSuµ»ssiÚTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

659 
def
 
	$‹¡_w™h_šv®id_scÜes_f›ld
(
£lf
):

660 
cÜÃrs
 = 
tf
.
	`cÚ¡ªt
([[0, 0, 1, 1],

665 [0, 100, 1, 101]], 
tf
.
æßt32
)

666 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

667 
boxes
.
	`add_f›ld
('scÜes', 
tf
.
	$cÚ¡ªt
([.9, .75, .6, .95, .5]))

668 
iou_th»sh
 = .5

669 
max_ouut_size
 = 3

670 
nms
 = 
box_li¡_İs
.
	$nÚ_max_suµ»ssiÚ
(

671 
boxes
, 
iou_th»sh
, 
max_ouut_size
)

672 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

673 
w™h
 
£lf
.
	`as£¹Rai£sW™hP»diÿ‹M©ch
(

674 
”rÜs
.
Inv®idArgum’tE¼Ü
, 'scores has incompatible shape'):

675 
£ss
.
	`run
(
nms
.
	$g‘
())

677 
def
 
	$‹¡_£Ëù_äom_th»e_şu¡”s
(
£lf
):

678 
cÜÃrs
 = 
tf
.
	`cÚ¡ªt
([[0, 0, 1, 1],

683 [0, 100, 1, 101]], 
tf
.
æßt32
)

684 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

685 
boxes
.
	`add_f›ld
('scÜes', 
tf
.
	$cÚ¡ªt
([.9, .75, .6, .95, .5, .3]))

686 
iou_th»sh
 = .5

687 
max_ouut_size
 = 3

689 
exp_nms
 = [[0, 10, 1, 11],

692 
nms
 = 
box_li¡_İs
.
	$nÚ_max_suµ»ssiÚ
(

693 
boxes
, 
iou_th»sh
, 
max_ouut_size
)

694 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

695 
nms_ouut
 = 
£ss
.
	`run
(
nms
.
	$g‘
())

696 
£lf
.
	$as£¹AÎClo£
(
nms_ouut
, 
exp_nms
)

698 
def
 
	$‹¡_£Ëù_©_mo¡_two_boxes_äom_th»e_şu¡”s
(
£lf
):

699 
cÜÃrs
 = 
tf
.
	`cÚ¡ªt
([[0, 0, 1, 1],

704 [0, 100, 1, 101]], 
tf
.
æßt32
)

705 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

706 
boxes
.
	`add_f›ld
('scÜes', 
tf
.
	$cÚ¡ªt
([.9, .75, .6, .95, .5, .3]))

707 
iou_th»sh
 = .5

708 
max_ouut_size
 = 2

710 
exp_nms
 = [[0, 10, 1, 11],

712 
nms
 = 
box_li¡_İs
.
	$nÚ_max_suµ»ssiÚ
(

713 
boxes
, 
iou_th»sh
, 
max_ouut_size
)

714 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

715 
nms_ouut
 = 
£ss
.
	`run
(
nms
.
	$g‘
())

716 
£lf
.
	$as£¹AÎClo£
(
nms_ouut
, 
exp_nms
)

718 
def
 
	$‹¡_£Ëù_©_mo¡_thœty_boxes_äom_th»e_şu¡”s
(
£lf
):

719 
cÜÃrs
 = 
tf
.
	`cÚ¡ªt
([[0, 0, 1, 1],

724 [0, 100, 1, 101]], 
tf
.
æßt32
)

725 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

726 
boxes
.
	`add_f›ld
('scÜes', 
tf
.
	$cÚ¡ªt
([.9, .75, .6, .95, .5, .3]))

727 
iou_th»sh
 = .5

728 
max_ouut_size
 = 30

730 
exp_nms
 = [[0, 10, 1, 11],

733 
nms
 = 
box_li¡_İs
.
	$nÚ_max_suµ»ssiÚ
(

734 
boxes
, 
iou_th»sh
, 
max_ouut_size
)

735 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

736 
nms_ouut
 = 
£ss
.
	`run
(
nms
.
	$g‘
())

737 
£lf
.
	$as£¹AÎClo£
(
nms_ouut
, 
exp_nms
)

739 
def
 
	$‹¡_£Ëù_sšgË_box
(
£lf
):

740 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 1, 1]], 
tf
.
æßt32
)

741 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

742 
boxes
.
	`add_f›ld
('scÜes', 
tf
.
	$cÚ¡ªt
([.9]))

743 
iou_th»sh
 = .5

744 
max_ouut_size
 = 3

746 
exp_nms
 = [[0, 0, 1, 1]]

747 
nms
 = 
box_li¡_İs
.
	$nÚ_max_suµ»ssiÚ
(

748 
boxes
, 
iou_th»sh
, 
max_ouut_size
)

749 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

750 
nms_ouut
 = 
£ss
.
	`run
(
nms
.
	$g‘
())

751 
£lf
.
	$as£¹AÎClo£
(
nms_ouut
, 
exp_nms
)

753 
def
 
	$‹¡_£Ëù_äom_‹n_id’tiÿl_boxes
(
£lf
):

754 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
(10 * [[0, 0, 1, 1]], 
tf
.
æßt32
)

755 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

756 
boxes
.
	`add_f›ld
('scÜes', 
tf
.
	$cÚ¡ªt
(10 * [.9]))

757 
iou_th»sh
 = .5

758 
max_ouut_size
 = 3

760 
exp_nms
 = [[0, 0, 1, 1]]

761 
nms
 = 
box_li¡_İs
.
	$nÚ_max_suµ»ssiÚ
(

762 
boxes
, 
iou_th»sh
, 
max_ouut_size
)

763 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

764 
nms_ouut
 = 
£ss
.
	`run
(
nms
.
	$g‘
())

765 
£lf
.
	$as£¹AÎClo£
(
nms_ouut
, 
exp_nms
)

767 
def
 
	$‹¡_cİy_exŒa_f›lds
(
£lf
):

768 
cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 1, 1],

769 [0, 0.1, 1, 1.1]], 
tf
.
æßt32
)

770 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs
)

771 
‹nsÜ1
 = 
Å
.
	$¬¿y
([[1], [4]])

772 
‹nsÜ2
 = 
Å
.
	$¬¿y
([[1, 1], [2, 2]])

773 
boxes
.
	`add_f›ld
('‹nsÜ1', 
tf
.
	$cÚ¡ªt
(
‹nsÜ1
))

774 
boxes
.
	`add_f›ld
('‹nsÜ2', 
tf
.
	$cÚ¡ªt
(
‹nsÜ2
))

775 
Ãw_boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
([[0, 0, 10, 10],

776 [1, 3, 5, 5]], 
tf
.
æßt32
))

777 
Ãw_boxes
 = 
box_li¡_İs
.
	$_cİy_exŒa_f›lds
(
Ãw_boxes
, 
boxes
)

778 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

779 
£lf
.
	`as£¹AÎClo£
(
‹nsÜ1
, 
£ss
.
	`run
(
Ãw_boxes
.
	`g‘_f›ld
('tensor1')))

780 
£lf
.
	`as£¹AÎClo£
(
‹nsÜ2
, 
£ss
.
	`run
(
Ãw_boxes
.
	`g‘_f›ld
('tensor2')))

783 
şass
 
	$CoÜdš©esCÚv”siÚTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

785 
def
 
	$‹¡_to_nÜm®ized_coÜdš©es
(
£lf
):

786 
coÜdš©es
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 100, 100],

787 [25, 25, 75, 75]], 
tf
.
æßt32
)

788 
img
 = 
tf
.
	`Úes
((128, 100, 100, 3))

789 
boxli¡
 = 
box_li¡
.
	$BoxLi¡
(
coÜdš©es
)

790 
nÜm®ized_boxli¡
 = 
box_li¡_İs
.
	`to_nÜm®ized_coÜdš©es
(

791 
boxli¡
, 
tf
.
	`sh­e
(
img
)[1],f.shape(img)[2])

792 
ex³ùed_boxes
 = [[0, 0, 1, 1],

795 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

796 
nÜm®ized_boxes
 = 
£ss
.
	`run
(
nÜm®ized_boxli¡
.
	$g‘
())

797 
£lf
.
	$as£¹AÎClo£
(
nÜm®ized_boxes
, 
ex³ùed_boxes
)

799 
def
 
	$‹¡_to_nÜm®ized_coÜdš©es_®»ady_nÜm®ized
(
£lf
):

800 
coÜdš©es
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 1, 1],

801 [0.25, 0.25, 0.75, 0.75]], 
tf
.
æßt32
)

802 
img
 = 
tf
.
	`Úes
((128, 100, 100, 3))

803 
boxli¡
 = 
box_li¡
.
	$BoxLi¡
(
coÜdš©es
)

804 
nÜm®ized_boxli¡
 = 
box_li¡_İs
.
	`to_nÜm®ized_coÜdš©es
(

805 
boxli¡
, 
tf
.
	`sh­e
(
img
)[1],f.shape(img)[2])

807 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

808 
w™h
 
£lf
.
	`as£¹Rai£sOpE¼Ü
('assertion failed'):

809 
£ss
.
	`run
(
nÜm®ized_boxli¡
.
	$g‘
())

811 
def
 
	$‹¡_to_absŞu‹_coÜdš©es
(
£lf
):

812 
coÜdš©es
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 1, 1],

813 [0.25, 0.25, 0.75, 0.75]], 
tf
.
æßt32
)

814 
img
 = 
tf
.
	`Úes
((128, 100, 100, 3))

815 
boxli¡
 = 
box_li¡
.
	$BoxLi¡
(
coÜdš©es
)

816 
absŞu‹_boxli¡
 = 
box_li¡_İs
.
	`to_absŞu‹_coÜdš©es
(
boxli¡
,

817 
tf
.
	`sh­e
(
img
)[1],

818 
tf
.
	`sh­e
(
img
)[2])

819 
ex³ùed_boxes
 = [[0, 0, 100, 100],

822 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

823 
absŞu‹_boxes
 = 
£ss
.
	`run
(
absŞu‹_boxli¡
.
	$g‘
())

824 
£lf
.
	$as£¹AÎClo£
(
absŞu‹_boxes
, 
ex³ùed_boxes
)

826 
def
 
	$‹¡_to_absŞu‹_coÜdš©es_®»ady_abŞu‹
(
£lf
):

827 
coÜdš©es
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 100, 100],

828 [25, 25, 75, 75]], 
tf
.
æßt32
)

829 
img
 = 
tf
.
	`Úes
((128, 100, 100, 3))

830 
boxli¡
 = 
box_li¡
.
	$BoxLi¡
(
coÜdš©es
)

831 
absŞu‹_boxli¡
 = 
box_li¡_İs
.
	`to_absŞu‹_coÜdš©es
(
boxli¡
,

832 
tf
.
	`sh­e
(
img
)[1],

833 
tf
.
	`sh­e
(
img
)[2])

835 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

836 
w™h
 
£lf
.
	`as£¹Rai£sOpE¼Ü
('assertion failed'):

837 
£ss
.
	`run
(
absŞu‹_boxli¡
.
	$g‘
())

839 
def
 
	$‹¡_cÚv”t_to_nÜm®ized_ªd_back
(
£lf
):

840 
coÜdš©es
 = 
Å
.
¿ndom
.
	`unifÜm
(
size
=(100, 4))

841 
coÜdš©es
 = 
Å
.
	`round
Òp.
	`sÜt
(coordinates) * 200)

842 
coÜdš©es
[:, 2:4] += 1

843 
coÜdš©es
[99, :] = [0, 0, 201, 201]

844 
img
 = 
tf
.
	`Úes
((128, 202, 202, 3))

846 
boxli¡
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
coÜdš©es
, 
tf
.
æßt32
))

847 
boxli¡
 = 
box_li¡_İs
.
	`to_nÜm®ized_coÜdš©es
(boxlist,

848 
tf
.
	`sh­e
(
img
)[1],

849 
tf
.
	`sh­e
(
img
)[2])

850 
boxli¡
 = 
box_li¡_İs
.
	`to_absŞu‹_coÜdš©es
(boxlist,

851 
tf
.
	`sh­e
(
img
)[1],

852 
tf
.
	`sh­e
(
img
)[2])

854 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

855 
out
 = 
£ss
.
	`run
(
boxli¡
.
	$g‘
())

856 
£lf
.
	$as£¹AÎClo£
(
out
, 
coÜdš©es
)

858 
def
 
	$‹¡_cÚv”t_to_absŞu‹_ªd_back
(
£lf
):

859 
coÜdš©es
 = 
Å
.
¿ndom
.
	`unifÜm
(
size
=(100, 4))

860 
coÜdš©es
 = 
Å
.
	$sÜt
(
coÜdš©es
)

861 
coÜdš©es
[99, :] = [0, 0, 1, 1]

862 
img
 = 
tf
.
	`Úes
((128, 202, 202, 3))

864 
boxli¡
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
coÜdš©es
, 
tf
.
æßt32
))

865 
boxli¡
 = 
box_li¡_İs
.
	`to_absŞu‹_coÜdš©es
(boxlist,

866 
tf
.
	`sh­e
(
img
)[1],

867 
tf
.
	`sh­e
(
img
)[2])

868 
boxli¡
 = 
box_li¡_İs
.
	`to_nÜm®ized_coÜdš©es
(boxlist,

869 
tf
.
	`sh­e
(
img
)[1],

870 
tf
.
	`sh­e
(
img
)[2])

872 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

873 
out
 = 
£ss
.
	`run
(
boxli¡
.
	$g‘
())

874 
£lf
.
	$as£¹AÎClo£
(
out
, 
coÜdš©es
)

877 
şass
 
	$BoxRefšem’tTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

879 
def
 
	$‹¡_box_vÙšg
(
£lf
):

880 
ÿndid©es
 = 
box_li¡
.
	`BoxLi¡
(

881 
tf
.
	$cÚ¡ªt
([[0.1, 0.1, 0.4, 0.4], [0.6, 0.6, 0.8, 0.8]], 
tf
.
æßt32
))

882 
ÿndid©es
.
	`add_f›ld
('ExŒaF›ld', 
tf
.
	$cÚ¡ªt
([1, 2]))

883 
poŞ
 = 
box_li¡
.
	`BoxLi¡
(

884 
tf
.
	$cÚ¡ªt
([[0.1, 0.1, 0.4, 0.4], [0.1, 0.1, 0.5, 0.5],

885 [0.6, 0.6, 0.8, 0.8]], 
tf
.
æßt32
))

886 
poŞ
.
	`add_f›ld
('scÜes', 
tf
.
	$cÚ¡ªt
([0.75, 0.25, 0.3]))

887 
av”aged_boxes
 = 
box_li¡_İs
.
	$box_vÙšg
(
ÿndid©es
, 
poŞ
)

888 
ex³ùed_boxes
 = [[0.1, 0.1, 0.425, 0.425], [0.6, 0.6, 0.8, 0.8]]

889 
ex³ùed_scÜes
 = [0.5, 0.3]

890 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

891 
boxes_out
, 
scÜes_out
, 
exŒa_f›ld_out
 = 
£ss
.
	`run
(

892 [
av”aged_boxes
.
	`g‘
(),‡v”aged_boxes.
	`g‘_f›ld
('scores'),

893 
av”aged_boxes
.
	`g‘_f›ld
('ExtraField')])

895 
£lf
.
	$as£¹AÎClo£
(
ex³ùed_boxes
, 
boxes_out
)

896 
£lf
.
	$as£¹AÎClo£
(
ex³ùed_scÜes
, 
scÜes_out
)

897 
£lf
.
	$as£¹AÎEqu®
(
exŒa_f›ld_out
, [1, 2])

899 
def
 
	$‹¡_box_vÙšg_çs_w™h_Ãg©ive_scÜes
(
£lf
):

900 
ÿndid©es
 = 
box_li¡
.
	`BoxLi¡
(

901 
tf
.
	$cÚ¡ªt
([[0.1, 0.1, 0.4, 0.4]], 
tf
.
æßt32
))

902 
poŞ
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
([[0.1, 0.1, 0.4, 0.4]], 
tf
.
æßt32
))

903 
poŞ
.
	`add_f›ld
('scÜes', 
tf
.
	`cÚ¡ªt
([-0.2]))

904 
av”aged_boxes
 = 
box_li¡_İs
.
	$box_vÙšg
(
ÿndid©es
, 
poŞ
)

906 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

907 
w™h
 
£lf
.
	`as£¹Rai£sOpE¼Ü
('Scores must be‚on‚egative'):

908 
£ss
.
	`run
([
av”aged_boxes
.
	`g‘
()])

910 
def
 
	$‹¡_box_vÙšg_çs_wh’_unm©ched
(
£lf
):

911 
ÿndid©es
 = 
box_li¡
.
	`BoxLi¡
(

912 
tf
.
	$cÚ¡ªt
([[0.1, 0.1, 0.4, 0.4]], 
tf
.
æßt32
))

913 
poŞ
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
([[0.6, 0.6, 0.8, 0.8]], 
tf
.
æßt32
))

914 
poŞ
.
	`add_f›ld
('scÜes', 
tf
.
	$cÚ¡ªt
([0.2]))

915 
av”aged_boxes
 = 
box_li¡_İs
.
	$box_vÙšg
(
ÿndid©es
, 
poŞ
)

917 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

918 
w™h
 
£lf
.
	`as£¹Rai£sOpE¼Ü
('Each box in selected_boxes must match '

920 
£ss
.
	`run
([
av”aged_boxes
.
	`g‘
()])

922 
def
 
	$‹¡_»fše_boxes
(
£lf
):

923 
poŞ
 = 
box_li¡
.
	`BoxLi¡
(

924 
tf
.
	$cÚ¡ªt
([[0.1, 0.1, 0.4, 0.4], [0.1, 0.1, 0.5, 0.5],

925 [0.6, 0.6, 0.8, 0.8]], 
tf
.
æßt32
))

926 
poŞ
.
	`add_f›ld
('ExŒaF›ld', 
tf
.
	$cÚ¡ªt
([1, 2, 3]))

927 
poŞ
.
	`add_f›ld
('scÜes', 
tf
.
	$cÚ¡ªt
([0.75, 0.25, 0.3]))

928 
»fšed_boxes
 = 
box_li¡_İs
.
	$»fše_boxes
(
poŞ
, 0.5, 10)

930 
ex³ùed_boxes
 = [[0.1, 0.1, 0.425, 0.425], [0.6, 0.6, 0.8, 0.8]]

931 
ex³ùed_scÜes
 = [0.5, 0.3]

932 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

933 
boxes_out
, 
scÜes_out
, 
exŒa_f›ld_out
 = 
£ss
.
	`run
(

934 [
»fšed_boxes
.
	`g‘
(),„efšed_boxes.
	`g‘_f›ld
('scores'),

935 
»fšed_boxes
.
	`g‘_f›ld
('ExtraField')])

937 
£lf
.
	$as£¹AÎClo£
(
ex³ùed_boxes
, 
boxes_out
)

938 
£lf
.
	$as£¹AÎClo£
(
ex³ùed_scÜes
, 
scÜes_out
)

939 
£lf
.
	$as£¹AÎEqu®
(
exŒa_f›ld_out
, [1, 3])

941 
def
 
	$‹¡_»fše_boxes_muÉi_şass
(
£lf
):

942 
poŞ
 = 
box_li¡
.
	`BoxLi¡
(

943 
tf
.
	$cÚ¡ªt
([[0.1, 0.1, 0.4, 0.4], [0.1, 0.1, 0.5, 0.5],

944 [0.6, 0.6, 0.8, 0.8], [0.2, 0.2, 0.3, 0.3]], 
tf
.
æßt32
))

945 
poŞ
.
	`add_f›ld
('şas£s', 
tf
.
	$cÚ¡ªt
([0, 0, 1, 1]))

946 
poŞ
.
	`add_f›ld
('scÜes', 
tf
.
	$cÚ¡ªt
([0.75, 0.25, 0.3, 0.2]))

947 
»fšed_boxes
 = 
box_li¡_İs
.
	$»fše_boxes_muÉi_şass
(
poŞ
, 3, 0.5, 10)

949 
ex³ùed_boxes
 = [[0.1, 0.1, 0.425, 0.425], [0.6, 0.6, 0.8, 0.8],

951 
ex³ùed_scÜes
 = [0.5, 0.3, 0.2]

952 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

953 
boxes_out
, 
scÜes_out
, 
exŒa_f›ld_out
 = 
£ss
.
	`run
(

954 [
»fšed_boxes
.
	`g‘
(),„efšed_boxes.
	`g‘_f›ld
('scores'),

955 
»fšed_boxes
.
	`g‘_f›ld
('classes')])

957 
£lf
.
	$as£¹AÎClo£
(
ex³ùed_boxes
, 
boxes_out
)

958 
£lf
.
	$as£¹AÎClo£
(
ex³ùed_scÜes
, 
scÜes_out
)

959 
£lf
.
	$as£¹AÎEqu®
(
exŒa_f›ld_out
, [0, 1, 1])

961 
__Çme__
 == '__main__':

962 
tf
.
‹¡
.
	`maš
()

	@core/box_list_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


23 
şass
 
	$BoxLi¡Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$‹¡_num_boxes
(
£lf
):

27 
d©a
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 1, 1], [1, 1, 2, 3], [3, 4, 5, 5]], 
tf
.
æßt32
)

28 
ex³ùed_num_boxes
 = 3

30 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
d©a
)

31 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

32 
num_boxes_ouut
 = 
£ss
.
	`run
(
boxes
.
	$num_boxes
())

33 
£lf
.
	$as£¹Equ®s
(
num_boxes_ouut
, 
ex³ùed_num_boxes
)

35 
def
 
	$‹¡_g‘_cÜ»ù_ûÁ”_coÜdš©es_ªd_sizes
(
£lf
):

36 
boxes
 = [[10.0, 10.0, 20.0, 15.0], [0.2, 0.1, 0.5, 0.4]]

37 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
boxes
))

38 
ûÁ”s_sizes
 = 
boxes
.
	$g‘_ûÁ”_coÜdš©es_ªd_sizes
()

39 
ex³ùed_ûÁ”s_sizes
 = [[15, 0.35], [12.5, 0.25], [10, 0.3], [5, 0.3]]

40 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

41 
ûÁ”s_sizes_out
 = 
£ss
.
	$run
(
ûÁ”s_sizes
)

42 
£lf
.
	$as£¹AÎClo£
(
ûÁ”s_sizes_out
, 
ex³ùed_ûÁ”s_sizes
)

44 
def
 
	$‹¡_ü—‹_box_li¡_w™h_dyÇmic_sh­e
(
£lf
):

45 
d©a
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 1, 1], [1, 1, 2, 3], [3, 4, 5, 5]], 
tf
.
æßt32
)

46 
šdiûs
 = 
tf
.
	`»sh­e
Ñf.
	`wh”e
Ñf.
	`g»©”
([1, 0, 1], 0)), [-1])

47 
d©a
 = 
tf
.
	$g©h”
(
d©a
, 
šdiûs
)

48 
as£¹
 
d©a
.
	`g‘_sh­e
().
	`as_li¡
(è=ğ[
NÚe
, 4]

49 
ex³ùed_num_boxes
 = 2

51 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
d©a
)

52 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

53 
num_boxes_ouut
 = 
£ss
.
	`run
(
boxes
.
	$num_boxes
())

54 
£lf
.
	$as£¹Equ®s
(
num_boxes_ouut
, 
ex³ùed_num_boxes
)

56 
def
 
	$‹¡_Œª¥o£_coÜdš©es
(
£lf
):

57 
boxes
 = [[10.0, 10.0, 20.0, 15.0], [0.2, 0.1, 0.5, 0.4]]

58 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
boxes
))

59 
boxes
.
	$Œª¥o£_coÜdš©es
()

60 
ex³ùed_cÜÃrs
 = [[10.0, 10.0, 15.0, 20.0], [0.1, 0.2, 0.4, 0.5]]

61 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

62 
cÜÃrs_out
 = 
£ss
.
	`run
(
boxes
.
	$g‘
())

63 
£lf
.
	$as£¹AÎClo£
(
cÜÃrs_out
, 
ex³ùed_cÜÃrs
)

65 
def
 
	$‹¡_box_li¡_šv®id_šputs
(
£lf
):

66 
d©a0
 = 
tf
.
	$cÚ¡ªt
([[[0, 0, 1, 1], [3, 4, 5, 5]]], 
tf
.
æßt32
)

67 
d©a1
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 1], [1, 1, 2], [3, 4, 5]], 
tf
.
æßt32
)

68 
d©a2
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 1], [1, 1, 2], [3, 4, 5]], 
tf
.
št32
)

70 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

71 
_
 = 
box_li¡
.
	$BoxLi¡
(
d©a0
)

72 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

73 
_
 = 
box_li¡
.
	$BoxLi¡
(
d©a1
)

74 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

75 
_
 = 
box_li¡
.
	$BoxLi¡
(
d©a2
)

77 
def
 
	$‹¡_num_boxes_¡©ic
(
£lf
):

78 
box_cÜÃrs
 = [[10.0, 10.0, 20.0, 15.0], [0.2, 0.1, 0.5, 0.4]]

79 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
box_cÜÃrs
))

80 
£lf
.
	`as£¹Equ®s
(
boxes
.
	`num_boxes_¡©ic
(), 2)

81 
£lf
.
	`as£¹Equ®s
(
	`ty³
(
boxes
.
	`num_boxes_¡©ic
()), )

83 
def
 
	$‹¡_num_boxes_¡©ic_fÜ_unšã¼abË_sh­e
(
£lf
):

84 
¶aûhŞd”
 = 
tf
.
	$¶aûhŞd”
(
tf
.
æßt32
, 
sh­e
=[
NÚe
, 4])

85 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
¶aûhŞd”
)

86 
£lf
.
	`as£¹Equ®s
(
boxes
.
	`num_boxes_¡©ic
(), 
NÚe
)

88 
def
 
	$‹¡_as_‹nsÜ_diù
(
£lf
):

89 
boxli¡
 = 
box_li¡
.
	`BoxLi¡
(

90 
tf
.
	$cÚ¡ªt
([[0.1, 0.1, 0.4, 0.4], [0.1, 0.1, 0.5, 0.5]], 
tf
.
æßt32
))

91 
boxli¡
.
	`add_f›ld
('şas£s', 
tf
.
	$cÚ¡ªt
([0, 1]))

92 
boxli¡
.
	`add_f›ld
('scÜes', 
tf
.
	$cÚ¡ªt
([0.75, 0.2]))

93 
‹nsÜ_diù
 = 
boxli¡
.
	$as_‹nsÜ_diù
()

95 
ex³ùed_boxes
 = [[0.1, 0.1, 0.4, 0.4], [0.1, 0.1, 0.5, 0.5]]

96 
ex³ùed_şas£s
 = [0, 1]

97 
ex³ùed_scÜes
 = [0.75, 0.2]

99 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

100 
‹nsÜ_diù_out
 = 
£ss
.
	$run
(
‹nsÜ_diù
)

101 
£lf
.
	`as£¹AÎEqu®
(3, 
	$Ën
(
‹nsÜ_diù_out
))

102 
£lf
.
	`as£¹AÎClo£
(
ex³ùed_boxes
, 
‹nsÜ_diù_out
['boxes'])

103 
£lf
.
	`as£¹AÎEqu®
(
ex³ùed_şas£s
, 
‹nsÜ_diù_out
['classes'])

104 
£lf
.
	`as£¹AÎClo£
(
ex³ùed_scÜes
, 
‹nsÜ_diù_out
['scores'])

106 
def
 
	$‹¡_as_‹nsÜ_diù_w™h_ã©u»s
(
£lf
):

107 
boxli¡
 = 
box_li¡
.
	`BoxLi¡
(

108 
tf
.
	$cÚ¡ªt
([[0.1, 0.1, 0.4, 0.4], [0.1, 0.1, 0.5, 0.5]], 
tf
.
æßt32
))

109 
boxli¡
.
	`add_f›ld
('şas£s', 
tf
.
	$cÚ¡ªt
([0, 1]))

110 
boxli¡
.
	`add_f›ld
('scÜes', 
tf
.
	$cÚ¡ªt
([0.75, 0.2]))

111 
‹nsÜ_diù
 = 
boxli¡
.
	`as_‹nsÜ_diù
(['boxes', 'classes', 'scores'])

113 
ex³ùed_boxes
 = [[0.1, 0.1, 0.4, 0.4], [0.1, 0.1, 0.5, 0.5]]

114 
ex³ùed_şas£s
 = [0, 1]

115 
ex³ùed_scÜes
 = [0.75, 0.2]

117 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

118 
‹nsÜ_diù_out
 = 
£ss
.
	$run
(
‹nsÜ_diù
)

119 
£lf
.
	`as£¹AÎEqu®
(3, 
	$Ën
(
‹nsÜ_diù_out
))

120 
£lf
.
	`as£¹AÎClo£
(
ex³ùed_boxes
, 
‹nsÜ_diù_out
['boxes'])

121 
£lf
.
	`as£¹AÎEqu®
(
ex³ùed_şas£s
, 
‹nsÜ_diù_out
['classes'])

122 
£lf
.
	`as£¹AÎClo£
(
ex³ùed_scÜes
, 
‹nsÜ_diù_out
['scores'])

124 
def
 
	$‹¡_as_‹nsÜ_diù_missšg_f›ld
(
£lf
):

125 
boxli¡
 = 
box_li¡
.
	`BoxLi¡
(

126 
tf
.
	$cÚ¡ªt
([[0.1, 0.1, 0.4, 0.4], [0.1, 0.1, 0.5, 0.5]], 
tf
.
æßt32
))

127 
boxli¡
.
	`add_f›ld
('şas£s', 
tf
.
	$cÚ¡ªt
([0, 1]))

128 
boxli¡
.
	`add_f›ld
('scÜes', 
tf
.
	$cÚ¡ªt
([0.75, 0.2]))

129 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

130 
boxli¡
.
	`as_‹nsÜ_diù
(['foo', 'bar'])

133 
__Çme__
 == '__main__':

134 
tf
.
‹¡
.
	`maš
()

	@core/box_predictor.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
Box
 
´ediùÜs
 
¬e
 
şas£s
 
th©
 
ke
 
a
 
high
 
Ëv–


19 
image
 
ã©u»
 
m­
 
as
 
šput
 
ªd
 
´oduû
 
two
 
	g´ediùiÚs
,

20 (1è
a
 
‹nsÜ
 
’codšg
 
box
 
	gloÿtiÚs
, 
	gªd


21 (2è
a
 
‹nsÜ
 
’codšg
 
şas£s
 
—ch
 
	gbox
.

23 
The£
 
compÚ’ts
 
¬e
 
·s£d
 
dœeùly
 
to
 
loss
 
funùiÚs


24 
š
 
our
 
d‘eùiÚ
 
	gmod–s
.

26 
The£
 
moduËs
 
¬e
 
£·¿‹d
 
äom
 
the
 
maš
 
mod–
 
sšû
h
§me


27 
ãw
 
box
 
´ediùÜ
 
¬ch™eùu»s
 
¬e
 
sh¬ed
 
aüoss
 
mªy
 
	gmod–s
.

29 
äom
 
abc
 
impÜt
 
ab¡¿ùm‘hod


30 
impÜt
 
‹nsÜæow
 
as
 
tf


31 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
İs


32 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
sh­e_uts


33 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
¡©ic_sh­e


35 
	g¦im
 = 
tf
.
cÚŒib
.
¦im


37 
BOX_ENCODINGS
 = 'box_encodings'

38 
CLASS_PREDICTIONS_WITH_BACKGROUND
 = 'class_predictions_with_background'

39 
MASK_PREDICTIONS
 = 'mask_predictions'

42 
şass
 
	$BoxP»diùÜ
(
objeù
):

45 
def
 
	$__š™__
(
£lf
, 
is_Œaššg
, 
num_şas£s
):

48 
Args
:

49 
is_Œaššg
: 
Indiÿ‹s
 
wh‘h”
 
the
 
BoxP»diùÜ
 
is
 
š
 
Œaššg
 
mode
.

50 
num_şas£s
: 
numb”
 
of
 
şas£s
. 
NÙe
 
th©
‚um_şas£ *
dÛs
 
nÙ
*

51 
šşude
 
the
 
background
 
ÿ‹gÜy
, 
so
 
groundŒuth
 
Ïb–s
 
ke
 
v®ues


52 
š
 {0, 1, .., 
K
-1
	}
}, 
	gnum_şas£s
=K (
ªd
 
nÙ
 K+1, 
ev’
 
though
 
the


53 
assigÃd
 
şassifiÿtiÚ
 
rg‘s
 
ÿn
 
¿nge
 
äom
 {0,... 
K
}).

55 
	g£lf
.
	g_is_Œaššg
 = 
is_Œaššg


56 
£lf
.
_num_şas£s
 = 
num_şas£s


58 @
´İ”ty


59 
def
 
	$num_şas£s
(
£lf
):

60  
£lf
.
_num_şas£s


62 
def
 
	$´ediù
(
£lf
, 
image_ã©u»s
, 
num_´ediùiÚs_³r_loÿtiÚ
, 
scİe
,

63 **
·¿ms
):

66 
Takes
 
a
 
high
 
Ëv–
 
image
 
ã©u»
 
m­
 
as
 
šput
 
ªd
 
´oduû
 
two
 
´ediùiÚs
,

67 (1è
a
 
‹nsÜ
 
’codšg
 
box
 
loÿtiÚs
, 
ªd


68 (2è
a
 
‹nsÜ
 
’codšg
 
şass
 
scÜes
 
—ch
 
cÜ»¥Údšg
 
box
.

69 
In
 
this
 
š‹rçû
, 
we
 
Úly
 
assume
 
th©
 
two
 
‹nsÜs
 
¬e
 
»tuºed
 
as
 
ouut


70 
ªd
 dØ
nÙ
 
assume
 
ªythšg
 
about
 
theœ
 
sh­es
.

72 
Args
:

73 
image_ã©u»s
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
height
, 
width
,

74 
chªÃls
] 
cÚššg
 
ã©u»s
 
a
 
b©ch
 
of
 
images
.

75 
num_´ediùiÚs_³r_loÿtiÚ
: 
ª
 
š‹g”
 
»´e£Ášg
 
the
 
numb”
 
of
 
box


76 
´ediùiÚs
 
to
 
be
 
made
 
³r
 
¥©Ÿl
 
loÿtiÚ
 
š
 
the
 
ã©u»
 
m­
.

77 
scİe
: 
V¬ŸbË
 
ªd
 
Op
 scİ
Çme
.

78 **
·¿ms
: 
Add™iÚ®
 
keywÜd
 
¬gum’ts
 
¥ecific
 
im¶em’tiÚs
 
of


79 
BoxP»diùÜ
.

81 
R‘uºs
:

82 
A
 
diùiÚ¬y
 
cÚššg
 
©
 
Ëa¡
 
the
 
fŞlowšg
 
‹nsÜs
.

83 
box_’codšgs
: 
A
 
‹nsÜ
 
of
 
sh­e


84 [
b©ch_size
, 
num_ªchÜs
, 
q
, 
code_size
] 
»´e£Ášg
 
the
 
loÿtiÚ
 
of


85 
the
 
objeùs
, 
wh”e
 
q
 
is
 1 
Ü
h
numb”
 
of
 
şas£s
.

86 
şass_´ediùiÚs_w™h_background
: 
A
 
‹nsÜ
 
of
 
sh­e


87 [
b©ch_size
, 
num_ªchÜs
, 
num_şas£s
 + 1] 
»´e£Ášg
 
the
 
şass


88 
´ediùiÚs
 
the
 
´İo§ls
.

90 
w™h
 
tf
.
	$v¬ŸbË_scİe
(
scİe
):

91  
£lf
.
	$_´ediù
(
image_ã©u»s
, 
num_´ediùiÚs_³r_loÿtiÚ
,

92 **
·¿ms
)

94 #TODO: 
num_´ediùiÚs_³r_loÿtiÚ
 
could
 
be
 
moved
 
to
 
cÚ¡ruùÜ
.

95 #Thi 
is
 
cu¼’y
 
Úly
 
u£d
 
by
 
CÚvŞutiÚ®BoxP»diùÜ
.

96 @
ab¡¿ùm‘hod


97 
def
 
	$_´ediù
(
£lf
, 
image_ã©u»s
, 
num_´ediùiÚs_³r_loÿtiÚ
, **
·¿ms
):

100 
Args
:

101 
image_ã©u»s
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
height
, 
width
,

102 
chªÃls
] 
cÚššg
 
ã©u»s
 
a
 
b©ch
 
of
 
images
.

103 
num_´ediùiÚs_³r_loÿtiÚ
: 
ª
 
š‹g”
 
»´e£Ášg
 
the
 
numb”
 
of
 
box


104 
´ediùiÚs
 
to
 
be
 
made
 
³r
 
¥©Ÿl
 
loÿtiÚ
 
š
 
the
 
ã©u»
 
m­
.

105 **
·¿ms
: 
Add™iÚ®
 
keywÜd
 
¬gum’ts
 
¥ecific
 
im¶em’tiÚs
 
of


106 
BoxP»diùÜ
.

108 
R‘uºs
:

109 
A
 
diùiÚ¬y
 
cÚššg
 
©
 
Ëa¡
 
the
 
fŞlowšg
 
‹nsÜs
.

110 
box_’codšgs
: 
A
 
‹nsÜ
 
of
 
sh­e


111 [
b©ch_size
, 
num_ªchÜs
, 
q
, 
code_size
] 
»´e£Ášg
 
the
 
loÿtiÚ
 
of


112 
the
 
objeùs
, 
wh”e
 
q
 
is
 1 
Ü
h
numb”
 
of
 
şas£s
.

113 
şass_´ediùiÚs_w™h_background
: 
A
 
‹nsÜ
 
of
 
sh­e


114 [
b©ch_size
, 
num_ªchÜs
, 
num_şas£s
 + 1] 
»´e£Ášg
 
the
 
şass


115 
´ediùiÚs
 
the
 
´İo§ls
.

117 
·ss


120 
şass
 
	$RfúBoxP»diùÜ
(
BoxP»diùÜ
):

123 
Aµl›s
 
a
 
pos™iÚ
 
£ns™ve
 
ROI
 
poŞšg
 
Ú
…os™iÚ 
£ns™ive
 
ã©u»
 
m­s
 
to


124 
´ediù
 
şas£s
 
ªd
 
»fšed
 
loÿtiÚs
. 
S“
 
h‰ps
:

125 
d‘as
.

127 
This
 
is
 
u£d
 
the
 
£cÚd
 
¡age
 
of
h
RFCN
 
m‘a
 
¬ch™eùu»
. 
NÙiû
 
th©


128 
loÿtiÚs
 
¬e
 *
nÙ
* 
sh¬ed
 
aüoss
 
şas£s
, 
thus
 
—ch
 
ªchÜ
, 
a
 
£·¿‹


129 
´ediùiÚ
 
is
 
made
 
—ch
 
şass
.

132 
def
 
	$__š™__
(
£lf
,

133 
is_Œaššg
,

134 
num_şas£s
,

135 
cÚv_hy³½¬ams
,

136 
num_¥©Ÿl_bšs
,

137 
d•th
,

138 
üİ_size
,

139 
box_code_size
):

142 
Args
:

143 
is_Œaššg
: 
Indiÿ‹s
 
wh‘h”
 
the
 
BoxP»diùÜ
 
is
 
š
 
Œaššg
 
mode
.

144 
num_şas£s
: 
numb”
 
of
 
şas£s
. 
NÙe
 
th©
‚um_şas£ *
dÛs
 
nÙ
*

145 
šşude
 
the
 
background
 
ÿ‹gÜy
, 
so
 
groundŒuth
 
Ïb–s
 
ke
 
v®ues


146 
š
 {0, 1, .., 
K
-1
	}
}, 
	gnum_şas£s
=K (
ªd
 
nÙ
 K+1, 
ev’
 
though
 
the


147 
assigÃd
 
şassifiÿtiÚ
 
rg‘s
 
ÿn
 
¿nge
 
äom
 {0,... 
K
}).

148 
	gcÚv_hy³½¬ams
: 
Slim
 
¬g_scİe
 
w™h
 
hy³½¬am‘”s
 
cÚŞutiÚ®


149 
Ïy”s
.

150 
num_¥©Ÿl_bšs
: 
A
 
li¡
 
of
 
two
 
š‹g”s
 `[
¥©Ÿl_bšs_y
,

151 
¥©Ÿl_bšs_x
]`.

152 
	gd•th
: 
T¬g‘
 
d•th
 
to
 
»duû
 
the
 
šput
 
ã©u»
 
m­s
o.

153 
üİ_size
: 
A
 
li¡
 
of
 
two
 
š‹g”s
 `[
üİ_height
, 
üİ_width
]`.

154 
	gbox_code_size
: 
Size
 
of
 
’codšg
 
—ch
 
box
.

156 
su³r
(
RfúBoxP»diùÜ
, 
£lf
).
	$__š™__
(
is_Œaššg
, 
num_şas£s
)

157 
£lf
.
_cÚv_hy³½¬ams
 = 
cÚv_hy³½¬ams


158 
£lf
.
_num_¥©Ÿl_bšs
 = 
num_¥©Ÿl_bšs


159 
£lf
.
_d•th
 = 
d•th


160 
£lf
.
_üİ_size
 = 
üİ_size


161 
£lf
.
_box_code_size
 = 
box_code_size


163 @
´İ”ty


164 
def
 
	$num_şas£s
(
£lf
):

165  
£lf
.
_num_şas£s


167 
def
 
	$_´ediù
(
£lf
, 
image_ã©u»s
, 
num_´ediùiÚs_³r_loÿtiÚ
,

168 
´İo§l_boxes
):

171 
Args
:

172 
image_ã©u»s
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
height
, 
width
,

173 
chªÃls
] 
cÚššg
 
ã©u»s
 
a
 
b©ch
 
of
 
images
.

174 
num_´ediùiÚs_³r_loÿtiÚ
: 
ª
 
š‹g”
 
»´e£Ášg
 
the
 
numb”
 
of
 
box


175 
´ediùiÚs
 
to
 
be
 
made
 
³r
 
¥©Ÿl
 
loÿtiÚ
 
š
 
the
 
ã©u»
 
m­
.

176 
Cu¼’y
, 
this
 
mu¡
 
be
 
£t
 
to
 1, 
Ü
 
ª
 
”rÜ
 
wl
 b
¿i£d
.

177 
´İo§l_boxes
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_´İo§ls
,

178 
box_code_size
].

180 
R‘uºs
:

181 
box_’codšgs
: 
A
 
‹nsÜ
 
of
 
sh­e


182 [
b©ch_size
, 1, 
num_şas£s
, 
code_size
] 
»´e£Ášg
 
the


183 
loÿtiÚ
 
of
 
the
 
objeùs
.

184 
şass_´ediùiÚs_w™h_background
: 
A
 
‹nsÜ
 
of
 
sh­e


185 [
b©ch_size
, 1, 
num_şas£s
 + 1] 
»´e£Ášg
 
the
 
şass


186 
´ediùiÚs
 
the
 
´İo§ls
.

187 
Rai£s
:

188 
V®ueE¼Ü
: 
num_´ediùiÚs_³r_loÿtiÚ
 
is
 
nÙ
 1.

190 
num_´ediùiÚs_³r_loÿtiÚ
 != 1:

191 
¿i£
 
	`V®ueE¼Ü
('Currently RfcnBoxPredictor only supports '

194 
b©ch_size
 = 
tf
.
	`sh­e
(
´İo§l_boxes
)[0]

195 
num_boxes
 = 
tf
.
	`sh­e
(
´İo§l_boxes
)[1]

196 
def
 
	$g‘_box_šdiûs
(
´İo§ls
):

197 
´İo§ls_sh­e
 = 
´İo§ls
.
	`g‘_sh­e
().
	$as_li¡
()

198 
	$ªy
(
dim
 
is
 
NÚe
 dim 
š
 
´İo§ls_sh­e
):

199 
´İo§ls_sh­e
 = 
tf
.
	$sh­e
(
´İo§ls
)

200 
Úes_m©
 = 
tf
.
	$Úes
(
´İo§ls_sh­e
[:2], 
dty³
=
tf
.
št32
)

201 
muÉl›r
 = 
tf
.
	`ex·nd_dims
(

202 
tf
.
	`¿nge
(
¡¬t
=0, 
lim™
=
´İo§ls_sh­e
[0]), 1)

203  
tf
.
	`»sh­e
(
Úes_m©
 * 
muÉl›r
, [-1])

205 
Ãt
 = 
image_ã©u»s


206 
w™h
 
¦im
.
	$¬g_scİe
(
£lf
.
_cÚv_hy³½¬ams
):

207 
Ãt
 = 
¦im
.
	`cÚv2d
Ò‘, 
£lf
.
_d•th
, [1, 1], 
scİe
='reduce_depth')

208 #LoÿtiÚ 
´ediùiÚs
.

209 
loÿtiÚ_ã©u»_m­_d•th
 = (
£lf
.
_num_¥©Ÿl_bšs
[0] *

210 
£lf
.
_num_¥©Ÿl_bšs
[1] *

211 
£lf
.
num_şas£s
 *

212 
£lf
.
_box_code_size
)

213 
loÿtiÚ_ã©u»_m­
 = 
¦im
.
	`cÚv2d
(
Ãt
, 
loÿtiÚ_ã©u»_m­_d•th
,

214 [1, 1], 
aùiv©iÚ_â
=
NÚe
,

215 
scİe
='refined_locations')

216 
box_’codšgs
 = 
İs
.
	`pos™iÚ_£ns™ive_üİ_»giÚs
(

217 
loÿtiÚ_ã©u»_m­
,

218 
boxes
=
tf
.
	`»sh­e
(
´İo§l_boxes
, [-1, 
£lf
.
_box_code_size
]),

219 
box_šd
=
	`g‘_box_šdiûs
(
´İo§l_boxes
),

220 
üİ_size
=
£lf
.
_üİ_size
,

221 
num_¥©Ÿl_bšs
=
£lf
.
_num_¥©Ÿl_bšs
,

222 
glob®_poŞ
=
True
)

223 
box_’codšgs
 = 
tf
.
	$squ“ze
(
box_’codšgs
, 
squ“ze_dims
=[1, 2])

224 
box_’codšgs
 = 
tf
.
	$»sh­e
(
box_’codšgs
,

225 [
b©ch_size
 * 
num_boxes
, 1, 
£lf
.
num_şas£s
,

226 
£lf
.
_box_code_size
])

228 #CÏs 
´ediùiÚs
.

229 
tÙ®_şas£s
 = 
£lf
.
num_şas£s
 + 1 #AccouÁ 
background
 
şass
.

230 
şass_ã©u»_m­_d•th
 = (
£lf
.
_num_¥©Ÿl_bšs
[0] *

231 
£lf
.
_num_¥©Ÿl_bšs
[1] *

232 
tÙ®_şas£s
)

233 
şass_ã©u»_m­
 = 
¦im
.
	`cÚv2d
(
Ãt
, 
şass_ã©u»_m­_d•th
, [1, 1],

234 
aùiv©iÚ_â
=
NÚe
,

235 
scİe
='class_predictions')

236 
şass_´ediùiÚs_w™h_background
 = 
İs
.
	`pos™iÚ_£ns™ive_üİ_»giÚs
(

237 
şass_ã©u»_m­
,

238 
boxes
=
tf
.
	`»sh­e
(
´İo§l_boxes
, [-1, 
£lf
.
_box_code_size
]),

239 
box_šd
=
	`g‘_box_šdiûs
(
´İo§l_boxes
),

240 
üİ_size
=
£lf
.
_üİ_size
,

241 
num_¥©Ÿl_bšs
=
£lf
.
_num_¥©Ÿl_bšs
,

242 
glob®_poŞ
=
True
)

243 
şass_´ediùiÚs_w™h_background
 = 
tf
.
	$squ“ze
(

244 
şass_´ediùiÚs_w™h_background
, 
squ“ze_dims
=[1, 2])

245 
şass_´ediùiÚs_w™h_background
 = 
tf
.
	$»sh­e
(

246 
şass_´ediùiÚs_w™h_background
,

247 [
b©ch_size
 * 
num_boxes
, 1, 
tÙ®_şas£s
])

249  {
BOX_ENCODINGS
: 
box_’codšgs
,

250 
CLASS_PREDICTIONS_WITH_BACKGROUND
:

251 
şass_´ediùiÚs_w™h_background
}

254 
şass
 
	$MaskRCNNBoxP»diùÜ
(
BoxP»diùÜ
):

257 
S“
 
Mask
 
R
-
CNN
: 
He
, 
K
., 
Gkiox¬i
, 
G
., 
DŞÏr
, 
P
., & 
Gœshick
, R. (2017).

258 
Mask
 
R
-
CNN
. 
¬Xiv
 
´•ršt
‡rXiv:1703.06870.

260 
This
 
is
 
u£d
 
the
 
£cÚd
 
¡age
 
of
h
Mask
 
R
-
CNN
 
d‘eùÜ
 
wh”e
 
´İo§ls


261 
üİ³d
 
äom
 
ª
 
image
 
¬e
 
¬¿nged
 
®Úg
 
the
 
b©ch
 
dim’siÚ
 
of
h
šput


262 
image_ã©u»s
 
‹nsÜ
. 
NÙiû
 
th©
 
loÿtiÚs
 
¬e
 *
nÙ
* 
sh¬ed
 
aüoss
 
şas£s
,

263 
thus
 
—ch
 
ªchÜ
, 
a
 
£·¿‹
 
´ediùiÚ
 
is
 
made
 —ch 
şass
.

265 
In
 
add™iÚ
 
to
 
´ediùšg
 
boxes
 
ªd
 
şas£s
, 
İtiÚ®ly
 
this
 
şass
 
®lows


266 
´ediùšg
 
masks
 
ªd
/
Ü
 
keypošts
 
šside
 
d‘eùiÚ
 
boxes
.

268 
Cu¼’y
 
this
 
box
 
´ediùÜ
 
makes
 
³r
-
şass
 
´ediùiÚs
; 
th©
 
is
, 
—ch


269 
ªchÜ
 
makes
 
a
 
£·¿‹
 
box
 
´ediùiÚ
 
—ch
 
şass
.

272 
def
 
	$__š™__
(
£lf
,

273 
is_Œaššg
,

274 
num_şas£s
,

275 
fc_hy³½¬ams
,

276 
u£_drİout
,

277 
drİout_k“p_´ob
,

278 
box_code_size
,

279 
cÚv_hy³½¬ams
=
NÚe
,

280 
´ediù_š¡ªû_masks
=
F®£
,

281 
mask_´ediùiÚ_cÚv_d•th
=256,

282 
´ediù_keypošts
=
F®£
):

285 
Args
:

286 
is_Œaššg
: 
Indiÿ‹s
 
wh‘h”
 
the
 
BoxP»diùÜ
 
is
 
š
 
Œaššg
 
mode
.

287 
num_şas£s
: 
numb”
 
of
 
şas£s
. 
NÙe
 
th©
‚um_şas£ *
dÛs
 
nÙ
*

288 
šşude
 
the
 
background
 
ÿ‹gÜy
, 
so
 
groundŒuth
 
Ïb–s
 
ke
 
v®ues


289 
š
 {0, 1, .., 
K
-1
	}
}, 
	gnum_şas£s
=K (
ªd
 
nÙ
 K+1, 
ev’
 
though
 
the


290 
assigÃd
 
şassifiÿtiÚ
 
rg‘s
 
ÿn
 
¿nge
 
äom
 {0,... 
K
}).

291 
	gfc_hy³½¬ams
: 
Slim
 
¬g_scİe
 
w™h
 
hy³½¬am‘”s
 
fuÎy


292 
cÚÃùed
 
İs
.

293 
u£_drİout
: 
O±iÚ
 
to
 
u£
 
drİout
 
Ü
 
nÙ
. 
NÙe
 
th©
 
a
 
sšgË
 dropout

294 
İ
 
is
 
­¶›d
 
h”e
 
´iÜ
 
to
 
bÙh
 
box
 
ªd
 
şass
 
´ediùiÚs
, 
which
 
¡ªds


295 
š
 
cÚŒa¡
 
to
 
the
 
CÚvŞutiÚ®BoxP»diùÜ
 
	gb–ow
.

296 
	gdrİout_k“p_´ob
: 
K“p
 
´obab™y
 
drİout
.

297 
This
 
is
 
Úly
 
u£d
 
u£_drİout
 i 
True
.

298 
box_code_size
: 
Size
 
of
 
’codšg
 
—ch
 
box
.

299 
cÚv_hy³½¬ams
: 
Slim
 
¬g_scİe
 
w™h
 
hy³½¬am‘”s
 
cÚvŞutiÚ


300 
İs
.

301 
´ediù_š¡ªû_masks
: 
Wh‘h”
 
to
 
´ediù
 
objeù
 
masks
 
šside
 
d‘eùiÚ


302 
boxes
.

303 
mask_´ediùiÚ_cÚv_d•th
: 
The
 
d•th
 
the
 
fœ¡
 
cÚv2d_Œª¥o£
 
İ


304 
­¶›d
 
to
 
the
 
image_ã©u»s
 
š
h
mask
 
´edic™Ú
 
b¿nch
.

305 
´ediù_keypošts
: 
Wh‘h”
 
to
 
´ediù
 
keypošts
 
šsde
 
d‘eùiÚ
 
boxes
.

308 
Rai£s
:

309 
V®ueE¼Ü
: 
If
 
´ediù_š¡ªû_masks
 
Ü
 
´ediù_keypošts
 
is
 
Œue
.

311 
su³r
(
MaskRCNNBoxP»diùÜ
, 
£lf
).
	$__š™__
(
is_Œaššg
, 
num_şas£s
)

312 
£lf
.
_fc_hy³½¬ams
 = 
fc_hy³½¬ams


313 
£lf
.
_u£_drİout
 = 
u£_drİout


314 
£lf
.
_box_code_size
 = 
box_code_size


315 
£lf
.
_drİout_k“p_´ob
 = 
drİout_k“p_´ob


316 
£lf
.
_cÚv_hy³½¬ams
 = 
cÚv_hy³½¬ams


317 
£lf
.
_´ediù_š¡ªû_masks
 = 
´ediù_š¡ªû_masks


318 
£lf
.
_mask_´ediùiÚ_cÚv_d•th
 = 
mask_´ediùiÚ_cÚv_d•th


319 
£lf
.
_´ediù_keypošts
 = 
´ediù_keypošts


320 
£lf
.
_´ediù_š¡ªû_masks
:

321 
¿i£
 
	`V®ueE¼Ü
('Mask…rediction is unimplemented.')

322 
£lf
.
_´ediù_keypošts
:

323 
¿i£
 
	`V®ueE¼Ü
('Keypoint…rediction is unimplemented.')

324 ià((
£lf
.
_´ediù_š¡ªû_masks
 
Ü
 s–f.
_´ediù_keypošts
è
ªd


325 
£lf
.
_cÚv_hy³½¬ams
 
is
 
NÚe
):

326 
¿i£
 
	`V®ueE¼Ü
('`conv_hyperparams` must be…rovided when…redicting '

329 @
´İ”ty


330 
def
 
	$num_şas£s
(
£lf
):

331  
£lf
.
_num_şas£s


333 
def
 
	$_´ediù
(
£lf
, 
image_ã©u»s
, 
num_´ediùiÚs_³r_loÿtiÚ
):

336 
FÏ‰’s
 
image_ã©u»s
 
ªd
 
­¶›s
 
fuÎy
 
cÚÃùed
 
	`İs
 (
w™h
 
no


337 
nÚ
-
lš—r™y
è
to
 
´ediù
 
box
 
’codšgs
 
ªd
 
şass
 
´ediùiÚs
. 
In
 
this


338 
£‰šg
, 
ªchÜs
 
¬e
 
nÙ
 
¥©ŸÎy
 
¬¿nged
 
š
 
ªy
 
way
 
ªd
‡» 
assumed
 
to


339 
have
 
b“n
 
fŞded
 
što
 
the
 
b©ch
 
dim’siÚ
. 
Thus
 
we
 
ouut
 1 the

340 
ªchÜs
 
dim’siÚ
.

342 
Args
:

343 
image_ã©u»s
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
height
, 
width
,

344 
chªÃls
] 
cÚššg
 
ã©u»s
 
a
 
b©ch
 
of
 
images
.

345 
num_´ediùiÚs_³r_loÿtiÚ
: 
ª
 
š‹g”
 
»´e£Ášg
 
the
 
numb”
 
of
 
box


346 
´ediùiÚs
 
to
 
be
 
made
 
³r
 
¥©Ÿl
 
loÿtiÚ
 
š
 
the
 
ã©u»
 
m­
.

347 
Cu¼’y
, 
this
 
mu¡
 
be
 
£t
 
to
 1, 
Ü
 
ª
 
”rÜ
 
wl
 b
¿i£d
.

349 
R‘uºs
:

350 
A
 
diùiÚ¬y
 
cÚššg
 
the
 
fŞlowšg
 
‹nsÜs
.

351 
box_’codšgs
: 
A
 
‹nsÜ
 
of
 
sh­e


352 [
b©ch_size
, 1, 
num_şas£s
, 
code_size
] 
»´e£Ášg
 
the


353 
loÿtiÚ
 
of
 
the
 
objeùs
.

354 
şass_´ediùiÚs_w™h_background
: 
A
 
‹nsÜ
 
of
 
sh­e


355 [
b©ch_size
, 1, 
num_şas£s
 + 1] 
»´e£Ášg
 
the
 
şass


356 
´ediùiÚs
 
the
 
´İo§ls
.

357 
If
 
´ediù_masks
 
is
 
True
 
the
 
diùiÚ¬y
 
®so
 
cÚšs
:

358 
š¡ªû_masks
: 
A
 
‹nsÜ
 
of
 
sh­e


359 [
b©ch_size
, 1, 
num_şas£s
, 
image_height
, 
image_width
]

360 
If
 
´ediù_keypošts
 
is
 
True
 
the
 
diùiÚ¬y
 
®so
 
cÚšs
:

361 
keypošts
: [
b©ch_size
, 1, 
num_keypošts
, 2]

363 
Rai£s
:

364 
V®ueE¼Ü
: 
num_´ediùiÚs_³r_loÿtiÚ
 
is
 
nÙ
 1.

366 
num_´ediùiÚs_³r_loÿtiÚ
 != 1:

367 
¿i£
 
	`V®ueE¼Ü
('Currently FullyConnectedBoxPredictor only supports '

369 
¥©Ÿl_av”aged_image_ã©u»s
 = 
tf
.
	`»duû_m—n
(
image_ã©u»s
, [1, 2],

370 
k“p_dims
=
True
,

371 
Çme
='AvgPool')

372 
æ©‹Ãd_image_ã©u»s
 = 
¦im
.
	$æ©‹n
(
¥©Ÿl_av”aged_image_ã©u»s
)

373 
£lf
.
_u£_drİout
:

374 
æ©‹Ãd_image_ã©u»s
 = 
¦im
.
	$drİout
(
æ©‹Ãd_image_ã©u»s
,

375 
k“p_´ob
=
£lf
.
_drİout_k“p_´ob
,

376 
is_Œaššg
=
£lf
.
_is_Œaššg
)

377 
w™h
 
¦im
.
	$¬g_scİe
(
£lf
.
_fc_hy³½¬ams
):

378 
box_’codšgs
 = 
¦im
.
	`fuÎy_cÚÃùed
(

379 
æ©‹Ãd_image_ã©u»s
,

380 
£lf
.
_num_şas£s
 * s–f.
_box_code_size
,

381 
aùiv©iÚ_â
=
NÚe
,

382 
scİe
='BoxEncodingPredictor')

383 
şass_´ediùiÚs_w™h_background
 = 
¦im
.
	`fuÎy_cÚÃùed
(

384 
æ©‹Ãd_image_ã©u»s
,

385 
£lf
.
_num_şas£s
 + 1,

386 
aùiv©iÚ_â
=
NÚe
,

387 
scİe
='ClassPredictor')

388 
box_’codšgs
 = 
tf
.
	`»sh­e
(

389 
box_’codšgs
, [-1, 1, 
£lf
.
_num_şas£s
, s–f.
_box_code_size
])

390 
şass_´ediùiÚs_w™h_background
 = 
tf
.
	`»sh­e
(

391 
şass_´ediùiÚs_w™h_background
, [-1, 1, 
£lf
.
_num_şas£s
 + 1])

393 
´ediùiÚs_diù
 = {

394 
BOX_ENCODINGS
: 
box_’codšgs
,

395 
CLASS_PREDICTIONS_WITH_BACKGROUND
: 
şass_´ediùiÚs_w™h_background


396 
	}
}

398 
£lf
.
_´ediù_š¡ªû_masks
:

399 
w™h
 
¦im
.
	$¬g_scİe
(
£lf
.
_cÚv_hy³½¬ams
):

400 
up§m¶ed_ã©u»s
 = 
¦im
.
	$cÚv2d_Œª¥o£
(

401 
image_ã©u»s
,

402 
num_ouuts
=
£lf
.
_mask_´ediùiÚ_cÚv_d•th
,

403 
k”Ãl_size
=[2, 2],

404 
¡ride
=2)

405 
mask_´ediùiÚs
 = 
¦im
.
	$cÚv2d
(
up§m¶ed_ã©u»s
,

406 
num_ouuts
=
£lf
.
num_şas£s
,

407 
aùiv©iÚ_â
=
NÚe
,

408 
k”Ãl_size
=[1, 1])

409 
š¡ªû_masks
 = 
tf
.
	`ex·nd_dims
Ñf.
	`Œª¥o£
(
mask_´ediùiÚs
,

410 
³rm
=[0, 3, 1, 2]),

411 
axis
=1,

412 
Çme
='MaskPredictor')

413 
´ediùiÚs_diù
[
MASK_PREDICTIONS
] = 
š¡ªû_masks


414  
´ediùiÚs_diù


417 
şass
 
	$CÚvŞutiÚ®BoxP»diùÜ
(
BoxP»diùÜ
):

420 
O±iÚ®ly
 
add
 
ª
 
š‹rmedŸ‹
 1x1 
cÚvŞutiÚ®
 
Ïy”
 
aá”
 
ã©u»s
 
ªd


421 
´ediù
 
š
 
·¿Î–
 
b¿nches
 
box_’codšgs
 
ªd


422 
şass_´ediùiÚs_w™h_background
.

424 
Cu¼’y
 
this
 
box
 
´ediùÜ
 
assumes
 
th©
 
´ediùiÚs
 
¬e
 "sh¬ed" 
aüoss


425 
şas£s
 --- 
th©
 
is
 
—ch
 
ªchÜ
 
makes
 
box
 
´ediùiÚs
 
which
 dØ
nÙ
 
d•’d


426 
Ú
 
şass
.

429 
def
 
	$__š™__
(
£lf
,

430 
is_Œaššg
,

431 
num_şas£s
,

432 
cÚv_hy³½¬ams
,

433 
mš_d•th
,

434 
max_d•th
,

435 
num_Ïy”s_befÜe_´ediùÜ
,

436 
u£_drİout
,

437 
drİout_k“p_´ob
,

438 
k”Ãl_size
,

439 
box_code_size
,

440 
­¶y_sigmoid_to_scÜes
=
F®£
):

443 
Args
:

444 
is_Œaššg
: 
Indiÿ‹s
 
wh‘h”
 
the
 
BoxP»diùÜ
 
is
 
š
 
Œaššg
 
mode
.

445 
num_şas£s
: 
numb”
 
of
 
şas£s
. 
NÙe
 
th©
‚um_şas£ *
dÛs
 
nÙ
*

446 
šşude
 
the
 
background
 
ÿ‹gÜy
, 
so
 
groundŒuth
 
Ïb–s
 
ke
 
v®ues


447 
š
 {0, 1, .., 
K
-1
	}
}, 
	gnum_şas£s
=K (
ªd
 
nÙ
 K+1, 
ev’
 
though
 
the


448 
assigÃd
 
şassifiÿtiÚ
 
rg‘s
 
ÿn
 
¿nge
 
äom
 {0,... 
K
}).

449 
	gcÚv_hy³½¬ams
: 
Slim
 
¬g_scİe
 
w™h
 
hy³½¬am‘”s
 
cÚvŞutiÚ
 
İs
.

450 
mš_d•th
: 
Mšumum
 
ã©u»
 
d•th
 
´iÜ
 
to
 
´ediùšg
 
box
 
’codšgs


451 
ªd
 
şass
 
´ediùiÚs
.

452 
max_d•th
: 
Maximum
 
ã©u»
 
d•th
 
´iÜ
 
to
 
´ediùšg
 
box
 
’codšgs


453 
ªd
 
şass
 
´ediùiÚs
. 
If
 
max_d•th
 
is
 
£t
 
to
 0, 
no
 
add™iÚ®


454 
ã©u»
 
m­
 
wl
 
be
 
š£¹ed
 
befÜe
 
loÿtiÚ
 
ªd
 
şass
 
	g´ediùiÚs
.

455 
	gnum_Ïy”s_befÜe_´ediùÜ
: 
Numb”
 
of
 
the
 
add™iÚ®
 
cÚv
 
Ïy”s
 
befÜe


456 
the
 
´ediùÜ
.

457 
u£_drİout
: 
O±iÚ
 
to
 
u£
 
drİout
 
şass
 
´ediùiÚ
 
Ü
 
nÙ
.

458 
drİout_k“p_´ob
: 
K“p
 
´obab™y
 
drİout
.

459 
This
 
is
 
Úly
 
u£d
 
u£_drİout
 i 
True
.

460 
k”Ãl_size
: 
Size
 
of
 
fš®
 
cÚvŞutiÚ
 
k”Ãl
. 
If
 
the


461 
¥©Ÿl
 
»sŞutiÚ
 
of
 
the
 
ã©u»
 
m­
 
is
 
sm®Ër
 
thª
h
k”Ãl
 
size
,

462 
th’
 
the
 
k”Ãl
 
size
 
is
 
autom©iÿÎy
 
£t
 
to
 
be


463 
mš
(
ã©u»_width
, 
ã©u»_height
).

464 
	gbox_code_size
: 
Size
 
of
 
’codšg
 
—ch
 
box
.

465 
­¶y_sigmoid_to_scÜes
: 
True
, 
­¶y
 
the
 
sigmoid
 
Ú
h
ouut


466 
	gşass_´ediùiÚs
.

468 
	gRai£s
:

469 
V®ueE¼Ü
: 
mš_d•th
 > 
max_d•th
.

471 
su³r
(
CÚvŞutiÚ®BoxP»diùÜ
, 
£lf
).
	$__š™__
(
is_Œaššg
, 
num_şas£s
)

472 
mš_d•th
 > 
max_d•th
:

473 
¿i£
 
	`V®ueE¼Ü
('min_depth should be†esshan orƒqualo max_depth')

474 
£lf
.
_cÚv_hy³½¬ams
 = 
cÚv_hy³½¬ams


475 
£lf
.
_mš_d•th
 = 
mš_d•th


476 
£lf
.
_max_d•th
 = 
max_d•th


477 
£lf
.
_num_Ïy”s_befÜe_´ediùÜ
 = 
num_Ïy”s_befÜe_´ediùÜ


478 
£lf
.
_u£_drİout
 = 
u£_drİout


479 
£lf
.
_k”Ãl_size
 = 
k”Ãl_size


480 
£lf
.
_box_code_size
 = 
box_code_size


481 
£lf
.
_drİout_k“p_´ob
 = 
drİout_k“p_´ob


482 
£lf
.
_­¶y_sigmoid_to_scÜes
 = 
­¶y_sigmoid_to_scÜes


484 
def
 
	$_´ediù
(
£lf
, 
image_ã©u»s
, 
num_´ediùiÚs_³r_loÿtiÚ
):

487 
Args
:

488 
image_ã©u»s
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
height
, 
width
,

489 
chªÃls
] 
cÚššg
 
ã©u»s
 
a
 
b©ch
 
of
 
images
.

490 
num_´ediùiÚs_³r_loÿtiÚ
: 
ª
 
š‹g”
 
»´e£Ášg
 
the
 
numb”
 
of
 
box


491 
´ediùiÚs
 
to
 
be
 
made
 
³r
 
¥©Ÿl
 
loÿtiÚ
 
š
 
the
 
ã©u»
 
m­
.

493 
R‘uºs
:

494 
A
 
diùiÚ¬y
 
cÚššg
 
the
 
fŞlowšg
 
‹nsÜs
.

495 
box_’codšgs
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
, 1,

496 
code_size
] 
»´e£Ášg
 
the
 
loÿtiÚ
 
of
h
objeùs
, 
wh”e


497 
num_ªchÜs
 = 
ã©_height
 * 
ã©_width
 * 
num_´ediùiÚs_³r_loÿtiÚ


498 
şass_´ediùiÚs_w™h_background
: 
A
 
‹nsÜ
 
of
 
sh­e


499 [
b©ch_size
, 
num_ªchÜs
, 
num_şas£s
 + 1] 
»´e£Ášg
 
the
 
şass


500 
´ediùiÚs
 
the
 
´İo§ls
.

502 
ã©u»s_d•th
 = 
¡©ic_sh­e
.
	`g‘_d•th
(
image_ã©u»s
.
	$g‘_sh­e
())

503 
d•th
 = 
	`max
(
	`mš
(
ã©u»s_d•th
, 
£lf
.
_max_d•th
), s–f.
_mš_d•th
)

505 #Add 
a
 
¦Ù
 
the
 
background
 
şass
.

506 
num_şass_¦Ùs
 = 
£lf
.
num_şas£s
 + 1

507 
Ãt
 = 
image_ã©u»s


508 
w™h
 
¦im
.
	`¬g_scİe
(
£lf
.
_cÚv_hy³½¬ams
), \

509 
¦im
.
	$¬g_scİe
([
¦im
.
drİout
], 
is_Œaššg
=
£lf
.
_is_Œaššg
):

510 #Add 
add™iÚ®
 
cÚv
 
Ïy”s
 
befÜe
 
the
 
´ediùÜ
.

511 
d•th
 > 0 
ªd
 
£lf
.
_num_Ïy”s_befÜe_´ediùÜ
 > 0:

512 
i
 
š
 
	$¿nge
(
£lf
.
_num_Ïy”s_befÜe_´ediùÜ
):

513 
Ãt
 = 
¦im
.
	`cÚv2d
(

514 
Ãt
, 
d•th
, [1, 1], 
scİe
='CÚv2d_%d_1x1_%d' % (
i
, depth))

515 
w™h
 
¦im
.
	$¬g_scİe
([
¦im
.
cÚv2d
], 
aùiv©iÚ_â
=
NÚe
,

516 
nÜm®iz”_â
=
NÚe
, 
nÜm®iz”_·¿ms
=None):

517 
box_’codšgs
 = 
¦im
.
	`cÚv2d
(

518 
Ãt
, 
num_´ediùiÚs_³r_loÿtiÚ
 * 
£lf
.
_box_code_size
,

519 [
£lf
.
_k”Ãl_size
, self._kernel_size],

520 
scİe
='BoxEncodingPredictor')

521 
£lf
.
_u£_drİout
:

522 
Ãt
 = 
¦im
.
	$drİout
(
Ãt
, 
k“p_´ob
=
£lf
.
_drİout_k“p_´ob
)

523 
şass_´ediùiÚs_w™h_background
 = 
¦im
.
	`cÚv2d
(

524 
Ãt
, 
num_´ediùiÚs_³r_loÿtiÚ
 * 
num_şass_¦Ùs
,

525 [
£lf
.
_k”Ãl_size
, s–f._k”Ãl_size], 
scİe
='ClassPredictor')

526 
£lf
.
_­¶y_sigmoid_to_scÜes
:

527 
şass_´ediùiÚs_w™h_background
 = 
tf
.
	$sigmoid
(

528 
şass_´ediùiÚs_w™h_background
)

530 
combšed_ã©u»_m­_sh­e
 = 
sh­e_uts
.
	$combšed_¡©ic_ªd_dyÇmic_sh­e
(

531 
image_ã©u»s
)

532 
box_’codšgs
 = 
tf
.
	`»sh­e
(

533 
box_’codšgs
, 
tf
.
	$¡ack
([
combšed_ã©u»_m­_sh­e
[0],

534 
combšed_ã©u»_m­_sh­e
[1] *

535 
combšed_ã©u»_m­_sh­e
[2] *

536 
num_´ediùiÚs_³r_loÿtiÚ
,

537 1, 
£lf
.
_box_code_size
]))

538 
şass_´ediùiÚs_w™h_background
 = 
tf
.
	`»sh­e
(

539 
şass_´ediùiÚs_w™h_background
,

540 
tf
.
	$¡ack
([
combšed_ã©u»_m­_sh­e
[0],

541 
combšed_ã©u»_m­_sh­e
[1] *

542 
combšed_ã©u»_m­_sh­e
[2] *

543 
num_´ediùiÚs_³r_loÿtiÚ
,

544 
num_şass_¦Ùs
]))

545  {
BOX_ENCODINGS
: 
box_’codšgs
,

546 
CLASS_PREDICTIONS_WITH_BACKGROUND
:

547 
şass_´ediùiÚs_w™h_background
}

	@core/box_predictor_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
numpy
 
as
 
Å


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	ggoogË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


22 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
hy³½¬ams_bud”


23 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_´ediùÜ


24 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
hy³½¬ams_pb2


27 
şass
 
	$MaskRCNNBoxP»diùÜTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

29 
def
 
	$_bud_¬g_scİe_w™h_hy³½¬ams
(
£lf
,

30 
İ_ty³
=
hy³½¬ams_pb2
.
Hy³½¬ams
.
FC
):

31 
hy³½¬ams
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

32 
hy³½¬ams_‹xt_´Ùo
 = """

33 
aùiv©iÚ
: 
NONE


34 
»guÏriz”
 {

35 
l2_»guÏriz”
 {

37 
	}
}

38 
š™Ÿliz”
 {

39 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

43 
‹xt_fÜm©
.
	$M”ge
(
hy³½¬ams_‹xt_´Ùo
, 
hy³½¬ams
)

44 
hy³½¬ams
.
İ
 = 
İ_ty³


45  
hy³½¬ams_bud”
.
	$bud
(
hy³½¬ams
, 
is_Œaššg
=
True
)

47 
def
 
	$‹¡_g‘_boxes_w™h_five_şas£s
(
£lf
):

48 
image_ã©u»s
 = 
tf
.
	$¿ndom_unifÜm
([2, 7, 7, 3], 
dty³
=
tf
.
æßt32
)

49 
mask_box_´ediùÜ
 = 
box_´ediùÜ
.
	`MaskRCNNBoxP»diùÜ
(

50 
is_Œaššg
=
F®£
,

51 
num_şas£s
=5,

52 
fc_hy³½¬ams
=
£lf
.
	`_bud_¬g_scİe_w™h_hy³½¬ams
(),

53 
u£_drİout
=
F®£
,

54 
drİout_k“p_´ob
=0.5,

55 
box_code_size
=4,

57 
box_´ediùiÚs
 = 
mask_box_´ediùÜ
.
	`´ediù
(

58 
image_ã©u»s
, 
num_´ediùiÚs_³r_loÿtiÚ
=1, 
scİe
='BoxPredictor')

59 
box_’codšgs
 = 
box_´ediùiÚs
[
box_´ediùÜ
.
BOX_ENCODINGS
]

60 
şass_´ediùiÚs_w™h_background
 = 
box_´ediùiÚs
[

61 
box_´ediùÜ
.
CLASS_PREDICTIONS_WITH_BACKGROUND
]

62 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

63 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

64 
£ss
.
	$run
(
š™_İ
)

65 (
box_’codšgs_sh­e
,

66 
şass_´ediùiÚs_w™h_background_sh­e
èğ
£ss
.
	`run
(

67 [
tf
.
	`sh­e
(
box_’codšgs
),

68 
tf
.
	`sh­e
(
şass_´ediùiÚs_w™h_background
)])

69 
£lf
.
	$as£¹AÎEqu®
(
box_’codšgs_sh­e
, [2, 1, 5, 4])

70 
£lf
.
	$as£¹AÎEqu®
(
şass_´ediùiÚs_w™h_background_sh­e
, [2, 1, 6])

72 
def
 
	$‹¡_v®ue_”rÜ_Ú_´ediù_š¡ªû_masks_w™h_no_cÚv_hy³½¬ms
(
£lf
):

73 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

74 
box_´ediùÜ
.
	`MaskRCNNBoxP»diùÜ
(

75 
is_Œaššg
=
F®£
,

76 
num_şas£s
=5,

77 
fc_hy³½¬ams
=
£lf
.
	`_bud_¬g_scİe_w™h_hy³½¬ams
(),

78 
u£_drİout
=
F®£
,

79 
drİout_k“p_´ob
=0.5,

80 
box_code_size
=4,

81 
´ediù_š¡ªû_masks
=
True
)

83 
def
 
	$‹¡_g‘_š¡ªû_masks
(
£lf
):

84 
image_ã©u»s
 = 
tf
.
	$¿ndom_unifÜm
([2, 7, 7, 3], 
dty³
=
tf
.
æßt32
)

85 
mask_box_´ediùÜ
 = 
box_´ediùÜ
.
	`MaskRCNNBoxP»diùÜ
(

86 
is_Œaššg
=
F®£
,

87 
num_şas£s
=5,

88 
fc_hy³½¬ams
=
£lf
.
	`_bud_¬g_scİe_w™h_hy³½¬ams
(),

89 
u£_drİout
=
F®£
,

90 
drİout_k“p_´ob
=0.5,

91 
box_code_size
=4,

92 
cÚv_hy³½¬ams
=
£lf
.
	`_bud_¬g_scİe_w™h_hy³½¬ams
(

93 
İ_ty³
=
hy³½¬ams_pb2
.
Hy³½¬ams
.
CONV
),

94 
´ediù_š¡ªû_masks
=
True
)

95 
box_´ediùiÚs
 = 
mask_box_´ediùÜ
.
	`´ediù
(

96 
image_ã©u»s
, 
num_´ediùiÚs_³r_loÿtiÚ
=1, 
scİe
='BoxPredictor')

97 
mask_´ediùiÚs
 = 
box_´ediùiÚs
[
box_´ediùÜ
.
MASK_PREDICTIONS
]

98 
£lf
.
	`as£¹Li¡Equ®
([2, 1, 5, 14, 14],

99 
mask_´ediùiÚs
.
	`g‘_sh­e
().
	$as_li¡
())

101 
def
 
	$‹¡_do_nÙ_»tuº_š¡ªû_masks_ªd_keypošts_w™hout_»que¡
(
£lf
):

102 
image_ã©u»s
 = 
tf
.
	$¿ndom_unifÜm
([2, 7, 7, 3], 
dty³
=
tf
.
æßt32
)

103 
mask_box_´ediùÜ
 = 
box_´ediùÜ
.
	`MaskRCNNBoxP»diùÜ
(

104 
is_Œaššg
=
F®£
,

105 
num_şas£s
=5,

106 
fc_hy³½¬ams
=
£lf
.
	`_bud_¬g_scİe_w™h_hy³½¬ams
(),

107 
u£_drİout
=
F®£
,

108 
drİout_k“p_´ob
=0.5,

109 
box_code_size
=4)

110 
box_´ediùiÚs
 = 
mask_box_´ediùÜ
.
	`´ediù
(

111 
image_ã©u»s
, 
num_´ediùiÚs_³r_loÿtiÚ
=1, 
scİe
='BoxPredictor')

112 
£lf
.
	`as£¹Equ®
(
	`Ën
(
box_´ediùiÚs
), 2)

113 
£lf
.
	$as£¹True
(
box_´ediùÜ
.
BOX_ENCODINGS
 
š
 
box_´ediùiÚs
)

114 
£lf
.
	$as£¹True
(
box_´ediùÜ
.
CLASS_PREDICTIONS_WITH_BACKGROUND


115 
š
 
box_´ediùiÚs
)

117 
def
 
	$‹¡_v®ue_”rÜ_Ú_´ediù_keypošts
(
£lf
):

118 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

119 
box_´ediùÜ
.
	`MaskRCNNBoxP»diùÜ
(

120 
is_Œaššg
=
F®£
,

121 
num_şas£s
=5,

122 
fc_hy³½¬ams
=
£lf
.
	`_bud_¬g_scİe_w™h_hy³½¬ams
(),

123 
u£_drİout
=
F®£
,

124 
drİout_k“p_´ob
=0.5,

125 
box_code_size
=4,

126 
´ediù_keypošts
=
True
)

129 
şass
 
	$RfúBoxP»diùÜTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

131 
def
 
	$_bud_¬g_scİe_w™h_cÚv_hy³½¬ams
(
£lf
):

132 
cÚv_hy³½¬ams
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

133 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

134 
»guÏriz”
 {

135 
l2_»guÏriz”
 {

137 
	}
}

138 
š™Ÿliz”
 {

139 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

143 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams
)

144  
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams
, 
is_Œaššg
=
True
)

146 
def
 
	$‹¡_g‘_cÜ»ù_box_’codšg_ªd_şass_´ediùiÚ_sh­es
(
£lf
):

147 
image_ã©u»s
 = 
tf
.
	$¿ndom_unifÜm
([4, 8, 8, 64], 
dty³
=
tf
.
æßt32
)

148 
´İo§l_boxes
 = 
tf
.
	$¿ndom_nÜm®
([4, 2, 4], 
dty³
=
tf
.
æßt32
)

149 
rfú_box_´ediùÜ
 = 
box_´ediùÜ
.
	`RfúBoxP»diùÜ
(

150 
is_Œaššg
=
F®£
,

151 
num_şas£s
=2,

152 
cÚv_hy³½¬ams
=
£lf
.
	`_bud_¬g_scİe_w™h_cÚv_hy³½¬ams
(),

153 
num_¥©Ÿl_bšs
=[3, 3],

154 
d•th
=4,

155 
üİ_size
=[12, 12],

156 
box_code_size
=4

158 
box_´ediùiÚs
 = 
rfú_box_´ediùÜ
.
	`´ediù
(

159 
image_ã©u»s
, 
num_´ediùiÚs_³r_loÿtiÚ
=1, 
scİe
='BoxPredictor',

160 
´İo§l_boxes
=proposal_boxes)

161 
box_’codšgs
 = 
box_´ediùiÚs
[
box_´ediùÜ
.
BOX_ENCODINGS
]

162 
şass_´ediùiÚs_w™h_background
 = 
box_´ediùiÚs
[

163 
box_´ediùÜ
.
CLASS_PREDICTIONS_WITH_BACKGROUND
]

165 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

166 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

167 
£ss
.
	$run
(
š™_İ
)

168 (
box_’codšgs_sh­e
,

169 
şass_´ediùiÚs_sh­e
èğ
£ss
.
	`run
(

170 [
tf
.
	`sh­e
(
box_’codšgs
),

171 
tf
.
	`sh­e
(
şass_´ediùiÚs_w™h_background
)])

172 
£lf
.
	$as£¹AÎEqu®
(
box_’codšgs_sh­e
, [8, 1, 2, 4])

173 
£lf
.
	$as£¹AÎEqu®
(
şass_´ediùiÚs_sh­e
, [8, 1, 3])

176 
şass
 
	$CÚvŞutiÚ®BoxP»diùÜTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

178 
def
 
	$_bud_¬g_scİe_w™h_cÚv_hy³½¬ams
(
£lf
):

179 
cÚv_hy³½¬ams
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

180 
cÚv_hy³½¬ams_‹xt_´Ùo
 = """

181 
aùiv©iÚ
: 
RELU_6


182 
»guÏriz”
 {

183 
l2_»guÏriz”
 {

185 
	}
}

186 
š™Ÿliz”
 {

187 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

191 
‹xt_fÜm©
.
	$M”ge
(
cÚv_hy³½¬ams_‹xt_´Ùo
, 
cÚv_hy³½¬ams
)

192  
hy³½¬ams_bud”
.
	$bud
(
cÚv_hy³½¬ams
, 
is_Œaššg
=
True
)

194 
def
 
	$‹¡_g‘_boxes_fÜ_five_a¥eù_¿tios_³r_loÿtiÚ
(
£lf
):

195 
image_ã©u»s
 = 
tf
.
	$¿ndom_unifÜm
([4, 8, 8, 64], 
dty³
=
tf
.
æßt32
)

196 
cÚv_box_´ediùÜ
 = 
box_´ediùÜ
.
	`CÚvŞutiÚ®BoxP»diùÜ
(

197 
is_Œaššg
=
F®£
,

198 
num_şas£s
=0,

199 
cÚv_hy³½¬ams
=
£lf
.
	`_bud_¬g_scİe_w™h_cÚv_hy³½¬ams
(),

200 
mš_d•th
=0,

201 
max_d•th
=32,

202 
num_Ïy”s_befÜe_´ediùÜ
=1,

203 
u£_drİout
=
True
,

204 
drİout_k“p_´ob
=0.8,

205 
k”Ãl_size
=1,

206 
box_code_size
=4

208 
box_´ediùiÚs
 = 
cÚv_box_´ediùÜ
.
	`´ediù
(

209 
image_ã©u»s
, 
num_´ediùiÚs_³r_loÿtiÚ
=5, 
scİe
='BoxPredictor')

210 
box_’codšgs
 = 
box_´ediùiÚs
[
box_´ediùÜ
.
BOX_ENCODINGS
]

211 
objeùÃss_´ediùiÚs
 = 
box_´ediùiÚs
[

212 
box_´ediùÜ
.
CLASS_PREDICTIONS_WITH_BACKGROUND
]

214 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

215 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

216 
£ss
.
	$run
(
š™_İ
)

217 (
box_’codšgs_sh­e
,

218 
objeùÃss_´ediùiÚs_sh­e
èğ
£ss
.
	`run
(

219 [
tf
.
	`sh­e
(
box_’codšgs
),f.sh­e(
objeùÃss_´ediùiÚs
)])

220 
£lf
.
	$as£¹AÎEqu®
(
box_’codšgs_sh­e
, [4, 320, 1, 4])

221 
£lf
.
	$as£¹AÎEqu®
(
objeùÃss_´ediùiÚs_sh­e
, [4, 320, 1])

223 
def
 
	$‹¡_g‘_boxes_fÜ_Úe_a¥eù_¿tio_³r_loÿtiÚ
(
£lf
):

224 
image_ã©u»s
 = 
tf
.
	$¿ndom_unifÜm
([4, 8, 8, 64], 
dty³
=
tf
.
æßt32
)

225 
cÚv_box_´ediùÜ
 = 
box_´ediùÜ
.
	`CÚvŞutiÚ®BoxP»diùÜ
(

226 
is_Œaššg
=
F®£
,

227 
num_şas£s
=0,

228 
cÚv_hy³½¬ams
=
£lf
.
	`_bud_¬g_scİe_w™h_cÚv_hy³½¬ams
(),

229 
mš_d•th
=0,

230 
max_d•th
=32,

231 
num_Ïy”s_befÜe_´ediùÜ
=1,

232 
u£_drİout
=
True
,

233 
drİout_k“p_´ob
=0.8,

234 
k”Ãl_size
=1,

235 
box_code_size
=4

237 
box_´ediùiÚs
 = 
cÚv_box_´ediùÜ
.
	`´ediù
(

238 
image_ã©u»s
, 
num_´ediùiÚs_³r_loÿtiÚ
=1, 
scİe
='BoxPredictor')

239 
box_’codšgs
 = 
box_´ediùiÚs
[
box_´ediùÜ
.
BOX_ENCODINGS
]

240 
objeùÃss_´ediùiÚs
 = 
box_´ediùiÚs
[

241 
box_´ediùÜ
.
CLASS_PREDICTIONS_WITH_BACKGROUND
]

243 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

244 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

245 
£ss
.
	$run
(
š™_İ
)

246 (
box_’codšgs_sh­e
,

247 
objeùÃss_´ediùiÚs_sh­e
èğ
£ss
.
	`run
(

248 [
tf
.
	`sh­e
(
box_’codšgs
),f.sh­e(
objeùÃss_´ediùiÚs
)])

249 
£lf
.
	$as£¹AÎEqu®
(
box_’codšgs_sh­e
, [4, 64, 1, 4])

250 
£lf
.
	$as£¹AÎEqu®
(
objeùÃss_´ediùiÚs_sh­e
, [4, 64, 1])

252 
def
 
	$‹¡_g‘_muÉi_şass_´ediùiÚs_fÜ_five_a¥eù_¿tios_³r_loÿtiÚ
(

253 
£lf
):

254 
num_şas£s_w™hout_background
 = 6

255 
image_ã©u»s
 = 
tf
.
	$¿ndom_unifÜm
([4, 8, 8, 64], 
dty³
=
tf
.
æßt32
)

256 
cÚv_box_´ediùÜ
 = 
box_´ediùÜ
.
	`CÚvŞutiÚ®BoxP»diùÜ
(

257 
is_Œaššg
=
F®£
,

258 
num_şas£s
=
num_şas£s_w™hout_background
,

259 
cÚv_hy³½¬ams
=
£lf
.
	`_bud_¬g_scİe_w™h_cÚv_hy³½¬ams
(),

260 
mš_d•th
=0,

261 
max_d•th
=32,

262 
num_Ïy”s_befÜe_´ediùÜ
=1,

263 
u£_drİout
=
True
,

264 
drİout_k“p_´ob
=0.8,

265 
k”Ãl_size
=1,

266 
box_code_size
=4

268 
box_´ediùiÚs
 = 
cÚv_box_´ediùÜ
.
	`´ediù
(

269 
image_ã©u»s
,

270 
num_´ediùiÚs_³r_loÿtiÚ
=5,

271 
scİe
='BoxPredictor')

272 
box_’codšgs
 = 
box_´ediùiÚs
[
box_´ediùÜ
.
BOX_ENCODINGS
]

273 
şass_´ediùiÚs_w™h_background
 = 
box_´ediùiÚs
[

274 
box_´ediùÜ
.
CLASS_PREDICTIONS_WITH_BACKGROUND
]

276 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

277 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

278 
£ss
.
	$run
(
š™_İ
)

279 (
box_’codšgs_sh­e
, 
şass_´ediùiÚs_w™h_background_sh­e


280 èğ
£ss
.
	`run
([

281 
tf
.
	`sh­e
(
box_’codšgs
),f.sh­e(
şass_´ediùiÚs_w™h_background
)])

282 
£lf
.
	$as£¹AÎEqu®
(
box_’codšgs_sh­e
, [4, 320, 1, 4])

283 
£lf
.
	`as£¹AÎEqu®
(
şass_´ediùiÚs_w™h_background_sh­e
,

284 [4, 320, 
num_şas£s_w™hout_background
+1])

286 
def
 
	$‹¡_g‘_boxes_fÜ_five_a¥eù_¿tios_³r_loÿtiÚ_fuÎy_cÚvŞutiÚ®
(

287 
£lf
):

288 
image_ã©u»s
 = 
tf
.
	$¶aûhŞd”
(
dty³
=
tf
.
æßt32
, 
sh­e
=[4, 
NÚe
, None, 64])

289 
cÚv_box_´ediùÜ
 = 
box_´ediùÜ
.
	`CÚvŞutiÚ®BoxP»diùÜ
(

290 
is_Œaššg
=
F®£
,

291 
num_şas£s
=0,

292 
cÚv_hy³½¬ams
=
£lf
.
	`_bud_¬g_scİe_w™h_cÚv_hy³½¬ams
(),

293 
mš_d•th
=0,

294 
max_d•th
=32,

295 
num_Ïy”s_befÜe_´ediùÜ
=1,

296 
u£_drİout
=
True
,

297 
drİout_k“p_´ob
=0.8,

298 
k”Ãl_size
=1,

299 
box_code_size
=4

301 
box_´ediùiÚs
 = 
cÚv_box_´ediùÜ
.
	`´ediù
(

302 
image_ã©u»s
, 
num_´ediùiÚs_³r_loÿtiÚ
=5, 
scİe
='BoxPredictor')

303 
box_’codšgs
 = 
box_´ediùiÚs
[
box_´ediùÜ
.
BOX_ENCODINGS
]

304 
objeùÃss_´ediùiÚs
 = 
box_´ediùiÚs
[

305 
box_´ediùÜ
.
CLASS_PREDICTIONS_WITH_BACKGROUND
]

306 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

308 
»sŞutiÚ
 = 32

309 
ex³ùed_num_ªchÜs
 = 
»sŞutiÚ
*resolution*5

310 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

311 
£ss
.
	$run
(
š™_İ
)

312 (
box_’codšgs_sh­e
,

313 
objeùÃss_´ediùiÚs_sh­e
èğ
£ss
.
	`run
(

314 [
tf
.
	`sh­e
(
box_’codšgs
),f.sh­e(
objeùÃss_´ediùiÚs
)],

315 
ãed_diù
={
image_ã©u»s
:

316 
Å
.
¿ndom
.
	`¿nd
(4, 
»sŞutiÚ
,„esŞutiÚ, 64)
	}
})

317 
£lf
.
	$as£¹AÎEqu®
(
box_’codšgs_sh­e
, [4, 
ex³ùed_num_ªchÜs
, 1, 4])

318 
£lf
.
	$as£¹AÎEqu®
(
objeùÃss_´ediùiÚs_sh­e
,

319 [4, 
ex³ùed_num_ªchÜs
, 1])

322 
__Çme__
 == '__main__':

323 
tf
.
‹¡
.
	`maš
()

	@core/data_decoder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
D©a
 
decod”s
 
decode
 
the
 
šput
 
d©a
 
ªd
  
a
 
diùiÚ¬y
 
of
 
‹nsÜs
 
keyed
 
by


19 
the
 
’Œ›s
 
š
 
	gcÜe
.
	g»ad”
.
	gF›lds
.

21 
äom
 
abc
 
impÜt
 
ABCM‘a


22 
äom
 
abc
 
impÜt
 
ab¡¿ùm‘hod


25 
şass
 
	$D©aDecod”
(
objeù
):

27 
__m‘aşass__
 = 
ABCM‘a


29 @
ab¡¿ùm‘hod


30 
def
 
	$decode
(
£lf
, 
d©a
):

33 
Args
:

34 
d©a
: 
a
 
¡ršg
 
‹nsÜ
 
hŞdšg
‡ 
£rŸlized
 
´ÙocŞ
 
bufãr
 
cÜ»¥Údšg


35 
to
 
d©a
 
a
 
sšgË
 
image
.

37 
R‘uºs
:

38 
‹nsÜ_diù
: 
a
 
diùiÚ¬y
 
cÚššg
 
‹nsÜs
. 
PossibË
 
keys
 
¬e
 
defšed
 
š


39 
»ad”
.
F›lds
.

41 
·ss


	@core/keypoint_ops.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
Keypošts
 
¬e
 
»´e£Áed
 
as
 
‹nsÜs
 
of
 
	gsh­e
 [
num_š¡ªûs
, 
num_keypošts
, 2],

19 
wh”e
 
the
 
Ï¡
 
dim’siÚ
 
hŞds
 
	g¿nk
 2 
‹nsÜs
 
of
h
	gfÜm
 [
y
, 
x
] 
»´e£Ášg


20 
the
 
coÜdš©es
 
of
h
	gkeypošt
.

22 
impÜt
 
numpy
 
as
 
Å


23 
impÜt
 
‹nsÜæow
 
as
 
tf


26 
def
 
	$sÿË
(
keypošts
, 
y_sÿË
, 
x_sÿË
, 
scİe
=
NÚe
):

29 
Args
:

30 
keypošts
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªûs
, 
num_keypošts
, 2]

31 
y_sÿË
: (è
sÿÏr
 
‹nsÜ


32 
x_sÿË
: (è
sÿÏr
 
‹nsÜ


33 
scİe
: 
Çme
 scope.

35 
R‘uºs
:

36 
Ãw_keypošts
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªûs
, 
num_keypošts
, 2]

38 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'Scale'):

39 
y_sÿË
 = 
tf
.
	$ÿ¡
(
y_sÿË
, 
tf
.
æßt32
)

40 
x_sÿË
 = 
tf
.
	$ÿ¡
(
x_sÿË
, 
tf
.
æßt32
)

41 
Ãw_keypošts
 = 
keypošts
 * [[[
y_sÿË
, 
x_sÿË
]]]

42  
Ãw_keypošts


45 
def
 
	$ş_to_wšdow
(
keypošts
, 
wšdow
, 
scİe
=
NÚe
):

48 
This
 
İ
 
şs
 
ªy
 
šput
 
keypošts
 
to
 
a
 
wšdow
.

50 
Args
:

51 
keypošts
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªûs
, 
num_keypošts
, 2]

52 
wšdow
: 
a
 
‹nsÜ
 
of
 
sh­e
 [4] 
»´e£Ášg
 
the
 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
]

53 
wšdow
 
to
 
which
 
the
 
İ
 
should
 
ş
h
keypošts
.

54 
scİe
: 
Çme
 scope.

56 
R‘uºs
:

57 
Ãw_keypošts
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªûs
, 
num_keypošts
, 2]

59 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'ClipToWindow'):

60 
y
, 
x
 = 
tf
.
	$¥l™
(
v®ue
=
keypošts
, 
num_Ü_size_¥l™s
=2, 
axis
=2)

61 
wš_y_mš
, 
wš_x_mš
, 
wš_y_max
, 
wš_x_max
 = 
tf
.
	$un¡ack
(
wšdow
)

62 
y
 = 
tf
.
	`maximum
Ñf.
	`mšimum
(y, 
wš_y_max
), 
wš_y_mš
)

63 
x
 = 
tf
.
	`maximum
Ñf.
	`mšimum
(x, 
wš_x_max
), 
wš_x_mš
)

64 
Ãw_keypošts
 = 
tf
.
	$cÚÿt
([
y
, 
x
], 2)

65  
Ãw_keypošts


68 
def
 
	$´uÃ_outside_wšdow
(
keypošts
, 
wšdow
, 
scİe
=
NÚe
):

71 
This
 
funùiÚ
 
»¶aûs
 
keypošts
 
th©
 
çÎ
 
outside
 
the
 
giv’
 
wšdow
 
w™h
 
Çn
.

72 
S“
 
®so
 
ş_to_wšdow
 
which
 
şs
 
ªy
 
keypošts
 
th©
 
çÎ
 
outside
 
the
 
giv’


73 
wšdow
.

75 
Args
:

76 
keypošts
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªûs
, 
num_keypošts
, 2]

77 
wšdow
: 
a
 
‹nsÜ
 
of
 
sh­e
 [4] 
»´e£Ášg
 
the
 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
]

78 
wšdow
 
outside
 
of
 
which
 
the
 
İ
 
should
 
´uÃ
h
keypošts
.

79 
scİe
: 
Çme
 scope.

81 
R‘uºs
:

82 
Ãw_keypošts
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªûs
, 
num_keypošts
, 2]

84 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'PruneOutsideWindow'):

85 
y
, 
x
 = 
tf
.
	$¥l™
(
v®ue
=
keypošts
, 
num_Ü_size_¥l™s
=2, 
axis
=2)

86 
wš_y_mš
, 
wš_x_mš
, 
wš_y_max
, 
wš_x_max
 = 
tf
.
	$un¡ack
(
wšdow
)

88 
v®id_šdiûs
 = 
tf
.
	`logiÿl_ªd
(

89 
tf
.
	`logiÿl_ªd
(
y
 >ğ
wš_y_mš
, y <ğ
wš_y_max
),

90 
tf
.
	`logiÿl_ªd
(
x
 >ğ
wš_x_mš
, x <ğ
wš_x_max
))

92 
Ãw_y
 = 
tf
.
	`wh”e
(
v®id_šdiûs
, 
y
, 
Å
.
Çn
 *f.
	$Úes_like
(
y
))

93 
Ãw_x
 = 
tf
.
	`wh”e
(
v®id_šdiûs
, 
x
, 
Å
.
Çn
 *f.
	$Úes_like
(
x
))

94 
Ãw_keypošts
 = 
tf
.
	$cÚÿt
([
Ãw_y
, 
Ãw_x
], 2)

96  
Ãw_keypošts


99 
def
 
	$chªge_coÜdš©e_äame
(
keypošts
, 
wšdow
, 
scİe
=
NÚe
):

102 
Giv’
 
a
 
wšdow
 
of
 
the
 
fÜm
 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
], 
chªges
 
keypošt


103 
coÜdš©es
 
äom
 
keypošts
 
of
 
sh­e
 [
num_š¡ªûs
, 
num_keypošts
, 2]

104 
to
 
be
 
»Ïtive
Ø
this
 
wšdow
.

106 
An
 
exam¶e
 
u£
 
is
 
d©a
 
augm’tiÚ
: 
wh”e
 
we
 
¬e
 
giv’
 
groundŒuth


107 
keypošts
 
ªd
 
would
 
like
 
to
 
¿ndomly
 
üİ
 
the
 
image
Ø
some
 
wšdow
. 
In
 
this


108 
we
 
Ãed
 
to
 
chªge
 
the
 
coÜdš©e
 
äame
 
of
 
—ch
 
groundŒuth
 
keypošt
Ø
be


109 
»Ïtive
 
to
 
this
 
Ãw
 
wšdow
.

111 
Args
:

112 
keypošts
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªûs
, 
num_keypošts
, 2]

113 
wšdow
: 
a
 
‹nsÜ
 
of
 
sh­e
 [4] 
»´e£Ášg
 
the
 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
]

114 
wšdow
 
we
 
should
 
chªge
 
the
 
coÜdš©e
 
äame
 
to
.

115 
scİe
: 
Çme
 scope.

117 
R‘uºs
:

118 
Ãw_keypošts
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªûs
, 
num_keypošts
, 2]

120 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'ChangeCoordinateFrame'):

121 
wš_height
 = 
wšdow
[2] - window[0]

122 
wš_width
 = 
wšdow
[3] - window[1]

123 
Ãw_keypošts
 = 
	`sÿË
(
keypošts
 - [
wšdow
[0], wšdow[1]], 1.0 / 
wš_height
,

124 1.0 / 
wš_width
)

125  
Ãw_keypošts


128 
def
 
	$to_nÜm®ized_coÜdš©es
(
keypošts
, 
height
, 
width
,

129 
check_¿nge
=
True
, 
scİe
=
NÚe
):

132 
Usu®ly
 
Úe
 
u£s
 
the
 
dyÇmic
 
sh­e
 
of
h
image
 
Ü
 
cÚv
-
Ïy”
 
‹nsÜ
:

133 
keypošts
 = 
keypošt_İs
.
	`to_nÜm®ized_coÜdš©es
(keypoints,

134 
tf
.
	`sh­e
(
images
)[1],

135 
tf
.
	`sh­e
(
images
)[2]),

137 
This
 
funùiÚ
 
¿i£s
 
ª
 
as£¹iÚ
 
çed
 
”rÜ
 
©
 
g¿ph
 
executiÚ
 
time
 
wh’


138 
the
 
maximum
 
coÜdš©e
 
is
 
sm®Ër
 
thª
 1.01 (
which
 
m—ns
 
th©
 
coÜdš©es
 
¬e


139 
®»ady
 
nÜm®ized
). 
The
 
v®ue
 1.01 
is
 
to
 
d—l
 
w™h
 
sm®l
 
roundšg
 
”rÜs
.

141 
Args
:

142 
keypošts
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªûs
, 
num_keypošts
, 2].

143 
height
: 
Maximum
 
v®ue
 
y
 
coÜdš©e
 
of
 
absŞu‹
 
keypošt
 
coÜdš©es
.

144 
width
: 
Maximum
 
v®ue
 
x
 
coÜdš©e
 
of
 
absŞu‹
 
keypošt
 
coÜdš©es
.

145 
check_¿nge
: 
If
 
True
, 
checks
 
the
 
coÜdš©es
 
¬e
 
nÜm®ized
.

146 
scİe
: 
Çme
 scope.

148 
R‘uºs
:

149 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªûs
, 
num_keypošts
, 2] 
w™h
 
nÜm®ized


150 
coÜdš©es
 
š
 [0, 1].

152 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'ToNormalizedCoordinates'):

153 
height
 = 
tf
.
	$ÿ¡
(
height
, 
tf
.
æßt32
)

154 
width
 = 
tf
.
	$ÿ¡
(
width
, 
tf
.
æßt32
)

156 
check_¿nge
:

157 
max_v®
 = 
tf
.
	$»duû_max
(
keypošts
)

158 
max_as£¹
 = 
tf
.
	`As£¹
Ñf.
	`g»©”
(
max_v®
, 1.01),

159 ['max v®ui low”hª 1.01: ', 
max_v®
])

160 
w™h
 
tf
.
	$cÚŒŞ_d•’d’c›s
([
max_as£¹
]):

161 
width
 = 
tf
.
	$id’t™y
(
width
)

163  
	`sÿË
(
keypošts
, 1.0 / 
height
, 1.0 / 
width
)

166 
def
 
	$to_absŞu‹_coÜdš©es
(
keypošts
, 
height
, 
width
,

167 
check_¿nge
=
True
, 
scİe
=
NÚe
):

170 
This
 
funùiÚ
 
¿i£s
 
ª
 
as£¹iÚ
 
çed
 
”rÜ
 
wh’
 
the
 
maximum
 
keypošt


171 
coÜdš©e
 
v®ue
 
is
 
Ïrg”
 
thª
 1.01 (
š
 
which
 
coÜdš©es
 
¬e
 
®»ady


172 
absŞu‹
).

174 
Args
:

175 
keypošts
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªûs
, 
num_keypošts
, 2]

176 
height
: 
Maximum
 
v®ue
 
y
 
coÜdš©e
 
of
 
absŞu‹
 
keypošt
 
coÜdš©es
.

177 
width
: 
Maximum
 
v®ue
 
x
 
coÜdš©e
 
of
 
absŞu‹
 
keypošt
 
coÜdš©es
.

178 
check_¿nge
: 
If
 
True
, 
checks
 
the
 
coÜdš©es
 
¬e
 
nÜm®ized
 
Ü
 
nÙ
.

179 
scİe
: 
Çme
 scope.

181 
R‘uºs
:

182 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªûs
, 
num_keypošts
, 2] 
w™h
 
absŞu‹
 
coÜdš©es


183 
š
 
‹rms
 
of
 
the
 
image
 
size
.

186 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'ToAbsoluteCoordinates'):

187 
height
 = 
tf
.
	$ÿ¡
(
height
, 
tf
.
æßt32
)

188 
width
 = 
tf
.
	$ÿ¡
(
width
, 
tf
.
æßt32
)

190 #Ensu» 
¿nge
 
of
 
šput
 
keypošts
 
is
 
cÜ»ù
.

191 
check_¿nge
:

192 
max_v®
 = 
tf
.
	$»duû_max
(
keypošts
)

193 
max_as£¹
 = 
tf
.
	`As£¹
Ñf.
	`g»©”_equ®
(1.01, 
max_v®
),

195 'thª 1.01: ', 
max_v®
])

196 
w™h
 
tf
.
	$cÚŒŞ_d•’d’c›s
([
max_as£¹
]):

197 
width
 = 
tf
.
	$id’t™y
(
width
)

199  
	$sÿË
(
keypošts
, 
height
, 
width
)

202 
def
 
	$æ_hÜizÚl
(
keypošts
, 
æ_pošt
, 
æ_³rmutiÚ
, 
scİe
=
NÚe
):

205 
This
 
İ”©iÚ
 
æs
 
the
 
x
 
coÜdš©e
 
—ch
 
keypošt
 
¬ound
h
æ_pošt


206 
ªd
 
®so
 
³rmu‹s
 
the
 
keypošts
 
š
 
a
 
mªÃr
 
¥ecif›d
 
by
 
æ_³rmutiÚ
.

208 
Args
:

209 
keypošts
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªûs
, 
num_keypošts
, 2]

210 
æ_pošt
: (è
sÿÏr
 
‹nsÜ
 
»´e£Ášg
 
the
 
x
 
coÜdš©e
 
to
 
æ
he

211 
keypošts
 
¬ound
.

212 
æ_³rmutiÚ
: 
¿nk
 1 
št32
 
‹nsÜ
 
cÚššg
 
the
 
keypošt
 
æ


213 
³rmutiÚ
. 
This
 
¥ecif›s
 
the
 
m­pšg
 
äom
 
Üigš®
 
keypošt
 
šdiûs


214 
to
 
the
 
æ³d
 
keypošt
 
šdiûs
. 
This
 
is
 
u£d
 
´im¬y
 
keypošts


215 
th©
 
¬e
 
nÙ
 
»æeùiÚ
 
šv¬ŸÁ
. 
E
.
g
. 
Suµo£
 
th”e
‡» 3 
keypošts


216 
»´e£Ášg
 ['h—d', 'right_eye', 'Ëá_eye'], 
th’
 
a
 
logiÿl
 
choiû
 

217 
æ_³rmutiÚ
 
might
 
be
 [0, 2, 1] 
sšû
 
we
 
wªt
 
to
 
sw­
 
the
 'left_eye'

218 
ªd
 'right_eye' 
aá”
 
a
 
hÜizÚl
 
æ
.

219 
scİe
: 
Çme
 scope.

221 
R‘uºs
:

222 
Ãw_keypošts
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªûs
, 
num_keypošts
, 2]

224 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'FlipHorizontal'):

225 
keypošts
 = 
tf
.
	$Œª¥o£
(
keypošts
, [1, 0, 2])

226 
keypošts
 = 
tf
.
	$g©h”
(
keypošts
, 
æ_³rmutiÚ
)

227 
v
, 
u
 = 
tf
.
	$¥l™
(
v®ue
=
keypošts
, 
num_Ü_size_¥l™s
=2, 
axis
=2)

228 
u
 = 
æ_pošt
 * 2.0 - u

229 
Ãw_keypošts
 = 
tf
.
	$cÚÿt
([
v
, 
u
], 2)

230 
Ãw_keypošts
 = 
tf
.
	$Œª¥o£
(
Ãw_keypošts
, [1, 0, 2])

231  
Ãw_keypošts


	@core/keypoint_ops_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
numpy
 
as
 
Å


18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
keypošt_İs


23 
şass
 
	$KeypoštOpsTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$‹¡_sÿË
(
£lf
):

27 
keypošts
 = 
tf
.
	$cÚ¡ªt
([

31 
y_sÿË
 = 
tf
.
	`cÚ¡ªt
(1.0 / 100)

32 
x_sÿË
 = 
tf
.
	`cÚ¡ªt
(1.0 / 200)

34 
ex³ùed_keypošts
 = 
tf
.
	$cÚ¡ªt
([

38 
ouut
 = 
keypošt_İs
.
	$sÿË
(
keypošts
, 
y_sÿË
, 
x_sÿË
)

40 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

41 
ouut_
, 
ex³ùed_keypošts_
 = 
£ss
.
	$run
([
ouut
, 
ex³ùed_keypošts
])

42 
£lf
.
	$as£¹AÎClo£
(
ouut_
, 
ex³ùed_keypošts_
)

44 
def
 
	$‹¡_ş_to_wšdow
(
£lf
):

45 
keypošts
 = 
tf
.
	$cÚ¡ªt
([

49 
wšdow
 = 
tf
.
	$cÚ¡ªt
([0.25, 0.25, 0.75, 0.75])

51 
ex³ùed_keypošts
 = 
tf
.
	$cÚ¡ªt
([

55 
ouut
 = 
keypošt_İs
.
	$ş_to_wšdow
(
keypošts
, 
wšdow
)

57 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

58 
ouut_
, 
ex³ùed_keypošts_
 = 
£ss
.
	$run
([
ouut
, 
ex³ùed_keypošts
])

59 
£lf
.
	$as£¹AÎClo£
(
ouut_
, 
ex³ùed_keypošts_
)

61 
def
 
	$‹¡_´uÃ_outside_wšdow
(
£lf
):

62 
keypošts
 = 
tf
.
	$cÚ¡ªt
([

66 
wšdow
 = 
tf
.
	$cÚ¡ªt
([0.25, 0.25, 0.75, 0.75])

68 
ex³ùed_keypošts
 = 
tf
.
	$cÚ¡ªt
([[[0.25, 0.5], [0.75, 0.75]],

69 [[
Å
.
Çn
,‚p.nan], [np.nan,‚p.nan]]])

70 
ouut
 = 
keypošt_İs
.
	$´uÃ_outside_wšdow
(
keypošts
, 
wšdow
)

72 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

73 
ouut_
, 
ex³ùed_keypošts_
 = 
£ss
.
	$run
([
ouut
, 
ex³ùed_keypošts
])

74 
£lf
.
	$as£¹AÎClo£
(
ouut_
, 
ex³ùed_keypošts_
)

76 
def
 
	$‹¡_chªge_coÜdš©e_äame
(
£lf
):

77 
keypošts
 = 
tf
.
	$cÚ¡ªt
([

81 
wšdow
 = 
tf
.
	$cÚ¡ªt
([0.25, 0.25, 0.75, 0.75])

83 
ex³ùed_keypošts
 = 
tf
.
	`cÚ¡ªt
([

87 
ouut
 = 
keypošt_İs
.
	$chªge_coÜdš©e_äame
(
keypošts
, 
wšdow
)

89 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

90 
ouut_
, 
ex³ùed_keypošts_
 = 
£ss
.
	$run
([
ouut
, 
ex³ùed_keypošts
])

91 
£lf
.
	$as£¹AÎClo£
(
ouut_
, 
ex³ùed_keypošts_
)

93 
def
 
	$‹¡_to_nÜm®ized_coÜdš©es
(
£lf
):

94 
keypošts
 = 
tf
.
	$cÚ¡ªt
([

98 
ouut
 = 
keypošt_İs
.
	$to_nÜm®ized_coÜdš©es
(

99 
keypošts
, 40, 60)

100 
ex³ùed_keypošts
 = 
tf
.
	$cÚ¡ªt
([

105 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

106 
ouut_
, 
ex³ùed_keypošts_
 = 
£ss
.
	$run
([
ouut
, 
ex³ùed_keypošts
])

107 
£lf
.
	$as£¹AÎClo£
(
ouut_
, 
ex³ùed_keypošts_
)

109 
def
 
	$‹¡_to_nÜm®ized_coÜdš©es_®»ady_nÜm®ized
(
£lf
):

110 
keypošts
 = 
tf
.
	$cÚ¡ªt
([

114 
ouut
 = 
keypošt_İs
.
	$to_nÜm®ized_coÜdš©es
(

115 
keypošts
, 40, 60)

117 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

118 
w™h
 
£lf
.
	`as£¹Rai£sOpE¼Ü
('assertion failed'):

119 
£ss
.
	$run
(
ouut
)

121 
def
 
	$‹¡_to_absŞu‹_coÜdš©es
(
£lf
):

122 
keypošts
 = 
tf
.
	$cÚ¡ªt
([

126 
ouut
 = 
keypošt_İs
.
	$to_absŞu‹_coÜdš©es
(

127 
keypošts
, 40, 60)

128 
ex³ùed_keypošts
 = 
tf
.
	$cÚ¡ªt
([

133 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

134 
ouut_
, 
ex³ùed_keypošts_
 = 
£ss
.
	$run
([
ouut
, 
ex³ùed_keypošts
])

135 
£lf
.
	$as£¹AÎClo£
(
ouut_
, 
ex³ùed_keypošts_
)

137 
def
 
	$‹¡_to_absŞu‹_coÜdš©es_®»ady_absŞu‹
(
£lf
):

138 
keypošts
 = 
tf
.
	$cÚ¡ªt
([

142 
ouut
 = 
keypošt_İs
.
	$to_absŞu‹_coÜdš©es
(

143 
keypošts
, 40, 60)

145 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

146 
w™h
 
£lf
.
	`as£¹Rai£sOpE¼Ü
('assertion failed'):

147 
£ss
.
	$run
(
ouut
)

149 
def
 
	$‹¡_æ_hÜizÚl
(
£lf
):

150 
keypošts
 = 
tf
.
	$cÚ¡ªt
([

154 
æ_³rmutiÚ
 = [0, 2, 1]

156 
ex³ùed_keypošts
 = 
tf
.
	$cÚ¡ªt
([

160 
ouut
 = 
keypošt_İs
.
	$æ_hÜizÚl
(
keypošts
, 0.5, 
æ_³rmutiÚ
)

162 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

163 
ouut_
, 
ex³ùed_keypošts_
 = 
£ss
.
	$run
([
ouut
, 
ex³ùed_keypošts
])

164 
£lf
.
	$as£¹AÎClo£
(
ouut_
, 
ex³ùed_keypošts_
)

167 
__Çme__
 == '__main__':

168 
tf
.
‹¡
.
	`maš
()

	@core/losses.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
Loÿliz©iÚ
 
	glos£s
:

19 * 
Weigh‹dL2Loÿliz©iÚLoss


20 * 
Weigh‹dSmoÙhL1Loÿliz©iÚLoss


21 * 
Weigh‹dIOULoÿliz©iÚLoss


23 
CÏssifiÿtiÚ
 
los£s
:

24 * 
Weigh‹dSigmoidCÏssifiÿtiÚLoss


25 * 
Weigh‹dSoámaxCÏssifiÿtiÚLoss


26 * 
BoÙ¡¿µedSigmoidCÏssifiÿtiÚLoss


28 
äom
 
abc
 
impÜt
 
ABCM‘a


29 
äom
 
abc
 
impÜt
 
ab¡¿ùm‘hod


31 
impÜt
 
‹nsÜæow
 
as
 
tf


33 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


34 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡_İs


35 
äom
 
objeù_d‘eùiÚ
.
uts
 
impÜt
 
İs


37 
¦im
 = 
tf
.
cÚŒib
.slim

40 
şass
 
	$Loss
(
objeù
):

42 
__m‘aşass__
 = 
ABCM‘a


44 
def
 
	$__ÿÎ__
(
£lf
,

45 
´ediùiÚ_‹nsÜ
,

46 
rg‘_‹nsÜ
,

47 
ignÜe_Çn_rg‘s
=
F®£
,

48 
scİe
=
NÚe
,

49 **
·¿ms
):

52 
Args
:

53 
´ediùiÚ_‹nsÜ
: 
a
 
‹nsÜ
 
»´e£Ášg
 
´ediùed
 
quªt™›s
.

54 
rg‘_‹nsÜ
: 
a
 
‹nsÜ
 
»´e£Ášg
 
»g»ssiÚ
 
Ü
 
şassifiÿtiÚ
 
rg‘s
.

55 
ignÜe_Çn_rg‘s
: 
wh‘h”
 
to
 
ignÜe
 
Çn
 
rg‘s
 
š
 
the
 
loss
 
computiÚ
.

56 
E
.
g
. 
ÿn
 
be
 
u£d
 
the
 
rg‘
 
‹nsÜ
 
is
 
missšg
 
groundŒuth
 
d©a
 
th©


57 
shouldn
't be factored intohe†oss.

58 
scİe
: 
Op
 scİ
Çme
. 
DeçuÉs
 
to
 'Loss' 
NÚe
.

59 **
·¿ms
: 
Add™iÚ®
 
keywÜd
 
¬gum’ts
 
¥ecific
 
im¶em’tiÚs
 
of


60 
the
 
Loss
.

62 
R‘uºs
:

63 
loss
: 
a
 
‹nsÜ
 
»´e£Ášg
 
the
 
v®ue
 
of
hlos 
funùiÚ
.

65 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'Loss',

66 [
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
·¿ms
]è
as
 
scİe
:

67 
ignÜe_Çn_rg‘s
:

68 
rg‘_‹nsÜ
 = 
tf
.
	`wh”e
Ñf.
	`is_Çn
(target_tensor),

69 
´ediùiÚ_‹nsÜ
,

70 
rg‘_‹nsÜ
)

71  
£lf
.
	`_compu‹_loss
(
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, **
·¿ms
)

73 @
ab¡¿ùm‘hod


74 
def
 
	$_compu‹_loss
(
£lf
, 
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, **
·¿ms
):

77 
Args
:

78 
´ediùiÚ_‹nsÜ
: 
a
 
‹nsÜ
 
»´e£Ášg
 
´ediùed
 
quªt™›s


79 
rg‘_‹nsÜ
: 
a
 
‹nsÜ
 
»´e£Ášg
 
»g»ssiÚ
 
Ü
 
şassifiÿtiÚ
 
rg‘s


80 **
·¿ms
: 
Add™iÚ®
 
keywÜd
 
¬gum’ts
 
¥ecific
 
im¶em’tiÚs
 
of


81 
the
 
Loss
.

83 
R‘uºs
:

84 
loss
: 
a
 
‹nsÜ
 
»´e£Ášg
 
the
 
v®ue
 
of
hlos 
funùiÚ


86 
·ss


89 
şass
 
	$Weigh‹dL2Loÿliz©iÚLoss
(
Loss
):

92 
Loss
[
b
,
a
] = .5 * ||
weights
[b,a] * (
´ediùiÚ
[b,a,:] - 
rg‘
[b,a,:])||^2

95 
def
 
	$__š™__
(
£lf
, 
ªchÜwi£_ouut
=
F®£
):

98 
Args
:

99 
ªchÜwi£_ouut
: 
Ouuts
 
loss
 
³r
 
ªchÜ
. ( 
F®£
)

102 
£lf
.
_ªchÜwi£_ouut
 = 
ªchÜwi£_ouut


104 
def
 
	$_compu‹_loss
(
£lf
, 
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
):

107 
Args
:

108 
´ediùiÚ_‹nsÜ
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

109 
code_size
] 
»´e£Ášg
 
	$the
 (
’coded
è
´ediùed
 
loÿtiÚs
 
of
 
objeùs
.

110 
rg‘_‹nsÜ
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

111 
code_size
] 
»´e£Ášg
 
the
 
»g»ssiÚ
 
rg‘s


112 
weights
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
]

114 
R‘uºs
:

115 
loss
: 
	$a
 (
sÿÏr
è
‹nsÜ
 
»´e£Ášg
 
the
 
v®ue
 
of
h
loss
 
funùiÚ


116 
Ü
 
a
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
]

118 
weigh‹d_diff
 = (
´ediùiÚ_‹nsÜ
 - 
rg‘_‹nsÜ
è* 
tf
.
	$ex·nd_dims
(

119 
weights
, 2)

120 
squ¬e_diff
 = 0.5 * 
tf
.
	$squ¬e
(
weigh‹d_diff
)

121 
£lf
.
_ªchÜwi£_ouut
:

122  
tf
.
	$»duû_sum
(
squ¬e_diff
, 2)

123  
tf
.
	$»duû_sum
(
squ¬e_diff
)

126 
şass
 
	$Weigh‹dSmoÙhL1Loÿliz©iÚLoss
(
Loss
):

129 
The
 
smoÙh
 
L1_loss
 
is
 
defšed
 
–em’twi£
 
as
 .5 
x
^2 |x|<1 
ªd
 |x|-.5

130 
Ùh”wi£
, 
wh”e
 
x
 
is
 
the
 
difã»nû
 
b‘w“n
 
´ediùiÚs
 
ªd
 
rg‘
.

132 
S“
 
®so
 
	$Equ©iÚ
 (3è
š
 
the
 
Fa¡
 
R
-
CNN
 
·³r
 
by
 
Ross
 
	`Gœshick
 (
ICCV
 2015)

135 
def
 
	$__š™__
(
£lf
, 
ªchÜwi£_ouut
=
F®£
):

138 
Args
:

139 
ªchÜwi£_ouut
: 
Ouuts
 
loss
 
³r
 
ªchÜ
. ( 
F®£
)

142 
£lf
.
_ªchÜwi£_ouut
 = 
ªchÜwi£_ouut


144 
def
 
	$_compu‹_loss
(
£lf
, 
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
):

147 
Args
:

148 
´ediùiÚ_‹nsÜ
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

149 
code_size
] 
»´e£Ášg
 
	$the
 (
’coded
è
´ediùed
 
loÿtiÚs
 
of
 
objeùs
.

150 
rg‘_‹nsÜ
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

151 
code_size
] 
»´e£Ášg
 
the
 
»g»ssiÚ
 
rg‘s


152 
weights
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
]

154 
R‘uºs
:

155 
loss
: 
	$a
 (
sÿÏr
è
‹nsÜ
 
»´e£Ášg
 
the
 
v®ue
 
of
h
loss
 
funùiÚ


157 
diff
 = 
´ediùiÚ_‹nsÜ
 - 
rg‘_‹nsÜ


158 
abs_diff
 = 
tf
.
	$abs
(
diff
)

159 
abs_diff_É_1
 = 
tf
.
	$Ëss
(
abs_diff
, 1)

160 
ªchÜwi£_smoÙh_l1nÜm
 = 
tf
.
	`»duû_sum
(

161 
tf
.
	`wh”e
(
abs_diff_É_1
, 0.5 *f.
	`squ¬e
(
abs_diff
),‡bs_diff - 0.5),

162 2è* 
weights


163 
£lf
.
_ªchÜwi£_ouut
:

164  
ªchÜwi£_smoÙh_l1nÜm


165  
tf
.
	$»duû_sum
(
ªchÜwi£_smoÙh_l1nÜm
)

168 
şass
 
	$Weigh‹dIOULoÿliz©iÚLoss
(
Loss
):

171 
Sums
 
the
 
IOU
 
cÜ»¥Údšg
 
·œs
 
of
 
´ediùed
/
groundŒuth
 
boxes


172 
ªd
 
—ch
 
·œ
 
assign
 
a
 
loss
 
of
 1 - 
IOU
. 
We
 
th’
 
compu‹
‡ 
weigh‹d


173 
sum
 
ov”
 
®l
 
·œs
 
which
 
is
 
»tuºed
 
as
 
the
 
tÙ®
 
loss
.

176 
def
 
	$_compu‹_loss
(
£lf
, 
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
):

179 
Args
:

180 
´ediùiÚ_‹nsÜ
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
, 4]

181 
»´e£Ášg
 
the
 
decoded
 
´ediùed
 
boxes


182 
rg‘_‹nsÜ
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
, 4]

183 
»´e£Ášg
 
the
 
decoded
 
rg‘
 
boxes


184 
weights
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
]

186 
R‘uºs
:

187 
loss
: 
	$a
 (
sÿÏr
è
‹nsÜ
 
»´e£Ášg
 
the
 
v®ue
 
of
h
loss
 
funùiÚ


189 
´ediùed_boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	`»sh­e
(
´ediùiÚ_‹nsÜ
, [-1, 4]))

190 
rg‘_boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	`»sh­e
(
rg‘_‹nsÜ
, [-1, 4]))

191 
³r_ªchÜ_iou_loss
 = 1.0 - 
box_li¡_İs
.
	$m©ched_iou
(
´ediùed_boxes
,

192 
rg‘_boxes
)

193  
tf
.
	`»duû_sum
Ñf.
	`»sh­e
(
weights
, [-1]è* 
³r_ªchÜ_iou_loss
)

196 
şass
 
	$Weigh‹dSigmoidCÏssifiÿtiÚLoss
(
Loss
):

199 
def
 
	$__š™__
(
£lf
, 
ªchÜwi£_ouut
=
F®£
):

202 
Args
:

203 
ªchÜwi£_ouut
: 
Ouuts
 
loss
 
³r
 
ªchÜ
. ( 
F®£
)

206 
£lf
.
_ªchÜwi£_ouut
 = 
ªchÜwi£_ouut


208 
def
 
	$_compu‹_loss
(
£lf
,

209 
´ediùiÚ_‹nsÜ
,

210 
rg‘_‹nsÜ
,

211 
weights
,

212 
şass_šdiûs
=
NÚe
):

215 
Args
:

216 
´ediùiÚ_‹nsÜ
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

217 
num_şas£s
] 
»´e£Ášg
 
the
 
´ediùed
 
log™s
 
—ch
 
şass


218 
rg‘_‹nsÜ
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

219 
num_şas£s
] 
»´e£Ášg
 
Úe
-
hÙ
 
’coded
 
şassifiÿtiÚ
 
rg‘s


220 
weights
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
]

221 
şass_šdiûs
: (
O±iÚ®
è
A
 1-
D
 
š‹g”
 
‹nsÜ
 
of
 
şass
 
šdiûs
.

222 
If
 
´ovided
, 
compu‹s
 
loss
 
Úly
 
the
 
¥ecif›d
 
şass
 
šdiûs
.

224 
R‘uºs
:

225 
loss
: 
	$a
 (
sÿÏr
è
‹nsÜ
 
»´e£Ášg
 
the
 
v®ue
 
of
h
loss
 
funùiÚ


226 
Ü
 
a
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
]

228 
weights
 = 
tf
.
	$ex·nd_dims
(
weights
, 2)

229 
şass_šdiûs
 
is
 
nÙ
 
NÚe
:

230 
weights
 *ğ
tf
.
	`»sh­e
(

231 
İs
.
	`šdiûs_to_d’£_veùÜ
(
şass_šdiûs
,

232 
tf
.
	`sh­e
(
´ediùiÚ_‹nsÜ
)[2]),

234 
³r_’Œy_üoss_’t
 = (
tf
.
Â
.
	$sigmoid_üoss_’Œİy_w™h_log™s
(

235 
Ïb–s
=
rg‘_‹nsÜ
, 
log™s
=
´ediùiÚ_‹nsÜ
))

236 
£lf
.
_ªchÜwi£_ouut
:

237  
tf
.
	$»duû_sum
(
³r_’Œy_üoss_’t
 * 
weights
, 2)

238  
tf
.
	$»duû_sum
(
³r_’Œy_üoss_’t
 * 
weights
)

241 
şass
 
	$Weigh‹dSoámaxCÏssifiÿtiÚLoss
(
Loss
):

244 
def
 
	$__š™__
(
£lf
, 
ªchÜwi£_ouut
=
F®£
):

247 
Args
:

248 
ªchÜwi£_ouut
: 
Wh‘h”
 
to
 
ouut
 
loss
 
³r
 
	`ªchÜ
 ( 
F®£
)

251 
£lf
.
_ªchÜwi£_ouut
 = 
ªchÜwi£_ouut


253 
def
 
	$_compu‹_loss
(
£lf
, 
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
):

256 
Args
:

257 
´ediùiÚ_‹nsÜ
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

258 
num_şas£s
] 
»´e£Ášg
 
the
 
´ediùed
 
log™s
 
—ch
 
şass


259 
rg‘_‹nsÜ
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

260 
num_şas£s
] 
»´e£Ášg
 
Úe
-
hÙ
 
’coded
 
şassifiÿtiÚ
 
rg‘s


261 
weights
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
]

263 
R‘uºs
:

264 
loss
: 
	$a
 (
sÿÏr
è
‹nsÜ
 
»´e£Ášg
 
the
 
v®ue
 
of
h
loss
 
funùiÚ


266 
num_şas£s
 = 
´ediùiÚ_‹nsÜ
.
	`g‘_sh­e
().
	`as_li¡
()[-1]

267 
³r_row_üoss_’t
 = (
tf
.
Â
.
	`soámax_üoss_’Œİy_w™h_log™s
(

268 
Ïb–s
=
tf
.
	`»sh­e
(
rg‘_‹nsÜ
, [-1, 
num_şas£s
]),

269 
log™s
=
tf
.
	`»sh­e
(
´ediùiÚ_‹nsÜ
, [-1, 
num_şas£s
])))

270 
£lf
.
_ªchÜwi£_ouut
:

271  
tf
.
	`»sh­e
(
³r_row_üoss_’t
,f.
	`sh­e
(
weights
)) * weights

272  
tf
.
	`»duû_sum
(
³r_row_üoss_’t
 *f.
	`»sh­e
(
weights
, [-1]))

275 
şass
 
	$BoÙ¡¿µedSigmoidCÏssifiÿtiÚLoss
(
Loss
):

278 
This
 
loss
 
u£s
 
a
 
cÚvex
 
combš©iÚ
 
of
 
Œaššg
 
Ïb–s
 
ªd
 
the
 
cu¼’t
 
mod–
's

279 
´ediùiÚs
 
as
 
Œaššg
 
rg‘s
 
š
 
the
 
şassifiÿtiÚ
 
loss
. 
The
 
id—
 
is
 
th©


280 
as
 
the
 
mod–
 
im´oves
 
ov”
 
time
, 
™s
 
´ediùiÚs
 
ÿn
 
be
 
Œu¡ed
 
mÜe
 
ªd
 
we


281 
ÿn
 
u£
 
the£
 
´ediùiÚs
 
to
 
m™ig©e
 
the
 
damage
 
of
 
noisy
/
šcÜ»ù
 
Ïb–s
,

282 
beÿu£
 
šcÜ»ù
 
Ïb–s
 
¬e
 
lik–y
 
to
 
be
 
ev’tu®ly
 
highly
 
šcÚsi¡’t
 
w™h


283 
Ùh”
 
¡imuli
 
´ediùed
 
to
 
have
 
the
 
§me
 
Ïb–
 
by
h
mod–
.

285 
In
 "soá" 
boÙ¡¿µšg
, 
we
 
u£
 
®l
 
´ediùed
 
şass
 
´obab™›s
, 
wh”—s
 
š


286 "h¬d" 
boÙ¡¿µšg
, 
we
 
u£
 
the
 
sšgË
 
şass
 
çvÜed
 
by
h
mod–
.

288 
S“
 
®so
 
T¿ššg
 
D“p
 
Neu¿l
 
N‘wÜks
 
On
 
Noisy
 
Lab–s
 
w™h
 
BoÙ¡¿µšg
 
by


289 
R“d
 
‘
 
®
. (
ICLR
 2015).

292 
def
 
	`__š™__
(
£lf
, 
®pha
, 
boÙ¡¿p_ty³
='soá', 
ªchÜwi£_ouut
=
F®£
):

295 
Args
:

296 
®pha
: 
a
 
æßt32
 
sÿÏr
 
‹nsÜ
 
b‘w“n
 0 
ªd
 1 
»´e£Ášg
 
š‹½Ş©iÚ


297 
weight


298 
boÙ¡¿p_ty³
: 
£t
 
to
 
e™h”
 'h¬d' 
Ü
 'soft' ()

299 
ªchÜwi£_ouut
: 
Ouuts
 
loss
 
³r
 
ªchÜ
. ( 
F®£
)

301 
Rai£s
:

302 
V®ueE¼Ü
: 
boÙ¡¿p_ty³
 
is
 
nÙ
 
e™h”
 'h¬d' 
Ü
 'soft'

304 
boÙ¡¿p_ty³
 !ğ'h¬d' 
ªd
 bootstrap_type != 'soft':

305 
¿i£
 
	`V®ueE¼Ü
('Unrecognized bootstrap_type: must be one of '

307 
£lf
.
_®pha
 = 
®pha


308 
£lf
.
_boÙ¡¿p_ty³
 = 
boÙ¡¿p_ty³


309 
£lf
.
_ªchÜwi£_ouut
 = 
ªchÜwi£_ouut


311 
def
 
	$_compu‹_loss
(
£lf
, 
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
):

314 
Args
:

315 
´ediùiÚ_‹nsÜ
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

316 
num_şas£s
] 
»´e£Ášg
 
the
 
´ediùed
 
log™s
 
—ch
 
şass


317 
rg‘_‹nsÜ
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

318 
num_şas£s
] 
»´e£Ášg
 
Úe
-
hÙ
 
’coded
 
şassifiÿtiÚ
 
rg‘s


319 
weights
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
]

321 
R‘uºs
:

322 
loss
: 
	$a
 (
sÿÏr
è
‹nsÜ
 
»´e£Ášg
 
the
 
v®ue
 
of
h
loss
 
funùiÚ


323 
Ü
 
a
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
]

325 
£lf
.
_boÙ¡¿p_ty³
 == 'soft':

326 
boÙ¡¿p_rg‘_‹nsÜ
 = 
£lf
.
_®pha
 * 
rg‘_‹nsÜ
 + (

327 1.0 - 
£lf
.
_®pha
è* 
tf
.
	$sigmoid
(
´ediùiÚ_‹nsÜ
)

329 
boÙ¡¿p_rg‘_‹nsÜ
 = 
£lf
.
_®pha
 * 
rg‘_‹nsÜ
 + (

330 1.0 - 
£lf
.
_®pha
è* 
tf
.
	`ÿ¡
(

331 
tf
.
	`sigmoid
(
´ediùiÚ_‹nsÜ
è> 0.5,f.
æßt32
)

332 
³r_’Œy_üoss_’t
 = (
tf
.
Â
.
	$sigmoid_üoss_’Œİy_w™h_log™s
(

333 
Ïb–s
=
boÙ¡¿p_rg‘_‹nsÜ
, 
log™s
=
´ediùiÚ_‹nsÜ
))

334 
£lf
.
_ªchÜwi£_ouut
:

335  
tf
.
	`»duû_sum
(
³r_’Œy_üoss_’t
 *f.
	`ex·nd_dims
(
weights
, 2), 2)

336  
tf
.
	`»duû_sum
(
³r_’Œy_üoss_’t
 *f.
	$ex·nd_dims
(
weights
, 2))

339 
şass
 
	$H¬dExam¶eMš”
(
objeù
):

342 
Im¶em’ts
 
h¬d
 
exam¶e
 
mššg
 
to
 
£Ëù
 
a
 
sub£t
 
of
 
»giÚs
Ø
be


343 
back
-
´İag©ed
. 
FÜ
 
—ch
 
image
, 
£Ëùs
 
the
 
»giÚs
 
w™h
 
highe¡
 
los£s
,

344 
subjeù
 
to
 
the
 
cÚd™iÚ
 
th©
 
a
 
Ãwly
 
£Ëùed
 
»giÚ
 
ÿÂÙ
 
have


345 
ª
 
IOU
 > 
iou_th»shŞd
 
w™h
 
ªy
 
of
 
the
 
´eviou¦y
 
£Ëùed
 
»giÚs
.

346 
This
 
ÿn
 
be
 
ach›ved
 
by
 
»
-
usšg
 
a
 
g»edy
 
nÚ
-
maximum
 
suµ»ssiÚ
 
®gÜ™hm
.

347 
A
 
cÚ¡¿št
 
Ú
 
the
 
numb”
 
of
 
Ãg©ives
 
mšed
 
³r
 
pos™ive
 
»giÚ
 
ÿn
 
®so
 
be


348 
’fÜûd
.

350 
Reã»nû
 
·³rs
: "Training Region-based Object Detectors with Online

351 
H¬d
 
Exam¶e
 
Mššg
" (CVPR 2016) by Srivastavaƒt‡l.,‡nd

352 "SSD: SšgË ShÙ MuÉiBox D‘eùÜ" (
ECCV
 2016è
by
 
Liu
 
‘
 
®
.

355 
def
 
	`__š™__
(
£lf
,

356 
num_h¬d_exam¶es
=64,

357 
iou_th»shŞd
=0.7,

358 
loss_ty³
='both',

359 
şs_loss_weight
=0.05,

360 
loc_loss_weight
=0.06,

361 
max_Ãg©ives_³r_pos™ive
=
NÚe
,

362 
mš_Ãg©ives_³r_image
=0):

365 
The
 
h¬d
 
exam¶e
 
mššg
 
im¶em’‹d
 
by
 
this
 
şass
 
ÿn
 
»¶iÿ‹
 
the
 
behaviÜ


366 
š
 
the
 
two
 
afÜem’tiÚed
 
	`·³rs
 (
Sriva¡ava
 
‘
 
®
., 
ªd
 
Liu
ƒt‡l).

367 
To
 
»¶iÿ‹
 
the
 
A2
 
	`·³r
 (
Sriva¡ava
 
‘
 
®
), 
num_h¬d_exam¶es
 
is
 
£t


368 
to
 
a
 
fixed
 
	$·¿m‘”
 (64 
by
 è
ªd
 
iou_th»shŞd
 
is
 
£t
 
to
 .7 

369 
ruÂšg
 
nÚ
-
max
-
suµ»ssiÚ
 
the
 
´ediùed
 
boxes
 
´iÜ
 
to
 
h¬d
 
mššg
.

370 
In
 
Üd”
 
to
 
»¶iÿ‹
 
the
 
SSD
 
	`·³r
 (
Liu
 
‘
 
®
), 
num_h¬d_exam¶es
 
should


371 
be
 
£t
 
to
 
NÚe
, 
max_Ãg©ives_³r_pos™ive
 
should
 b3 
ªd
 
iou_th»shŞd


372 
should
 
be
 1.0 (
š
 
Üd”
 
to
 
efãùiv–y
 
tuº
 
off
 
NMS
).

374 
Args
:

375 
num_h¬d_exam¶es
: 
maximum
 
numb”
 
of
 
h¬d
 
exam¶es
 
to
 
be


376 
£Ëùed
 
³r
 
	`image
 (
´iÜ
 
to
 
’fÜcšg
 
max
 
Ãg©ive
Ø
pos™ive
 
¿tio


377 
cÚ¡¿št
). 
If
 
£t
 
to
 
NÚe
, 
®l
 
exam¶es
 
obšed
 
aá”
 
NMS
 
¬e


378 
cÚsid”ed
.

379 
iou_th»shŞd
: 
mšimum
 
š‹r£ùiÚ
 
ov”
 
ª
 
exam¶e


380 
to
 
be
 
disÿrded
 
duršg
 
NMS
.

381 
loss_ty³
: 
u£
 
Úly
 
şassifiÿtiÚ
 
	`los£s
 ('cls', ),

382 
loÿliz©iÚ
 
	`los£s
 ('loc'è
Ü
 
bÙh
†osses ('both').

383 
In
 
the
 
Ï¡
 , 
şs_loss_weight
 
ªd
 
loc_loss_weight
 
¬e
 
u£d
 
to


384 
compu‹
 
weigh‹d
 
sum
 
of
 
the
 
two
 
los£s
.

385 
şs_loss_weight
: 
weight
 
şassifiÿtiÚ
 
loss
.

386 
loc_loss_weight
: 
weight
 
loÿtiÚ
 
loss
.

387 
max_Ãg©ives_³r_pos™ive
: 
maximum
 
numb”
 
of
 
Ãg©ives
 
to
 
»š
 

388 
—ch
 
pos™ive
 
ªchÜ
. 
By
 , 
num_Ãg©ives_³r_pos™ive
 
is
 
NÚe
,

389 
which
 
m—ns
 
th©
 
we
 dØ
nÙ
 
’fÜû
 
a
 
´e¥ecif›d
 
Ãg©ive
:
pos™ive


390 
¿tio
. 
NÙe
 
®so
 
th©
 
num_Ãg©ives_³r_pos™ives
 
ÿn
 
be
 
a
 

391 (
ªd
 
wl
 
be
 
cÚv”‹d
 
to
 b
a
 
ev’
 
™
 
is
 
·s£d
 
š
 
Ùh”wi£
).

392 
mš_Ãg©ives_³r_image
: 
mšimum
 
numb”
 
of
 
Ãg©ive
 
ªchÜs
 
to
 
§m¶e
 

393 
a
 
giv’
 
image
. 
S‘tšg
 
this
 
to
‡ 
pos™ive
 
numb”
 
®lows
 
§m¶šg


394 
Ãg©ives
 
š
 
ª
 
image
 
w™hout
 
ªy
 
pos™ive
 
ªchÜs
 
ªd
 
thus
 
nÙ
 
bŸ£d


395 
tow¬ds
 
©
 
Ëa¡
 
Úe
 
d‘eùiÚ
 
³r
 
image
.

397 
£lf
.
_num_h¬d_exam¶es
 = 
num_h¬d_exam¶es


398 
£lf
.
_iou_th»shŞd
 = 
iou_th»shŞd


399 
£lf
.
_loss_ty³
 = 
loss_ty³


400 
£lf
.
_şs_loss_weight
 = 
şs_loss_weight


401 
£lf
.
_loc_loss_weight
 = 
loc_loss_weight


402 
£lf
.
_max_Ãg©ives_³r_pos™ive
 = 
max_Ãg©ives_³r_pos™ive


403 
£lf
.
_mš_Ãg©ives_³r_image
 = 
mš_Ãg©ives_³r_image


404 
£lf
.
_max_Ãg©ives_³r_pos™ive
 
is
 
nÙ
 
NÚe
:

405 
£lf
.
_max_Ãg©ives_³r_pos™ive
 = (self._max_negatives_per_positive)

406 
£lf
.
_num_pos™ives_li¡
 = 
NÚe


407 
£lf
.
_num_Ãg©ives_li¡
 = 
NÚe


409 
def
 
	$__ÿÎ__
(
£lf
,

410 
loÿtiÚ_los£s
,

411 
şs_los£s
,

412 
decoded_boxli¡_li¡
,

413 
m©ch_li¡
=
NÚe
):

416 
Args
:

417 
loÿtiÚ_los£s
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
num_images
, 
num_ªchÜs
]

418 
»´e£Ášg
 
ªchÜwi£
 
loÿliz©iÚ
 
los£s
.

419 
şs_los£s
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
num_images
, 
num_ªchÜs
]

420 
»´e£Ášg
 
ªchÜwi£
 
şassifiÿtiÚ
 
los£s
.

421 
decoded_boxli¡_li¡
: 
a
 
li¡
 
of
 
decoded
 
BoxLi¡
 
»´e£Ášg
 
loÿtiÚ


422 
´ediùiÚs
 
—ch
 
image
.

423 
m©ch_li¡
: 
ª
 
İtiÚ®
 
li¡
 
of
 
m©ch”
.
M©ch
 
objeùs
 
’codšg
 
the
 
m©ch


424 
b‘w“n
 
ªchÜs
 
ªd
 
groundŒuth
 
boxes
 
—ch
 
image
 
of
 
the
 
b©ch
,

425 
w™h
 
rows
 
of
 
the
 
M©ch
 
objeùs
 
cÜ»¥Údšg
 
to
 
groundŒuth
 
boxes


426 
ªd
 
cŞumns
 
cÜ»¥Údšg
 
to
 
ªchÜs
. 
M©ch
 
objeùs
 
š
 
m©ch_li¡
 
¬e


427 
u£d
 
to
 
»ã»nû
 
which
 
ªchÜs
 
¬e
 
pos™ive
, 
Ãg©ive
 
Ü
 
ignÜed
. 
If


428 
£lf
.
_max_Ãg©ives_³r_pos™ive
 
exi¡s
, 
the£
 
¬e
 
th’
 
u£d
 
to
 
’fÜû


429 
a
 
´e¥ecif›d
 
Ãg©ive
 
to
 
pos™ive
 
¿tio
.

431 
R‘uºs
:

432 
mšed_loÿtiÚ_loss
: 
a
 
sÿÏr
 
w™h
 
sum
 
of
 
loÿliz©iÚ
 
los£s
 
äom


433 
£Ëùed
 
h¬d
 
exam¶es
.

434 
mšed_şs_loss
: 
a
 
sÿÏr
 
w™h
 
sum
 
of
 
şassifiÿtiÚ
 
los£s
 
äom


435 
£Ëùed
 
h¬d
 
exam¶es
.

436 
Rai£s
:

437 
V®ueE¼Ü
: 
loÿtiÚ_los£s
, 
şs_los£s
 
ªd
 
decoded_boxli¡_li¡
 do

438 
nÙ
 
have
 
com·tibË
 
	`sh­es
 (
i
.
e
., 
they
 
mu¡
 
cÜ»¥Úd
 
to
 
the
 
§me


439 
numb”
 
of
 
images
).

440 
V®ueE¼Ü
: 
m©ch_li¡
 
is
 
¥ecif›d
 
but
 
™s
 
Ëngth
 
dÛs
 
nÙ
 
m©ch


441 
	`Ën
(
decoded_boxli¡_li¡
).

443 
mšed_loÿtiÚ_los£s
 = []

444 
mšed_şs_los£s
 = []

445 
loÿtiÚ_los£s
 = 
tf
.
	$un¡ack
(
loÿtiÚ_los£s
)

446 
şs_los£s
 = 
tf
.
	$un¡ack
(
şs_los£s
)

447 
num_images
 = 
	$Ën
(
decoded_boxli¡_li¡
)

448 
nÙ
 
m©ch_li¡
:

449 
m©ch_li¡
 = 
num_images
 * [
NÚe
]

450 
nÙ
 
	`Ën
(
loÿtiÚ_los£s
è=ğËn(
decoded_boxli¡_li¡
è=ğ
	$Ën
(
şs_los£s
):

451 
¿i£
 
	`V®ueE¼Ü
('location_losses, cls_losses‡nd decoded_boxlist_list '

453 
nÙ
 
	$isš¡ªû
(
m©ch_li¡
, 
li¡
):

454 
¿i£
 
	`V®ueE¼Ü
('match_list must be‡†ist.')

455 
	`Ën
(
m©ch_li¡
è!ğ
	$Ën
(
decoded_boxli¡_li¡
):

456 
¿i£
 
	`V®ueE¼Ü
('match_list mustƒither be None or have '

458 
num_pos™ives_li¡
 = []

459 
num_Ãg©ives_li¡
 = []

460 
šd
, 
d‘eùiÚ_boxli¡
 
š
 
	$’um”©e
(
decoded_boxli¡_li¡
):

461 
box_loÿtiÚs
 = 
d‘eùiÚ_boxli¡
.
	$g‘
()

462 
m©ch
 = 
m©ch_li¡
[
šd
]

463 
image_los£s
 = 
şs_los£s
[
šd
]

464 
£lf
.
_loss_ty³
 == 'loc':

465 
image_los£s
 = 
loÿtiÚ_los£s
[
šd
]

466 
–if
 
£lf
.
_loss_ty³
 == 'both':

467 
image_los£s
 *ğ
£lf
.
_şs_loss_weight


468 
image_los£s
 +ğ
loÿtiÚ_los£s
[
šd
] * 
£lf
.
_loc_loss_weight


469 
£lf
.
_num_h¬d_exam¶es
 
is
 
nÙ
 
NÚe
:

470 
num_h¬d_exam¶es
 = 
£lf
.
_num_h¬d_exam¶es


472 
num_h¬d_exam¶es
 = 
d‘eùiÚ_boxli¡
.
	$num_boxes
()

473 
£Ëùed_šdiûs
 = 
tf
.
image
.
	$nÚ_max_suµ»ssiÚ
(

474 
box_loÿtiÚs
, 
image_los£s
, 
num_h¬d_exam¶es
, 
£lf
.
_iou_th»shŞd
)

475 
£lf
.
_max_Ãg©ives_³r_pos™ive
 
is
 
nÙ
 
NÚe
 
ªd
 
m©ch
:

476 (
£Ëùed_šdiûs
, 
num_pos™ives
,

477 
num_Ãg©ives
èğ
£lf
.
	$_sub§m¶e_£ËùiÚ_to_desœed_Ãg_pos_¿tio
(

478 
£Ëùed_šdiûs
, 
m©ch
, 
£lf
.
_max_Ãg©ives_³r_pos™ive
,

479 
£lf
.
_mš_Ãg©ives_³r_image
)

480 
num_pos™ives_li¡
.
	$­³nd
(
num_pos™ives
)

481 
num_Ãg©ives_li¡
.
	$­³nd
(
num_Ãg©ives
)

482 
mšed_loÿtiÚ_los£s
.
	`­³nd
(

483 
tf
.
	`»duû_sum
Ñf.
	$g©h”
(
loÿtiÚ_los£s
[
šd
], 
£Ëùed_šdiûs
)))

484 
mšed_şs_los£s
.
	`­³nd
(

485 
tf
.
	`»duû_sum
Ñf.
	$g©h”
(
şs_los£s
[
šd
], 
£Ëùed_šdiûs
)))

486 
loÿtiÚ_loss
 = 
tf
.
	`»duû_sum
Ñf.
	$¡ack
(
mšed_loÿtiÚ_los£s
))

487 
şs_loss
 = 
tf
.
	`»duû_sum
Ñf.
	$¡ack
(
mšed_şs_los£s
))

488 
m©ch
 
ªd
 
£lf
.
_max_Ãg©ives_³r_pos™ive
:

489 
£lf
.
_num_pos™ives_li¡
 = 
num_pos™ives_li¡


490 
£lf
.
_num_Ãg©ives_li¡
 = 
num_Ãg©ives_li¡


491  (
loÿtiÚ_loss
, 
şs_loss
)

493 
def
 
	$summ¬ize
(
£lf
):

495 
£lf
.
_num_pos™ives_li¡
 
ªd
 s–f.
_num_Ãg©ives_li¡
:

496 
avg_num_pos™ives
 = 
tf
.
	`»duû_m—n
Ñf.
	$to_æßt
(
£lf
.
_num_pos™ives_li¡
))

497 
avg_num_Ãg©ives
 = 
tf
.
	`»duû_m—n
Ñf.
	$to_æßt
(
£lf
.
_num_Ãg©ives_li¡
))

498 
tf
.
summ¬y
.
	`sÿÏr
('H¬dExam¶eMš”/NumPos™ives', 
avg_num_pos™ives
)

499 
tf
.
summ¬y
.
	`sÿÏr
('H¬dExam¶eMš”/NumNeg©ives', 
avg_num_Ãg©ives
)

501 
def
 
	$_sub§m¶e_£ËùiÚ_to_desœed_Ãg_pos_¿tio
(
£lf
,

502 
šdiûs
,

503 
m©ch
,

504 
max_Ãg©ives_³r_pos™ive
,

505 
mš_Ãg©ives_³r_image
=0):

508 
This
 
funùiÚ
 
kes
 
a
 
sub£t
 
of
 
M
 
	`šdiûs
 (
šdexšg
 
što
‡ 
Ïrge
 
ªchÜ


509 
cŞËùiÚ
 
of
 
N
 
ªchÜs
 
wh”e
 
M
<Nè
which
 
¬e
 
Ïb–ed
 
as
 
pos™ive
/
Ãg©ive


510 
vŸ
 
a
 
M©ch
 
	`objeù
 (
m©ched
 
šdiûs
 
¬e
 
pos™ive
, 
unm©ched
 indices

511 
¬e
 
Ãg©ive
). 
It
 
»tuºs
 
a
 
sub£t
 
of
 
the
 
´ovided
 
šdiûs
 
»ššg
 
®l


512 
pos™ives
 
as
 
w–l
‡ 
up
 
to
 
the
 
fœ¡
 
K
 
Ãg©ives
, 
wh”e
:

513 
K
=
	`æoÜ
(
num_Ãg©ive_³r_pos™ive
 * 
num_pos™ives
).

515 
FÜ
 
exam¶e
, 
šdiûs
=[2, 4, 5, 7, 9, 10] (
šdexšg
 
što
 12 
ªchÜs
),

516 
w™h
 
pos™ives
=[2, 5] 
ªd
 
Ãg©ives
=[4, 7, 9, 10]‡nd

517 
num_Ãg©ives_³r_pos™ive
=1, 
th’
 
the
 
»tuºed
 
sub£t
 
of
 
šdiûs


518 
is
 [2, 4, 5, 7].

520 
Args
:

521 
šdiûs
: 
An
 
š‹g”
 
‹nsÜ
 
of
 
sh­e
 [
M
] 
»´e£Ášg
 
a
 
cŞËùiÚ


522 
of
 
£Ëùed
 
ªchÜ
 
šdiûs


523 
m©ch
: 
A
 
m©ch”
.
M©ch
 
objeù
 
’codšg
 
the
 m©ch 
b‘w“n
 
ªchÜs
 
ªd


524 
groundŒuth
 
boxes
 
a
 
giv’
 
image
, 
w™h
 
rows
 
of
 
the
 
M©ch
 
objeùs


525 
cÜ»¥Údšg
 
to
 
groundŒuth
 
boxes
 
ªd
 
cŞumns
 cÜ»¥ÚdšgØ
ªchÜs
.

526 
max_Ãg©ives_³r_pos™ive
: (è
maximum
 
numb”
 
of
 
Ãg©ives
 

527 
—ch
 
pos™ive
 
ªchÜ
.

528 
mš_Ãg©ives_³r_image
: 
mšimum
 
numb”
 
of
 
Ãg©ive
 
ªchÜs
 
a
 
giv’


529 
image
. 
AÎow
 
§m¶šg
 
Ãg©ives
 
š
 imag
w™hout
 
ªy
 
pos™ive
 
ªchÜs
.

531 
R‘uºs
:

532 
£Ëùed_šdiûs
: 
An
 
š‹g”
 
‹nsÜ
 
of
 
sh­e
 [
M
']„epresenting‡

533 
cŞËùiÚ
 
of
 
£Ëùed
 
ªchÜ
 
šdiûs
 
w™h
 
M
' <= M.

534 
num_pos™ives
: 
An
 
š‹g”
 
‹nsÜ
 
»´e£Ášg
 
the
 
numb”
 
of
 
pos™ive


535 
exam¶es
 
š
 
£Ëùed
 
£t
 
of
 
šdiûs
.

536 
num_Ãg©ives
: 
An
 
š‹g”
 
‹nsÜ
 
»´e£Ášg
 
the
 
numb”
 
of
 
Ãg©ive


537 
exam¶es
 
š
 
£Ëùed
 
£t
 
of
 
šdiûs
.

539 
pos™ives_šdiÿtÜ
 = 
tf
.
	`g©h”
(
m©ch
.
	`m©ched_cŞumn_šdiÿtÜ
(), 
šdiûs
)

540 
Ãg©ives_šdiÿtÜ
 = 
tf
.
	`g©h”
(
m©ch
.
	`unm©ched_cŞumn_šdiÿtÜ
(), 
šdiûs
)

541 
num_pos™ives
 = 
tf
.
	`»duû_sum
Ñf.
	$to_št32
(
pos™ives_šdiÿtÜ
))

542 
max_Ãg©ives
 = 
tf
.
	`maximum
(
mš_Ãg©ives_³r_image
,

543 
tf
.
	`to_št32
(
max_Ãg©ives_³r_pos™ive
 *

544 
tf
.
	$to_æßt
(
num_pos™ives
)))

545 
tİk_Ãg©ives_šdiÿtÜ
 = 
tf
.
	`Ëss_equ®
(

546 
tf
.
	`cumsum
Ñf.
	`to_št32
(
Ãg©ives_šdiÿtÜ
)), 
max_Ãg©ives
)

547 
sub§m¶ed_£ËùiÚ_šdiûs
 = 
tf
.
	`wh”e
(

548 
tf
.
	$logiÿl_Ü
(
pos™ives_šdiÿtÜ
, 
tİk_Ãg©ives_šdiÿtÜ
))

549 
num_Ãg©ives
 = 
tf
.
	`size
(
sub§m¶ed_£ËùiÚ_šdiûs
è- 
num_pos™ives


550  (
tf
.
	`»sh­e
Ñf.
	`g©h”
(
šdiûs
, 
sub§m¶ed_£ËùiÚ_šdiûs
), [-1]),

551 
num_pos™ives
, 
num_Ãg©ives
)

	@core/losses_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
m©h


19 
impÜt
 
numpy
 
as
 
Å


20 
impÜt
 
‹nsÜæow
 
as
 
tf


22 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


23 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
los£s


24 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
m©ch”


27 
şass
 
	$Weigh‹dL2Loÿliz©iÚLossTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

29 
def
 
	$‹¡R‘uºsCÜ»ùLoss
(
£lf
):

30 
b©ch_size
 = 3

31 
num_ªchÜs
 = 10

32 
code_size
 = 4

33 
´ediùiÚ_‹nsÜ
 = 
tf
.
	$Úes
([
b©ch_size
, 
num_ªchÜs
, 
code_size
])

34 
rg‘_‹nsÜ
 = 
tf
.
	$z”os
([
b©ch_size
, 
num_ªchÜs
, 
code_size
])

35 
weights
 = 
tf
.
	$cÚ¡ªt
([[1, 1, 1, 1, 1, 0, 0, 0, 0, 0],

37 [1, 1, 1, 1, 1, 0, 0, 0, 0, 0]], 
tf
.
æßt32
)

38 
loss_İ
 = 
los£s
.
	$Weigh‹dL2Loÿliz©iÚLoss
()

39 
loss
 = 
	$loss_İ
(
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
=weights)

41 
ex³ùed_loss
 = (3 * 5 * 4) / 2.0

42 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

43 
loss_ouut
 = 
£ss
.
	$run
(
loss
)

44 
£lf
.
	$as£¹AÎClo£
(
loss_ouut
, 
ex³ùed_loss
)

46 
def
 
	$‹¡R‘uºsCÜ»ùAnchÜwi£Loss
(
£lf
):

47 
b©ch_size
 = 3

48 
num_ªchÜs
 = 16

49 
code_size
 = 4

50 
´ediùiÚ_‹nsÜ
 = 
tf
.
	$Úes
([
b©ch_size
, 
num_ªchÜs
, 
code_size
])

51 
rg‘_‹nsÜ
 = 
tf
.
	$z”os
([
b©ch_size
, 
num_ªchÜs
, 
code_size
])

52 
weights
 = 
tf
.
	$Úes
([
b©ch_size
, 
num_ªchÜs
])

53 
loss_İ
 = 
los£s
.
	$Weigh‹dL2Loÿliz©iÚLoss
(
ªchÜwi£_ouut
=
True
)

54 
loss
 = 
	$loss_İ
(
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
=weights)

56 
ex³ùed_loss
 = 
Å
.
	`Úes
((
b©ch_size
, 
num_ªchÜs
)) * 2

57 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

58 
loss_ouut
 = 
£ss
.
	$run
(
loss
)

59 
£lf
.
	$as£¹AÎClo£
(
loss_ouut
, 
ex³ùed_loss
)

61 
def
 
	$‹¡R‘uºsCÜ»ùLossSum
(
£lf
):

62 
b©ch_size
 = 3

63 
num_ªchÜs
 = 16

64 
code_size
 = 4

65 
´ediùiÚ_‹nsÜ
 = 
tf
.
	$Úes
([
b©ch_size
, 
num_ªchÜs
, 
code_size
])

66 
rg‘_‹nsÜ
 = 
tf
.
	$z”os
([
b©ch_size
, 
num_ªchÜs
, 
code_size
])

67 
weights
 = 
tf
.
	$Úes
([
b©ch_size
, 
num_ªchÜs
])

68 
loss_İ
 = 
los£s
.
	$Weigh‹dL2Loÿliz©iÚLoss
(
ªchÜwi£_ouut
=
F®£
)

69 
loss
 = 
	$loss_İ
(
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
=weights)

71 
ex³ùed_loss
 = 
tf
.
Â
.
	`l2_loss
(
´ediùiÚ_‹nsÜ
 - 
rg‘_‹nsÜ
)

72 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

73 
loss_ouut
 = 
£ss
.
	$run
(
loss
)

74 
ex³ùed_loss_ouut
 = 
£ss
.
	$run
(
ex³ùed_loss
)

75 
£lf
.
	$as£¹AÎClo£
(
loss_ouut
, 
ex³ùed_loss_ouut
)

77 
def
 
	$‹¡R‘uºsCÜ»ùNªLoss
(
£lf
):

78 
b©ch_size
 = 3

79 
num_ªchÜs
 = 10

80 
code_size
 = 4

81 
´ediùiÚ_‹nsÜ
 = 
tf
.
	$Úes
([
b©ch_size
, 
num_ªchÜs
, 
code_size
])

82 
rg‘_‹nsÜ
 = 
tf
.
	`cÚÿt
([

83 
tf
.
	`z”os
([
b©ch_size
, 
num_ªchÜs
, 
code_size
 / 2]),

84 
tf
.
	`Úes
([
b©ch_size
, 
num_ªchÜs
, 
code_size
 / 2]è* 
Å
.
Çn


85 ], 
axis
=2)

86 
weights
 = 
tf
.
	$Úes
([
b©ch_size
, 
num_ªchÜs
])

87 
loss_İ
 = 
los£s
.
	$Weigh‹dL2Loÿliz©iÚLoss
()

88 
loss
 = 
	$loss_İ
(
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
=weights,

89 
ignÜe_Çn_rg‘s
=
True
)

91 
ex³ùed_loss
 = (3 * 5 * 4) / 2.0

92 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

93 
loss_ouut
 = 
£ss
.
	$run
(
loss
)

94 
£lf
.
	$as£¹AÎClo£
(
loss_ouut
, 
ex³ùed_loss
)

97 
şass
 
	$Weigh‹dSmoÙhL1Loÿliz©iÚLossTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

99 
def
 
	$‹¡R‘uºsCÜ»ùLoss
(
£lf
):

100 
b©ch_size
 = 2

101 
num_ªchÜs
 = 3

102 
code_size
 = 4

103 
´ediùiÚ_‹nsÜ
 = 
tf
.
	$cÚ¡ªt
([[[2.5, 0, .4, 0],

108 [0, 0, 1.5, 0]]], 
tf
.
æßt32
)

109 
rg‘_‹nsÜ
 = 
tf
.
	$z”os
([
b©ch_size
, 
num_ªchÜs
, 
code_size
])

110 
weights
 = 
tf
.
	$cÚ¡ªt
([[2, 1, 1],

111 [0, 3, 0]], 
tf
.
æßt32
)

112 
loss_İ
 = 
los£s
.
	$Weigh‹dSmoÙhL1Loÿliz©iÚLoss
()

113 
loss
 = 
	$loss_İ
(
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
=weights)

115 
exp_loss
 = 7.695

116 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

117 
loss_ouut
 = 
£ss
.
	$run
(
loss
)

118 
£lf
.
	$as£¹AÎClo£
(
loss_ouut
, 
exp_loss
)

121 
şass
 
	$Weigh‹dIOULoÿliz©iÚLossTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

123 
def
 
	$‹¡R‘uºsCÜ»ùLoss
(
£lf
):

124 
´ediùiÚ_‹nsÜ
 = 
tf
.
	$cÚ¡ªt
([[[1.5, 0, 2.4, 1],

127 
rg‘_‹nsÜ
 = 
tf
.
	$cÚ¡ªt
([[[1.5, 0, 2.4, 1],

130 
weights
 = [[1.0, .5, 2.0]]

131 
loss_İ
 = 
los£s
.
	$Weigh‹dIOULoÿliz©iÚLoss
()

132 
loss
 = 
	$loss_İ
(
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
=weights)

133 
exp_loss
 = 2.0

134 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

135 
loss_ouut
 = 
£ss
.
	$run
(
loss
)

136 
£lf
.
	$as£¹AÎClo£
(
loss_ouut
, 
exp_loss
)

139 
şass
 
	$Weigh‹dSigmoidCÏssifiÿtiÚLossTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

141 
def
 
	$‹¡R‘uºsCÜ»ùLoss
(
£lf
):

142 
´ediùiÚ_‹nsÜ
 = 
tf
.
	`cÚ¡ªt
([[[-100, 100, -100],

149 [0, 0, -1]]], 
tf
.
æßt32
)

150 
rg‘_‹nsÜ
 = 
tf
.
	$cÚ¡ªt
([[[0, 1, 0],

157 [1, 0, 0]]], 
tf
.
æßt32
)

158 
weights
 = 
tf
.
	$cÚ¡ªt
([[1, 1, 1, 1],

159 [1, 1, 1, 0]], 
tf
.
æßt32
)

160 
loss_İ
 = 
los£s
.
	$Weigh‹dSigmoidCÏssifiÿtiÚLoss
()

161 
loss
 = 
	$loss_İ
(
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
=weights)

163 
exp_loss
 = -2 * 
m©h
.
	$log
(.5)

164 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

165 
loss_ouut
 = 
£ss
.
	$run
(
loss
)

166 
£lf
.
	$as£¹AÎClo£
(
loss_ouut
, 
exp_loss
)

168 
def
 
	$‹¡R‘uºsCÜ»ùAnchÜWi£Loss
(
£lf
):

169 
´ediùiÚ_‹nsÜ
 = 
tf
.
	`cÚ¡ªt
([[[-100, 100, -100],

176 [0, 0, -1]]], 
tf
.
æßt32
)

177 
rg‘_‹nsÜ
 = 
tf
.
	$cÚ¡ªt
([[[0, 1, 0],

184 [1, 0, 0]]], 
tf
.
æßt32
)

185 
weights
 = 
tf
.
	$cÚ¡ªt
([[1, 1, 1, 1],

186 [1, 1, 1, 0]], 
tf
.
æßt32
)

187 
loss_İ
 = 
los£s
.
	$Weigh‹dSigmoidCÏssifiÿtiÚLoss
(
True
)

188 
loss
 = 
	$loss_İ
(
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
=weights)

190 
exp_loss
 = 
Å
.
	`m©rix
([[0, 0, -
m©h
.
	`log
(.5), 0],

191 [-
m©h
.
	`log
(.5), 0, 0, 0]])

192 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

193 
loss_ouut
 = 
£ss
.
	$run
(
loss
)

194 
£lf
.
	$as£¹AÎClo£
(
loss_ouut
, 
exp_loss
)

196 
def
 
	$‹¡R‘uºsCÜ»ùLossW™hCÏssIndiûs
(
£lf
):

197 
´ediùiÚ_‹nsÜ
 = 
tf
.
	`cÚ¡ªt
([[[-100, 100, -100, 100],

204 [0, 0, -1, 100]]], 
tf
.
æßt32
)

205 
rg‘_‹nsÜ
 = 
tf
.
	$cÚ¡ªt
([[[0, 1, 0, 0],

212 [1, 0, 0, 0]]], 
tf
.
æßt32
)

213 
weights
 = 
tf
.
	$cÚ¡ªt
([[1, 1, 1, 1],

214 [1, 1, 1, 0]], 
tf
.
æßt32
)

215 #IgnÜe 
the
 
Ï¡
 
şass
.

216 
şass_šdiûs
 = 
tf
.
	$cÚ¡ªt
([0, 1, 2], 
tf
.
št32
)

217 
loss_İ
 = 
los£s
.
	$Weigh‹dSigmoidCÏssifiÿtiÚLoss
(
True
)

218 
loss
 = 
	$loss_İ
(
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
=weights,

219 
şass_šdiûs
=class_indices)

221 
exp_loss
 = 
Å
.
	`m©rix
([[0, 0, -
m©h
.
	`log
(.5), 0],

222 [-
m©h
.
	`log
(.5), 0, 0, 0]])

223 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

224 
loss_ouut
 = 
£ss
.
	$run
(
loss
)

225 
£lf
.
	$as£¹AÎClo£
(
loss_ouut
, 
exp_loss
)

228 
şass
 
	$Weigh‹dSoámaxCÏssifiÿtiÚLossTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

230 
def
 
	$‹¡R‘uºsCÜ»ùLoss
(
£lf
):

231 
´ediùiÚ_‹nsÜ
 = 
tf
.
	`cÚ¡ªt
([[[-100, 100, -100],

238 [100, -100, -100]]], 
tf
.
æßt32
)

239 
rg‘_‹nsÜ
 = 
tf
.
	$cÚ¡ªt
([[[0, 1, 0],

246 [1, 0, 0]]], 
tf
.
æßt32
)

247 
weights
 = 
tf
.
	$cÚ¡ªt
([[1, 1, .5, 1],

248 [1, 1, 1, 0]], 
tf
.
æßt32
)

249 
loss_İ
 = 
los£s
.
	$Weigh‹dSoámaxCÏssifiÿtiÚLoss
()

250 
loss
 = 
	$loss_İ
(
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
=weights)

252 
exp_loss
 = - 1.5 * 
m©h
.
	$log
(.5)

253 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

254 
loss_ouut
 = 
£ss
.
	$run
(
loss
)

255 
£lf
.
	$as£¹AÎClo£
(
loss_ouut
, 
exp_loss
)

257 
def
 
	$‹¡R‘uºsCÜ»ùAnchÜWi£Loss
(
£lf
):

258 
´ediùiÚ_‹nsÜ
 = 
tf
.
	`cÚ¡ªt
([[[-100, 100, -100],

265 [100, -100, -100]]], 
tf
.
æßt32
)

266 
rg‘_‹nsÜ
 = 
tf
.
	$cÚ¡ªt
([[[0, 1, 0],

273 [1, 0, 0]]], 
tf
.
æßt32
)

274 
weights
 = 
tf
.
	$cÚ¡ªt
([[1, 1, .5, 1],

275 [1, 1, 1, 0]], 
tf
.
æßt32
)

276 
loss_İ
 = 
los£s
.
	$Weigh‹dSoámaxCÏssifiÿtiÚLoss
(
True
)

277 
loss
 = 
	$loss_İ
(
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
=weights)

279 
exp_loss
 = 
Å
.
	`m©rix
([[0, 0, - 0.5 * 
m©h
.
	`log
(.5), 0],

280 [-
m©h
.
	`log
(.5), 0, 0, 0]])

281 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

282 
loss_ouut
 = 
£ss
.
	$run
(
loss
)

283 
£lf
.
	$as£¹AÎClo£
(
loss_ouut
, 
exp_loss
)

286 
şass
 
	$BoÙ¡¿µedSigmoidCÏssifiÿtiÚLossTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

288 
def
 
	$‹¡R‘uºsCÜ»ùLossSoáBoÙ¡¿µšg
(
£lf
):

289 
´ediùiÚ_‹nsÜ
 = 
tf
.
	`cÚ¡ªt
([[[-100, 100, 0],

296 [0, 0, -1]]], 
tf
.
æßt32
)

297 
rg‘_‹nsÜ
 = 
tf
.
	$cÚ¡ªt
([[[0, 1, 0],

304 [1, 0, 0]]], 
tf
.
æßt32
)

305 
weights
 = 
tf
.
	$cÚ¡ªt
([[1, 1, 1, 1],

306 [1, 1, 1, 0]], 
tf
.
æßt32
)

307 
®pha
 = 
tf
.
	$cÚ¡ªt
(.5, 
tf
.
æßt32
)

308 
loss_İ
 = 
los£s
.
	`BoÙ¡¿µedSigmoidCÏssifiÿtiÚLoss
(

309 
®pha
, 
boÙ¡¿p_ty³
='soft')

310 
loss
 = 
	$loss_İ
(
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
=weights)

311 
exp_loss
 = -
m©h
.
	$log
(.5)

312 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

313 
loss_ouut
 = 
£ss
.
	$run
(
loss
)

314 
£lf
.
	$as£¹AÎClo£
(
loss_ouut
, 
exp_loss
)

316 
def
 
	$‹¡R‘uºsCÜ»ùLossH¬dBoÙ¡¿µšg
(
£lf
):

317 
´ediùiÚ_‹nsÜ
 = 
tf
.
	`cÚ¡ªt
([[[-100, 100, 0],

324 [0, 0, -1]]], 
tf
.
æßt32
)

325 
rg‘_‹nsÜ
 = 
tf
.
	$cÚ¡ªt
([[[0, 1, 0],

332 [1, 0, 0]]], 
tf
.
æßt32
)

333 
weights
 = 
tf
.
	$cÚ¡ªt
([[1, 1, 1, 1],

334 [1, 1, 1, 0]], 
tf
.
æßt32
)

335 
®pha
 = 
tf
.
	$cÚ¡ªt
(.5, 
tf
.
æßt32
)

336 
loss_İ
 = 
los£s
.
	`BoÙ¡¿µedSigmoidCÏssifiÿtiÚLoss
(

337 
®pha
, 
boÙ¡¿p_ty³
='hard')

338 
loss
 = 
	$loss_İ
(
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
=weights)

339 
exp_loss
 = -
m©h
.
	$log
(.5)

340 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

341 
loss_ouut
 = 
£ss
.
	$run
(
loss
)

342 
£lf
.
	$as£¹AÎClo£
(
loss_ouut
, 
exp_loss
)

344 
def
 
	$‹¡R‘uºsCÜ»ùAnchÜWi£Loss
(
£lf
):

345 
´ediùiÚ_‹nsÜ
 = 
tf
.
	`cÚ¡ªt
([[[-100, 100, -100],

352 [0, 0, -1]]], 
tf
.
æßt32
)

353 
rg‘_‹nsÜ
 = 
tf
.
	$cÚ¡ªt
([[[0, 1, 0],

360 [1, 0, 0]]], 
tf
.
æßt32
)

361 
weights
 = 
tf
.
	$cÚ¡ªt
([[1, 1, 1, 1],

362 [1, 1, 1, 0]], 
tf
.
æßt32
)

363 
®pha
 = 
tf
.
	$cÚ¡ªt
(.5, 
tf
.
æßt32
)

364 
loss_İ
 = 
los£s
.
	`BoÙ¡¿µedSigmoidCÏssifiÿtiÚLoss
(

365 
®pha
, 
boÙ¡¿p_ty³
='h¬d', 
ªchÜwi£_ouut
=
True
)

366 
loss
 = 
	$loss_İ
(
´ediùiÚ_‹nsÜ
, 
rg‘_‹nsÜ
, 
weights
=weights)

368 
exp_loss
 = 
Å
.
	`m©rix
([[0, 0, -
m©h
.
	`log
(.5), 0],

369 [-
m©h
.
	`log
(.5), 0, 0, 0]])

370 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

371 
loss_ouut
 = 
£ss
.
	$run
(
loss
)

372 
£lf
.
	$as£¹AÎClo£
(
loss_ouut
, 
exp_loss
)

375 
şass
 
	$H¬dExam¶eMš”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

377 
def
 
	$‹¡H¬dMššgW™hSšgËLossTy³
(
£lf
):

378 
loÿtiÚ_los£s
 = 
tf
.
	$cÚ¡ªt
([[100, 90, 80, 0],

379 [0, 1, 2, 3]], 
tf
.
æßt32
)

380 
şs_los£s
 = 
tf
.
	$cÚ¡ªt
([[0, 10, 50, 110],

381 [9, 6, 3, 0]], 
tf
.
æßt32
)

382 
box_cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([[0.1, 0.1, 0.9, 0.9],

385 [0.1, 0.1, 0.9, 0.9]], 
tf
.
æßt32
)

386 
decoded_boxli¡_li¡
 = []

387 
decoded_boxli¡_li¡
.
	`­³nd
(
box_li¡
.
	$BoxLi¡
(
box_cÜÃrs
))

388 
decoded_boxli¡_li¡
.
	`­³nd
(
box_li¡
.
	$BoxLi¡
(
box_cÜÃrs
))

389 #U£ 
Úly
 
loÿtiÚ
 
loss
 
to
 
£Ëù
 
h¬d
 
exam¶es


390 
loss_İ
 = 
los£s
.
	`H¬dExam¶eMš”
(
num_h¬d_exam¶es
=1,

391 
iou_th»shŞd
=0.0,

392 
loss_ty³
='loc',

393 
şs_loss_weight
=1,

394 
loc_loss_weight
=1)

395 (
loc_loss
, 
şs_loss
èğ
	$loss_İ
(
loÿtiÚ_los£s
, 
şs_los£s
,

396 
decoded_boxli¡_li¡
)

397 
exp_loc_loss
 = 100 + 3

398 
exp_şs_loss
 = 0 + 0

399 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

400 
loc_loss_ouut
 = 
£ss
.
	$run
(
loc_loss
)

401 
£lf
.
	$as£¹AÎClo£
(
loc_loss_ouut
, 
exp_loc_loss
)

402 
şs_loss_ouut
 = 
£ss
.
	$run
(
şs_loss
)

403 
£lf
.
	$as£¹AÎClo£
(
şs_loss_ouut
, 
exp_şs_loss
)

405 
def
 
	$‹¡H¬dMššgW™hBÙhLossTy³
(
£lf
):

406 
loÿtiÚ_los£s
 = 
tf
.
	$cÚ¡ªt
([[100, 90, 80, 0],

407 [0, 1, 2, 3]], 
tf
.
æßt32
)

408 
şs_los£s
 = 
tf
.
	$cÚ¡ªt
([[0, 10, 50, 110],

409 [9, 6, 3, 0]], 
tf
.
æßt32
)

410 
box_cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([[0.1, 0.1, 0.9, 0.9],

413 [0.1, 0.1, 0.9, 0.9]], 
tf
.
æßt32
)

414 
decoded_boxli¡_li¡
 = []

415 
decoded_boxli¡_li¡
.
	`­³nd
(
box_li¡
.
	$BoxLi¡
(
box_cÜÃrs
))

416 
decoded_boxli¡_li¡
.
	`­³nd
(
box_li¡
.
	$BoxLi¡
(
box_cÜÃrs
))

417 
loss_İ
 = 
los£s
.
	`H¬dExam¶eMš”
(
num_h¬d_exam¶es
=1,

418 
iou_th»shŞd
=0.0,

419 
loss_ty³
='both',

420 
şs_loss_weight
=1,

421 
loc_loss_weight
=1)

422 (
loc_loss
, 
şs_loss
èğ
	$loss_İ
(
loÿtiÚ_los£s
, 
şs_los£s
,

423 
decoded_boxli¡_li¡
)

424 
exp_loc_loss
 = 80 + 0

425 
exp_şs_loss
 = 50 + 9

426 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

427 
loc_loss_ouut
 = 
£ss
.
	$run
(
loc_loss
)

428 
£lf
.
	$as£¹AÎClo£
(
loc_loss_ouut
, 
exp_loc_loss
)

429 
şs_loss_ouut
 = 
£ss
.
	$run
(
şs_loss
)

430 
£lf
.
	$as£¹AÎClo£
(
şs_loss_ouut
, 
exp_şs_loss
)

432 
def
 
	$‹¡H¬dMššgNMS
(
£lf
):

433 
loÿtiÚ_los£s
 = 
tf
.
	$cÚ¡ªt
([[100, 90, 80, 0],

434 [0, 1, 2, 3]], 
tf
.
æßt32
)

435 
şs_los£s
 = 
tf
.
	$cÚ¡ªt
([[0, 10, 50, 110],

436 [9, 6, 3, 0]], 
tf
.
æßt32
)

437 
box_cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([[0.1, 0.1, 0.9, 0.9],

440 [0.1, 0.1, 0.9, 0.9]], 
tf
.
æßt32
)

441 
decoded_boxli¡_li¡
 = []

442 
decoded_boxli¡_li¡
.
	`­³nd
(
box_li¡
.
	$BoxLi¡
(
box_cÜÃrs
))

443 
decoded_boxli¡_li¡
.
	`­³nd
(
box_li¡
.
	$BoxLi¡
(
box_cÜÃrs
))

444 
loss_İ
 = 
los£s
.
	`H¬dExam¶eMš”
(
num_h¬d_exam¶es
=2,

445 
iou_th»shŞd
=0.5,

446 
loss_ty³
='cls',

447 
şs_loss_weight
=1,

448 
loc_loss_weight
=1)

449 (
loc_loss
, 
şs_loss
èğ
	$loss_İ
(
loÿtiÚ_los£s
, 
şs_los£s
,

450 
decoded_boxli¡_li¡
)

451 
exp_loc_loss
 = 0 + 90 + 0 + 1

452 
exp_şs_loss
 = 110 + 10 + 9 + 6

453 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

454 
loc_loss_ouut
 = 
£ss
.
	$run
(
loc_loss
)

455 
£lf
.
	$as£¹AÎClo£
(
loc_loss_ouut
, 
exp_loc_loss
)

456 
şs_loss_ouut
 = 
£ss
.
	$run
(
şs_loss
)

457 
£lf
.
	$as£¹AÎClo£
(
şs_loss_ouut
, 
exp_şs_loss
)

459 
def
 
	$‹¡EnfÜûNeg©ivesP”Pos™iveR©io
(
£lf
):

460 
loÿtiÚ_los£s
 = 
tf
.
	$cÚ¡ªt
([[100, 90, 80, 0, 1, 2,

461 3, 10, 20, 100, 20, 3]], 
tf
.
æßt32
)

462 
şs_los£s
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 100, 0, 90, 70,

463 0, 60, 0, 17, 13, 0]], 
tf
.
æßt32
)

464 
box_cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([[0.0, 0.0, 0.2, 0.1],

475 [0.0, 0.0, 0.2, 0.1]], 
tf
.
æßt32
)

476 
m©ch_»suÉs
 = 
tf
.
	`cÚ¡ªt
([2, -1, 0, -1, -1, 1, -1, -1, -1, -1, -1, 3])

477 
m©ch_li¡
 = [
m©ch”
.
	`M©ch
(
m©ch_»suÉs
)]

478 
decoded_boxli¡_li¡
 = []

479 
decoded_boxli¡_li¡
.
	`­³nd
(
box_li¡
.
	$BoxLi¡
(
box_cÜÃrs
))

481 
max_Ãg©ives_³r_pos™ive_li¡
 = [0.0, 0.5, 1.0, 1.5, 10]

482 
exp_loc_loss_li¡
 = [80 + 2,

487 
exp_şs_loss_li¡
 = [100 + 70,

493 
max_Ãg©ives_³r_pos™ive
, 
exp_loc_loss
, 
exp_şs_loss
 
š
 
	$z
(

494 
max_Ãg©ives_³r_pos™ive_li¡
, 
exp_loc_loss_li¡
, 
exp_şs_loss_li¡
):

495 
loss_İ
 = 
los£s
.
	`H¬dExam¶eMš”
(

496 
num_h¬d_exam¶es
=
NÚe
, 
iou_th»shŞd
=0.9999, 
loss_ty³
='cls',

497 
şs_loss_weight
=1, 
loc_loss_weight
=1,

498 
max_Ãg©ives_³r_pos™ive
=max_negatives_per_positive)

499 (
loc_loss
, 
şs_loss
èğ
	$loss_İ
(
loÿtiÚ_los£s
, 
şs_los£s
,

500 
decoded_boxli¡_li¡
, 
m©ch_li¡
)

501 
loss_İ
.
	$summ¬ize
()

503 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

504 
loc_loss_ouut
 = 
£ss
.
	$run
(
loc_loss
)

505 
£lf
.
	$as£¹AÎClo£
(
loc_loss_ouut
, 
exp_loc_loss
)

506 
şs_loss_ouut
 = 
£ss
.
	$run
(
şs_loss
)

507 
£lf
.
	$as£¹AÎClo£
(
şs_loss_ouut
, 
exp_şs_loss
)

509 
def
 
	$‹¡EnfÜûNeg©ivesP”Pos™iveR©ioW™hMšNeg©ivesP”Image
(
£lf
):

510 
loÿtiÚ_los£s
 = 
tf
.
	$cÚ¡ªt
([[100, 90, 80, 0, 1, 2,

511 3, 10, 20, 100, 20, 3]], 
tf
.
æßt32
)

512 
şs_los£s
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 100, 0, 90, 70,

513 0, 60, 0, 17, 13, 0]], 
tf
.
æßt32
)

514 
box_cÜÃrs
 = 
tf
.
	$cÚ¡ªt
([[0.0, 0.0, 0.2, 0.1],

525 [0.0, 0.0, 0.2, 0.1]], 
tf
.
æßt32
)

526 
m©ch_»suÉs
 = 
tf
.
	`cÚ¡ªt
([-1] * 12)

527 
m©ch_li¡
 = [
m©ch”
.
	`M©ch
(
m©ch_»suÉs
)]

528 
decoded_boxli¡_li¡
 = []

529 
decoded_boxli¡_li¡
.
	`­³nd
(
box_li¡
.
	$BoxLi¡
(
box_cÜÃrs
))

531 
mš_Ãg©ives_³r_image_li¡
 = [0, 1, 2, 4, 5, 6]

532 
exp_loc_loss_li¡
 = [0,

538 
exp_şs_loss_li¡
 = [0,

545 
mš_Ãg©ives_³r_image
, 
exp_loc_loss
, 
exp_şs_loss
 
š
 
	$z
(

546 
mš_Ãg©ives_³r_image_li¡
, 
exp_loc_loss_li¡
, 
exp_şs_loss_li¡
):

547 
loss_İ
 = 
los£s
.
	`H¬dExam¶eMš”
(

548 
num_h¬d_exam¶es
=
NÚe
, 
iou_th»shŞd
=0.9999, 
loss_ty³
='cls',

549 
şs_loss_weight
=1, 
loc_loss_weight
=1,

550 
max_Ãg©ives_³r_pos™ive
=3,

551 
mš_Ãg©ives_³r_image
=min_negatives_per_image)

552 (
loc_loss
, 
şs_loss
èğ
	$loss_İ
(
loÿtiÚ_los£s
, 
şs_los£s
,

553 
decoded_boxli¡_li¡
, 
m©ch_li¡
)

554 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

555 
loc_loss_ouut
 = 
£ss
.
	$run
(
loc_loss
)

556 
£lf
.
	$as£¹AÎClo£
(
loc_loss_ouut
, 
exp_loc_loss
)

557 
şs_loss_ouut
 = 
£ss
.
	$run
(
şs_loss
)

558 
£lf
.
	$as£¹AÎClo£
(
şs_loss_ouut
, 
exp_şs_loss
)

561 
__Çme__
 == '__main__':

562 
tf
.
‹¡
.
	`maš
()

	@core/matcher.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
This
 
moduË
 
defšes
 
the
 
M©ch”
 
š‹rçû
 
ªd
h
M©ch
 
	gobjeù
. 
The
 
job
 
of
he

19 
m©ch”
 
is
 
to
 
m©ch
 
row
 
ªd
 
cŞumn
 
šdiûs
 
ba£d
 
Ú
 
the
 
sim¬™y
 
m©rix
‡nd

20 
Ùh”
 
İtiÚ®
 
	g·¿m‘”s
. 
Each
 
cŞumn
 
is
 
m©ched
 
to
 
©
 
mo¡
 
Úe
 
	grow
. 
Th”e


21 
¬e
 
th»e
 
possib™›s
 
the
 
	gm©chšg
:

23 1è
m©ch
: 
A
 
cŞumn
 
m©ches
 
a
 
row
.

24 2è
no_m©ch
: 
A
 
cŞumn
 
dÛs
 
nÙ
 
m©ch
 
ªy
 
row
.

25 3è
ignÜe
: 
A
 
cŞumn
 
th©
 
is
 
Ã™h”
 'm©ch' 
nÜ
 
no_m©ch
.

27 
The
 
ignÜe
 
is
 
»guÏ¾y
 
’couÁ”ed
 
š
 
objeù
 
d‘eùiÚ
: 
wh’
 
ª
 
ªchÜ
 
has


28 
a
 
»Ïtiv–y
 
sm®l
 
ov”Ïp
 
w™h
‡ 
ground
-
Œuth
 
box
, 
Úe
 
Ã™h”
 
wªts
 
to


29 
cÚsid”
 
this
 
box
 
a
 
pos™ive
 
	$exam¶e
 (
m©ch
è
nÜ
 
a
 
Ãg©ive
 
	`exam¶e
 (
no
 match).

31 
The
 
M©ch
 
şass
 
is
 
u£d
 
to
 
¡Üe
 
the
 
m©ch
 
»suÉs
 
ªd
 
™
 
´ovides
 
sim¶e
 
­is


32 
to
 
qu”y
 
the
 
»suÉs
.

34 
äom
 
abc
 
impÜt
 
ABCM‘a


35 
äom
 
abc
 
impÜt
 
ab¡¿ùm‘hod


37 
impÜt
 
‹nsÜæow
 
as
 
tf


40 
şass
 
	$M©ch
(
objeù
):

43 
This
 
şass
 
is
 
u£d
 
to
 
¡Üe
 
the
 
»suÉs
 
äom
h
m©ch”
. 
It
 
´ovides


44 
cÚv’›Á
 
m‘hods
 
to
 
qu”y
 
the
 
m©chšg
 
»suÉs
.

47 
def
 
	$__š™__
(
£lf
, 
m©ch_»suÉs
):

50 
Args
:

51 
m©ch_»suÉs
: 
IÁeg”
 
‹nsÜ
 
of
 
sh­e
 [
N
] 
	$w™h
 (1è
m©ch_»suÉs
[
i
]>=0,

52 
m—nšg
 
th©
 
cŞumn
 
i
 
is
 
m©ched
 
w™h
 
row
 
m©ch_»suÉs
[i].

53 (2è
m©ch_»suÉs
[
i
]=-1, 
m—nšg
 
th©
 
cŞumn
 i 
is
 
nÙ
 
m©ched
.

54 (3è
m©ch_»suÉs
[
i
]=-2, 
m—nšg
 
th©
 
cŞumn
 i 
is
 
ignÜed
.

56 
Rai£s
:

57 
V®ueE¼Ü
: 
m©ch_»suÉs
 
dÛs
 
nÙ
 
have
 
¿nk
 1 
Ü
 
is
‚Ù 
ª


58 
š‹g”
 
št32
 
sÿÏr
 
‹nsÜ


60 
m©ch_»suÉs
.
sh­e
.
ndims
 != 1:

61 
¿i£
 
	`V®ueE¼Ü
('match_results should have„ank 1')

62 
m©ch_»suÉs
.
dty³
 !ğ
tf
.
št32
:

63 
¿i£
 
	`V®ueE¼Ü
('match_results should be‡n int32 or int64 scalar '

65 
£lf
.
_m©ch_»suÉs
 = 
m©ch_»suÉs


67 @
´İ”ty


68 
def
 
	$m©ch_»suÉs
(
£lf
):

71 
R‘uºs
:

72 
the
 
‹nsÜ
 
which
 
’codes
h
m©ch
 
»suÉs
.

74  
£lf
.
_m©ch_»suÉs


76 
def
 
	$m©ched_cŞumn_šdiûs
(
£lf
):

79 
The
 
šdiûs
 
»tuºed
 
by
 
this
 
İ
 
¬e
 
®ways
 
sÜ‹d
 
š
 
šü—sšg
 
Üd”
.

81 
R‘uºs
:

82 
cŞumn_šdiûs
: 
št32
 
‹nsÜ
 
of
 
sh­e
 [
K
] 
w™h
 
cŞumn
 
šdiûs
.

84  
£lf
.
	`_»sh­e_ªd_ÿ¡
(
tf
.
	`wh”e
Ñf.
	`g»©”
(£lf.
_m©ch_»suÉs
, -1)))

86 
def
 
	$m©ched_cŞumn_šdiÿtÜ
(
£lf
):

89 
R‘uºs
:

90 
cŞumn_šdiûs
: 
št32
 
‹nsÜ
 
of
 
sh­e
 [
K
] 
w™h
 
cŞumn
 
šdiûs
.

92  
tf
.
	$g»©”_equ®
(
£lf
.
_m©ch_»suÉs
, 0)

94 
def
 
	$num_m©ched_cŞumns
(
£lf
):

96  
tf
.
	`size
(
£lf
.
	$m©ched_cŞumn_šdiûs
())

98 
def
 
	$unm©ched_cŞumn_šdiûs
(
£lf
):

101 
The
 
šdiûs
 
»tuºed
 
by
 
this
 
İ
 
¬e
 
®ways
 
sÜ‹d
 
š
 
šü—sšg
 
Üd”
.

103 
R‘uºs
:

104 
cŞumn_šdiûs
: 
št32
 
‹nsÜ
 
of
 
sh­e
 [
K
] 
w™h
 
cŞumn
 
šdiûs
.

106  
£lf
.
	`_»sh­e_ªd_ÿ¡
(
tf
.
	`wh”e
Ñf.
	`equ®
(£lf.
_m©ch_»suÉs
, -1)))

108 
def
 
	$unm©ched_cŞumn_šdiÿtÜ
(
£lf
):

111 
R‘uºs
:

112 
cŞumn_šdiûs
: 
št32
 
‹nsÜ
 
of
 
sh­e
 [
K
] 
w™h
 
cŞumn
 
šdiûs
.

114  
tf
.
	`equ®
(
£lf
.
_m©ch_»suÉs
, -1)

116 
def
 
	$num_unm©ched_cŞumns
(
£lf
):

118  
tf
.
	`size
(
£lf
.
	$unm©ched_cŞumn_šdiûs
())

120 
def
 
	$ignÜed_cŞumn_šdiûs
(
£lf
):

123 
The
 
šdiûs
 
»tuºed
 
by
 
this
 
İ
 
¬e
 
®ways
 
sÜ‹d
 
š
 
šü—sšg
 
Üd”
.

125 
R‘uºs
:

126 
cŞumn_šdiûs
: 
št32
 
‹nsÜ
 
of
 
sh­e
 [
K
] 
w™h
 
cŞumn
 
šdiûs
.

128  
£lf
.
	`_»sh­e_ªd_ÿ¡
(
tf
.
	`wh”e
(£lf.
	$ignÜed_cŞumn_šdiÿtÜ
()))

130 
def
 
	$ignÜed_cŞumn_šdiÿtÜ
(
£lf
):

133 
R‘uºs
:

134 
cŞumn_šdiÿtÜ
: 
boŞ—n
 
veùÜ
 
which
 
is
 
True
 
®l
 
ignÜed
 
cŞumn


135 
šdiûs
.

137  
tf
.
	`equ®
(
£lf
.
_m©ch_»suÉs
, -2)

139 
def
 
	$num_ignÜed_cŞumns
(
£lf
):

141  
tf
.
	`size
(
£lf
.
	$ignÜed_cŞumn_šdiûs
())

143 
def
 
	$unm©ched_Ü_ignÜed_cŞumn_šdiûs
(
£lf
):

146 
The
 
šdiûs
 
»tuºed
 
by
 
this
 
İ
 
¬e
 
®ways
 
sÜ‹d
 
š
 
šü—sšg
 
Üd”
.

148 
R‘uºs
:

149 
cŞumn_šdiûs
: 
št32
 
‹nsÜ
 
of
 
sh­e
 [
K
] 
w™h
 
cŞumn
 
šdiûs
.

151  
£lf
.
	`_»sh­e_ªd_ÿ¡
(
tf
.
	`wh”e
Ñf.
	$g»©”
(0, 
£lf
.
_m©ch_»suÉs
)))

153 
def
 
	$m©ched_row_šdiûs
(
£lf
):

156 
The
 
šdiûs
 
»tuºed
 
by
 
this
 
İ
 
¬e
 
Üd”ed
 
so
 
as
 
to
 
be
 
š
 
cÜ»¥Úd’û


157 
w™h
 
the
 
ouut
 
of
 
	`m©ched_cŞumn_šdiÿtÜ
(). 
FÜ
 
exam¶e
 

158 
£lf
.
	$m©ched_cŞumn_šdiÿtÜ
(è
is
 [0,2], 
ªd
 
£lf
.
	$m©ched_row_šdiûs
(è
is


159 [7, 3], 
th’
 
we
 
know
 
th©
 
cŞumn
 0 
was
 
m©ched
 
to
 
row
 7 
ªd
 column 2 was

160 
m©ched
 
to
 
row
 3.

162 
R‘uºs
:

163 
row_šdiûs
: 
št32
 
‹nsÜ
 
of
 
sh­e
 [
K
] 
w™h
 
row
 
šdiûs
.

165  
£lf
.
	`_»sh­e_ªd_ÿ¡
(

166 
tf
.
	`g©h”
(
£lf
.
_m©ch_»suÉs
, s–f.
	$m©ched_cŞumn_šdiûs
()))

168 
def
 
	$_»sh­e_ªd_ÿ¡
(
£lf
, 
t
):

169  
tf
.
	`ÿ¡
Ñf.
	`»sh­e
(
t
, [-1]),f.
št32
)

172 
şass
 
	$M©ch”
(
objeù
):

175 
__m‘aşass__
 = 
ABCM‘a


177 
def
 
	$m©ch
(
£lf
, 
sim¬™y_m©rix
, 
scİe
=
NÚe
, **
·¿ms
):

180 
Compu‹s
 
m©ches
 
amÚg
 
the
 
row
 
ªd
 
cŞumn
 
šdiûs
 
ba£d
 
Ú
h
sim¬™y


181 
m©rix
 
ªd
 
İtiÚ®
 
¬gum’ts
.

183 
Args
:

184 
sim¬™y_m©rix
: 
Flßt
 
‹nsÜ
 
of
 
sh­e
 [
N
, 
M
] 
w™h
 
·œwi£
 
sim¬™y


185 
wh”e
 
high”
 
v®ue
 
m—ns
 
mÜe
 
sim¬
.

186 
scİe
: 
Op
 scİ
Çme
. 
DeçuÉs
 
to
 'M©ch' 
NÚe
.

187 **
·¿ms
: 
Add™iÚ®
 
keywÜd
 
¬gum’ts
 
¥ecific
 
im¶em’tiÚs
 
of


188 
the
 
M©ch”
.

190 
R‘uºs
:

191 
A
 
M©ch
 
objeù
 
w™h
 
the
 
»suÉs
 
of
 
m©chšg
.

193 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'M©ch', [
sim¬™y_m©rix
, 
·¿ms
]è
as
 scope:

194  
	`M©ch
(
£lf
.
	`_m©ch
(
sim¬™y_m©rix
, **
·¿ms
))

196 @
ab¡¿ùm‘hod


197 
def
 
	$_m©ch
(
£lf
, 
sim¬™y_m©rix
, **
·¿ms
):

200 
Args
:

201 
sim¬™y_m©rix
: 
Flßt
 
‹nsÜ
 
of
 
sh­e
 [
N
, 
M
] 
w™h
 
·œwi£
 
sim¬™y


202 
wh”e
 
high”
 
v®ue
 
m—ns
 
mÜe
 
sim¬
.

203 **
·¿ms
: 
Add™iÚ®
 
keywÜd
 
¬gum’ts
 
¥ecific
 
im¶em’tiÚs
 
of


204 
the
 
M©ch”
.

206 
R‘uºs
:

207 
m©ch_»suÉs
: 
IÁeg”
 
‹nsÜ
 
of
 
sh­e
 [
M
]: m©ch_»suÉs[
i
]>=0 
m—ns


208 
th©
 
cŞumn
 
i
 
is
 
m©ched
 
to
 
row
 
m©ch_»suÉs
[i], match_results[i]=-1

209 
m—ns
 
th©
 
the
 
cŞumn
 
is
 
nÙ
 
m©ched
. 
m©ch_»suÉs
[
i
]=-2 meanshat

210 
the
 
cŞumn
 
is
 
	`ignÜed
 (
usu®ly
 
this
 
h­³ns
 
wh’
 
th”e
 i 
a
 
v”y
 
w—k


211 
m©ch
 
which
 
Úe
 
Ã™h”
 
wªts
 
as
 
pos™ive
 
nÜ
 
Ãg©ive
 
exam¶e
).

213 
·ss


	@core/matcher_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
numpy
 
as
 
Å


18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
m©ch”


23 
şass
 
	$AnchÜM©ch”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

25 
def
 
	$‹¡_g‘_cÜ»ù_m©ched_cŞumnIndiûs
(
£lf
):

26 
m©ch_»suÉs
 = 
tf
.
	`cÚ¡ªt
([3, 1, -1, 0, -1, 5, -2])

27 
m©ch
 = 
m©ch”
.
	$M©ch
(
m©ch_»suÉs
)

28 
ex³ùed_cŞumn_šdiûs
 = [0, 1, 3, 5]

29 
m©ched_cŞumn_šdiûs
 = 
m©ch
.
	$m©ched_cŞumn_šdiûs
()

30 
£lf
.
	$as£¹Equ®s
(
m©ched_cŞumn_šdiûs
.
dty³
, 
tf
.
št32
)

31 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

32 
m©ched_cŞumn_šdiûs
 = 
£ss
.
	$run
(
m©ched_cŞumn_šdiûs
)

33 
£lf
.
	$as£¹AÎEqu®
(
m©ched_cŞumn_šdiûs
, 
ex³ùed_cŞumn_šdiûs
)

35 
def
 
	$‹¡_g‘_cÜ»ù_couÁs
(
£lf
):

36 
m©ch_»suÉs
 = 
tf
.
	`cÚ¡ªt
([3, 1, -1, 0, -1, 5, -2])

37 
m©ch
 = 
m©ch”
.
	$M©ch
(
m©ch_»suÉs
)

38 
exp_num_m©ched_cŞumns
 = 4

39 
exp_num_unm©ched_cŞumns
 = 2

40 
exp_num_ignÜed_cŞumns
 = 1

41 
num_m©ched_cŞumns
 = 
m©ch
.
	$num_m©ched_cŞumns
()

42 
num_unm©ched_cŞumns
 = 
m©ch
.
	$num_unm©ched_cŞumns
()

43 
num_ignÜed_cŞumns
 = 
m©ch
.
	$num_ignÜed_cŞumns
()

44 
£lf
.
	$as£¹Equ®s
(
num_m©ched_cŞumns
.
dty³
, 
tf
.
št32
)

45 
£lf
.
	$as£¹Equ®s
(
num_unm©ched_cŞumns
.
dty³
, 
tf
.
št32
)

46 
£lf
.
	$as£¹Equ®s
(
num_ignÜed_cŞumns
.
dty³
, 
tf
.
št32
)

47 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

48 (
num_m©ched_cŞumns_out
, 
num_unm©ched_cŞumns_out
,

49 
num_ignÜed_cŞumns_out
èğ
£ss
.
	$run
(

50 [
num_m©ched_cŞumns
, 
num_unm©ched_cŞumns
, 
num_ignÜed_cŞumns
])

51 
£lf
.
	$as£¹AÎEqu®
(
num_m©ched_cŞumns_out
, 
exp_num_m©ched_cŞumns
)

52 
£lf
.
	$as£¹AÎEqu®
(
num_unm©ched_cŞumns_out
, 
exp_num_unm©ched_cŞumns
)

53 
£lf
.
	$as£¹AÎEqu®
(
num_ignÜed_cŞumns_out
, 
exp_num_ignÜed_cŞumns
)

55 
def
 
	$‹¡G‘CÜ»ùUnm©chedCŞumnIndiûs
(
£lf
):

56 
m©ch_»suÉs
 = 
tf
.
	`cÚ¡ªt
([3, 1, -1, 0, -1, 5, -2])

57 
m©ch
 = 
m©ch”
.
	$M©ch
(
m©ch_»suÉs
)

58 
ex³ùed_cŞumn_šdiûs
 = [2, 4]

59 
unm©ched_cŞumn_šdiûs
 = 
m©ch
.
	$unm©ched_cŞumn_šdiûs
()

60 
£lf
.
	$as£¹Equ®s
(
unm©ched_cŞumn_šdiûs
.
dty³
, 
tf
.
št32
)

61 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

62 
unm©ched_cŞumn_šdiûs
 = 
£ss
.
	$run
(
unm©ched_cŞumn_šdiûs
)

63 
£lf
.
	$as£¹AÎEqu®
(
unm©ched_cŞumn_šdiûs
, 
ex³ùed_cŞumn_šdiûs
)

65 
def
 
	$‹¡G‘CÜ»ùM©chedRowIndiûs
(
£lf
):

66 
m©ch_»suÉs
 = 
tf
.
	`cÚ¡ªt
([3, 1, -1, 0, -1, 5, -2])

67 
m©ch
 = 
m©ch”
.
	$M©ch
(
m©ch_»suÉs
)

68 
ex³ùed_row_šdiûs
 = [3, 1, 0, 5]

69 
m©ched_row_šdiûs
 = 
m©ch
.
	$m©ched_row_šdiûs
()

70 
£lf
.
	$as£¹Equ®s
(
m©ched_row_šdiûs
.
dty³
, 
tf
.
št32
)

71 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

72 
m©ched_row_šds
 = 
£ss
.
	$run
(
m©ched_row_šdiûs
)

73 
£lf
.
	$as£¹AÎEqu®
(
m©ched_row_šds
, 
ex³ùed_row_šdiûs
)

75 
def
 
	$‹¡_g‘_cÜ»ù_ignÜed_cŞumn_šdiûs
(
£lf
):

76 
m©ch_»suÉs
 = 
tf
.
	`cÚ¡ªt
([3, 1, -1, 0, -1, 5, -2])

77 
m©ch
 = 
m©ch”
.
	$M©ch
(
m©ch_»suÉs
)

78 
ex³ùed_cŞumn_šdiûs
 = [6]

79 
ignÜed_cŞumn_šdiûs
 = 
m©ch
.
	$ignÜed_cŞumn_šdiûs
()

80 
£lf
.
	$as£¹Equ®s
(
ignÜed_cŞumn_šdiûs
.
dty³
, 
tf
.
št32
)

81 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

82 
ignÜed_cŞumn_šdiûs
 = 
£ss
.
	$run
(
ignÜed_cŞumn_šdiûs
)

83 
£lf
.
	$as£¹AÎEqu®
(
ignÜed_cŞumn_šdiûs
, 
ex³ùed_cŞumn_šdiûs
)

85 
def
 
	$‹¡_g‘_cÜ»ù_m©ched_cŞumn_šdiÿtÜ
(
£lf
):

86 
m©ch_»suÉs
 = 
tf
.
	`cÚ¡ªt
([3, 1, -1, 0, -1, 5, -2])

87 
m©ch
 = 
m©ch”
.
	$M©ch
(
m©ch_»suÉs
)

88 
ex³ùed_cŞumn_šdiÿtÜ
 = [
True
, True, 
F®£
, True, False, True, False]

89 
m©ched_cŞumn_šdiÿtÜ
 = 
m©ch
.
	$m©ched_cŞumn_šdiÿtÜ
()

90 
£lf
.
	$as£¹Equ®s
(
m©ched_cŞumn_šdiÿtÜ
.
dty³
, 
tf
.
boŞ
)

91 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

92 
m©ched_cŞumn_šdiÿtÜ
 = 
£ss
.
	$run
(
m©ched_cŞumn_šdiÿtÜ
)

93 
£lf
.
	$as£¹AÎEqu®
(
m©ched_cŞumn_šdiÿtÜ
, 
ex³ùed_cŞumn_šdiÿtÜ
)

95 
def
 
	$‹¡_g‘_cÜ»ù_unm©ched_cŞumn_šdiÿtÜ
(
£lf
):

96 
m©ch_»suÉs
 = 
tf
.
	`cÚ¡ªt
([3, 1, -1, 0, -1, 5, -2])

97 
m©ch
 = 
m©ch”
.
	$M©ch
(
m©ch_»suÉs
)

98 
ex³ùed_cŞumn_šdiÿtÜ
 = [
F®£
, F®£, 
True
, False, True, False, False]

99 
unm©ched_cŞumn_šdiÿtÜ
 = 
m©ch
.
	$unm©ched_cŞumn_šdiÿtÜ
()

100 
£lf
.
	$as£¹Equ®s
(
unm©ched_cŞumn_šdiÿtÜ
.
dty³
, 
tf
.
boŞ
)

101 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

102 
unm©ched_cŞumn_šdiÿtÜ
 = 
£ss
.
	$run
(
unm©ched_cŞumn_šdiÿtÜ
)

103 
£lf
.
	$as£¹AÎEqu®
(
unm©ched_cŞumn_šdiÿtÜ
, 
ex³ùed_cŞumn_šdiÿtÜ
)

105 
def
 
	$‹¡_g‘_cÜ»ù_ignÜed_cŞumn_šdiÿtÜ
(
£lf
):

106 
m©ch_»suÉs
 = 
tf
.
	`cÚ¡ªt
([3, 1, -1, 0, -1, 5, -2])

107 
m©ch
 = 
m©ch”
.
	$M©ch
(
m©ch_»suÉs
)

108 
ex³ùed_cŞumn_šdiÿtÜ
 = [
F®£
, F®£, F®£, F®£, F®£, F®£, 
True
]

109 
ignÜed_cŞumn_šdiÿtÜ
 = 
m©ch
.
	$ignÜed_cŞumn_šdiÿtÜ
()

110 
£lf
.
	$as£¹Equ®s
(
ignÜed_cŞumn_šdiÿtÜ
.
dty³
, 
tf
.
boŞ
)

111 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

112 
ignÜed_cŞumn_šdiÿtÜ
 = 
£ss
.
	$run
(
ignÜed_cŞumn_šdiÿtÜ
)

113 
£lf
.
	$as£¹AÎEqu®
(
ignÜed_cŞumn_šdiÿtÜ
, 
ex³ùed_cŞumn_šdiÿtÜ
)

115 
def
 
	$‹¡_g‘_cÜ»ù_unm©ched_ignÜed_cŞumn_šdiûs
(
£lf
):

116 
m©ch_»suÉs
 = 
tf
.
	`cÚ¡ªt
([3, 1, -1, 0, -1, 5, -2])

117 
m©ch
 = 
m©ch”
.
	$M©ch
(
m©ch_»suÉs
)

118 
ex³ùed_cŞumn_šdiûs
 = [2, 4, 6]

119 
unm©ched_ignÜed_cŞumn_šdiûs
 = (
m©ch
.

120 
	$unm©ched_Ü_ignÜed_cŞumn_šdiûs
())

121 
£lf
.
	$as£¹Equ®s
(
unm©ched_ignÜed_cŞumn_šdiûs
.
dty³
, 
tf
.
št32
)

122 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

123 
unm©ched_ignÜed_cŞumn_šdiûs
 = 
£ss
.
	$run
(

124 
unm©ched_ignÜed_cŞumn_šdiûs
)

125 
£lf
.
	$as£¹AÎEqu®
(
unm©ched_ignÜed_cŞumn_šdiûs
,

126 
ex³ùed_cŞumn_šdiûs
)

128 
def
 
	$‹¡_®l_cŞumns_accouÁed_fÜ
(
£lf
):

129 #NÙe: 
d–ib”©–y
 
£‰šg
 
to
 
sm®l
 
numb”
 
so
 
nÙ
 
®ways


130 #®È
possib™›s
 
	`­³¬
 (
m©ched
, 
unm©ched
, 
ignÜed
)

131 
num_m©ches
 = 10

132 
m©ch_»suÉs
 = 
tf
.
	`¿ndom_unifÜm
(

133 [
num_m©ches
], 
mšv®
=-2, 
maxv®
=5, 
dty³
=
tf
.
št32
)

134 
m©ch
 = 
m©ch”
.
	$M©ch
(
m©ch_»suÉs
)

135 
m©ched_cŞumn_šdiûs
 = 
m©ch
.
	$m©ched_cŞumn_šdiûs
()

136 
unm©ched_cŞumn_šdiûs
 = 
m©ch
.
	$unm©ched_cŞumn_šdiûs
()

137 
ignÜed_cŞumn_šdiûs
 = 
m©ch
.
	$ignÜed_cŞumn_šdiûs
()

138 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

139 
m©ched
, 
unm©ched
, 
ignÜed
 = 
£ss
.
	$run
([

140 
m©ched_cŞumn_šdiûs
, 
unm©ched_cŞumn_šdiûs
,

141 
ignÜed_cŞumn_šdiûs


143 
®l_šdiûs
 = 
Å
.
	`h¡ack
((
m©ched
, 
unm©ched
, 
ignÜed
))

144 
®l_šdiûs_sÜ‹d
 = 
Å
.
	$sÜt
(
®l_šdiûs
)

145 
£lf
.
	`as£¹AÎEqu®
(
®l_šdiûs_sÜ‹d
,

146 
Å
.
	$¬ªge
(
num_m©ches
, 
dty³
=
Å
.
št32
))

149 
__Çme__
 == '__main__':

150 
tf
.
‹¡
.
	`maš
()

	@core/minibatch_sampler.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
The
 
job
 
of
 
the
 
mšib©ch_§m¶”
 
is
 
to
 
sub§m¶e
 
a
 
mšib©ch
 
ba£d
 
Ú
 
some


19 
	gü™”iÚ
.

21 
The
 
maš
 
funùiÚ
 
ÿÎ
 
	gis
:

22 
sub§m¶e
(
šdiÿtÜ
, 
b©ch_size
, **
·¿ms
).

23 
IndiÿtÜ
 
is
 
	ga
 1d 
boŞ—n
 
‹nsÜ
 
wh”e
 
True
 
d’Ùes
 
which
 
exam¶es
 
ÿn
 
be


24 
	g§m¶ed
. 
It
 
»tuºs
 
a
 
boŞ—n
 
šdiÿtÜ
 
wh”e
 
True
 
d’Ùes
 
ª
 
exam¶e
 
has
 
b“n


25 
	g§m¶ed
..

27 
Subşas£s
 
should
 
im¶em’t
 
the
 
Sub§m¶e
 
funùiÚ
 
ªd
 
ÿn
 
make
 
u£
 
of
 
	gthe


28 @
¡©icm‘hod
 
	gSub§m¶eIndiÿtÜ
.

31 
äom
 
abc
 
impÜt
 
ABCM‘a


32 
äom
 
abc
 
impÜt
 
ab¡¿ùm‘hod


34 
impÜt
 
‹nsÜæow
 
as
 
tf


36 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
İs


39 
şass
 
	$Mšib©chSam¶”
(
objeù
):

41 
__m‘aşass__
 = 
ABCM‘a


43 
def
 
	$__š™__
(
£lf
):

45 
·ss


47 @
ab¡¿ùm‘hod


48 
def
 
	$sub§m¶e
(
£lf
, 
šdiÿtÜ
, 
b©ch_size
, **
·¿ms
):

51 
Args
:

52 
šdiÿtÜ
: 
boŞ—n
 
‹nsÜ
 
of
 
sh­e
 [
N
] 
who£
 
True
 
’Œ›s
 
ÿn
 
be
 
§m¶ed
.

53 
b©ch_size
: 
desœed
 
b©ch
 
size
.

54 **
·¿ms
: 
add™iÚ®
 
keywÜd
 
¬gum’ts
 
¥ecific
 
im¶em’tiÚs
 
of


55 
the
 
Mšib©chSam¶”
.

57 
R‘uºs
:

58 
§m¶e_šdiÿtÜ
: 
boŞ—n
 
‹nsÜ
 
of
 
sh­e
 [
N
] 
who£
 
True
 
’Œ›s
 
have
 
b“n


59 
§m¶ed
. 
If
 
	`sum
(
šdiÿtÜ
è>ğ
b©ch_size
, sum(
is_§m¶ed
) = batch_size

61 
·ss


63 @
¡©icm‘hod


64 
def
 
	$sub§m¶e_šdiÿtÜ
(
šdiÿtÜ
, 
num_§m¶es
):

67 
Giv’
 
a
 
boŞ—n
 
šdiÿtÜ
 
veùÜ
 
w™h
 
M
 
–em’ts
 
£t
 
to
 `
True
`, 
the
 
funùiÚ


68 
assigns
 
®l
 
but
 `
num_§m¶es
` 
of
 
the£
 
´eviou¦y
 `
True
` 
–em’ts
 
to


69 `
F®£
`. 
If
 `
num_§m¶es
` 
is
 
g»©”
 
thª
 
M
, 
the
 
Üigš®
 
šdiÿtÜ
 
veùÜ


70 
is
 
»tuºed
.

72 
Args
:

73 
šdiÿtÜ
: 
a
 1-
dim’siÚ®
 
boŞ—n
 
‹nsÜ
 
šdiÿtšg
 
which
 
–em’ts


74 
¬e
 
®lowed
 
to
 
be
 
§m¶ed
 
ªd
 
which
‡» 
nÙ
.

75 
num_§m¶es
: 
št32
 
sÿÏr
 
‹nsÜ


77 
R‘uºs
:

78 
a
 
boŞ—n
 
‹nsÜ
 
w™h
 
the
 
§me
 
sh­e
 
as
 
	$šput
 (
šdiÿtÜ
è
‹nsÜ


80 
šdiûs
 = 
tf
.
	$wh”e
(
šdiÿtÜ
)

81 
šdiûs
 = 
tf
.
	$¿ndom_shufæe
(
šdiûs
)

82 
šdiûs
 = 
tf
.
	`»sh­e
(indices, [-1])

84 
num_§m¶es
 = 
tf
.
	`mšimum
Ñf.
	`size
(
šdiûs
),‚um_samples)

85 
£Ëùed_šdiûs
 = 
tf
.
	`¦iû
(
šdiûs
, [0],f.
	$»sh­e
(
num_§m¶es
, [1]))

87 
£Ëùed_šdiÿtÜ
 = 
İs
.
	`šdiûs_to_d’£_veùÜ
(
£Ëùed_šdiûs
,

88 
tf
.
	`sh­e
(
šdiÿtÜ
)[0])

90  
tf
.
	`equ®
(
£Ëùed_šdiÿtÜ
, 1)

	@core/minibatch_sampler_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
numpy
 
as
 
Å


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
mšib©ch_§m¶”


24 
şass
 
	$Mšib©chSam¶”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$‹¡_sub§m¶e_šdiÿtÜ_wh’_mÜe_Œue_–em’ts_thª_num_§m¶es
(
£lf
):

27 
Å_šdiÿtÜ
 = [
True
, 
F®£
, True, False, True, True, False]

28 
šdiÿtÜ
 = 
tf
.
	$cÚ¡ªt
(
Å_šdiÿtÜ
)

29 
§m¶es
 = 
mšib©ch_§m¶”
.
Mšib©chSam¶”
.
	$sub§m¶e_šdiÿtÜ
(

30 
šdiÿtÜ
, 3)

31 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

32 
§m¶es_out
 = 
£ss
.
	$run
(
§m¶es
)

33 
£lf
.
	`as£¹True
(
Å
.
	`sum
(
§m¶es_out
), 3)

34 
£lf
.
	`as£¹AÎEqu®
(
§m¶es_out
,

35 
Å
.
	$logiÿl_ªd
(
§m¶es_out
, 
Å_šdiÿtÜ
))

37 
def
 
	$‹¡_sub§m¶e_wh’_mÜe_Œue_–em’ts_thª_num_§m¶es_no_sh­e
(
£lf
):

38 
Å_šdiÿtÜ
 = [
True
, 
F®£
, True, False, True, True, False]

39 
šdiÿtÜ
 = 
tf
.
	$¶aûhŞd”
(
tf
.
boŞ
)

40 
ãed_diù
 = {
šdiÿtÜ
: 
Å_šdiÿtÜ
}

42 
§m¶es
 = 
mšib©ch_§m¶”
.
Mšib©chSam¶”
.
	$sub§m¶e_šdiÿtÜ
(

43 
šdiÿtÜ
, 3)

44 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

45 
§m¶es_out
 = 
£ss
.
	$run
(
§m¶es
, 
ãed_diù
=feed_dict)

46 
£lf
.
	`as£¹True
(
Å
.
	`sum
(
§m¶es_out
), 3)

47 
£lf
.
	`as£¹AÎEqu®
(
§m¶es_out
,

48 
Å
.
	$logiÿl_ªd
(
§m¶es_out
, 
Å_šdiÿtÜ
))

50 
def
 
	$‹¡_sub§m¶e_šdiÿtÜ_wh’_Ëss_Œue_–em’ts_thª_num_§m¶es
(
£lf
):

51 
Å_šdiÿtÜ
 = [
True
, 
F®£
, True, False, True, True, False]

52 
šdiÿtÜ
 = 
tf
.
	$cÚ¡ªt
(
Å_šdiÿtÜ
)

53 
§m¶es
 = 
mšib©ch_§m¶”
.
Mšib©chSam¶”
.
	$sub§m¶e_šdiÿtÜ
(

54 
šdiÿtÜ
, 5)

55 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

56 
§m¶es_out
 = 
£ss
.
	$run
(
§m¶es
)

57 
£lf
.
	`as£¹True
(
Å
.
	`sum
(
§m¶es_out
), 4)

58 
£lf
.
	`as£¹AÎEqu®
(
§m¶es_out
,

59 
Å
.
	$logiÿl_ªd
(
§m¶es_out
, 
Å_šdiÿtÜ
))

61 
def
 
	$‹¡_sub§m¶e_šdiÿtÜ_wh’_num_§m¶es_is_z”o
(
£lf
):

62 
Å_šdiÿtÜ
 = [
True
, 
F®£
, True, False, True, True, False]

63 
šdiÿtÜ
 = 
tf
.
	$cÚ¡ªt
(
Å_šdiÿtÜ
)

64 
§m¶es_nÚe
 = 
mšib©ch_§m¶”
.
Mšib©chSam¶”
.
	$sub§m¶e_šdiÿtÜ
(

65 
šdiÿtÜ
, 0)

66 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

67 
§m¶es_nÚe_out
 = 
£ss
.
	$run
(
§m¶es_nÚe
)

68 
£lf
.
	`as£¹AÎEqu®
(

69 
Å
.
	`z”os_like
(
§m¶es_nÚe_out
, 
dty³
=
boŞ
),

70 
§m¶es_nÚe_out
)

72 
def
 
	$‹¡_sub§m¶e_šdiÿtÜ_wh’_šdiÿtÜ_®l_çl£
(
£lf
):

73 
šdiÿtÜ_em±y
 = 
tf
.
	$z”os
([0], 
dty³
=
tf
.
boŞ
)

74 
§m¶es_em±y
 = 
mšib©ch_§m¶”
.
Mšib©chSam¶”
.
	$sub§m¶e_šdiÿtÜ
(

75 
šdiÿtÜ_em±y
, 4)

76 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

77 
§m¶es_em±y_out
 = 
£ss
.
	$run
(
§m¶es_em±y
)

78 
£lf
.
	$as£¹Equ®
(0, 
§m¶es_em±y_out
.
size
)

81 
__Çme__
 == '__main__':

82 
tf
.
‹¡
.
	`maš
()

	@core/model.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
This
 
fe
 
defšes
 
a
 
g’”ic
 
ba£
 
şass
 
d‘eùiÚ
 
	gmod–s
. 
Prog¿ms
 
th©
 
¬e


19 
desigÃd
 
to
 
wÜk
 
w™h
 
¬b™¿ry
 
d‘eùiÚ
 
mod–s
 
should
 
Úly
 
d•’d
 
Ú
 
this


20 
	gşass
. 
We
 
š‹nd
 
the
 
funùiÚs
 
š
 
this
 
şass
 
to
 
fŞlow
 
	g‹nsÜ
-
	gš
/‹nsÜ-
out


21 
	gdesign
, 
thus
 
®l
 
funùiÚs
 
have
 
‹nsÜs
 
Ü
 
	gli¡s
/
diùiÚ¬›s
 
hŞdšg
’sÜ 
as


22 
šputs
 
ªd
 
	gouuts
.

24 
	gAb¡¿ùly
, 
d‘eùiÚ
 
mod–s
 
´ediù
 
ouut
 
‹nsÜs
 
giv’
 
šput
 
images


25 
which
 
ÿn
 
be
 
·s£d
 
to
 
a
 
loss
 
funùiÚ
 
©
 
Œaššg
 
time
 
Ü
…assedo‡

26 
po¡´oûssšg
 
funùiÚ
 
©
 
ev®
 
	gtime
. 
The
 
computiÚ
 
g¿phs
‡ˆ
a
 
high
 
Ëv–


27 
cÚ£qu’y
 
look
 
as
 
	gfŞlows
:

29 
T¿ššg
 
time
:

30 
šputs
 (
images
 
‹nsÜ
è-> 
´•roûss
 -> 
´ediù
 -> 
loss
 -> 
	$ouuts
 (
loss
 
‹nsÜ
)

32 
Ev®u©iÚ
 
time
:

33 
	`šputs
 (
images
 
‹nsÜ
è-> 
´•roûss
 -> 
´ediù
 -> 
po¡´oûss


34 -> 
	$ouuts
 (
boxes
 
‹nsÜ
, 
scÜes
’sÜ, 
şas£s
’sÜ, 
num_d‘eùiÚs
ensor)

36 
D‘eùiÚMod–s
 
mu¡
 
thus
 
im¶em’t
 
four
 
	$funùiÚs
 (1è
´•roûss
, (2è
´ediù
,

37 (3è
po¡´oûss
 
	$ªd
 (4è
loss
. 
D‘eùiÚMod–s
 
should
 
make
 
no
 
assum±iÚs
 
about


38 
the
 
šput
 
size
 
Ü
 
a¥eù
 
¿tio
 --- 
they
 
¬e
 
»¥ÚsibË
 
došg
 
ªy


39 
»size
/
»sh­šg
 
	`Ãûs§ry
 (
£e
 
doc¡ršg
 
the
 
´•roûss
 
funùiÚ
).

40 
Ouut
 
şas£s
 
¬e
 
®ways
 
š‹g”s
 
š
 
the
 
¿nge
 [0, 
num_şas£s
). 
Any
 
m­pšg


41 
of
 
the£
 
š‹g”s
 
to
 
£mªtic
 
Ïb–s
 
is
Ø
be
 
hªdËd
 
outside
 oà
this
 
şass
.

43 
By
 , 
D‘eùiÚMod–s
 
´oduû
 
boundšg
 
box
 
d‘eùiÚs
; 
Howev”
, 
we
 
suµÜt


44 
a
 
hªdful
 
of
 
auxŸry
 
ªnÙ©iÚs
 
assocŸ‹d
 
w™h
 
—ch
 
boundšg
 
box
, 
Çm–y
,

45 
š¡ªû
 
masks
 
ªd
 
keypošts
.

47 
äom
 
abc
 
impÜt
 
ABCM‘a


48 
äom
 
abc
 
impÜt
 
ab¡¿ùm‘hod


50 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
¡ªd¬d_f›lds
 
as
 
f›lds


53 
şass
 
	$D‘eùiÚMod–
(
objeù
):

55 
__m‘aşass__
 = 
ABCM‘a


57 
def
 
	$__š™__
(
£lf
, 
num_şas£s
):

60 
Args
:

61 
num_şas£s
: 
numb”
 
of
 
şas£s
. 
NÙe
 
th©
‚um_şas£ *
dÛs
 
nÙ
* 
šşude


62 
background
 
ÿ‹gÜ›s
 
th©
 
might
 
be
 
im¶ic™ly
 b
´ediùed
 
š
 
v¬ious


63 
im¶em’tiÚs
.

65 
£lf
.
_num_şas£s
 = 
num_şas£s


66 
£lf
.
_groundŒuth_li¡s
 = {
	}
}

68 @
´İ”ty


69 
def
 
	$num_şas£s
(
£lf
):

70  
£lf
.
_num_şas£s


72 
def
 
	$groundŒuth_li¡s
(
£lf
, 
f›ld
):

75 
Args
:

76 
f›ld
: 
a
 
¡ršg
 
key
, 
İtiÚs
 
¬e


77 
f›lds
.
BoxLi¡F›lds
.{
boxes
,
şas£s
,
masks
,
keypošts
}

79 
R‘uºs
:

80 
a
 
li¡
 
of
 
‹nsÜs
 
hŞdšg
 
groundŒuth
 
šfÜm©iÚ
 (
£e
 
®so


81 
´ovide_groundŒuth
 
funùiÚ
 
b–ow
), 
w™h
 
Úe
 
’Œy
 
—ch
 
image
 
š
 
the


82 
b©ch
.

83 
Rai£s
:

84 
RuÁimeE¼Ü
: 
the
 
f›ld
 
has
 
nÙ
 
b“n
 
´ovided
 
vŸ
 
´ovide_groundŒuth
.

86 
f›ld
 
nÙ
 
š
 
£lf
.
_groundŒuth_li¡s
:

87 
¿i£
 
RuÁimeE¼Ü
('GroundŒuth’sÜ % ha nÙ b“À´ovided', 
f›ld
)

88  
£lf
.
_groundŒuth_li¡s
[
f›ld
]

90 @
ab¡¿ùm‘hod


91 
def
 
	$´•roûss
(
£lf
, 
šputs
):

94 
To
 
be
 
ov”ridd’
 
by
 
im¶em’tiÚs
.

96 
This
 
funùiÚ
 
is
 
»¥ÚsibË
 
ªy
 
sÿlšg
/
shiášg
 
of
 
šput
 
v®ues
 
th©


97 
is
 
Ãûs§ry
 
´iÜ
 
to
 
ruÂšg
 
the
 
d‘eùÜ
 
Ú
 
ª
 
šput
 
image
.

98 
It
 
is
 
®so
 
»¥ÚsibË
 
ªy
 
»sizšg
 
th©
 
might
 
be
 
Ãûs§ry
 
as
 
images


99 
¬e
 
assumed
 
to
 
¬rive
 
š
 
¬b™¿ry
 
sizes
. 
Whe
 
this
 
funùiÚ
 
could


100 
cÚûivably
 
be
 
·¹
 
of
 
the
 
´ediù
 
	`m‘hod
 (
b–ow
), 
™
 
is
 
oá’
 
cÚv’›Á


101 
to
 
k“p
 
the£
 
£·¿‹
 --- 
exam¶e
, 
we
 
may
 
wªt
Ø
´•roûss
 
Ú
 
Úe


102 
deviû
, 
¶aû
 
Úto
 
a
 
queue
, 
ªd
 
Ët
 
ªÙh”
 
	$deviû
 (
e
.
g
., 
the
 
GPU
è
hªdË


103 
´ediùiÚ
.

105 
A
 
ãw
 
impÜÁ
 
nÙes
 
about
 
the
 
´•roûss
 
funùiÚ
:

106 + 
We
 
assume
 
th©
 
this
 
İ”©iÚ
 
dÛs
 
nÙ
 
have
 
ªy
 
ŒašabË
 
v¬ŸbËs
 
nÜ


107 
dÛs
 
™
 
afãù
 
the
 
groundŒuth
 
ªnÙ©iÚs
 
š
 
ªy
 
	`way
 (
thus
 
d©a


108 
augm’tiÚ
 
İ”©iÚs
 
such
 
as
 
¿ndom
 
üİpšg
 
should
 
be
 
³rfÜmed


109 
ex‹º®ly
).

110 + 
Th”e
 
is
 
no
 
assum±iÚ
 
th©
 
the
 
b©chsize
 
š
 
this
 
funùiÚ
 i th
§me
 
as


111 
the
 
b©ch
 
size
 
š
h
´ediù
 
funùiÚ
. 
In
 
çù
, 
we
 
»comm’d
 
ÿÎšg
he

112 
´•roûss
 
funùiÚ
 
´iÜ
 
to
 
ÿÎšg
 
ªy
 
b©chšg
 
	$İ”©iÚs
 (
which
 
should


113 
h­³n
 
outside
 
of
 
the
 
mod–
è
ªd
 
thus
 
assumšg
 
th©
 
b©ch
 
sizes
 
¬e
 
equ®


114 
to
 1 
š
 
the
 
´•roûss
 
funùiÚ
.

115 + 
Th”e
 
is
 
®so
 
no
 
ex¶ic™
 
assum±iÚ
 
th©
 
the
 
ouut
 
»sŞutiÚs


116 
mu¡
 
be
 
fixed
 
aüoss
 
šputs
 --- 
this
 
is
 
to
 
suµÜt
 "fully convolutional"

117 
£‰šgs
 
š
 
which
 
šput
 
images
 
ÿn
 
have
 
difã»Á
 
sh­es
/
»sŞutiÚs
.

119 
Args
:

120 
šputs
: 
a
 [
b©ch
, 
height_š
, 
width_š
, 
chªÃls
] 
æßt32
 
‹nsÜ


121 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
 
w™h
 
v®ues
 
b‘w“n
 0 
ªd
 255.0.

123 
R‘uºs
:

124 
´•roûs£d_šputs
: 
a
 [
b©ch
, 
height_out
, 
width_out
, 
chªÃls
] 
æßt32


125 
‹nsÜ
 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

127 
·ss


129 @
ab¡¿ùm‘hod


130 
def
 
	$´ediù
(
£lf
, 
´•roûs£d_šputs
):

133 
Ouuts
 
of
 
this
 
funùiÚ
 
ÿn
 
be
 
·s£d
 
to
 
loss
 
Ü
 
po¡´oûss
 
funùiÚs
.

135 
Args
:

136 
´•roûs£d_šputs
: 
a
 [
b©ch
, 
height
, 
width
, 
chªÃls
] 
æßt32
 
‹nsÜ


137 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

139 
R‘uºs
:

140 
´ediùiÚ_diù
: 
a
 
diùiÚ¬y
 
hŞdšg
 
´ediùiÚ
 
‹nsÜs
 
to
 
be


141 
·s£d
 
to
 
the
 
Loss
 
Ü
 
Po¡´oûss
 
funùiÚs
.

143 
·ss


145 @
ab¡¿ùm‘hod


146 
def
 
	$po¡´oûss
(
£lf
, 
´ediùiÚ_diù
, **
·¿ms
):

149 
Ouuts
 
adh”e
 
to
 
the
 
fŞlowšg
 
cÚv’tiÚs
:

150 * 
CÏs£s
 
¬e
 
š‹g”s
 
š
 [0, 
num_şas£s
); 
background
 
şas£s
‡» 
»moved


151 
ªd
 
the
 
fœ¡
 
nÚ
-
background
 
şass
 
is
 
m­³d
 
to
 0.

152 * 
Boxes
 
¬e
 
to
 
be
 
š‹½»‹d
 
as
 
bešg
 
š
 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
]

153 
fÜm©
 
ªd
 
nÜm®ized
 
»Ïtive
 
to
 
the
 
image
 
wšdow
.

154 * `
num_d‘eùiÚs
` 
is
 
´ovided
 
£‰šgs
 
wh”e
 
d‘eùiÚs
 
¬e
 
·dded
 
to
 
a


155 
fixed
 
numb”
 
of
 
boxes
.

156 * 
We
 dØ
nÙ
 
¥ecifiÿÎy
 
assume
 
ªy
 
kšd
 
of
 
´obabi¡ic
 
š‹½»tiÚ


157 
of
 
the
 
scÜes
 ---h
Úly
 
impÜÁ
 
thšg
 
is
 
theœ
 
»Ïtive
 
Üd”šg
.

158 
Thus
 
im¶em’tiÚs
 
of
 
the
 
po¡´oûss
 
funùiÚ
 
¬e
 
ä“
 
to
 
ouut


159 
log™s
, 
´obab™›s
, 
ÿlib¿‹d
…robab™›s, 
Ü
 
ªythšg
 .

161 
Args
:

162 
´ediùiÚ_diù
: 
a
 
diùiÚ¬y
 
hŞdšg
 
´ediùiÚ
 
‹nsÜs
.

163 **
·¿ms
: 
Add™iÚ®
 
keywÜd
 
¬gum’ts
 
¥ecific
 
im¶em’tiÚs
 
of


164 
D‘eùiÚMod–
.

166 
R‘uºs
:

167 
d‘eùiÚs
: 
a
 
diùiÚ¬y
 
cÚššg
 
the
 
fŞlowšg
 
f›lds


168 
d‘eùiÚ_boxes
: [
b©ch
, 
max_d‘eùiÚs
, 4]

169 
d‘eùiÚ_scÜes
: [
b©ch
, 
max_d‘eùiÚs
]

170 
d‘eùiÚ_şas£s
: [
b©ch
, 
max_d‘eùiÚs
]

171 
š¡ªû_masks
: [
b©ch
, 
max_d‘eùiÚs
, 
image_height
, 
image_width
]

172 (
İtiÚ®
)

173 
keypošts
: [
b©ch
, 
max_d‘eùiÚs
, 
num_keypošts
, 2] (
İtiÚ®
)

174 
num_d‘eùiÚs
: [
b©ch
]

176 
·ss


178 @
ab¡¿ùm‘hod


179 
def
 
	$loss
(
£lf
, 
´ediùiÚ_diù
):

182 
C®lšg
 
this
 
funùiÚ
 
»quœes
 
th©
 
groundŒuth
 
‹nsÜs
 
have
 
b“n


183 
´ovided
 
vŸ
 
the
 
´ovide_groundŒuth
 
funùiÚ
.

185 
Args
:

186 
´ediùiÚ_diù
: 
a
 
diùiÚ¬y
 
hŞdšg
 
´ediùed
 
‹nsÜs


188 
R‘uºs
:

189 
a
 
diùiÚ¬y
 
m­pšg
 
	$¡ršgs
 (
loss
 
Çmes
è
to
 
sÿÏr
 
‹nsÜs
 
»´e£Ášg


190 
loss
 
v®ues
.

192 
·ss


194 
def
 
	$´ovide_groundŒuth
(
£lf
,

195 
groundŒuth_boxes_li¡
,

196 
groundŒuth_şas£s_li¡
,

197 
groundŒuth_masks_li¡
=
NÚe
,

198 
groundŒuth_keypošts_li¡
=
NÚe
):

201 
Args
:

202 
groundŒuth_boxes_li¡
: 
a
 
li¡
 
of
 2-
D
 
tf
.
æßt32
 
‹nsÜs
 oà
sh­e


203 [
num_boxes
, 4] 
cÚššg
 
coÜdš©es
 
of
 
the
 
groundŒuth
 
boxes
.

204 
GroundŒuth
 
boxes
 
¬e
 
´ovided
 
š
 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
]

205 
fÜm©
 
ªd
 
assumed
 
to
 
be
 
nÜm®ized
‡nd 
ş³d


206 
»Ïtive
 
to
 
the
 
image
 
wšdow
 
w™h
 
y_mš
 <ğ
y_max
 
ªd
 
x_mš
 <ğ
x_max
.

207 
groundŒuth_şas£s_li¡
: 
a
 
li¡
 
of
 2-
D
 
tf
.
æßt32
 
Úe
-
	`hÙ
 (
Ü
 
k
-
hÙ
)

208 
‹nsÜs
 
of
 
sh­e
 [
num_boxes
, 
num_şas£s
] 
cÚššg
 
the
 
şass
 
rg‘s


209 
w™h
 
the
 0
th
 
šdex
 
assumed
 
to
 
m­
Øth
fœ¡
 
nÚ
-
background
 
şass
.

210 
groundŒuth_masks_li¡
: 
a
 
li¡
 
of
 2-
D
 
tf
.
æßt32
 
‹nsÜs
 of

211 
sh­e
 [
max_d‘eùiÚs
, 
height_š
, 
width_š
] 
cÚššg
 
š¡ªû


212 
masks
 
w™h
 
v®ues
 
š
 {0, 1
	}
}. 
If
 
	gNÚe
, 
no
 mask 
¬e
 
	g´ovided
.

213 
Mask
 
	g»sŞutiÚ
 `
	gheight_š
`
	gx
`
	gwidth_š
` 
mu¡
 
ag»e
 
w™h
 
the
 
»sŞutiÚ


214 
of
 
the
 
šput
 
image
 
‹nsÜ
 
´ovided
 
to
 
	gthe
 `
	g´•roûss
` 
	gfunùiÚ
.

215 
	ggroundŒuth_keypošts_li¡
: 
a
 
li¡
 
of
 2-
D
 
tf
.
æßt32
 
‹nsÜs
 of

216 
sh­e
 [
b©ch
, 
max_d‘eùiÚs
, 
num_keypošts
, 2] 
cÚššg
 
	gkeypošts
.

217 
Keypošts
 
¬e
 
assumed
 
to
 
be
 
´ovided
 
š
 
nÜm®ized
 
coÜdš©es
 
ªd


218 
missšg
 
keypošts
 
should
 
be
 
’coded
 
as
 
	gNaN
.

220 
	g£lf
.
	g_groundŒuth_li¡s
[
f›lds
.
BoxLi¡F›lds
.
boxes
] = 
groundŒuth_boxes_li¡


221 
£lf
.
_groundŒuth_li¡s
[

222 
f›lds
.
BoxLi¡F›lds
.
şas£s
] = 
groundŒuth_şas£s_li¡


223 
groundŒuth_masks_li¡
:

224 
£lf
.
_groundŒuth_li¡s
[

225 
f›lds
.
BoxLi¡F›lds
.
masks
] = 
groundŒuth_masks_li¡


226 
groundŒuth_keypošts_li¡
:

227 
£lf
.
_groundŒuth_li¡s
[

228 
f›lds
.
BoxLi¡F›lds
.
keypošts
] = 
groundŒuth_keypošts_li¡


230 @
ab¡¿ùm‘hod


231 
def
 
	$»¡Üe_m­
(
£lf
, 
äom_d‘eùiÚ_checkpošt
=
True
):

234 
R‘uºs
 
a
 
m­
 
of
 
v¬ŸbË
 
Çmes
 
to
 
lßd
 
äom
‡ 
checkpošt
Ø
v¬ŸbËs
 
š


235 
the
 
mod–
 
g¿ph
. 
This
 
’abËs
hmod– 
to
 
š™Ÿlize
 
ba£d
 
Ú
 
weights
 
äom


236 
ªÙh”
 
sk
. 
FÜ
 
exam¶e
, 
the
 
ã©u»
 
exŒaùÜ
 
v¬ŸbËs
 
äom
 
a


237 
şassifiÿtiÚ
 
mod–
 
ÿn
 
be
 
u£d
 
to
 
boÙ¡¿p
 
Œaššg
 
of
 
ª
 
objeù


238 
d‘eùÜ
. 
Wh’
 
lßdšg
 
äom
 
ª
 
objeù
 
d‘eùiÚ
 
mod–
, 
the
 
checkpošt
 model

239 
should
 
have
 
the
 
§me
 
·¿m‘”s
 
as
 
this
 
d‘eùiÚ
 
mod–
 
w™h
 
exû±iÚ
 
of


240 
the
 
num_şas£s
 
·¿m‘”
.

242 
Args
:

243 
äom_d‘eùiÚ_checkpošt
: 
wh‘h”
 
to
 
»¡Üe
 
äom
 
a
 
fuÎ
 
d‘eùiÚ


244 
	$checkpošt
 (
w™h
 
com·tibË
 
v¬ŸbË
 
Çmes
è
Ü
 
to
 
»¡Üe
 
äom
 
a


245 
şassifiÿtiÚ
 
checkpošt
 
š™Ÿliz©iÚ
 
´iÜ
 
to
 
Œaššg
.

247 
R‘uºs
:

248 
A
 
diù
 
m­pšg
 
v¬ŸbË
 
	$Çmes
 (
to
 
lßd
 
äom
 
a
 
checkpošt
ètØ
v¬ŸbËs
 
š


249 
the
 
mod–
 
g¿ph
.

251 
·ss


	@core/post_processing.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


21 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡_İs


22 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
¡ªd¬d_f›lds
 
as
 
f›lds


25 
def
 
	$muÉişass_nÚ_max_suµ»ssiÚ
(
boxes
,

26 
scÜes
,

27 
scÜe_th»sh
,

28 
iou_th»sh
,

29 
max_size_³r_şass
,

30 
max_tÙ®_size
=0,

31 
ş_wšdow
=
NÚe
,

32 
chªge_coÜdš©e_äame
=
F®£
,

33 
masks
=
NÚe
,

34 
add™iÚ®_f›lds
=
NÚe
,

35 
scİe
=
NÚe
):

38 
This
 
İ
 
g»edy
 
£Ëùs
 
a
 
sub£t
 
of
 
d‘eùiÚ
 
boundšg
 
boxes
, 
´unšg


39 
away
 
boxes
 
th©
 
have
 
high
 
	$IOU
 (
š‹r£ùiÚ
 
ov”
 è
	`ov”Ïp
 (> 
th»sh
)

40 
w™h
 
®»ady
 
£Ëùed
 
boxes
. 
It
 
İ”©es
 
šd•’d’y
 
—ch
 
şass
 

41 
which
 
scÜes
 
¬e
 
	`´ovided
 (
vŸ
 
the
 scÜe 
f›ld
 
of
h
šput
 
box_li¡
),

42 
´unšg
 
boxes
 
w™h
 
scÜe
 
Ëss
 
thª
 
a
 
´ovided
 
th»shŞd
 
´iÜ
 
to


43 
­¶yšg
 
NMS
.

45 
PËa£
 
nÙe
 
th©
 
this
 
İ”©iÚ
 
is
 
³rfÜmed
 
Ú
 *
®l
* 
şas£s
, 
th”efÜe
 
ªy


46 
background
 
şas£s
 
should
 
be
 
»moved
 
´iÜ
 
to
 
ÿÎšg
 
this
 
funùiÚ
.

48 
Args
:

49 
boxes
: 
A
 [
k
, 
q
, 4] 
æßt32
 
‹nsÜ
 
cÚššg
 k 
d‘eùiÚs
. `q` 
ÿn
 
be
 
e™h”


50 
numb”
 
of
 
şas£s
 
Ü
 1 
d•’dšg
 
Ú
 
wh‘h”
 
a
 
£·¿‹
 
box
 
is
 
´ediùed


51 
³r
 
şass
.

52 
scÜes
: 
A
 [
k
, 
num_şas£s
] 
æßt32
 
‹nsÜ
 
cÚššg
 
the
 scÜe 
—ch
 
of


53 
the
 
k
 
d‘eùiÚs
.

54 
scÜe_th»sh
: 
sÿÏr
 
th»shŞd
 
	`scÜe
 (
low
 
scÜšg
 
boxes
 
¬e
 
»moved
).

55 
iou_th»sh
: 
sÿÏr
 
th»shŞd
 
	`IOU
 (
Ãw
 
boxes
 
th©
 
have
 
high
 
IOU
 
ov”Ïp


56 
w™h
 
´eviou¦y
 
£Ëùed
 
boxes
 
¬e
 
»moved
).

57 
max_size_³r_şass
: 
maximum
 
numb”
 
of
 
»šed
 
boxes
 
³r
 
şass
.

58 
max_tÙ®_size
: 
maximum
 
numb”
 
of
 
boxes
 
»šed
 
ov”
 
®l
 
şas£s
. 
By


59  
»tuºs
 
®l
 
boxes
 
»šed
 
aá”
 
ÿµšg
 boxe 
³r
 
şass
.

60 
ş_wšdow
: 
A
 
æßt32
 
‹nsÜ
 
of
 
the
 
fÜm
 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
]

61 
»´e£Ášg
 
the
 
wšdow
 
to
 
ş
 
ªd
 
nÜm®ize
 
boxes
Ø
befÜe
 
³rfÜmšg


62 
nÚ
-
max
 
suµ»ssiÚ
.

63 
chªge_coÜdš©e_äame
: 
Wh‘h”
 
to
 
nÜm®ize
 
coÜdš©es
 
aá”
 
şpšg


64 
»Ïtive
 
to
 
	$ş_wšdow
 (
this
 
ÿn
 
Úly
 
be
 
£t
 
to
 
True
 
a
 
ş_wšdow


65 
is
 
´ovided
)

66 
masks
: (
İtiÚ®
è
a
 [
k
, 
q
, 
mask_height
, 
mask_width
] 
æßt32
 
‹nsÜ


67 
cÚššg
 
box
 
masks
. `
q
` 
ÿn
 
be
 
e™h”
 
numb”
 
of
 
şas£s
 
Ü
 1 
d•’dšg


68 
Ú
 
wh‘h”
 
a
 
£·¿‹
 
mask
 
is
 
´ediùed
 
³r
 
şass
.

69 
add™iÚ®_f›lds
: (
İtiÚ®
è
If
 
nÙ
 
NÚe
, 
a
 
diùiÚ¬y
 
th©
 
m­s
 
keys
 
to


70 
‹nsÜs
 
who£
 
fœ¡
 
dim’siÚs
 
¬e
 
®l
 
of
 
size
 `
k
`. 
Aá”
 
nÚ
-
maximum


71 
suµ»ssiÚ
, 
®l
 
‹nsÜs
 
cÜ»¥Údšg
 
to
 
the
 
£Ëùed
 
boxes
 
wl
 
be


72 
added
 
to
 
»suÉšg
 
BoxLi¡
.

73 
scİe
: 
Çme
 scope.

75 
R‘uºs
:

76 
a
 
BoxLi¡
 
hŞdšg
 
M
 
boxes
 
w™h
‡ 
¿nk
-1 
scÜes
 
f›ld
 
»´e£Ášg


77 
cÜ»¥Údšg
 
scÜes
 
—ch
 
box
 
w™h
 scÜe 
sÜ‹d
 
š
 
deü—sšg
 
Üd”


78 
ªd
 
a
 
¿nk
-1 
şas£s
 
f›ld
 
»´e£Ášg
‡ 
şass
 
Ïb–
 
—ch
 
box
.

79 
If
 
masks
, 
keypošts
, 
keypošt_h—tm­s
 
is
 
nÙ
 
NÚe
, 
the
 
boxli¡
 
wl


80 
cÚš
 
masks
, 
keypošts
, 
keypošt_h—tm­s
 
cÜ»¥Údšg
 
to
 
boxes
.

82 
Rai£s
:

83 
V®ueE¼Ü
: 
iou_th»sh
 
is
 
nÙ
 
š
 [0, 1] 
Ü
 
šput
 
boxli¡
 
dÛs
‚Ù 
have


84 
a
 
v®id
 
scÜes
 
f›ld
.

86 
nÙ
 0 <ğ
iou_th»sh
 <= 1.0:

87 
¿i£
 
	`V®ueE¼Ü
('iou_thresh must be between 0‡nd 1')

88 
scÜes
.
sh­e
.
ndims
 != 2:

89 
¿i£
 
	`V®ueE¼Ü
('scores field must be of„ank 2')

90 
scÜes
.
sh­e
[1].
v®ue
 
is
 
NÚe
:

91 
¿i£
 
	`V®ueE¼Ü
('scores must have statically defined second '

93 
boxes
.
sh­e
.
ndims
 != 3:

94 
¿i£
 
	`V®ueE¼Ü
('boxes must be of„ank 3.')

95 
	$nÙ
 (
boxes
.
sh­e
[1].
v®ue
 =ğ
scÜes
.sh­e[1].v®u
Ü


96 
boxes
.
sh­e
[1].
v®ue
 == 1):

97 
¿i£
 
	`V®ueE¼Ü
('second dimension of boxes must beƒither 1 orƒqual '

99 
boxes
.
sh­e
[2].
v®ue
 != 4:

100 
¿i£
 
	`V®ueE¼Ü
('last dimension of boxes must be of size 4.')

101 
chªge_coÜdš©e_äame
 
ªd
 
ş_wšdow
 
is
 
NÚe
:

102 
¿i£
 
	`V®ueE¼Ü
('if change_coordinate_frame is True,hen‡ clip_window'

105 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'MultiClassNonMaxSuppression'):

106 
num_boxes
 = 
tf
.
	`sh­e
(
boxes
)[0]

107 
num_scÜes
 = 
tf
.
	`sh­e
(
scÜes
)[0]

108 
num_şas£s
 = 
scÜes
.
	`g‘_sh­e
()[1]

110 
Ëngth_as£¹
 = 
tf
.
	`As£¹
(

111 
tf
.
	`equ®
(
num_boxes
, 
num_scÜes
),

113 
num_scÜes
, 
num_boxes
])

115 
£Ëùed_boxes_li¡
 = []

116 
³r_şass_boxes_li¡
 = 
tf
.
	$un¡ack
(
boxes
, 
axis
=1)

117 
masks
 
is
 
nÙ
 
NÚe
:

118 
³r_şass_masks_li¡
 = 
tf
.
	$un¡ack
(
masks
, 
axis
=1)

119 
boxes_ids
 = (
	$¿nge
(
num_şas£s
è
	`Ën
(
³r_şass_boxes_li¡
) > 1

120 [0] * 
num_şas£s
)

121 
şass_idx
, 
boxes_idx
 
š
 
	`z
(
	`¿nge
(
num_şas£s
), 
boxes_ids
):

122 
³r_şass_boxes
 = 
³r_şass_boxes_li¡
[
boxes_idx
]

123 
boxli¡_ªd_şass_scÜes
 = 
box_li¡
.
	$BoxLi¡
(
³r_şass_boxes
)

124 
w™h
 
tf
.
	$cÚŒŞ_d•’d’c›s
([
Ëngth_as£¹
]):

125 
şass_scÜes
 = 
tf
.
	`»sh­e
(

126 
tf
.
	`¦iû
(
scÜes
, [0, 
şass_idx
],f.
	`¡ack
([
num_scÜes
, 1])), [-1])

127 
boxli¡_ªd_şass_scÜes
.
	$add_f›ld
(
f›lds
.
BoxLi¡F›lds
.
scÜes
,

128 
şass_scÜes
)

129 
masks
 
is
 
nÙ
 
NÚe
:

130 
³r_şass_masks
 = 
³r_şass_masks_li¡
[
boxes_idx
]

131 
boxli¡_ªd_şass_scÜes
.
	$add_f›ld
(
f›lds
.
BoxLi¡F›lds
.
masks
,

132 
³r_şass_masks
)

133 
add™iÚ®_f›lds
 
is
 
nÙ
 
NÚe
:

134 
key
, 
‹nsÜ
 
š
 
add™iÚ®_f›lds
.
	$™ems
():

135 
boxli¡_ªd_şass_scÜes
.
	$add_f›ld
(
key
, 
‹nsÜ
)

136 
boxli¡_f‹»d
 = 
box_li¡_İs
.
	$f‹r_g»©”_thª
(

137 
boxli¡_ªd_şass_scÜes
, 
scÜe_th»sh
)

138 
ş_wšdow
 
is
 
nÙ
 
NÚe
:

139 
boxli¡_f‹»d
 = 
box_li¡_İs
.
	$ş_to_wšdow
(

140 
boxli¡_f‹»d
, 
ş_wšdow
)

141 
chªge_coÜdš©e_äame
:

142 
boxli¡_f‹»d
 = 
box_li¡_İs
.
	$chªge_coÜdš©e_äame
(

143 
boxli¡_f‹»d
, 
ş_wšdow
)

144 
max_£ËùiÚ_size
 = 
tf
.
	`mšimum
(
max_size_³r_şass
,

145 
boxli¡_f‹»d
.
	$num_boxes
())

146 
£Ëùed_šdiûs
 = 
tf
.
image
.
	`nÚ_max_suµ»ssiÚ
(

147 
boxli¡_f‹»d
.
	`g‘
(),

148 
boxli¡_f‹»d
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
scÜes
),

149 
max_£ËùiÚ_size
,

150 
iou_th»shŞd
=
iou_th»sh
)

151 
nms_»suÉ
 = 
box_li¡_İs
.
	$g©h”
(
boxli¡_f‹»d
, 
£Ëùed_šdiûs
)

152 
nms_»suÉ
.
	`add_f›ld
(

153 
f›lds
.
BoxLi¡F›lds
.
şas£s
, (
tf
.
	`z”os_like
(

154 
nms_»suÉ
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
scÜes
)è+ 
şass_idx
))

155 
£Ëùed_boxes_li¡
.
	$­³nd
(
nms_»suÉ
)

156 
£Ëùed_boxes
 = 
box_li¡_İs
.
	$cÚÿ‹Ç‹
(
£Ëùed_boxes_li¡
)

157 
sÜ‹d_boxes
 = 
box_li¡_İs
.
	$sÜt_by_f›ld
(
£Ëùed_boxes
,

158 
f›lds
.
BoxLi¡F›lds
.
scÜes
)

159 
max_tÙ®_size
:

160 
max_tÙ®_size
 = 
tf
.
	`mšimum
(max_total_size,

161 
sÜ‹d_boxes
.
	$num_boxes
())

162 
sÜ‹d_boxes
 = 
box_li¡_İs
.
	`g©h”
(sorted_boxes,

163 
tf
.
	$¿nge
(
max_tÙ®_size
))

164  
sÜ‹d_boxes


167 
def
 
	$b©ch_muÉişass_nÚ_max_suµ»ssiÚ
(
boxes
,

168 
scÜes
,

169 
scÜe_th»sh
,

170 
iou_th»sh
,

171 
max_size_³r_şass
,

172 
max_tÙ®_size
=0,

173 
ş_wšdow
=
NÚe
,

174 
chªge_coÜdš©e_äame
=
F®£
,

175 
num_v®id_boxes
=
NÚe
,

176 
masks
=
NÚe
,

177 
scİe
=
NÚe
,

178 
·¿Î–_™”©iÚs
=32):

181 
This
 
İ
 
is
 
sim¬
 
to
 `
muÉişass_nÚ_max_suµ»ssiÚ
` 
but
 
İ”©es
 
Ú
 
a
 
b©ch


182 
of
 
boxes
 
ªd
 
scÜes
. 
S“
 
docum’tiÚ
 `
muÉişass_nÚ_max_suµ»ssiÚ
`

183 
d‘as
.

185 
Args
:

186 
boxes
: 
A
 [
b©ch_size
, 
num_ªchÜs
, 
q
, 4] 
æßt32
 
‹nsÜ
 
cÚššg


187 
d‘eùiÚs
. 
If
 `
q
` 
is
 1 
th’
 
§me
 
boxes
 
¬e
 
u£d
 
®l
 
şas£s


188 
Ùh”wi£
, `
q
` 
is
 
equ®
 
to
 
numb”
 
of
 
şas£s
, 
şass
-
¥ecific
 
boxes


189 
¬e
 
u£d
.

190 
scÜes
: 
A
 [
b©ch_size
, 
num_ªchÜs
, 
num_şas£s
] 
æßt32
 
‹nsÜ
 
cÚššg


191 
the
 
scÜes
 
—ch
 
of
h`
num_ªchÜs
` 
d‘eùiÚs
.

192 
scÜe_th»sh
: 
sÿÏr
 
th»shŞd
 
	`scÜe
 (
low
 
scÜšg
 
boxes
 
¬e
 
»moved
).

193 
iou_th»sh
: 
sÿÏr
 
th»shŞd
 
	`IOU
 (
Ãw
 
boxes
 
th©
 
have
 
high
 
IOU
 
ov”Ïp


194 
w™h
 
´eviou¦y
 
£Ëùed
 
boxes
 
¬e
 
»moved
).

195 
max_size_³r_şass
: 
maximum
 
numb”
 
of
 
»šed
 
boxes
 
³r
 
şass
.

196 
max_tÙ®_size
: 
maximum
 
numb”
 
of
 
boxes
 
»šed
 
ov”
 
®l
 
şas£s
. 
By


197  
»tuºs
 
®l
 
boxes
 
»šed
 
aá”
 
ÿµšg
 boxe 
³r
 
şass
.

198 
ş_wšdow
: 
A
 
æßt32
 
‹nsÜ
 
of
 
the
 
fÜm
 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
]

199 
»´e£Ášg
 
the
 
wšdow
 
to
 
ş
 
boxes
Ø
befÜe
 
³rfÜmšg
 
nÚ
-
max


200 
suµ»ssiÚ
.

201 
chªge_coÜdš©e_äame
: 
Wh‘h”
 
to
 
nÜm®ize
 
coÜdš©es
 
aá”
 
şpšg


202 
»Ïtive
 
to
 
	$ş_wšdow
 (
this
 
ÿn
 
Úly
 
be
 
£t
 
to
 
True
 
a
 
ş_wšdow


203 
is
 
´ovided
)

204 
num_v®id_boxes
: (
İtiÚ®
è
a
 
T’sÜ
 
of
 
ty³
 `
št32
`. 
A
 1-
D
 
‹nsÜ
 oà
sh­e


205 [
b©ch_size
] 
»´e£Ášg
 
the
 
numb”
 
of
 
v®id
 
boxes
 
to
 
be
 
cÚsid”ed


206 
—ch
 
image
 
š
 
the
 
b©ch
. 
This
 
·¿m‘”
 
®lows
 
ignÜšg
 
z”o


207 
·ddšgs
.

208 
masks
: (
İtiÚ®
è
a
 [
b©ch_size
, 
num_ªchÜs
, 
q
, 
mask_height
, 
mask_width
]

209 
æßt32
 
‹nsÜ
 
cÚššg
 
box
 
masks
. `
q
` 
ÿn
 
be
 
e™h”
 
numb”
 
of
 
şas£s


210 
Ü
 1 
d•’dšg
 
Ú
 
wh‘h”
 
a
 
£·¿‹
 
mask
 
is
 
´ediùed
 
³r
 
şass
.

211 
scİe
: 
tf
 scİ
Çme
.

212 
·¿Î–_™”©iÚs
: (
İtiÚ®
è
numb”
 
of
 
b©ch
 
™ems
 
to
 
´oûss
 
š


213 
·¿Î–
.

215 
R‘uºs
:

216 'nm£d_boxes': 
A
 [
b©ch_size
, 
max_d‘eùiÚs
, 4] 
æßt32
 
‹nsÜ


217 
cÚššg
 
the
 
nÚ
-
max
 
suµ»s£d
 
boxes
.

218 'nm£d_scÜes': 
A
 [
b©ch_size
, 
max_d‘eùiÚs
] 
æßt32
 
‹nsÜ
 
cÚššg


219 
the
 
scÜes
 th
boxes
.

220 'nm£d_şas£s': 
A
 [
b©ch_size
, 
max_d‘eùiÚs
] 
æßt32
 
‹nsÜ


221 
cÚššg
 
the
 
şass
 
boxes
.

222 'nm£d_masks': (
İtiÚ®
è
a


223 [
b©ch_size
, 
max_d‘eùiÚs
, 
mask_height
, 
mask_width
] 
æßt32
 
‹nsÜ


224 
cÚššg
 
masks
 
—ch
 
£Ëùed
 
box
. 
This
 
is
 
£t
 
to
 
NÚe
 
šput


225 `
masks
` 
is
 
NÚe
.

226 'num_d‘eùiÚs': 
A
 [
b©ch_size
] 
št32
 
‹nsÜ
 
šdiÿtšg
 
the
 
numb”
 
of


227 
v®id
 
d‘eùiÚs
 
³r
 
b©ch
 
™em
. 
OÆy
 
the
 
tİ
 
num_d‘eùiÚs
[
i
] 
’Œ›s
 
š


228 
nms_boxes
[
i
], 
nms_scÜes
[i] 
ªd
 
nms_şass
[i] 
¬e
 
v®id
. 
the
 
»¡
 
of
he

229 
’Œ›s
 
¬e
 
z”o
 
·ddšgs
.

231 
Rai£s
:

232 
V®ueE¼Ü
: `
q
` 
š
 
boxes
.
sh­e
 
is
 
nÙ
 1 
Ü
‚Ù 
equ®
 
to
 
numb”
 
of


233 
şas£s
 
as
 
šã¼ed
 
äom
 
scÜes
.
sh­e
.

235 
q
 = 
boxes
.
sh­e
[2].
v®ue


236 
num_şas£s
 = 
scÜes
.
sh­e
[2].
v®ue


237 
q
 !ğ1 
ªd
 q !ğ
num_şas£s
:

238 
¿i£
 
	`V®ueE¼Ü
('third dimension of boxes must beƒither 1 orƒqual '

241 
Üigš®_masks
 = 
masks


242 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'BatchMultiClassNonMaxSuppression'):

243 
boxes_sh­e
 = 
boxes
.
sh­e


244 
b©ch_size
 = 
boxes_sh­e
[0].
v®ue


245 
num_ªchÜs
 = 
boxes_sh­e
[1].
v®ue


247 
b©ch_size
 
is
 
NÚe
:

248 
b©ch_size
 = 
tf
.
	`sh­e
(
boxes
)[0]

249 
num_ªchÜs
 
is
 
NÚe
:

250 
num_ªchÜs
 = 
tf
.
	`sh­e
(
boxes
)[1]

252 #Ià
num
 
v®id
 
boxes
 
¬’
't…rovided, create one‡nd mark‡ll boxes‡s

254 
num_v®id_boxes
 
is
 
NÚe
:

255 
num_v®id_boxes
 = 
tf
.
	`Úes
([
b©ch_size
], 
dty³
ñf.
št32
è* 
num_ªchÜs


257 #Ià
masks
 
¬’
't…rovided, create dummy masks so we can only have one copy

258 #oà
sšgË_image_nms_â
 
ªd
 
disÿrd
 
the
 
dummy
 
masks
 
aá”
 
m­_â
.

259 
masks
 
is
 
NÚe
:

260 
masks_sh­e
 = 
tf
.
	$¡ack
([
b©ch_size
, 
num_ªchÜs
, 1, 0, 0])

261 
masks
 = 
tf
.
	$z”os
(
masks_sh­e
)

263 
def
 
	$sšgË_image_nms_â
(
¬gs
):

265 (
³r_image_boxes
, 
³r_image_scÜes
, 
³r_image_masks
,

266 
³r_image_num_v®id_boxes
èğ
¬gs


267 
³r_image_boxes
 = 
tf
.
	`»sh­e
(

268 
tf
.
	`¦iû
(
³r_image_boxes
, 3 * [0],

269 
tf
.
	`¡ack
([
³r_image_num_v®id_boxes
, -1, -1])), [-1, 
q
, 4])

270 
³r_image_scÜes
 = 
tf
.
	`»sh­e
(

271 
tf
.
	`¦iû
(
³r_image_scÜes
, [0, 0],

272 
tf
.
	`¡ack
([
³r_image_num_v®id_boxes
, -1])),

273 [-1, 
num_şas£s
])

275 
³r_image_masks
 = 
tf
.
	`»sh­e
(

276 
tf
.
	`¦iû
(
³r_image_masks
, 4 * [0],

277 
tf
.
	`¡ack
([
³r_image_num_v®id_boxes
, -1, -1, -1])),

278 [-1, 
q
, 
³r_image_masks
.
sh­e
[2].
v®ue
,

279 
³r_image_masks
.
sh­e
[3].
v®ue
])

280 
nm£d_boxli¡
 = 
	$muÉişass_nÚ_max_suµ»ssiÚ
(

281 
³r_image_boxes
,

282 
³r_image_scÜes
,

283 
scÜe_th»sh
,

284 
iou_th»sh
,

285 
max_size_³r_şass
,

286 
max_tÙ®_size
,

287 
masks
=
³r_image_masks
,

288 
ş_wšdow
=clip_window,

289 
chªge_coÜdš©e_äame
=change_coordinate_frame)

290 
·dded_boxli¡
 = 
box_li¡_İs
.
	$·d_Ü_ş_box_li¡
(
nm£d_boxli¡
,

291 
max_tÙ®_size
)

292 
num_d‘eùiÚs
 = 
nm£d_boxli¡
.
	$num_boxes
()

293 
nm£d_boxes
 = 
·dded_boxli¡
.
	$g‘
()

294 
nm£d_scÜes
 = 
·dded_boxli¡
.
	$g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
scÜes
)

295 
nm£d_şas£s
 = 
·dded_boxli¡
.
	$g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
şas£s
)

296 
nm£d_masks
 = 
·dded_boxli¡
.
	$g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
masks
)

297  [
nm£d_boxes
, 
nm£d_scÜes
, 
nm£d_şas£s
, 
nm£d_masks
,

298 
num_d‘eùiÚs
]

300 (
b©ch_nm£d_boxes
, 
b©ch_nm£d_scÜes
,

301 
b©ch_nm£d_şas£s
, 
b©ch_nm£d_masks
,

302 
b©ch_num_d‘eùiÚs
èğ
tf
.
	$m­_â
(

303 
sšgË_image_nms_â
,

304 
–ems
=[
boxes
, 
scÜes
, 
masks
, 
num_v®id_boxes
],

305 
dty³
=[
tf
.
æßt32
,f.æßt32,f.æßt32,f.æßt32,f.
št32
],

306 
·¿Î–_™”©iÚs
=parallel_iterations)

308 
Üigš®_masks
 
is
 
NÚe
:

309 
b©ch_nm£d_masks
 = 
NÚe


311  (
b©ch_nm£d_boxes
, 
b©ch_nm£d_scÜes
, 
b©ch_nm£d_şas£s
,

312 
b©ch_nm£d_masks
, 
b©ch_num_d‘eùiÚs
)

	@core/post_processing_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
numpy
 
as
 
Å


18 
impÜt
 
‹nsÜæow
 
as
 
tf


19 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
po¡_´oûssšg


20 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
¡ªd¬d_f›lds
 
as
 
f›lds


23 
şass
 
	$MuÉişassNÚMaxSuµ»ssiÚTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

25 
def
 
	$‹¡_w™h_šv®id_scÜes_size
(
£lf
):

26 
boxes
 = 
tf
.
	`cÚ¡ªt
([[[0, 0, 1, 1]],

31 [[0, 100, 1, 101]]], 
tf
.
æßt32
)

32 
scÜes
 = 
tf
.
	$cÚ¡ªt
([[.9], [.75], [.6], [.95], [.5]])

33 
iou_th»sh
 = .5

34 
scÜe_th»sh
 = 0.6

35 
max_ouut_size
 = 3

36 
nms
 = 
po¡_´oûssšg
.
	$muÉişass_nÚ_max_suµ»ssiÚ
(

37 
boxes
, 
scÜes
, 
scÜe_th»sh
, 
iou_th»sh
, 
max_ouut_size
)

38 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

39 
w™h
 
£lf
.
	`as£¹Rai£sW™hP»diÿ‹M©ch
(

40 
tf
.
”rÜs
.
Inv®idArgum’tE¼Ü
, 'Incorrect scores field†ength'):

41 
£ss
.
	`run
(
nms
.
	$g‘
())

43 
def
 
	$‹¡_muÉişass_nms_£Ëù_w™h_sh¬ed_boxes
(
£lf
):

44 
boxes
 = 
tf
.
	`cÚ¡ªt
([[[0, 0, 1, 1]],

51 [[0, 1000, 1, 1002.1]]], 
tf
.
æßt32
)

52 
scÜes
 = 
tf
.
	$cÚ¡ªt
([[.9, 0.01], [.75, 0.05],

56 
scÜe_th»sh
 = 0.1

57 
iou_th»sh
 = .5

58 
max_ouut_size
 = 4

60 
exp_nms_cÜÃrs
 = [[0, 10, 1, 11],

64 
exp_nms_scÜes
 = [.95, .9, .85, .3]

65 
exp_nms_şas£s
 = [0, 0, 1, 0]

67 
nms
 = 
po¡_´oûssšg
.
	$muÉişass_nÚ_max_suµ»ssiÚ
(

68 
boxes
, 
scÜes
, 
scÜe_th»sh
, 
iou_th»sh
, 
max_ouut_size
)

69 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

70 
nms_cÜÃrs_ouut
, 
nms_scÜes_ouut
, 
nms_şas£s_ouut
 = 
£ss
.
	`run
(

71 [
nms
.
	`g‘
(),‚ms.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
scÜes
),

72 
nms
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
şas£s
)])

73 
£lf
.
	$as£¹AÎClo£
(
nms_cÜÃrs_ouut
, 
exp_nms_cÜÃrs
)

74 
£lf
.
	$as£¹AÎClo£
(
nms_scÜes_ouut
, 
exp_nms_scÜes
)

75 
£lf
.
	$as£¹AÎClo£
(
nms_şas£s_ouut
, 
exp_nms_şas£s
)

77 
def
 
	$‹¡_muÉişass_nms_£Ëù_w™h_sh¬ed_boxes_giv’_keypošts
(
£lf
):

78 
boxes
 = 
tf
.
	`cÚ¡ªt
([[[0, 0, 1, 1]],

85 [[0, 1000, 1, 1002.1]]], 
tf
.
æßt32
)

86 
scÜes
 = 
tf
.
	$cÚ¡ªt
([[.9, 0.01], [.75, 0.05],

90 
num_keypošts
 = 6

91 
keypošts
 = 
tf
.
	`te
(

92 
tf
.
	`»sh­e
Ñf.
	`¿nge
(8), [8, 1, 1]),

93 [1, 
num_keypošts
, 2])

94 
scÜe_th»sh
 = 0.1

95 
iou_th»sh
 = .5

96 
max_ouut_size
 = 4

98 
exp_nms_cÜÃrs
 = [[0, 10, 1, 11],

102 
exp_nms_scÜes
 = [.95, .9, .85, .3]

103 
exp_nms_şas£s
 = [0, 0, 1, 0]

104 
exp_nms_keypošts_‹nsÜ
 = 
tf
.
	`te
(

105 
tf
.
	`»sh­e
Ñf.
	`cÚ¡ªt
([3, 0, 6, 5], 
dty³
ñf.
æßt32
), [4, 1, 1]),

106 [1, 
num_keypošts
, 2])

108 
nms
 = 
po¡_´oûssšg
.
	`muÉişass_nÚ_max_suµ»ssiÚ
(

109 
boxes
, 
scÜes
, 
scÜe_th»sh
, 
iou_th»sh
, 
max_ouut_size
,

110 
add™iÚ®_f›lds
={

111 
f›lds
.
BoxLi¡F›lds
.
keypošts
: 
	}
keypoints})

113 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

114 (
nms_cÜÃrs_ouut
,

115 
nms_scÜes_ouut
,

116 
nms_şas£s_ouut
,

117 
nms_keypošts
,

118 
exp_nms_keypošts
èğ
£ss
.
	`run
([

119 
nms
.
	`g‘
(),

120 
nms
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
scÜes
),

121 
nms
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
şas£s
),

122 
nms
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
keypošts
),

123 
exp_nms_keypošts_‹nsÜ


125 
£lf
.
	$as£¹AÎClo£
(
nms_cÜÃrs_ouut
, 
exp_nms_cÜÃrs
)

126 
£lf
.
	$as£¹AÎClo£
(
nms_scÜes_ouut
, 
exp_nms_scÜes
)

127 
£lf
.
	$as£¹AÎClo£
(
nms_şas£s_ouut
, 
exp_nms_şas£s
)

128 
£lf
.
	$as£¹AÎEqu®
(
nms_keypošts
, 
exp_nms_keypošts
)

130 
def
 
	$‹¡_muÉişass_nms_w™h_sh¬ed_boxes_giv’_keypošt_h—tm­s
(
£lf
):

131 
boxes
 = 
tf
.
	`cÚ¡ªt
([[[0, 0, 1, 1]],

138 [[0, 1000, 1, 1002.1]]], 
tf
.
æßt32
)

140 
scÜes
 = 
tf
.
	$cÚ¡ªt
([[.9, 0.01], [.75, 0.05],

145 
num_boxes
 = 
tf
.
	`sh­e
(
boxes
)[0]

146 
h—tm­_height
 = 5

147 
h—tm­_width
 = 5

148 
num_keypošts
 = 17

149 
keypošt_h—tm­s
 = 
tf
.
	$Úes
(

150 [
num_boxes
, 
h—tm­_height
, 
h—tm­_width
, 
num_keypošts
],

151 
dty³
=
tf
.
æßt32
)

153 
scÜe_th»sh
 = 0.1

154 
iou_th»sh
 = .5

155 
max_ouut_size
 = 4

156 
exp_nms_cÜÃrs
 = [[0, 10, 1, 11],

161 
exp_nms_scÜes
 = [.95, .9, .85, .3]

162 
exp_nms_şas£s
 = [0, 0, 1, 0]

163 
exp_nms_keypošt_h—tm­s
 = 
Å
.
	`Úes
(

164 (4, 
h—tm­_height
, 
h—tm­_width
, 
num_keypošts
), 
dty³
=
Å
.
æßt32
)

166 
nms
 = 
po¡_´oûssšg
.
	`muÉişass_nÚ_max_suµ»ssiÚ
(

167 
boxes
, 
scÜes
, 
scÜe_th»sh
, 
iou_th»sh
, 
max_ouut_size
,

168 
add™iÚ®_f›lds
={

169 
f›lds
.
BoxLi¡F›lds
.
keypošt_h—tm­s
: 
	}
keypoint_heatmaps})

171 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

172 (
nms_cÜÃrs_ouut
,

173 
nms_scÜes_ouut
,

174 
nms_şas£s_ouut
,

175 
nms_keypošt_h—tm­s
èğ
£ss
.
	`run
(

176 [
nms
.
	`g‘
(),

177 
nms
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
scÜes
),

178 
nms
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
şas£s
),

179 
nms
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
keypošt_h—tm­s
)])

181 
£lf
.
	$as£¹AÎClo£
(
nms_cÜÃrs_ouut
, 
exp_nms_cÜÃrs
)

182 
£lf
.
	$as£¹AÎClo£
(
nms_scÜes_ouut
, 
exp_nms_scÜes
)

183 
£lf
.
	$as£¹AÎClo£
(
nms_şas£s_ouut
, 
exp_nms_şas£s
)

184 
£lf
.
	$as£¹AÎEqu®
(
nms_keypošt_h—tm­s
, 
exp_nms_keypošt_h—tm­s
)

186 
def
 
	$‹¡_muÉişass_nms_w™h_add™iÚ®_f›lds
(
£lf
):

187 
boxes
 = 
tf
.
	`cÚ¡ªt
([[[0, 0, 1, 1]],

194 [[0, 1000, 1, 1002.1]]], 
tf
.
æßt32
)

196 
scÜes
 = 
tf
.
	$cÚ¡ªt
([[.9, 0.01], [.75, 0.05],

201 
cßr£_boxes_key
 = 'coarse_boxes'

202 
cßr£_boxes
 = 
tf
.
	`cÚ¡ªt
([[0.1, 0.1, 1.1, 1.1],

209 [0.1, 1000.1, 1.1, 1002.2]], 
tf
.
æßt32
)

211 
scÜe_th»sh
 = 0.1

212 
iou_th»sh
 = .5

213 
max_ouut_size
 = 4

215 
exp_nms_cÜÃrs
 = 
Å
.
	$¬¿y
([[0, 10, 1, 11],

218 [0, 100, 1, 101]], 
dty³
=
Å
.
æßt32
)

220 
exp_nms_cßr£_cÜÃrs
 = 
Å
.
	$¬¿y
([[0.1, 10.1, 1.1, 11.1],

224 
dty³
=
Å
.
æßt32
)

226 
exp_nms_scÜes
 = [.95, .9, .85, .3]

227 
exp_nms_şas£s
 = [0, 0, 1, 0]

229 
nms
 = 
po¡_´oûssšg
.
	`muÉişass_nÚ_max_suµ»ssiÚ
(

230 
boxes
, 
scÜes
, 
scÜe_th»sh
, 
iou_th»sh
, 
max_ouut_size
,

231 
add™iÚ®_f›lds
={
cßr£_boxes_key
: 
cßr£_boxes
})

233 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

234 (
nms_cÜÃrs_ouut
,

235 
nms_scÜes_ouut
,

236 
nms_şas£s_ouut
,

237 
nms_cßr£_cÜÃrs
èğ
£ss
.
	`run
(

238 [
nms
.
	`g‘
(),

239 
nms
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
scÜes
),

240 
nms
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
şas£s
),

241 
nms
.
	`g‘_f›ld
(
cßr£_boxes_key
)])

243 
£lf
.
	$as£¹AÎClo£
(
nms_cÜÃrs_ouut
, 
exp_nms_cÜÃrs
)

244 
£lf
.
	$as£¹AÎClo£
(
nms_scÜes_ouut
, 
exp_nms_scÜes
)

245 
£lf
.
	$as£¹AÎClo£
(
nms_şas£s_ouut
, 
exp_nms_şas£s
)

246 
£lf
.
	$as£¹AÎEqu®
(
nms_cßr£_cÜÃrs
, 
exp_nms_cßr£_cÜÃrs
)

248 
def
 
	$‹¡_muÉişass_nms_£Ëù_w™h_sh¬ed_boxes_giv’_masks
(
£lf
):

249 
boxes
 = 
tf
.
	`cÚ¡ªt
([[[0, 0, 1, 1]],

256 [[0, 1000, 1, 1002.1]]], 
tf
.
æßt32
)

257 
scÜes
 = 
tf
.
	$cÚ¡ªt
([[.9, 0.01], [.75, 0.05],

261 
num_şas£s
 = 2

262 
mask_height
 = 3

263 
mask_width
 = 3

264 
masks
 = 
tf
.
	`te
(

265 
tf
.
	`»sh­e
Ñf.
	`¿nge
(8), [8, 1, 1, 1]),

266 [1, 
num_şas£s
, 
mask_height
, 
mask_width
])

267 
scÜe_th»sh
 = 0.1

268 
iou_th»sh
 = .5

269 
max_ouut_size
 = 4

271 
exp_nms_cÜÃrs
 = [[0, 10, 1, 11],

275 
exp_nms_scÜes
 = [.95, .9, .85, .3]

276 
exp_nms_şas£s
 = [0, 0, 1, 0]

277 
exp_nms_masks_‹nsÜ
 = 
tf
.
	`te
(

278 
tf
.
	`»sh­e
Ñf.
	`cÚ¡ªt
([3, 0, 6, 5], 
dty³
ñf.
æßt32
), [4, 1, 1]),

279 [1, 
mask_height
, 
mask_width
])

281 
nms
 = 
po¡_´oûssšg
.
	$muÉişass_nÚ_max_suµ»ssiÚ
(
boxes
, 
scÜes
,

282 
scÜe_th»sh
,

283 
iou_th»sh
,

284 
max_ouut_size
,

285 
masks
=masks)

286 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

287 (
nms_cÜÃrs_ouut
,

288 
nms_scÜes_ouut
,

289 
nms_şas£s_ouut
,

290 
nms_masks
,

291 
exp_nms_masks
èğ
£ss
.
	`run
([
nms
.
	`g‘
(),

292 
nms
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
scÜes
),

293 
nms
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
şas£s
),

294 
nms
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
masks
),

295 
exp_nms_masks_‹nsÜ
])

296 
£lf
.
	$as£¹AÎClo£
(
nms_cÜÃrs_ouut
, 
exp_nms_cÜÃrs
)

297 
£lf
.
	$as£¹AÎClo£
(
nms_scÜes_ouut
, 
exp_nms_scÜes
)

298 
£lf
.
	$as£¹AÎClo£
(
nms_şas£s_ouut
, 
exp_nms_şas£s
)

299 
£lf
.
	$as£¹AÎEqu®
(
nms_masks
, 
exp_nms_masks
)

301 
def
 
	$‹¡_muÉişass_nms_£Ëù_w™h_ş_wšdow
(
£lf
):

302 
boxes
 = 
tf
.
	$cÚ¡ªt
([[[0, 0, 10, 10]],

303 [[1, 1, 11, 11]]], 
tf
.
æßt32
)

304 
scÜes
 = 
tf
.
	$cÚ¡ªt
([[.9], [.75]])

305 
ş_wšdow
 = 
tf
.
	$cÚ¡ªt
([5, 4, 8, 7], 
tf
.
æßt32
)

306 
scÜe_th»sh
 = 0.0

307 
iou_th»sh
 = 0.5

308 
max_ouut_size
 = 100

310 
exp_nms_cÜÃrs
 = [[5, 4, 8, 7]]

311 
exp_nms_scÜes
 = [.9]

312 
exp_nms_şas£s
 = [0]

314 
nms
 = 
po¡_´oûssšg
.
	$muÉişass_nÚ_max_suµ»ssiÚ
(

315 
boxes
, 
scÜes
, 
scÜe_th»sh
, 
iou_th»sh
, 
max_ouut_size
,

316 
ş_wšdow
=clip_window)

317 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

318 
nms_cÜÃrs_ouut
, 
nms_scÜes_ouut
, 
nms_şas£s_ouut
 = 
£ss
.
	`run
(

319 [
nms
.
	`g‘
(),‚ms.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
scÜes
),

320 
nms
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
şas£s
)])

321 
£lf
.
	$as£¹AÎClo£
(
nms_cÜÃrs_ouut
, 
exp_nms_cÜÃrs
)

322 
£lf
.
	$as£¹AÎClo£
(
nms_scÜes_ouut
, 
exp_nms_scÜes
)

323 
£lf
.
	$as£¹AÎClo£
(
nms_şas£s_ouut
, 
exp_nms_şas£s
)

325 
def
 
	$‹¡_muÉişass_nms_£Ëù_w™h_ş_wšdow_chªge_coÜdš©e_äame
(
£lf
):

326 
boxes
 = 
tf
.
	$cÚ¡ªt
([[[0, 0, 10, 10]],

327 [[1, 1, 11, 11]]], 
tf
.
æßt32
)

328 
scÜes
 = 
tf
.
	$cÚ¡ªt
([[.9], [.75]])

329 
ş_wšdow
 = 
tf
.
	$cÚ¡ªt
([5, 4, 8, 7], 
tf
.
æßt32
)

330 
scÜe_th»sh
 = 0.0

331 
iou_th»sh
 = 0.5

332 
max_ouut_size
 = 100

334 
exp_nms_cÜÃrs
 = [[0, 0, 1, 1]]

335 
exp_nms_scÜes
 = [.9]

336 
exp_nms_şas£s
 = [0]

338 
nms
 = 
po¡_´oûssšg
.
	$muÉişass_nÚ_max_suµ»ssiÚ
(

339 
boxes
, 
scÜes
, 
scÜe_th»sh
, 
iou_th»sh
, 
max_ouut_size
,

340 
ş_wšdow
=ş_wšdow, 
chªge_coÜdš©e_äame
=
True
)

341 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

342 
nms_cÜÃrs_ouut
, 
nms_scÜes_ouut
, 
nms_şas£s_ouut
 = 
£ss
.
	`run
(

343 [
nms
.
	`g‘
(),‚ms.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
scÜes
),

344 
nms
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
şas£s
)])

345 
£lf
.
	$as£¹AÎClo£
(
nms_cÜÃrs_ouut
, 
exp_nms_cÜÃrs
)

346 
£lf
.
	$as£¹AÎClo£
(
nms_scÜes_ouut
, 
exp_nms_scÜes
)

347 
£lf
.
	$as£¹AÎClo£
(
nms_şas£s_ouut
, 
exp_nms_şas£s
)

349 
def
 
	$‹¡_muÉişass_nms_£Ëù_w™h_³r_şass_ÿp
(
£lf
):

350 
boxes
 = 
tf
.
	`cÚ¡ªt
([[[0, 0, 1, 1]],

357 [[0, 1000, 1, 1002.1]]], 
tf
.
æßt32
)

358 
scÜes
 = 
tf
.
	$cÚ¡ªt
([[.9, 0.01], [.75, 0.05],

362 
scÜe_th»sh
 = 0.1

363 
iou_th»sh
 = .5

364 
max_size_³r_şass
 = 2

366 
exp_nms_cÜÃrs
 = [[0, 10, 1, 11],

369 
exp_nms_scÜes
 = [.95, .9, .85]

370 
exp_nms_şas£s
 = [0, 0, 1]

372 
nms
 = 
po¡_´oûssšg
.
	$muÉişass_nÚ_max_suµ»ssiÚ
(

373 
boxes
, 
scÜes
, 
scÜe_th»sh
, 
iou_th»sh
, 
max_size_³r_şass
)

374 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

375 
nms_cÜÃrs_ouut
, 
nms_scÜes_ouut
, 
nms_şas£s_ouut
 = 
£ss
.
	`run
(

376 [
nms
.
	`g‘
(),‚ms.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
scÜes
),

377 
nms
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
şas£s
)])

378 
£lf
.
	$as£¹AÎClo£
(
nms_cÜÃrs_ouut
, 
exp_nms_cÜÃrs
)

379 
£lf
.
	$as£¹AÎClo£
(
nms_scÜes_ouut
, 
exp_nms_scÜes
)

380 
£lf
.
	$as£¹AÎClo£
(
nms_şas£s_ouut
, 
exp_nms_şas£s
)

382 
def
 
	$‹¡_muÉişass_nms_£Ëù_w™h_tÙ®_ÿp
(
£lf
):

383 
boxes
 = 
tf
.
	`cÚ¡ªt
([[[0, 0, 1, 1]],

390 [[0, 1000, 1, 1002.1]]], 
tf
.
æßt32
)

391 
scÜes
 = 
tf
.
	$cÚ¡ªt
([[.9, 0.01], [.75, 0.05],

395 
scÜe_th»sh
 = 0.1

396 
iou_th»sh
 = .5

397 
max_size_³r_şass
 = 4

398 
max_tÙ®_size
 = 2

400 
exp_nms_cÜÃrs
 = [[0, 10, 1, 11],

402 
exp_nms_scÜes
 = [.95, .9]

403 
exp_nms_şas£s
 = [0, 0]

405 
nms
 = 
po¡_´oûssšg
.
	$muÉişass_nÚ_max_suµ»ssiÚ
(

406 
boxes
, 
scÜes
, 
scÜe_th»sh
, 
iou_th»sh
, 
max_size_³r_şass
,

407 
max_tÙ®_size
)

408 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

409 
nms_cÜÃrs_ouut
, 
nms_scÜes_ouut
, 
nms_şas£s_ouut
 = 
£ss
.
	`run
(

410 [
nms
.
	`g‘
(),‚ms.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
scÜes
),

411 
nms
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
şas£s
)])

412 
£lf
.
	$as£¹AÎClo£
(
nms_cÜÃrs_ouut
, 
exp_nms_cÜÃrs
)

413 
£lf
.
	$as£¹AÎClo£
(
nms_scÜes_ouut
, 
exp_nms_scÜes
)

414 
£lf
.
	$as£¹AÎClo£
(
nms_şas£s_ouut
, 
exp_nms_şas£s
)

416 
def
 
	$‹¡_muÉişass_nms_th»shŞd_th’_£Ëù_w™h_sh¬ed_boxes
(
£lf
):

417 
boxes
 = 
tf
.
	`cÚ¡ªt
([[[0, 0, 1, 1]],

424 [[0, 1000, 1, 1002.1]]], 
tf
.
æßt32
)

425 
scÜes
 = 
tf
.
	$cÚ¡ªt
([[.9], [.75], [.6], [.95], [.5], [.3], [.01], [.01]])

426 
scÜe_th»sh
 = 0.1

427 
iou_th»sh
 = .5

428 
max_ouut_size
 = 3

430 
exp_nms
 = [[0, 10, 1, 11],

433 
nms
 = 
po¡_´oûssšg
.
	$muÉişass_nÚ_max_suµ»ssiÚ
(

434 
boxes
, 
scÜes
, 
scÜe_th»sh
, 
iou_th»sh
, 
max_ouut_size
)

435 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

436 
nms_ouut
 = 
£ss
.
	`run
(
nms
.
	$g‘
())

437 
£lf
.
	$as£¹AÎClo£
(
nms_ouut
, 
exp_nms
)

439 
def
 
	$‹¡_muÉişass_nms_£Ëù_w™h_£·¿‹_boxes
(
£lf
):

440 
boxes
 = 
tf
.
	`cÚ¡ªt
([[[0, 0, 1, 1], [0, 0, 4, 5]],

448 
tf
.
æßt32
)

449 
scÜes
 = 
tf
.
	$cÚ¡ªt
([[.9, 0.01], [.75, 0.05],

453 
scÜe_th»sh
 = 0.1

454 
iou_th»sh
 = .5

455 
max_ouut_size
 = 4

457 
exp_nms_cÜÃrs
 = [[0, 10, 1, 11],

461 
exp_nms_scÜes
 = [.95, .9, .85, .3]

462 
exp_nms_şas£s
 = [0, 0, 1, 0]

464 
nms
 = 
po¡_´oûssšg
.
	$muÉişass_nÚ_max_suµ»ssiÚ
(

465 
boxes
, 
scÜes
, 
scÜe_th»sh
, 
iou_th»sh
, 
max_ouut_size
)

466 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

467 
nms_cÜÃrs_ouut
, 
nms_scÜes_ouut
, 
nms_şas£s_ouut
 = 
£ss
.
	`run
(

468 [
nms
.
	`g‘
(),‚ms.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
scÜes
),

469 
nms
.
	`g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
şas£s
)])

470 
£lf
.
	$as£¹AÎClo£
(
nms_cÜÃrs_ouut
, 
exp_nms_cÜÃrs
)

471 
£lf
.
	$as£¹AÎClo£
(
nms_scÜes_ouut
, 
exp_nms_scÜes
)

472 
£lf
.
	$as£¹AÎClo£
(
nms_şas£s_ouut
, 
exp_nms_şas£s
)

474 
def
 
	$‹¡_b©ch_muÉişass_nms_w™h_b©ch_size_1
(
£lf
):

475 
boxes
 = 
tf
.
	`cÚ¡ªt
([[[[0, 0, 1, 1], [0, 0, 4, 5]],

483 
tf
.
æßt32
)

484 
scÜes
 = 
tf
.
	$cÚ¡ªt
([[[.9, 0.01], [.75, 0.05],

488 
scÜe_th»sh
 = 0.1

489 
iou_th»sh
 = .5

490 
max_ouut_size
 = 4

492 
exp_nms_cÜÃrs
 = [[[0, 10, 1, 11],

496 
exp_nms_scÜes
 = [[.95, .9, .85, .3]]

497 
exp_nms_şas£s
 = [[0, 0, 1, 0]]

499 (
nm£d_boxes
, 
nm£d_scÜes
, 
nm£d_şas£s
, 
nm£d_masks
,

500 
num_d‘eùiÚs
èğ
po¡_´oûssšg
.
	$b©ch_muÉişass_nÚ_max_suµ»ssiÚ
(

501 
boxes
, 
scÜes
, 
scÜe_th»sh
, 
iou_th»sh
,

502 
max_size_³r_şass
=
max_ouut_size
, 
max_tÙ®_size
=max_output_size)

504 
£lf
.
	$as£¹IsNÚe
(
nm£d_masks
)

506 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

507 (
nm£d_boxes
, 
nm£d_scÜes
, 
nm£d_şas£s
,

508 
num_d‘eùiÚs
èğ
£ss
.
	$run
([
nm£d_boxes
, 
nm£d_scÜes
, 
nm£d_şas£s
,

509 
num_d‘eùiÚs
])

510 
£lf
.
	$as£¹AÎClo£
(
nm£d_boxes
, 
exp_nms_cÜÃrs
)

511 
£lf
.
	$as£¹AÎClo£
(
nm£d_scÜes
, 
exp_nms_scÜes
)

512 
£lf
.
	$as£¹AÎClo£
(
nm£d_şas£s
, 
exp_nms_şas£s
)

513 
£lf
.
	$as£¹Equ®
(
num_d‘eùiÚs
, [4])

515 
def
 
	$‹¡_b©ch_muÉişass_nms_w™h_b©ch_size_2
(
£lf
):

516 
boxes
 = 
tf
.
	`cÚ¡ªt
([[[[0, 0, 1, 1], [0, 0, 4, 5]],

524 
tf
.
æßt32
)

525 
scÜes
 = 
tf
.
	$cÚ¡ªt
([[[.9, 0.01], [.75, 0.05],

529 
scÜe_th»sh
 = 0.1

530 
iou_th»sh
 = .5

531 
max_ouut_size
 = 4

533 
exp_nms_cÜÃrs
 = 
Å
.
	$¬¿y
([[[0, 10, 1, 11],

541 
exp_nms_scÜes
 = 
Å
.
	$¬¿y
([[.95, .9, 0, 0],

543 
exp_nms_şas£s
 = 
Å
.
	$¬¿y
([[0, 0, 0, 0],

546 (
nm£d_boxes
, 
nm£d_scÜes
, 
nm£d_şas£s
, 
nm£d_masks
,

547 
num_d‘eùiÚs
èğ
po¡_´oûssšg
.
	$b©ch_muÉişass_nÚ_max_suµ»ssiÚ
(

548 
boxes
, 
scÜes
, 
scÜe_th»sh
, 
iou_th»sh
,

549 
max_size_³r_şass
=
max_ouut_size
, 
max_tÙ®_size
=max_output_size)

551 
£lf
.
	$as£¹IsNÚe
(
nm£d_masks
)

552 #Check 
sh­es


553 
£lf
.
	`as£¹AÎEqu®
(
nm£d_boxes
.
sh­e
.
	`as_li¡
(),

554 
exp_nms_cÜÃrs
.
sh­e
)

555 
£lf
.
	`as£¹AÎEqu®
(
nm£d_scÜes
.
sh­e
.
	`as_li¡
(),

556 
exp_nms_scÜes
.
sh­e
)

557 
£lf
.
	`as£¹AÎEqu®
(
nm£d_şas£s
.
sh­e
.
	`as_li¡
(),

558 
exp_nms_şas£s
.
sh­e
)

559 
£lf
.
	`as£¹Equ®
(
num_d‘eùiÚs
.
sh­e
.
	`as_li¡
(), [2])

561 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

562 (
nm£d_boxes
, 
nm£d_scÜes
, 
nm£d_şas£s
,

563 
num_d‘eùiÚs
èğ
£ss
.
	$run
([
nm£d_boxes
, 
nm£d_scÜes
, 
nm£d_şas£s
,

564 
num_d‘eùiÚs
])

565 
£lf
.
	$as£¹AÎClo£
(
nm£d_boxes
, 
exp_nms_cÜÃrs
)

566 
£lf
.
	$as£¹AÎClo£
(
nm£d_scÜes
, 
exp_nms_scÜes
)

567 
£lf
.
	$as£¹AÎClo£
(
nm£d_şas£s
, 
exp_nms_şas£s
)

568 
£lf
.
	$as£¹AÎClo£
(
num_d‘eùiÚs
, [2, 3])

570 
def
 
	$‹¡_b©ch_muÉişass_nms_w™h_masks
(
£lf
):

571 
boxes
 = 
tf
.
	`cÚ¡ªt
([[[[0, 0, 1, 1], [0, 0, 4, 5]],

579 
tf
.
æßt32
)

580 
scÜes
 = 
tf
.
	$cÚ¡ªt
([[[.9, 0.01], [.75, 0.05],

584 
masks
 = 
tf
.
	$cÚ¡ªt
([[[[[0, 1], [2, 3]], [[1, 2], [3, 4]]],

592 
tf
.
æßt32
)

593 
scÜe_th»sh
 = 0.1

594 
iou_th»sh
 = .5

595 
max_ouut_size
 = 4

597 
exp_nms_cÜÃrs
 = 
Å
.
	$¬¿y
([[[0, 10, 1, 11],

605 
exp_nms_scÜes
 = 
Å
.
	$¬¿y
([[.95, .9, 0, 0],

607 
exp_nms_şas£s
 = 
Å
.
	$¬¿y
([[0, 0, 0, 0],

609 
exp_nms_masks
 = 
Å
.
	$¬¿y
([[[[6, 7], [8, 9]],

618 (
nm£d_boxes
, 
nm£d_scÜes
, 
nm£d_şas£s
, 
nm£d_masks
,

619 
num_d‘eùiÚs
èğ
po¡_´oûssšg
.
	$b©ch_muÉişass_nÚ_max_suµ»ssiÚ
(

620 
boxes
, 
scÜes
, 
scÜe_th»sh
, 
iou_th»sh
,

621 
max_size_³r_şass
=
max_ouut_size
, 
max_tÙ®_size
=max_output_size,

622 
masks
=masks)

624 #Check 
sh­es


625 
£lf
.
	`as£¹AÎEqu®
(
nm£d_boxes
.
sh­e
.
	`as_li¡
(), 
exp_nms_cÜÃrs
.shape)

626 
£lf
.
	`as£¹AÎEqu®
(
nm£d_scÜes
.
sh­e
.
	`as_li¡
(), 
exp_nms_scÜes
.shape)

627 
£lf
.
	`as£¹AÎEqu®
(
nm£d_şas£s
.
sh­e
.
	`as_li¡
(), 
exp_nms_şas£s
.shape)

628 
£lf
.
	`as£¹AÎEqu®
(
nm£d_masks
.
sh­e
.
	`as_li¡
(), 
exp_nms_masks
.shape)

629 
£lf
.
	`as£¹Equ®
(
num_d‘eùiÚs
.
sh­e
.
	`as_li¡
(), [2])

631 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

632 (
nm£d_boxes
, 
nm£d_scÜes
, 
nm£d_şas£s
, 
nm£d_masks
,

633 
num_d‘eùiÚs
èğ
£ss
.
	$run
([
nm£d_boxes
, 
nm£d_scÜes
, 
nm£d_şas£s
,

634 
nm£d_masks
, 
num_d‘eùiÚs
])

636 
£lf
.
	$as£¹AÎClo£
(
nm£d_boxes
, 
exp_nms_cÜÃrs
)

637 
£lf
.
	$as£¹AÎClo£
(
nm£d_scÜes
, 
exp_nms_scÜes
)

638 
£lf
.
	$as£¹AÎClo£
(
nm£d_şas£s
, 
exp_nms_şas£s
)

639 
£lf
.
	$as£¹AÎClo£
(
num_d‘eùiÚs
, [2, 3])

640 
£lf
.
	$as£¹AÎClo£
(
nm£d_masks
, 
exp_nms_masks
)

642 
def
 
	$‹¡_b©ch_muÉişass_nms_w™h_dyÇmic_b©ch_size
(
£lf
):

643 
boxes_¶aûhŞd”
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
, None, 2, 4))

644 
scÜes_¶aûhŞd”
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
, None, 2))

645 
masks_¶aûhŞd”
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
, None, 2, 2, 2))

647 
boxes
 = 
Å
.
	`¬¿y
([[[[0, 0, 1, 1], [0, 0, 4, 5]],

655 
scÜes
 = 
Å
.
	$¬¿y
([[[.9, 0.01], [.75, 0.05],

659 
masks
 = 
Å
.
	$¬¿y
([[[[[0, 1], [2, 3]], [[1, 2], [3, 4]]],

667 
scÜe_th»sh
 = 0.1

668 
iou_th»sh
 = .5

669 
max_ouut_size
 = 4

671 
exp_nms_cÜÃrs
 = 
Å
.
	$¬¿y
([[[0, 10, 1, 11],

679 
exp_nms_scÜes
 = 
Å
.
	$¬¿y
([[.95, .9, 0, 0],

681 
exp_nms_şas£s
 = 
Å
.
	$¬¿y
([[0, 0, 0, 0],

683 
exp_nms_masks
 = 
Å
.
	$¬¿y
([[[[6, 7], [8, 9]],

692 (
nm£d_boxes
, 
nm£d_scÜes
, 
nm£d_şas£s
, 
nm£d_masks
,

693 
num_d‘eùiÚs
èğ
po¡_´oûssšg
.
	$b©ch_muÉişass_nÚ_max_suµ»ssiÚ
(

694 
boxes_¶aûhŞd”
, 
scÜes_¶aûhŞd”
, 
scÜe_th»sh
, 
iou_th»sh
,

695 
max_size_³r_şass
=
max_ouut_size
, 
max_tÙ®_size
=max_output_size,

696 
masks
=
masks_¶aûhŞd”
)

698 #Check 
sh­es


699 
£lf
.
	`as£¹AÎEqu®
(
nm£d_boxes
.
sh­e
.
	`as_li¡
(), [
NÚe
, 4, 4])

700 
£lf
.
	`as£¹AÎEqu®
(
nm£d_scÜes
.
sh­e
.
	`as_li¡
(), [
NÚe
, 4])

701 
£lf
.
	`as£¹AÎEqu®
(
nm£d_şas£s
.
sh­e
.
	`as_li¡
(), [
NÚe
, 4])

702 
£lf
.
	`as£¹AÎEqu®
(
nm£d_masks
.
sh­e
.
	`as_li¡
(), [
NÚe
, 4, 2, 2])

703 
£lf
.
	`as£¹Equ®
(
num_d‘eùiÚs
.
sh­e
.
	`as_li¡
(), [
NÚe
])

705 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

706 (
nm£d_boxes
, 
nm£d_scÜes
, 
nm£d_şas£s
, 
nm£d_masks
,

707 
num_d‘eùiÚs
èğ
£ss
.
	`run
([
nm£d_boxes
, 
nm£d_scÜes
, 
nm£d_şas£s
,

708 
nm£d_masks
, 
num_d‘eùiÚs
],

709 
ãed_diù
={
boxes_¶aûhŞd”
: 
boxes
,

710 
scÜes_¶aûhŞd”
: 
scÜes
,

711 
masks_¶aûhŞd”
: 
masks
})

712 
£lf
.
	$as£¹AÎClo£
(
nm£d_boxes
, 
exp_nms_cÜÃrs
)

713 
£lf
.
	$as£¹AÎClo£
(
nm£d_scÜes
, 
exp_nms_scÜes
)

714 
£lf
.
	$as£¹AÎClo£
(
nm£d_şas£s
, 
exp_nms_şas£s
)

715 
£lf
.
	$as£¹AÎClo£
(
num_d‘eùiÚs
, [2, 3])

716 
£lf
.
	$as£¹AÎClo£
(
nm£d_masks
, 
exp_nms_masks
)

718 
def
 
	$‹¡_b©ch_muÉişass_nms_w™h_masks_ªd_num_v®id_boxes
(
£lf
):

719 
boxes
 = 
tf
.
	`cÚ¡ªt
([[[[0, 0, 1, 1], [0, 0, 4, 5]],

727 
tf
.
æßt32
)

728 
scÜes
 = 
tf
.
	$cÚ¡ªt
([[[.9, 0.01], [.75, 0.05],

732 
masks
 = 
tf
.
	$cÚ¡ªt
([[[[[0, 1], [2, 3]], [[1, 2], [3, 4]]],

740 
tf
.
æßt32
)

741 
num_v®id_boxes
 = 
tf
.
	$cÚ¡ªt
([1, 1], 
tf
.
št32
)

742 
scÜe_th»sh
 = 0.1

743 
iou_th»sh
 = .5

744 
max_ouut_size
 = 4

746 
exp_nms_cÜÃrs
 = [[[0, 0, 1, 1],

754 
exp_nms_scÜes
 = [[.9, 0, 0, 0],

756 
exp_nms_şas£s
 = [[0, 0, 0, 0],

758 
exp_nms_masks
 = [[[[0, 1], [2, 3]],

767 (
nm£d_boxes
, 
nm£d_scÜes
, 
nm£d_şas£s
, 
nm£d_masks
,

768 
num_d‘eùiÚs
èğ
po¡_´oûssšg
.
	$b©ch_muÉişass_nÚ_max_suµ»ssiÚ
(

769 
boxes
, 
scÜes
, 
scÜe_th»sh
, 
iou_th»sh
,

770 
max_size_³r_şass
=
max_ouut_size
, 
max_tÙ®_size
=max_output_size,

771 
num_v®id_boxes
òum_v®id_boxes, 
masks
=masks)

773 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

774 (
nm£d_boxes
, 
nm£d_scÜes
, 
nm£d_şas£s
, 
nm£d_masks
,

775 
num_d‘eùiÚs
èğ
£ss
.
	$run
([
nm£d_boxes
, 
nm£d_scÜes
, 
nm£d_şas£s
,

776 
nm£d_masks
, 
num_d‘eùiÚs
])

777 
£lf
.
	$as£¹AÎClo£
(
nm£d_boxes
, 
exp_nms_cÜÃrs
)

778 
£lf
.
	$as£¹AÎClo£
(
nm£d_scÜes
, 
exp_nms_scÜes
)

779 
£lf
.
	$as£¹AÎClo£
(
nm£d_şas£s
, 
exp_nms_şas£s
)

780 
£lf
.
	$as£¹AÎClo£
(
num_d‘eùiÚs
, [1, 1])

781 
£lf
.
	$as£¹AÎClo£
(
nm£d_masks
, 
exp_nms_masks
)

784 
__Çme__
 == '__main__':

785 
tf
.
‹¡
.
	`maš
()

	@core/prefetcher.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
def
 
	$´eãtch
(
‹nsÜ_diù
, 
ÿ·c™y
):

23 
C»©es
 
a
 
FIFO
 
queue
 
to
 
asynchrÚou¦y
 
’queue
 
‹nsÜ_diùs
 
ªd
 
»tuºs
‡

24 
dequeue
 
İ
 
th©
 
ev®u©es
 
to
 
a
 
‹nsÜ_diù
. 
This
 
funùiÚ
 
is
 
u£ful
 
š


25 
´eãtchšg
 
´•roûs£d
 
‹nsÜs
 
so
 
th©
 
the
 
d©a
 
is
 
»ady
 
avaabË
 

26 
cÚsum”s
.

28 
Exam¶e
 
šput
 
p–še
 
wh’
 
you
 
dÚ
't‚eed batching:

30 
key
, 
¡ršg_‹nsÜ
 = 
¦im
.
·¿Î–_»ad”
.
	$·¿Î–_»ad
(...)

31 
‹nsÜ_diù
 = 
decod”
.
	$decode
(
¡ršg_‹nsÜ
)

32 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
, ...)

33 
´eãtch_queue
 = 
´eãtch”
.
	$´eãtch
(
‹nsÜ_diù
, 
ÿ·c™y
=20)

34 
‹nsÜ_diù
 = 
´eãtch_queue
.
	$dequeue
()

35 
ouuts
 = 
	`Mod–
(
‹nsÜ_diù
)

39 
FÜ
 
šput
 
p–šes
 
w™h
 
b©chšg
, 
»ãr
 
to
 
cÜe
/
b©ch”
.
py


41 
Args
:

42 
‹nsÜ_diù
: 
a
 
diùiÚ¬y
 
of
 
‹nsÜs
 
to
 
´eãtch
.

43 
ÿ·c™y
: 
the
 
size
 
of
h
´eãtch
 
queue
.

45 
R‘uºs
:

46 
a
 
FIFO
 
´eãtch”
 
queue


48 
Çmes
 = 
	`li¡
(
‹nsÜ_diù
.
	$keys
())

49 
dty³s
 = [
t
.
dty³
 ˆ
š
 
‹nsÜ_diù
.
	`v®ues
()]

50 
sh­es
 = [
t
.
	$g‘_sh­e
(è
t
 
š
 
‹nsÜ_diù
.
	`v®ues
()]

51 
´eãtch_queue
 = 
tf
.
	`PaddšgFIFOQueue
(
ÿ·c™y
, 
dty³s
=dtypes,

52 
sh­es
=shapes,

53 
Çmes
=names,

54 
Çme
='prefetch_queue')

55 
’queue_İ
 = 
´eãtch_queue
.
	$’queue
(
‹nsÜ_diù
)

56 
tf
.
Œaš
.
queue_ruÂ”
.
	`add_queue_ruÂ”
Ñf.Œaš.queue_ruÂ”.
	$QueueRuÂ”
(

57 
´eãtch_queue
, [
’queue_İ
]))

58 
tf
.
summ¬y
.
	`sÿÏr
('queue/%s/äaùiÚ_of_%d_fuÎ' % (
´eãtch_queue
.
Çme
,

59 
ÿ·c™y
),

60 
tf
.
	`to_æßt
(
´eãtch_queue
.
	`size
()è* (1. / 
ÿ·c™y
))

61  
´eãtch_queue


	@core/prefetcher_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
‹nsÜæow
 
as
 
tf


19 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
´eãtch”


21 
	g¦im
 = 
tf
.
cÚŒib
.
¦im


24 
şass
 
	$P»ãtch”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$‹¡_´eãtch_‹nsÜs_w™h_fuÎy_defšed_sh­es
(
£lf
):

27 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

28 
b©ch_size
 = 10

29 
image_size
 = 32

30 
num_b©ches
 = 5

31 
exam¶es
 = 
tf
.
	`V¬ŸbË
Ñf.
	$cÚ¡ªt
(0, 
dty³
=
tf
.
št64
))

32 
couÁ”
 = 
exam¶es
.
	$couÁ_up_to
(
num_b©ches
)

33 
image
 = 
tf
.
	`¿ndom_nÜm®
([
b©ch_size
, 
image_size
,

34 
image_size
, 3],

35 
dty³
=
tf
.
æßt32
,

36 
Çme
='images')

37 
Ïb–
 = 
tf
.
	`¿ndom_unifÜm
([
b©ch_size
, 1], 0, 10,

38 
dty³
=
tf
.
št32
, 
Çme
='labels')

40 
´eãtch_queue
 = 
´eãtch”
.
	`´eãtch
(
‹nsÜ_diù
={'couÁ”': 
couÁ”
,

41 'image': 
image
,

42 'Ïb–': 
Ïb–
},

43 
	gÿ·c™y
=100)

44 
‹nsÜ_diù
 = 
´eãtch_queue
.
	$dequeue
()

46 
£lf
.
	`as£¹AÎEqu®
(
‹nsÜ_diù
['image'].
	`g‘_sh­e
().
	`as_li¡
(),

47 [
b©ch_size
, 
image_size
, image_size, 3])

48 
£lf
.
	`as£¹AÎEqu®
(
‹nsÜ_diù
['Ïb–'].
	`g‘_sh­e
().
	`as_li¡
(),

49 [
b©ch_size
, 1])

51 
tf
.
	`š™Ÿlize_®l_v¬ŸbËs
().
	$run
()

52 
w™h
 
¦im
.
queues
.
	$QueueRuÂ”s
(
£ss
):

53 
_
 
š
 
	$¿nge
(
num_b©ches
):

54 
»suÉs
 = 
£ss
.
	$run
(
‹nsÜ_diù
)

55 
£lf
.
	`as£¹Equ®s
(
»suÉs
['image'].
sh­e
,

56 (
b©ch_size
, 
image_size
, image_size, 3))

57 
£lf
.
	`as£¹Equ®s
(
»suÉs
['Ïb–'].
sh­e
, (
b©ch_size
, 1))

58 
w™h
 
£lf
.
	$as£¹Rai£s
(
tf
.
”rÜs
.
OutOfRªgeE¼Ü
):

59 
£ss
.
	$run
(
‹nsÜ_diù
)

61 
def
 
	$‹¡_´eãtch_‹nsÜs_w™h_·¹ŸÎy_defšed_sh­es
(
£lf
):

62 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

63 
b©ch_size
 = 10

64 
image_size
 = 32

65 
num_b©ches
 = 5

66 
exam¶es
 = 
tf
.
	`V¬ŸbË
Ñf.
	$cÚ¡ªt
(0, 
dty³
=
tf
.
št64
))

67 
couÁ”
 = 
exam¶es
.
	$couÁ_up_to
(
num_b©ches
)

68 
image
 = 
tf
.
	`¿ndom_nÜm®
([
b©ch_size
,

69 
tf
.
	`V¬ŸbË
(
image_size
),

70 
tf
.
	`V¬ŸbË
(
image_size
), 3],

71 
dty³
=
tf
.
æßt32
,

72 
Çme
='image')

73 
image
.
	$£t_sh­e
([
b©ch_size
, 
NÚe
, None, 3])

74 
Ïb–
 = 
tf
.
	`¿ndom_unifÜm
([
b©ch_size
,f.
	`V¬ŸbË
(1)], 0,

75 10, 
dty³
=
tf
.
št32
, 
Çme
='label')

76 
Ïb–
.
	$£t_sh­e
([
b©ch_size
, 
NÚe
])

78 
´eãtch_queue
 = 
´eãtch”
.
	`´eãtch
(
‹nsÜ_diù
={'couÁ”': 
couÁ”
,

79 'image': 
image
,

80 'Ïb–': 
Ïb–
},

81 
	gÿ·c™y
=100)

82 
‹nsÜ_diù
 = 
´eãtch_queue
.
	$dequeue
()

84 
£lf
.
	`as£¹AÎEqu®
(
‹nsÜ_diù
['image'].
	`g‘_sh­e
().
	`as_li¡
(),

85 [
b©ch_size
, 
NÚe
, None, 3])

86 
£lf
.
	`as£¹AÎEqu®
(
‹nsÜ_diù
['Ïb–'].
	`g‘_sh­e
().
	`as_li¡
(),

87 [
b©ch_size
, 
NÚe
])

89 
tf
.
	`š™Ÿlize_®l_v¬ŸbËs
().
	$run
()

90 
w™h
 
¦im
.
queues
.
	$QueueRuÂ”s
(
£ss
):

91 
_
 
š
 
	$¿nge
(
num_b©ches
):

92 
»suÉs
 = 
£ss
.
	$run
(
‹nsÜ_diù
)

93 
£lf
.
	`as£¹Equ®s
(
»suÉs
['image'].
sh­e
,

94 (
b©ch_size
, 
image_size
, image_size, 3))

95 
£lf
.
	`as£¹Equ®s
(
»suÉs
['Ïb–'].
sh­e
, (
b©ch_size
, 1))

96 
w™h
 
£lf
.
	$as£¹Rai£s
(
tf
.
”rÜs
.
OutOfRªgeE¼Ü
):

97 
£ss
.
	$run
(
‹nsÜ_diù
)

100 
__Çme__
 == '__main__':

101 
tf
.
‹¡
.
	`maš
()

	@core/preprocessor.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
We
 
³rfÜm
 
two
 
£ts
 
of
 
İ”©iÚs
 
š
 
´•roûssšg
 
	g¡age
:

19 (
a
è
İ”©iÚs
 
th©
 
¬e
 
­¶›d
 
to
 
bÙh
 
Œaššg
 
ªd
 
‹¡šg
 
d©a
,

20 (
	gb
è
İ”©iÚs
 
th©
 
¬e
 
­¶›d
 
Úly
 
to
 
Œaššg
 
d©a
 
the
 
pu½o£
 
of


21 
d©a
 
	gaugm’tiÚ
.

23 
A
 
´•roûssšg
 
funùiÚ
 
»ûives
 
a
 
£t
 
of
 
	gšputs
,

24 
	ge
.
	gg
. 
ª
 
image
 
ªd
 
boundšg
 
	gboxes
,

25 
³rfÜms
 
ª
 
İ”©iÚ
 
Ú
 
	gthem
, 
ªd
 
»tuºs
hem.

26 
Some
 
exam¶es
 
	g¬e
: 
¿ndomly
 
üİpšg
 
the
 
image
,„ªdomly 
mœrÜšg
h
	gimage
,

27 
¿ndomly
 
chªgšg
 
the
 
	gbrighŠess
, 
	gcÚŒa¡
, 
hue
 
ªd


28 
¿ndomly
 
j™‹ršg
 
the
 
boundšg
 
	gboxes
.

30 
The
 
´•roûss
 
funùiÚ
 
»ûives
 
a
 
‹nsÜ_diù
 
which
 
is
‡ 
diùiÚ¬y
 
th©
 
m­s


31 
difã»Á
 
f›ld
 
Çmes
 
to
 
theœ
 
	g‹nsÜs
. 
FÜ
 
	gexam¶e
,

32 
	g‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
] 
hŞds
 
the
 imag
	g‹nsÜ
.

33 
The
 
image
 
is
 
a
 
	g¿nk
 4 
	g‹nsÜ
: [1, 
height
, 
width
, 
chªÃls
] 
w™h


34 
	gdty³
=
tf
.
æßt32
. 
The
 
groundŒuth_boxes
 
is
 
a
 
¿nk
 2 
‹nsÜ
: [
N
, 4] 
wh”e


35 
š
 
—ch
 
row
 
th”e
 
is
 
a
 
box
 
	gw™h
 [
ymš
 
xmš
 
ymax
 
xmax
].

36 
Boxes
 
¬e
 
š
 
nÜm®ized
 
coÜdš©es
 
m—nšg


37 
theœ
 
coÜdš©e
 
v®ues
 
¿nge
 
	gš
 [0, 1]

39 
ImpÜÁ
 
	gNÙe
: 
In
 
‹nsÜ_diù
, 
images
 
is
 
a
 
	g¿nk
 4 
	g‹nsÜ
, 
but
 
´•roûssšg


40 
funùiÚs
 
»ûive
 
a
 
	g¿nk
 3 
‹nsÜ
 
´oûssšg
 
the
 
	gimage
. 
	gThus
, 
šside
he

41 
´•roûss
 
funùiÚ
 
we
 
squ“ze
 
the
 
image
 
to
 
become
 
a
 
	g¿nk
 3 
‹nsÜ
 
ªd
 
th’


42 
we
 
·ss
 
™
 
to
 
the
 
	gfunùiÚs
. 
At
h
’d
 
of
h
´•roûss
 w
ex·nd
h
image


43 
back
 
to
 
	g¿nk
 4.

46 
impÜt
 
sys


47 
impÜt
 
‹nsÜæow
 
as
 
tf


49 
äom
 
	g‹nsÜæow
.
	gpythÚ
.
İs
 
impÜt
 
cÚŒŞ_æow_İs


51 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


52 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡_İs


53 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
keypošt_İs


54 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
¡ªd¬d_f›lds
 
as
 
f›lds


57 
def
 
	$_­¶y_w™h_¿ndom_£ËùÜ
(
x
, 
func
, 
num_ÿ£s
):

60 
Args
:

61 
x
: 
šput
 
T’sÜ
.

62 
func
: 
PythÚ
 
funùiÚ
 
to
 
­¶y
.

63 
num_ÿ£s
: 
PythÚ
 
št32
, 
numb”
 
of
 
ÿ£s
 
to
 
§m¶e
 
£l
 
äom
.

65 
R‘uºs
:

66 
The
 
»suÉ
 
of
 
	`func
(
x
, 
£l
), 
wh”e
 
func
 
»ûives
 
the
 
v®ue
 ofhe

67 
£ËùÜ
 
as
 
a
 
pythÚ
 
š‹g”
, 
but
 
£l
 
is
 
§m¶ed
 
dyÇmiÿÎy
.

69 
¿nd_£l
 = 
tf
.
	$¿ndom_unifÜm
([], 
maxv®
=
num_ÿ£s
, 
dty³
=
tf
.
št32
)

70 #Pas 
the
 
»®
 
x
 
Úly
 
to
 
Úe
 
of
h
func
 
ÿÎs
.

71  
cÚŒŞ_æow_İs
.
	`m”ge
([
	`func
(

72 
cÚŒŞ_æow_İs
.
x
, 
tf
.
	`equ®
(
¿nd_£l
, ))[1], )

73 
š
 
	`¿nge
(
num_ÿ£s
)])[0]

76 
def
 
	$_­¶y_w™h_¿ndom_£ËùÜ_tu¶es
(
x
, 
func
, 
num_ÿ£s
):

79 
Args
:

80 
x
: 
A
 
tu¶e
 
of
 
šput
 
‹nsÜs
.

81 
func
: 
PythÚ
 
funùiÚ
 
to
 
­¶y
.

82 
num_ÿ£s
: 
PythÚ
 
št32
, 
numb”
 
of
 
ÿ£s
 
to
 
§m¶e
 
£l
 
äom
.

84 
R‘uºs
:

85 
The
 
»suÉ
 
of
 
	`func
(
x
, 
£l
), 
wh”e
 
func
 
»ûives
 
the
 
v®ue
 ofhe

86 
£ËùÜ
 
as
 
a
 
pythÚ
 
š‹g”
, 
but
 
£l
 
is
 
§m¶ed
 
dyÇmiÿÎy
.

88 
num_šputs
 = 
	$Ën
(
x
)

89 
¿nd_£l
 = 
tf
.
	$¿ndom_unifÜm
([], 
maxv®
=
num_ÿ£s
, 
dty³
=
tf
.
št32
)

90 #Pas 
the
 
»®
 
x
 
Úly
 
to
 
Úe
 
of
h
func
 
ÿÎs
.

92 
tu¶es
 = [
	$li¡
(è
t
 
š
 
x
]

93 
š
 
	$¿nge
(
num_ÿ£s
):

94 
Ãw_x
 = [
cÚŒŞ_æow_İs
.
t
, 
tf
.
	`equ®
(
¿nd_£l
, ))[1] ˆ
š
 
x
]

95 
ouut
 = 
	`func
(
	`tu¶e
(
Ãw_x
), )

96 
j
 
š
 
	$¿nge
(
num_šputs
):

97 
tu¶es
[
j
].
	$­³nd
(
ouut
[
j
])

99 
i
 
š
 
	$¿nge
(
num_šputs
):

100 
tu¶es
[
i
] = 
cÚŒŞ_æow_İs
.
	`m”ge
(tuples[i])[0]

101  
	$tu¶e
(
tu¶es
)

104 
def
 
	$_¿ndom_š‹g”
(
mšv®
, 
maxv®
, 
£ed
):

107 
Args
:

108 
mšv®
: 
mšimum
 
v®ue
 
of
 
the
 
¿ndom
 
‹nsÜ
.

109 
maxv®
: 
maximum
 
v®ue
 
of
 
the
 
¿ndom
 
‹nsÜ
.

110 
£ed
: 
¿ndom
 seed.

112 
R‘uºs
:

113 
A
 
¿ndom
 0-
D
 
‹nsÜ
 
b‘w“n
 
mšv®
 
ªd
 
maxv®
.

115  
tf
.
	$¿ndom_unifÜm
(

116 [], 
mšv®
=mšv®, 
maxv®
=maxv®, 
dty³
=
tf
.
št32
, 
£ed
=seed)

119 
def
 
	$nÜm®ize_image
(
image
, 
Üigš®_mšv®
, 
Üigš®_maxv®
, 
rg‘_mšv®
,

120 
rg‘_maxv®
):

123 
Moves
 
the
 
pix–
 
v®ues
 
äom
h
cu¼’t
 [
Üigš®_mšv®
, 
Üigš®_maxv®
]

124 
¿nge
 
to
 
a
 
the
 [
rg‘_mšv®
, 
rg‘_maxv®
]„ange.

126 
Args
:

127 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚššg
 1

128 
image
 -> [
height
, 
width
, 
chªÃls
].

129 
Üigš®_mšv®
: 
cu¼’t
 
image
 
mšimum
 
v®ue
.

130 
Üigš®_maxv®
: 
cu¼’t
 
image
 
maximum
 
v®ue
.

131 
rg‘_mšv®
: 
rg‘
 
image
 
mšimum
 
v®ue
.

132 
rg‘_maxv®
: 
rg‘
 
image
 
maximum
 
v®ue
.

134 
R‘uºs
:

135 
image
: imag
which
 
is
 
the
 
§me
 
sh­e
 
as
 
šput
 image.

137 
w™h
 
tf
.
	`Çme_scİe
('NÜm®izeImage', 
v®ues
=[
image
]):

138 
Üigš®_mšv®
 = (original_minval)

139 
Üigš®_maxv®
 = (original_maxval)

140 
rg‘_mšv®
 = (target_minval)

141 
rg‘_maxv®
 = (target_maxval)

142 
image
 = 
tf
.
	$to_æßt
(
image
)

143 
image
 = 
tf
.
	$subŒaù
(
image
, 
Üigš®_mšv®
)

144 
image
 = 
tf
.
	`muÉly
(image, (
rg‘_maxv®
 - 
rg‘_mšv®
) /

145 (
Üigš®_maxv®
 - 
Üigš®_mšv®
))

146 
image
 = 
tf
.
	$add
(
image
, 
rg‘_mšv®
)

147  
image


150 
def
 
	$æ_boxes
(
boxes
):

153 
Args
:

154 
boxes
: 
¿nk
 2 
æßt32
 
‹nsÜ
 
cÚššg
 
the
 
boundšg
 boxe -> [
N
, 4].

155 
Boxes
 
¬e
 
š
 
nÜm®ized
 
fÜm
 
m—nšg
 
theœ
 
coÜdš©es
 
v¬y


156 
b‘w“n
 [0, 1].

157 
Each
 
row
 
is
 
š
 
the
 
fÜm
 
of
 [
ymš
, 
xmš
, 
ymax
, 
xmax
].

159 
R‘uºs
:

160 
Fl³d
 
boxes
.

162 #Fl 
boxes
.

163 
ymš
, 
xmš
, 
ymax
, 
xmax
 = 
tf
.
	$¥l™
(
v®ue
=
boxes
, 
num_Ü_size_¥l™s
=4, 
axis
=1)

164 
æ³d_xmš
 = 
tf
.
	$subŒaù
(1.0, 
xmax
)

165 
æ³d_xmax
 = 
tf
.
	$subŒaù
(1.0, 
xmš
)

166 
æ³d_boxes
 = 
tf
.
	$cÚÿt
([
ymš
, 
æ³d_xmš
, 
ymax
, 
æ³d_xmax
], 1)

167  
æ³d_boxes


170 
def
 
	$»š_boxes_above_th»shŞd
(

171 
boxes
, 
Ïb–s
, 
Ïb–_scÜes
, 
masks
=
NÚe
, 
keypošts
=NÚe, 
th»shŞd
=0.0):

174 
If
 
the
 
Ïb–
 
scÜe
 
a
 
box
 
is
 
	`missšg
 (
»´e£Áed
 
by
 
NaN
),he box is

175 
»šed
. 
The
 
boxes
 
th©
 
dÚ
't…asshehreshold will‚ot‡ppear inhe

176 
»tuºed
 
‹nsÜ
.

178 
Args
:

179 
boxes
: 
æßt32
 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªû
, 4] 
»´e£Ášg
 boxes

180 
loÿtiÚ
 
š
 
nÜm®ized
 
coÜdš©es
.

181 
Ïb–s
: 
¿nk
 1 
št32
 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªû
] 
cÚššg
 
the
 
objeù


182 
şas£s
.

183 
Ïb–_scÜes
: 
æßt32
 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªû
] 
»´e£Ášg
 
the


184 
scÜe
 
—ch
 
box
.

185 
masks
: (
İtiÚ®
è
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


186 [
num_š¡ªûs
, 
height
, 
width
] 
cÚššg
 
š¡ªû
 
masks
. 
The
 mask 
¬e
 
of


187 
the
 
§me
 
height
, 
width
 
as
h
šput
 `
image
`.

188 
keypošts
: (
İtiÚ®
è
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


189 [
num_š¡ªûs
, 
num_keypošts
, 2]. 
The
 
keypošts
 
¬e
 
š
 
y
-
x
 
nÜm®ized


190 
coÜdš©es
.

191 
th»shŞd
: 
sÿÏr
 
pythÚ
 .

193 
R‘uºs
:

194 
»šed_boxes
: [
num_»šed_š¡ªû
, 4]

195 
»tŸÃd_Ïb–s
: [
num_»šed_š¡ªû
]

196 
»šed_Ïb–_scÜes
: [
num_»šed_š¡ªû
]

198 
If
 
masks
, 
Ü
 
keypošts
 
¬e
 
nÙ
 
NÚe
, 
the
 
funùiÚ
 
®so
 
»tuºs
:

200 
»šed_masks
: [
num_»šed_š¡ªû
, 
height
, 
width
]

201 
»šed_keypošts
: [
num_»šed_š¡ªû
, 
num_keypošts
, 2]

203 
w™h
 
tf
.
	`Çme_scİe
('RetainBoxesAboveThreshold',

204 
v®ues
=[
boxes
, 
Ïb–s
, 
Ïb–_scÜes
]):

205 
šdiûs
 = 
tf
.
	`wh”e
(

206 
tf
.
	`logiÿl_Ü
(
Ïb–_scÜes
 > 
th»shŞd
,f.
	$is_Çn
(
Ïb–_scÜes
)))

207 
šdiûs
 = 
tf
.
	$squ“ze
(
šdiûs
, 
axis
=1)

208 
»šed_boxes
 = 
tf
.
	$g©h”
(
boxes
, 
šdiûs
)

209 
»šed_Ïb–s
 = 
tf
.
	$g©h”
(
Ïb–s
, 
šdiûs
)

210 
»šed_Ïb–_scÜes
 = 
tf
.
	$g©h”
(
Ïb–_scÜes
, 
šdiûs
)

211 
»suÉ
 = [
»šed_boxes
, 
»šed_Ïb–s
, 
»šed_Ïb–_scÜes
]

213 
masks
 
is
 
nÙ
 
NÚe
:

214 
»šed_masks
 = 
tf
.
	$g©h”
(
masks
, 
šdiûs
)

215 
»suÉ
.
	$­³nd
(
»šed_masks
)

217 
keypošts
 
is
 
nÙ
 
NÚe
:

218 
»šed_keypošts
 = 
tf
.
	$g©h”
(
keypošts
, 
šdiûs
)

219 
»suÉ
.
	$­³nd
(
»šed_keypošts
)

221  
»suÉ


224 
def
 
	$_æ_masks
(
masks
):

227 
Args
:

228 
masks
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


229 [
num_š¡ªûs
, 
height
, 
width
] 
»´e£Ášg
 
š¡ªû
 
masks
.

231 
R‘uºs
:

232 
æ³d
 
masks
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


233 [
num_š¡ªûs
, 
height
, 
width
] 
»´e£Ášg
 
š¡ªû
 
masks
.

235  
masks
[:, :, ::-1]

238 
def
 
	$¿ndom_hÜizÚl_æ
(

239 
image
,

240 
boxes
=
NÚe
,

241 
masks
=
NÚe
,

242 
keypošts
=
NÚe
,

243 
keypošt_æ_³rmutiÚ
=
NÚe
,

244 
£ed
=
NÚe
):

247 
The
 
´obab™y
 
of
 
æpšg
 
the
 
image
 
is
 50%.

249 
Args
:

250 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
height
, 
width
, 
chªÃls
].

251 
boxes
: (
İtiÚ®
è
¿nk
 2 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
N
, 4]

252 
cÚššg
 
the
 
boundšg
 
boxes
.

253 
Boxes
 
¬e
 
š
 
nÜm®ized
 
fÜm
 
m—nšg
 
theœ
 
coÜdš©es
 
v¬y


254 
b‘w“n
 [0, 1].

255 
Each
 
row
 
is
 
š
 
the
 
fÜm
 
of
 [
ymš
, 
xmš
, 
ymax
, 
xmax
].

256 
masks
: (
İtiÚ®
è
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


257 [
num_š¡ªûs
, 
height
, 
width
] 
cÚššg
 
š¡ªû
 
masks
. 
The
 masks

258 
¬e
 
of
 
the
 
§me
 
height
, 
width
 
as
h
šput
 `
image
`.

259 
keypošts
: (
İtiÚ®
è
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


260 [
num_š¡ªûs
, 
num_keypošts
, 2]. 
The
 
keypošts
 
¬e
 
š
 
y
-
x


261 
nÜm®ized
 
coÜdš©es
.

262 
keypošt_æ_³rmutiÚ
: 
¿nk
 1 
št32
 
‹nsÜ
 
cÚššg
 
keypošt
 
æ


263 
³rmutiÚ
.

264 
£ed
: 
¿ndom
 seed

266 
R‘uºs
:

267 
image
: imag
which
 
is
 
the
 
§me
 
sh­e
 
as
 
šput
 image.

269 
If
 
boxes
, 
masks
, 
keypošts
, 
ªd
 
keypošt_æ_³rmutiÚ
 
is
 
nÙ
 
NÚe
,

270 
the
 
funùiÚ
 
®so
 
»tuºs
h
fŞlowšg
 
‹nsÜs
.

272 
boxes
: 
¿nk
 2 
æßt32
 
‹nsÜ
 
cÚššg
 
the
 
boundšg
 boxe -> [
N
, 4].

273 
Boxes
 
¬e
 
š
 
nÜm®ized
 
fÜm
 
m—nšg
 
theœ
 
coÜdš©es
 
v¬y


274 
b‘w“n
 [0, 1].

275 
masks
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
num_š¡ªûs
, 
height
, 
width
]

276 
cÚššg
 
š¡ªû
 
masks
.

277 
keypošts
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


278 [
num_š¡ªûs
, 
num_keypošts
, 2]

280 
Rai£s
:

281 
V®ueE¼Ü
: 
keypošts
 
¬e
 
´ovided
 
but
 
keypošt_æ_³rmutiÚ
 
is
 
nÙ
.

283 
def
 
	$_æ_image
(
image
):

284 #æ 
image


285 
image_æ³d
 = 
tf
.
image
.
	$æ_Ëá_right
(
image
)

286  
image_æ³d


288 
keypošts
 
is
 
nÙ
 
NÚe
 
ªd
 
keypošt_æ_³rmutiÚ
 is None:

289 
¿i£
 
	`V®ueE¼Ü
(

292 
w™h
 
tf
.
	`Çme_scİe
('RªdomHÜizÚlFl', 
v®ues
=[
image
, 
boxes
]):

293 
»suÉ
 = []

294 #¿ndom 
v¬ŸbË
 
defššg
 
wh‘h”
 
to
 dØ
æ
 
Ü
 
nÙ


295 
do_a_æ_¿ndom
 = 
tf
.
	$¿ndom_unifÜm
([], 
£ed
=seed)

296 #æ 
Úly
 
th”e
 
¬e
 
boundšg
 
boxes
 
š
 
image
!

297 
do_a_æ_¿ndom
 = 
tf
.
	`logiÿl_ªd
(

298 
tf
.
	`g»©”
Ñf.
	`size
(
boxes
), 0),f.
	$g»©”
(
do_a_æ_¿ndom
, 0.5))

300 #æ 
image


301 
image
 = 
tf
.
	`cÚd
(
do_a_æ_¿ndom
, 
Ïmbda
: 
	`_æ_image
(image),†ambda: image)

302 
»suÉ
.
	$­³nd
(
image
)

304 #æ 
boxes


305 
boxes
 
is
 
nÙ
 
NÚe
:

306 
boxes
 = 
tf
.
	`cÚd
(

307 
do_a_æ_¿ndom
, 
Ïmbda
: 
	`æ_boxes
(
boxes
),†ambda: boxes)

308 
»suÉ
.
	$­³nd
(
boxes
)

310 #æ 
masks


311 
masks
 
is
 
nÙ
 
NÚe
:

312 
masks
 = 
tf
.
	`cÚd
(

313 
do_a_æ_¿ndom
, 
Ïmbda
: 
	`_æ_masks
(
masks
),†ambda: masks)

314 
»suÉ
.
	$­³nd
(
masks
)

316 #æ 
keypošts


317 
keypošts
 
is
 
nÙ
 
NÚe
 
ªd
 
keypošt_æ_³rmutiÚ
 is‚ot None:

318 
³rmutiÚ
 = 
keypošt_æ_³rmutiÚ


319 
keypošts
 = 
tf
.
	`cÚd
(

320 
do_a_æ_¿ndom
,

321 
Ïmbda
: 
keypošt_İs
.
	`æ_hÜizÚl
(
keypošts
, 0.5, 
³rmutiÚ
),

322 
Ïmbda
: 
keypošts
)

323 
»suÉ
.
	$­³nd
(
keypošts
)

325  
	$tu¶e
(
»suÉ
)

328 
def
 
	$¿ndom_pix–_v®ue_sÿË
(
image
, 
mšv®
=0.9, 
maxv®
=1.1, 
£ed
=
NÚe
):

331 
This
 
funùiÚ
 
sÿËs
 
—ch
 
pix–
 
šd•’d’t
 
of
 
the
 
Ùh”
 
Úes
.

332 
FÜ
 
—ch
 
v®ue
 
š
 
image
 
‹nsÜ
, 
d¿ws
 
a
 
¿ndom
 
numb”
 
b‘w“n


333 
mšv®
 
ªd
 
maxv®
‡nd 
muÉËs
 
the
 
v®ues
 
w™h
 
them
.

335 
Args
:

336 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚšs
 1 imag-> [
height
, 
width
, 
chªÃls
]

337 
w™h
 
pix–
 
v®ues
 
v¬yšg
 
b‘w“n
 [0, 1].

338 
mšv®
: 
low”
 
¿tio
 
of
 
sÿlšg
 
pix–
 
v®ues
.

339 
maxv®
: 
uµ”
 
¿tio
 
of
 
sÿlšg
 
pix–
 
v®ues
.

340 
£ed
: 
¿ndom
 seed.

342 
R‘uºs
:

343 
image
: imag
which
 
is
 
the
 
§me
 
sh­e
 
as
 
šput
 image.

345 
w™h
 
tf
.
	`Çme_scİe
('RªdomPix–V®ueSÿË', 
v®ues
=[
image
]):

346 
cŞÜ_cÛf
 = 
tf
.
	`¿ndom_unifÜm
(

347 
tf
.
	`sh­e
(
image
),

348 
mšv®
=minval,

349 
maxv®
=maxval,

350 
dty³
=
tf
.
æßt32
,

351 
£ed
=seed)

352 
image
 = 
tf
.
	$muÉly
(
image
, 
cŞÜ_cÛf
)

353 
image
 = 
tf
.
	$ş_by_v®ue
(
image
, 0.0, 1.0)

355  
image


358 
def
 
	$¿ndom_image_sÿË
(
image
,

359 
masks
=
NÚe
,

360 
mš_sÿË_¿tio
=0.5,

361 
max_sÿË_¿tio
=2.0,

362 
£ed
=
NÚe
):

365 
Args
:

366 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚšs
 1 imag-> [
height
, 
width
, 
chªÃls
].

367 
masks
: (
İtiÚ®
è
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚššg
 mask 
w™h


368 
size
 [
height
, 
width
, 
num_masks
]. 
The
 
v®ue
 
is
 
£t
 
to
 
NÚe
 
th”e
 
¬e
 
no


369 
masks
.

370 
mš_sÿË_¿tio
: 
mšimum
 
sÿlšg
 
¿tio
.

371 
max_sÿË_¿tio
: 
maximum
 
sÿlšg
 
¿tio
.

372 
£ed
: 
¿ndom
 seed.

374 
R‘uºs
:

375 
image
: imag
which
 
is
 
the
 
§me
 
¿nk
 
as
 
šput
 image.

376 
masks
: 
If
 mask 
is
 
nÙ
 
nÚe
, 
»sized
 mask 
which
 
¬e
 
the
 
§me
 
¿nk
 
as
 
šput


377 
masks
 
wl
 
be
 
»tuºed
.

379 
w™h
 
tf
.
	`Çme_scİe
('RªdomImageSÿË', 
v®ues
=[
image
]):

380 
»suÉ
 = []

381 
image_sh­e
 = 
tf
.
	$sh­e
(
image
)

382 
image_height
 = 
image_sh­e
[0]

383 
image_width
 = 
image_sh­e
[1]

384 
size_cÛf
 = 
tf
.
	$¿ndom_unifÜm
([],

385 
mšv®
=
mš_sÿË_¿tio
,

386 
maxv®
=
max_sÿË_¿tio
,

387 
dty³
=
tf
.
æßt32
, 
£ed
=seed)

388 
image_Ãwysize
 = 
tf
.
	`to_št32
(

389 
tf
.
	`muÉly
Ñf.
	`to_æßt
(
image_height
), 
size_cÛf
))

390 
image_Ãwxsize
 = 
tf
.
	`to_št32
(

391 
tf
.
	`muÉly
Ñf.
	`to_æßt
(
image_width
), 
size_cÛf
))

392 
image
 = 
tf
.image.
	$»size_images
(

393 
image
, [
image_Ãwysize
, 
image_Ãwxsize
], 
®ign_cÜÃrs
=
True
)

394 
»suÉ
.
	$­³nd
(
image
)

395 
masks
:

396 
masks
 = 
tf
.
image
.
	$»size_Ã¬e¡_ÃighbÜ
(

397 
masks
, [
image_Ãwysize
, 
image_Ãwxsize
], 
®ign_cÜÃrs
=
True
)

398 
»suÉ
.
	$­³nd
(
masks
)

399  
	$tu¶e
(
»suÉ
)

402 
def
 
	$¿ndom_rgb_to_g¿y
(
image
, 
´obab™y
=0.1, 
£ed
=
NÚe
):

405 
Args
:

406 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚšs
 1 imag-> [
height
, 
width
, 
chªÃls
]

407 
w™h
 
pix–
 
v®ues
 
v¬yšg
 
b‘w“n
 [0, 1].

408 
´obab™y
: 
the
…robab™y 
of
 
»tuºšg
 
a
 
g¿ysÿË
 
image
.

409 
The
 
´obab™y
 
should
 
be
 
a
 
numb”
 
b‘w“n
 [0, 1].

410 
£ed
: 
¿ndom
 seed.

412 
R‘uºs
:

413 
image
: imag
which
 
is
 
the
 
§me
 
sh­e
 
as
 
šput
 image.

415 
def
 
	$_image_to_g¿y
(
image
):

416 
image_g¿y1
 = 
tf
.
image
.
	$rgb_to_g¿ysÿË
(
image
)

417 
image_g¿y3
 = 
tf
.
image
.
	$g¿ysÿË_to_rgb
(
image_g¿y1
)

418  
image_g¿y3


420 
w™h
 
tf
.
	`Çme_scİe
('RªdomRGBtoG¿y', 
v®ues
=[
image
]):

421 #¿ndom 
v¬ŸbË
 
defššg
 
wh‘h”
 
to
 dØ
æ
 
Ü
 
nÙ


422 
do_g¿y_¿ndom
 = 
tf
.
	$¿ndom_unifÜm
([], 
£ed
=seed)

424 
image
 = 
tf
.
	`cÚd
(

425 
tf
.
	`g»©”
(
do_g¿y_¿ndom
, 
´obab™y
), 
Ïmbda
: 
image
,

426 
Ïmbda
: 
	$_image_to_g¿y
(
image
))

428  
image


431 
def
 
	$¿ndom_adju¡_brighŠess
(
image
, 
max_d–
=0.2):

434 
Makes
 
su»
 
the
 
ouut
 
image
 
is
 
¡l
 
b‘w“n
 0 
ªd
 1.

436 
Args
:

437 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚšs
 1 imag-> [
height
, 
width
, 
chªÃls
]

438 
w™h
 
pix–
 
v®ues
 
v¬yšg
 
b‘w“n
 [0, 1].

439 
max_d–
: 
how
 
much
 
to
 
chªge
 
the
 
brighŠess
. 
A
 
v®ue
 
b‘w“n
 [0, 1).

441 
R‘uºs
:

442 
image
: imag
which
 
is
 
the
 
§me
 
sh­e
 
as
 
šput
 image.

443 
boxes
: boxe 
which
 
is
 
the
 
§me
 
sh­e
 
as
 
šput
 boxes.

445 
w™h
 
tf
.
	`Çme_scİe
('RªdomAdju¡BrighŠess', 
v®ues
=[
image
]):

446 
image
 = 
tf
.image.
	$¿ndom_brighŠess
(
image
, 
max_d–
)

447 
image
 = 
tf
.
	$ş_by_v®ue
(
image
, 
ş_v®ue_mš
=0.0, 
ş_v®ue_max
=1.0)

448  
image


451 
def
 
	$¿ndom_adju¡_cÚŒa¡
(
image
, 
mš_d–
=0.8, 
max_d–
=1.25):

454 
Makes
 
su»
 
the
 
ouut
 
image
 
is
 
¡l
 
b‘w“n
 0 
ªd
 1.

456 
Args
:

457 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚšs
 1 imag-> [
height
, 
width
, 
chªÃls
]

458 
w™h
 
pix–
 
v®ues
 
v¬yšg
 
b‘w“n
 [0, 1].

459 
mš_d–
: 
£e
 
max_d–
.

460 
max_d–
: 
how
 
much
 
to
 
chªge
 
the
 
cÚŒa¡
. 
CÚŒa¡
 
wl
 chªg
w™h
 
a


461 
v®ue
 
b‘w“n
 
mš_d–
 
ªd
 
max_d–
. 
This
 v®u
wl
 
be


462 
muÉl›d
 
to
 
the
 
cu¼’t
 
cÚŒa¡
 
of
h
image
.

464 
R‘uºs
:

465 
image
: imag
which
 
is
 
the
 
§me
 
sh­e
 
as
 
šput
 image.

467 
w™h
 
tf
.
	`Çme_scİe
('RªdomAdju¡CÚŒa¡', 
v®ues
=[
image
]):

468 
image
 = 
tf
.image.
	$¿ndom_cÚŒa¡
(
image
, 
mš_d–
, 
max_d–
)

469 
image
 = 
tf
.
	$ş_by_v®ue
(
image
, 
ş_v®ue_mš
=0.0, 
ş_v®ue_max
=1.0)

470  
image


473 
def
 
	$¿ndom_adju¡_hue
(
image
, 
max_d–
=0.02):

476 
Makes
 
su»
 
the
 
ouut
 
image
 
is
 
¡l
 
b‘w“n
 0 
ªd
 1.

478 
Args
:

479 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚšs
 1 imag-> [
height
, 
width
, 
chªÃls
]

480 
w™h
 
pix–
 
v®ues
 
v¬yšg
 
b‘w“n
 [0, 1].

481 
max_d–
: 
chªge
 
hue
 
¿ndomly
 
w™h
 
a
 
v®ue
 
b‘w“n
 0 
ªd
 max_delta.

483 
R‘uºs
:

484 
image
: imag
which
 
is
 
the
 
§me
 
sh­e
 
as
 
šput
 image.

486 
w™h
 
tf
.
	`Çme_scİe
('RªdomAdju¡Hue', 
v®ues
=[
image
]):

487 
image
 = 
tf
.image.
	$¿ndom_hue
(
image
, 
max_d–
)

488 
image
 = 
tf
.
	$ş_by_v®ue
(
image
, 
ş_v®ue_mš
=0.0, 
ş_v®ue_max
=1.0)

489  
image


492 
def
 
	$¿ndom_adju¡_§tu¿tiÚ
(
image
, 
mš_d–
=0.8, 
max_d–
=1.25):

495 
Makes
 
su»
 
the
 
ouut
 
image
 
is
 
¡l
 
b‘w“n
 0 
ªd
 1.

497 
Args
:

498 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚšs
 1 imag-> [
height
, 
width
, 
chªÃls
]

499 
w™h
 
pix–
 
v®ues
 
v¬yšg
 
b‘w“n
 [0, 1].

500 
mš_d–
: 
£e
 
max_d–
.

501 
max_d–
: 
how
 
much
 
to
 
chªge
 
the
 
§tu¿tiÚ
. 
S©u¿tiÚ
 
wl
 chªg
w™h
 
a


502 
v®ue
 
b‘w“n
 
mš_d–
 
ªd
 
max_d–
. 
This
 v®u
wl
 
be


503 
muÉl›d
 
to
 
the
 
cu¼’t
 
§tu¿tiÚ
 
of
h
image
.

505 
R‘uºs
:

506 
image
: imag
which
 
is
 
the
 
§me
 
sh­e
 
as
 
šput
 image.

508 
w™h
 
tf
.
	`Çme_scİe
('RªdomAdju¡S©u¿tiÚ', 
v®ues
=[
image
]):

509 
image
 = 
tf
.image.
	$¿ndom_§tu¿tiÚ
(
image
, 
mš_d–
, 
max_d–
)

510 
image
 = 
tf
.
	$ş_by_v®ue
(
image
, 
ş_v®ue_mš
=0.0, 
ş_v®ue_max
=1.0)

511  
image


514 
def
 
	$¿ndom_di¡Üt_cŞÜ
(
image
, 
cŞÜ_Üd”šg
=0):

517 
Rªdomly
 
di¡Üts
 
cŞÜ
 
usšg
 
a
 
combš©iÚ
 
of
 
brighŠess
, 
hue
, 
cÚŒa¡


518 
ªd
 
§tu¿tiÚ
 
chªges
. 
Makes
 
su»
 
the
 
ouut
 
image
 
is
 
¡l
 
b‘w“n
 0‡nd 1.

520 
Args
:

521 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚšs
 1 imag-> [
height
, 
width
, 
chªÃls
]

522 
w™h
 
pix–
 
v®ues
 
v¬yšg
 
b‘w“n
 [0, 1].

523 
cŞÜ_Üd”šg
: 
PythÚ
 , 
a
 
ty³
 
of
 
	`di¡ÜtiÚ
 (
v®id
 
v®ues
: 0, 1).

525 
R‘uºs
:

526 
image
: imag
which
 
is
 
the
 
§me
 
sh­e
 
as
 
šput
 image.

528 
Rai£s
:

529 
V®ueE¼Ü
: 
cŞÜ_Üd”šg
 
is
 
nÙ
 
š
 {0, 1
	}
}.

531 
w™h
 
	gtf
.
Çme_scİe
('RªdomDi¡ÜtCŞÜ', 
v®ues
=[
image
]):

532 
cŞÜ_Üd”šg
 == 0:

533 
image
 = 
tf
.image.
¿ndom_brighŠess
(image, 
max_d–
=32. / 255.)

534 
image
 = 
tf
.image.
	$¿ndom_§tu¿tiÚ
(
image
, 
low”
=0.5, 
uµ”
=1.5)

535 
image
 = 
tf
.image.
	$¿ndom_hue
(
image
, 
max_d–
=0.2)

536 
image
 = 
tf
.image.
	$¿ndom_cÚŒa¡
(
image
, 
low”
=0.5, 
uµ”
=1.5)

537 
–if
 
cŞÜ_Üd”šg
 == 1:

538 
image
 = 
tf
.image.
	`¿ndom_brighŠess
(image, 
max_d–
=32. / 255.)

539 
image
 = 
tf
.image.
	$¿ndom_cÚŒa¡
(
image
, 
low”
=0.5, 
uµ”
=1.5)

540 
image
 = 
tf
.image.
	$¿ndom_§tu¿tiÚ
(
image
, 
low”
=0.5, 
uµ”
=1.5)

541 
image
 = 
tf
.image.
	$¿ndom_hue
(
image
, 
max_d–
=0.2)

543 
¿i£
 
	`V®ueE¼Ü
('color_ordering must be in {0, 1}')

545 #Th
¿ndom_
* 
İs
 dØ
nÙ
 
Ãûs§ry
 
şamp
.

546 
image
 = 
tf
.
	$ş_by_v®ue
(
image
, 0.0, 1.0)

547  
image


550 
def
 
	$¿ndom_j™‹r_boxes
(
boxes
, 
¿tio
=0.05, 
£ed
=
NÚe
):

553 
Args
:

554 
boxes
: 
¿nk
 2 
æßt32
 
‹nsÜ
 
cÚššg
 
the
 
boundšg
 boxe -> [
N
, 4].

555 
Boxes
 
¬e
 
š
 
nÜm®ized
 
fÜm
 
m—nšg
 
theœ
 
coÜdš©es
 
v¬y


556 
b‘w“n
 [0, 1].

557 
Each
 
row
 
is
 
š
 
the
 
fÜm
 
of
 [
ymš
, 
xmš
, 
ymax
, 
xmax
].

558 
¿tio
: 
The
„©iØ
of
 
the
 
box
 
width
 
ªd
 
height
 
th©
h
cÜÃrs
 
ÿn
 
j™‹r
.

559 
FÜ
 
exam¶e
 
the
 
width
 
is
 100 
pix–s
 
ªd
 
¿tio
 is 0.05,

560 
the
 
cÜÃrs
 
ÿn
 
j™‹r
 
up
 
to
 5 
pix–s
 
š
h
x
 
dœeùiÚ
.

561 
£ed
: 
¿ndom
 seed.

563 
R‘uºs
:

564 
boxes
: boxe 
which
 
is
 
the
 
§me
 
sh­e
 
as
 
šput
 boxes.

566 
def
 
	$¿ndom_j™‹r_box
(
box
, 
¿tio
, 
£ed
):

569 
Args
:

570 
box
: 
boundšg
 box [1, 1, 4].

571 
¿tio
: 
max
„©iØ
b‘w“n
 
j™‹»d
 
box
 
ªd
 
Üigš®
 box,

572 
a
 
numb”
 
b‘w“n
 [0, 0.5].

573 
£ed
: 
¿ndom
 seed.

575 
R‘uºs
:

576 
j™‹»d_box
: 
j™‹»d
 
box
.

578 
¿nd_numb”s
 = 
tf
.
	`¿ndom_unifÜm
(

579 [1, 1, 4], 
mšv®
=-
¿tio
, 
maxv®
ô©io, 
dty³
=
tf
.
æßt32
, 
£ed
=seed)

580 
box_width
 = 
tf
.
	$subŒaù
(
box
[0, 0, 3], box[0, 0, 1])

581 
box_height
 = 
tf
.
	$subŒaù
(
box
[0, 0, 2], box[0, 0, 0])

582 
hw_cÛfs
 = 
tf
.
	$¡ack
([
box_height
, 
box_width
, box_height, box_width])

583 
hw_¿nd_cÛfs
 = 
tf
.
	$muÉly
(
hw_cÛfs
, 
¿nd_numb”s
)

584 
j™‹»d_box
 = 
tf
.
	$add
(
box
, 
hw_¿nd_cÛfs
)

585 
j™‹»d_box
 = 
tf
.
	$ş_by_v®ue
(
j™‹»d_box
, 0.0, 1.0)

586  
j™‹»d_box


588 
w™h
 
tf
.
	`Çme_scİe
('RªdomJ™‹rBoxes', 
v®ues
=[
boxes
]):

589 #boxe 
¬e
 [
N
, 4]. 
L‘s
 
fœ¡
 
make
 
them
 [N, 1, 1, 4]

590 
boxes_sh­e
 = 
tf
.
	$sh­e
(
boxes
)

591 
boxes
 = 
tf
.
	$ex·nd_dims
(
boxes
, 1)

592 
boxes
 = 
tf
.
	$ex·nd_dims
(
boxes
, 2)

594 
di¡Ü‹d_boxes
 = 
tf
.
	`m­_â
(

595 
Ïmbda
 
x
: 
	`¿ndom_j™‹r_box
(x, 
¿tio
, 
£ed
), 
boxes
, 
dty³
=
tf
.
æßt32
)

597 
di¡Ü‹d_boxes
 = 
tf
.
	$»sh­e
(
di¡Ü‹d_boxes
, 
boxes_sh­e
)

599  
di¡Ü‹d_boxes


602 
def
 
	`_¡riù_¿ndom_üİ_image
(
image
,

603 
boxes
,

604 
Ïb–s
,

605 
masks
=
NÚe
,

606 
keypošts
=
NÚe
,

607 
mš_objeù_cov”ed
=1.0,

608 
a¥eù_¿tio_¿nge
=(0.75, 1.33),

609 
¬—_¿nge
=(0.1, 1.0),

610 
ov”Ïp_th»sh
=0.3):

613 
NÙe
: 
boxes
 
wl
 
be
 
ş³d
 
to
 
the
 
üİ
. 
Keypošt
 
coÜdš©es
 
th©
 
¬e


614 
outside
 
the
 
üİ
 
wl
 
be
 
£t
 
to
 
NaN
, 
which
 
is
 
cÚsi¡’t
 
w™h
h
Üigš®


615 
keypošt
 
’codšg
 
nÚ
-
exi¡šg
 
keypošts
. 
This
 
funùiÚ
 
®ways
 
üİs


616 
the
 
image
 
ªd
 
is
 
suµo£d
 
to
 
be
 
u£d
 
by
 `
¿ndom_üİ_image
` 
funùiÚ
 
which


617 
som‘imes
 
»tuºs
 
image
 
unchªged
.

619 
Args
:

620 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚššg
 1 imag-> [
height
, 
width
, 
chªÃls
]

621 
w™h
 
pix–
 
v®ues
 
v¬yšg
 
b‘w“n
 [0, 1].

622 
boxes
: 
¿nk
 2 
æßt32
 
‹nsÜ
 
cÚššg
 
the
 
boundšg
 boxe 
w™h
 
sh­e


623 [
num_š¡ªûs
, 4].

624 
Boxes
 
¬e
 
š
 
nÜm®ized
 
fÜm
 
m—nšg
 
theœ
 
coÜdš©es
 
v¬y


625 
b‘w“n
 [0, 1].

626 
Each
 
row
 
is
 
š
 
the
 
fÜm
 
of
 [
ymš
, 
xmš
, 
ymax
, 
xmax
].

627 
Ïb–s
: 
¿nk
 1 
št32
 
‹nsÜ
 
cÚššg
 
the
 
objeù
 
şas£s
.

628 
masks
: (
İtiÚ®
è
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


629 [
num_š¡ªûs
, 
height
, 
width
] 
cÚššg
 
š¡ªû
 
masks
. 
The
 masks

630 
¬e
 
of
 
the
 
§me
 
height
, 
width
 
as
h
šput
 `
image
`.

631 
keypošts
: (
İtiÚ®
è
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


632 [
num_š¡ªûs
, 
num_keypošts
, 2]. 
The
 
keypošts
 
¬e
 
š
 
y
-
x


633 
nÜm®ized
 
coÜdš©es
.

634 
mš_objeù_cov”ed
: 
the
 
üİ³d
 
image
 
mu¡
 
cov”
 
©
 
Ëa¡
 
this
 
äaùiÚ
 
of


635 
©
 
Ëa¡
 
Úe
 
of
 
the
 
šput
 
boundšg
 
boxes
.

636 
a¥eù_¿tio_¿nge
: 
®lowed
 
¿nge
 
a¥eù
 
¿tio
 
of
 
üİ³d
 
image
.

637 
¬—_¿nge
: 
®lowed
 
¿nge
 
¬—
 
¿tio
 
b‘w“n
 
üİ³d
 
image
 
ªd
 
the


638 
Üigš®
 
image
.

639 
ov”Ïp_th»sh
: 
mšimum
 
ov”Ïp
 
th»sh
 
w™h
 
Ãw
 
üİ³d


640 
image
 
to
 
k“p
 
the
 
box
.

642 
R‘uºs
:

643 
image
: imag
which
 
is
 
the
 
§me
 
¿nk
 
as
 
šput
 image.

644 
boxes
: boxe 
which
 
is
 
the
 
§me
 
¿nk
 
as
 
šput
 boxes.

645 
Boxes
 
¬e
 
š
 
nÜm®ized
 
fÜm
.

646 
Ïb–s
: 
Ãw
†abels.

648 
If
 
masks
, 
Ü
 
keypošts
 
is
 
nÙ
 
NÚe
, 
the
 
funùiÚ
 
®so
 
»tuºs
:

650 
masks
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
num_š¡ªûs
, 
height
, 
width
]

651 
cÚššg
 
š¡ªû
 
masks
.

652 
keypošts
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


653 [
num_š¡ªûs
, 
num_keypošts
, 2]

655 
w™h
 
tf
.
	`Çme_scİe
('RªdomCrİImage', 
v®ues
=[
image
, 
boxes
]):

656 
image_sh­e
 = 
tf
.
	$sh­e
(
image
)

658 #boxe 
¬e
 [
N
, 4]. 
L‘s
 
fœ¡
 
make
 
them
 [N, 1, 4].

659 
boxes_ex·nded
 = 
tf
.
	`ex·nd_dims
(

660 
tf
.
	`ş_by_v®ue
(

661 
boxes
, 
ş_v®ue_mš
=0.0, 
ş_v®ue_max
=1.0), 1)

663 
§m¶e_di¡Ü‹d_boundšg_box
 = 
tf
.
image
.
	$§m¶e_di¡Ü‹d_boundšg_box
(

664 
image_sh­e
,

665 
boundšg_boxes
=
boxes_ex·nded
,

666 
mš_objeù_cov”ed
=min_object_covered,

667 
a¥eù_¿tio_¿nge
=aspect_ratio_range,

668 
¬—_¿nge
=area_range,

669 
max_©‹m±s
=100,

670 
u£_image_if_no_boundšg_boxes
=
True
)

672 
im_box_begš
, 
im_box_size
, 
im_box
 = 
§m¶e_di¡Ü‹d_boundšg_box


674 
Ãw_image
 = 
tf
.
	$¦iû
(
image
, 
im_box_begš
, 
im_box_size
)

675 
Ãw_image
.
	`£t_sh­e
([
NÚe
, NÚe, 
image
.
	`g‘_sh­e
()[2]])

678 
im_box_¿nk2
 = 
tf
.
	$squ“ze
(
im_box
, 
squ“ze_dims
=[0])

680 
im_box_¿nk1
 = 
tf
.
	$squ“ze
(
im_box
)

682 
boxli¡
 = 
box_li¡
.
	$BoxLi¡
(
boxes
)

683 
boxli¡
.
	`add_f›ld
('Ïb–s', 
Ïb–s
)

685 
im_boxli¡
 = 
box_li¡
.
	$BoxLi¡
(
im_box_¿nk2
)

687 #»mov
boxes
 
th©
 
¬e
 
outside
 
üİ³d
 
image


688 
boxli¡
, 
šside_wšdow_ids
 = 
box_li¡_İs
.
	$´uÃ_com¶‘–y_outside_wšdow
(

689 
boxli¡
, 
im_box_¿nk1
)

691 #»mov
boxes
 
th©
 
¬e
 
outside
 
image


692 
ov”Ïµšg_boxli¡
, 
k“p_ids
 = 
box_li¡_İs
.
	$´uÃ_nÚ_ov”Ïµšg_boxes
(

693 
boxli¡
, 
im_boxli¡
, 
ov”Ïp_th»sh
)

695 #chªg
the
 
coÜdš©e
 
of
h
»maššg
 
boxes


696 
Ãw_Ïb–s
 = 
ov”Ïµšg_boxli¡
.
	`g‘_f›ld
('labels')

697 
Ãw_boxli¡
 = 
box_li¡_İs
.
	$chªge_coÜdš©e_äame
(
ov”Ïµšg_boxli¡
,

698 
im_box_¿nk1
)

699 
Ãw_boxes
 = 
Ãw_boxli¡
.
	$g‘
()

700 
Ãw_boxes
 = 
tf
.
	$ş_by_v®ue
(

701 
Ãw_boxes
, 
ş_v®ue_mš
=0.0, 
ş_v®ue_max
=1.0)

703 
»suÉ
 = [
Ãw_image
, 
Ãw_boxes
, 
Ãw_Ïb–s
]

705 
masks
 
is
 
nÙ
 
NÚe
:

706 
masks_of_boxes_šside_wšdow
 = 
tf
.
	$g©h”
(
masks
, 
šside_wšdow_ids
)

707 
masks_of_boxes_com¶‘–y_šside_wšdow
 = 
tf
.
	$g©h”
(

708 
masks_of_boxes_šside_wšdow
, 
k“p_ids
)

709 
masks_box_begš
 = [0, 
im_box_begš
[0], im_box_begin[1]]

710 
masks_box_size
 = [-1, 
im_box_size
[0], im_box_size[1]]

711 
Ãw_masks
 = 
tf
.
	$¦iû
(

712 
masks_of_boxes_com¶‘–y_šside_wšdow
,

713 
masks_box_begš
, 
masks_box_size
)

714 
»suÉ
.
	$­³nd
(
Ãw_masks
)

716 
keypošts
 
is
 
nÙ
 
NÚe
:

717 
keypošts_of_boxes_šside_wšdow
 = 
tf
.
	$g©h”
(
keypošts
, 
šside_wšdow_ids
)

718 
keypošts_of_boxes_com¶‘–y_šside_wšdow
 = 
tf
.
	$g©h”
(

719 
keypošts_of_boxes_šside_wšdow
, 
k“p_ids
)

720 
Ãw_keypošts
 = 
keypošt_İs
.
	$chªge_coÜdš©e_äame
(

721 
keypošts_of_boxes_com¶‘–y_šside_wšdow
, 
im_box_¿nk1
)

722 
Ãw_keypošts
 = 
keypošt_İs
.
	$´uÃ_outside_wšdow
(
Ãw_keypošts
,

724 
»suÉ
.
	$­³nd
(
Ãw_keypošts
)

726  
	$tu¶e
(
»suÉ
)

729 
def
 
	`¿ndom_üİ_image
(
image
,

730 
boxes
,

731 
Ïb–s
,

732 
masks
=
NÚe
,

733 
keypošts
=
NÚe
,

734 
mš_objeù_cov”ed
=1.0,

735 
a¥eù_¿tio_¿nge
=(0.75, 1.33),

736 
¬—_¿nge
=(0.1, 1.0),

737 
ov”Ïp_th»sh
=0.3,

738 
¿ndom_cÛf
=0.0,

739 
£ed
=
NÚe
):

742 
Giv’
 
the
 
šput
 
image
 
ªd
 
™s
 
boundšg
 
boxes
, 
this
 
İ
 
¿ndomly


743 
üİs
 
a
 
subimage
. 
Giv’
‡ 
u£r
-
´ovided
 
£t
 
of
 
šput
 
cÚ¡¿šts
,

744 
the
 
üİ
 
wšdow
 
is
 
»§m¶ed
 
uÁ
 
™
 
§tisf›s
 
the£
 
cÚ¡¿šts
.

745 
If
 
w™hš
 100 
ŒŸls
 
™
 
is
 
uÇbË
 
to
 
fšd
 
a
 
v®id
 
üİ
, 
the
 
Üigš®


746 
image
 
is
 
»tuºed
. 
S“
 
the
 
Args
 
£ùiÚ
 
a
 
desütiÚ
 
of
h
šput


747 
cÚ¡¿šts
. 
BÙh
 
šput
 
boxes
 
ªd
 
»tuºed
 
Boxes
 
¬e
 
š
 
nÜm®ized


748 
	`fÜm
 (
e
.
g
., 
l›
 
š
 
the
 
un™
 
squ¬e
 [0, 1]).

749 
This
 
funùiÚ
 
wl
  
the
 
Üigš®
 
image
 
w™h
 
´obab™y
 
¿ndom_cÛf
.

751 
NÙe
: 
boxes
 
wl
 
be
 
ş³d
 
to
 
the
 
üİ
. 
Keypošt
 
coÜdš©es
 
th©
 
¬e


752 
outside
 
the
 
üİ
 
wl
 
be
 
£t
 
to
 
NaN
, 
which
 
is
 
cÚsi¡’t
 
w™h
h
Üigš®


753 
keypošt
 
’codšg
 
nÚ
-
exi¡šg
 
keypošts
.

755 
Args
:

756 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚšs
 1 imag-> [
height
, 
width
, 
chªÃls
]

757 
w™h
 
pix–
 
v®ues
 
v¬yšg
 
b‘w“n
 [0, 1].

758 
boxes
: 
¿nk
 2 
æßt32
 
‹nsÜ
 
cÚššg
 
the
 
boundšg
 boxe 
w™h
 
sh­e


759 [
num_š¡ªûs
, 4].

760 
Boxes
 
¬e
 
š
 
nÜm®ized
 
fÜm
 
m—nšg
 
theœ
 
coÜdš©es
 
v¬y


761 
b‘w“n
 [0, 1].

762 
Each
 
row
 
is
 
š
 
the
 
fÜm
 
of
 [
ymš
, 
xmš
, 
ymax
, 
xmax
].

763 
Ïb–s
: 
¿nk
 1 
št32
 
‹nsÜ
 
cÚššg
 
the
 
objeù
 
şas£s
.

764 
masks
: (
İtiÚ®
è
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


765 [
num_š¡ªûs
, 
height
, 
width
] 
cÚššg
 
š¡ªû
 
masks
. 
The
 masks

766 
¬e
 
of
 
the
 
§me
 
height
, 
width
 
as
h
šput
 `
image
`.

767 
keypošts
: (
İtiÚ®
è
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


768 [
num_š¡ªûs
, 
num_keypošts
, 2]. 
The
 
keypošts
 
¬e
 
š
 
y
-
x


769 
nÜm®ized
 
coÜdš©es
.

770 
mš_objeù_cov”ed
: 
the
 
üİ³d
 
image
 
mu¡
 
cov”
 
©
 
Ëa¡
 
this
 
äaùiÚ
 
of


771 
©
 
Ëa¡
 
Úe
 
of
 
the
 
šput
 
boundšg
 
boxes
.

772 
a¥eù_¿tio_¿nge
: 
®lowed
 
¿nge
 
a¥eù
 
¿tio
 
of
 
üİ³d
 
image
.

773 
¬—_¿nge
: 
®lowed
 
¿nge
 
¬—
 
¿tio
 
b‘w“n
 
üİ³d
 
image
 
ªd
 
the


774 
Üigš®
 
image
.

775 
ov”Ïp_th»sh
: 
mšimum
 
ov”Ïp
 
th»sh
 
w™h
 
Ãw
 
üİ³d


776 
image
 
to
 
k“p
 
the
 
box
.

777 
¿ndom_cÛf
: 
a
 
¿ndom
 
cÛffic›Á
 
th©
 
defšes
 
the
 
chªû
 
of
 
g‘tšg
he

778 
Üigš®
 
image
. 
If
 
¿ndom_cÛf
 
is
 0, 
we
 
wl
 
®ways
 
g‘
 
the


779 
üİ³d
 
image
, 
ªd
 
™
 
is
 1.0, 
we
 
wl
 
®ways
 
g‘
 
the


780 
Üigš®
 
image
.

781 
£ed
: 
¿ndom
 seed.

783 
R‘uºs
:

784 
image
: 
Image
 
sh­e
 
wl
 
be
 [
Ãw_height
, 
Ãw_width
, 
chªÃls
].

785 
boxes
: boxe 
which
 
is
 
the
 
§me
 
¿nk
 
as
 
šput
 boxes. 
Boxes
 
¬e
 
š
 
nÜm®ized


786 
fÜm
.

787 
Ïb–s
: 
Ãw
†abels.

789 
If
 
masks
, 
Ü
 
keypošts
 
¬e
 
nÙ
 
NÚe
, 
the
 
funùiÚ
 
®so
 
»tuºs
:

791 
masks
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
num_š¡ªûs
, 
height
, 
width
]

792 
cÚššg
 
š¡ªû
 
masks
.

793 
keypošts
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


794 [
num_š¡ªûs
, 
num_keypošts
, 2]

797 
def
 
	$¡riù_¿ndom_üİ_image_â
():

798  
	$_¡riù_¿ndom_üİ_image
(

799 
image
,

800 
boxes
,

801 
Ïb–s
,

802 
masks
=masks,

803 
keypošts
=keypoints,

804 
mš_objeù_cov”ed
=min_object_covered,

805 
a¥eù_¿tio_¿nge
=aspect_ratio_range,

806 
¬—_¿nge
=area_range,

807 
ov”Ïp_th»sh
=overlap_thresh)

809 #avoid 
tf
.
cÚd
 
to
 
make
 
ç¡”
 
RCNN
 
Œaššg
 
Ú
 
bÜg
. 
S“
 
b
/140057645.

810 
¿ndom_cÛf
 < 
sys
.
æßt_šfo
.
mš
:

811 
»suÉ
 = 
	$¡riù_¿ndom_üİ_image_â
()

813 
do_a_üİ_¿ndom
 = 
tf
.
	$¿ndom_unifÜm
([], 
£ed
=seed)

814 
do_a_üİ_¿ndom
 = 
tf
.
	$g»©”
(
do_a_üİ_¿ndom
, 
¿ndom_cÛf
)

816 
ouuts
 = [
image
, 
boxes
, 
Ïb–s
]

817 
masks
 
is
 
nÙ
 
NÚe
:

818 
ouuts
.
	$­³nd
(
masks
)

819 
keypošts
 
is
 
nÙ
 
NÚe
:

820 
ouuts
.
	$­³nd
(
keypošts
)

822 
»suÉ
 = 
tf
.
	`cÚd
(
do_a_üİ_¿ndom
,

823 
¡riù_¿ndom_üİ_image_â
,

824 
Ïmbda
: 
	$tu¶e
(
ouuts
))

825  
»suÉ


828 
def
 
	$¿ndom_·d_image
(
image
,

829 
boxes
,

830 
mš_image_size
=
NÚe
,

831 
max_image_size
=
NÚe
,

832 
·d_cŞÜ
=
NÚe
,

833 
£ed
=
NÚe
):

836 
This
 
funùiÚ
 
¿ndomly
 
·ds
 
the
 
image
 
w™h
 
z”os
. 
The
 
fš®
 
size
 
of
he

837 
·dded
 
image
 
wl
 
be
 
b‘w“n
 
mš_image_size
 
ªd
 
max_image_size
.

838 
mš_image_size
 
is
 
sm®Ër
 
thª
 
the
 
šput
 
image
 
size
, mš_image_siz
wl


839 
be
 
£t
 
to
 
the
 
šput
 
image
 
size
. 
The
 
§me
 
max_image_size
. The input image

840 
wl
 
be
 
loÿ‹d
 
©
 
a
 
unifÜmly
 
¿ndom
 
loÿtiÚ
 
šside
 
the
 
·dded
 
image
.

841 
The
 
»Ïtive
 
loÿtiÚ
 
of
 
the
 
boxes
 
to
h
Üigš®
 
image
 
wl
 
»maš
h
§me
.

843 
Args
:

844 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚššg
 1 imag-> [
height
, 
width
, 
chªÃls
]

845 
w™h
 
pix–
 
v®ues
 
v¬yšg
 
b‘w“n
 [0, 1].

846 
boxes
: 
¿nk
 2 
æßt32
 
‹nsÜ
 
cÚššg
 
the
 
boundšg
 boxe -> [
N
, 4].

847 
Boxes
 
¬e
 
š
 
nÜm®ized
 
fÜm
 
m—nšg
 
theœ
 
coÜdš©es
 
v¬y


848 
b‘w“n
 [0, 1].

849 
Each
 
row
 
is
 
š
 
the
 
fÜm
 
of
 [
ymš
, 
xmš
, 
ymax
, 
xmax
].

850 
mš_image_size
: 
a
 
‹nsÜ
 
of
 
size
 [
mš_height
, 
mš_width
], 
ty³
 
tf
.
št32
.

851 
If
 
·s£d
 
as
 
NÚe
, 
wl
 
be
 
£t
 
to
 
image
 
size


852 [
height
, 
width
].

853 
max_image_size
: 
a
 
‹nsÜ
 
of
 
size
 [
max_height
, 
max_width
], 
ty³
 
tf
.
št32
.

854 
If
 
·s£d
 
as
 
NÚe
, 
wl
 
be
 
£t
 
to
 
twiû
 
the


855 
image
 [
height
 * 2, 
width
 * 2].

856 
·d_cŞÜ
: 
·ddšg
 
cŞÜ
. 
A
 
¿nk
 1 
‹nsÜ
 
of
 [3] 
w™h
 
dty³
=
tf
.
æßt32
.

857 
£t
 
as
 
NÚe
, 
™
 
wl
 
be
 s‘ 
to
 
av”age
 
cŞÜ
 
of
 
the
 
šput


858 
image
.

860 
£ed
: 
¿ndom
 seed.

862 
R‘uºs
:

863 
image
: 
Image
 
sh­e
 
wl
 
be
 [
Ãw_height
, 
Ãw_width
, 
chªÃls
].

864 
boxes
: boxe 
which
 
is
 
the
 
§me
 
¿nk
 
as
 
šput
 boxes. 
Boxes
 
¬e
 
š
 
nÜm®ized


865 
fÜm
.

867 
·d_cŞÜ
 
is
 
NÚe
:

868 
·d_cŞÜ
 = 
tf
.
	$»duû_m—n
(
image
, 
»duùiÚ_šdiûs
=[0, 1])

870 
image_sh­e
 = 
tf
.
	$sh­e
(
image
)

871 
image_height
 = 
image_sh­e
[0]

872 
image_width
 = 
image_sh­e
[1]

874 
max_image_size
 
is
 
NÚe
:

875 
max_image_size
 = 
tf
.
	$¡ack
([
image_height
 * 2, 
image_width
 * 2])

876 
max_image_size
 = 
tf
.
	`maximum
(max_image_size,

877 
tf
.
	$¡ack
([
image_height
, 
image_width
]))

879 
mš_image_size
 
is
 
NÚe
:

880 
mš_image_size
 = 
tf
.
	$¡ack
([
image_height
, 
image_width
])

881 
mš_image_size
 = 
tf
.
	`maximum
(min_image_size,

882 
tf
.
	$¡ack
([
image_height
, 
image_width
]))

884 
rg‘_height
 = 
tf
.
	`cÚd
(

885 
max_image_size
[0] > 
mš_image_size
[0],

886 
Ïmbda
: 
	`_¿ndom_š‹g”
(
mš_image_size
[0], 
max_image_size
[0], 
£ed
),

887 
Ïmbda
: 
max_image_size
[0])

889 
rg‘_width
 = 
tf
.
	`cÚd
(

890 
max_image_size
[1] > 
mš_image_size
[1],

891 
Ïmbda
: 
	`_¿ndom_š‹g”
(
mš_image_size
[1], 
max_image_size
[1], 
£ed
),

892 
Ïmbda
: 
max_image_size
[1])

894 
off£t_height
 = 
tf
.
	`cÚd
(

895 
rg‘_height
 > 
image_height
,

896 
Ïmbda
: 
	`_¿ndom_š‹g”
(0, 
rg‘_height
 - 
image_height
, 
£ed
),

897 
Ïmbda
: 
tf
.
	$cÚ¡ªt
(0, 
dty³
=
tf
.
št32
))

899 
off£t_width
 = 
tf
.
	`cÚd
(

900 
rg‘_width
 > 
image_width
,

901 
Ïmbda
: 
	`_¿ndom_š‹g”
(0, 
rg‘_width
 - 
image_width
, 
£ed
),

902 
Ïmbda
: 
tf
.
	$cÚ¡ªt
(0, 
dty³
=
tf
.
št32
))

904 
Ãw_image
 = 
tf
.
image
.
	$·d_to_boundšg_box
(

905 
image
, 
off£t_height
=off£t_height, 
off£t_width
=offset_width,

906 
rg‘_height
ñ¬g‘_height, 
rg‘_width
=target_width)

908 #S‘tšg 
cŞÜ
 
of
 
the
 
·dded
 
pix–s


909 
image_Úes
 = 
tf
.
	$Úes_like
(
image
)

910 
image_Úes_·dded
 = 
tf
.
image
.
	$·d_to_boundšg_box
(

911 
image_Úes
, 
off£t_height
=off£t_height, 
off£t_width
=offset_width,

912 
rg‘_height
ñ¬g‘_height, 
rg‘_width
=target_width)

913 
image_cŞÜ_·ded
 = (1.0 - 
image_Úes_·dded
è* 
·d_cŞÜ


914 
Ãw_image
 +ğ
image_cŞÜ_·ded


916 #£‰šg 
boxes


917 
Ãw_wšdow
 = 
tf
.
	`to_æßt
(

918 
tf
.
	`¡ack
([

919 -
off£t_height
, -
off£t_width
, 
rg‘_height
 - offset_height,

920 
rg‘_width
 - 
off£t_width


922 
Ãw_wšdow
 /ğ
tf
.
	`to_æßt
(

923 
tf
.
	$¡ack
([
image_height
, 
image_width
, image_height, image_width]))

924 
boxli¡
 = 
box_li¡
.
	$BoxLi¡
(
boxes
)

925 
Ãw_boxli¡
 = 
box_li¡_İs
.
	$chªge_coÜdš©e_äame
(
boxli¡
, 
Ãw_wšdow
)

926 
Ãw_boxes
 = 
Ãw_boxli¡
.
	$g‘
()

928  
Ãw_image
, 
Ãw_boxes


931 
def
 
	`¿ndom_üİ_·d_image
(
image
,

932 
boxes
,

933 
Ïb–s
,

934 
mš_objeù_cov”ed
=1.0,

935 
a¥eù_¿tio_¿nge
=(0.75, 1.33),

936 
¬—_¿nge
=(0.1, 1.0),

937 
ov”Ïp_th»sh
=0.3,

938 
¿ndom_cÛf
=0.0,

939 
mš_·dded_size_¿tio
=
NÚe
,

940 
max_·dded_size_¿tio
=
NÚe
,

941 
·d_cŞÜ
=
NÚe
,

942 
£ed
=
NÚe
):

945 
Giv’
 
ª
 
šput
 
image
 
ªd
 
™s
 
boundšg
 
boxes
, 
this
 
İ
 
fœ¡
 
¿ndomly
 
üİs


946 
the
 
image
 
ªd
 
th’
 
¿ndomly
 
·ds
himag
w™h
 
background
 
v®ues
. 
P¬am‘”s


947 
mš_·dded_size_¿tio
 
ªd
 
max_·dded_size_¿tio
, 
d‘”mše
 
the
 
¿nge
 
of
he

948 
fš®
 
ouut
 
image
 
size
. 
S³cifiÿÎy
, 
the
 fš® imagsiz
wl
 
have
 
a
 size

949 
š
 
the
 
¿nge
 
of
 
mš_·dded_size_¿tio
 * 
tf
.
	$sh­e
(
image
è
ªd


950 
max_·dded_size_¿tio
 * 
tf
.
	`sh­e
(
image
). 
NÙe
 
th©
 
the£
 
¿tios
 
¬e
 
w™h


951 
»¥eù
 
to
 
the
 
size
 
of
h
Üigš®
 
image
, 
so
 
we
 
ÿn
't capturehe same

952 
efãù
 
—sy
 
by
 
šd•’d’y
 
­¶yšg
 
RªdomCrİImage


953 
fŞlowed
 
by
 
RªdomPadImage
.

955 
Args
:

956 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚššg
 1 imag-> [
height
, 
width
, 
chªÃls
]

957 
w™h
 
pix–
 
v®ues
 
v¬yšg
 
b‘w“n
 [0, 1].

958 
boxes
: 
¿nk
 2 
æßt32
 
‹nsÜ
 
cÚššg
 
the
 
boundšg
 boxe -> [
N
, 4].

959 
Boxes
 
¬e
 
š
 
nÜm®ized
 
fÜm
 
m—nšg
 
theœ
 
coÜdš©es
 
v¬y


960 
b‘w“n
 [0, 1].

961 
Each
 
row
 
is
 
š
 
the
 
fÜm
 
of
 [
ymš
, 
xmš
, 
ymax
, 
xmax
].

962 
Ïb–s
: 
¿nk
 1 
št32
 
‹nsÜ
 
cÚššg
 
the
 
objeù
 
şas£s
.

963 
mš_objeù_cov”ed
: 
the
 
üİ³d
 
image
 
mu¡
 
cov”
 
©
 
Ëa¡
 
this
 
äaùiÚ
 
of


964 
©
 
Ëa¡
 
Úe
 
of
 
the
 
šput
 
boundšg
 
boxes
.

965 
a¥eù_¿tio_¿nge
: 
®lowed
 
¿nge
 
a¥eù
 
¿tio
 
of
 
üİ³d
 
image
.

966 
¬—_¿nge
: 
®lowed
 
¿nge
 
¬—
 
¿tio
 
b‘w“n
 
üİ³d
 
image
 
ªd
 
the


967 
Üigš®
 
image
.

968 
ov”Ïp_th»sh
: 
mšimum
 
ov”Ïp
 
th»sh
 
w™h
 
Ãw
 
üİ³d


969 
image
 
to
 
k“p
 
the
 
box
.

970 
¿ndom_cÛf
: 
a
 
¿ndom
 
cÛffic›Á
 
th©
 
defšes
 
the
 
chªû
 
of
 
g‘tšg
he

971 
Üigš®
 
image
. 
If
 
¿ndom_cÛf
 
is
 0, 
we
 
wl
 
®ways
 
g‘
 
the


972 
üİ³d
 
image
, 
ªd
 
™
 
is
 1.0, 
we
 
wl
 
®ways
 
g‘
 
the


973 
Üigš®
 
image
.

974 
mš_·dded_size_¿tio
: 
mš
 
¿tio
 
of
 
·dded
 
image
 
height
 
ªd
 
width
 
to
 
the


975 
šput
 
image
's height‡nd width. If None, it will

976 
be
 
£t
 
to
 [0.0, 0.0].

977 
max_·dded_size_¿tio
: 
max
 
¿tio
 
of
 
·dded
 
image
 
height
 
ªd
 
width
 
to
 
the


978 
šput
 
image
's height‡nd width. If None, it will

979 
be
 
£t
 
to
 [2.0, 2.0].

980 
·d_cŞÜ
: 
·ddšg
 
cŞÜ
. 
A
 
¿nk
 1 
‹nsÜ
 
of
 [3] 
w™h
 
dty³
=
tf
.
æßt32
.

981 
£t
 
as
 
NÚe
, 
™
 
wl
 
be
 s‘ 
to
 
av”age
 
cŞÜ
 
of
 
the
 
¿ndomly


982 
üİ³d
 
image
.

983 
£ed
: 
¿ndom
 seed.

985 
R‘uºs
:

986 
·dded_image
: 
·dded
 
image
.

987 
·dded_boxes
: 
boxes
 
which
 
is
 
the
 
§me
 
¿nk
 
as
 
šput
 boxes. 
Boxes
 
¬e
 
š


988 
nÜm®ized
 
fÜm
.

989 
üİ³d_Ïb–s
: 
üİ³d
 
Ïb–s
.

991 
image_size
 = 
tf
.
	$sh­e
(
image
)

992 
image_height
 = 
image_size
[0]

993 
image_width
 = 
image_size
[1]

994 
mš_·dded_size_¿tio
 
is
 
NÚe
:

995 
mš_·dded_size_¿tio
 = 
tf
.
	$cÚ¡ªt
([0.0, 0.0], 
tf
.
æßt32
)

996 
max_·dded_size_¿tio
 
is
 
NÚe
:

997 
max_·dded_size_¿tio
 = 
tf
.
	$cÚ¡ªt
([2.0, 2.0], 
tf
.
æßt32
)

998 
üİ³d_image
, 
üİ³d_boxes
, 
üİ³d_Ïb–s
 = 
	$¿ndom_üİ_image
(

999 
image
=image,

1000 
boxes
=boxes,

1001 
Ïb–s
=labels,

1002 
mš_objeù_cov”ed
=min_object_covered,

1003 
a¥eù_¿tio_¿nge
=aspect_ratio_range,

1004 
¬—_¿nge
=area_range,

1005 
ov”Ïp_th»sh
=overlap_thresh,

1006 
¿ndom_cÛf
=random_coef,

1007 
£ed
=seed)

1009 
mš_image_size
 = 
tf
.
	`to_št32
(

1010 
tf
.
	`to_æßt
Ñf.
	`¡ack
([
image_height
, 
image_width
])) *

1011 
mš_·dded_size_¿tio
)

1012 
max_image_size
 = 
tf
.
	`to_št32
(

1013 
tf
.
	`to_æßt
Ñf.
	`¡ack
([
image_height
, 
image_width
])) *

1014 
max_·dded_size_¿tio
)

1016 
·dded_image
, 
·dded_boxes
 = 
	$¿ndom_·d_image
(

1017 
üİ³d_image
,

1018 
üİ³d_boxes
,

1019 
mš_image_size
=min_image_size,

1020 
max_image_size
=max_image_size,

1021 
·d_cŞÜ
=pad_color,

1022 
£ed
=seed)

1024  
·dded_image
, 
·dded_boxes
, 
üİ³d_Ïb–s


1027 
def
 
	$¿ndom_üİ_to_a¥eù_¿tio
(
image
,

1028 
boxes
,

1029 
Ïb–s
,

1030 
masks
=
NÚe
,

1031 
keypošts
=
NÚe
,

1032 
a¥eù_¿tio
=1.0,

1033 
ov”Ïp_th»sh
=0.3,

1034 
£ed
=
NÚe
):

1037 
Rªdomly
 
üİs
 
the
 
a
 
pÜtiÚ
 
of
h
image
 
such
 
th©
h
üİ
 
is
 ofhe

1038 
¥ecif›d
 
a¥eù
 
¿tio
, 
ªd
 
the
 
üİ
 
is
 
as
 
Ïrge
‡ 
possibË
. 
If
he specified

1039 
a¥eù
 
¿tio
 
is
 
Ïrg”
 
thª
 
the
‡¥eù„©iØ
of
h
image
, 
this
 
İ
 
wl


1040 
¿ndomly
 
»move
 
rows
 
äom
 
the
 
tİ
 
ªd
 
bÙtom
 
of
h
image
. 
If
h
¥ecif›d


1041 
a¥eù
 
¿tio
 
is
 
Ëss
 
thª
 
the
‡¥eù„©iØ
of
h
image
, 
this
 
İ
 
wl
 
¿ndomly


1042 
»move
 
cŞs
 
äom
 
the
 
Ëá
 
ªd
 
right
 
of
h
image
. 
If
h
¥ecif›d
 
a¥eù


1043 
¿tio
 
is
 
the
 
§me
 
as
h
a¥eù
„©iØ
of
h
image
, 
this
 
İ
 
wl
 he

1044 
image
.

1046 
Args
:

1047 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚšs
 1 imag-> [
height
, 
width
, 
chªÃls
]

1048 
w™h
 
pix–
 
v®ues
 
v¬yšg
 
b‘w“n
 [0, 1].

1049 
boxes
: 
¿nk
 2 
æßt32
 
‹nsÜ
 
cÚššg
 
the
 
boundšg
 boxe -> [
N
, 4].

1050 
Boxes
 
¬e
 
š
 
nÜm®ized
 
fÜm
 
m—nšg
 
theœ
 
coÜdš©es
 
v¬y


1051 
b‘w“n
 [0, 1].

1052 
Each
 
row
 
is
 
š
 
the
 
fÜm
 
of
 [
ymš
, 
xmš
, 
ymax
, 
xmax
].

1053 
Ïb–s
: 
¿nk
 1 
št32
 
‹nsÜ
 
cÚššg
 
the
 
objeù
 
şas£s
.

1054 
masks
: (
İtiÚ®
è
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


1055 [
num_š¡ªûs
, 
height
, 
width
] 
cÚššg
 
š¡ªû
 
masks
. 
The
 masks

1056 
¬e
 
of
 
the
 
§me
 
height
, 
width
 
as
h
šput
 `
image
`.

1057 
keypošts
: (
İtiÚ®
è
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


1058 [
num_š¡ªûs
, 
num_keypošts
, 2]. 
The
 
keypošts
 
¬e
 
š
 
y
-
x


1059 
nÜm®ized
 
coÜdš©es
.

1060 
a¥eù_¿tio
: 
the
 
a¥eù
 
¿tio
 
of
 
üİ³d
 
image
.

1061 
ov”Ïp_th»sh
: 
mšimum
 
ov”Ïp
 
th»sh
 
w™h
 
Ãw
 
üİ³d


1062 
image
 
to
 
k“p
 
the
 
box
.

1063 
£ed
: 
¿ndom
 seed.

1065 
R‘uºs
:

1066 
image
: imag
which
 
is
 
the
 
§me
 
¿nk
 
as
 
šput
 image.

1067 
boxes
: boxe 
which
 
is
 
the
 
§me
 
¿nk
 
as
 
šput
 boxes.

1068 
Boxes
 
¬e
 
š
 
nÜm®ized
 
fÜm
.

1069 
Ïb–s
: 
Ãw
†abels.

1071 
If
 
masks
, 
Ü
 
keypošts
 
is
 
nÙ
 
NÚe
, 
the
 
funùiÚ
 
®so
 
»tuºs
:

1073 
masks
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
num_š¡ªûs
, 
height
, 
width
]

1074 
cÚššg
 
š¡ªû
 
masks
.

1075 
keypošts
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


1076 [
num_š¡ªûs
, 
num_keypošts
, 2]

1078 
Rai£s
:

1079 
V®ueE¼Ü
: 
If
 
image
 
is
 
nÙ
 
a
 3D 
‹nsÜ
.

1081 
	`Ën
(
image
.
	`g‘_sh­e
()) != 3:

1082 
¿i£
 
	`V®ueE¼Ü
('Image should be 3Densor')

1084 
w™h
 
tf
.
	`Çme_scİe
('RªdomCrİToA¥eùR©io', 
v®ues
=[
image
]):

1085 
image_sh­e
 = 
tf
.
	$sh­e
(
image
)

1086 
Üig_height
 = 
image_sh­e
[0]

1087 
Üig_width
 = 
image_sh­e
[1]

1088 
Üig_a¥eù_¿tio
 = 
tf
.
	`to_æßt
(
Üig_width
è/f.
	$to_æßt
(
Üig_height
)

1089 
Ãw_a¥eù_¿tio
 = 
tf
.
	$cÚ¡ªt
(
a¥eù_¿tio
, 
dty³
=
tf
.
æßt32
)

1090 
def
 
	$rg‘_height_â
():

1091  
tf
.
	`to_št32
(

1092 
tf
.
	`round
(

1093 
tf
.
	`to_æßt
(
Üig_height
è* 
Üig_a¥eù_¿tio
 / 
Ãw_a¥eù_¿tio
))

1094 
rg‘_height
 = 
tf
.
	`cÚd
(

1095 
Üig_a¥eù_¿tio
 >ğ
Ãw_a¥eù_¿tio
,

1096 
Ïmbda
: 
Üig_height
,

1097 
rg‘_height_â
)

1098 
def
 
	$rg‘_width_â
():

1099  
tf
.
	`to_št32
(

1100 
tf
.
	`round
(

1101 
tf
.
	`to_æßt
(
Üig_width
è* 
Ãw_a¥eù_¿tio
 / 
Üig_a¥eù_¿tio
))

1102 
rg‘_width
 = 
tf
.
	`cÚd
(

1103 
Üig_a¥eù_¿tio
 <ğ
Ãw_a¥eù_¿tio
,

1104 
Ïmbda
: 
Üig_width
,

1105 
rg‘_width_â
)

1107 #e™h” 
off£t_height
 = 0 
ªd
 
off£t_width
 
is
 
¿ndomly
 
cho£n
 
äom


1108 #[0, 
off£t_width
 - 
rg‘_width
), 
Ü
 off£t_width = 0 
ªd


1109 #off£t_heighˆ
is
 
¿ndomly
 
cho£n
 
äom
 [0, 
off£t_height
 - 
rg‘_height
)

1110 
off£t_height
 = 
	`_¿ndom_š‹g”
(0, 
Üig_height
 - 
rg‘_height
 + 1, 
£ed
)

1111 
off£t_width
 = 
	`_¿ndom_š‹g”
(0, 
Üig_width
 - 
rg‘_width
 + 1, 
£ed
)

1112 
Ãw_image
 = 
tf
.
image
.
	$üİ_to_boundšg_box
(

1113 
image
, 
off£t_height
, 
off£t_width
, 
rg‘_height
, 
rg‘_width
)

1115 
im_box
 = 
tf
.
	`¡ack
([

1116 
tf
.
	`to_æßt
(
off£t_height
è/f.to_æßt(
Üig_height
),

1117 
tf
.
	`to_æßt
(
off£t_width
è/f.to_æßt(
Üig_width
),

1118 
tf
.
	`to_æßt
(
off£t_height
 + 
rg‘_height
è/f.to_æßt(
Üig_height
),

1119 
tf
.
	`to_æßt
(
off£t_width
 + 
rg‘_width
è/f.to_æßt(
Üig_width
)

1122 
boxli¡
 = 
box_li¡
.
	$BoxLi¡
(
boxes
)

1123 
boxli¡
.
	`add_f›ld
('Ïb–s', 
Ïb–s
)

1125 
im_boxli¡
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$ex·nd_dims
(
im_box
, 0))

1127 #»mov
boxes
 
who£
 
ov”Ïp
 
w™h
 
the
 
image
 
is
 
Ëss
 
thª
 
ov”Ïp_th»sh


1128 
ov”Ïµšg_boxli¡
, 
k“p_ids
 = 
box_li¡_İs
.
	$´uÃ_nÚ_ov”Ïµšg_boxes
(

1129 
boxli¡
, 
im_boxli¡
, 
ov”Ïp_th»sh
)

1131 #chªg
the
 
coÜdš©e
 
of
h
»maššg
 
boxes


1132 
Ãw_Ïb–s
 = 
ov”Ïµšg_boxli¡
.
	`g‘_f›ld
('labels')

1133 
Ãw_boxli¡
 = 
box_li¡_İs
.
	$chªge_coÜdš©e_äame
(
ov”Ïµšg_boxli¡
,

1134 
im_box
)

1135 
Ãw_boxli¡
 = 
box_li¡_İs
.
	`ş_to_wšdow
(new_boxlist,

1136 
tf
.
	$cÚ¡ªt
(

1138 
tf
.
æßt32
))

1139 
Ãw_boxes
 = 
Ãw_boxli¡
.
	$g‘
()

1141 
»suÉ
 = [
Ãw_image
, 
Ãw_boxes
, 
Ãw_Ïb–s
]

1143 
masks
 
is
 
nÙ
 
NÚe
:

1144 
masks_šside_wšdow
 = 
tf
.
	$g©h”
(
masks
, 
k“p_ids
)

1145 
masks_box_begš
 = 
tf
.
	$¡ack
([0, 
off£t_height
, 
off£t_width
])

1146 
masks_box_size
 = 
tf
.
	`¡ack
([-1, 
rg‘_height
, 
rg‘_width
])

1147 
Ãw_masks
 = 
tf
.
	$¦iû
(
masks_šside_wšdow
, 
masks_box_begš
, 
masks_box_size
)

1148 
»suÉ
.
	$­³nd
(
Ãw_masks
)

1150 
keypošts
 
is
 
nÙ
 
NÚe
:

1151 
keypošts_šside_wšdow
 = 
tf
.
	$g©h”
(
keypošts
, 
k“p_ids
)

1152 
Ãw_keypošts
 = 
keypošt_İs
.
	$chªge_coÜdš©e_äame
(

1153 
keypošts_šside_wšdow
, 
im_box
)

1154 
Ãw_keypošts
 = 
keypošt_İs
.
	$´uÃ_outside_wšdow
(
Ãw_keypošts
,

1156 
»suÉ
.
	$­³nd
(
Ãw_keypošts
)

1158  
	$tu¶e
(
»suÉ
)

1161 
def
 
	$¿ndom_bÏck_·tches
(
image
,

1162 
max_bÏck_·tches
=10,

1163 
´obab™y
=0.5,

1164 
size_to_image_¿tio
=0.1,

1165 
¿ndom_£ed
=
NÚe
):

1168 
This
 
İ
 
adds
 
up
 
to
 
max_bÏck_·tches
 
squ¬e
 
bÏck
 
·tches
 
of
 
a
 
fixed
 
size


1169 
to
 
the
 
image
 
wh”e
 
size
 
is
 
¥ecif›d
 
vŸ
h
size_to_image_¿tio
 
·¿m‘”
.

1171 
Args
:

1172 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚššg
 1 imag-> [
height
, 
width
, 
chªÃls
]

1173 
w™h
 
pix–
 
v®ues
 
v¬yšg
 
b‘w“n
 [0, 1].

1174 
max_bÏck_·tches
: 
numb”
 
of
 
times
 
th©
 
the
 
funùiÚ
 
Œ›s
 
to
 
add
 
a


1175 
bÏck
 
box
 
to
 
the
 
image
.

1176 
´obab™y
: 
©
 
—ch
 
Œy
, 
wh©
 
is
 
the
 
chªû
 
of
 
addšg
 
a
 
box
.

1177 
size_to_image_¿tio
: 
D‘”mšes
 
the
 
¿tio
 
of
h
size
 oàth
bÏck
 
·tches


1178 
to
 
the
 
size
 
of
h
image
.

1179 
box_size
 = 
size_to_image_¿tio
 *

1180 
	$mš
(
image_width
, 
image_height
)

1181 
¿ndom_£ed
: 
¿ndom
 
£ed
.

1183 
R‘uºs
:

1184 
image


1186 
def
 
	$add_bÏck_·tch_to_image
(
image
):

1189 
Args
:

1190 
image
: image

1192 
R‘uºs
:

1193 
image
 
w™h
 
a
 
¿ndomly
 
added
 
bÏck
 
box


1195 
image_sh­e
 = 
tf
.
	$sh­e
(
image
)

1196 
image_height
 = 
image_sh­e
[0]

1197 
image_width
 = 
image_sh­e
[1]

1198 
box_size
 = 
tf
.
	`to_št32
(

1199 
tf
.
	`muÉly
(

1200 
tf
.
	`mšimum
Ñf.
	`to_æßt
(
image_height
),f.to_æßt(
image_width
)),

1201 
size_to_image_¿tio
))

1202 
nÜm®ized_y_mš
 = 
tf
.
	`¿ndom_unifÜm
(

1203 [], 
mšv®
=0.0, 
maxv®
=(1.0 - 
size_to_image_¿tio
), 
£ed
=
¿ndom_£ed
)

1204 
nÜm®ized_x_mš
 = 
tf
.
	`¿ndom_unifÜm
(

1205 [], 
mšv®
=0.0, 
maxv®
=(1.0 - 
size_to_image_¿tio
), 
£ed
=
¿ndom_£ed
)

1206 
y_mš
 = 
tf
.
	`to_št32
(
nÜm®ized_y_mš
 *f.
	$to_æßt
(
image_height
))

1207 
x_mš
 = 
tf
.
	`to_št32
(
nÜm®ized_x_mš
 *f.
	$to_æßt
(
image_width
))

1208 
bÏck_box
 = 
tf
.
	$Úes
([
box_size
, box_size, 3], 
dty³
=
tf
.
æßt32
)

1209 
mask
 = 1.0 - 
tf
.
image
.
	$·d_to_boundšg_box
(
bÏck_box
, 
y_mš
, 
x_mš
,

1210 
image_height
, 
image_width
)

1211 
image
 = 
tf
.
	$muÉly
(
image
, 
mask
)

1212  
image


1214 
w™h
 
tf
.
	`Çme_scİe
('RªdomBÏckP©chInImage', 
v®ues
=[
image
]):

1215 
_
 
š
 
	$¿nge
(
max_bÏck_·tches
):

1216 
¿ndom_´ob
 = 
tf
.
	$¿ndom_unifÜm
([], 
mšv®
=0.0, 
maxv®
=1.0,

1217 
dty³
=
tf
.
æßt32
, 
£ed
=
¿ndom_£ed
)

1218 
image
 = 
tf
.
	`cÚd
(

1219 
tf
.
	`g»©”
(
¿ndom_´ob
, 
´obab™y
), 
Ïmbda
: 
image
,

1220 
Ïmbda
: 
	$add_bÏck_·tch_to_image
(
image
))

1222  
image


1225 
def
 
	$image_to_æßt
(
image
):

1228 
Args
:

1229 
image
: 
šput
 imag
which
 
might
 
be
 
š
 
tf
.
ušt8
 
Ü
 
¡h
 
fÜm©


1231 
R‘uºs
:

1232 
image
: imag
š
 
tf
.
æßt32
 
fÜm©
.

1234 
w™h
 
tf
.
	`Çme_scİe
('ImageToFlßt', 
v®ues
=[
image
]):

1235 
image
 = 
tf
.
	$to_æßt
(
image
)

1236  
image


1239 
def
 
	$¿ndom_»size_m‘hod
(
image
, 
rg‘_size
):

1242 
Args
:

1243 
image
: 
a
 
¿nk
 3 
‹nsÜ
.

1244 
rg‘_size
: 
a
 
li¡
 
of
 [
rg‘_height
, 
rg‘_width
]

1246 
R‘uºs
:

1247 
»sized
 
image
.

1250 
»sized_image
 = 
	`_­¶y_w™h_¿ndom_£ËùÜ
(

1251 
image
,

1252 
Ïmbda
 
x
, 
m‘hod
: 
tf
.
image
.
	`»size_images
(x, 
rg‘_size
, method),

1253 
num_ÿ£s
=4)

1255  
»sized_image


1258 
def
 
	$_compu‹_Ãw_¡©ic_size
(
image
,

1259 
mš_dim’siÚ
,

1260 
max_dim’siÚ
):

1262 
image_sh­e
 = 
image
.
	`g‘_sh­e
().
	$as_li¡
()

1263 
Üig_height
 = 
image_sh­e
[0]

1264 
Üig_width
 = 
image_sh­e
[1]

1265 
Üig_mš_dim
 = 
	$mš
(
Üig_height
, 
Üig_width
)

1266 #C®cuÏ‹ 
the
 
Ïrg”
 
of
h
possibË
 
sizes


1267 
Ïrge_sÿË_çùÜ
 = 
mš_dim’siÚ
 / (
Üig_mš_dim
)

1268 #Sÿlšg 
	`Üig_
(
height
|
width
è
by
 
Ïrge_sÿË_çùÜ
 
wl
 
make
 
the
 
sm®Ër


1269 #dim’siÚ 
equ®
 
to
 
mš_dim’siÚ
, 
§ve
 
æßtšg
 
pošt
 
roundšg
 
”rÜs
.

1270 #FÜ 
»asÚably
-
sized
 
images
, 
kšg
 
the
 
Ã¬e¡
 
š‹g”
 
wl
 
»lŸbly


1271 #–imš©
this
 
”rÜ
.

1272 
Ïrge_height
 = (
	$round
(
Üig_height
 * 
Ïrge_sÿË_çùÜ
))

1273 
Ïrge_width
 = (
	$round
(
Üig_width
 * 
Ïrge_sÿË_çùÜ
))

1274 
Ïrge_size
 = [
Ïrge_height
, 
Ïrge_width
]

1275 
max_dim’siÚ
:

1276 #C®cuÏ‹ 
the
 
sm®Ër
 
of
h
possibË
 
sizes
, 
u£
 
th©
 th
Ïrg”


1277 #i 
too
 
big
.

1278 
Üig_max_dim
 = 
	$max
(
Üig_height
, 
Üig_width
)

1279 
sm®l_sÿË_çùÜ
 = 
max_dim’siÚ
 / (
Üig_max_dim
)

1280 #Sÿlšg 
	`Üig_
(
height
|
width
è
by
 
sm®l_sÿË_çùÜ
 
wl
 
make
 
the
 
Ïrg”


1281 #dim’siÚ 
equ®
 
to
 
max_dim’siÚ
, 
§ve
 
æßtšg
 
pošt
 
roundšg


1282 #”rÜs. 
FÜ
 
»asÚably
-
sized
 
images
, 
kšg
 
the
 
Ã¬e¡
 
š‹g”
 
wl


1283 #»lŸbly 
–imš©e
 
this
 
”rÜ
.

1284 
sm®l_height
 = (
	$round
(
Üig_height
 * 
sm®l_sÿË_çùÜ
))

1285 
sm®l_width
 = (
	$round
(
Üig_width
 * 
sm®l_sÿË_çùÜ
))

1286 
sm®l_size
 = [
sm®l_height
, 
sm®l_width
]

1287 
Ãw_size
 = 
Ïrge_size


1288 
	`max
(
Ïrge_size
è> 
max_dim’siÚ
:

1289 
Ãw_size
 = 
sm®l_size


1291 
Ãw_size
 = 
Ïrge_size


1292  
tf
.
	$cÚ¡ªt
(
Ãw_size
)

1295 
def
 
	$_compu‹_Ãw_dyÇmic_size
(
image
,

1296 
mš_dim’siÚ
,

1297 
max_dim’siÚ
):

1299 
image_sh­e
 = 
tf
.
	$sh­e
(
image
)

1300 
Üig_height
 = 
tf
.
	$to_æßt
(
image_sh­e
[0])

1301 
Üig_width
 = 
tf
.
	$to_æßt
(
image_sh­e
[1])

1302 
Üig_mš_dim
 = 
tf
.
	$mšimum
(
Üig_height
, 
Üig_width
)

1303 #C®cuÏ‹ 
the
 
Ïrg”
 
of
h
possibË
 
sizes


1304 
mš_dim’siÚ
 = 
tf
.
	$cÚ¡ªt
(
mš_dim’siÚ
, 
dty³
=
tf
.
æßt32
)

1305 
Ïrge_sÿË_çùÜ
 = 
mš_dim’siÚ
 / 
Üig_mš_dim


1306 #Sÿlšg 
	`Üig_
(
height
|
width
è
by
 
Ïrge_sÿË_çùÜ
 
wl
 
make
 
the
 
sm®Ër


1307 #dim’siÚ 
equ®
 
to
 
mš_dim’siÚ
, 
§ve
 
æßtšg
 
pošt
 
roundšg
 
”rÜs
.

1308 #FÜ 
»asÚably
-
sized
 
images
, 
kšg
 
the
 
Ã¬e¡
 
š‹g”
 
wl
 
»lŸbly


1309 #–imš©
this
 
”rÜ
.

1310 
Ïrge_height
 = 
tf
.
	`to_št32
Ñf.
	$round
(
Üig_height
 * 
Ïrge_sÿË_çùÜ
))

1311 
Ïrge_width
 = 
tf
.
	`to_št32
Ñf.
	$round
(
Üig_width
 * 
Ïrge_sÿË_çùÜ
))

1312 
Ïrge_size
 = 
tf
.
	$¡ack
([
Ïrge_height
, 
Ïrge_width
])

1313 
max_dim’siÚ
:

1314 #C®cuÏ‹ 
the
 
sm®Ër
 
of
h
possibË
 
sizes
, 
u£
 
th©
 th
Ïrg”


1315 #i 
too
 
big
.

1316 
Üig_max_dim
 = 
tf
.
	$maximum
(
Üig_height
, 
Üig_width
)

1317 
max_dim’siÚ
 = 
tf
.
	$cÚ¡ªt
(
max_dim’siÚ
, 
dty³
=
tf
.
æßt32
)

1318 
sm®l_sÿË_çùÜ
 = 
max_dim’siÚ
 / 
Üig_max_dim


1319 #Sÿlšg 
	`Üig_
(
height
|
width
è
by
 
sm®l_sÿË_çùÜ
 
wl
 
make
 
the
 
Ïrg”


1320 #dim’siÚ 
equ®
 
to
 
max_dim’siÚ
, 
§ve
 
æßtšg
 
pošt
 
roundšg


1321 #”rÜs. 
FÜ
 
»asÚably
-
sized
 
images
, 
kšg
 
the
 
Ã¬e¡
 
š‹g”
 
wl


1322 #»lŸbly 
–imš©e
 
this
 
”rÜ
.

1323 
sm®l_height
 = 
tf
.
	`to_št32
Ñf.
	$round
(
Üig_height
 * 
sm®l_sÿË_çùÜ
))

1324 
sm®l_width
 = 
tf
.
	`to_št32
Ñf.
	$round
(
Üig_width
 * 
sm®l_sÿË_çùÜ
))

1325 
sm®l_size
 = 
tf
.
	$¡ack
([
sm®l_height
, 
sm®l_width
])

1326 
Ãw_size
 = 
tf
.
	`cÚd
(

1327 
tf
.
	`to_æßt
Ñf.
	`»duû_max
(
Ïrge_size
)è> 
max_dim’siÚ
,

1328 
Ïmbda
: 
sm®l_size
,†ambda: 
Ïrge_size
)

1330 
Ãw_size
 = 
Ïrge_size


1331  
Ãw_size


1334 
def
 
	$»size_to_¿nge
(
image
,

1335 
masks
=
NÚe
,

1336 
mš_dim’siÚ
=
NÚe
,

1337 
max_dim’siÚ
=
NÚe
,

1338 
®ign_cÜÃrs
=
F®£
):

1341 
The
 
ouut
 
size
 
ÿn
 
be
 
desüibed
 
by
 
two
 
ÿ£s
:

1342 1. 
If
 
the
 
image
 
ÿn
 
be
 
»sÿËd
 
so
 
™s
 
mšimum
 
dim’siÚ
 
is
 
equ®
 
to
he

1343 
´ovided
 
v®ue
 
w™hout
 
the
 
Ùh”
 
dim’siÚ
 
exûedšg
 
max_dim’siÚ
,

1344 
th’
 dØ
so
.

1345 2. 
Oth”wi£
, 
»size
 
so
 
the
 
Ïrge¡
 
dim’siÚ
 
is
 
equ®
 
to
 
max_dim’siÚ
.

1347 
Args
:

1348 
image
: 
A
 3D 
‹nsÜ
 
of
 
sh­e
 [
height
, 
width
, 
chªÃls
]

1349 
masks
: (
İtiÚ®
è
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


1350 [
num_š¡ªûs
, 
height
, 
width
] 
cÚššg
 
š¡ªû
 
masks
.

1351 
mš_dim’siÚ
: (
İtiÚ®
è(
sÿÏr
è
desœed
 
size
 
of
 
the
 
sm®Ër
 
image


1352 
dim’siÚ
.

1353 
max_dim’siÚ
: (
İtiÚ®
è(
sÿÏr
è
maximum
 
®lowed
 
size


1354 
of
 
the
 
Ïrg”
 
image
 
dim’siÚ
.

1355 
®ign_cÜÃrs
: 
boŞ
. 
If
 
Œue
, 
exaùly
 
®ign
 
®l
 4 
cÜÃrs
 
of
 
the
 
šput


1356 
ªd
 
ouut
. 
DeçuÉs
 
to
 
F®£
.

1358 
R‘uºs
:

1359 
A
 3D 
‹nsÜ
 
of
 
sh­e
 [
Ãw_height
, 
Ãw_width
, 
chªÃls
],

1360 
wh”e
 
the
 
image
 
has
 
b“n
 
	$»sized
 (
w™h
 
bš—r
 
š‹½Ş©iÚ
è
so
 
th©


1361 
	`mš
(
Ãw_height
, 
Ãw_width
è=ğ
mš_dim’siÚ
 
Ü


1362 
	`max
(
Ãw_height
, 
Ãw_width
è=ğ
max_dim’siÚ
.

1364 
If
 
masks
 
is
 
nÙ
 
NÚe
, 
®so
 
ouuts
 masks:

1365 
A
 3D 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªûs
, 
Ãw_height
, 
Ãw_width
]

1367 
Rai£s
:

1368 
V®ueE¼Ü
: 
the
 
image
 
is
 
nÙ
 
a
 3D 
‹nsÜ
.

1370 
	`Ën
(
image
.
	`g‘_sh­e
()) != 3:

1371 
¿i£
 
	`V®ueE¼Ü
('Image should be 3Densor')

1373 
w™h
 
tf
.
	`Çme_scİe
('ResizeToRªge', 
v®ues
=[
image
, 
mš_dim’siÚ
]):

1374 
image
.
	`g‘_sh­e
().
	$is_fuÎy_defšed
():

1375 
Ãw_size
 = 
	$_compu‹_Ãw_¡©ic_size
(
image
, 
mš_dim’siÚ
,

1376 
max_dim’siÚ
)

1378 
Ãw_size
 = 
	$_compu‹_Ãw_dyÇmic_size
(
image
, 
mš_dim’siÚ
,

1379 
max_dim’siÚ
)

1380 
Ãw_image
 = 
tf
.
image
.
	$»size_images
(
image
, 
Ãw_size
,

1381 
®ign_cÜÃrs
=align_corners)

1383 
»suÉ
 = 
Ãw_image


1384 
masks
 
is
 
nÙ
 
NÚe
:

1385 
Ãw_masks
 = 
tf
.
	$ex·nd_dims
(
masks
, 3)

1386 
Ãw_masks
 = 
tf
.
image
.
	$»size_Ã¬e¡_ÃighbÜ
(
Ãw_masks
, 
Ãw_size
,

1387 
®ign_cÜÃrs
=align_corners)

1388 
Ãw_masks
 = 
tf
.
	$squ“ze
(
Ãw_masks
, 3)

1389 
»suÉ
 = [
Ãw_image
, 
Ãw_masks
]

1391  
»suÉ


1394 
def
 
	$sÿË_boxes_to_pix–_coÜdš©es
(
image
, 
boxes
, 
keypošts
=
NÚe
):

1397 
Args
:

1398 
image
: 
A
 3D 
æßt32
 
‹nsÜ
 
of
 
sh­e
 [
height
, 
width
, 
chªÃls
].

1399 
boxes
: 
A
 2D 
æßt32
 
‹nsÜ
 
of
 
sh­e
 [
num_boxes
, 4] 
cÚššg
 
the
 
boundšg


1400 
boxes
 
š
 
nÜm®ized
 
coÜdš©es
. 
Each
 
row
 
is
 
of
 
the
 
fÜm


1401 [
ymš
, 
xmš
, 
ymax
, 
xmax
].

1402 
keypošts
: (
İtiÚ®
è
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


1403 [
num_š¡ªûs
, 
num_keypošts
, 2]. 
The
 
keypošts
 
¬e
 
š
 
y
-
x
 
nÜm®ized


1404 
coÜdš©es
.

1406 
R‘uºs
:

1407 
image
: 
unchªged
 
šput
 image.

1408 
sÿËd_boxes
: 
a
 2D 
æßt32
 
‹nsÜ
 
of
 
sh­e
 [
num_boxes
, 4] 
cÚššg
 
the


1409 
boundšg
 
boxes
 
š
 
pix–
 
coÜdš©es
.

1410 
sÿËd_keypošts
: 
a
 3D 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


1411 [
num_š¡ªûs
, 
num_keypošts
, 2] 
cÚššg
 
the
 
keypošts
 
š
 
pix–


1412 
coÜdš©es
.

1414 
boxli¡
 = 
box_li¡
.
	$BoxLi¡
(
boxes
)

1415 
image_height
 = 
tf
.
	`sh­e
(
image
)[0]

1416 
image_width
 = 
tf
.
	`sh­e
(
image
)[1]

1417 
sÿËd_boxes
 = 
box_li¡_İs
.
	`sÿË
(
boxli¡
, 
image_height
, 
image_width
).
	$g‘
()

1418 
»suÉ
 = [
image
, 
sÿËd_boxes
]

1419 
keypošts
 
is
 
nÙ
 
NÚe
:

1420 
sÿËd_keypošts
 = 
keypošt_İs
.
	$sÿË
(
keypošts
, 
image_height
, 
image_width
)

1421 
»suÉ
.
	$­³nd
(
sÿËd_keypošts
)

1422  
	$tu¶e
(
»suÉ
)

1425 #pylšt: 
di§bË
=
g
-
doc
--
Ü
-
y›ld


1426 
def
 
	$»size_image
(
image
,

1427 
masks
=
NÚe
,

1428 
Ãw_height
=600,

1429 
Ãw_width
=1024,

1430 
m‘hod
=
tf
.
image
.
ResizeM‘hod
.
BILINEAR
,

1431 
®ign_cÜÃrs
=
F®£
):

1433 
w™h
 
tf
.
	`Çme_scİe
(

1435 
v®ues
=[
image
, 
Ãw_height
, 
Ãw_width
, 
m‘hod
, 
®ign_cÜÃrs
]):

1436 
Ãw_image
 = 
tf
.
image
.
	$»size_images
(
image
, [
Ãw_height
, 
Ãw_width
],

1437 
m‘hod
=method,

1438 
®ign_cÜÃrs
=align_corners)

1439 
»suÉ
 = 
Ãw_image


1440 
masks
 
is
 
nÙ
 
NÚe
:

1441 
num_š¡ªûs
 = 
tf
.
	`sh­e
(
masks
)[0]

1442 
Ãw_size
 = 
tf
.
	$cÚ¡ªt
([
Ãw_height
, 
Ãw_width
], 
dty³
=
tf
.
št32
)

1443 
def
 
	$»size_masks_b¿nch
():

1444 
Ãw_masks
 = 
tf
.
	$ex·nd_dims
(
masks
, 3)

1445 
Ãw_masks
 = 
tf
.
image
.
	$»size_Ã¬e¡_ÃighbÜ
(

1446 
Ãw_masks
, 
Ãw_size
, 
®ign_cÜÃrs
=align_corners)

1447 
Ãw_masks
 = 
tf
.
	$squ“ze
(
Ãw_masks
, 
axis
=3)

1448  
Ãw_masks


1450 
def
 
	$»sh­e_masks_b¿nch
():

1451 
Ãw_masks
 = 
tf
.
	$»sh­e
(
masks
, [0, 
Ãw_size
[0],‚ew_size[1]])

1452  
Ãw_masks


1454 
masks
 = 
tf
.
	`cÚd
(
num_š¡ªûs
 > 0,

1455 
»size_masks_b¿nch
,

1456 
»sh­e_masks_b¿nch
)

1457 
»suÉ
 = [
Ãw_image
, 
masks
]

1459  
»suÉ


1462 
def
 
	$subŒaù_chªÃl_m—n
(
image
, 
m—ns
=
NÚe
):

1465 
Args
:

1466 
image
: 
A
 3D 
‹nsÜ
 
of
 
sh­e
 [
height
, 
width
, 
chªÃls
]

1467 
m—ns
: 
li¡
 
cÚššg
 
a
 
m—n
 
—ch
 
chªÃl


1468 
R‘uºs
:

1469 
nÜm®ized_images
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
height
, 
width
, 
chªÃls
]

1470 
Rai£s
:

1471 
V®ueE¼Ü
: 
images
 
is
 
nÙ
 
a
 4D 
‹nsÜ
 
Ü
 
the
 
numb”
 
of
 
m—ns
 is‚ot

1472 
equ®
 
to
 
the
 
numb”
 
of
 
chªÃls
.

1474 
w™h
 
tf
.
	`Çme_scİe
('SubŒaùChªÃlM—n', 
v®ues
=[
image
, 
m—ns
]):

1475 
	`Ën
(
image
.
	`g‘_sh­e
()) != 3:

1476 
¿i£
 
	`V®ueE¼Ü
('Input must be of size [height, width, channels]')

1477 
	`Ën
(
m—ns
è!ğ
image
.
	`g‘_sh­e
()[-1]:

1478 
¿i£
 
	`V®ueE¼Ü
('len(means) must matchhe‚umber of channels')

1479  
image
 - [[
m—ns
]]

1482 
def
 
	$Úe_hÙ_’codšg
(
Ïb–s
, 
num_şas£s
=
NÚe
):

1485 
Exam¶e
 
u§ge
:

1486 
Ïb–s
 = 
tf
.
	$cÚ¡ªt
([1, 4], 
dty³
=
tf
.
št32
)

1487 
Úe_hÙ
 = 
	$OÃHÙEncodšg
(
Ïb–s
, 
num_şas£s
=5)

1488 
Úe_hÙ
.
	$ev®
(è#ev®u©e 
to
 [0, 1, 0, 0, 1]

1490 
Args
:

1491 
Ïb–s
: 
A
 
‹nsÜ
 
of
 
sh­e
 [
NÚe
] 
cÜ»¥Údšg
 
to
 
the
†abels.

1492 
num_şas£s
: 
Numb”
 
of
 
şas£s
 
š
 
the
 
d©a£t
.

1493 
R‘uºs
:

1494 
ÚehÙ_Ïb–s
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
num_şas£s
] 
cÜ»¥Údšg
 
to
 
the
 
Úe
 
hÙ


1495 
’codšg
 
of
 
the
 
Ïb–s
.

1496 
Rai£s
:

1497 
V®ueE¼Ü
: 
num_şas£s
 
is
 
nÙ
 
¥ecif›d
.

1499 
w™h
 
tf
.
	`Çme_scİe
('OÃHÙEncodšg', 
v®ues
=[
Ïb–s
]):

1500 
num_şas£s
 
is
 
NÚe
:

1501 
¿i£
 
	`V®ueE¼Ü
('num_classes must be specified')

1503 
Ïb–s
 = 
tf
.
	$Úe_hÙ
(
Ïb–s
, 
num_şas£s
, 1, 0)

1504  
tf
.
	$»duû_max
(
Ïb–s
, 0)

1507 
def
 
	$rgb_to_g¿y
(
image
):

1510 
Args
:

1511 
image
: 
Rªk
 3 
æßt32
 
‹nsÜ
 
cÚššg
 1 imag-> [
height
, 
width
, 3]

1512 
w™h
 
pix–
 
v®ues
 
v¬yšg
 
b‘w“n
 [0, 1].

1514 
R‘uºs
:

1515 
image
: 
A
 
sšgË
 
chªÃl
 
g¿ysÿË
 imag-> [image, 
height
, 1].

1517  
tf
.
image
.
	$rgb_to_g¿ysÿË
(
image
)

1520 
def
 
	`ssd_¿ndom_üİ
(
image
,

1521 
boxes
,

1522 
Ïb–s
,

1523 
masks
=
NÚe
,

1524 
keypošts
=
NÚe
,

1525 
mš_objeù_cov”ed
=(0.0, 0.1, 0.3, 0.5, 0.7, 0.9, 1.0),

1526 
a¥eù_¿tio_¿nge
=((0.5, 2.0),) * 7,

1527 
¬—_¿nge
=((0.1, 1.0),) * 7,

1528 
ov”Ïp_th»sh
=(0.0, 0.1, 0.3, 0.5, 0.7, 0.9, 1.0),

1529 
¿ndom_cÛf
=(0.15,) * 7,

1530 
£ed
=
NÚe
):

1533 
Liu
 
‘
 
®
., 
SSD
: 
SšgË
 
shÙ
 
muÉibox
 
d‘eùÜ
.

1534 
FÜ
 
fu¹h”
 
šfÜm©iÚ
 
Ú
 
¿ndom
 
üİ
 
´•roûssšg
 
»ãr
 
to
 
RªdomCrİ


1535 
funùiÚ
 
above
.

1537 
Args
:

1538 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚšs
 1 imag-> [
height
, 
width
, 
chªÃls
]

1539 
w™h
 
pix–
 
v®ues
 
v¬yšg
 
b‘w“n
 [0, 1].

1540 
boxes
: 
¿nk
 2 
æßt32
 
‹nsÜ
 
cÚššg
 
the
 
boundšg
 boxe -> [
N
, 4].

1541 
Boxes
 
¬e
 
š
 
nÜm®ized
 
fÜm
 
m—nšg
 
theœ
 
coÜdš©es
 
v¬y


1542 
b‘w“n
 [0, 1].

1543 
Each
 
row
 
is
 
š
 
the
 
fÜm
 
of
 [
ymš
, 
xmš
, 
ymax
, 
xmax
].

1544 
Ïb–s
: 
¿nk
 1 
št32
 
‹nsÜ
 
cÚššg
 
the
 
objeù
 
şas£s
.

1545 
masks
: (
İtiÚ®
è
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


1546 [
num_š¡ªûs
, 
height
, 
width
] 
cÚššg
 
š¡ªû
 
masks
. 
The
 masks

1547 
¬e
 
of
 
the
 
§me
 
height
, 
width
 
as
h
šput
 `
image
`.

1548 
keypošts
: (
İtiÚ®
è
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


1549 [
num_š¡ªûs
, 
num_keypošts
, 2]. 
The
 
keypošts
 
¬e
 
š
 
y
-
x


1550 
nÜm®ized
 
coÜdš©es
.

1551 
mš_objeù_cov”ed
: 
the
 
üİ³d
 
image
 
mu¡
 
cov”
 
©
 
Ëa¡
 
this
 
äaùiÚ
 
of


1552 
©
 
Ëa¡
 
Úe
 
of
 
the
 
šput
 
boundšg
 
boxes
.

1553 
a¥eù_¿tio_¿nge
: 
®lowed
 
¿nge
 
a¥eù
 
¿tio
 
of
 
üİ³d
 
image
.

1554 
¬—_¿nge
: 
®lowed
 
¿nge
 
¬—
 
¿tio
 
b‘w“n
 
üİ³d
 
image
 
ªd
 
the


1555 
Üigš®
 
image
.

1556 
ov”Ïp_th»sh
: 
mšimum
 
ov”Ïp
 
th»sh
 
w™h
 
Ãw
 
üİ³d


1557 
image
 
to
 
k“p
 
the
 
box
.

1558 
¿ndom_cÛf
: 
a
 
¿ndom
 
cÛffic›Á
 
th©
 
defšes
 
the
 
chªû
 
of
 
g‘tšg
he

1559 
Üigš®
 
image
. 
If
 
¿ndom_cÛf
 
is
 0, 
we
 
wl
 
®ways
 
g‘
 
the


1560 
üİ³d
 
image
, 
ªd
 
™
 
is
 1.0, 
we
 
wl
 
®ways
 
g‘
 
the


1561 
Üigš®
 
image
.

1562 
£ed
: 
¿ndom
 seed.

1564 
R‘uºs
:

1565 
image
: imag
which
 
is
 
the
 
§me
 
¿nk
 
as
 
šput
 image.

1566 
boxes
: boxe 
which
 
is
 
the
 
§me
 
¿nk
 
as
 
šput
 boxes.

1567 
Boxes
 
¬e
 
š
 
nÜm®ized
 
fÜm
.

1568 
Ïb–s
: 
Ãw
†abels.

1570 
If
 
masks
, 
Ü
 
keypošts
 
is
 
nÙ
 
NÚe
, 
the
 
funùiÚ
 
®so
 
»tuºs
:

1572 
masks
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
num_š¡ªûs
, 
height
, 
width
]

1573 
cÚššg
 
š¡ªû
 
masks
.

1574 
keypošts
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


1575 [
num_š¡ªûs
, 
num_keypošts
, 2]

1577 
def
 
	$¿ndom_üİ_£ËùÜ
(
£Ëùed_»suÉ
, 
šdex
):

1580 
Args
:

1581 
£Ëùed_»suÉ
: 
A
 
tu¶e
 
cÚššg
 
image
, 
boxes
, 
Ïb–s
, 
	`keypošts
 (

1582 
nÙ
 
NÚe
), 
ªd
 
	`masks
 (not None).

1583 
šdex
: 
The
 index 
th©
 
was
 
¿ndomly
 
£Ëùed
.

1585 
R‘uºs
: 
A
 
tu¶e
 
cÚššg
 
image
, 
boxes
, 
Ïb–s
, 
	`keypošts
 (
nÙ
 
NÚe
),

1586 
ªd
 
	`masks
 (
nÙ
 
NÚe
).

1588 
i
 = 3

1589 
image
, 
boxes
, 
Ïb–s
 = 
£Ëùed_»suÉ
[:
i
]

1590 
£Ëùed_masks
 = 
NÚe


1591 
£Ëùed_keypošts
 = 
NÚe


1592 
masks
 
is
 
nÙ
 
NÚe
:

1593 
£Ëùed_masks
 = 
£Ëùed_»suÉ
[
i
]

1594 
i
 += 1

1595 
keypošts
 
is
 
nÙ
 
NÚe
:

1596 
£Ëùed_keypošts
 = 
£Ëùed_»suÉ
[
i
]

1598  
	$¿ndom_üİ_image
(

1599 
image
=image,

1600 
boxes
=boxes,

1601 
Ïb–s
=labels,

1602 
masks
=
£Ëùed_masks
,

1603 
keypošts
=
£Ëùed_keypošts
,

1604 
mš_objeù_cov”ed
=mš_objeù_cov”ed[
šdex
],

1605 
a¥eù_¿tio_¿nge
÷¥eù_¿tio_¿nge[
šdex
],

1606 
¬—_¿nge
÷»a_¿nge[
šdex
],

1607 
ov”Ïp_th»sh
=ov”Ïp_th»sh[
šdex
],

1608 
¿ndom_cÛf
ôªdom_cÛf[
šdex
],

1609 
£ed
=seed)

1611 
»suÉ
 = 
	`_­¶y_w™h_¿ndom_£ËùÜ_tu¶es
(

1612 
	`tu¶e
(

1613 
t
 ˆ
	$š
 (
image
, 
boxes
, 
Ïb–s
, 
masks
, 
keypošts
è
t
 
is
 
nÙ
 
NÚe
),

1614 
¿ndom_üİ_£ËùÜ
,

1615 
num_ÿ£s
=
	$Ën
(
mš_objeù_cov”ed
))

1616  
»suÉ


1619 
def
 
	`ssd_¿ndom_üİ_·d
(
image
,

1620 
boxes
,

1621 
Ïb–s
,

1622 
mš_objeù_cov”ed
=(0.1, 0.3, 0.5, 0.7, 0.9, 1.0),

1623 
a¥eù_¿tio_¿nge
=((0.5, 2.0),) * 6,

1624 
¬—_¿nge
=((0.1, 1.0),) * 6,

1625 
ov”Ïp_th»sh
=(0.1, 0.3, 0.5, 0.7, 0.9, 1.0),

1626 
¿ndom_cÛf
=(0.15,) * 6,

1627 
mš_·dded_size_¿tio
=(
NÚe
,) * 6,

1628 
max_·dded_size_¿tio
=(
NÚe
,) * 6,

1629 
·d_cŞÜ
=(
NÚe
,) * 6,

1630 
£ed
=
NÚe
):

1633 
Liu
 
‘
 
®
., 
SSD
: 
SšgË
 
shÙ
 
muÉibox
 
d‘eùÜ
.

1634 
FÜ
 
fu¹h”
 
šfÜm©iÚ
 
Ú
 
¿ndom
 
üİ
 
´•roûssšg
 
»ãr
 
to
 
RªdomCrİ


1635 
funùiÚ
 
above
.

1637 
Args
:

1638 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚššg
 1 imag-> [
height
, 
width
, 
chªÃls
]

1639 
w™h
 
pix–
 
v®ues
 
v¬yšg
 
b‘w“n
 [0, 1].

1640 
boxes
: 
¿nk
 2 
æßt32
 
‹nsÜ
 
cÚššg
 
the
 
boundšg
 boxe -> [
N
, 4].

1641 
Boxes
 
¬e
 
š
 
nÜm®ized
 
fÜm
 
m—nšg
 
theœ
 
coÜdš©es
 
v¬y


1642 
b‘w“n
 [0, 1].

1643 
Each
 
row
 
is
 
š
 
the
 
fÜm
 
of
 [
ymš
, 
xmš
, 
ymax
, 
xmax
].

1644 
Ïb–s
: 
¿nk
 1 
št32
 
‹nsÜ
 
cÚššg
 
the
 
objeù
 
şas£s
.

1645 
mš_objeù_cov”ed
: 
the
 
üİ³d
 
image
 
mu¡
 
cov”
 
©
 
Ëa¡
 
this
 
äaùiÚ
 
of


1646 
©
 
Ëa¡
 
Úe
 
of
 
the
 
šput
 
boundšg
 
boxes
.

1647 
a¥eù_¿tio_¿nge
: 
®lowed
 
¿nge
 
a¥eù
 
¿tio
 
of
 
üİ³d
 
image
.

1648 
¬—_¿nge
: 
®lowed
 
¿nge
 
¬—
 
¿tio
 
b‘w“n
 
üİ³d
 
image
 
ªd
 
the


1649 
Üigš®
 
image
.

1650 
ov”Ïp_th»sh
: 
mšimum
 
ov”Ïp
 
th»sh
 
w™h
 
Ãw
 
üİ³d


1651 
image
 
to
 
k“p
 
the
 
box
.

1652 
¿ndom_cÛf
: 
a
 
¿ndom
 
cÛffic›Á
 
th©
 
defšes
 
the
 
chªû
 
of
 
g‘tšg
he

1653 
Üigš®
 
image
. 
If
 
¿ndom_cÛf
 
is
 0, 
we
 
wl
 
®ways
 
g‘
 
the


1654 
üİ³d
 
image
, 
ªd
 
™
 
is
 1.0, 
we
 
wl
 
®ways
 
g‘
 
the


1655 
Üigš®
 
image
.

1656 
mš_·dded_size_¿tio
: 
mš
 
¿tio
 
of
 
·dded
 
image
 
height
 
ªd
 
width
 
to
 
the


1657 
šput
 
image
's height‡nd width. If None, it will

1658 
be
 
£t
 
to
 [0.0, 0.0].

1659 
max_·dded_size_¿tio
: 
max
 
¿tio
 
of
 
·dded
 
image
 
height
 
ªd
 
width
 
to
 
the


1660 
šput
 
image
's height‡nd width. If None, it will

1661 
be
 
£t
 
to
 [2.0, 2.0].

1662 
·d_cŞÜ
: 
·ddšg
 
cŞÜ
. 
A
 
¿nk
 1 
‹nsÜ
 
of
 [3] 
w™h
 
dty³
=
tf
.
æßt32
.

1663 
£t
 
as
 
NÚe
, 
™
 
wl
 
be
 s‘ 
to
 
av”age
 
cŞÜ
 
of
 
the
 
¿ndomly


1664 
üİ³d
 
image
.

1665 
£ed
: 
¿ndom
 seed.

1667 
R‘uºs
:

1668 
image
: 
Image
 
sh­e
 
wl
 
be
 [
Ãw_height
, 
Ãw_width
, 
chªÃls
].

1669 
boxes
: boxe 
which
 
is
 
the
 
§me
 
¿nk
 
as
 
šput
 boxes. 
Boxes
 
¬e
 
š
 
nÜm®ized


1670 
fÜm
.

1671 
Ãw_Ïb–s
: 
Ãw
 
Ïb–s
.

1673 
def
 
	$¿ndom_üİ_·d_£ËùÜ
(
image_boxes_Ïb–s
, 
šdex
):

1674 
image
, 
boxes
, 
Ïb–s
 = 
image_boxes_Ïb–s


1676  
	$¿ndom_üİ_·d_image
(

1677 
image
,

1678 
boxes
,

1679 
Ïb–s
,

1680 
mš_objeù_cov”ed
=mš_objeù_cov”ed[
šdex
],

1681 
a¥eù_¿tio_¿nge
÷¥eù_¿tio_¿nge[
šdex
],

1682 
¬—_¿nge
÷»a_¿nge[
šdex
],

1683 
ov”Ïp_th»sh
=ov”Ïp_th»sh[
šdex
],

1684 
¿ndom_cÛf
ôªdom_cÛf[
šdex
],

1685 
mš_·dded_size_¿tio
=mš_·dded_size_¿tio[
šdex
],

1686 
max_·dded_size_¿tio
=max_·dded_size_¿tio[
šdex
],

1687 
·d_cŞÜ
õad_cŞÜ[
šdex
],

1688 
£ed
=seed)

1690 
Ãw_image
, 
Ãw_boxes
, 
Ãw_Ïb–s
 = 
	`_­¶y_w™h_¿ndom_£ËùÜ_tu¶es
(

1691 (
image
, 
boxes
, 
Ïb–s
),

1692 
¿ndom_üİ_·d_£ËùÜ
,

1693 
num_ÿ£s
=
	$Ën
(
mš_objeù_cov”ed
))

1694  
Ãw_image
, 
Ãw_boxes
, 
Ãw_Ïb–s


1697 
def
 
	`ssd_¿ndom_üİ_fixed_a¥eù_¿tio
(

1698 
image
,

1699 
boxes
,

1700 
Ïb–s
,

1701 
masks
=
NÚe
,

1702 
keypošts
=
NÚe
,

1703 
mš_objeù_cov”ed
=(0.0, 0.1, 0.3, 0.5, 0.7, 0.9, 1.0),

1704 
a¥eù_¿tio
=1.0,

1705 
¬—_¿nge
=((0.1, 1.0),) * 7,

1706 
ov”Ïp_th»sh
=(0.0, 0.1, 0.3, 0.5, 0.7, 0.9, 1.0),

1707 
¿ndom_cÛf
=(0.15,) * 7,

1708 
£ed
=
NÚe
):

1711 
Liu
 
‘
 
®
., 
SSD
: 
SšgË
 
shÙ
 
muÉibox
 
d‘eùÜ
.

1712 
FÜ
 
fu¹h”
 
šfÜm©iÚ
 
Ú
 
¿ndom
 
üİ
 
´•roûssšg
 
»ãr
 
to
 
RªdomCrİ


1713 
funùiÚ
 
above
.

1715 
The
 
Úly
 
difã»nû
 
is
 
th©
 
the
 
a¥eù
 
¿tio
 
of
h
üİs
 
¬e
 
fixed
.

1717 
Args
:

1718 
image
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
cÚšs
 1 imag-> [
height
, 
width
, 
chªÃls
]

1719 
w™h
 
pix–
 
v®ues
 
v¬yšg
 
b‘w“n
 [0, 1].

1720 
boxes
: 
¿nk
 2 
æßt32
 
‹nsÜ
 
cÚššg
 
the
 
boundšg
 boxe -> [
N
, 4].

1721 
Boxes
 
¬e
 
š
 
nÜm®ized
 
fÜm
 
m—nšg
 
theœ
 
coÜdš©es
 
v¬y


1722 
b‘w“n
 [0, 1].

1723 
Each
 
row
 
is
 
š
 
the
 
fÜm
 
of
 [
ymš
, 
xmš
, 
ymax
, 
xmax
].

1724 
Ïb–s
: 
¿nk
 1 
št32
 
‹nsÜ
 
cÚššg
 
the
 
objeù
 
şas£s
.

1725 
masks
: (
İtiÚ®
è
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


1726 [
num_š¡ªûs
, 
height
, 
width
] 
cÚššg
 
š¡ªû
 
masks
. 
The
 masks

1727 
¬e
 
of
 
the
 
§me
 
height
, 
width
 
as
h
šput
 `
image
`.

1728 
keypošts
: (
İtiÚ®
è
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


1729 [
num_š¡ªûs
, 
num_keypošts
, 2]. 
The
 
keypošts
 
¬e
 
š
 
y
-
x


1730 
nÜm®ized
 
coÜdš©es
.

1731 
mš_objeù_cov”ed
: 
the
 
üİ³d
 
image
 
mu¡
 
cov”
 
©
 
Ëa¡
 
this
 
äaùiÚ
 
of


1732 
©
 
Ëa¡
 
Úe
 
of
 
the
 
šput
 
boundšg
 
boxes
.

1733 
a¥eù_¿tio
: 
a¥eù
 
¿tio
 
of
 
the
 
üİ³d
 
image
.

1734 
¬—_¿nge
: 
®lowed
 
¿nge
 
¬—
 
¿tio
 
b‘w“n
 
üİ³d
 
image
 
ªd
 
the


1735 
Üigš®
 
image
.

1736 
ov”Ïp_th»sh
: 
mšimum
 
ov”Ïp
 
th»sh
 
w™h
 
Ãw
 
üİ³d


1737 
image
 
to
 
k“p
 
the
 
box
.

1738 
¿ndom_cÛf
: 
a
 
¿ndom
 
cÛffic›Á
 
th©
 
defšes
 
the
 
chªû
 
of
 
g‘tšg
he

1739 
Üigš®
 
image
. 
If
 
¿ndom_cÛf
 
is
 0, 
we
 
wl
 
®ways
 
g‘
 
the


1740 
üİ³d
 
image
, 
ªd
 
™
 
is
 1.0, 
we
 
wl
 
®ways
 
g‘
 
the


1741 
Üigš®
 
image
.

1742 
£ed
: 
¿ndom
 seed.

1744 
R‘uºs
:

1745 
image
: imag
which
 
is
 
the
 
§me
 
¿nk
 
as
 
šput
 image.

1746 
boxes
: boxe 
which
 
is
 
the
 
§me
 
¿nk
 
as
 
šput
 boxes.

1747 
Boxes
 
¬e
 
š
 
nÜm®ized
 
fÜm
.

1748 
Ïb–s
: 
Ãw
†abels.

1750 
If
 
masks
, 
Ü
 
keypošts
 
is
 
nÙ
 
NÚe
, 
the
 
funùiÚ
 
®so
 
»tuºs
:

1752 
masks
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
num_š¡ªûs
, 
height
, 
width
]

1753 
cÚššg
 
š¡ªû
 
masks
.

1754 
keypošts
: 
¿nk
 3 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


1755 [
num_š¡ªûs
, 
num_keypošts
, 2]

1758 
a¥eù_¿tio_¿nge
 = ((
a¥eù_¿tio
,‡¥eù_¿tio),è* 
	$Ën
(
¬—_¿nge
)

1760 
üİ_»suÉ
 = 
	$ssd_¿ndom_üİ
(
image
, 
boxes
, 
Ïb–s
, 
masks
, 
keypošts
,

1761 
mš_objeù_cov”ed
, 
a¥eù_¿tio_¿nge
,

1762 
¬—_¿nge
, 
ov”Ïp_th»sh
, 
¿ndom_cÛf
, 
£ed
)

1763 
i
 = 3

1764 
Ãw_image
, 
Ãw_boxes
, 
Ãw_Ïb–s
 = 
üİ_»suÉ
[:
i
]

1765 
Ãw_masks
 = 
NÚe


1766 
Ãw_keypošts
 = 
NÚe


1767 
masks
 
is
 
nÙ
 
NÚe
:

1768 
Ãw_masks
 = 
üİ_»suÉ
[
i
]

1769 
i
 += 1

1770 
keypošts
 
is
 
nÙ
 
NÚe
:

1771 
Ãw_keypošts
 = 
üİ_»suÉ
[
i
]

1772 
»suÉ
 = 
	$¿ndom_üİ_to_a¥eù_¿tio
(

1773 
Ãw_image
,

1774 
Ãw_boxes
,

1775 
Ãw_Ïb–s
,

1776 
Ãw_masks
,

1777 
Ãw_keypošts
,

1778 
a¥eù_¿tio
=aspect_ratio,

1779 
£ed
=seed)

1781  
»suÉ


1784 
def
 
	$g‘_deçuÉ_func_¬g_m­
(
šşude_š¡ªû_masks
=
F®£
,

1785 
šşude_keypošts
=
F®£
):

1788 
Args
:

1789 
šşude_š¡ªû_masks
: 
If
 
True
, 
´•roûssšg
 
funùiÚs
 
wl
 
modify
 
the


1790 
š¡ªû
 
masks
, 
too
.

1791 
šşude_keypošts
: 
If
 
True
, 
´•roûssšg
 
funùiÚs
 
wl
 
modify
 
the


1792 
keypošts
, 
too
.

1794 
R‘uºs
:

1795 
A
 
m­
 
äom
 
´•roûssšg
 
funùiÚs
 
to
 
the
 
¬gum’ts
 
they
 
»ûive
.

1797 
groundŒuth_š¡ªû_masks
 = 
NÚe


1798 
šşude_š¡ªû_masks
:

1799 
groundŒuth_š¡ªû_masks
 = (

1800 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_š¡ªû_masks
)

1802 
groundŒuth_keypošts
 = 
NÚe


1803 
šşude_keypošts
:

1804 
groundŒuth_keypošts
 = 
f›lds
.
IÅutD©aF›lds
.groundtruth_keypoints

1806 
´•_func_¬g_m­
 = {

1807 
nÜm®ize_image
: (
f›lds
.
IÅutD©aF›lds
.
image
,),

1808 
¿ndom_hÜizÚl_æ
: (
f›lds
.
IÅutD©aF›lds
.
image
,

1809 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
,

1810 
groundŒuth_š¡ªû_masks
,

1811 
groundŒuth_keypošts
,),

1812 
¿ndom_pix–_v®ue_sÿË
: (
f›lds
.
IÅutD©aF›lds
.
image
,),

1813 
¿ndom_image_sÿË
: (
f›lds
.
IÅutD©aF›lds
.
image
,

1814 
groundŒuth_š¡ªû_masks
,),

1815 
¿ndom_rgb_to_g¿y
: (
f›lds
.
IÅutD©aF›lds
.
image
,),

1816 
¿ndom_adju¡_brighŠess
: (
f›lds
.
IÅutD©aF›lds
.
image
,),

1817 
¿ndom_adju¡_cÚŒa¡
: (
f›lds
.
IÅutD©aF›lds
.
image
,),

1818 
¿ndom_adju¡_hue
: (
f›lds
.
IÅutD©aF›lds
.
image
,),

1819 
¿ndom_adju¡_§tu¿tiÚ
: (
f›lds
.
IÅutD©aF›lds
.
image
,),

1820 
¿ndom_di¡Üt_cŞÜ
: (
f›lds
.
IÅutD©aF›lds
.
image
,),

1821 
¿ndom_j™‹r_boxes
: (
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
,),

1822 
¿ndom_üİ_image
: (
f›lds
.
IÅutD©aF›lds
.
image
,

1823 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
,

1824 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
,

1825 
groundŒuth_š¡ªû_masks
,

1826 
groundŒuth_keypošts
,),

1827 
¿ndom_·d_image
: (
f›lds
.
IÅutD©aF›lds
.
image
,

1828 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
),

1829 
¿ndom_üİ_·d_image
: (
f›lds
.
IÅutD©aF›lds
.
image
,

1830 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
,

1831 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
),

1832 
¿ndom_üİ_to_a¥eù_¿tio
: (
f›lds
.
IÅutD©aF›lds
.
image
,

1833 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
,

1834 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
,

1835 
groundŒuth_š¡ªû_masks
,

1836 
groundŒuth_keypošts
,),

1837 
¿ndom_bÏck_·tches
: (
f›lds
.
IÅutD©aF›lds
.
image
,),

1838 
»š_boxes_above_th»shŞd
: (

1839 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
,

1840 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
,

1841 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_Ïb–_scÜes
,

1842 
groundŒuth_š¡ªû_masks
,

1843 
groundŒuth_keypošts
,),

1844 
image_to_æßt
: (
f›lds
.
IÅutD©aF›lds
.
image
,),

1845 
¿ndom_»size_m‘hod
: (
f›lds
.
IÅutD©aF›lds
.
image
,),

1846 
»size_to_¿nge
: (
f›lds
.
IÅutD©aF›lds
.
image
,

1847 
groundŒuth_š¡ªû_masks
,),

1848 
sÿË_boxes_to_pix–_coÜdš©es
: (

1849 
f›lds
.
IÅutD©aF›lds
.
image
,

1850 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
,

1851 
groundŒuth_keypošts
,),

1852 
æ_boxes
: (
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
,),

1853 
»size_image
: (
f›lds
.
IÅutD©aF›lds
.
image
,

1854 
groundŒuth_š¡ªû_masks
,),

1855 
subŒaù_chªÃl_m—n
: (
f›lds
.
IÅutD©aF›lds
.
image
,),

1856 
Úe_hÙ_’codšg
: (
f›lds
.
IÅutD©aF›lds
.
groundŒuth_image_şas£s
,),

1857 
rgb_to_g¿y
: (
f›lds
.
IÅutD©aF›lds
.
image
,),

1858 
ssd_¿ndom_üİ
: (
f›lds
.
IÅutD©aF›lds
.
image
,

1859 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
,

1860 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
,

1861 
groundŒuth_š¡ªû_masks
,

1862 
groundŒuth_keypošts
,),

1863 
ssd_¿ndom_üİ_·d
: (
f›lds
.
IÅutD©aF›lds
.
image
,

1864 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
,

1865 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
),

1866 
ssd_¿ndom_üİ_fixed_a¥eù_¿tio
: (

1867 
f›lds
.
IÅutD©aF›lds
.
image
,

1868 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
,

1869 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
,

1870 
groundŒuth_š¡ªû_masks
,

1871 
groundŒuth_keypošts
,),

1872 
	}
}

1874  
´•_func_¬g_m­


1877 
def
 
	$´•roûss
(
‹nsÜ_diù
, 
´•roûss_İtiÚs
, 
func_¬g_m­
=
NÚe
):

1880 
V¬ious
 
ty³s
 
of
 
	$´•roûssšg
 (
to
 
be
 
im¶em’‹d
è
ba£d
 
Ú
 
the


1881 
´•roûss_İtiÚs
 
diùiÚ¬y
 
e
.
g
. "üİ image" (
afãùs
 
image
 
ªd
 
possibly


1882 
boxes
), "wh™b®ªû image" (
afãùs
 
Úly
 
image
), 
‘c
. 
If
 
£lf
.
_İtiÚs


1883 
is
 
NÚe
, 
no
 
´•roûssšg
 i 
dÚe
.

1885 
Args
:

1886 
‹nsÜ_diù
: 
diùiÚ¬y
 
th©
 
cÚšs
 
images
, 
boxes
, 
ªd
 
ÿn
 
cÚš
 
Ùh”


1887 
thšgs
 
as
 
w–l
.

1888 
images
-> 
¿nk
 4 
æßt32
 
‹nsÜ
 
cÚšs


1889 1 
image
 -> [1, 
height
, 
width
, 3].

1890 
w™h
 
pix–
 
v®ues
 
v¬yšg
 
b‘w“n
 [0, 1]

1891 
boxes
-> 
¿nk
 2 
æßt32
 
‹nsÜ
 
cÚššg


1892 
the
 
boundšg
 
boxes
 -> [
N
, 4].

1893 
Boxes
 
¬e
 
š
 
nÜm®ized
 
fÜm
 
m—nšg


1894 
theœ
 
coÜdš©es
 
v¬y
 
b‘w“n
 [0, 1].

1895 
Each
 
row
 
is
 
š
 
the
 
fÜm


1896 
of
 [
ymš
, 
xmš
, 
ymax
, 
xmax
].

1897 
´•roûss_İtiÚs
: 
It
 
is
 
a
 
li¡
 
of
 
tu¶es
, 
wh”e
 
—ch
 
tu¶e
 
cÚšs
‡

1898 
funùiÚ
 
ªd
 
a
 
diùiÚ¬y
 
th©
 
cÚšs
 
¬gum’ts
‡nd

1899 
theœ
 
v®ues
.

1900 
func_¬g_m­
: 
m­pšg
 
äom
 
´•roûssšg
 
funùiÚs
 
to
 
¬gum’ts
 
th©
 
they


1901 
ex³ù
 
to
 
»ûive
 
ªd
 .

1903 
R‘uºs
:

1904 
‹nsÜ_diù
: 
which
 
cÚšs
 
the
 
´•roûs£d
 
images
, 
boundšg
 
boxes
, 
‘c
.

1906 
Rai£s
:

1907 
V®ueE¼Ü
: (
a
è
If
 
the
 
funùiÚs
 
·s£d
 
to
 
P»´oûss


1908 
¬e
 
nÙ
 
š
 
func_¬g_m­
.

1909 (
b
è
If
 
the
 
¬gum’ts
 
th©
 
a
 
funùiÚ
 
Ãeds


1910 dØ
nÙ
 
exi¡
 
š
 
‹nsÜ_diù
.

1911 (
c
è
If
 
image
 
š
 
‹nsÜ_diù
 
is
 
nÙ
 
¿nk
 4

1913 
func_¬g_m­
 
is
 
NÚe
:

1914 
func_¬g_m­
 = 
	$g‘_deçuÉ_func_¬g_m­
()

1916 #chªge 
the
 
images
 
to
 
	`image
 (
¿nk
 4Ø¿nk 3è
sšû
h
funùiÚs


1917 #»ûiv
¿nk
 3 
‹nsÜ
 
image


1918 
f›lds
.
IÅutD©aF›lds
.
image
 
š
 
‹nsÜ_diù
:

1919 
images
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

1920 
	`Ën
(
images
.
	`g‘_sh­e
()) != 4:

1921 
¿i£
 
	`V®ueE¼Ü
('images inensor_dict should be„ank 4')

1922 
image
 = 
tf
.
	$squ“ze
(
images
, 
squ“ze_dims
=[0])

1923 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
] = image

1925 #P»´oûs 
šputs
 
ba£d
 
Ú
 
´•roûss_İtiÚs


1926 
İtiÚ
 
š
 
´•roûss_İtiÚs
:

1927 
func
, 
·¿ms
 = 
İtiÚ


1928 
func
 
nÙ
 
š
 
func_¬g_m­
:

1929 
¿i£
 
	`V®ueE¼Ü
('The function %s does‚otƒxist in func_arg_map' %

1930 (
func
.
__Çme__
))

1931 
¬g_Çmes
 = 
func_¬g_m­
[
func
]

1932 
a
 
š
 
¬g_Çmes
:

1933 
a
 
is
 
nÙ
 
NÚe
 
ªd
‡‚Ù 
š
 
‹nsÜ_diù
:

1934 
¿i£
 
	`V®ueE¼Ü
('The function %s„equires‡rgument %s' %

1935 (
func
.
__Çme__
, 
a
))

1937 
def
 
	$g‘_¬g
(
key
):

1938  
‹nsÜ_diù
[
key
] key 
is
 
nÙ
 
NÚe
 None

1939 
¬gs
 = [
	$g‘_¬g
(
a
è¨
š
 
¬g_Çmes
]

1940 
»suÉs
 = 
	$func
(*
¬gs
, **
·¿ms
)

1941 
nÙ
 
	`isš¡ªû
(
»suÉs
, (
li¡
, 
tu¶e
)):

1942 
»suÉs
 = (results,)

1943 #Remove 
NÚe
 
¬gs
 
sšû
 
the
  
v®ues
 
wl
 
nÙ
 
cÚš
 
tho£
.

1944 
¬g_Çmes
 = [
¬g_Çme
 ¬g_Çm
š
‡rg_Çme ¬g_Çm
is
 
nÙ
 
NÚe
]

1945 
»s
, 
¬g_Çme
 
š
 
	$z
(
»suÉs
, 
¬g_Çmes
):

1946 
‹nsÜ_diù
[
¬g_Çme
] = 
»s


1948 #chªge 
the
 
image
 
to
 
	`images
 (
¿nk
 3Ø¿nk 4ètØ
be
 
com·tibË
Ø
wh©


1949 #w
»ûived
 
š
 
the
 
fœ¡
 
¶aû


1950 
f›lds
.
IÅutD©aF›lds
.
image
 
š
 
‹nsÜ_diù
:

1951 
image
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.image]

1952 
images
 = 
tf
.
	$ex·nd_dims
(
image
, 0)

1953 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
] = 
images


1955  
‹nsÜ_diù


	@core/preprocessor_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
numpy
 
as
 
Å


19 
impÜt
 
six


21 
impÜt
 
‹nsÜæow
 
as
 
tf


23 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
´•roûssÜ


24 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
¡ªd¬d_f›lds
 
as
 
f›lds


26 
	gsix
.
	gPY2
:

27 
impÜt
 
mock
 #pylšt: 
di§bË
=
g
-impÜt-
nÙ
-
©
-
tİ


29 
äom
 
un™‹¡
 
impÜt
 
mock
 #pylšt: 
di§bË
=
g
-impÜt-
nÙ
-
©
-
tİ


32 
şass
 
	$P»´oûssÜTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

34 
def
 
	$ü—‹CŞÜfulTe¡Image
(
£lf
):

35 
ch255
 = 
tf
.
	`fl
([1, 100, 200, 1],f.
	$cÚ¡ªt
(255, 
dty³
=
tf
.
ušt8
))

36 
ch128
 = 
tf
.
	`fl
([1, 100, 200, 1],f.
	$cÚ¡ªt
(128, 
dty³
=
tf
.
ušt8
))

37 
ch0
 = 
tf
.
	`fl
([1, 100, 200, 1],f.
	$cÚ¡ªt
(0, 
dty³
=
tf
.
ušt8
))

38 
imr
 = 
tf
.
	$cÚÿt
([
ch255
, 
ch0
, ch0], 3)

39 
img
 = 
tf
.
	$cÚÿt
([
ch255
, ch255, 
ch0
], 3)

40 
imb
 = 
tf
.
	$cÚÿt
([
ch255
, 
ch0
, ch255], 3)

41 
imw
 = 
tf
.
	$cÚÿt
([
ch128
, ch128, ch128], 3)

42 
imu
 = 
tf
.
	$cÚÿt
([
imr
, 
img
], 2)

43 
imd
 = 
tf
.
	$cÚÿt
([
imb
, 
imw
], 2)

44 
im
 = 
tf
.
	$cÚÿt
([
imu
, 
imd
], 1)

45  
im


47 
def
 
	$ü—‹Te¡Images
(
£lf
):

48 
images_r
 = 
tf
.
	$cÚ¡ªt
([[[128, 128, 128, 128], [0, 0, 128, 128],

50 
dty³
=
tf
.
ušt8
)

51 
images_r
 = 
tf
.
	$ex·nd_dims
(
images_r
, 3)

52 
images_g
 = 
tf
.
	$cÚ¡ªt
([[[0, 0, 128, 128], [0, 0, 128, 128],

54 
dty³
=
tf
.
ušt8
)

55 
images_g
 = 
tf
.
	$ex·nd_dims
(
images_g
, 3)

56 
images_b
 = 
tf
.
	$cÚ¡ªt
([[[128, 128, 192, 0], [0, 0, 128, 192],

58 
dty³
=
tf
.
ušt8
)

59 
images_b
 = 
tf
.
	$ex·nd_dims
(
images_b
, 3)

60 
images
 = 
tf
.
	$cÚÿt
([
images_r
, 
images_g
, 
images_b
], 3)

61  
images


63 
def
 
	$ü—‹Te¡Boxes
(
£lf
):

64 
boxes
 = 
tf
.
	$cÚ¡ªt
(

65 [[0.0, 0.25, 0.75, 1.0], [0.25, 0.5, 0.75, 1.0]], 
dty³
=
tf
.
æßt32
)

66  
boxes


68 
def
 
	$ü—‹Te¡Lab–ScÜes
(
£lf
):

69  
tf
.
	$cÚ¡ªt
([1.0, 0.5], 
dty³
=
tf
.
æßt32
)

71 
def
 
	$ü—‹Te¡Lab–ScÜesW™hMissšgScÜe
(
£lf
):

72  
tf
.
	$cÚ¡ªt
([0.5, 
Å
.
Çn
], 
dty³
=
tf
.
æßt32
)

74 
def
 
	$ü—‹Te¡Masks
(
£lf
):

75 
mask
 = 
Å
.
	$¬¿y
([

82  
tf
.
	$cÚ¡ªt
(
mask
, 
dty³
=
tf
.
æßt32
)

84 
def
 
	$ü—‹Te¡Keypošts
(
£lf
):

85 
keypošts
 = 
Å
.
	$¬¿y
([

89  
tf
.
	$cÚ¡ªt
(
keypošts
, 
dty³
=
tf
.
æßt32
)

91 
def
 
	$ü—‹Te¡KeypoštsInsideCrİ
(
£lf
):

92 
keypošts
 = 
Å
.
	$¬¿y
([

96  
tf
.
	$cÚ¡ªt
(
keypošts
, 
dty³
=
tf
.
æßt32
)

98 
def
 
	$ü—‹Te¡KeypoštsOutsideCrİ
(
£lf
):

99 
keypošts
 = 
Å
.
	$¬¿y
([

103  
tf
.
	$cÚ¡ªt
(
keypošts
, 
dty³
=
tf
.
æßt32
)

105 
def
 
	$ü—‹KeypoštFlP”mutiÚ
(
£lf
):

106  
Å
.
	$¬¿y
([0, 2, 1], 
dty³
=
Å
.
št32
)

108 
def
 
	$ü—‹Te¡Lab–s
(
£lf
):

109 
Ïb–s
 = 
tf
.
	$cÚ¡ªt
([1, 2], 
dty³
=
tf
.
št32
)

110  
Ïb–s


112 
def
 
	$ü—‹Te¡BoxesOutOfImage
(
£lf
):

113 
boxes
 = 
tf
.
	`cÚ¡ªt
(

114 [[-0.1, 0.25, 0.75, 1], [0.25, 0.5, 0.75, 1.1]], 
dty³
=
tf
.
æßt32
)

115  
boxes


117 
def
 
	$ex³ùedImagesAá”NÜm®iz©iÚ
(
£lf
):

118 
images_r
 = 
tf
.
	`cÚ¡ªt
([[[0, 0, 0, 0], [-1, -1, 0, 0],

120 
dty³
=
tf
.
æßt32
)

121 
images_r
 = 
tf
.
	$ex·nd_dims
(
images_r
, 3)

122 
images_g
 = 
tf
.
	`cÚ¡ªt
([[[-1, -1, 0, 0], [-1, -1, 0, 0],

124 
dty³
=
tf
.
æßt32
)

125 
images_g
 = 
tf
.
	$ex·nd_dims
(
images_g
, 3)

126 
images_b
 = 
tf
.
	`cÚ¡ªt
([[[0, 0, 0.5, -1], [-1, -1, 0, 0.5],

128 
dty³
=
tf
.
æßt32
)

129 
images_b
 = 
tf
.
	$ex·nd_dims
(
images_b
, 3)

130 
images
 = 
tf
.
	$cÚÿt
([
images_r
, 
images_g
, 
images_b
], 3)

131  
images


133 
def
 
	$ex³ùedMaxImageAá”CŞÜSÿË
(
£lf
):

134 
images_r
 = 
tf
.
	`cÚ¡ªt
([[[0.1, 0.1, 0.1, 0.1], [-0.9, -0.9, 0.1, 0.1],

136 
dty³
=
tf
.
æßt32
)

137 
images_r
 = 
tf
.
	$ex·nd_dims
(
images_r
, 3)

138 
images_g
 = 
tf
.
	`cÚ¡ªt
([[[-0.9, -0.9, 0.1, 0.1], [-0.9, -0.9, 0.1, 0.1],

140 
dty³
=
tf
.
æßt32
)

141 
images_g
 = 
tf
.
	$ex·nd_dims
(
images_g
, 3)

142 
images_b
 = 
tf
.
	`cÚ¡ªt
([[[0.1, 0.1, 0.6, -0.9], [-0.9, -0.9, 0.1, 0.6],

144 
dty³
=
tf
.
æßt32
)

145 
images_b
 = 
tf
.
	$ex·nd_dims
(
images_b
, 3)

146 
images
 = 
tf
.
	$cÚÿt
([
images_r
, 
images_g
, 
images_b
], 3)

147  
images


149 
def
 
	$ex³ùedMšImageAá”CŞÜSÿË
(
£lf
):

150 
images_r
 = 
tf
.
	`cÚ¡ªt
([[[-0.1, -0.1, -0.1, -0.1], [-1, -1, -0.1, -0.1],

152 
dty³
=
tf
.
æßt32
)

153 
images_r
 = 
tf
.
	$ex·nd_dims
(
images_r
, 3)

154 
images_g
 = 
tf
.
	`cÚ¡ªt
([[[-1, -1, -0.1, -0.1], [-1, -1, -0.1, -0.1],

156 
dty³
=
tf
.
æßt32
)

157 
images_g
 = 
tf
.
	$ex·nd_dims
(
images_g
, 3)

158 
images_b
 = 
tf
.
	`cÚ¡ªt
([[[-0.1, -0.1, 0.4, -1], [-1, -1, -0.1, 0.4],

160 
dty³
=
tf
.
æßt32
)

161 
images_b
 = 
tf
.
	$ex·nd_dims
(
images_b
, 3)

162 
images
 = 
tf
.
	$cÚÿt
([
images_r
, 
images_g
, 
images_b
], 3)

163  
images


165 
def
 
	$ex³ùedImagesAá”MœrÜšg
(
£lf
):

166 
images_r
 = 
tf
.
	`cÚ¡ªt
([[[0, 0, 0, 0], [0, 0, -1, -1],

168 
dty³
=
tf
.
æßt32
)

169 
images_r
 = 
tf
.
	$ex·nd_dims
(
images_r
, 3)

170 
images_g
 = 
tf
.
	`cÚ¡ªt
([[[0, 0, -1, -1], [0, 0, -1, -1],

172 
dty³
=
tf
.
æßt32
)

173 
images_g
 = 
tf
.
	$ex·nd_dims
(
images_g
, 3)

174 
images_b
 = 
tf
.
	`cÚ¡ªt
([[[-1, 0.5, 0, 0], [0.5, 0, -1, -1],

176 
dty³
=
tf
.
æßt32
)

177 
images_b
 = 
tf
.
	$ex·nd_dims
(
images_b
, 3)

178 
images
 = 
tf
.
	$cÚÿt
([
images_r
, 
images_g
, 
images_b
], 3)

179  
images


181 
def
 
	$ex³ùedBoxesAá”MœrÜšg
(
£lf
):

182 
boxes
 = 
tf
.
	$cÚ¡ªt
([[0.0, 0.0, 0.75, 0.75], [0.25, 0.0, 0.75, 0.5]],

183 
dty³
=
tf
.
æßt32
)

184  
boxes


186 
def
 
	$ex³ùedBoxesAá”XY
(
£lf
):

187 
boxes
 = 
tf
.
	$cÚ¡ªt
([[0.25, 0.0, 1.0, 0.75], [0.5, 0.25, 1, 0.75]],

188 
dty³
=
tf
.
æßt32
)

189  
boxes


191 
def
 
	$ex³ùedMasksAá”MœrÜšg
(
£lf
):

192 
mask
 = 
Å
.
	$¬¿y
([

199  
tf
.
	$cÚ¡ªt
(
mask
, 
dty³
=
tf
.
æßt32
)

201 
def
 
	$ex³ùedLab–ScÜesAá”Th»shŞdšg
(
£lf
):

202  
tf
.
	$cÚ¡ªt
([1.0], 
dty³
=
tf
.
æßt32
)

204 
def
 
	$ex³ùedBoxesAá”Th»shŞdšg
(
£lf
):

205  
tf
.
	$cÚ¡ªt
([[0.0, 0.25, 0.75, 1.0]], 
dty³
=
tf
.
æßt32
)

207 
def
 
	$ex³ùedLab–sAá”Th»shŞdšg
(
£lf
):

208  
tf
.
	$cÚ¡ªt
([1], 
dty³
=
tf
.
æßt32
)

210 
def
 
	$ex³ùedMasksAá”Th»shŞdšg
(
£lf
):

211 
mask
 = 
Å
.
	$¬¿y
([

215  
tf
.
	$cÚ¡ªt
(
mask
, 
dty³
=
tf
.
æßt32
)

217 
def
 
	$ex³ùedKeypoštsAá”Th»shŞdšg
(
£lf
):

218 
keypošts
 = 
Å
.
	$¬¿y
([

221  
tf
.
	$cÚ¡ªt
(
keypošts
, 
dty³
=
tf
.
æßt32
)

223 
def
 
	$ex³ùedLab–ScÜesAá”Th»shŞdšgW™hMissšgScÜe
(
£lf
):

224  
tf
.
	$cÚ¡ªt
([
Å
.
Çn
], 
dty³
=
tf
.
æßt32
)

226 
def
 
	$ex³ùedBoxesAá”Th»shŞdšgW™hMissšgScÜe
(
£lf
):

227  
tf
.
	$cÚ¡ªt
([[0.25, 0.5, 0.75, 1]], 
dty³
=
tf
.
æßt32
)

229 
def
 
	$ex³ùedLab–sAá”Th»shŞdšgW™hMissšgScÜe
(
£lf
):

230  
tf
.
	$cÚ¡ªt
([2], 
dty³
=
tf
.
æßt32
)

232 
def
 
	$‹¡NÜm®izeImage
(
£lf
):

233 
´•roûss_İtiÚs
 = [(
´•roûssÜ
.
nÜm®ize_image
, {

238 
	}
})]

239 
images
 = 
£lf
.
	$ü—‹Te¡Images
()

240 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images
}

241 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
, 
´•roûss_İtiÚs
)

242 
images
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

243 
images_ex³ùed
 = 
£lf
.
	$ex³ùedImagesAá”NÜm®iz©iÚ
()

245 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

246 (
images_
, 
images_ex³ùed_
èğ
£ss
.
	$run
(

247 [
images
, 
images_ex³ùed
])

248 
images_sh­e_
 = 
images_
.
sh­e


249 
images_ex³ùed_sh­e_
 = 
images_ex³ùed_
.
sh­e


250 
ex³ùed_sh­e
 = [1, 4, 4, 3]

251 
£lf
.
	$as£¹AÎEqu®
(
images_ex³ùed_sh­e_
, 
images_sh­e_
)

252 
£lf
.
	$as£¹AÎEqu®
(
images_sh­e_
, 
ex³ùed_sh­e
)

253 
£lf
.
	$as£¹AÎClo£
(
images_
, 
images_ex³ùed_
)

255 
def
 
	$‹¡R‘ašBoxesAboveTh»shŞd
(
£lf
):

256 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

257 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

258 
Ïb–_scÜes
 = 
£lf
.
	$ü—‹Te¡Lab–ScÜes
()

259 (
»šed_boxes
, 
»šed_Ïb–s
,

260 
»šed_Ïb–_scÜes
èğ
´•roûssÜ
.
	$»š_boxes_above_th»shŞd
(

261 
boxes
, 
Ïb–s
, 
Ïb–_scÜes
, 
th»shŞd
=0.6)

262 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

263 (
»šed_boxes_
, 
»šed_Ïb–s_
, 
»šed_Ïb–_scÜes_
,

264 
ex³ùed_»šed_boxes_
, 
ex³ùed_»šed_Ïb–s_
,

265 
ex³ùed_»šed_Ïb–_scÜes_
èğ
£ss
.
	`run
([

266 
»šed_boxes
, 
»šed_Ïb–s
, 
»šed_Ïb–_scÜes
,

267 
£lf
.
	`ex³ùedBoxesAá”Th»shŞdšg
(),

268 
£lf
.
	`ex³ùedLab–sAá”Th»shŞdšg
(),

269 
£lf
.
	`ex³ùedLab–ScÜesAá”Th»shŞdšg
()])

270 
£lf
.
	$as£¹AÎClo£
(

271 
»šed_boxes_
, 
ex³ùed_»šed_boxes_
)

272 
£lf
.
	$as£¹AÎClo£
(

273 
»šed_Ïb–s_
, 
ex³ùed_»šed_Ïb–s_
)

274 
£lf
.
	$as£¹AÎClo£
(

275 
»šed_Ïb–_scÜes_
, 
ex³ùed_»šed_Ïb–_scÜes_
)

277 
def
 
	$‹¡R‘ašBoxesAboveTh»shŞdW™hMasks
(
£lf
):

278 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

279 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

280 
Ïb–_scÜes
 = 
£lf
.
	$ü—‹Te¡Lab–ScÜes
()

281 
masks
 = 
£lf
.
	$ü—‹Te¡Masks
()

282 
_
, _, _, 
»šed_masks
 = 
´•roûssÜ
.
	$»š_boxes_above_th»shŞd
(

283 
boxes
, 
Ïb–s
, 
Ïb–_scÜes
, 
masks
, 
th»shŞd
=0.6)

284 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

285 
»šed_masks_
, 
ex³ùed_»šed_masks_
 = 
£ss
.
	`run
([

286 
»šed_masks
, 
£lf
.
	`ex³ùedMasksAá”Th»shŞdšg
()])

288 
£lf
.
	$as£¹AÎClo£
(

289 
»šed_masks_
, 
ex³ùed_»šed_masks_
)

291 
def
 
	$‹¡R‘ašBoxesAboveTh»shŞdW™hKeypošts
(
£lf
):

292 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

293 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

294 
Ïb–_scÜes
 = 
£lf
.
	$ü—‹Te¡Lab–ScÜes
()

295 
keypošts
 = 
£lf
.
	$ü—‹Te¡Keypošts
()

296 (
_
, _, _, 
»šed_keypošts
èğ
´•roûssÜ
.
	$»š_boxes_above_th»shŞd
(

297 
boxes
, 
Ïb–s
, 
Ïb–_scÜes
, 
keypošts
=keypošts, 
th»shŞd
=0.6)

298 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

299 (
»šed_keypošts_
,

300 
ex³ùed_»šed_keypošts_
èğ
£ss
.
	`run
([

301 
»šed_keypošts
,

302 
£lf
.
	`ex³ùedKeypoštsAá”Th»shŞdšg
()])

304 
£lf
.
	$as£¹AÎClo£
(

305 
»šed_keypošts_
, 
ex³ùed_»šed_keypošts_
)

307 
def
 
	$‹¡R‘ašBoxesAboveTh»shŞdW™hMissšgScÜe
(
£lf
):

308 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

309 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

310 
Ïb–_scÜes
 = 
£lf
.
	$ü—‹Te¡Lab–ScÜesW™hMissšgScÜe
()

311 (
»šed_boxes
, 
»šed_Ïb–s
,

312 
»šed_Ïb–_scÜes
èğ
´•roûssÜ
.
	$»š_boxes_above_th»shŞd
(

313 
boxes
, 
Ïb–s
, 
Ïb–_scÜes
, 
th»shŞd
=0.6)

314 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

315 (
»šed_boxes_
, 
»šed_Ïb–s_
, 
»šed_Ïb–_scÜes_
,

316 
ex³ùed_»šed_boxes_
, 
ex³ùed_»šed_Ïb–s_
,

317 
ex³ùed_»šed_Ïb–_scÜes_
èğ
£ss
.
	`run
([

318 
»šed_boxes
, 
»šed_Ïb–s
, 
»šed_Ïb–_scÜes
,

319 
£lf
.
	`ex³ùedBoxesAá”Th»shŞdšgW™hMissšgScÜe
(),

320 
£lf
.
	`ex³ùedLab–sAá”Th»shŞdšgW™hMissšgScÜe
(),

321 
£lf
.
	`ex³ùedLab–ScÜesAá”Th»shŞdšgW™hMissšgScÜe
()])

322 
£lf
.
	$as£¹AÎClo£
(

323 
»šed_boxes_
, 
ex³ùed_»šed_boxes_
)

324 
£lf
.
	$as£¹AÎClo£
(

325 
»šed_Ïb–s_
, 
ex³ùed_»šed_Ïb–s_
)

326 
£lf
.
	$as£¹AÎClo£
(

327 
»šed_Ïb–_scÜes_
, 
ex³ùed_»šed_Ïb–_scÜes_
)

329 
def
 
	$‹¡RªdomFlBoxes
(
£lf
):

330 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

332 #Ca£ 
wh”e
 
the
 
boxes
 
¬e
 
æ³d
.

333 
boxes_ex³ùed1
 = 
£lf
.
	$ex³ùedBoxesAá”MœrÜšg
()

335 #Ca£ 
wh”e
 
the
 
boxes
 
¬e
 
nÙ
 
æ³d
.

336 
boxes_ex³ùed2
 = 
boxes


338 #Aá” 
–em’twi£
 
muÉliÿtiÚ
, 
the
 
»suÉ
 
should
 
be
 
®l
-
z”o
 
sšû
 
Úe


339 #oà
them
 
is
 
®l
-
z”o
.

340 
boxes_diff
 = 
tf
.
	`muÉly
(

341 
tf
.
	`squ¬ed_difã»nû
(
boxes
, 
boxes_ex³ùed1
),

342 
tf
.
	$squ¬ed_difã»nû
(
boxes
, 
boxes_ex³ùed2
))

343 
ex³ùed_»suÉ
 = 
tf
.
	$z”os_like
(
boxes_diff
)

345 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

346 (
boxes_diff
, 
ex³ùed_»suÉ
èğ
£ss
.
	$run
([
boxes_diff
, 
ex³ùed_»suÉ
])

347 
£lf
.
	$as£¹AÎEqu®
(
boxes_diff
, 
ex³ùed_»suÉ
)

349 
def
 
	$‹¡FlMasks
(
£lf
):

350 
‹¡_mask
 = 
£lf
.
	$ü—‹Te¡Masks
()

351 
æ³d_mask
 = 
´•roûssÜ
.
	$_æ_masks
(
‹¡_mask
)

352 
ex³ùed_mask
 = 
£lf
.
	$ex³ùedMasksAá”MœrÜšg
()

353 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

354 
æ³d_mask
, 
ex³ùed_mask
 = 
£ss
.
	$run
([
æ³d_mask
, 
ex³ùed_mask
])

355 
£lf
.
	`as£¹AÎEqu®
(
æ³d_mask
.
	`æ©‹n
(), 
ex³ùed_mask
.
	$æ©‹n
())

357 
def
 
	$‹¡RªdomHÜizÚlFl
(
£lf
):

358 
´•roûss_İtiÚs
 = [(
´•roûssÜ
.
¿ndom_hÜizÚl_æ
, {
	}
})]

359 
	gimages
 = 
£lf
.
	$ex³ùedImagesAá”NÜm®iz©iÚ
()

360 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

361 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images
,

362 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
}

363 
images_ex³ùed1
 = 
£lf
.
	$ex³ùedImagesAá”MœrÜšg
()

364 
boxes_ex³ùed1
 = 
£lf
.
	$ex³ùedBoxesAá”MœrÜšg
()

365 
images_ex³ùed2
 = 
images


366 
boxes_ex³ùed2
 = 
boxes


367 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
, 
´•roûss_İtiÚs
)

368 
images
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

369 
boxes
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

371 
boxes_diff1
 = 
tf
.
	$squ¬ed_difã»nû
(
boxes
, 
boxes_ex³ùed1
)

372 
boxes_diff2
 = 
tf
.
	$squ¬ed_difã»nû
(
boxes
, 
boxes_ex³ùed2
)

373 
boxes_diff
 = 
tf
.
	$muÉly
(
boxes_diff1
, 
boxes_diff2
)

374 
boxes_diff_ex³ùed
 = 
tf
.
	$z”os_like
(
boxes_diff
)

376 
images_diff1
 = 
tf
.
	$squ¬ed_difã»nû
(
images
, 
images_ex³ùed1
)

377 
images_diff2
 = 
tf
.
	$squ¬ed_difã»nû
(
images
, 
images_ex³ùed2
)

378 
images_diff
 = 
tf
.
	$muÉly
(
images_diff1
, 
images_diff2
)

379 
images_diff_ex³ùed
 = 
tf
.
	$z”os_like
(
images_diff
)

381 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

382 (
images_diff_
, 
images_diff_ex³ùed_
, 
boxes_diff_
,

383 
boxes_diff_ex³ùed_
èğ
£ss
.
	$run
([
images_diff
, 
images_diff_ex³ùed
,

384 
boxes_diff
, 
boxes_diff_ex³ùed
])

385 
£lf
.
	$as£¹AÎClo£
(
boxes_diff_
, 
boxes_diff_ex³ùed_
)

386 
£lf
.
	$as£¹AÎClo£
(
images_diff_
, 
images_diff_ex³ùed_
)

388 
def
 
	$‹¡RunRªdomHÜizÚlFlW™hMaskAndKeypošts
(
£lf
):

389 
´•roûss_İtiÚs
 = [(
´•roûssÜ
.
¿ndom_hÜizÚl_æ
, {
	}
})]

390 
	gimage_height
 = 3

391 
image_width
 = 3

392 
images
 = 
tf
.
	$¿ndom_unifÜm
([1, 
image_height
, 
image_width
, 3])

393 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

394 
masks
 = 
£lf
.
	$ü—‹Te¡Masks
()

395 
keypošts
 = 
£lf
.
	$ü—‹Te¡Keypošts
()

396 
keypošt_æ_³rmutiÚ
 = 
£lf
.
	$ü—‹KeypoštFlP”mutiÚ
()

397 
‹nsÜ_diù
 = {

398 
f›lds
.
IÅutD©aF›lds
.
image
: 
images
,

399 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

400 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_š¡ªû_masks
: 
masks
,

401 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_keypošts
: 
keypošts


402 
	}
}

403 
´•roûss_İtiÚs
 = [

404 (
´•roûssÜ
.
¿ndom_hÜizÚl_æ
,

405 {'keypošt_æ_³rmutiÚ': 
keypošt_æ_³rmutiÚ
})]

406 
´•roûssÜ_¬g_m­
 = 
´•roûssÜ
.
	$g‘_deçuÉ_func_¬g_m­
(

407 
šşude_š¡ªû_masks
=
True
, 
šşude_keypošts
=True)

408 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(

409 
‹nsÜ_diù
, 
´•roûss_İtiÚs
, 
func_¬g_m­
=
´•roûssÜ_¬g_m­
)

410 
boxes
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

411 
masks
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_š¡ªû_masks
]

412 
keypošts
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_keypošts
]

413 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

414 
boxes
, 
masks
, 
keypošts
 = 
£ss
.
	$run
([
boxes
, 
masks
, 
keypošts
])

415 
£lf
.
	$as£¹True
(
boxes
 
is
 
nÙ
 
NÚe
)

416 
£lf
.
	$as£¹True
(
masks
 
is
 
nÙ
 
NÚe
)

417 
£lf
.
	$as£¹True
(
keypošts
 
is
 
nÙ
 
NÚe
)

419 
def
 
	$‹¡RªdomPix–V®ueSÿË
(
£lf
):

420 
´•roûssšg_İtiÚs
 = []

421 
´•roûssšg_İtiÚs
.
	`­³nd
((
´•roûssÜ
.
nÜm®ize_image
, {

426 
	}
}))

427 
´•roûssšg_İtiÚs
.
­³nd
((
´•roûssÜ
.
¿ndom_pix–_v®ue_sÿË
, {}))

428 
	gimages
 = 
£lf
.
	$ü—‹Te¡Images
()

429 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images
}

430 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
)

431 
images_mš
 = 
tf
.
	`to_æßt
(
images
) * 0.9 / 255.0

432 
images_max
 = 
tf
.
	`to_æßt
(
images
) * 1.1 / 255.0

433 
images
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

434 
v®ues_g»©”
 = 
tf
.
	$g»©”_equ®
(
images
, 
images_mš
)

435 
v®ues_Ëss
 = 
tf
.
	$Ëss_equ®
(
images
, 
images_max
)

436 
v®ues_Œue
 = 
tf
.
	$fl
([1, 4, 4, 3], 
True
)

437 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

438 (
v®ues_g»©”_
, 
v®ues_Ëss_
, 
v®ues_Œue_
èğ
£ss
.
	$run
(

439 [
v®ues_g»©”
, 
v®ues_Ëss
, 
v®ues_Œue
])

440 
£lf
.
	$as£¹AÎClo£
(
v®ues_g»©”_
, 
v®ues_Œue_
)

441 
£lf
.
	$as£¹AÎClo£
(
v®ues_Ëss_
, 
v®ues_Œue_
)

443 
def
 
	$‹¡RªdomImageSÿË
(
£lf
):

444 
´•roûss_İtiÚs
 = [(
´•roûssÜ
.
¿ndom_image_sÿË
, {
	}
})]

445 
	gimages_Üigš®
 = 
£lf
.
	$ü—‹Te¡Images
()

446 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images_Üigš®
}

447 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
, 
´•roûss_İtiÚs
)

448 
images_sÿËd
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

449 
images_Üigš®_sh­e
 = 
tf
.
	$sh­e
(
images_Üigš®
)

450 
images_sÿËd_sh­e
 = 
tf
.
	$sh­e
(
images_sÿËd
)

451 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

452 (
images_Üigš®_sh­e_
, 
images_sÿËd_sh­e_
èğ
£ss
.
	$run
(

453 [
images_Üigš®_sh­e
, 
images_sÿËd_sh­e
])

454 
£lf
.
	`as£¹True
(

455 
images_Üigš®_sh­e_
[1] * 0.5 <ğ
images_sÿËd_sh­e_
[1])

456 
£lf
.
	`as£¹True
(

457 
images_Üigš®_sh­e_
[1] * 2.0 >ğ
images_sÿËd_sh­e_
[1])

458 
£lf
.
	`as£¹True
(

459 
images_Üigš®_sh­e_
[2] * 0.5 <ğ
images_sÿËd_sh­e_
[2])

460 
£lf
.
	`as£¹True
(

461 
images_Üigš®_sh­e_
[2] * 2.0 >ğ
images_sÿËd_sh­e_
[2])

463 
def
 
	$‹¡RªdomRGBtoG¿y
(
£lf
):

464 
´•roûss_İtiÚs
 = [(
´•roûssÜ
.
¿ndom_rgb_to_g¿y
, {
	}
})]

465 
	gimages_Üigš®
 = 
£lf
.
	$ü—‹Te¡Images
()

466 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images_Üigš®
}

467 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
, 
´•roûss_İtiÚs
)

468 
images_g¿y
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

469 
images_g¿y_r
, 
images_g¿y_g
, 
images_g¿y_b
 = 
tf
.
	$¥l™
(

470 
v®ue
=
images_g¿y
, 
num_Ü_size_¥l™s
=3, 
axis
=3)

471 
images_r
, 
images_g
, 
images_b
 = 
tf
.
	$¥l™
(

472 
v®ue
=
images_Üigš®
, 
num_Ü_size_¥l™s
=3, 
axis
=3)

473 
images_r_diff1
 = 
tf
.
	`squ¬ed_difã»nû
Ñf.
	`to_æßt
(
images_r
),

474 
tf
.
	$to_æßt
(
images_g¿y_r
))

475 
images_r_diff2
 = 
tf
.
	`squ¬ed_difã»nû
Ñf.
	`to_æßt
(
images_g¿y_r
),

476 
tf
.
	$to_æßt
(
images_g¿y_g
))

477 
images_r_diff
 = 
tf
.
	$muÉly
(
images_r_diff1
, 
images_r_diff2
)

478 
images_g_diff1
 = 
tf
.
	`squ¬ed_difã»nû
Ñf.
	`to_æßt
(
images_g
),

479 
tf
.
	$to_æßt
(
images_g¿y_g
))

480 
images_g_diff2
 = 
tf
.
	`squ¬ed_difã»nû
Ñf.
	`to_æßt
(
images_g¿y_g
),

481 
tf
.
	$to_æßt
(
images_g¿y_b
))

482 
images_g_diff
 = 
tf
.
	$muÉly
(
images_g_diff1
, 
images_g_diff2
)

483 
images_b_diff1
 = 
tf
.
	`squ¬ed_difã»nû
Ñf.
	`to_æßt
(
images_b
),

484 
tf
.
	$to_æßt
(
images_g¿y_b
))

485 
images_b_diff2
 = 
tf
.
	`squ¬ed_difã»nû
Ñf.
	`to_æßt
(
images_g¿y_b
),

486 
tf
.
	$to_æßt
(
images_g¿y_r
))

487 
images_b_diff
 = 
tf
.
	$muÉly
(
images_b_diff1
, 
images_b_diff2
)

488 
image_z”o1
 = 
tf
.
	$cÚ¡ªt
(0, 
dty³
=
tf
.
æßt32
, 
sh­e
=[1, 4, 4, 1])

489 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

490 (
images_r_diff_
, 
images_g_diff_
, 
images_b_diff_
, 
image_z”o1_
èğ
£ss
.
	$run
(

491 [
images_r_diff
, 
images_g_diff
, 
images_b_diff
, 
image_z”o1
])

492 
£lf
.
	$as£¹AÎClo£
(
images_r_diff_
, 
image_z”o1_
)

493 
£lf
.
	$as£¹AÎClo£
(
images_g_diff_
, 
image_z”o1_
)

494 
£lf
.
	$as£¹AÎClo£
(
images_b_diff_
, 
image_z”o1_
)

496 
def
 
	$‹¡RªdomAdju¡BrighŠess
(
£lf
):

497 
´•roûssšg_İtiÚs
 = []

498 
´•roûssšg_İtiÚs
.
	`­³nd
((
´•roûssÜ
.
nÜm®ize_image
, {

503 
	}
}))

504 
´•roûssšg_İtiÚs
.
­³nd
((
´•roûssÜ
.
¿ndom_adju¡_brighŠess
, {}))

505 
	gimages_Üigš®
 = 
£lf
.
	$ü—‹Te¡Images
()

506 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images_Üigš®
}

507 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
)

508 
images_bright
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

509 
image_Üigš®_sh­e
 = 
tf
.
	$sh­e
(
images_Üigš®
)

510 
image_bright_sh­e
 = 
tf
.
	$sh­e
(
images_bright
)

511 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

512 (
image_Üigš®_sh­e_
, 
image_bright_sh­e_
èğ
£ss
.
	$run
(

513 [
image_Üigš®_sh­e
, 
image_bright_sh­e
])

514 
£lf
.
	$as£¹AÎEqu®
(
image_Üigš®_sh­e_
, 
image_bright_sh­e_
)

516 
def
 
	$‹¡RªdomAdju¡CÚŒa¡
(
£lf
):

517 
´•roûssšg_İtiÚs
 = []

518 
´•roûssšg_İtiÚs
.
	`­³nd
((
´•roûssÜ
.
nÜm®ize_image
, {

523 
	}
}))

524 
´•roûssšg_İtiÚs
.
­³nd
((
´•roûssÜ
.
¿ndom_adju¡_cÚŒa¡
, {}))

525 
	gimages_Üigš®
 = 
£lf
.
	$ü—‹Te¡Images
()

526 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images_Üigš®
}

527 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
)

528 
images_cÚŒa¡
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

529 
image_Üigš®_sh­e
 = 
tf
.
	$sh­e
(
images_Üigš®
)

530 
image_cÚŒa¡_sh­e
 = 
tf
.
	$sh­e
(
images_cÚŒa¡
)

531 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

532 (
image_Üigš®_sh­e_
, 
image_cÚŒa¡_sh­e_
èğ
£ss
.
	$run
(

533 [
image_Üigš®_sh­e
, 
image_cÚŒa¡_sh­e
])

534 
£lf
.
	$as£¹AÎEqu®
(
image_Üigš®_sh­e_
, 
image_cÚŒa¡_sh­e_
)

536 
def
 
	$‹¡RªdomAdju¡Hue
(
£lf
):

537 
´•roûssšg_İtiÚs
 = []

538 
´•roûssšg_İtiÚs
.
	`­³nd
((
´•roûssÜ
.
nÜm®ize_image
, {

543 
	}
}))

544 
´•roûssšg_İtiÚs
.
­³nd
((
´•roûssÜ
.
¿ndom_adju¡_hue
, {}))

545 
	gimages_Üigš®
 = 
£lf
.
	$ü—‹Te¡Images
()

546 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images_Üigš®
}

547 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
)

548 
images_hue
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

549 
image_Üigš®_sh­e
 = 
tf
.
	$sh­e
(
images_Üigš®
)

550 
image_hue_sh­e
 = 
tf
.
	$sh­e
(
images_hue
)

551 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

552 (
image_Üigš®_sh­e_
, 
image_hue_sh­e_
èğ
£ss
.
	$run
(

553 [
image_Üigš®_sh­e
, 
image_hue_sh­e
])

554 
£lf
.
	$as£¹AÎEqu®
(
image_Üigš®_sh­e_
, 
image_hue_sh­e_
)

556 
def
 
	$‹¡RªdomDi¡ÜtCŞÜ
(
£lf
):

557 
´•roûssšg_İtiÚs
 = []

558 
´•roûssšg_İtiÚs
.
	`­³nd
((
´•roûssÜ
.
nÜm®ize_image
, {

563 
	}
}))

564 
´•roûssšg_İtiÚs
.
­³nd
((
´•roûssÜ
.
¿ndom_di¡Üt_cŞÜ
, {}))

565 
	gimages_Üigš®
 = 
£lf
.
	$ü—‹Te¡Images
()

566 
images_Üigš®_sh­e
 = 
tf
.
	$sh­e
(
images_Üigš®
)

567 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images_Üigš®
}

568 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
)

569 
images_di¡Ü‹d_cŞÜ
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

570 
images_di¡Ü‹d_cŞÜ_sh­e
 = 
tf
.
	$sh­e
(
images_di¡Ü‹d_cŞÜ
)

571 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

572 (
images_Üigš®_sh­e_
, 
images_di¡Ü‹d_cŞÜ_sh­e_
èğ
£ss
.
	$run
(

573 [
images_Üigš®_sh­e
, 
images_di¡Ü‹d_cŞÜ_sh­e
])

574 
£lf
.
	$as£¹AÎEqu®
(
images_Üigš®_sh­e_
, 
images_di¡Ü‹d_cŞÜ_sh­e_
)

576 
def
 
	$‹¡RªdomJ™‹rBoxes
(
£lf
):

577 
´•roûssšg_İtiÚs
 = []

578 
´•roûssšg_İtiÚs
.
	`­³nd
((
´•roûssÜ
.
¿ndom_j™‹r_boxes
, {
	}
}))

579 
	gboxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

580 
boxes_sh­e
 = 
tf
.
	$sh­e
(
boxes
)

581 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
}

582 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
)

583 
di¡Ü‹d_boxes
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

584 
di¡Ü‹d_boxes_sh­e
 = 
tf
.
	$sh­e
(
di¡Ü‹d_boxes
)

586 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

587 (
boxes_sh­e_
, 
di¡Ü‹d_boxes_sh­e_
èğ
£ss
.
	$run
(

588 [
boxes_sh­e
, 
di¡Ü‹d_boxes_sh­e
])

589 
£lf
.
	$as£¹AÎEqu®
(
boxes_sh­e_
, 
di¡Ü‹d_boxes_sh­e_
)

591 
def
 
	$‹¡RªdomCrİImage
(
£lf
):

592 
´•roûssšg_İtiÚs
 = []

593 
´•roûssšg_İtiÚs
.
	`­³nd
((
´•roûssÜ
.
nÜm®ize_image
, {

598 
	}
}))

599 
´•roûssšg_İtiÚs
.
­³nd
((
´•roûssÜ
.
¿ndom_üİ_image
, {}))

600 
	gimages
 = 
£lf
.
	$ü—‹Te¡Images
()

601 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

602 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

603 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images
,

604 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

605 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s
}

606 
di¡Ü‹d_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
,

607 
´•roûssšg_İtiÚs
)

608 
di¡Ü‹d_images
 = 
di¡Ü‹d_‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

609 
di¡Ü‹d_boxes
 = 
di¡Ü‹d_‹nsÜ_diù
[

610 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

611 
boxes_¿nk
 = 
tf
.
	$¿nk
(
boxes
)

612 
di¡Ü‹d_boxes_¿nk
 = 
tf
.
	$¿nk
(
di¡Ü‹d_boxes
)

613 
images_¿nk
 = 
tf
.
	$¿nk
(
images
)

614 
di¡Ü‹d_images_¿nk
 = 
tf
.
	$¿nk
(
di¡Ü‹d_images
)

615 
£lf
.
	`as£¹Equ®
(3, 
di¡Ü‹d_images
.
	`g‘_sh­e
()[3])

617 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

618 (
boxes_¿nk_
, 
di¡Ü‹d_boxes_¿nk_
, 
images_¿nk_
,

619 
di¡Ü‹d_images_¿nk_
èğ
£ss
.
	$run
([

620 
boxes_¿nk
, 
di¡Ü‹d_boxes_¿nk
, 
images_¿nk
, 
di¡Ü‹d_images_¿nk


622 
£lf
.
	$as£¹AÎEqu®
(
boxes_¿nk_
, 
di¡Ü‹d_boxes_¿nk_
)

623 
£lf
.
	$as£¹AÎEqu®
(
images_¿nk_
, 
di¡Ü‹d_images_¿nk_
)

625 
def
 
	$‹¡RªdomCrİImageG¿ysÿË
(
£lf
):

626 
´•roûssšg_İtiÚs
 = [(
´•roûssÜ
.
rgb_to_g¿y
, {
	}
}),

627 (
´•roûssÜ
.
nÜm®ize_image
, {

633 (
´•roûssÜ
.
¿ndom_üİ_image
, {})]

634 
	gimages
 = 
£lf
.
	$ü—‹Te¡Images
()

635 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

636 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

637 
‹nsÜ_diù
 = {

638 
f›lds
.
IÅutD©aF›lds
.
image
: 
images
,

639 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

640 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s


641 
	}
}

642 
di¡Ü‹d_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(

643 
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
)

644 
di¡Ü‹d_images
 = 
di¡Ü‹d_‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

645 
di¡Ü‹d_boxes
 = 
di¡Ü‹d_‹nsÜ_diù
[

646 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

647 
boxes_¿nk
 = 
tf
.
	$¿nk
(
boxes
)

648 
di¡Ü‹d_boxes_¿nk
 = 
tf
.
	$¿nk
(
di¡Ü‹d_boxes
)

649 
images_¿nk
 = 
tf
.
	$¿nk
(
images
)

650 
di¡Ü‹d_images_¿nk
 = 
tf
.
	$¿nk
(
di¡Ü‹d_images
)

651 
£lf
.
	`as£¹Equ®
(1, 
di¡Ü‹d_images
.
	`g‘_sh­e
()[3])

653 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

654 
£ssiÚ_»suÉs
 = 
£ss
.
	$run
([

655 
boxes_¿nk
, 
di¡Ü‹d_boxes_¿nk
, 
images_¿nk
, 
di¡Ü‹d_images_¿nk


657 (
boxes_¿nk_
, 
di¡Ü‹d_boxes_¿nk_
, 
images_¿nk_
,

658 
di¡Ü‹d_images_¿nk_
èğ
£ssiÚ_»suÉs


659 
£lf
.
	$as£¹AÎEqu®
(
boxes_¿nk_
, 
di¡Ü‹d_boxes_¿nk_
)

660 
£lf
.
	$as£¹AÎEqu®
(
images_¿nk_
, 
di¡Ü‹d_images_¿nk_
)

662 
def
 
	$‹¡RªdomCrİImageW™hBoxOutOfImage
(
£lf
):

663 
´•roûssšg_İtiÚs
 = []

664 
´•roûssšg_İtiÚs
.
	`­³nd
((
´•roûssÜ
.
nÜm®ize_image
, {

669 
	}
}))

670 
´•roûssšg_İtiÚs
.
­³nd
((
´•roûssÜ
.
¿ndom_üİ_image
, {}))

671 
	gimages
 = 
£lf
.
	$ü—‹Te¡Images
()

672 
boxes
 = 
£lf
.
	$ü—‹Te¡BoxesOutOfImage
()

673 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

674 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images
,

675 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

676 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s
}

677 
di¡Ü‹d_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
,

678 
´•roûssšg_İtiÚs
)

679 
di¡Ü‹d_images
 = 
di¡Ü‹d_‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

680 
di¡Ü‹d_boxes
 = 
di¡Ü‹d_‹nsÜ_diù
[

681 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

682 
boxes_¿nk
 = 
tf
.
	$¿nk
(
boxes
)

683 
di¡Ü‹d_boxes_¿nk
 = 
tf
.
	$¿nk
(
di¡Ü‹d_boxes
)

684 
images_¿nk
 = 
tf
.
	$¿nk
(
images
)

685 
di¡Ü‹d_images_¿nk
 = 
tf
.
	$¿nk
(
di¡Ü‹d_images
)

687 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

688 (
boxes_¿nk_
, 
di¡Ü‹d_boxes_¿nk_
, 
images_¿nk_
,

689 
di¡Ü‹d_images_¿nk_
èğ
£ss
.
	$run
(

690 [
boxes_¿nk
, 
di¡Ü‹d_boxes_¿nk
, 
images_¿nk
,

691 
di¡Ü‹d_images_¿nk
])

692 
£lf
.
	$as£¹AÎEqu®
(
boxes_¿nk_
, 
di¡Ü‹d_boxes_¿nk_
)

693 
£lf
.
	$as£¹AÎEqu®
(
images_¿nk_
, 
di¡Ü‹d_images_¿nk_
)

695 
def
 
	$‹¡RªdomCrİImageW™hRªdomCÛfOÃ
(
£lf
):

696 
´•roûssšg_İtiÚs
 = [(
´•roûssÜ
.
nÜm®ize_image
, {

701 
	}
})]

703 
images
 = 
£lf
.
	$ü—‹Te¡Images
()

704 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

705 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

706 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images
,

707 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

708 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s
}

709 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
)

710 
images
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

712 
´•roûssšg_İtiÚs
 = [(
´•roûssÜ
.
¿ndom_üİ_image
, {

714 
	}
})]

715 
di¡Ü‹d_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
,

716 
´•roûssšg_İtiÚs
)

718 
di¡Ü‹d_images
 = 
di¡Ü‹d_‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

719 
di¡Ü‹d_boxes
 = 
di¡Ü‹d_‹nsÜ_diù
[

720 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

721 
di¡Ü‹d_Ïb–s
 = 
di¡Ü‹d_‹nsÜ_diù
[

722 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
]

723 
boxes_sh­e
 = 
tf
.
	$sh­e
(
boxes
)

724 
di¡Ü‹d_boxes_sh­e
 = 
tf
.
	$sh­e
(
di¡Ü‹d_boxes
)

725 
images_sh­e
 = 
tf
.
	$sh­e
(
images
)

726 
di¡Ü‹d_images_sh­e
 = 
tf
.
	$sh­e
(
di¡Ü‹d_images
)

728 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

729 (
boxes_sh­e_
, 
di¡Ü‹d_boxes_sh­e_
, 
images_sh­e_
,

730 
di¡Ü‹d_images_sh­e_
, 
images_
, 
di¡Ü‹d_images_
,

731 
boxes_
, 
di¡Ü‹d_boxes_
, 
Ïb–s_
, 
di¡Ü‹d_Ïb–s_
èğ
£ss
.
	$run
(

732 [
boxes_sh­e
, 
di¡Ü‹d_boxes_sh­e
, 
images_sh­e
,

733 
di¡Ü‹d_images_sh­e
, 
images
, 
di¡Ü‹d_images
,

734 
boxes
, 
di¡Ü‹d_boxes
, 
Ïb–s
, 
di¡Ü‹d_Ïb–s
])

735 
£lf
.
	$as£¹AÎEqu®
(
boxes_sh­e_
, 
di¡Ü‹d_boxes_sh­e_
)

736 
£lf
.
	$as£¹AÎEqu®
(
images_sh­e_
, 
di¡Ü‹d_images_sh­e_
)

737 
£lf
.
	$as£¹AÎClo£
(
images_
, 
di¡Ü‹d_images_
)

738 
£lf
.
	$as£¹AÎClo£
(
boxes_
, 
di¡Ü‹d_boxes_
)

739 
£lf
.
	$as£¹AÎEqu®
(
Ïb–s_
, 
di¡Ü‹d_Ïb–s_
)

741 
def
 
	$‹¡RªdomCrİW™hMockSam¶eDi¡Ü‹dBoundšgBox
(
£lf
):

742 
´•roûssšg_İtiÚs
 = [(
´•roûssÜ
.
nÜm®ize_image
, {

747 
	}
})]

749 
images
 = 
£lf
.
	$ü—‹CŞÜfulTe¡Image
()

750 
boxes
 = 
tf
.
	$cÚ¡ªt
([[0.1, 0.1, 0.8, 0.3],

752 [0.3, 0.1, 0.4, 0.7]], 
dty³
=
tf
.
æßt32
)

753 
Ïb–s
 = 
tf
.
	$cÚ¡ªt
([1, 7, 11], 
dty³
=
tf
.
št32
)

754 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images
,

755 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

756 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s
}

757 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
)

758 
images
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

760 
´•roûssšg_İtiÚs
 = [(
´•roûssÜ
.
¿ndom_üİ_image
, {
	}
})]

761 
w™h
 
	gmock
.
	g·tch
.
objeù
(

762 
tf
.
image
,

763 '§m¶e_di¡Ü‹d_boundšg_box'è
as
 
	gmock_§m¶e_di¡Ü‹d_boundšg_box
:

764 
mock_§m¶e_di¡Ü‹d_boundšg_box
.
»tuº_v®ue
 = (
tf
.
cÚ¡ªt
(

765 [6, 143, 0], 
dty³
=
tf
.
št32
), 
	gtf
.
cÚ¡ªt
(

766 [190, 237, -1], 
dty³
=
tf
.
št32
), 
	gtf
.
	$cÚ¡ªt
(

767 [[[0.03, 0.3575, 0.98, 0.95]]], 
dty³
=
tf
.
æßt32
))

769 
di¡Ü‹d_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
,

770 
´•roûssšg_İtiÚs
)

772 
di¡Ü‹d_boxes
 = 
di¡Ü‹d_‹nsÜ_diù
[

773 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

774 
di¡Ü‹d_Ïb–s
 = 
di¡Ü‹d_‹nsÜ_diù
[

775 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
]

776 
ex³ùed_boxes
 = 
tf
.
	$cÚ¡ªt
([[0.178947, 0.07173, 0.75789469, 0.66244733],

778 
dty³
=
tf
.
æßt32
)

779 
ex³ùed_Ïb–s
 = 
tf
.
	$cÚ¡ªt
([7, 11], 
dty³
=
tf
.
št32
)

781 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

782 (
di¡Ü‹d_boxes_
, 
di¡Ü‹d_Ïb–s_
,

783 
ex³ùed_boxes_
, 
ex³ùed_Ïb–s_
èğ
£ss
.
	$run
(

784 [
di¡Ü‹d_boxes
, 
di¡Ü‹d_Ïb–s
,

785 
ex³ùed_boxes
, 
ex³ùed_Ïb–s
])

786 
£lf
.
	$as£¹AÎClo£
(
di¡Ü‹d_boxes_
, 
ex³ùed_boxes_
)

787 
£lf
.
	$as£¹AÎEqu®
(
di¡Ü‹d_Ïb–s_
, 
ex³ùed_Ïb–s_
)

789 
def
 
	$‹¡SŒiùRªdomCrİImageW™hMasks
(
£lf
):

790 
image
 = 
£lf
.
	`ü—‹CŞÜfulTe¡Image
()[0]

791 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

792 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

793 
masks
 = 
tf
.
	$¿ndom_unifÜm
([2, 200, 400], 
dty³
=
tf
.
æßt32
)

794 
w™h
 
mock
.
·tch
.
	`objeù
(

795 
tf
.
image
,

797 è
as
 
mock_§m¶e_di¡Ü‹d_boundšg_box
:

798 
mock_§m¶e_di¡Ü‹d_boundšg_box
.
»tuº_v®ue
 = (

799 
tf
.
	`cÚ¡ªt
([6, 143, 0], 
dty³
ñf.
št32
),

800 
tf
.
	`cÚ¡ªt
([190, 237, -1], 
dty³
ñf.
št32
),

801 
tf
.
	$cÚ¡ªt
([[[0.03, 0.3575, 0.98, 0.95]]], 
dty³
=
tf
.
æßt32
))

802 (
Ãw_image
, 
Ãw_boxes
, 
Ãw_Ïb–s
,

803 
Ãw_masks
èğ
´•roûssÜ
.
	$_¡riù_¿ndom_üİ_image
(

804 
image
, 
boxes
, 
Ïb–s
, 
masks
=masks)

805 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

806 
Ãw_image
, 
Ãw_boxes
, 
Ãw_Ïb–s
, 
Ãw_masks
 = 
£ss
.
	$run
([

807 
Ãw_image
, 
Ãw_boxes
, 
Ãw_Ïb–s
, 
Ãw_masks
])

809 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([

812 ], 
dty³
=
Å
.
æßt32
)

813 
£lf
.
	$as£¹AÎEqu®
(
Ãw_image
.
sh­e
, [190, 237, 3])

814 
£lf
.
	$as£¹AÎEqu®
(
Ãw_masks
.
sh­e
, [2, 190, 237])

815 
£lf
.
	`as£¹AÎClo£
(

816 
Ãw_boxes
.
	`æ©‹n
(), 
ex³ùed_boxes
.
	$æ©‹n
())

818 
def
 
	$‹¡SŒiùRªdomCrİImageW™hKeypošts
(
£lf
):

819 
image
 = 
£lf
.
	`ü—‹CŞÜfulTe¡Image
()[0]

820 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

821 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

822 
keypošts
 = 
£lf
.
	$ü—‹Te¡Keypošts
()

823 
w™h
 
mock
.
·tch
.
	`objeù
(

824 
tf
.
image
,

826 è
as
 
mock_§m¶e_di¡Ü‹d_boundšg_box
:

827 
mock_§m¶e_di¡Ü‹d_boundšg_box
.
»tuº_v®ue
 = (

828 
tf
.
	`cÚ¡ªt
([6, 143, 0], 
dty³
ñf.
št32
),

829 
tf
.
	`cÚ¡ªt
([190, 237, -1], 
dty³
ñf.
št32
),

830 
tf
.
	$cÚ¡ªt
([[[0.03, 0.3575, 0.98, 0.95]]], 
dty³
=
tf
.
æßt32
))

831 (
Ãw_image
, 
Ãw_boxes
, 
Ãw_Ïb–s
,

832 
Ãw_keypošts
èğ
´•roûssÜ
.
	$_¡riù_¿ndom_üİ_image
(

833 
image
, 
boxes
, 
Ïb–s
, 
keypošts
=keypoints)

834 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

835 
Ãw_image
, 
Ãw_boxes
, 
Ãw_Ïb–s
, 
Ãw_keypošts
 = 
£ss
.
	$run
([

836 
Ãw_image
, 
Ãw_boxes
, 
Ãw_Ïb–s
, 
Ãw_keypošts
])

838 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([

841 ], 
dty³
=
Å
.
æßt32
)

842 
ex³ùed_keypošts
 = 
Å
.
	$¬¿y
([

843 [[
Å
.
Çn
,‚p.nan],

844 [
Å
.
Çn
,‚p.nan],

845 [
Å
.
Çn
,‚p.nan]],

849 ], 
dty³
=
Å
.
æßt32
)

850 
£lf
.
	$as£¹AÎEqu®
(
Ãw_image
.
sh­e
, [190, 237, 3])

851 
£lf
.
	`as£¹AÎClo£
(

852 
Ãw_boxes
.
	`æ©‹n
(), 
ex³ùed_boxes
.
	$æ©‹n
())

853 
£lf
.
	`as£¹AÎClo£
(

854 
Ãw_keypošts
.
	`æ©‹n
(), 
ex³ùed_keypošts
.
	$æ©‹n
())

856 
def
 
	$‹¡RunRªdomCrİImageW™hMasks
(
£lf
):

857 
image
 = 
£lf
.
	$ü—‹CŞÜfulTe¡Image
()

858 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

859 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

860 
masks
 = 
tf
.
	$¿ndom_unifÜm
([2, 200, 400], 
dty³
=
tf
.
æßt32
)

862 
‹nsÜ_diù
 = {

863 
f›lds
.
IÅutD©aF›lds
.
image
: image,

864 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

865 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s
,

866 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_š¡ªû_masks
: 
masks
,

867 
	}
}

869 
´•roûssÜ_¬g_m­
 = 
´•roûssÜ
.
	$g‘_deçuÉ_func_¬g_m­
(

870 
šşude_š¡ªû_masks
=
True
)

872 
´•roûssšg_İtiÚs
 = [(
´•roûssÜ
.
¿ndom_üİ_image
, {
	}
})]

874 
w™h
 
	gmock
.
	g·tch
.
objeù
(

875 
tf
.
image
,

877 è
as
 
	gmock_§m¶e_di¡Ü‹d_boundšg_box
:

878 
mock_§m¶e_di¡Ü‹d_boundšg_box
.
»tuº_v®ue
 = (

879 
tf
.
cÚ¡ªt
([6, 143, 0], 
dty³
ñf.
št32
),

880 
	gtf
.
cÚ¡ªt
([190, 237, -1], 
dty³
=
tf
.
št32
),

881 
	gtf
.
	$cÚ¡ªt
([[[0.03, 0.3575, 0.98, 0.95]]], 
dty³
=
tf
.
æßt32
))

882 
di¡Ü‹d_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(

883 
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
, 
func_¬g_m­
=
´•roûssÜ_¬g_m­
)

884 
di¡Ü‹d_image
 = 
di¡Ü‹d_‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

885 
di¡Ü‹d_boxes
 = 
di¡Ü‹d_‹nsÜ_diù
[

886 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

887 
di¡Ü‹d_Ïb–s
 = 
di¡Ü‹d_‹nsÜ_diù
[

888 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
]

889 
di¡Ü‹d_masks
 = 
di¡Ü‹d_‹nsÜ_diù
[

890 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_š¡ªû_masks
]

891 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

892 (
di¡Ü‹d_image_
, 
di¡Ü‹d_boxes_
, 
di¡Ü‹d_Ïb–s_
,

893 
di¡Ü‹d_masks_
èğ
£ss
.
	$run
(

894 [
di¡Ü‹d_image
, 
di¡Ü‹d_boxes
, 
di¡Ü‹d_Ïb–s
,

895 
di¡Ü‹d_masks
])

897 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([

900 ], 
dty³
=
Å
.
æßt32
)

901 
£lf
.
	$as£¹AÎEqu®
(
di¡Ü‹d_image_
.
sh­e
, [1, 190, 237, 3])

902 
£lf
.
	$as£¹AÎEqu®
(
di¡Ü‹d_masks_
.
sh­e
, [2, 190, 237])

903 
£lf
.
	$as£¹AÎEqu®
(
di¡Ü‹d_Ïb–s_
, [1, 2])

904 
£lf
.
	`as£¹AÎClo£
(

905 
di¡Ü‹d_boxes_
.
	`æ©‹n
(), 
ex³ùed_boxes
.
	$æ©‹n
())

907 
def
 
	$‹¡RunRªdomCrİImageW™hKeypoštsInsideCrİ
(
£lf
):

908 
image
 = 
£lf
.
	$ü—‹CŞÜfulTe¡Image
()

909 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

910 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

911 
keypošts
 = 
£lf
.
	$ü—‹Te¡KeypoštsInsideCrİ
()

913 
‹nsÜ_diù
 = {

914 
f›lds
.
IÅutD©aF›lds
.
image
: image,

915 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

916 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s
,

917 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_keypošts
: 
keypošts


918 
	}
}

920 
´•roûssÜ_¬g_m­
 = 
´•roûssÜ
.
	$g‘_deçuÉ_func_¬g_m­
(

921 
šşude_keypošts
=
True
)

923 
´•roûssšg_İtiÚs
 = [(
´•roûssÜ
.
¿ndom_üİ_image
, {
	}
})]

925 
w™h
 
	gmock
.
	g·tch
.
objeù
(

926 
tf
.
image
,

928 è
as
 
	gmock_§m¶e_di¡Ü‹d_boundšg_box
:

929 
mock_§m¶e_di¡Ü‹d_boundšg_box
.
»tuº_v®ue
 = (

930 
tf
.
cÚ¡ªt
([6, 143, 0], 
dty³
ñf.
št32
),

931 
	gtf
.
cÚ¡ªt
([190, 237, -1], 
dty³
=
tf
.
št32
),

932 
	gtf
.
	$cÚ¡ªt
([[[0.03, 0.3575, 0.98, 0.95]]], 
dty³
=
tf
.
æßt32
))

933 
di¡Ü‹d_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(

934 
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
, 
func_¬g_m­
=
´•roûssÜ_¬g_m­
)

935 
di¡Ü‹d_image
 = 
di¡Ü‹d_‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

936 
di¡Ü‹d_boxes
 = 
di¡Ü‹d_‹nsÜ_diù
[

937 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

938 
di¡Ü‹d_Ïb–s
 = 
di¡Ü‹d_‹nsÜ_diù
[

939 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
]

940 
di¡Ü‹d_keypošts
 = 
di¡Ü‹d_‹nsÜ_diù
[

941 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_keypošts
]

942 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

943 (
di¡Ü‹d_image_
, 
di¡Ü‹d_boxes_
, 
di¡Ü‹d_Ïb–s_
,

944 
di¡Ü‹d_keypošts_
èğ
£ss
.
	$run
(

945 [
di¡Ü‹d_image
, 
di¡Ü‹d_boxes
, 
di¡Ü‹d_Ïb–s
,

946 
di¡Ü‹d_keypošts
])

948 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([

951 ], 
dty³
=
Å
.
æßt32
)

952 
ex³ùed_keypošts
 = 
Å
.
	$¬¿y
([

960 
£lf
.
	$as£¹AÎEqu®
(
di¡Ü‹d_image_
.
sh­e
, [1, 190, 237, 3])

961 
£lf
.
	$as£¹AÎEqu®
(
di¡Ü‹d_Ïb–s_
, [1, 2])

962 
£lf
.
	`as£¹AÎClo£
(

963 
di¡Ü‹d_boxes_
.
	`æ©‹n
(), 
ex³ùed_boxes
.
	$æ©‹n
())

964 
£lf
.
	`as£¹AÎClo£
(

965 
di¡Ü‹d_keypošts_
.
	`æ©‹n
(), 
ex³ùed_keypošts
.
	$æ©‹n
())

967 
def
 
	$‹¡RunRªdomCrİImageW™hKeypoštsOutsideCrİ
(
£lf
):

968 
image
 = 
£lf
.
	$ü—‹CŞÜfulTe¡Image
()

969 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

970 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

971 
keypošts
 = 
£lf
.
	$ü—‹Te¡KeypoštsOutsideCrİ
()

973 
‹nsÜ_diù
 = {

974 
f›lds
.
IÅutD©aF›lds
.
image
: image,

975 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

976 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s
,

977 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_keypošts
: 
keypošts


978 
	}
}

980 
´•roûssÜ_¬g_m­
 = 
´•roûssÜ
.
	$g‘_deçuÉ_func_¬g_m­
(

981 
šşude_keypošts
=
True
)

983 
´•roûssšg_İtiÚs
 = [(
´•roûssÜ
.
¿ndom_üİ_image
, {
	}
})]

985 
w™h
 
	gmock
.
	g·tch
.
objeù
(

986 
tf
.
image
,

988 è
as
 
	gmock_§m¶e_di¡Ü‹d_boundšg_box
:

989 
mock_§m¶e_di¡Ü‹d_boundšg_box
.
»tuº_v®ue
 = (

990 
tf
.
cÚ¡ªt
([6, 143, 0], 
dty³
ñf.
št32
),

991 
	gtf
.
cÚ¡ªt
([190, 237, -1], 
dty³
=
tf
.
št32
),

992 
	gtf
.
	$cÚ¡ªt
([[[0.03, 0.3575, 0.98, 0.95]]], 
dty³
=
tf
.
æßt32
))

993 
di¡Ü‹d_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(

994 
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
, 
func_¬g_m­
=
´•roûssÜ_¬g_m­
)

995 
di¡Ü‹d_image
 = 
di¡Ü‹d_‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

996 
di¡Ü‹d_boxes
 = 
di¡Ü‹d_‹nsÜ_diù
[

997 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

998 
di¡Ü‹d_Ïb–s
 = 
di¡Ü‹d_‹nsÜ_diù
[

999 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
]

1000 
di¡Ü‹d_keypošts
 = 
di¡Ü‹d_‹nsÜ_diù
[

1001 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_keypošts
]

1002 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1003 (
di¡Ü‹d_image_
, 
di¡Ü‹d_boxes_
, 
di¡Ü‹d_Ïb–s_
,

1004 
di¡Ü‹d_keypošts_
èğ
£ss
.
	$run
(

1005 [
di¡Ü‹d_image
, 
di¡Ü‹d_boxes
, 
di¡Ü‹d_Ïb–s
,

1006 
di¡Ü‹d_keypošts
])

1008 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([

1011 ], 
dty³
=
Å
.
æßt32
)

1012 
ex³ùed_keypošts
 = 
Å
.
	$¬¿y
([

1013 [[
Å
.
Çn
,‚p.nan],

1014 [
Å
.
Çn
,‚p.nan],

1015 [
Å
.
Çn
,‚p.nan]],

1016 [[
Å
.
Çn
,‚p.nan],

1017 [
Å
.
Çn
,‚p.nan],

1018 [
Å
.
Çn
,‚p.nan]],

1020 
£lf
.
	$as£¹AÎEqu®
(
di¡Ü‹d_image_
.
sh­e
, [1, 190, 237, 3])

1021 
£lf
.
	$as£¹AÎEqu®
(
di¡Ü‹d_Ïb–s_
, [1, 2])

1022 
£lf
.
	`as£¹AÎClo£
(

1023 
di¡Ü‹d_boxes_
.
	`æ©‹n
(), 
ex³ùed_boxes
.
	$æ©‹n
())

1024 
£lf
.
	`as£¹AÎClo£
(

1025 
di¡Ü‹d_keypošts_
.
	`æ©‹n
(), 
ex³ùed_keypošts
.
	$æ©‹n
())

1027 
def
 
	$‹¡RunR‘ašBoxesAboveTh»shŞd
(
£lf
):

1028 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

1029 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

1030 
Ïb–_scÜes
 = 
£lf
.
	$ü—‹Te¡Lab–ScÜes
()

1032 
‹nsÜ_diù
 = {

1033 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

1034 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s
,

1035 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_Ïb–_scÜes
: 
Ïb–_scÜes


1036 
	}
}

1038 
´•roûssšg_İtiÚs
 = [

1039 (
´•roûssÜ
.
»š_boxes_above_th»shŞd
, {'threshold': 0.6})

1042 
»šed_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(

1043 
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
)

1044 
»šed_boxes
 = 
»šed_‹nsÜ_diù
[

1045 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

1046 
»šed_Ïb–s
 = 
»šed_‹nsÜ_diù
[

1047 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
]

1048 
»šed_Ïb–_scÜes
 = 
»šed_‹nsÜ_diù
[

1049 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_Ïb–_scÜes
]

1051 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1052 (
»šed_boxes_
, 
»šed_Ïb–s_
,

1053 
»šed_Ïb–_scÜes_
, 
ex³ùed_»šed_boxes_
,

1054 
ex³ùed_»šed_Ïb–s_
, 
ex³ùed_»šed_Ïb–_scÜes_
èğ
£ss
.
	`run
(

1055 [
»šed_boxes
, 
»šed_Ïb–s
, 
»šed_Ïb–_scÜes
,

1056 
£lf
.
	`ex³ùedBoxesAá”Th»shŞdšg
(),

1057 
£lf
.
	`ex³ùedLab–sAá”Th»shŞdšg
(),

1058 
£lf
.
	`ex³ùedLab–ScÜesAá”Th»shŞdšg
()])

1060 
£lf
.
	$as£¹AÎClo£
(
»šed_boxes_
, 
ex³ùed_»šed_boxes_
)

1061 
£lf
.
	$as£¹AÎClo£
(
»šed_Ïb–s_
, 
ex³ùed_»šed_Ïb–s_
)

1062 
£lf
.
	$as£¹AÎClo£
(

1063 
»šed_Ïb–_scÜes_
, 
ex³ùed_»šed_Ïb–_scÜes_
)

1065 
def
 
	$‹¡RunR‘ašBoxesAboveTh»shŞdW™hMasks
(
£lf
):

1066 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

1067 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

1068 
Ïb–_scÜes
 = 
£lf
.
	$ü—‹Te¡Lab–ScÜes
()

1069 
masks
 = 
£lf
.
	$ü—‹Te¡Masks
()

1071 
‹nsÜ_diù
 = {

1072 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

1073 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s
,

1074 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_Ïb–_scÜes
: 
Ïb–_scÜes
,

1075 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_š¡ªû_masks
: 
masks


1076 
	}
}

1078 
´•roûssÜ_¬g_m­
 = 
´•roûssÜ
.
	$g‘_deçuÉ_func_¬g_m­
(

1079 
šşude_š¡ªû_masks
=
True
)

1081 
´•roûssšg_İtiÚs
 = [

1082 (
´•roûssÜ
.
»š_boxes_above_th»shŞd
, {'th»shŞd': 0.6
	}
})

1085 
»šed_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(

1086 
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
, 
func_¬g_m­
=
´•roûssÜ_¬g_m­
)

1087 
»šed_masks
 = 
»šed_‹nsÜ_diù
[

1088 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_š¡ªû_masks
]

1090 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1091 (
»šed_masks_
, 
ex³ùed_masks_
èğ
£ss
.
	`run
(

1092 [
»šed_masks
,

1093 
£lf
.
	`ex³ùedMasksAá”Th»shŞdšg
()])

1094 
£lf
.
	$as£¹AÎClo£
(
»šed_masks_
, 
ex³ùed_masks_
)

1096 
def
 
	$‹¡RunR‘ašBoxesAboveTh»shŞdW™hKeypošts
(
£lf
):

1097 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

1098 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

1099 
Ïb–_scÜes
 = 
£lf
.
	$ü—‹Te¡Lab–ScÜes
()

1100 
keypošts
 = 
£lf
.
	$ü—‹Te¡Keypošts
()

1102 
‹nsÜ_diù
 = {

1103 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

1104 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s
,

1105 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_Ïb–_scÜes
: 
Ïb–_scÜes
,

1106 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_keypošts
: 
keypošts


1107 
	}
}

1109 
´•roûssÜ_¬g_m­
 = 
´•roûssÜ
.
	$g‘_deçuÉ_func_¬g_m­
(

1110 
šşude_keypošts
=
True
)

1112 
´•roûssšg_İtiÚs
 = [

1113 (
´•roûssÜ
.
»š_boxes_above_th»shŞd
, {'th»shŞd': 0.6
	}
})

1116 
»šed_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(

1117 
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
, 
func_¬g_m­
=
´•roûssÜ_¬g_m­
)

1118 
»šed_keypošts
 = 
»šed_‹nsÜ_diù
[

1119 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_keypošts
]

1121 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1122 (
»šed_keypošts_
, 
ex³ùed_keypošts_
èğ
£ss
.
	`run
(

1123 [
»šed_keypošts
,

1124 
£lf
.
	`ex³ùedKeypoštsAá”Th»shŞdšg
()])

1125 
£lf
.
	$as£¹AÎClo£
(
»šed_keypošts_
, 
ex³ùed_keypošts_
)

1127 
def
 
	$‹¡RunRªdomCrİToA¥eùR©ioW™hMasks
(
£lf
):

1128 
image
 = 
£lf
.
	$ü—‹CŞÜfulTe¡Image
()

1129 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

1130 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

1131 
masks
 = 
tf
.
	$¿ndom_unifÜm
([2, 200, 400], 
dty³
=
tf
.
æßt32
)

1133 
‹nsÜ_diù
 = {

1134 
f›lds
.
IÅutD©aF›lds
.
image
: image,

1135 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

1136 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s
,

1137 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_š¡ªû_masks
: 
masks


1138 
	}
}

1140 
´•roûssÜ_¬g_m­
 = 
´•roûssÜ
.
	$g‘_deçuÉ_func_¬g_m­
(

1141 
šşude_š¡ªû_masks
=
True
)

1143 
´•roûssšg_İtiÚs
 = [(
´•roûssÜ
.
¿ndom_üİ_to_a¥eù_¿tio
, {
	}
})]

1145 
w™h
 
	gmock
.
	g·tch
.
objeù
(
´•roûssÜ
,

1146 '_¿ndom_š‹g”'è
as
 
	gmock_¿ndom_š‹g”
:

1147 
mock_¿ndom_š‹g”
.
»tuº_v®ue
 = 
tf
.
	$cÚ¡ªt
(0, 
dty³
=
tf
.
št32
)

1148 
di¡Ü‹d_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(

1149 
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
, 
func_¬g_m­
=
´•roûssÜ_¬g_m­
)

1150 
di¡Ü‹d_image
 = 
di¡Ü‹d_‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

1151 
di¡Ü‹d_boxes
 = 
di¡Ü‹d_‹nsÜ_diù
[

1152 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

1153 
di¡Ü‹d_Ïb–s
 = 
di¡Ü‹d_‹nsÜ_diù
[

1154 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
]

1155 
di¡Ü‹d_masks
 = 
di¡Ü‹d_‹nsÜ_diù
[

1156 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_š¡ªû_masks
]

1157 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1158 (
di¡Ü‹d_image_
, 
di¡Ü‹d_boxes_
, 
di¡Ü‹d_Ïb–s_
,

1159 
di¡Ü‹d_masks_
èğ
£ss
.
	$run
([

1160 
di¡Ü‹d_image
, 
di¡Ü‹d_boxes
, 
di¡Ü‹d_Ïb–s
, 
di¡Ü‹d_masks


1163 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([0.0, 0.5, 0.75, 1.0], 
dty³
=
Å
.
æßt32
)

1164 
£lf
.
	$as£¹AÎEqu®
(
di¡Ü‹d_image_
.
sh­e
, [1, 200, 200, 3])

1165 
£lf
.
	$as£¹AÎEqu®
(
di¡Ü‹d_Ïb–s_
, [1])

1166 
£lf
.
	`as£¹AÎClo£
(
di¡Ü‹d_boxes_
.
	`æ©‹n
(),

1167 
ex³ùed_boxes
.
	$æ©‹n
())

1168 
£lf
.
	$as£¹AÎEqu®
(
di¡Ü‹d_masks_
.
sh­e
, [1, 200, 200])

1170 
def
 
	$‹¡RunRªdomCrİToA¥eùR©ioW™hKeypošts
(
£lf
):

1171 
image
 = 
£lf
.
	$ü—‹CŞÜfulTe¡Image
()

1172 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

1173 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

1174 
keypošts
 = 
£lf
.
	$ü—‹Te¡Keypošts
()

1176 
‹nsÜ_diù
 = {

1177 
f›lds
.
IÅutD©aF›lds
.
image
: image,

1178 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

1179 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s
,

1180 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_keypošts
: 
keypošts


1181 
	}
}

1183 
´•roûssÜ_¬g_m­
 = 
´•roûssÜ
.
	$g‘_deçuÉ_func_¬g_m­
(

1184 
šşude_keypošts
=
True
)

1186 
´•roûssšg_İtiÚs
 = [(
´•roûssÜ
.
¿ndom_üİ_to_a¥eù_¿tio
, {
	}
})]

1188 
w™h
 
	gmock
.
	g·tch
.
objeù
(
´•roûssÜ
,

1189 '_¿ndom_š‹g”'è
as
 
	gmock_¿ndom_š‹g”
:

1190 
mock_¿ndom_š‹g”
.
»tuº_v®ue
 = 
tf
.
	$cÚ¡ªt
(0, 
dty³
=
tf
.
št32
)

1191 
di¡Ü‹d_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(

1192 
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
, 
func_¬g_m­
=
´•roûssÜ_¬g_m­
)

1193 
di¡Ü‹d_image
 = 
di¡Ü‹d_‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

1194 
di¡Ü‹d_boxes
 = 
di¡Ü‹d_‹nsÜ_diù
[

1195 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

1196 
di¡Ü‹d_Ïb–s
 = 
di¡Ü‹d_‹nsÜ_diù
[

1197 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
]

1198 
di¡Ü‹d_keypošts
 = 
di¡Ü‹d_‹nsÜ_diù
[

1199 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_keypošts
]

1200 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1201 (
di¡Ü‹d_image_
, 
di¡Ü‹d_boxes_
, 
di¡Ü‹d_Ïb–s_
,

1202 
di¡Ü‹d_keypošts_
èğ
£ss
.
	$run
([

1203 
di¡Ü‹d_image
, 
di¡Ü‹d_boxes
, 
di¡Ü‹d_Ïb–s
,

1204 
di¡Ü‹d_keypošts


1207 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([0.0, 0.5, 0.75, 1.0], 
dty³
=
Å
.
æßt32
)

1208 
ex³ùed_keypošts
 = 
Å
.
	$¬¿y
(

1209 [[0.1, 0.2], [0.2, 0.4], [0.3, 0.6]], 
dty³
=
Å
.
æßt32
)

1210 
£lf
.
	$as£¹AÎEqu®
(
di¡Ü‹d_image_
.
sh­e
, [1, 200, 200, 3])

1211 
£lf
.
	$as£¹AÎEqu®
(
di¡Ü‹d_Ïb–s_
, [1])

1212 
£lf
.
	`as£¹AÎClo£
(
di¡Ü‹d_boxes_
.
	`æ©‹n
(),

1213 
ex³ùed_boxes
.
	$æ©‹n
())

1214 
£lf
.
	`as£¹AÎClo£
(
di¡Ü‹d_keypošts_
.
	`æ©‹n
(),

1215 
ex³ùed_keypošts
.
	$æ©‹n
())

1217 
def
 
	$‹¡RªdomPadImage
(
£lf
):

1218 
´•roûssšg_İtiÚs
 = [(
´•roûssÜ
.
nÜm®ize_image
, {

1223 
	}
})]

1225 
images
 = 
£lf
.
	$ü—‹Te¡Images
()

1226 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

1227 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

1228 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images
,

1229 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

1230 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s
}

1231 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
)

1232 
images
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

1234 
´•roûssšg_İtiÚs
 = [(
´•roûssÜ
.
¿ndom_·d_image
, {
	}
})]

1235 
	g·dded_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
,

1236 
´•roûssšg_İtiÚs
)

1238 
·dded_images
 = 
·dded_‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

1239 
·dded_boxes
 = 
·dded_‹nsÜ_diù
[

1240 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

1241 
boxes_sh­e
 = 
tf
.
	$sh­e
(
boxes
)

1242 
·dded_boxes_sh­e
 = 
tf
.
	$sh­e
(
·dded_boxes
)

1243 
images_sh­e
 = 
tf
.
	$sh­e
(
images
)

1244 
·dded_images_sh­e
 = 
tf
.
	$sh­e
(
·dded_images
)

1246 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1247 (
boxes_sh­e_
, 
·dded_boxes_sh­e_
, 
images_sh­e_
,

1248 
·dded_images_sh­e_
, 
boxes_
, 
·dded_boxes_
èğ
£ss
.
	$run
(

1249 [
boxes_sh­e
, 
·dded_boxes_sh­e
, 
images_sh­e
,

1250 
·dded_images_sh­e
, 
boxes
, 
·dded_boxes
])

1251 
£lf
.
	$as£¹AÎEqu®
(
boxes_sh­e_
, 
·dded_boxes_sh­e_
)

1252 
£lf
.
	`as£¹True
((
images_sh­e_
[1] >ğ
·dded_images_sh­e_
[1] * 0.5).
®l
)

1253 
£lf
.
	`as£¹True
((
images_sh­e_
[2] >ğ
·dded_images_sh­e_
[2] * 0.5).
®l
)

1254 
£lf
.
	`as£¹True
((
images_sh­e_
[1] <ğ
·dded_images_sh­e_
[1]).
®l
)

1255 
£lf
.
	`as£¹True
((
images_sh­e_
[2] <ğ
·dded_images_sh­e_
[2]).
®l
)

1256 
£lf
.
	`as£¹True
(
Å
.
	`®l
((
boxes_
[:, 2] - boxes_[:, 0]) >= (

1257 
·dded_boxes_
[:, 2] -…added_boxes_[:, 0])))

1258 
£lf
.
	`as£¹True
(
Å
.
	`®l
((
boxes_
[:, 3] - boxes_[:, 1]) >= (

1259 
·dded_boxes_
[:, 3] -…added_boxes_[:, 1])))

1261 
def
 
	$‹¡RªdomCrİPadImageW™hRªdomCÛfOÃ
(
£lf
):

1262 
´•roûssšg_İtiÚs
 = [(
´•roûssÜ
.
nÜm®ize_image
, {

1267 
	}
})]

1269 
images
 = 
£lf
.
	$ü—‹Te¡Images
()

1270 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

1271 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

1272 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images
,

1273 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

1274 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s
}

1275 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
)

1276 
images
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

1278 
´•roûssšg_İtiÚs
 = [(
´•roûssÜ
.
¿ndom_üİ_·d_image
, {

1280 
	}
})]

1281 
·dded_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
,

1282 
´•roûssšg_İtiÚs
)

1284 
·dded_images
 = 
·dded_‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

1285 
·dded_boxes
 = 
·dded_‹nsÜ_diù
[

1286 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

1287 
boxes_sh­e
 = 
tf
.
	$sh­e
(
boxes
)

1288 
·dded_boxes_sh­e
 = 
tf
.
	$sh­e
(
·dded_boxes
)

1289 
images_sh­e
 = 
tf
.
	$sh­e
(
images
)

1290 
·dded_images_sh­e
 = 
tf
.
	$sh­e
(
·dded_images
)

1292 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1293 (
boxes_sh­e_
, 
·dded_boxes_sh­e_
, 
images_sh­e_
,

1294 
·dded_images_sh­e_
, 
boxes_
, 
·dded_boxes_
èğ
£ss
.
	$run
(

1295 [
boxes_sh­e
, 
·dded_boxes_sh­e
, 
images_sh­e
,

1296 
·dded_images_sh­e
, 
boxes
, 
·dded_boxes
])

1297 
£lf
.
	$as£¹AÎEqu®
(
boxes_sh­e_
, 
·dded_boxes_sh­e_
)

1298 
£lf
.
	`as£¹True
((
images_sh­e_
[1] >ğ
·dded_images_sh­e_
[1] * 0.5).
®l
)

1299 
£lf
.
	`as£¹True
((
images_sh­e_
[2] >ğ
·dded_images_sh­e_
[2] * 0.5).
®l
)

1300 
£lf
.
	`as£¹True
((
images_sh­e_
[1] <ğ
·dded_images_sh­e_
[1]).
®l
)

1301 
£lf
.
	`as£¹True
((
images_sh­e_
[2] <ğ
·dded_images_sh­e_
[2]).
®l
)

1302 
£lf
.
	`as£¹True
(
Å
.
	`®l
((
boxes_
[:, 2] - boxes_[:, 0]) >= (

1303 
·dded_boxes_
[:, 2] -…added_boxes_[:, 0])))

1304 
£lf
.
	`as£¹True
(
Å
.
	`®l
((
boxes_
[:, 3] - boxes_[:, 1]) >= (

1305 
·dded_boxes_
[:, 3] -…added_boxes_[:, 1])))

1307 
def
 
	$‹¡RªdomCrİToA¥eùR©io
(
£lf
):

1308 
´•roûssšg_İtiÚs
 = [(
´•roûssÜ
.
nÜm®ize_image
, {

1313 
	}
})]

1315 
images
 = 
£lf
.
	$ü—‹Te¡Images
()

1316 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

1317 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

1318 
‹nsÜ_diù
 = {

1319 
f›lds
.
IÅutD©aF›lds
.
image
: 
images
,

1320 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

1321 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s


1322 
	}
}

1323 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
)

1324 
images
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

1326 
´•roûssšg_İtiÚs
 = [(
´•roûssÜ
.
¿ndom_üİ_to_a¥eù_¿tio
, {

1328 
	}
})]

1329 
üİ³d_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
,

1330 
´•roûssšg_İtiÚs
)

1332 
üİ³d_images
 = 
üİ³d_‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

1333 
üİ³d_boxes
 = 
üİ³d_‹nsÜ_diù
[

1334 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

1335 
boxes_sh­e
 = 
tf
.
	$sh­e
(
boxes
)

1336 
üİ³d_boxes_sh­e
 = 
tf
.
	$sh­e
(
üİ³d_boxes
)

1337 
images_sh­e
 = 
tf
.
	$sh­e
(
images
)

1338 
üİ³d_images_sh­e
 = 
tf
.
	$sh­e
(
üİ³d_images
)

1340 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1341 (
boxes_sh­e_
, 
üİ³d_boxes_sh­e_
, 
images_sh­e_
,

1342 
üİ³d_images_sh­e_
èğ
£ss
.
	$run
([

1343 
boxes_sh­e
, 
üİ³d_boxes_sh­e
, 
images_sh­e
, 
üİ³d_images_sh­e


1345 
£lf
.
	$as£¹AÎEqu®
(
boxes_sh­e_
, 
üİ³d_boxes_sh­e_
)

1346 
£lf
.
	$as£¹Equ®
(
images_sh­e_
[1], 
üİ³d_images_sh­e_
[1] * 2)

1347 
£lf
.
	$as£¹Equ®
(
images_sh­e_
[2], 
üİ³d_images_sh­e_
[2])

1349 
def
 
	$‹¡RªdomBÏckP©ches
(
£lf
):

1350 
´•roûssšg_İtiÚs
 = []

1351 
´•roûssšg_İtiÚs
.
	`­³nd
((
´•roûssÜ
.
nÜm®ize_image
, {

1356 
	}
}))

1357 
´•roûssšg_İtiÚs
.
­³nd
((
´•roûssÜ
.
¿ndom_bÏck_·tches
, {

1360 
images
 = 
£lf
.
	$ü—‹Te¡Images
()

1361 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images
}

1362 
bÏcked_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
,

1363 
´•roûssšg_İtiÚs
)

1364 
bÏcked_images
 = 
bÏcked_‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

1365 
images_sh­e
 = 
tf
.
	$sh­e
(
images
)

1366 
bÏcked_images_sh­e
 = 
tf
.
	$sh­e
(
bÏcked_images
)

1368 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1369 (
images_sh­e_
, 
bÏcked_images_sh­e_
èğ
£ss
.
	$run
(

1370 [
images_sh­e
, 
bÏcked_images_sh­e
])

1371 
£lf
.
	$as£¹AÎEqu®
(
images_sh­e_
, 
bÏcked_images_sh­e_
)

1373 
def
 
	$‹¡RªdomResizeM‘hod
(
£lf
):

1374 
´•roûssšg_İtiÚs
 = []

1375 
´•roûssšg_İtiÚs
.
	`­³nd
((
´•roûssÜ
.
nÜm®ize_image
, {

1380 
	}
}))

1381 
´•roûssšg_İtiÚs
.
­³nd
((
´•roûssÜ
.
¿ndom_»size_m‘hod
, {

1384 
	gimages
 = 
£lf
.
	$ü—‹Te¡Images
()

1385 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images
}

1386 
»sized_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
,

1387 
´•roûssšg_İtiÚs
)

1388 
»sized_images
 = 
»sized_‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

1389 
»sized_images_sh­e
 = 
tf
.
	$sh­e
(
»sized_images
)

1390 
ex³ùed_images_sh­e
 = 
tf
.
	$cÚ¡ªt
([1, 75, 150, 3], 
dty³
=
tf
.
št32
)

1392 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1393 (
ex³ùed_images_sh­e_
, 
»sized_images_sh­e_
èğ
£ss
.
	$run
(

1394 [
ex³ùed_images_sh­e
, 
»sized_images_sh­e
])

1395 
£lf
.
	$as£¹AÎEqu®
(
ex³ùed_images_sh­e_
,

1396 
»sized_images_sh­e_
)

1398 
def
 
	$‹¡ResizeToRªgeP»£rvesSticS·tŸlSh­e
(
£lf
):

1400 
š_sh­e_li¡
 = [[60, 40, 3], [15, 30, 3], [15, 50, 3]]

1401 
mš_dim
 = 50

1402 
max_dim
 = 100

1403 
ex³ùed_sh­e_li¡
 = [[75, 50, 3], [50, 100, 3], [30, 100, 3]]

1405 
š_sh­e
, 
ex³ùed_sh­e
 
š
 
	$z
(
š_sh­e_li¡
, 
ex³ùed_sh­e_li¡
):

1406 
š_image
 = 
tf
.
	$¿ndom_unifÜm
(
š_sh­e
)

1407 
out_image
 = 
´•roûssÜ
.
	$»size_to_¿nge
(

1408 
š_image
, 
mš_dim’siÚ
=
mš_dim
, 
max_dim’siÚ
=
max_dim
)

1409 
£lf
.
	`as£¹AÎEqu®
(
out_image
.
	`g‘_sh­e
().
	`as_li¡
(), 
ex³ùed_sh­e
)

1411 
def
 
	$‹¡ResizeToRªgeW™hDyÇmicS·tŸlSh­e
(
£lf
):

1413 
š_sh­e_li¡
 = [[60, 40, 3], [15, 30, 3], [15, 50, 3]]

1414 
mš_dim
 = 50

1415 
max_dim
 = 100

1416 
ex³ùed_sh­e_li¡
 = [[75, 50, 3], [50, 100, 3], [30, 100, 3]]

1418 
š_sh­e
, 
ex³ùed_sh­e
 
š
 
	$z
(
š_sh­e_li¡
, 
ex³ùed_sh­e_li¡
):

1419 
š_image
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
, None, 3))

1420 
out_image
 = 
´•roûssÜ
.
	$»size_to_¿nge
(

1421 
š_image
, 
mš_dim’siÚ
=
mš_dim
, 
max_dim’siÚ
=
max_dim
)

1422 
out_image_sh­e
 = 
tf
.
	$sh­e
(
out_image
)

1423 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1424 
out_image_sh­e
 = 
£ss
.
	`run
(out_image_shape,

1425 
ãed_diù
={
š_image
:

1426 
Å
.
¿ndom
.
	`¿ndn
(*
š_sh­e
)
	}
})

1427 
£lf
.
	$as£¹AÎEqu®
(
out_image_sh­e
, 
ex³ùed_sh­e
)

1429 
def
 
	$‹¡ResizeToRªgeW™hMasksP»£rvesSticS·tŸlSh­e
(
£lf
):

1431 
š_image_sh­e_li¡
 = [[60, 40, 3], [15, 30, 3]]

1432 
š_masks_sh­e_li¡
 = [[15, 60, 40], [10, 15, 30]]

1433 
mš_dim
 = 50

1434 
max_dim
 = 100

1435 
ex³ùed_image_sh­e_li¡
 = [[75, 50, 3], [50, 100, 3]]

1436 
ex³ùed_masks_sh­e_li¡
 = [[15, 75, 50], [10, 50, 100]]

1438 
š_image_sh­e
, 
ex³ùed_image_sh­e
, 
š_masks_sh­e
,

1439 
ex³ùed_mask_sh­e
è
š
 
	$z
(
š_image_sh­e_li¡
,

1440 
ex³ùed_image_sh­e_li¡
,

1441 
š_masks_sh­e_li¡
,

1442 
ex³ùed_masks_sh­e_li¡
):

1443 
š_image
 = 
tf
.
	$¿ndom_unifÜm
(
š_image_sh­e
)

1444 
š_masks
 = 
tf
.
	$¿ndom_unifÜm
(
š_masks_sh­e
)

1445 
out_image
, 
out_masks
 = 
´•roûssÜ
.
	$»size_to_¿nge
(

1446 
š_image
, 
š_masks
, 
mš_dim’siÚ
=
mš_dim
, 
max_dim’siÚ
=
max_dim
)

1447 
£lf
.
	`as£¹AÎEqu®
(
out_masks
.
	`g‘_sh­e
().
	`as_li¡
(), 
ex³ùed_mask_sh­e
)

1448 
£lf
.
	`as£¹AÎEqu®
(
out_image
.
	`g‘_sh­e
().
	`as_li¡
(), 
ex³ùed_image_sh­e
)

1450 
def
 
	$‹¡ResizeToRªgeW™hMasksAndDyÇmicS·tŸlSh­e
(
£lf
):

1452 
š_image_sh­e_li¡
 = [[60, 40, 3], [15, 30, 3]]

1453 
š_masks_sh­e_li¡
 = [[15, 60, 40], [10, 15, 30]]

1454 
mš_dim
 = 50

1455 
max_dim
 = 100

1456 
ex³ùed_image_sh­e_li¡
 = [[75, 50, 3], [50, 100, 3]]

1457 
ex³ùed_masks_sh­e_li¡
 = [[15, 75, 50], [10, 50, 100]]

1459 
š_image_sh­e
, 
ex³ùed_image_sh­e
, 
š_masks_sh­e
,

1460 
ex³ùed_mask_sh­e
è
š
 
	$z
(
š_image_sh­e_li¡
,

1461 
ex³ùed_image_sh­e_li¡
,

1462 
š_masks_sh­e_li¡
,

1463 
ex³ùed_masks_sh­e_li¡
):

1464 
š_image
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
, None, 3))

1465 
š_masks
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
, None, None))

1466 
š_masks
 = 
tf
.
	$¿ndom_unifÜm
(
š_masks_sh­e
)

1467 
out_image
, 
out_masks
 = 
´•roûssÜ
.
	$»size_to_¿nge
(

1468 
š_image
, 
š_masks
, 
mš_dim’siÚ
=
mš_dim
, 
max_dim’siÚ
=
max_dim
)

1469 
out_image_sh­e
 = 
tf
.
	$sh­e
(
out_image
)

1470 
out_masks_sh­e
 = 
tf
.
	$sh­e
(
out_masks
)

1472 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1473 
out_image_sh­e
, 
out_masks_sh­e
 = 
£ss
.
	`run
(

1474 [
out_image_sh­e
, 
out_masks_sh­e
],

1475 
ãed_diù
={

1476 
š_image
: 
Å
.
¿ndom
.
	`¿ndn
(*
š_image_sh­e
),

1477 
š_masks
: 
Å
.
¿ndom
.
	`¿ndn
(*
š_masks_sh­e
)

1478 
	}
})

1479 
£lf
.
	$as£¹AÎEqu®
(
out_image_sh­e
, 
ex³ùed_image_sh­e
)

1480 
£lf
.
	$as£¹AÎEqu®
(
out_masks_sh­e
, 
ex³ùed_mask_sh­e
)

1482 
def
 
	$‹¡ResizeToRªgeW™hIn¡ªûMasksT’sÜOfSizeZ”o
(
£lf
):

1484 
š_image_sh­e_li¡
 = [[60, 40, 3], [15, 30, 3]]

1485 
š_masks_sh­e_li¡
 = [[0, 60, 40], [0, 15, 30]]

1486 
height
 = 50

1487 
width
 = 100

1488 
ex³ùed_image_sh­e_li¡
 = [[50, 100, 3], [50, 100, 3]]

1489 
ex³ùed_masks_sh­e_li¡
 = [[0, 50, 100], [0, 50, 100]]

1491 
š_image_sh­e
, 
ex³ùed_image_sh­e
, 
š_masks_sh­e
,

1492 
ex³ùed_mask_sh­e
è
š
 
	$z
(
š_image_sh­e_li¡
,

1493 
ex³ùed_image_sh­e_li¡
,

1494 
š_masks_sh­e_li¡
,

1495 
ex³ùed_masks_sh­e_li¡
):

1496 
š_image
 = 
tf
.
	$¿ndom_unifÜm
(
š_image_sh­e
)

1497 
š_masks
 = 
tf
.
	$¿ndom_unifÜm
(
š_masks_sh­e
)

1498 
out_image
, 
out_masks
 = 
´•roûssÜ
.
	$»size_image
(

1499 
š_image
, 
š_masks
, 
Ãw_height
=
height
, 
Ãw_width
=
width
)

1500 
out_image_sh­e
 = 
tf
.
	$sh­e
(
out_image
)

1501 
out_masks_sh­e
 = 
tf
.
	$sh­e
(
out_masks
)

1503 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1504 
out_image_sh­e
, 
out_masks_sh­e
 = 
£ss
.
	$run
(

1505 [
out_image_sh­e
, 
out_masks_sh­e
])

1506 
£lf
.
	$as£¹AÎEqu®
(
out_image_sh­e
, 
ex³ùed_image_sh­e
)

1507 
£lf
.
	$as£¹AÎEqu®
(
out_masks_sh­e
, 
ex³ùed_mask_sh­e
)

1509 
def
 
	$‹¡ResizeToRªge4DImageT’sÜ
(
£lf
):

1510 
image
 = 
tf
.
	$¿ndom_unifÜm
([1, 200, 300, 3])

1511 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

1512 
´•roûssÜ
.
	$»size_to_¿nge
(
image
, 500, 600)

1514 
def
 
	$‹¡ResizeToRªgeSameMšMax
(
£lf
):

1516 
š_sh­e_li¡
 = [[312, 312, 3], [299, 299, 3]]

1517 
mš_dim
 = 320

1518 
max_dim
 = 320

1519 
ex³ùed_sh­e_li¡
 = [[320, 320, 3], [320, 320, 3]]

1521 
š_sh­e
, 
ex³ùed_sh­e
 
š
 
	$z
(
š_sh­e_li¡
, 
ex³ùed_sh­e_li¡
):

1522 
š_image
 = 
tf
.
	$¿ndom_unifÜm
(
š_sh­e
)

1523 
out_image
 = 
´•roûssÜ
.
	$»size_to_¿nge
(

1524 
š_image
, 
mš_dim’siÚ
=
mš_dim
, 
max_dim’siÚ
=
max_dim
)

1525 
out_image_sh­e
 = 
tf
.
	$sh­e
(
out_image
)

1527 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1528 
out_image_sh­e
 = 
£ss
.
	$run
(
out_image_sh­e
)

1529 
£lf
.
	$as£¹AÎEqu®
(
out_image_sh­e
, 
ex³ùed_sh­e
)

1531 
def
 
	$‹¡SÿËBoxesToPix–CoÜdš©es
(
£lf
):

1533 
š_sh­e
 = [60, 40, 3]

1534 
š_boxes
 = [[0.1, 0.2, 0.4, 0.6],

1537 
ex³ùed_boxes
 = [[6., 8., 24., 24.],

1540 
š_image
 = 
tf
.
	$¿ndom_unifÜm
(
š_sh­e
)

1541 
š_boxes
 = 
tf
.
	$cÚ¡ªt
(
š_boxes
)

1542 
_
, 
out_boxes
 = 
´•roûssÜ
.
	$sÿË_boxes_to_pix–_coÜdš©es
(

1543 
š_image
, 
boxes
=
š_boxes
)

1544 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1545 
out_boxes
 = 
£ss
.
	$run
(
out_boxes
)

1546 
£lf
.
	$as£¹AÎClo£
(
out_boxes
, 
ex³ùed_boxes
)

1548 
def
 
	$‹¡SÿËBoxesToPix–CoÜdš©esW™hKeypošts
(
£lf
):

1550 
š_sh­e
 = [60, 40, 3]

1551 
š_boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

1552 
š_keypošts
 = 
£lf
.
	$ü—‹Te¡Keypošts
()

1554 
ex³ùed_boxes
 = [[0., 10., 45., 40.],

1556 
ex³ùed_keypošts
 = [

1561 
š_image
 = 
tf
.
	$¿ndom_unifÜm
(
š_sh­e
)

1562 
_
, 
out_boxes
, 
out_keypošts
 = 
´•roûssÜ
.
	$sÿË_boxes_to_pix–_coÜdš©es
(

1563 
š_image
, 
boxes
=
š_boxes
, 
keypošts
=
š_keypošts
)

1564 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1565 
out_boxes_
, 
out_keypošts_
 = 
£ss
.
	$run
([
out_boxes
, 
out_keypošts
])

1566 
£lf
.
	$as£¹AÎClo£
(
out_boxes_
, 
ex³ùed_boxes
)

1567 
£lf
.
	$as£¹AÎClo£
(
out_keypošts_
, 
ex³ùed_keypošts
)

1569 
def
 
	$‹¡SubŒaùChªÃlM—n
(
£lf
):

1571 
w™h
 
£lf
.
	$‹¡_£ssiÚ
():

1572 
image
 = 
tf
.
	`z”os
((240, 320, 3))

1573 
m—ns
 = [1, 2, 3]

1574 
aùu®
 = 
´•roûssÜ
.
	$subŒaù_chªÃl_m—n
(
image
, 
m—ns
=means)

1575 
aùu®
 =‡ùu®.
	$ev®
()

1577 
£lf
.
	`as£¹True
((
aùu®
[:, :, 0] =ğ-1).
	$®l
())

1578 
£lf
.
	`as£¹True
((
aùu®
[:, :, 1] =ğ-2).
	$®l
())

1579 
£lf
.
	`as£¹True
((
aùu®
[:, :, 2] =ğ-3).
	$®l
())

1581 
def
 
	$‹¡OÃHÙEncodšg
(
£lf
):

1583 
w™h
 
£lf
.
	$‹¡_£ssiÚ
():

1584 
Ïb–s
 = 
tf
.
	$cÚ¡ªt
([1, 4, 2], 
dty³
=
tf
.
št32
)

1585 
Úe_hÙ
 = 
´•roûssÜ
.
	$Úe_hÙ_’codšg
(
Ïb–s
, 
num_şas£s
=5)

1586 
Úe_hÙ
 = oÃ_hÙ.
	$ev®
()

1588 
£lf
.
	$as£¹AÎEqu®
([0, 1, 1, 0, 1], 
Úe_hÙ
)

1590 
def
 
	$‹¡SSDRªdomCrİ
(
£lf
):

1591 
´•roûssšg_İtiÚs
 = [

1592 (
´•roûssÜ
.
nÜm®ize_image
, {

1597 
	}
}),

1598 (
´•roûssÜ
.
ssd_¿ndom_üİ
, {})]

1599 
	gimages
 = 
£lf
.
	$ü—‹Te¡Images
()

1600 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

1601 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

1602 
‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images
,

1603 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

1604 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s
}

1605 
di¡Ü‹d_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
,

1606 
´•roûssšg_İtiÚs
)

1607 
di¡Ü‹d_images
 = 
di¡Ü‹d_‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

1608 
di¡Ü‹d_boxes
 = 
di¡Ü‹d_‹nsÜ_diù
[

1609 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

1611 
images_¿nk
 = 
tf
.
	$¿nk
(
images
)

1612 
di¡Ü‹d_images_¿nk
 = 
tf
.
	$¿nk
(
di¡Ü‹d_images
)

1613 
boxes_¿nk
 = 
tf
.
	$¿nk
(
boxes
)

1614 
di¡Ü‹d_boxes_¿nk
 = 
tf
.
	$¿nk
(
di¡Ü‹d_boxes
)

1616 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1617 (
boxes_¿nk_
, 
di¡Ü‹d_boxes_¿nk_
, 
images_¿nk_
,

1618 
di¡Ü‹d_images_¿nk_
èğ
£ss
.
	$run
(

1619 [
boxes_¿nk
, 
di¡Ü‹d_boxes_¿nk
, 
images_¿nk
,

1620 
di¡Ü‹d_images_¿nk
])

1621 
£lf
.
	$as£¹AÎEqu®
(
boxes_¿nk_
, 
di¡Ü‹d_boxes_¿nk_
)

1622 
£lf
.
	$as£¹AÎEqu®
(
images_¿nk_
, 
di¡Ü‹d_images_¿nk_
)

1624 
def
 
	$‹¡SSDRªdomCrİPad
(
£lf
):

1625 
images
 = 
£lf
.
	$ü—‹Te¡Images
()

1626 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

1627 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

1628 
´•roûssšg_İtiÚs
 = [

1629 (
´•roûssÜ
.
nÜm®ize_image
, {

1634 
	}
}),

1635 (
´•roûssÜ
.
ssd_¿ndom_üİ_·d
, {})]

1636 
	g‹nsÜ_diù
 = {
f›lds
.
IÅutD©aF›lds
.
image
: 
images
,

1637 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

1638 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s
}

1639 
di¡Ü‹d_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
,

1640 
´•roûssšg_İtiÚs
)

1641 
di¡Ü‹d_images
 = 
di¡Ü‹d_‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

1642 
di¡Ü‹d_boxes
 = 
di¡Ü‹d_‹nsÜ_diù
[

1643 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

1645 
images_¿nk
 = 
tf
.
	$¿nk
(
images
)

1646 
di¡Ü‹d_images_¿nk
 = 
tf
.
	$¿nk
(
di¡Ü‹d_images
)

1647 
boxes_¿nk
 = 
tf
.
	$¿nk
(
boxes
)

1648 
di¡Ü‹d_boxes_¿nk
 = 
tf
.
	$¿nk
(
di¡Ü‹d_boxes
)

1650 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1651 (
boxes_¿nk_
, 
di¡Ü‹d_boxes_¿nk_
, 
images_¿nk_
,

1652 
di¡Ü‹d_images_¿nk_
èğ
£ss
.
	$run
([

1653 
boxes_¿nk
, 
di¡Ü‹d_boxes_¿nk
, 
images_¿nk
, 
di¡Ü‹d_images_¿nk


1655 
£lf
.
	$as£¹AÎEqu®
(
boxes_¿nk_
, 
di¡Ü‹d_boxes_¿nk_
)

1656 
£lf
.
	$as£¹AÎEqu®
(
images_¿nk_
, 
di¡Ü‹d_images_¿nk_
)

1658 
def
 
	$‹¡SSDRªdomCrİFixedA¥eùR©io
(
£lf
):

1659 
images
 = 
£lf
.
	$ü—‹Te¡Images
()

1660 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

1661 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

1662 
´•roûssšg_İtiÚs
 = [

1663 (
´•roûssÜ
.
nÜm®ize_image
, {

1668 
	}
}),

1669 (
´•roûssÜ
.
ssd_¿ndom_üİ_fixed_a¥eù_¿tio
, {})]

1670 
	g‹nsÜ_diù
 = {

1671 
f›lds
.
IÅutD©aF›lds
.
image
: 
images
,

1672 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

1673 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s


1675 
di¡Ü‹d_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
,

1676 
´•roûssšg_İtiÚs
)

1677 
di¡Ü‹d_images
 = 
di¡Ü‹d_‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

1678 
di¡Ü‹d_boxes
 = 
di¡Ü‹d_‹nsÜ_diù
[

1679 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

1681 
images_¿nk
 = 
tf
.
	$¿nk
(
images
)

1682 
di¡Ü‹d_images_¿nk
 = 
tf
.
	$¿nk
(
di¡Ü‹d_images
)

1683 
boxes_¿nk
 = 
tf
.
	$¿nk
(
boxes
)

1684 
di¡Ü‹d_boxes_¿nk
 = 
tf
.
	$¿nk
(
di¡Ü‹d_boxes
)

1686 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1687 (
boxes_¿nk_
, 
di¡Ü‹d_boxes_¿nk_
, 
images_¿nk_
,

1688 
di¡Ü‹d_images_¿nk_
èğ
£ss
.
	$run
(

1689 [
boxes_¿nk
, 
di¡Ü‹d_boxes_¿nk
, 
images_¿nk
,

1690 
di¡Ü‹d_images_¿nk
])

1691 
£lf
.
	$as£¹AÎEqu®
(
boxes_¿nk_
, 
di¡Ü‹d_boxes_¿nk_
)

1692 
£lf
.
	$as£¹AÎEqu®
(
images_¿nk_
, 
di¡Ü‹d_images_¿nk_
)

1694 
def
 
	$‹¡SSDRªdomCrİFixedA¥eùR©ioW™hMasksAndKeypošts
(
£lf
):

1695 
images
 = 
£lf
.
	$ü—‹Te¡Images
()

1696 
boxes
 = 
£lf
.
	$ü—‹Te¡Boxes
()

1697 
Ïb–s
 = 
£lf
.
	$ü—‹Te¡Lab–s
()

1698 
masks
 = 
£lf
.
	$ü—‹Te¡Masks
()

1699 
keypošts
 = 
£lf
.
	$ü—‹Te¡Keypošts
()

1700 
´•roûssšg_İtiÚs
 = [

1701 (
´•roûssÜ
.
nÜm®ize_image
, {

1706 
	}
}),

1707 (
´•roûssÜ
.
ssd_¿ndom_üİ_fixed_a¥eù_¿tio
, {})]

1708 
	g‹nsÜ_diù
 = {

1709 
f›lds
.
IÅutD©aF›lds
.
image
: 
images
,

1710 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
boxes
,

1711 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
Ïb–s
,

1712 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_š¡ªû_masks
: 
masks
,

1713 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_keypošts
: 
keypošts
,

1715 
´•roûssÜ_¬g_m­
 = 
´•roûssÜ
.
	$g‘_deçuÉ_func_¬g_m­
(

1716 
šşude_š¡ªû_masks
=
True
, 
šşude_keypošts
=True)

1717 
di¡Ü‹d_‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(

1718 
‹nsÜ_diù
, 
´•roûssšg_İtiÚs
, 
func_¬g_m­
=
´•roûssÜ_¬g_m­
)

1719 
di¡Ü‹d_images
 = 
di¡Ü‹d_‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

1720 
di¡Ü‹d_boxes
 = 
di¡Ü‹d_‹nsÜ_diù
[

1721 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

1723 
images_¿nk
 = 
tf
.
	$¿nk
(
images
)

1724 
di¡Ü‹d_images_¿nk
 = 
tf
.
	$¿nk
(
di¡Ü‹d_images
)

1725 
boxes_¿nk
 = 
tf
.
	$¿nk
(
boxes
)

1726 
di¡Ü‹d_boxes_¿nk
 = 
tf
.
	$¿nk
(
di¡Ü‹d_boxes
)

1728 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1729 (
boxes_¿nk_
, 
di¡Ü‹d_boxes_¿nk_
, 
images_¿nk_
,

1730 
di¡Ü‹d_images_¿nk_
èğ
£ss
.
	$run
(

1731 [
boxes_¿nk
, 
di¡Ü‹d_boxes_¿nk
, 
images_¿nk
,

1732 
di¡Ü‹d_images_¿nk
])

1733 
£lf
.
	$as£¹AÎEqu®
(
boxes_¿nk_
, 
di¡Ü‹d_boxes_¿nk_
)

1734 
£lf
.
	$as£¹AÎEqu®
(
images_¿nk_
, 
di¡Ü‹d_images_¿nk_
)

1736 
__Çme__
 == '__main__':

1737 
tf
.
‹¡
.
	`maš
()

	@core/region_similarity_calculator.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
RegiÚ
 
Sim¬™y
 
C®cuÏtÜs
 
com·»
 
a
 
·œwi£
 
m—su»
 
of
 
sim¬™y


19 
b‘w“n
 
the
 
boxes
 
š
 
two
 
	gBoxLi¡s
.

21 
äom
 
abc
 
impÜt
 
ABCM‘a


22 
äom
 
abc
 
impÜt
 
ab¡¿ùm‘hod


24 
impÜt
 
‹nsÜæow
 
as
 
tf


26 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡_İs


29 
şass
 
	$RegiÚSim¬™yC®cuÏtÜ
(
objeù
):

31 
__m‘aşass__
 = 
ABCM‘a


33 
def
 
	$com·»
(
£lf
, 
boxli¡1
, 
boxli¡2
, 
scİe
=
NÚe
):

36 
This
 
	$İ
 (
to
 
be
 
ov”rid’
è
compu‹s
 
a
 
m—su»
 
of
 
·œwi£
 
sim¬™y
 
b‘w“n


37 
the
 
boxes
 
š
h
giv’
 
BoxLi¡s
. 
High”
 
v®ues
 
šdiÿ‹
 
mÜe
 
sim¬™y
.

39 
NÙe
 
th©
 
this
 
m‘hod
 
sim¶y
 
m—su»s
 
sim¬™y
 
ªd
 
dÛs
 
nÙ
 
ex¶ic™ly


40 
³rfÜm
 
a
 
m©chšg
.

42 
Args
:

43 
boxli¡1
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes
.

44 
boxli¡2
: 
BoxLi¡
 
hŞdšg
 
M
 
boxes
.

45 
scİe
: 
Op
 scİ
Çme
. 
DeçuÉs
 
to
 'Com·»' 
NÚe
.

47 
R‘uºs
:

48 
	$a
 (
æßt32
è
‹nsÜ
 
of
 
sh­e
 [
N
, 
M
] 
w™h
 
·œwi£
 
sim¬™y
 
scÜe
.

50 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'Com·»', [
boxli¡1
, 
boxli¡2
]è
as
 scope:

51  
£lf
.
	`_com·»
(
boxli¡1
, 
boxli¡2
)

53 @
ab¡¿ùm‘hod


54 
def
 
	$_com·»
(
£lf
, 
boxli¡1
, 
boxli¡2
):

55 
·ss


58 
şass
 
	$IouSim¬™y
(
RegiÚSim¬™yC®cuÏtÜ
):

61 
This
 
şass
 
compu‹s
 
·œwi£
 
sim¬™y
 
b‘w“n
 
two
 
BoxLi¡s
 
ba£d
 
Ú
 
IOU
.

64 
def
 
	$_com·»
(
£lf
, 
boxli¡1
, 
boxli¡2
):

67 
Args
:

68 
boxli¡1
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes
.

69 
boxli¡2
: 
BoxLi¡
 
hŞdšg
 
M
 
boxes
.

71 
R‘uºs
:

72 
A
 
‹nsÜ
 
w™h
 
sh­e
 [
N
, 
M
] 
»´e£Ášg
 
·œwi£
 
iou
 
scÜes
.

74  
box_li¡_İs
.
	$iou
(
boxli¡1
, 
boxli¡2
)

77 
şass
 
	$NegSqDi¡Sim¬™y
(
RegiÚSim¬™yC®cuÏtÜ
):

80 
This
 
şass
 
compu‹s
 
·œwi£
 
sim¬™y
 
b‘w“n
 
two
 
BoxLi¡s
 
ba£d
 
Ú
 
the


81 
Ãg©ive
 
squ¬ed
 
di¡ªû
 
m‘ric
.

84 
def
 
	$_com·»
(
£lf
, 
boxli¡1
, 
boxli¡2
):

87 
Args
:

88 
boxli¡1
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes
.

89 
boxli¡2
: 
BoxLi¡
 
hŞdšg
 
M
 
boxes
.

91 
R‘uºs
:

92 
A
 
‹nsÜ
 
w™h
 
sh­e
 [
N
, 
M
] 
»´e£Ášg
 
Ãg©ed
 
·œwi£
 
squ¬ed
 
di¡ªû
.

94  -1 * 
box_li¡_İs
.
	$sq_di¡
(
boxli¡1
, 
boxli¡2
)

97 
şass
 
	$IßSim¬™y
(
RegiÚSim¬™yC®cuÏtÜ
):

100 
This
 
şass
 
compu‹s
 
·œwi£
 
sim¬™y
 
b‘w“n
 
two
 
BoxLi¡s
 
ba£d
 
Ú
 
theœ


101 
·œwi£
 
š‹r£ùiÚs
 
divided
 
by
 
the
 
¬—s
 
of
 
£cÚd
 
BoxLi¡s
.

104 
def
 
	$_com·»
(
£lf
, 
boxli¡1
, 
boxli¡2
):

107 
Args
:

108 
boxli¡1
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes
.

109 
boxli¡2
: 
BoxLi¡
 
hŞdšg
 
M
 
boxes
.

111 
R‘uºs
:

112 
A
 
‹nsÜ
 
w™h
 
sh­e
 [
N
, 
M
] 
»´e£Ášg
 
·œwi£
 
IOA
 
scÜes
.

114  
box_li¡_İs
.
	`iß
(
boxli¡1
, 
boxli¡2
)

	@core/region_similarity_calculator_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
‹nsÜæow
 
as
 
tf


19 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


20 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
»giÚ_sim¬™y_ÿlcuÏtÜ


23 
şass
 
	$RegiÚSim¬™yC®cuÏtÜTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

25 
def
 
	$‹¡_g‘_cÜ»ù_·œwi£_sim¬™y_ba£d_Ú_iou
(
£lf
):

26 
cÜÃrs1
 = 
tf
.
	$cÚ¡ªt
([[4.0, 3.0, 7.0, 5.0], [5.0, 6.0, 10.0, 7.0]])

27 
cÜÃrs2
 = 
tf
.
	$cÚ¡ªt
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0],

29 
exp_ouut
 = [[2.0 / 16.0, 0, 6.0 / 400.0], [1.0 / 16.0, 0.0, 5.0 / 400.0]]

30 
boxes1
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs1
)

31 
boxes2
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs2
)

32 
iou_sim¬™y_ÿlcuÏtÜ
 = 
»giÚ_sim¬™y_ÿlcuÏtÜ
.
	$IouSim¬™y
()

33 
iou_sim¬™y
 = 
iou_sim¬™y_ÿlcuÏtÜ
.
	$com·»
(
boxes1
, 
boxes2
)

34 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

35 
iou_ouut
 = 
£ss
.
	$run
(
iou_sim¬™y
)

36 
£lf
.
	$as£¹AÎClo£
(
iou_ouut
, 
exp_ouut
)

38 
def
 
	$‹¡_g‘_cÜ»ù_·œwi£_sim¬™y_ba£d_Ú_squ¬ed_di¡ªûs
(
£lf
):

39 
cÜÃrs1
 = 
tf
.
	$cÚ¡ªt
([[0.0, 0.0, 0.0, 0.0],

41 
cÜÃrs2
 = 
tf
.
	`cÚ¡ªt
([[3.0, 4.0, 1.0, 0.0],

44 
exp_ouut
 = [[-26, -25, 0], [-18, -27, -6]]

45 
boxes1
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs1
)

46 
boxes2
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs2
)

47 
di¡_sim¬™y_ÿlc
 = 
»giÚ_sim¬™y_ÿlcuÏtÜ
.
	$NegSqDi¡Sim¬™y
()

48 
di¡_sim¬™y
 = 
di¡_sim¬™y_ÿlc
.
	$com·»
(
boxes1
, 
boxes2
)

49 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

50 
di¡_ouut
 = 
£ss
.
	$run
(
di¡_sim¬™y
)

51 
£lf
.
	$as£¹AÎClo£
(
di¡_ouut
, 
exp_ouut
)

53 
def
 
	$‹¡_g‘_cÜ»ù_·œwi£_sim¬™y_ba£d_Ú_iß
(
£lf
):

54 
cÜÃrs1
 = 
tf
.
	$cÚ¡ªt
([[4.0, 3.0, 7.0, 5.0], [5.0, 6.0, 10.0, 7.0]])

55 
cÜÃrs2
 = 
tf
.
	$cÚ¡ªt
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0],

57 
exp_ouut_1
 = [[2.0 / 12.0, 0, 6.0 / 400.0],

59 
exp_ouut_2
 = [[2.0 / 6.0, 1.0 / 5.0],

62 
boxes1
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs1
)

63 
boxes2
 = 
box_li¡
.
	$BoxLi¡
(
cÜÃrs2
)

64 
iß_sim¬™y_ÿlcuÏtÜ
 = 
»giÚ_sim¬™y_ÿlcuÏtÜ
.
	$IßSim¬™y
()

65 
iß_sim¬™y_1
 = 
iß_sim¬™y_ÿlcuÏtÜ
.
	$com·»
(
boxes1
, 
boxes2
)

66 
iß_sim¬™y_2
 = 
iß_sim¬™y_ÿlcuÏtÜ
.
	$com·»
(
boxes2
, 
boxes1
)

67 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

68 
iou_ouut_1
, 
iou_ouut_2
 = 
£ss
.
	$run
(

69 [
iß_sim¬™y_1
, 
iß_sim¬™y_2
])

70 
£lf
.
	$as£¹AÎClo£
(
iou_ouut_1
, 
exp_ouut_1
)

71 
£lf
.
	$as£¹AÎClo£
(
iou_ouut_2
, 
exp_ouut_2
)

74 
__Çme__
 == '__main__':

75 
tf
.
‹¡
.
	`maš
()

	@core/standard_fields.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

19 
	gS³cif›s
:

20 
IÅutD©aF›lds
: 
¡ªd¬d
 
f›lds
 
u£d
 
by
 
»ad”
/
´•roûssÜ
/
b©ch”
.

21 
BoxLi¡F›lds
: 
¡ªd¬d
 
f›ld
 
u£d
 
by
 
BoxLi¡


22 
TfExam¶eF›lds
: 
¡ªd¬d
 
f›lds
 
tf
-
exam¶e
 
d©a
 
fÜm©
 (
go
/tf-example).

26 
şass
 
	$IÅutD©aF›lds
(
objeù
):

29 
HŞds
 
the
 
¡ªd¬d
 
d©a
 
f›ld
 
Çmes
 
to
 
u£
 
id’tifyšg
 
šput
 
‹nsÜs
. 
This


30 
should
 
be
 
u£d
 
by
 
the
 
decod”
 
to
 
id’tify
 
keys
 th
»tuºed
 
‹nsÜ_diù


31 
cÚššg
 
šput
 
‹nsÜs
. 
And
 
™
 
should
 
be
 
u£d
 
by
 
the
 
mod–
 
to
 
id’tify
he

32 
‹nsÜs
 
™
 
Ãeds
.

34 
A‰ribu‹s
:

35 
image
: image.

36 
Üigš®_image
: 
image
 
š
 
the
 
Üigš®
 
šput
 
size
.

37 
key
: 
unique
 key 
cÜ»¥Údšg
 
to
 
image
.

38 
sourû_id
: 
sourû
 
of
 
the
 
Üigš®
 
image
.

39 
f’ame
: 
Üigš®
 f’am
of
 
the
 
	`d©a£t
 (
w™hout
 
commÚ
 
·th
).

40 
groundŒuth_image_şas£s
: 
image
-
Ëv–
 
şass
 
Ïb–s
.

41 
groundŒuth_boxes
: 
coÜdš©es
 
of
 
the
 
ground
 
Œuth
 
boxes
 
š
h
image
.

42 
groundŒuth_şas£s
: 
box
-
Ëv–
 
şass
 
Ïb–s
.

43 
groundŒuth_Ïb–_ty³s
: 
box
-
Ëv–
 
Ïb–
 
	`ty³s
 (
e
.
g
. 
ex¶ic™
 
Ãg©ive
).

44 
groundŒuth_is_üowd
: 
is
 
the
 
groundŒuth
 
a
 
sšgË
 
objeù
 
Ü
‡ 
üowd
.

45 
groundŒuth_¬—
: 
¬—
 
of
 
a
 
groundŒuth
 
£gm’t
.

46 
groundŒuth_difficuÉ
: 
is
 
a
 `
difficuÉ
` 
objeù


47 
´İo§l_boxes
: 
coÜdš©es
 
of
 
objeù
 
´İo§l
 
boxes
.

48 
´İo§l_objeùÃss
: 
objeùÃss
 
scÜe
 
of
 
—ch
 
´İo§l
.

49 
groundŒuth_š¡ªû_masks
: 
ground
 
Œuth
 
š¡ªû
 
masks
.

50 
groundŒuth_š¡ªû_şas£s
: 
š¡ªû
 
mask
-
Ëv–
 
şass
 
Ïb–s
.

51 
groundŒuth_keypošts
: 
ground
 
Œuth
 
keypošts
.

52 
groundŒuth_keypošt_visib™›s
: 
ground
 
Œuth
 
keypošt
 
visib™›s
.

53 
groundŒuth_Ïb–_scÜes
: 
groundŒuth
 
Ïb–
 
scÜes
.

55 
image
 = 'image'

56 
Üigš®_image
 = 'original_image'

57 
key
 = 'key'

58 
sourû_id
 = 'source_id'

59 
f’ame
 = 'filename'

60 
groundŒuth_image_şas£s
 = 'groundtruth_image_classes'

61 
groundŒuth_boxes
 = 'groundtruth_boxes'

62 
groundŒuth_şas£s
 = 'groundtruth_classes'

63 
groundŒuth_Ïb–_ty³s
 = 'groundtruth_label_types'

64 
groundŒuth_is_üowd
 = 'groundtruth_is_crowd'

65 
groundŒuth_¬—
 = 'groundtruth_area'

66 
groundŒuth_difficuÉ
 = 'groundtruth_difficult'

67 
´İo§l_boxes
 = 'proposal_boxes'

68 
´İo§l_objeùÃss
 = 'proposal_objectness'

69 
groundŒuth_š¡ªû_masks
 = 'groundtruth_instance_masks'

70 
groundŒuth_š¡ªû_şas£s
 = 'groundtruth_instance_classes'

71 
groundŒuth_keypošts
 = 'groundtruth_keypoints'

72 
groundŒuth_keypošt_visib™›s
 = 'groundtruth_keypoint_visibilities'

73 
groundŒuth_Ïb–_scÜes
 = 'groundtruth_label_scores'

76 
şass
 
	$BoxLi¡F›lds
(
objeù
):

79 
A‰ribu‹s
:

80 
boxes
: 
boundšg
 
box
 
coÜdš©es
.

81 
şas£s
: cÏs£ 
³r
 
boundšg
 
box
.

82 
scÜes
: scÜe 
³r
 
boundšg
 
box
.

83 
weights
: 
§m¶e
 weight 
³r
 
boundšg
 
box
.

84 
objeùÃss
: objeùÃs 
scÜe
 
³r
 
boundšg
 
box
.

85 
masks
: mask 
³r
 
boundšg
 
box
.

86 
keypošts
: keypošt 
³r
 
boundšg
 
box
.

87 
keypošt_h—tm­s
: 
keypošt
 
h—tm­s
 
³r
 
boundšg
 
box
.

89 
boxes
 = 'boxes'

90 
şas£s
 = 'classes'

91 
scÜes
 = 'scores'

92 
weights
 = 'weights'

93 
objeùÃss
 = 'objectness'

94 
masks
 = 'masks'

95 
keypošts
 = 'keypoints'

96 
keypošt_h—tm­s
 = 'keypoint_heatmaps'

99 
şass
 
	$TfExam¶eF›lds
(
objeù
):

102 
HŞds
 
the
 
¡ªd¬d
 
ã©u»
 
Çmes
 
to
 
lßd
 
äom
 
ª
 
Exam¶e
 
´Ùo
 
objeù


103 
d‘eùiÚ
.

105 
A‰ribu‹s
:

106 
image_’coded
: 
JPEG
 
’coded
 
¡ršg


107 
image_fÜm©
: 
image
 
fÜm©
, 
e
.
g
. "JPEG"

108 
f’ame
: filename

109 
chªÃls
: 
numb”
 
of
 chªÃl oà
image


110 
cŞÜ¥aû
: cŞÜ¥aû, 
e
.
g
. "RGB"

111 
height
: heighˆ
of
 
image
 
š
 
pix–s
, 
e
.
g
. 462

112 
width
: width 
of
 
image
 
š
 
pix–s
, 
e
.
g
. 581

113 
sourû_id
: 
Üigš®
 
sourû
 
of
 
the
 
image


114 
objeù_şass_‹xt
: 
Ïb–s
 
š
 
‹xt
 
fÜm©
, 
e
.
g
. ["person", "cat"]

115 
objeù_şass_‹xt
: 
Ïb–s
 
š
 
numb”s
, 
e
.
g
. [16, 8]

116 
objeù_bbox_xmš
: 
xmš
 
coÜdš©es
 
of
 
groundŒuth
 
box
, 
e
.
g
. 10, 30

117 
objeù_bbox_xmax
: 
xmax
 
coÜdš©es
 
of
 
groundŒuth
 
box
, 
e
.
g
. 50, 40

118 
objeù_bbox_ymš
: 
ymš
 
coÜdš©es
 
of
 
groundŒuth
 
box
, 
e
.
g
. 40, 50

119 
objeù_bbox_ymax
: 
ymax
 
coÜdš©es
 
of
 
groundŒuth
 
box
, 
e
.
g
. 80, 70

120 
objeù_v›w
: 
v›wpošt
 
of
 
objeù
, 
e
.
g
. ["frontal", "left"]

121 
objeù_Œunÿ‹d
: 
is
 
objeù
 
Œunÿ‹d
, 
e
.
g
. [
Œue
, 
çl£
]

122 
objeù_ocşuded
: 
is
 
objeù
 
ocşuded
, 
e
.
g
. [
Œue
, 
çl£
]

123 
objeù_difficuÉ
: 
is
 
objeù
 
difficuÉ
, 
e
.
g
. [
Œue
, 
çl£
]

124 
objeù_is_üowd
: 
is
 
the
 
objeù
 
a
 
sšgË
 objeù 
Ü
‡ 
üowd


125 
objeù_£gm’t_¬—
: 
the
 
¬—
 
of
h
£gm’t
.

126 
š¡ªû_masks
: 
š¡ªû
 
£gm’tiÚ
 
masks
.

127 
š¡ªû_şas£s
: 
CÏs£s
 
—ch
 
š¡ªû
 
£gm’tiÚ
 
mask
.

129 
image_’coded
 = 'image/encoded'

130 
image_fÜm©
 = 'image/fÜm©' #fÜm© 
is
 
»£rved
 
keywÜd


131 
f’ame
 = 'image/filename'

132 
chªÃls
 = 'image/channels'

133 
cŞÜ¥aû
 = 'image/colorspace'

134 
height
 = 'image/height'

135 
width
 = 'image/width'

136 
sourû_id
 = 'image/source_id'

137 
objeù_şass_‹xt
 = 'image/object/class/text'

138 
objeù_şass_Ïb–
 = 'image/object/class/label'

139 
objeù_bbox_ymš
 = 'image/object/bbox/ymin'

140 
objeù_bbox_xmš
 = 'image/object/bbox/xmin'

141 
objeù_bbox_ymax
 = 'image/object/bbox/ymax'

142 
objeù_bbox_xmax
 = 'image/object/bbox/xmax'

143 
objeù_v›w
 = 'image/object/view'

144 
objeù_Œunÿ‹d
 = 'image/object/truncated'

145 
objeù_ocşuded
 = 'image/object/occluded'

146 
objeù_difficuÉ
 = 'image/object/difficult'

147 
objeù_is_üowd
 = 'image/object/is_crowd'

148 
objeù_£gm’t_¬—
 = 'image/object/segment/area'

149 
š¡ªû_masks
 = 'image/segmentation/object'

150 
š¡ªû_şas£s
 = 'image/segmentation/object/class'

	@core/target_assigner.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
The
 
job
 
of
 
a
 
T¬g‘AssigÃr
 
	gis
, ¨
giv’
 
£t
 oà
	$ªchÜs
 (
boundšg
 
boxes
è
ªd


19 
groundŒuth
 
	`d‘eùiÚs
 (
boundšg
 
boxes
), 
to
 
assign
 
şassifiÿtiÚ
 
ªd
 
»g»ssiÚ


20 
rg‘s
 
to
 
—ch
 
ªchÜ
 
as
 
w–l
‡ 
weights
Ø—ch 
	`ªchÜ
 (
¥ecifyšg
, 
e
.
g
.,

21 
which
 
ªchÜs
 
should
 
nÙ
 
cÚŒibu‹
 
to
 
Œaššg
 
loss
).

23 
It
 
assigns
 
şassifiÿtiÚ
/
»g»ssiÚ
 
rg‘s
 
by
 
³rfÜmšg
 
the
 
fŞlowšg
 
¡•s
:

24 1è
Computšg
 
·œwi£
 
sim¬™y
 
b‘w“n
 
ªchÜs
 
ªd
 
groundŒuth
 
boxes
 
usšg
 
a


25 
´ovided
 
RegiÚSim¬™y
 
C®cuÏtÜ


26 2è
Computšg
 
a
 
m©chšg
 
ba£d
 
Ú
 
the
 
sim¬™y
 
m©rix
 
usšg
‡ 
´ovided
 
M©ch”


27 3è
Assignšg
 
»g»ssiÚ
 
rg‘s
 
ba£d
 
Ú
 
the
 
m©chšg
 
ªd
 
a
 
´ovided
 
BoxCod”


28 4è
Assignšg
 
şassifiÿtiÚ
 
rg‘s
 
ba£d
 
Ú
 
the
 
m©chšg
 
ªd
 
groundŒuth
 
Ïb–s


30 
NÙe
 
th©
 
T¬g‘AssigÃrs
 
Úly
 
İ”©e
 
Ú
 
d‘eùiÚs
 
äom
 
a
 
sšgË


31 
image
 
©
 
a
 
time
, 
so
 
ªy
 
logic
 
­¶yšg
‡ 
T¬g‘AssigÃr
 
to
 
muÉË


32 
images
 
mu¡
 
be
 
hªdËd
 
ex‹º®ly
.

34 
impÜt
 
‹nsÜæow
 
as
 
tf


36 
äom
 
objeù_d‘eùiÚ
.
box_cod”s
 
impÜt
 
ç¡”_rún_box_cod”


37 
äom
 
objeù_d‘eùiÚ
.
box_cod”s
 
impÜt
 
m—n_¡ddev_box_cod”


38 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_cod”
 
as
 
bcod”


39 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


40 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡_İs


41 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
m©ch”
 
as
 
m©


42 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
»giÚ_sim¬™y_ÿlcuÏtÜ
 
as
 
sim_ÿlc


43 
äom
 
objeù_d‘eùiÚ
.
m©ch”s
 
impÜt
 
¬gmax_m©ch”


44 
äom
 
objeù_d‘eùiÚ
.
m©ch”s
 
impÜt
 
b¬t™e_m©ch”


47 
şass
 
	$T¬g‘AssigÃr
(
objeù
):

50 
def
 
	$__š™__
(
£lf
, 
sim¬™y_ÿlc
, 
m©ch”
, 
box_cod”
,

51 
pos™ive_şass_weight
=1.0, 
Ãg©ive_şass_weight
=1.0,

52 
unm©ched_şs_rg‘
=
NÚe
):

55 
Args
:

56 
sim¬™y_ÿlc
: 
a
 
RegiÚSim¬™yC®cuÏtÜ


57 
m©ch”
: 
ª
 
objeù_d‘eùiÚ
.
cÜe
.
M©ch”
 
u£d
 
to
 
m©ch
 
groundŒuth
o

58 
ªchÜs
.

59 
box_cod”
: 
ª
 
objeù_d‘eùiÚ
.
cÜe
.
BoxCod”
 
u£d
 
to
 
’code
 
m©chšg


60 
groundŒuth
 
boxes
 
w™h
 
»¥eù
 
to
 
ªchÜs
.

61 
pos™ive_şass_weight
: 
şassifiÿtiÚ
 
weight
 
to
 
be
 
assocŸ‹d
Ø
pos™ive


62 
	$ªchÜs
 (: 1.0)

63 
Ãg©ive_şass_weight
: 
şassifiÿtiÚ
 
weight
 
to
 
be
 
assocŸ‹d
Ø
Ãg©ive


64 
	$ªchÜs
 (: 1.0)

65 
unm©ched_şs_rg‘
: 
a
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
d_1
, 
d_2
, ..., 
d_k
]

66 
which
 
is
 
cÚsi¡’t
 
w™h
 
the
 
şassifiÿtiÚ
 
rg‘
 
—ch


67 
	`ªchÜ
 (
ªd
 
ÿn
 
be
 
em±y
 
sÿÏr
 
rg‘s
). 
This
 
sh­e
 
mu¡
 
thus
 be

68 
com·tibË
 
w™h
 
the
 
groundŒuth
 
Ïb–s
 
th©
 
¬e
 
·s£d
 
to
he "assign"

69 
	`funùiÚ
 (
which
 
have
 
sh­e
 [
num_gt_boxes
, 
d_1
, 
d_2
, ..., 
d_k
]).

70 
If
 
£t
 
to
 
NÚe
, 
unm©ched_şs_rg‘
 
is
 s‘Ø
be
 [0] 
—ch
 
ªchÜ
.

72 
Rai£s
:

73 
V®ueE¼Ü
: 
sim¬™y_ÿlc
 
is
 
nÙ
 
a
 
RegiÚSim¬™yC®cuÏtÜ
 
Ü


74 
m©ch”
 
is
 
nÙ
 
a
 
M©ch”
 
Ü
 
box_cod”
 i nÙ‡ 
BoxCod”


76 
nÙ
 
	$isš¡ªû
(
sim¬™y_ÿlc
, 
sim_ÿlc
.
RegiÚSim¬™yC®cuÏtÜ
):

77 
¿i£
 
	`V®ueE¼Ü
('similarity_calc must be‡ RegionSimilarityCalculator')

78 
nÙ
 
	$isš¡ªû
(
m©ch”
, 
m©
.
M©ch”
):

79 
¿i£
 
	`V®ueE¼Ü
('matcher must be‡ Matcher')

80 
nÙ
 
	$isš¡ªû
(
box_cod”
, 
bcod”
.
BoxCod”
):

81 
¿i£
 
	`V®ueE¼Ü
('box_coder must be‡ BoxCoder')

82 
£lf
.
_sim¬™y_ÿlc
 = 
sim¬™y_ÿlc


83 
£lf
.
_m©ch”
 = 
m©ch”


84 
£lf
.
_box_cod”
 = 
box_cod”


85 
£lf
.
_pos™ive_şass_weight
 = 
pos™ive_şass_weight


86 
£lf
.
_Ãg©ive_şass_weight
 = 
Ãg©ive_şass_weight


87 
unm©ched_şs_rg‘
 
is
 
NÚe
:

88 
£lf
.
_unm©ched_şs_rg‘
 = 
tf
.
	$cÚ¡ªt
([0], 
tf
.
æßt32
)

90 
£lf
.
_unm©ched_şs_rg‘
 = 
unm©ched_şs_rg‘


92 @
´İ”ty


93 
def
 
	$box_cod”
(
£lf
):

94  
£lf
.
_box_cod”


96 
def
 
	$assign
(
£lf
, 
ªchÜs
, 
groundŒuth_boxes
, 
groundŒuth_Ïb–s
=
NÚe
,

97 **
·¿ms
):

100 
FÜ
 
a
 
giv’
 
£t
 
of
 
ªchÜs
 
ªd
 
groundŒuth
 
d‘eùiÚs
, 
m©ch
‡nchors

101 
to
 
groundŒuth_boxes
 
ªd
 
assign
 
şassifiÿtiÚ
‡nd 
»g»ssiÚ
 
rg‘s
o

102 
—ch
 
ªchÜ
 
as
 
w–l
‡ 
weights
 
ba£d
 
Ú
 
the
 
»suÉšg
 
	`m©ch
 (
¥ecifyšg
,

103 
e
.
g
., 
which
 
ªchÜs
 
should
 
nÙ
 
cÚŒibu‹
 
to
 
Œaššg
 
loss
).

105 
AnchÜs
 
th©
 
¬e
 
nÙ
 
m©ched
 
to
 
ªythšg
‡» 
giv’
 
a
 
şassifiÿtiÚ
 
rg‘


106 
of
 
£lf
.
_unm©ched_şs_rg‘
 
which
 
ÿn
 
be
 
¥ecif›d
 
vŸ
 
the
 
cÚ¡ruùÜ
.

108 
Args
:

109 
ªchÜs
: 
a
 
BoxLi¡
 
»´e£Ášg
 
N
‡nchors

110 
groundŒuth_boxes
: 
a
 
BoxLi¡
 
»´e£Ášg
 
M
 
groundŒuth
 
boxes


111 
groundŒuth_Ïb–s
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
num_gt_boxes
, 
d_1
, ... 
d_k
]

112 
w™h
 
Ïb–s
 
—ch
 
of
 
the
 
ground_Œuth
 
boxes
. 
The
 
subsh­e


113 [
d_1
, ... 
d_k
] 
ÿn
 
be
 
	`em±y
 (
cÜ»¥Údšg
 
to
 
sÿÏr
 
šputs
). 
Wh’
 
£t


114 
to
 
NÚe
, 
groundŒuth_Ïb–s
 
assumes
 
a
 
bš¬y
 
´obËm
 
wh”e
 
®l


115 
ground_Œuth
 
boxes
 
g‘
 
a
 
pos™ive
 
	`Ïb–
 (
of
 1).

116 **
·¿ms
: 
Add™iÚ®
 
keywÜd
 
¬gum’ts
 
¥ecific
 
im¶em’tiÚs
 
of


117 
the
 
M©ch”
.

119 
R‘uºs
:

120 
şs_rg‘s
: 
a
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
num_ªchÜs
, 
d_1
, 
d_2
 ... 
d_k
],

121 
wh”e
 
the
 
subsh­e
 [
d_1
, ..., 
d_k
] 
is
 
com·tibË
 
w™h
 
groundŒuth_Ïb–s


122 
which
 
has
 
sh­e
 [
num_gt_boxes
, 
d_1
, 
d_2
, ... 
d_k
].

123 
şs_weights
: 
a
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
num_ªchÜs
]

124 
»g_rg‘s
: 
a
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
num_ªchÜs
, 
box_code_dim’siÚ
]

125 
»g_weights
: 
a
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
num_ªchÜs
]

126 
m©ch
: 
a
 
m©ch”
.
M©ch
 
objeù
 
’codšg
 
the
 m©ch 
b‘w“n
 
ªchÜs
 
ªd


127 
groundŒuth
 
boxes
, 
w™h
 
rows
 
cÜ»¥Údšg
 
to
 groundtruth boxes

128 
ªd
 
cŞumns
 
cÜ»¥Údšg
 
to
 
ªchÜs
.

130 
Rai£s
:

131 
V®ueE¼Ü
: 
ªchÜs
 
Ü
 
groundŒuth_boxes
 
¬e
 
nÙ
 
of
 
ty³


132 
box_li¡
.
BoxLi¡


134 
nÙ
 
	$isš¡ªû
(
ªchÜs
, 
box_li¡
.
BoxLi¡
):

135 
¿i£
 
	`V®ueE¼Ü
('anchors must be‡n BoxList')

136 
nÙ
 
	$isš¡ªû
(
groundŒuth_boxes
, 
box_li¡
.
BoxLi¡
):

137 
¿i£
 
	`V®ueE¼Ü
('groundtruth_boxes must be‡n BoxList')

139 
groundŒuth_Ïb–s
 
is
 
NÚe
:

140 
groundŒuth_Ïb–s
 = 
tf
.
	`Úes
Ñf.
	`ex·nd_dims
(
groundŒuth_boxes
.
	`num_boxes
(),

142 
groundŒuth_Ïb–s
 = 
tf
.
	`ex·nd_dims
(groundtruth_labels, -1)

143 
sh­e_as£¹
 = 
tf
.
	`as£¹_equ®
Ñf.
	`sh­e
(
groundŒuth_Ïb–s
)[1:],

144 
tf
.
	$sh­e
(
£lf
.
_unm©ched_şs_rg‘
))

146 
w™h
 
tf
.
	$cÚŒŞ_d•’d’c›s
([
sh­e_as£¹
]):

147 
m©ch_qu®™y_m©rix
 = 
£lf
.
_sim¬™y_ÿlc
.
	$com·»
(
groundŒuth_boxes
,

148 
ªchÜs
)

149 
m©ch
 = 
£lf
.
_m©ch”
.
	$m©ch
(
m©ch_qu®™y_m©rix
, **
·¿ms
)

150 
»g_rg‘s
 = 
£lf
.
	$_ü—‹_»g»ssiÚ_rg‘s
(
ªchÜs
,

151 
groundŒuth_boxes
,

152 
m©ch
)

153 
şs_rg‘s
 = 
£lf
.
	$_ü—‹_şassifiÿtiÚ_rg‘s
(
groundŒuth_Ïb–s
,

154 
m©ch
)

155 
»g_weights
 = 
£lf
.
	$_ü—‹_»g»ssiÚ_weights
(
m©ch
)

156 
şs_weights
 = 
£lf
.
	$_ü—‹_şassifiÿtiÚ_weights
(

157 
m©ch
, 
£lf
.
_pos™ive_şass_weight
, s–f.
_Ãg©ive_şass_weight
)

159 
num_ªchÜs
 = 
ªchÜs
.
	$num_boxes_¡©ic
()

160 
num_ªchÜs
 
is
 
nÙ
 
NÚe
:

161 
»g_rg‘s
 = 
£lf
.
	$_»£t_rg‘_sh­e
(
»g_rg‘s
, 
num_ªchÜs
)

162 
şs_rg‘s
 = 
£lf
.
	$_»£t_rg‘_sh­e
(
şs_rg‘s
, 
num_ªchÜs
)

163 
»g_weights
 = 
£lf
.
	$_»£t_rg‘_sh­e
(
»g_weights
, 
num_ªchÜs
)

164 
şs_weights
 = 
£lf
.
	$_»£t_rg‘_sh­e
(
şs_weights
, 
num_ªchÜs
)

166  
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
, 
m©ch


168 
def
 
	$_»£t_rg‘_sh­e
(
£lf
, 
rg‘
, 
num_ªchÜs
):

171 
Args
:

172 
rg‘
: 
the
¬g‘ 
‹nsÜ
. 
Its
 
fœ¡
 
dim’siÚ
 
wl
 
be
 
ov”wr™‹n
.

173 
num_ªchÜs
: 
the
 
numb”
 
of
 
ªchÜs
, 
which
 
is
 
u£d
 
to
 
ov”ride
h
rg‘
's

174 
fœ¡
 
dim’siÚ
.

176 
R‘uºs
:

177 
A
 
‹nsÜ
 
w™h
 
the
 
sh­e
 
šfo
 
fËd
 
š
.

179 
rg‘_sh­e
 = 
rg‘
.
	`g‘_sh­e
().
	$as_li¡
()

180 
rg‘_sh­e
[0] = 
num_ªchÜs


181 
rg‘
.
	$£t_sh­e
(
rg‘_sh­e
)

182  
rg‘


184 
def
 
	$_ü—‹_»g»ssiÚ_rg‘s
(
£lf
, 
ªchÜs
, 
groundŒuth_boxes
, 
m©ch
):

187 
Args
:

188 
ªchÜs
: 
a
 
BoxLi¡
 
»´e£Ášg
 
N
‡nchors

189 
groundŒuth_boxes
: 
a
 
BoxLi¡
 
»´e£Ášg
 
M
 groundtruth_boxes

190 
m©ch
: 
a
 
m©ch”
.
M©ch
 
objeù


192 
R‘uºs
:

193 
»g_rg‘s
: 
a
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
N
, 
box_code_dim’siÚ
]

195 
m©ched_ªchÜ_šdiûs
 = 
m©ch
.
	$m©ched_cŞumn_šdiûs
()

196 
unm©ched_ignÜed_ªchÜ_šdiûs
 = (
m©ch
.

197 
	$unm©ched_Ü_ignÜed_cŞumn_šdiûs
())

198 
m©ched_gt_šdiûs
 = 
m©ch
.
	$m©ched_row_šdiûs
()

199 
m©ched_ªchÜs
 = 
box_li¡_İs
.
	$g©h”
(
ªchÜs
,

200 
m©ched_ªchÜ_šdiûs
)

201 
m©ched_gt_boxes
 = 
box_li¡_İs
.
	$g©h”
(
groundŒuth_boxes
,

202 
m©ched_gt_šdiûs
)

203 
m©ched_»g_rg‘s
 = 
£lf
.
_box_cod”
.
	$’code
(
m©ched_gt_boxes
,

204 
m©ched_ªchÜs
)

205 
unm©ched_ignÜed_»g_rg‘s
 = 
tf
.
	`te
(

206 
£lf
.
	`_deçuÉ_»g»ssiÚ_rg‘
(),

207 
tf
.
	`¡ack
([tf.
	`size
(
unm©ched_ignÜed_ªchÜ_šdiûs
), 1]))

208 
»g_rg‘s
 = 
tf
.
	$dyÇmic_¡™ch
(

209 [
m©ched_ªchÜ_šdiûs
, 
unm©ched_ignÜed_ªchÜ_šdiûs
],

210 [
m©ched_»g_rg‘s
, 
unm©ched_ignÜed_»g_rg‘s
])

211 #TODO: 
summ¬ize
 
the
 
numb”
 
of
 
m©ches
 
Ú
 
av”age
.

212  
»g_rg‘s


214 
def
 
	$_deçuÉ_»g»ssiÚ_rg‘
(
£lf
):

217 
DeçuÉ
 
»g»ssiÚ
 
rg‘s
 
¬e
 
£t
 
to
 
	`z”o
 (
though
 
š


218 
this
 
im¶em’tiÚ
 
wh©
 
the£
 
rg‘s
 
¬e
 
£t
 
to
 
should


219 
nÙ
 
m©‹r
 
as
 
the
 
»g»ssiÚ
 
weight
 
of
 
ªy
 
box
 
£t
 
to


220 
»g»ss
 
to
 
the
  
rg‘
 
is
 
z”o
).

222 
R‘uºs
:

223 
deçuÉ_rg‘
: 
a
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [1, 
box_code_dim’siÚ
]

225  
tf
.
	$cÚ¡ªt
([
£lf
.
_box_cod”
.
code_size
*[0]], 
tf
.
æßt32
)

227 
def
 
	$_ü—‹_şassifiÿtiÚ_rg‘s
(
£lf
, 
groundŒuth_Ïb–s
, 
m©ch
):

230 
Assign
 
a
 
şassifiÿtiÚ
 
rg‘
 
of
 
—ch
 
ªchÜ
 
to
 
the
 
m©chšg


231 
groundŒuth
 
Ïb–
 
th©
 
is
 
´ovided
 
by
 
m©ch
. 
AnchÜs
h© 
¬e
 
nÙ
 
m©ched


232 
to
 
ªythšg
 
¬e
 
giv’
 
the
 
rg‘
 
£lf
.
_unm©ched_şs_rg‘


234 
Args
:

235 
groundŒuth_Ïb–s
: 
a
 
‹nsÜ
 
of
 
sh­e
 [
num_gt_boxes
, 
d_1
, ... 
d_k
]

236 
w™h
 
Ïb–s
 
—ch
 
of
 
the
 
ground_Œuth
 
boxes
. 
The
 
subsh­e


237 [
d_1
, ... 
d_k
] 
ÿn
 
be
 
	`em±y
 (
cÜ»¥Údšg
 
to
 
sÿÏr
 
Ïb–s
).

238 
m©ch
: 
a
 
m©ch”
.
M©ch
 
objeù
 
th©
 
´ovides
‡ 
m©chšg
 
b‘w“n
 
ªchÜs


239 
ªd
 
groundŒuth
 
boxes
.

241 
R‘uºs
:

242 
şs_rg‘s
: 
a
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
num_ªchÜs
, 
d_1
, 
d_2
 ... 
d_k
],

243 
wh”e
 
the
 
subsh­e
 [
d_1
, ..., 
d_k
] 
is
 
com·tibË
 
w™h
 
groundŒuth_Ïb–s


244 
which
 
has
 
sh­e
 [
num_gt_boxes
, 
d_1
, 
d_2
, ... 
d_k
].

246 
m©ched_ªchÜ_šdiûs
 = 
m©ch
.
	$m©ched_cŞumn_šdiûs
()

247 
unm©ched_ignÜed_ªchÜ_šdiûs
 = (
m©ch
.

248 
	$unm©ched_Ü_ignÜed_cŞumn_šdiûs
())

249 
m©ched_gt_šdiûs
 = 
m©ch
.
	$m©ched_row_šdiûs
()

250 
m©ched_şs_rg‘s
 = 
tf
.
	$g©h”
(
groundŒuth_Ïb–s
, 
m©ched_gt_šdiûs
)

252 
Úes
 = 
£lf
.
_unm©ched_şs_rg‘
.
sh­e
.
ndims
 * [1]

253 
unm©ched_ignÜed_şs_rg‘s
 = 
tf
.
	`te
(

254 
tf
.
	`ex·nd_dims
(
£lf
.
_unm©ched_şs_rg‘
, 0),

255 
tf
.
	`¡ack
([tf.
	`size
(
unm©ched_ignÜed_ªchÜ_šdiûs
)] + 
Úes
))

257 
şs_rg‘s
 = 
tf
.
	$dyÇmic_¡™ch
(

258 [
m©ched_ªchÜ_šdiûs
, 
unm©ched_ignÜed_ªchÜ_šdiûs
],

259 [
m©ched_şs_rg‘s
, 
unm©ched_ignÜed_şs_rg‘s
])

260  
şs_rg‘s


262 
def
 
	$_ü—‹_»g»ssiÚ_weights
(
£lf
, 
m©ch
):

265 
OÆy
 
pos™ive
 
ªchÜs
 
¬e
 
£t
 
to
 
cÚŒibu‹
Ø
the
 
»g»ssiÚ
 
loss
, 
so
 
this


266 
m‘hod
 
»tuºs
 
a
 
weight
 
of
 1 
ev”y
 
pos™ive
 
ªchÜ
 
ªd
 0 every

267 
Ãg©ive
 
ªchÜ
.

269 
Args
:

270 
m©ch
: 
a
 
m©ch”
.
M©ch
 
objeù
 
th©
 
´ovides
‡ 
m©chšg
 
b‘w“n
 
ªchÜs


271 
ªd
 
groundŒuth
 
boxes
.

273 
R‘uºs
:

274 
»g_weights
: 
a
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
num_ªchÜs
] 
»´e£Ášg


275 
»g»ssiÚ
 
weights


277 
»g_weights
 = 
tf
.
	`ÿ¡
(
m©ch
.
	`m©ched_cŞumn_šdiÿtÜ
(),f.
æßt32
)

278  
»g_weights


280 
def
 
	$_ü—‹_şassifiÿtiÚ_weights
(
£lf
,

281 
m©ch
,

282 
pos™ive_şass_weight
=1.0,

283 
Ãg©ive_şass_weight
=1.0):

286 
	$Pos™ive
 (
m©ched
è
ªchÜs
 
¬e
 
assocŸ‹d
 
w™h
 
a
 
weight
 
of


287 
pos™ive_şass_weight
 
ªd
 
	$Ãg©ive
 (
unm©ched
è
ªchÜs
 
¬e
 
assocŸ‹d
 
w™h


288 
a
 
weight
 
of
 
Ãg©ive_şass_weight
. 
Wh’
 
ªchÜs
 
¬e
 
ignÜed
, 
weights
‡» 
£t


289 
to
 
z”o
. 
By
 , 
bÙh
 
pos™ive
/
Ãg©ive
 
weights
 
¬e
 
£t
o 1.0,

290 
but
 
they
 
ÿn
 
be
 
adju¡ed
 
to
 
hªdË
 
şass
 
	`imb®ªû
 (
which
 
is
 
®mo¡
 
®ways


291 
the
 
š
 
objeù
 
d‘eùiÚ
).

293 
Args
:

294 
m©ch
: 
a
 
m©ch”
.
M©ch
 
objeù
 
th©
 
´ovides
‡ 
m©chšg
 
b‘w“n
 
ªchÜs


295 
ªd
 
groundŒuth
 
boxes
.

296 
pos™ive_şass_weight
: 
weight
 
to
 
be
 
assocŸ‹d
Ø
pos™ive
 
ªchÜs


297 
Ãg©ive_şass_weight
: 
weight
 
to
 
be
 
assocŸ‹d
Ø
Ãg©ive
 
ªchÜs


299 
R‘uºs
:

300 
şs_weights
: 
a
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
num_ªchÜs
] 
»´e£Ášg


301 
şassifiÿtiÚ
 
weights
.

303 
m©ched_šdiÿtÜ
 = 
tf
.
	`ÿ¡
(
m©ch
.
	`m©ched_cŞumn_šdiÿtÜ
(),f.
æßt32
)

304 
ignÜe_šdiÿtÜ
 = 
tf
.
	`ÿ¡
(
m©ch
.
	`ignÜed_cŞumn_šdiÿtÜ
(),f.
æßt32
)

305 
unm©ched_šdiÿtÜ
 = 1.0 - 
m©ched_šdiÿtÜ
 - 
ignÜe_šdiÿtÜ


306 
şs_weights
 = (
pos™ive_şass_weight
 * 
m©ched_šdiÿtÜ


307 + 
Ãg©ive_şass_weight
 * 
unm©ched_šdiÿtÜ
)

308  
şs_weights


310 
def
 
	$g‘_box_cod”
(
£lf
):

313 
R‘uºs
:

314 
BoxCod”
: BoxCod” 
objeù
.

316  
£lf
.
_box_cod”


319 #TODO: 
This
 
m‘hod
 
puÎs
 
š
 
®l
 
the
 
im¶em’tiÚ
 
d•’d’c›s
 
što
 
cÜe
.

320 #Th”efÜ
™s
 
be¡
 
to
 
have
 
this
 
çùÜy
 
m‘hod
 
outside
 
of
 
cÜe
.

321 
def
 
	$ü—‹_rg‘_assigÃr
(
»ã»nû
, 
¡age
=
NÚe
,

322 
pos™ive_şass_weight
=1.0,

323 
Ãg©ive_şass_weight
=1.0,

324 
unm©ched_şs_rg‘
=
NÚe
):

327 
Args
:

328 
»ã»nû
: 
¡ršg
 
»ã»ncšg
 
the
 
ty³
 
of
 
T¬g‘AssigÃr
.

329 
¡age
: 
¡ršg
 
d’Ùšg
 sge: {
´İo§l
, 
d‘eùiÚ
}.

330 
pos™ive_şass_weight
: 
şassifiÿtiÚ
 
weight
 
to
 
be
 
assocŸ‹d
Ø
pos™ive


331 
	$ªchÜs
 (: 1.0)

332 
Ãg©ive_şass_weight
: 
şassifiÿtiÚ
 
weight
 
to
 
be
 
assocŸ‹d
Ø
Ãg©ive


333 
	$ªchÜs
 (: 1.0)

334 
unm©ched_şs_rg‘
: 
a
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
d_1
, 
d_2
, ..., 
d_k
]

335 
which
 
is
 
cÚsi¡’t
 
w™h
 
the
 
şassifiÿtiÚ
 
rg‘
 
—ch


336 
	`ªchÜ
 (
ªd
 
ÿn
 
be
 
em±y
 
sÿÏr
 
rg‘s
). 
This
 
sh­e
 
mu¡
 
thus
 be

337 
com·tibË
 
w™h
 
the
 
groundŒuth
 
Ïb–s
 
th©
 
¬e
 
·s£d
 
to
h
Assign


338 
	`funùiÚ
 (
which
 
have
 
sh­e
 [
num_gt_boxes
, 
d_1
, 
d_2
, ..., 
d_k
]).

339 
If
 
£t
 
to
 
NÚe
, 
unm©ched_şs_rg‘
 
is
 s‘Ø
be
 0 
—ch
 
ªchÜ
.

341 
R‘uºs
:

342 
T¬g‘AssigÃr
: 
desœed
 
rg‘
 
assigÃr
.

344 
Rai£s
:

345 
V®ueE¼Ü
: 
combš©iÚ
 
»ã»nû
+
¡age
 
is
 
šv®id
.

347 
»ã»nû
 =ğ'MuÉibox' 
ªd
 
¡age
 == 'proposal':

348 
sim¬™y_ÿlc
 = 
sim_ÿlc
.
	$NegSqDi¡Sim¬™y
()

349 
m©ch”
 = 
b¬t™e_m©ch”
.
	$G»edyB¬t™eM©ch”
()

350 
box_cod”
 = 
m—n_¡ddev_box_cod”
.
	$M—nStddevBoxCod”
()

352 
–if
 
»ã»nû
 =ğ'Fa¡”RCNN' 
ªd
 
¡age
 == 'proposal':

353 
sim¬™y_ÿlc
 = 
sim_ÿlc
.
	$IouSim¬™y
()

354 
m©ch”
 = 
¬gmax_m©ch”
.
	$ArgMaxM©ch”
(
m©ched_th»shŞd
=0.7,

355 
unm©ched_th»shŞd
=0.3,

356 
fÜû_m©ch_fÜ_—ch_row
=
True
)

357 
box_cod”
 = 
ç¡”_rún_box_cod”
.
	$Fa¡”RúnBoxCod”
(

358 
sÿË_çùÜs
=[10.0, 10.0, 5.0, 5.0])

360 
–if
 
»ã»nû
 =ğ'Fa¡”RCNN' 
ªd
 
¡age
 == 'detection':

361 
sim¬™y_ÿlc
 = 
sim_ÿlc
.
	$IouSim¬™y
()

362 #U£ 
®l
 
´İo§ls
 
w™h
 
IOU
 < 0.5 
as
 
ÿndid©e
 
Ãg©ives
.

363 
m©ch”
 = 
¬gmax_m©ch”
.
	$ArgMaxM©ch”
(
m©ched_th»shŞd
=0.5,

364 
Ãg©ives_low”_thª_unm©ched
=
True
)

365 
box_cod”
 = 
ç¡”_rún_box_cod”
.
	$Fa¡”RúnBoxCod”
(

366 
sÿË_çùÜs
=[10.0, 10.0, 5.0, 5.0])

368 
–if
 
»ã»nû
 == 'FastRCNN':

369 
sim¬™y_ÿlc
 = 
sim_ÿlc
.
	$IouSim¬™y
()

370 
m©ch”
 = 
¬gmax_m©ch”
.
	$ArgMaxM©ch”
(
m©ched_th»shŞd
=0.5,

371 
unm©ched_th»shŞd
=0.1,

372 
fÜû_m©ch_fÜ_—ch_row
=
F®£
,

373 
Ãg©ives_low”_thª_unm©ched
=
F®£
)

374 
box_cod”
 = 
ç¡”_rún_box_cod”
.
	$Fa¡”RúnBoxCod”
()

377 
¿i£
 
	`V®ueE¼Ü
('No valid combination of„eference‡nd stage.')

379  
	$T¬g‘AssigÃr
(
sim¬™y_ÿlc
, 
m©ch”
, 
box_cod”
,

380 
pos™ive_şass_weight
=positive_class_weight,

381 
Ãg©ive_şass_weight
=negative_class_weight,

382 
unm©ched_şs_rg‘
=unmatched_cls_target)

385 
def
 
	$b©ch_assign_rg‘s
(
rg‘_assigÃr
,

386 
ªchÜs_b©ch
,

387 
gt_box_b©ch
,

388 
gt_şass_rg‘s_b©ch
):

391 
Args
:

392 
rg‘_assigÃr
: 
a
 
rg‘
 
assigÃr
.

393 
ªchÜs_b©ch
: 
BoxLi¡
 
»´e£Ášg
 
N
 
box
 
ªchÜs
 
Ü
 
li¡
 
of
 BoxLi¡ 
objeùs


394 
w™h
 
Ëngth
 
b©ch_size
 
»´e£Ášg
 
ªchÜ
 
£ts
.

395 
gt_box_b©ch
: 
a
 
li¡
 
of
 
BoxLi¡
 
objeùs
 
w™h
 
Ëngth
 
b©ch_size


396 
»´e£Ášg
 
groundŒuth
 
boxes
 
—ch
 
image
 
š
 
the
 
b©ch


397 
gt_şass_rg‘s_b©ch
: 
a
 
li¡
 
of
 
‹nsÜs
 
w™h
 
Ëngth
 
b©ch_size
, 
wh”e


398 
—ch
 
‹nsÜ
 
has
 
sh­e
 [
num_gt_boxes_i
, 
şassifiÿtiÚ_rg‘_size
] 
ªd


399 
num_gt_boxes_i
 
is
 
the
 
numb”
 
of
 
boxes
 
š
h
™h
 
boxli¡
 of

400 
gt_box_b©ch
.

402 
R‘uºs
:

403 
b©ch_şs_rg‘s
: 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

404 
num_şas£s
],

405 
b©ch_şs_weights
: 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
],

406 
b©ch_»g_rg‘s
: 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

407 
box_code_dim’siÚ
]

408 
b©ch_»g_weights
: 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
],

409 
m©ch_li¡
: 
a
 
li¡
 
of
 
m©ch”
.
M©ch
 
objeùs
 
’codšg
 
the
 
m©ch
 
b‘w“n


410 
ªchÜs
 
ªd
 
groundŒuth
 
boxes
 
—ch
 
image
 
of
 
the
 
b©ch
,

411 
w™h
 
rows
 
of
 
the
 
M©ch
 
objeùs
 
cÜ»¥Údšg
 
to
 
groundŒuth
 
boxes


412 
ªd
 
cŞumns
 
cÜ»¥Údšg
 
to
 
ªchÜs
.

413 
Rai£s
:

414 
V®ueE¼Ü
: 
šput
 
li¡
 
Ëngths
 
¬e
 
šcÚsi¡’t
, 
i
.
e
.,

415 
b©ch_size
 =ğ
	`Ën
(
gt_box_b©ch
è=ğ
	$Ën
(
gt_şass_rg‘s_b©ch
)

416 
ªd
 
b©ch_size
 =ğ
	$Ën
(
ªchÜs_b©ch
è
uÆess
‡nchÜs_b©ch 
is
 
a
 
sšgË


417 
BoxLi¡
.

419 
nÙ
 
	$isš¡ªû
(
ªchÜs_b©ch
, 
li¡
):

420 
ªchÜs_b©ch
 = 
	`Ën
(
gt_box_b©ch
) * [anchors_batch]

421 
nÙ
 
	`®l
(

422 
	$isš¡ªû
(
ªchÜs
, 
box_li¡
.
BoxLi¡
èªchÜ 
š
 
ªchÜs_b©ch
):

423 
¿i£
 
	`V®ueE¼Ü
('anchors_batch must be‡ BoxList or†ist of BoxLists.')

424 
	`nÙ
 (
	`Ën
(
ªchÜs_b©ch
)

425 =ğ
	`Ën
(
gt_box_b©ch
)

426 =ğ
	$Ën
(
gt_şass_rg‘s_b©ch
)):

427 
¿i£
 
	`V®ueE¼Ü
('batch size incompatible with†engths of‡nchors_batch, '

429 
şs_rg‘s_li¡
 = []

430 
şs_weights_li¡
 = []

431 
»g_rg‘s_li¡
 = []

432 
»g_weights_li¡
 = []

433 
m©ch_li¡
 = []

434 
ªchÜs
, 
gt_boxes
, 
gt_şass_rg‘s
 
š
 
	$z
(

435 
ªchÜs_b©ch
, 
gt_box_b©ch
, 
gt_şass_rg‘s_b©ch
):

436 (
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
,

437 
»g_weights
, 
m©ch
èğ
rg‘_assigÃr
.
	$assign
(

438 
ªchÜs
, 
gt_boxes
, 
gt_şass_rg‘s
)

439 
şs_rg‘s_li¡
.
	$­³nd
(
şs_rg‘s
)

440 
şs_weights_li¡
.
	$­³nd
(
şs_weights
)

441 
»g_rg‘s_li¡
.
	$­³nd
(
»g_rg‘s
)

442 
»g_weights_li¡
.
	$­³nd
(
»g_weights
)

443 
m©ch_li¡
.
	$­³nd
(
m©ch
)

444 
b©ch_şs_rg‘s
 = 
tf
.
	$¡ack
(
şs_rg‘s_li¡
)

445 
b©ch_şs_weights
 = 
tf
.
	$¡ack
(
şs_weights_li¡
)

446 
b©ch_»g_rg‘s
 = 
tf
.
	$¡ack
(
»g_rg‘s_li¡
)

447 
b©ch_»g_weights
 = 
tf
.
	$¡ack
(
»g_weights_li¡
)

448  (
b©ch_şs_rg‘s
, 
b©ch_şs_weights
, 
b©ch_»g_rg‘s
,

449 
b©ch_»g_weights
, 
m©ch_li¡
)

	@core/target_assigner_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
numpy
 
as
 
Å


18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
box_cod”s
 
impÜt
 
m—n_¡ddev_box_cod”


21 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


22 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
»giÚ_sim¬™y_ÿlcuÏtÜ


23 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
rg‘_assigÃr
 
as
 
rg‘assigÃr


24 
äom
 
	gobjeù_d‘eùiÚ
.
m©ch”s
 
impÜt
 
¬gmax_m©ch”


25 
äom
 
	gobjeù_d‘eùiÚ
.
m©ch”s
 
impÜt
 
b¬t™e_m©ch”


28 
şass
 
	$T¬g‘AssigÃrTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

30 
def
 
	$‹¡_assign_agno¡ic
(
£lf
):

31 
sim¬™y_ÿlc
 = 
»giÚ_sim¬™y_ÿlcuÏtÜ
.
	$NegSqDi¡Sim¬™y
()

32 
m©ch”
 = 
b¬t™e_m©ch”
.
	$G»edyB¬t™eM©ch”
()

33 
box_cod”
 = 
m—n_¡ddev_box_cod”
.
	$M—nStddevBoxCod”
()

34 
rg‘_assigÃr
 = 
rg‘assigÃr
.
	$T¬g‘AssigÃr
(

35 
sim¬™y_ÿlc
, 
m©ch”
, 
box_cod”
, 
unm©ched_şs_rg‘
=
NÚe
)

37 
´iÜ_m—ns
 = 
tf
.
	$cÚ¡ªt
([[0.0, 0.0, 0.5, 0.5],

40 
´iÜ_¡ddevs
 = 
tf
.
	$cÚ¡ªt
(3 * [4 * [.1]])

41 
´iÜs
 = 
box_li¡
.
	$BoxLi¡
(
´iÜ_m—ns
)

42 
´iÜs
.
	`add_f›ld
('¡ddev', 
´iÜ_¡ddevs
)

44 
box_cÜÃrs
 = [[0.0, 0.0, 0.5, 0.5], [0.5, 0.5, 0.9, 0.9]]

45 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
box_cÜÃrs
))

46 
exp_şs_rg‘s
 = [[1], [1], [0]]

47 
exp_şs_weights
 = [1, 1, 1]

48 
exp_»g_rg‘s
 = [[0, 0, 0, 0],

51 
exp_»g_weights
 = [1, 1, 0]

52 
exp_m©chšg_ªchÜs
 = [0, 1]

54 
»suÉ
 = 
rg‘_assigÃr
.
	$assign
(
´iÜs
, 
boxes
, 
num_v®id_rows
=2)

55 (
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
, 
m©ch
èğ
»suÉ


57 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

58 (
şs_rg‘s_out
, 
şs_weights_out
,

59 
»g_rg‘s_out
, 
»g_weights_out
, 
m©chšg_ªchÜs_out
èğ
£ss
.
	`run
(

60 [
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
,

61 
m©ch
.
	`m©ched_cŞumn_šdiûs
()])

63 
£lf
.
	$as£¹AÎClo£
(
şs_rg‘s_out
, 
exp_şs_rg‘s
)

64 
£lf
.
	$as£¹AÎClo£
(
şs_weights_out
, 
exp_şs_weights
)

65 
£lf
.
	$as£¹AÎClo£
(
»g_rg‘s_out
, 
exp_»g_rg‘s
)

66 
£lf
.
	$as£¹AÎClo£
(
»g_weights_out
, 
exp_»g_weights
)

67 
£lf
.
	$as£¹AÎClo£
(
m©chšg_ªchÜs_out
, 
exp_m©chšg_ªchÜs
)

68 
£lf
.
	$as£¹Equ®s
(
şs_rg‘s_out
.
dty³
, 
Å
.
æßt32
)

69 
£lf
.
	$as£¹Equ®s
(
şs_weights_out
.
dty³
, 
Å
.
æßt32
)

70 
£lf
.
	$as£¹Equ®s
(
»g_rg‘s_out
.
dty³
, 
Å
.
æßt32
)

71 
£lf
.
	$as£¹Equ®s
(
»g_weights_out
.
dty³
, 
Å
.
æßt32
)

72 
£lf
.
	$as£¹Equ®s
(
m©chšg_ªchÜs_out
.
dty³
, 
Å
.
št32
)

74 
def
 
	$‹¡_assign_w™h_ignÜed_m©ches
(
£lf
):

75 #NÙe: 
‹¡
 
is
 
v”y
 
sim¬
 
to
 
above
. 
The
 
thœd
 
box
 
m©ched
 
w™h
 
ª
 
IOU


76 #oà0.35, 
which
 
is
 
b‘w“n
 
the
 
m©ched
 
ªd
 
unm©ched
 
th»shŞd
. 
This
 
m—ns


77 #Th© 
like
 
above
 
the
 
ex³ùed
 
şassifiÿtiÚ
 
rg‘s
 
¬e
 [1, 1, 0].

78 #UÆik
above
, 
the
 
thœd
 
rg‘
 
is
 
ignÜed
 
ªd
 
th”efÜe
 
ex³ùed


79 #şassifiÿtiÚ 
weights
 
¬e
 [1, 1, 0].

80 
sim¬™y_ÿlc
 = 
»giÚ_sim¬™y_ÿlcuÏtÜ
.
	$IouSim¬™y
()

81 
m©ch”
 = 
¬gmax_m©ch”
.
	$ArgMaxM©ch”
(
m©ched_th»shŞd
=0.5,

82 
unm©ched_th»shŞd
=0.3)

83 
box_cod”
 = 
m—n_¡ddev_box_cod”
.
	$M—nStddevBoxCod”
()

84 
rg‘_assigÃr
 = 
rg‘assigÃr
.
	$T¬g‘AssigÃr
(

85 
sim¬™y_ÿlc
, 
m©ch”
, 
box_cod”
)

87 
´iÜ_m—ns
 = 
tf
.
	$cÚ¡ªt
([[0.0, 0.0, 0.5, 0.5],

90 
´iÜ_¡ddevs
 = 
tf
.
	$cÚ¡ªt
(3 * [4 * [.1]])

91 
´iÜs
 = 
box_li¡
.
	$BoxLi¡
(
´iÜ_m—ns
)

92 
´iÜs
.
	`add_f›ld
('¡ddev', 
´iÜ_¡ddevs
)

94 
box_cÜÃrs
 = [[0.0, 0.0, 0.5, 0.5],

96 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
box_cÜÃrs
))

97 
exp_şs_rg‘s
 = [[1], [1], [0]]

98 
exp_şs_weights
 = [1, 1, 0]

99 
exp_»g_rg‘s
 = [[0, 0, 0, 0],

102 
exp_»g_weights
 = [1, 1, 0]

103 
exp_m©chšg_ªchÜs
 = [0, 1]

105 
»suÉ
 = 
rg‘_assigÃr
.
	$assign
(
´iÜs
, 
boxes
)

106 (
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
, 
m©ch
èğ
»suÉ


107 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

108 (
şs_rg‘s_out
, 
şs_weights_out
,

109 
»g_rg‘s_out
, 
»g_weights_out
, 
m©chšg_ªchÜs_out
èğ
£ss
.
	`run
(

110 [
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
,

111 
m©ch
.
	`m©ched_cŞumn_šdiûs
()])

113 
£lf
.
	$as£¹AÎClo£
(
şs_rg‘s_out
, 
exp_şs_rg‘s
)

114 
£lf
.
	$as£¹AÎClo£
(
şs_weights_out
, 
exp_şs_weights
)

115 
£lf
.
	$as£¹AÎClo£
(
»g_rg‘s_out
, 
exp_»g_rg‘s
)

116 
£lf
.
	$as£¹AÎClo£
(
»g_weights_out
, 
exp_»g_weights
)

117 
£lf
.
	$as£¹AÎClo£
(
m©chšg_ªchÜs_out
, 
exp_m©chšg_ªchÜs
)

118 
£lf
.
	$as£¹Equ®s
(
şs_rg‘s_out
.
dty³
, 
Å
.
æßt32
)

119 
£lf
.
	$as£¹Equ®s
(
şs_weights_out
.
dty³
, 
Å
.
æßt32
)

120 
£lf
.
	$as£¹Equ®s
(
»g_rg‘s_out
.
dty³
, 
Å
.
æßt32
)

121 
£lf
.
	$as£¹Equ®s
(
»g_weights_out
.
dty³
, 
Å
.
æßt32
)

122 
£lf
.
	$as£¹Equ®s
(
m©chšg_ªchÜs_out
.
dty³
, 
Å
.
št32
)

124 
def
 
	$‹¡_assign_muÉişass
(
£lf
):

125 
sim¬™y_ÿlc
 = 
»giÚ_sim¬™y_ÿlcuÏtÜ
.
	$NegSqDi¡Sim¬™y
()

126 
m©ch”
 = 
b¬t™e_m©ch”
.
	$G»edyB¬t™eM©ch”
()

127 
box_cod”
 = 
m—n_¡ddev_box_cod”
.
	$M—nStddevBoxCod”
()

128 
unm©ched_şs_rg‘
 = 
tf
.
	$cÚ¡ªt
([1, 0, 0, 0, 0, 0, 0], 
tf
.
æßt32
)

129 
rg‘_assigÃr
 = 
rg‘assigÃr
.
	$T¬g‘AssigÃr
(

130 
sim¬™y_ÿlc
, 
m©ch”
, 
box_cod”
,

131 
unm©ched_şs_rg‘
=unmatched_cls_target)

133 
´iÜ_m—ns
 = 
tf
.
	$cÚ¡ªt
([[0.0, 0.0, 0.5, 0.5],

137 
´iÜ_¡ddevs
 = 
tf
.
	$cÚ¡ªt
(4 * [4 * [.1]])

138 
´iÜs
 = 
box_li¡
.
	$BoxLi¡
(
´iÜ_m—ns
)

139 
´iÜs
.
	`add_f›ld
('¡ddev', 
´iÜ_¡ddevs
)

141 
box_cÜÃrs
 = [[0.0, 0.0, 0.5, 0.5],

144 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
box_cÜÃrs
))

146 
groundŒuth_Ïb–s
 = 
tf
.
	$cÚ¡ªt
([[0, 1, 0, 0, 0, 0, 0],

148 [0, 0, 0, 1, 0, 0, 0]], 
tf
.
æßt32
)

150 
exp_şs_rg‘s
 = [[0, 1, 0, 0, 0, 0, 0],

154 
exp_şs_weights
 = [1, 1, 1, 1]

155 
exp_»g_rg‘s
 = [[0, 0, 0, 0],

159 
exp_»g_weights
 = [1, 1, 0, 1]

160 
exp_m©chšg_ªchÜs
 = [0, 1, 3]

162 
»suÉ
 = 
rg‘_assigÃr
.
	$assign
(
´iÜs
, 
boxes
, 
groundŒuth_Ïb–s
,

163 
num_v®id_rows
=3)

164 (
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
, 
m©ch
èğ
»suÉ


165 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

166 (
şs_rg‘s_out
, 
şs_weights_out
,

167 
»g_rg‘s_out
, 
»g_weights_out
, 
m©chšg_ªchÜs_out
èğ
£ss
.
	`run
(

168 [
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
,

169 
m©ch
.
	`m©ched_cŞumn_šdiûs
()])

171 
£lf
.
	$as£¹AÎClo£
(
şs_rg‘s_out
, 
exp_şs_rg‘s
)

172 
£lf
.
	$as£¹AÎClo£
(
şs_weights_out
, 
exp_şs_weights
)

173 
£lf
.
	$as£¹AÎClo£
(
»g_rg‘s_out
, 
exp_»g_rg‘s
)

174 
£lf
.
	$as£¹AÎClo£
(
»g_weights_out
, 
exp_»g_weights
)

175 
£lf
.
	$as£¹AÎClo£
(
m©chšg_ªchÜs_out
, 
exp_m©chšg_ªchÜs
)

176 
£lf
.
	$as£¹Equ®s
(
şs_rg‘s_out
.
dty³
, 
Å
.
æßt32
)

177 
£lf
.
	$as£¹Equ®s
(
şs_weights_out
.
dty³
, 
Å
.
æßt32
)

178 
£lf
.
	$as£¹Equ®s
(
»g_rg‘s_out
.
dty³
, 
Å
.
æßt32
)

179 
£lf
.
	$as£¹Equ®s
(
»g_weights_out
.
dty³
, 
Å
.
æßt32
)

180 
£lf
.
	$as£¹Equ®s
(
m©chšg_ªchÜs_out
.
dty³
, 
Å
.
št32
)

182 
def
 
	$‹¡_assign_muÉişass_uÃqu®_şass_weights
(
£lf
):

183 
sim¬™y_ÿlc
 = 
»giÚ_sim¬™y_ÿlcuÏtÜ
.
	$NegSqDi¡Sim¬™y
()

184 
m©ch”
 = 
b¬t™e_m©ch”
.
	$G»edyB¬t™eM©ch”
()

185 
box_cod”
 = 
m—n_¡ddev_box_cod”
.
	$M—nStddevBoxCod”
()

186 
unm©ched_şs_rg‘
 = 
tf
.
	$cÚ¡ªt
([1, 0, 0, 0, 0, 0, 0], 
tf
.
æßt32
)

187 
rg‘_assigÃr
 = 
rg‘assigÃr
.
	$T¬g‘AssigÃr
(

188 
sim¬™y_ÿlc
, 
m©ch”
, 
box_cod”
,

189 
pos™ive_şass_weight
=1.0, 
Ãg©ive_şass_weight
=0.5,

190 
unm©ched_şs_rg‘
=unmatched_cls_target)

192 
´iÜ_m—ns
 = 
tf
.
	$cÚ¡ªt
([[0.0, 0.0, 0.5, 0.5],

196 
´iÜ_¡ddevs
 = 
tf
.
	$cÚ¡ªt
(4 * [4 * [.1]])

197 
´iÜs
 = 
box_li¡
.
	$BoxLi¡
(
´iÜ_m—ns
)

198 
´iÜs
.
	`add_f›ld
('¡ddev', 
´iÜ_¡ddevs
)

200 
box_cÜÃrs
 = [[0.0, 0.0, 0.5, 0.5],

203 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
box_cÜÃrs
))

205 
groundŒuth_Ïb–s
 = 
tf
.
	$cÚ¡ªt
([[0, 1, 0, 0, 0, 0, 0],

207 [0, 0, 0, 1, 0, 0, 0]], 
tf
.
æßt32
)

209 
exp_şs_weights
 = [1, 1, .5, 1]

210 
»suÉ
 = 
rg‘_assigÃr
.
	$assign
(
´iÜs
, 
boxes
, 
groundŒuth_Ïb–s
,

211 
num_v®id_rows
=3)

212 (
_
, 
şs_weights
, _, _, _èğ
»suÉ


213 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

214 
şs_weights_out
 = 
£ss
.
	$run
(
şs_weights
)

215 
£lf
.
	$as£¹AÎClo£
(
şs_weights_out
, 
exp_şs_weights
)

217 
def
 
	$‹¡_assign_muÉidim’siÚ®_şass_rg‘s
(
£lf
):

218 
sim¬™y_ÿlc
 = 
»giÚ_sim¬™y_ÿlcuÏtÜ
.
	$NegSqDi¡Sim¬™y
()

219 
m©ch”
 = 
b¬t™e_m©ch”
.
	$G»edyB¬t™eM©ch”
()

220 
box_cod”
 = 
m—n_¡ddev_box_cod”
.
	$M—nStddevBoxCod”
()

221 
unm©ched_şs_rg‘
 = 
tf
.
	$cÚ¡ªt
([[0, 0], [0, 0]], 
tf
.
æßt32
)

222 
rg‘_assigÃr
 = 
rg‘assigÃr
.
	$T¬g‘AssigÃr
(

223 
sim¬™y_ÿlc
, 
m©ch”
, 
box_cod”
,

224 
unm©ched_şs_rg‘
=unmatched_cls_target)

226 
´iÜ_m—ns
 = 
tf
.
	$cÚ¡ªt
([[0.0, 0.0, 0.5, 0.5],

230 
´iÜ_¡ddevs
 = 
tf
.
	$cÚ¡ªt
(4 * [4 * [.1]])

231 
´iÜs
 = 
box_li¡
.
	$BoxLi¡
(
´iÜ_m—ns
)

232 
´iÜs
.
	`add_f›ld
('¡ddev', 
´iÜ_¡ddevs
)

234 
box_cÜÃrs
 = [[0.0, 0.0, 0.5, 0.5],

237 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
box_cÜÃrs
))

239 
groundŒuth_Ïb–s
 = 
tf
.
	$cÚ¡ªt
([[[0, 1], [1, 0]],

241 [[0, 1], [1, .5]]], 
tf
.
æßt32
)

243 
exp_şs_rg‘s
 = [[[0, 1], [1, 0]],

247 
exp_şs_weights
 = [1, 1, 1, 1]

248 
exp_»g_rg‘s
 = [[0, 0, 0, 0],

252 
exp_»g_weights
 = [1, 1, 0, 1]

253 
exp_m©chšg_ªchÜs
 = [0, 1, 3]

255 
»suÉ
 = 
rg‘_assigÃr
.
	$assign
(
´iÜs
, 
boxes
, 
groundŒuth_Ïb–s
,

256 
num_v®id_rows
=3)

257 (
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
, 
m©ch
èğ
»suÉ


258 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

259 (
şs_rg‘s_out
, 
şs_weights_out
,

260 
»g_rg‘s_out
, 
»g_weights_out
, 
m©chšg_ªchÜs_out
èğ
£ss
.
	`run
(

261 [
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
,

262 
m©ch
.
	`m©ched_cŞumn_šdiûs
()])

264 
£lf
.
	$as£¹AÎClo£
(
şs_rg‘s_out
, 
exp_şs_rg‘s
)

265 
£lf
.
	$as£¹AÎClo£
(
şs_weights_out
, 
exp_şs_weights
)

266 
£lf
.
	$as£¹AÎClo£
(
»g_rg‘s_out
, 
exp_»g_rg‘s
)

267 
£lf
.
	$as£¹AÎClo£
(
»g_weights_out
, 
exp_»g_weights
)

268 
£lf
.
	$as£¹AÎClo£
(
m©chšg_ªchÜs_out
, 
exp_m©chšg_ªchÜs
)

269 
£lf
.
	$as£¹Equ®s
(
şs_rg‘s_out
.
dty³
, 
Å
.
æßt32
)

270 
£lf
.
	$as£¹Equ®s
(
şs_weights_out
.
dty³
, 
Å
.
æßt32
)

271 
£lf
.
	$as£¹Equ®s
(
»g_rg‘s_out
.
dty³
, 
Å
.
æßt32
)

272 
£lf
.
	$as£¹Equ®s
(
»g_weights_out
.
dty³
, 
Å
.
æßt32
)

273 
£lf
.
	$as£¹Equ®s
(
m©chšg_ªchÜs_out
.
dty³
, 
Å
.
št32
)

275 
def
 
	$‹¡_assign_em±y_groundŒuth
(
£lf
):

276 
sim¬™y_ÿlc
 = 
»giÚ_sim¬™y_ÿlcuÏtÜ
.
	$NegSqDi¡Sim¬™y
()

277 
m©ch”
 = 
b¬t™e_m©ch”
.
	$G»edyB¬t™eM©ch”
()

278 
box_cod”
 = 
m—n_¡ddev_box_cod”
.
	$M—nStddevBoxCod”
()

279 
unm©ched_şs_rg‘
 = 
tf
.
	$cÚ¡ªt
([0, 0, 0], 
tf
.
æßt32
)

280 
rg‘_assigÃr
 = 
rg‘assigÃr
.
	$T¬g‘AssigÃr
(

281 
sim¬™y_ÿlc
, 
m©ch”
, 
box_cod”
,

282 
unm©ched_şs_rg‘
=unmatched_cls_target)

284 
´iÜ_m—ns
 = 
tf
.
	$cÚ¡ªt
([[0.0, 0.0, 0.5, 0.5],

288 
´iÜ_¡ddevs
 = 
tf
.
	$cÚ¡ªt
(4 * [4 * [.1]])

289 
´iÜs
 = 
box_li¡
.
	$BoxLi¡
(
´iÜ_m—ns
)

290 
´iÜs
.
	`add_f›ld
('¡ddev', 
´iÜ_¡ddevs
)

292 
box_cÜÃrs_ex·nded
 = 
tf
.
	$cÚ¡ªt
([[0.0, 0.0, 0.0, 0.0]])

293 
box_cÜÃrs
 = 
tf
.
	$¦iû
(
box_cÜÃrs_ex·nded
, [0, 0], [0, 4])

294 
boxes
 = 
box_li¡
.
	$BoxLi¡
(
box_cÜÃrs
)

296 
groundŒuth_Ïb–s_ex·nded
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 0]], 
tf
.
æßt32
)

297 
groundŒuth_Ïb–s
 = 
tf
.
	$¦iû
(
groundŒuth_Ïb–s_ex·nded
, [0, 0], [0, 3])

299 
exp_şs_rg‘s
 = [[0, 0, 0],

303 
exp_şs_weights
 = [1, 1, 1, 1]

304 
exp_»g_rg‘s
 = [[0, 0, 0, 0],

308 
exp_»g_weights
 = [0, 0, 0, 0]

309 
exp_m©chšg_ªchÜs
 = []

311 
»suÉ
 = 
rg‘_assigÃr
.
	$assign
(
´iÜs
, 
boxes
, 
groundŒuth_Ïb–s
)

312 (
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
, 
m©ch
èğ
»suÉ


313 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

314 (
şs_rg‘s_out
, 
şs_weights_out
,

315 
»g_rg‘s_out
, 
»g_weights_out
, 
m©chšg_ªchÜs_out
èğ
£ss
.
	`run
(

316 [
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
,

317 
m©ch
.
	`m©ched_cŞumn_šdiûs
()])

319 
£lf
.
	$as£¹AÎClo£
(
şs_rg‘s_out
, 
exp_şs_rg‘s
)

320 
£lf
.
	$as£¹AÎClo£
(
şs_weights_out
, 
exp_şs_weights
)

321 
£lf
.
	$as£¹AÎClo£
(
»g_rg‘s_out
, 
exp_»g_rg‘s
)

322 
£lf
.
	$as£¹AÎClo£
(
»g_weights_out
, 
exp_»g_weights
)

323 
£lf
.
	$as£¹AÎClo£
(
m©chšg_ªchÜs_out
, 
exp_m©chšg_ªchÜs
)

324 
£lf
.
	$as£¹Equ®s
(
şs_rg‘s_out
.
dty³
, 
Å
.
æßt32
)

325 
£lf
.
	$as£¹Equ®s
(
şs_weights_out
.
dty³
, 
Å
.
æßt32
)

326 
£lf
.
	$as£¹Equ®s
(
»g_rg‘s_out
.
dty³
, 
Å
.
æßt32
)

327 
£lf
.
	$as£¹Equ®s
(
»g_weights_out
.
dty³
, 
Å
.
æßt32
)

328 
£lf
.
	$as£¹Equ®s
(
m©chšg_ªchÜs_out
.
dty³
, 
Å
.
št32
)

330 
def
 
	$‹¡_¿i£s_”rÜ_Ú_šv®id_groundŒuth_Ïb–s
(
£lf
):

331 
sim¬™y_ÿlc
 = 
»giÚ_sim¬™y_ÿlcuÏtÜ
.
	$NegSqDi¡Sim¬™y
()

332 
m©ch”
 = 
b¬t™e_m©ch”
.
	$G»edyB¬t™eM©ch”
()

333 
box_cod”
 = 
m—n_¡ddev_box_cod”
.
	$M—nStddevBoxCod”
()

334 
unm©ched_şs_rg‘
 = 
tf
.
	$cÚ¡ªt
([[0, 0], [0, 0], [0, 0]], 
tf
.
æßt32
)

335 
rg‘_assigÃr
 = 
rg‘assigÃr
.
	$T¬g‘AssigÃr
(

336 
sim¬™y_ÿlc
, 
m©ch”
, 
box_cod”
,

337 
unm©ched_şs_rg‘
=unmatched_cls_target)

339 
´iÜ_m—ns
 = 
tf
.
	$cÚ¡ªt
([[0.0, 0.0, 0.5, 0.5]])

340 
´iÜ_¡ddevs
 = 
tf
.
	$cÚ¡ªt
([[1.0, 1.0, 1.0, 1.0]])

341 
´iÜs
 = 
box_li¡
.
	$BoxLi¡
(
´iÜ_m—ns
)

342 
´iÜs
.
	`add_f›ld
('¡ddev', 
´iÜ_¡ddevs
)

344 
box_cÜÃrs
 = [[0.0, 0.0, 0.5, 0.5],

347 
boxes
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
box_cÜÃrs
))

349 
groundŒuth_Ïb–s
 = 
tf
.
	$cÚ¡ªt
([[[0, 1], [1, 0]]], 
tf
.
æßt32
)

351 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

352 
rg‘_assigÃr
.
	$assign
(
´iÜs
, 
boxes
, 
groundŒuth_Ïb–s
,

353 
num_v®id_rows
=3)

356 
şass
 
	$B©chT¬g‘AssigÃrTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

358 
def
 
	$_g‘_agno¡ic_rg‘_assigÃr
(
£lf
):

359 
sim¬™y_ÿlc
 = 
»giÚ_sim¬™y_ÿlcuÏtÜ
.
	$NegSqDi¡Sim¬™y
()

360 
m©ch”
 = 
b¬t™e_m©ch”
.
	$G»edyB¬t™eM©ch”
()

361 
box_cod”
 = 
m—n_¡ddev_box_cod”
.
	$M—nStddevBoxCod”
()

362  
rg‘assigÃr
.
	$T¬g‘AssigÃr
(

363 
sim¬™y_ÿlc
, 
m©ch”
, 
box_cod”
,

364 
pos™ive_şass_weight
=1.0,

365 
Ãg©ive_şass_weight
=1.0,

366 
unm©ched_şs_rg‘
=
NÚe
)

368 
def
 
	$_g‘_muÉi_şass_rg‘_assigÃr
(
£lf
, 
num_şas£s
):

369 
sim¬™y_ÿlc
 = 
»giÚ_sim¬™y_ÿlcuÏtÜ
.
	$NegSqDi¡Sim¬™y
()

370 
m©ch”
 = 
b¬t™e_m©ch”
.
	$G»edyB¬t™eM©ch”
()

371 
box_cod”
 = 
m—n_¡ddev_box_cod”
.
	$M—nStddevBoxCod”
()

372 
unm©ched_şs_rg‘
 = 
tf
.
	`cÚ¡ªt
([1] + 
num_şas£s
 * [0],f.
æßt32
)

373  
rg‘assigÃr
.
	$T¬g‘AssigÃr
(

374 
sim¬™y_ÿlc
, 
m©ch”
, 
box_cod”
,

375 
pos™ive_şass_weight
=1.0,

376 
Ãg©ive_şass_weight
=1.0,

377 
unm©ched_şs_rg‘
=unmatched_cls_target)

379 
def
 
	$_g‘_muÉi_dim’siÚ®_rg‘_assigÃr
(
£lf
, 
rg‘_dim’siÚs
):

380 
sim¬™y_ÿlc
 = 
»giÚ_sim¬™y_ÿlcuÏtÜ
.
	$NegSqDi¡Sim¬™y
()

381 
m©ch”
 = 
b¬t™e_m©ch”
.
	$G»edyB¬t™eM©ch”
()

382 
box_cod”
 = 
m—n_¡ddev_box_cod”
.
	$M—nStddevBoxCod”
()

383 
unm©ched_şs_rg‘
 = 
tf
.
	`cÚ¡ªt
(
Å
.
	`z”os
(
rg‘_dim’siÚs
),

384 
tf
.
æßt32
)

385  
rg‘assigÃr
.
	$T¬g‘AssigÃr
(

386 
sim¬™y_ÿlc
, 
m©ch”
, 
box_cod”
,

387 
pos™ive_şass_weight
=1.0,

388 
Ãg©ive_şass_weight
=1.0,

389 
unm©ched_şs_rg‘
=unmatched_cls_target)

391 
def
 
	$‹¡_b©ch_assign_rg‘s
(
£lf
):

392 
box_li¡1
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
([[0., 0., 0.2, 0.2]]))

393 
box_li¡2
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(

398 
gt_box_b©ch
 = [
box_li¡1
, 
box_li¡2
]

399 
gt_şass_rg‘s
 = [
NÚe
, None]

401 
´iÜ_m—ns
 = 
tf
.
	$cÚ¡ªt
([[0, 0, .25, .25],

405 
´iÜ_¡ddevs
 = 
tf
.
	$cÚ¡ªt
([[.1, .1, .1, .1],

409 
´iÜs
 = 
box_li¡
.
	$BoxLi¡
(
´iÜ_m—ns
)

410 
´iÜs
.
	`add_f›ld
('¡ddev', 
´iÜ_¡ddevs
)

412 
exp_»g_rg‘s
 = [[[0, 0, -0.5, -0.5],

420 
exp_şs_weights
 = [[1, 1, 1, 1],

422 
exp_şs_rg‘s
 = [[[1], [0], [0], [0]],

424 
exp_»g_weights
 = [[1, 0, 0, 0],

426 
exp_m©ch_0
 = [0]

427 
exp_m©ch_1
 = [1, 2]

429 
agno¡ic_rg‘_assigÃr
 = 
£lf
.
	$_g‘_agno¡ic_rg‘_assigÃr
()

430 (
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
,

431 
m©ch_li¡
èğ
rg‘assigÃr
.
	$b©ch_assign_rg‘s
(

432 
agno¡ic_rg‘_assigÃr
, 
´iÜs
, 
gt_box_b©ch
, 
gt_şass_rg‘s
)

433 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
m©ch_li¡
, 
li¡
è
ªd
 
	`Ën
(match_list) == 2)

434 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

435 (
şs_rg‘s_out
, 
şs_weights_out
, 
»g_rg‘s_out
, 
»g_weights_out
,

436 
m©ch_out_0
, 
m©ch_out_1
èğ
£ss
.
	`run
([

437 
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
] + [

438 
m©ch
.
	$m©ched_cŞumn_šdiûs
(è
m©ch
 
š
 
m©ch_li¡
])

439 
£lf
.
	$as£¹AÎClo£
(
şs_rg‘s_out
, 
exp_şs_rg‘s
)

440 
£lf
.
	$as£¹AÎClo£
(
şs_weights_out
, 
exp_şs_weights
)

441 
£lf
.
	$as£¹AÎClo£
(
»g_rg‘s_out
, 
exp_»g_rg‘s
)

442 
£lf
.
	$as£¹AÎClo£
(
»g_weights_out
, 
exp_»g_weights
)

443 
£lf
.
	$as£¹AÎClo£
(
m©ch_out_0
, 
exp_m©ch_0
)

444 
£lf
.
	$as£¹AÎClo£
(
m©ch_out_1
, 
exp_m©ch_1
)

446 
def
 
	$‹¡_b©ch_assign_muÉişass_rg‘s
(
£lf
):

447 
box_li¡1
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
([[0., 0., 0.2, 0.2]]))

449 
box_li¡2
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(

454 
gt_box_b©ch
 = [
box_li¡1
, 
box_li¡2
]

456 
şass_rg‘s1
 = 
tf
.
	$cÚ¡ªt
([[0, 1, 0, 0]], 
tf
.
æßt32
)

457 
şass_rg‘s2
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 0, 1],

458 [0, 0, 1, 0]], 
tf
.
æßt32
)

460 
gt_şass_rg‘s
 = [
şass_rg‘s1
, 
şass_rg‘s2
]

462 
´iÜ_m—ns
 = 
tf
.
	$cÚ¡ªt
([[0, 0, .25, .25],

466 
´iÜ_¡ddevs
 = 
tf
.
	$cÚ¡ªt
([[.1, .1, .1, .1],

470 
´iÜs
 = 
box_li¡
.
	$BoxLi¡
(
´iÜ_m—ns
)

471 
´iÜs
.
	`add_f›ld
('¡ddev', 
´iÜ_¡ddevs
)

473 
exp_»g_rg‘s
 = [[[0, 0, -0.5, -0.5],

481 
exp_şs_weights
 = [[1, 1, 1, 1],

483 
exp_şs_rg‘s
 = [[[0, 1, 0, 0],

491 
exp_»g_weights
 = [[1, 0, 0, 0],

493 
exp_m©ch_0
 = [0]

494 
exp_m©ch_1
 = [1, 2]

496 
muÉişass_rg‘_assigÃr
 = 
£lf
.
	$_g‘_muÉi_şass_rg‘_assigÃr
(

497 
num_şas£s
=3)

499 (
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
,

500 
m©ch_li¡
èğ
rg‘assigÃr
.
	$b©ch_assign_rg‘s
(

501 
muÉişass_rg‘_assigÃr
, 
´iÜs
, 
gt_box_b©ch
, 
gt_şass_rg‘s
)

502 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
m©ch_li¡
, 
li¡
è
ªd
 
	`Ën
(match_list) == 2)

503 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

504 (
şs_rg‘s_out
, 
şs_weights_out
, 
»g_rg‘s_out
, 
»g_weights_out
,

505 
m©ch_out_0
, 
m©ch_out_1
èğ
£ss
.
	`run
([

506 
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
] + [

507 
m©ch
.
	$m©ched_cŞumn_šdiûs
(è
m©ch
 
š
 
m©ch_li¡
])

508 
£lf
.
	$as£¹AÎClo£
(
şs_rg‘s_out
, 
exp_şs_rg‘s
)

509 
£lf
.
	$as£¹AÎClo£
(
şs_weights_out
, 
exp_şs_weights
)

510 
£lf
.
	$as£¹AÎClo£
(
»g_rg‘s_out
, 
exp_»g_rg‘s
)

511 
£lf
.
	$as£¹AÎClo£
(
»g_weights_out
, 
exp_»g_weights
)

512 
£lf
.
	$as£¹AÎClo£
(
m©ch_out_0
, 
exp_m©ch_0
)

513 
£lf
.
	$as£¹AÎClo£
(
m©ch_out_1
, 
exp_m©ch_1
)

515 
def
 
	$‹¡_b©ch_assign_muÉidim’siÚ®_rg‘s
(
£lf
):

516 
box_li¡1
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
([[0., 0., 0.2, 0.2]]))

518 
box_li¡2
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(

523 
gt_box_b©ch
 = [
box_li¡1
, 
box_li¡2
]

524 
şass_rg‘s1
 = 
tf
.
	$cÚ¡ªt
([[[0, 1, 1],

525 [1, 1, 0]]], 
tf
.
æßt32
)

526 
şass_rg‘s2
 = 
tf
.
	$cÚ¡ªt
([[[0, 1, 1],

529 [0, 0, 1]]], 
tf
.
æßt32
)

531 
gt_şass_rg‘s
 = [
şass_rg‘s1
, 
şass_rg‘s2
]

533 
´iÜ_m—ns
 = 
tf
.
	$cÚ¡ªt
([[0, 0, .25, .25],

537 
´iÜ_¡ddevs
 = 
tf
.
	$cÚ¡ªt
([[.1, .1, .1, .1],

541 
´iÜs
 = 
box_li¡
.
	$BoxLi¡
(
´iÜ_m—ns
)

542 
´iÜs
.
	`add_f›ld
('¡ddev', 
´iÜ_¡ddevs
)

544 
exp_»g_rg‘s
 = [[[0, 0, -0.5, -0.5],

552 
exp_şs_weights
 = [[1, 1, 1, 1],

555 
exp_şs_rg‘s
 = [[[[0., 1., 1.],

571 
exp_»g_weights
 = [[1, 0, 0, 0],

573 
exp_m©ch_0
 = [0]

574 
exp_m©ch_1
 = [1, 2]

576 
muÉişass_rg‘_assigÃr
 = 
£lf
.
	`_g‘_muÉi_dim’siÚ®_rg‘_assigÃr
(

577 
rg‘_dim’siÚs
=(2, 3))

579 (
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
,

580 
m©ch_li¡
èğ
rg‘assigÃr
.
	$b©ch_assign_rg‘s
(

581 
muÉişass_rg‘_assigÃr
, 
´iÜs
, 
gt_box_b©ch
, 
gt_şass_rg‘s
)

582 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
m©ch_li¡
, 
li¡
è
ªd
 
	`Ën
(match_list) == 2)

583 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

584 (
şs_rg‘s_out
, 
şs_weights_out
, 
»g_rg‘s_out
, 
»g_weights_out
,

585 
m©ch_out_0
, 
m©ch_out_1
èğ
£ss
.
	`run
([

586 
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
] + [

587 
m©ch
.
	$m©ched_cŞumn_šdiûs
(è
m©ch
 
š
 
m©ch_li¡
])

588 
£lf
.
	$as£¹AÎClo£
(
şs_rg‘s_out
, 
exp_şs_rg‘s
)

589 
£lf
.
	$as£¹AÎClo£
(
şs_weights_out
, 
exp_şs_weights
)

590 
£lf
.
	$as£¹AÎClo£
(
»g_rg‘s_out
, 
exp_»g_rg‘s
)

591 
£lf
.
	$as£¹AÎClo£
(
»g_weights_out
, 
exp_»g_weights
)

592 
£lf
.
	$as£¹AÎClo£
(
m©ch_out_0
, 
exp_m©ch_0
)

593 
£lf
.
	$as£¹AÎClo£
(
m©ch_out_1
, 
exp_m©ch_1
)

595 
def
 
	$‹¡_b©ch_assign_em±y_groundŒuth
(
£lf
):

596 
box_coÜds_ex·nded
 = 
tf
.
	`z”os
((1, 4),f.
æßt32
)

597 
box_coÜds
 = 
tf
.
	$¦iû
(
box_coÜds_ex·nded
, [0, 0], [0, 4])

598 
box_li¡1
 = 
box_li¡
.
	$BoxLi¡
(
box_coÜds
)

599 
gt_box_b©ch
 = [
box_li¡1
]

601 
´iÜ_m—ns
 = 
tf
.
	$cÚ¡ªt
([[0, 0, .25, .25],

603 
´iÜ_¡ddevs
 = 
tf
.
	$cÚ¡ªt
([[.1, .1, .1, .1],

605 
´iÜs
 = 
box_li¡
.
	$BoxLi¡
(
´iÜ_m—ns
)

606 
´iÜs
.
	`add_f›ld
('¡ddev', 
´iÜ_¡ddevs
)

608 
exp_»g_rg‘s
 = [[[0, 0, 0, 0],

610 
exp_şs_weights
 = [[1, 1]]

611 
exp_şs_rg‘s
 = [[[1, 0, 0, 0],

613 
exp_»g_weights
 = [[0, 0]]

614 
exp_m©ch_0
 = []

616 
num_şas£s
 = 3

617 
·d
 = 1

618 
gt_şass_rg‘s
 = 
tf
.
	`z”os
((0, 
num_şas£s
 + 
·d
))

619 
gt_şass_rg‘s_b©ch
 = [
gt_şass_rg‘s
]

621 
muÉişass_rg‘_assigÃr
 = 
£lf
.
	$_g‘_muÉi_şass_rg‘_assigÃr
(

622 
num_şas£s
=3)

624 (
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
,

625 
m©ch_li¡
èğ
rg‘assigÃr
.
	$b©ch_assign_rg‘s
(

626 
muÉişass_rg‘_assigÃr
, 
´iÜs
,

627 
gt_box_b©ch
, 
gt_şass_rg‘s_b©ch
)

628 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
m©ch_li¡
, 
li¡
è
ªd
 
	`Ën
(match_list) == 1)

629 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

630 (
şs_rg‘s_out
, 
şs_weights_out
, 
»g_rg‘s_out
, 
»g_weights_out
,

631 
m©ch_out_0
èğ
£ss
.
	`run
([

632 
şs_rg‘s
, 
şs_weights
, 
»g_rg‘s
, 
»g_weights
] + [

633 
m©ch
.
	$m©ched_cŞumn_šdiûs
(è
m©ch
 
š
 
m©ch_li¡
])

634 
£lf
.
	$as£¹AÎClo£
(
şs_rg‘s_out
, 
exp_şs_rg‘s
)

635 
£lf
.
	$as£¹AÎClo£
(
şs_weights_out
, 
exp_şs_weights
)

636 
£lf
.
	$as£¹AÎClo£
(
»g_rg‘s_out
, 
exp_»g_rg‘s
)

637 
£lf
.
	$as£¹AÎClo£
(
»g_weights_out
, 
exp_»g_weights
)

638 
£lf
.
	$as£¹AÎClo£
(
m©ch_out_0
, 
exp_m©ch_0
)

641 
şass
 
	$C»©eT¬g‘AssigÃrTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

643 
def
 
	$‹¡_ü—‹_rg‘_assigÃr
(
£lf
):

646 
TODO
: 
Make
 
this
 
‹¡
 
mÜe
 
g’”®
.

648 
cÜÃrs
 = [[0.0, 0.0, 1.0, 1.0]]

649 
groundŒuth
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
cÜÃrs
))

651 
´iÜs
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
cÜÃrs
))

652 
´iÜ_¡ddevs
 = 
tf
.
	$cÚ¡ªt
([[1.0, 1.0, 1.0, 1.0]])

653 
´iÜs
.
	`add_f›ld
('¡ddev', 
´iÜ_¡ddevs
)

654 
muÉibox_
 = (
rg‘assigÃr


655 .
	`ü—‹_rg‘_assigÃr
('MuÉibox', 
¡age
='proposal'))

656 
muÉibox_
.
	$assign
(
´iÜs
, 
groundŒuth
)

657 #NØ
‹¡s
 
Ú
 
ouut
, 
as
 
th©
 
may
 
v¬y
 
¬b™¿ry
‡ 
Ãw
 
rg‘
 
assigÃrs


658 #¬
added
. 
As
 
as
 
™
 
is
 
cÚ¡ruùed
 
cÜ»ùly
 
ªd
 
runs
 
w™hout
 
”rÜs
,

659 #‹¡ 
Ú
 
the
 
šdividu®
 
assigÃrs
 
cov”
 
cÜ»ùÃss
 
of
h
assignm’ts
.

661 
ªchÜs
 = 
box_li¡
.
	`BoxLi¡
(
tf
.
	$cÚ¡ªt
(
cÜÃrs
))

662 
ç¡”_rún_´İo§ls_
 = (
rg‘assigÃr


663 .
	`ü—‹_rg‘_assigÃr
('FasterRCNN',

664 
¡age
='proposal'))

665 
ç¡”_rún_´İo§ls_
.
	$assign
(
ªchÜs
, 
groundŒuth
)

667 
ç¡_rún_
 = (
rg‘assigÃr


668 .
	`ü—‹_rg‘_assigÃr
('FastRCNN'))

669 
ç¡_rún_
.
	$assign
(
ªchÜs
, 
groundŒuth
)

671 
ç¡”_rún_d‘eùiÚ_
 = (
rg‘assigÃr


672 .
	`ü—‹_rg‘_assigÃr
('FasterRCNN',

673 
¡age
='detection'))

674 
ç¡”_rún_d‘eùiÚ_
.
	$assign
(
ªchÜs
, 
groundŒuth
)

676 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

677 
rg‘assigÃr
.
	`ü—‹_rg‘_assigÃr
('InvalidDetector',

678 
¡age
='invalid_stage')

681 
__Çme__
 == '__main__':

682 
tf
.
‹¡
.
	`maš
()

	@create_pascal_tf_record.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

16 
	gr
"""Convert„aw PASCAL dataseto TFRecord for object_detection.

18 
Exam¶e
 
	gu§ge
:

19 ./
ü—‹_·sÿl_tf_»cÜd
 --
d©a_dœ
=/
home
/
u£r
/
VOCdevk™
 \

20 --
y—r
=
VOC2012
 \

21 --
ouut_·th
=/
home
/
u£r
/
·sÿl
.
»cÜd


23 
äom
 
__futu»__
 
impÜt
 
absŞu‹_impÜt


24 
äom
 
__futu»__
 
impÜt
 
divisiÚ


25 
äom
 
__futu»__
 
impÜt
 
´št_funùiÚ


27 
impÜt
 
hashlib


28 
impÜt
 
io


29 
impÜt
 
loggšg


30 
impÜt
 
os


32 
äom
 
lxml
 
impÜt
 
‘»e


33 
impÜt
 
PIL
.
Image


34 
impÜt
 
‹nsÜæow
 
as
 
tf


36 
äom
 
objeù_d‘eùiÚ
.
uts
 
impÜt
 
d©a£t_ut


37 
äom
 
objeù_d‘eùiÚ
.
uts
 
impÜt
 
Ïb–_m­_ut


40 
æags
 = 
tf
.
­p
.flags

41 
æags
.
DEFINE_¡ršg
('data_dir', '', 'Root directoryo„aw PASCAL VOC dataset.')

42 
	gæags
.
DEFINE_¡ršg
('set', 'train', 'Convertraining set, validation set or '

44 
	gæags
.
DEFINE_¡ršg
('annotations_dir', 'Annotations',

46 
	gæags
.
DEFINE_¡ršg
('year', 'VOC2007', 'Desired challenge year.')

47 
	gæags
.
DEFINE_¡ršg
('output_path', '', 'Patho output TFRecord')

48 
	gæags
.
DEFINE_¡ršg
('label_map_path', 'data/pascal_label_map.pbtxt',

50 
	gæags
.
DEFINE_boŞ—n
('ignÜe_difficuÉ_š¡ªûs', 
F®£
, 'Whethero ignore '

52 
	gFLAGS
 = 
æags
.
FLAGS


54 
SETS
 = ['train', 'val', 'trainval', 'test']

55 
	gYEARS
 = ['VOC2007', 'VOC2012', 'merged']

58 
def
 
diù_to_tf_exam¶e
(
d©a
,

59 
d©a£t_dœeùÜy
,

60 
Ïb–_m­_diù
,

61 
ignÜe_difficuÉ_š¡ªûs
=
F®£
,

62 
image_subdœeùÜy
='JPEGImages'):

65 
NÙiû
 
th©
 
this
 
funùiÚ
 
nÜm®izes
 
the
 
boundšg
 
box
 
coÜdš©es
 
´ovided


66 
by
 
the
 
¿w
 
d©a
.

68 
Args
:

69 
d©a
: 
diù
 
hŞdšg
 
PASCAL
 
XML
 
f›lds
 
a
 
sšgË
 
	$image
 (
obšed
 
by


70 
ruÂšg
 
d©a£t_ut
.
»cursive_·r£_xml_to_diù
)

71 
d©a£t_dœeùÜy
: 
P©h
 
to
 
roÙ
 
dœeùÜy
 
hŞdšg
 
PASCAL
 
d©a£t


72 
Ïb–_m­_diù
: 
A
 
m­
 
äom
 
¡ršg
 
Ïb–
 
Çmes
 
to
 
š‹g”s
 
ids
.

73 
ignÜe_difficuÉ_š¡ªûs
: 
Wh‘h”
 
to
 
sk
 
difficuÉ
 
š¡ªûs
 
š
 
the


74 
	`d©a£t
 (: 
F®£
).

75 
image_subdœeùÜy
: 
SŒšg
 
¥ecifyšg
 
subdœeùÜy
 
w™hš
 
the


76 
PASCAL
 
d©a£t
 
dœeùÜy
 
hŞdšg
 
the
 
aùu®
 
image
 
d©a
.

78 
R‘uºs
:

79 
exam¶e
: 
The
 
cÚv”‹d
 
tf
.
Exam¶e
.

81 
Rai£s
:

82 
V®ueE¼Ü
: 
the
 
image
 
poš‹d
 
to
 
by
 
d©a
['f’ame'] 
is
 
nÙ
 
a
 
v®id
 
JPEG


84 
img_·th
 = 
os
.
·th
.
	`još
(
d©a
['fŞd”'], 
image_subdœeùÜy
, data['filename'])

85 
fuÎ_·th
 = 
os
.
·th
.
	$još
(
d©a£t_dœeùÜy
, 
img_·th
)

86 
w™h
 
tf
.
gfe
.
	`GFe
(
fuÎ_·th
, 'rb'è
as
 
fid
:

87 
’coded_jpg
 = 
fid
.
	$»ad
()

88 
’coded_jpg_io
 = 
io
.
	$By‹sIO
(
’coded_jpg
)

89 
image
 = 
PIL
.
Image
.
	$İ’
(
’coded_jpg_io
)

90 
image
.
fÜm©
 != 'JPEG':

91 
¿i£
 
	`V®ueE¼Ü
('Image format‚ot JPEG')

92 
key
 = 
hashlib
.
	`sha256
(
’coded_jpg
).
	$hexdige¡
()

94 
width
 = (
d©a
['size']['width'])

95 
height
 = (
d©a
['size']['height'])

97 
xmš
 = []

98 
ymš
 = []

99 
xmax
 = []

100 
ymax
 = []

101 
şas£s
 = []

102 
şas£s_‹xt
 = []

103 
Œunÿ‹d
 = []

104 
po£s
 = []

105 
difficuÉ_obj
 = []

106 
obj
 
š
 
d©a
['object']:

107 
difficuÉ
 = 
	`boŞ
((
obj
['difficult']))

108 
ignÜe_difficuÉ_š¡ªûs
 
ªd
 
difficuÉ
:

111 
difficuÉ_obj
.
	`­³nd
((
difficuÉ
))

113 
xmš
.
	`­³nd
((
obj
['bndbox']['xmš']è/ 
width
)

114 
ymš
.
	`­³nd
((
obj
['bndbox']['ymš']è/ 
height
)

115 
xmax
.
	`­³nd
((
obj
['bndbox']['xmax']è/ 
width
)

116 
ymax
.
	`­³nd
((
obj
['bndbox']['ymax']è/ 
height
)

117 
şas£s_‹xt
.
	`­³nd
(
obj
['Çme'].
	`’code
('utf8'))

118 
şas£s
.
	`­³nd
(
Ïb–_m­_diù
[
obj
['name']])

119 
Œunÿ‹d
.
	`­³nd
((
obj
['truncated']))

120 
po£s
.
	`­³nd
(
obj
['po£'].
	`’code
('utf8'))

122 
exam¶e
 = 
tf
.
Œaš
.
	`Exam¶e
(
ã©u»s
ñf.Œaš.
	`F—tu»s
(
ã©u»
={

123 'image/height': 
d©a£t_ut
.
	`št64_ã©u»
(
height
),

124 'image/width': 
d©a£t_ut
.
	`št64_ã©u»
(
width
),

125 'image/f’ame': 
d©a£t_ut
.
	`by‹s_ã©u»
(

126 
d©a
['f’ame'].
	`’code
('utf8')),

127 'image/sourû_id': 
d©a£t_ut
.
	`by‹s_ã©u»
(

128 
d©a
['f’ame'].
	`’code
('utf8')),

129 'image/key/sha256': 
d©a£t_ut
.
	`by‹s_ã©u»
(
key
.
	`’code
('utf8')),

130 'image/’coded': 
d©a£t_ut
.
	`by‹s_ã©u»
(
’coded_jpg
),

131 'image/fÜm©': 
d©a£t_ut
.
	`by‹s_ã©u»
('j³g'.
	`’code
('utf8')),

132 'image/objeù/bbox/xmš': 
d©a£t_ut
.
	`æßt_li¡_ã©u»
(
xmš
),

133 'image/objeù/bbox/xmax': 
d©a£t_ut
.
	`æßt_li¡_ã©u»
(
xmax
),

134 'image/objeù/bbox/ymš': 
d©a£t_ut
.
	`æßt_li¡_ã©u»
(
ymš
),

135 'image/objeù/bbox/ymax': 
d©a£t_ut
.
	`æßt_li¡_ã©u»
(
ymax
),

136 'image/objeù/şass/‹xt': 
d©a£t_ut
.
	`by‹s_li¡_ã©u»
(
şas£s_‹xt
),

137 'image/objeù/şass/Ïb–': 
d©a£t_ut
.
	`št64_li¡_ã©u»
(
şas£s
),

138 'image/objeù/difficuÉ': 
d©a£t_ut
.
	`št64_li¡_ã©u»
(
difficuÉ_obj
),

139 'image/objeù/Œunÿ‹d': 
d©a£t_ut
.
	`št64_li¡_ã©u»
(
Œunÿ‹d
),

140 'image/objeù/v›w': 
d©a£t_ut
.
	`by‹s_li¡_ã©u»
(
po£s
),

141 
	}
}))

142  
exam¶e


145 
def
 
	$maš
(
_
):

146 
FLAGS
.
£t
 
nÙ
 
š
 
SETS
:

147 
¿i£
 
	`V®ueE¼Ü
('£ˆmu¡ bš : {}'.
	$fÜm©
(
SETS
))

148 
FLAGS
.
y—r
 
nÙ
 
š
 
YEARS
:

149 
¿i£
 
	`V®ueE¼Ü
('y—¸mu¡ bš : {}'.
	$fÜm©
(
YEARS
))

151 
d©a_dœ
 = 
FLAGS
.data_dir

152 
y—rs
 = ['VOC2007', 'VOC2012']

153 
FLAGS
.
y—r
 != 'merged':

154 
y—rs
 = [
FLAGS
.
y—r
]

156 
wr™”
 = 
tf
.
pythÚ_io
.
	$TFRecÜdWr™”
(
FLAGS
.
ouut_·th
)

158 
Ïb–_m­_diù
 = 
Ïb–_m­_ut
.
	$g‘_Ïb–_m­_diù
(
FLAGS
.
Ïb–_m­_·th
)

160 
y—r
 
š
 
y—rs
:

161 
loggšg
.
	`šfo
('R—dšg from PASCAL % d©a£t.', 
y—r
)

162 
exam¶es_·th
 = 
os
.
·th
.
	`još
(
d©a_dœ
, 
y—r
, 'ImageSets', 'Main',

163 '«rİÏÃ_' + 
FLAGS
.
£t
 + '.txt')

164 
ªnÙ©iÚs_dœ
 = 
os
.
·th
.
	$još
(
d©a_dœ
, 
y—r
, 
FLAGS
.
ªnÙ©iÚs_dœ
)

165 
exam¶es_li¡
 = 
d©a£t_ut
.
	$»ad_exam¶es_li¡
(
exam¶es_·th
)

166 
idx
, 
exam¶e
 
š
 
	$’um”©e
(
exam¶es_li¡
):

167 
idx
 % 100 == 0:

168 
loggšg
.
	`šfo
('OÀimag%d oà%d', 
idx
, 
	$Ën
(
exam¶es_li¡
))

169 
·th
 = 
os
.·th.
	`još
(
ªnÙ©iÚs_dœ
, 
exam¶e
 + '.xml')

170 
w™h
 
tf
.
gfe
.
	`GFe
(
·th
, 'r'è
as
 
fid
:

171 
xml_¡r
 = 
fid
.
	$»ad
()

172 
xml
 = 
‘»e
.
	$äom¡ršg
(
xml_¡r
)

173 
d©a
 = 
d©a£t_ut
.
	`»cursive_·r£_xml_to_diù
(
xml
)['annotation']

175 
tf_exam¶e
 = 
	$diù_to_tf_exam¶e
(
d©a
, 
FLAGS
.
d©a_dœ
, 
Ïb–_m­_diù
,

176 
FLAGS
.
ignÜe_difficuÉ_š¡ªûs
)

177 
wr™”
.
	`wr™e
(
tf_exam¶e
.
	$S”ŸlizeToSŒšg
())

179 
wr™”
.
	$şo£
()

182 
__Çme__
 == '__main__':

183 
tf
.
­p
.
	`run
()

	@create_pascal_tf_record_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
os


20 
impÜt
 
numpy
 
as
 
Å


21 
impÜt
 
	gPIL
.
Image


22 
impÜt
 
‹nsÜæow
 
as
 
tf


24 
äom
 
objeù_d‘eùiÚ
 
impÜt
 
ü—‹_·sÿl_tf_»cÜd


27 
şass
 
	$DiùToTFExam¶eTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

29 
def
 
	$_as£¹PrÙoEqu®
(
£lf
, 
´Ùo_f›ld
, 
ex³ù©iÚ
):

32 
Args
:

33 
´Ùo_f›ld
: 
The
 
´Ùobuf
 
f›ld
 
to
 
com·»
.

34 
ex³ù©iÚ
: 
The
 
ex³ùed
 
v®ue
 
of
 
the
 
´Ùobuf
 
f›ld
.

36 
´Ùo_li¡
 = [
p
 °
š
 
´Ùo_f›ld
]

37 
£lf
.
	$as£¹Li¡Equ®
(
´Ùo_li¡
, 
ex³ù©iÚ
)

39 
def
 
	$‹¡_diù_to_tf_exam¶e
(
£lf
):

40 
image_fe_Çme
 = 'tmp_image.jpg'

41 
image_d©a
 = 
Å
.
¿ndom
.
	$¿nd
(256, 256, 3)

42 
§ve_·th
 = 
os
.
·th
.
	`još
(
£lf
.
	`g‘_‹mp_dœ
(), 
image_fe_Çme
)

43 
image
 = 
PIL
.
Image
.
	`äom¬¿y
(
image_d©a
, 'RGB')

44 
image
.
	$§ve
(
§ve_·th
)

46 
d©a
 = {

48 'f’ame': 
image_fe_Çme
,

67 
	}
}

69 
Ïb–_m­_diù
 = {

75 
exam¶e
 = 
ü—‹_·sÿl_tf_»cÜd
.
diù_to_tf_exam¶e
(

76 
d©a
, 
£lf
.
g‘_‹mp_dœ
(), 
Ïb–_m­_diù
, 
image_subdœeùÜy
='')

77 
£lf
.
_as£¹PrÙoEqu®
(

78 
exam¶e
.
ã©u»s
.
ã©u»
['image/height'].
št64_li¡
.
v®ue
, [256])

79 
	g£lf
.
_as£¹PrÙoEqu®
(

80 
exam¶e
.
ã©u»s
.
ã©u»
['image/width'].
št64_li¡
.
v®ue
, [256])

81 
	g£lf
.
_as£¹PrÙoEqu®
(

82 
exam¶e
.
ã©u»s
.
ã©u»
['image/f’ame'].
by‹s_li¡
.
v®ue
,

83 [
image_fe_Çme
])

84 
	g£lf
.
_as£¹PrÙoEqu®
(

85 
exam¶e
.
ã©u»s
.
ã©u»
['image/sourû_id'].
by‹s_li¡
.
v®ue
,

86 [
image_fe_Çme
])

87 
	g£lf
.
_as£¹PrÙoEqu®
(

88 
exam¶e
.
ã©u»s
.
ã©u»
['image/fÜm©'].
by‹s_li¡
.
v®ue
, ['jpeg'])

89 
	g£lf
.
_as£¹PrÙoEqu®
(

90 
exam¶e
.
ã©u»s
.
ã©u»
['image/objeù/bbox/xmš'].
æßt_li¡
.
v®ue
,

92 
	g£lf
.
_as£¹PrÙoEqu®
(

93 
exam¶e
.
ã©u»s
.
ã©u»
['image/objeù/bbox/ymš'].
æßt_li¡
.
v®ue
,

95 
	g£lf
.
_as£¹PrÙoEqu®
(

96 
exam¶e
.
ã©u»s
.
ã©u»
['image/objeù/bbox/xmax'].
æßt_li¡
.
v®ue
,

98 
	g£lf
.
_as£¹PrÙoEqu®
(

99 
exam¶e
.
ã©u»s
.
ã©u»
['image/objeù/bbox/ymax'].
æßt_li¡
.
v®ue
,

101 
	g£lf
.
_as£¹PrÙoEqu®
(

102 
exam¶e
.
ã©u»s
.
ã©u»
['image/objeù/şass/‹xt'].
by‹s_li¡
.
v®ue
,

104 
	g£lf
.
_as£¹PrÙoEqu®
(

105 
exam¶e
.
ã©u»s
.
ã©u»
['image/objeù/şass/Ïb–'].
št64_li¡
.
v®ue
,

107 
	g£lf
.
_as£¹PrÙoEqu®
(

108 
exam¶e
.
ã©u»s
.
ã©u»
['image/objeù/difficuÉ'].
št64_li¡
.
v®ue
,

110 
	g£lf
.
_as£¹PrÙoEqu®
(

111 
exam¶e
.
ã©u»s
.
ã©u»
['image/objeù/Œunÿ‹d'].
št64_li¡
.
v®ue
,

113 
	g£lf
.
_as£¹PrÙoEqu®
(

114 
exam¶e
.
ã©u»s
.
ã©u»
['image/objeù/v›w'].
by‹s_li¡
.
v®ue
, [''])

117 
	g__Çme__
 == '__main__':

118 
tf
.
‹¡
.
maš
()

	@create_pet_tf_record.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

16 
	gr
"""Converthe Oxford…et dataseto TFRecord for object_detection.

18 
	gS“
: 
O
. 
M
. 
P¬khi
, 
	gA
. 
	gVed®di
, A. 
	gZis£rmª
, 
	gC
. 
	gV
. 
Jawah¬


19 
C©s
 
ªd
 
Dogs


20 
IEEE
 
CÚã»nû
 
Ú
 
Compu‹r
 
VisiÚ
 
ªd
 
P©‹º
 
	gRecogn™iÚ
, 2012

21 
	gh‰p
:

23 
Exam¶e
 
u§ge
:

24 ./
ü—‹_³t_tf_»cÜd
 --
d©a_dœ
=/
home
/
u£r
/
³t
 \

25 --
ouut_dœ
=/
home
/
u£r
/
³t
/
ouut


28 
impÜt
 
hashlib


29 
impÜt
 
io


30 
impÜt
 
loggšg


31 
impÜt
 
os


32 
impÜt
 
¿ndom


33 
impÜt
 
»


35 
äom
 
lxml
 
impÜt
 
‘»e


36 
impÜt
 
PIL
.
Image


37 
impÜt
 
‹nsÜæow
 
as
 
tf


39 
äom
 
objeù_d‘eùiÚ
.
uts
 
impÜt
 
d©a£t_ut


40 
äom
 
objeù_d‘eùiÚ
.
uts
 
impÜt
 
Ïb–_m­_ut


42 
æags
 = 
tf
.
­p
.flags

43 
æags
.
DEFINE_¡ršg
('data_dir', '', 'Root directoryo„aw…et dataset.')

44 
	gæags
.
DEFINE_¡ršg
('output_dir', '', 'Patho directoryo output TFRecords.')

45 
	gæags
.
DEFINE_¡ršg
('label_map_path', 'data/pet_label_map.pbtxt',

47 
	gFLAGS
 = 
æags
.
FLAGS


50 
def
 
	$g‘_şass_Çme_äom_f’ame
(
fe_Çme
):

53 
Args
:

54 
fe_Çme
: 
The
 
fe
 
Çme
 
to
 
g‘
 
the
 
şass
‚am
äom
.

55 
›
. "american_pit_bull_terrier_105.jpg"

57 
R‘uºs
:

58 
exam¶e
: 
The
 
cÚv”‹d
 
tf
.
Exam¶e
.

60 
m©ch
 = 
»
.
	`m©ch
(
r
'([A-Za-z_]+)(_[0-9]+\.jpg)', 
fe_Çme
,„e.
I
)

61  
m©ch
.
	`groups
()[0]

64 
def
 
	$diù_to_tf_exam¶e
(
d©a
,

65 
Ïb–_m­_diù
,

66 
image_subdœeùÜy
,

67 
ignÜe_difficuÉ_š¡ªûs
=
F®£
):

70 
NÙiû
 
th©
 
this
 
funùiÚ
 
nÜm®izes
 
the
 
boundšg
 
box
 
coÜdš©es
 
´ovided


71 
by
 
the
 
¿w
 
d©a
.

73 
Args
:

74 
d©a
: 
diù
 
hŞdšg
 
PASCAL
 
XML
 
f›lds
 
a
 
sšgË
 
	$image
 (
obšed
 
by


75 
ruÂšg
 
d©a£t_ut
.
»cursive_·r£_xml_to_diù
)

76 
Ïb–_m­_diù
: 
A
 
m­
 
äom
 
¡ršg
 
Ïb–
 
Çmes
 
to
 
š‹g”s
 
ids
.

77 
image_subdœeùÜy
: 
SŒšg
 
¥ecifyšg
 
subdœeùÜy
 
w™hš
 
the


78 
Pasÿl
 
d©a£t
 
dœeùÜy
 
hŞdšg
 
the
 
aùu®
 
image
 
d©a
.

79 
ignÜe_difficuÉ_š¡ªûs
: 
Wh‘h”
 
to
 
sk
 
difficuÉ
 
š¡ªûs
 
š
 
the


80 
	`d©a£t
 (: 
F®£
).

82 
R‘uºs
:

83 
exam¶e
: 
The
 
cÚv”‹d
 
tf
.
Exam¶e
.

85 
Rai£s
:

86 
V®ueE¼Ü
: 
the
 
image
 
poš‹d
 
to
 
by
 
d©a
['f’ame'] 
is
 
nÙ
 
a
 
v®id
 
JPEG


88 
img_·th
 = 
os
.
·th
.
	`još
(
image_subdœeùÜy
, 
d©a
['filename'])

89 
w™h
 
tf
.
gfe
.
	`GFe
(
img_·th
, 'rb'è
as
 
fid
:

90 
’coded_jpg
 = 
fid
.
	$»ad
()

91 
’coded_jpg_io
 = 
io
.
	$By‹sIO
(
’coded_jpg
)

92 
image
 = 
PIL
.
Image
.
	$İ’
(
’coded_jpg_io
)

93 
image
.
fÜm©
 != 'JPEG':

94 
¿i£
 
	`V®ueE¼Ü
('Image format‚ot JPEG')

95 
key
 = 
hashlib
.
	`sha256
(
’coded_jpg
).
	$hexdige¡
()

97 
width
 = (
d©a
['size']['width'])

98 
height
 = (
d©a
['size']['height'])

100 
xmš
 = []

101 
ymš
 = []

102 
xmax
 = []

103 
ymax
 = []

104 
şas£s
 = []

105 
şas£s_‹xt
 = []

106 
Œunÿ‹d
 = []

107 
po£s
 = []

108 
difficuÉ_obj
 = []

109 
obj
 
š
 
d©a
['object']:

110 
difficuÉ
 = 
	`boŞ
((
obj
['difficult']))

111 
ignÜe_difficuÉ_š¡ªûs
 
ªd
 
difficuÉ
:

114 
difficuÉ_obj
.
	`­³nd
((
difficuÉ
))

116 
xmš
.
	`­³nd
((
obj
['bndbox']['xmš']è/ 
width
)

117 
ymš
.
	`­³nd
((
obj
['bndbox']['ymš']è/ 
height
)

118 
xmax
.
	`­³nd
((
obj
['bndbox']['xmax']è/ 
width
)

119 
ymax
.
	`­³nd
((
obj
['bndbox']['ymax']è/ 
height
)

120 
şass_Çme
 = 
	`g‘_şass_Çme_äom_f’ame
(
d©a
['filename'])

121 
şas£s_‹xt
.
	`­³nd
(
şass_Çme
.
	`’code
('utf8'))

122 
şas£s
.
	$­³nd
(
Ïb–_m­_diù
[
şass_Çme
])

123 
Œunÿ‹d
.
	`­³nd
((
obj
['truncated']))

124 
po£s
.
	`­³nd
(
obj
['po£'].
	`’code
('utf8'))

126 
exam¶e
 = 
tf
.
Œaš
.
	`Exam¶e
(
ã©u»s
ñf.Œaš.
	`F—tu»s
(
ã©u»
={

127 'image/height': 
d©a£t_ut
.
	`št64_ã©u»
(
height
),

128 'image/width': 
d©a£t_ut
.
	`št64_ã©u»
(
width
),

129 'image/f’ame': 
d©a£t_ut
.
	`by‹s_ã©u»
(

130 
d©a
['f’ame'].
	`’code
('utf8')),

131 'image/sourû_id': 
d©a£t_ut
.
	`by‹s_ã©u»
(

132 
d©a
['f’ame'].
	`’code
('utf8')),

133 'image/key/sha256': 
d©a£t_ut
.
	`by‹s_ã©u»
(
key
.
	`’code
('utf8')),

134 'image/’coded': 
d©a£t_ut
.
	`by‹s_ã©u»
(
’coded_jpg
),

135 'image/fÜm©': 
d©a£t_ut
.
	`by‹s_ã©u»
('j³g'.
	`’code
('utf8')),

136 'image/objeù/bbox/xmš': 
d©a£t_ut
.
	`æßt_li¡_ã©u»
(
xmš
),

137 'image/objeù/bbox/xmax': 
d©a£t_ut
.
	`æßt_li¡_ã©u»
(
xmax
),

138 'image/objeù/bbox/ymš': 
d©a£t_ut
.
	`æßt_li¡_ã©u»
(
ymš
),

139 'image/objeù/bbox/ymax': 
d©a£t_ut
.
	`æßt_li¡_ã©u»
(
ymax
),

140 'image/objeù/şass/‹xt': 
d©a£t_ut
.
	`by‹s_li¡_ã©u»
(
şas£s_‹xt
),

141 'image/objeù/şass/Ïb–': 
d©a£t_ut
.
	`št64_li¡_ã©u»
(
şas£s
),

142 'image/objeù/difficuÉ': 
d©a£t_ut
.
	`št64_li¡_ã©u»
(
difficuÉ_obj
),

143 'image/objeù/Œunÿ‹d': 
d©a£t_ut
.
	`št64_li¡_ã©u»
(
Œunÿ‹d
),

144 'image/objeù/v›w': 
d©a£t_ut
.
	`by‹s_li¡_ã©u»
(
po£s
),

145 
	}
}))

146  
exam¶e


149 
def
 
	$ü—‹_tf_»cÜd
(
ouut_f’ame
,

150 
Ïb–_m­_diù
,

151 
ªnÙ©iÚs_dœ
,

152 
image_dœ
,

153 
exam¶es
):

156 
Args
:

157 
ouut_f’ame
: 
P©h
 
to
 
wh”e
 
ouut
 
fe
 
is
 
§ved
.

158 
Ïb–_m­_diù
: 
The
 
Ïb–
 
m­
 
diùiÚ¬y
.

159 
ªnÙ©iÚs_dœ
: 
DœeùÜy
 
wh”e
 
ªnÙ©iÚ
 
fes
 
¬e
 
¡Üed
.

160 
image_dœ
: 
DœeùÜy
 
wh”e
 
image
 
fes
 
¬e
 
¡Üed
.

161 
exam¶es
: 
Exam¶es
 
to
 
·r£
 
ªd
 
§ve
Ø
tf
 
»cÜd
.

163 
wr™”
 = 
tf
.
pythÚ_io
.
	$TFRecÜdWr™”
(
ouut_f’ame
)

164 
idx
, 
exam¶e
 
š
 
	$’um”©e
(
exam¶es
):

165 
idx
 % 100 == 0:

166 
loggšg
.
	`šfo
('OÀimag%d oà%d', 
idx
, 
	$Ën
(
exam¶es
))

167 
·th
 = 
os
.·th.
	`još
(
ªnÙ©iÚs_dœ
, 'xmls', 
exam¶e
 + '.xml')

169 
nÙ
 
os
.
·th
.
	$exi¡s
(
·th
):

170 
loggšg
.
	`w¬nšg
('Could‚Ù fšd %s, ignÜšgƒxam¶e.', 
·th
)

172 
w™h
 
tf
.
gfe
.
	`GFe
(
·th
, 'r'è
as
 
fid
:

173 
xml_¡r
 = 
fid
.
	$»ad
()

174 
xml
 = 
‘»e
.
	$äom¡ršg
(
xml_¡r
)

175 
d©a
 = 
d©a£t_ut
.
	`»cursive_·r£_xml_to_diù
(
xml
)['annotation']

177 
tf_exam¶e
 = 
	$diù_to_tf_exam¶e
(
d©a
, 
Ïb–_m­_diù
, 
image_dœ
)

178 
wr™”
.
	`wr™e
(
tf_exam¶e
.
	$S”ŸlizeToSŒšg
())

180 
wr™”
.
	$şo£
()

183 #TODO: 
Add
 
‹¡
 
³t
/
PASCAL
 
maš
 
fes
.

184 
def
 
	$maš
(
_
):

185 
d©a_dœ
 = 
FLAGS
.data_dir

186 
Ïb–_m­_diù
 = 
Ïb–_m­_ut
.
	$g‘_Ïb–_m­_diù
(
FLAGS
.
Ïb–_m­_·th
)

188 
loggšg
.
	`šfo
('Reading from Pet dataset.')

189 
image_dœ
 = 
os
.
·th
.
	`još
(
d©a_dœ
, 'images')

190 
ªnÙ©iÚs_dœ
 = 
os
.
·th
.
	`još
(
d©a_dœ
, 'annotations')

191 
exam¶es_·th
 = 
os
.
·th
.
	`još
(
ªnÙ©iÚs_dœ
, 'trainval.txt')

192 
exam¶es_li¡
 = 
d©a£t_ut
.
	$»ad_exam¶es_li¡
(
exam¶es_·th
)

194 #Te¡ 
images
 
¬e
 
nÙ
 
šşuded
 
š
 
the
 
dowÆßded
 
d©a
 
£t
, 
so
 
we
 
sh®l
 
³rfÜm


195 #ou¸
own
 
¥l™
.

196 
¿ndom
.
	$£ed
(42)

197 
¿ndom
.
	$shufæe
(
exam¶es_li¡
)

198 
num_exam¶es
 = 
	$Ën
(
exam¶es_li¡
)

199 
num_Œaš
 = (0.7 * 
num_exam¶es
)

200 
Œaš_exam¶es
 = 
exam¶es_li¡
[:
num_Œaš
]

201 
v®_exam¶es
 = 
exam¶es_li¡
[
num_Œaš
:]

202 
loggšg
.
	`šfo
('%draining‡nd %d validationƒxamples.',

203 
	`Ën
(
Œaš_exam¶es
), 
	$Ën
(
v®_exam¶es
))

205 
Œaš_ouut_·th
 = 
os
.
·th
.
	`još
(
FLAGS
.
ouut_dœ
, 'pet_train.record')

206 
v®_ouut_·th
 = 
os
.
·th
.
	`još
(
FLAGS
.
ouut_dœ
, 'pet_val.record')

207 
	$ü—‹_tf_»cÜd
(
Œaš_ouut_·th
, 
Ïb–_m­_diù
, 
ªnÙ©iÚs_dœ
,

208 
image_dœ
, 
Œaš_exam¶es
)

209 
	$ü—‹_tf_»cÜd
(
v®_ouut_·th
, 
Ïb–_m­_diù
, 
ªnÙ©iÚs_dœ
,

210 
image_dœ
, 
v®_exam¶es
)

212 
__Çme__
 == '__main__':

213 
tf
.
­p
.
	`run
()

	@data_decoders/__init__.py

	@data_decoders/tf_example_decoder.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
A
 
decod”
 
to
 
decode
 
¡ršg
 
‹nsÜs
 
cÚššg
 
£rŸlized
 
	g‹nsÜæow
.
Exam¶e


19 
´Ùos
 
objeù
 
	gd‘eùiÚ
.

21 
impÜt
 
‹nsÜæow
 
as
 
tf


23 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
d©a_decod”


24 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
¡ªd¬d_f›lds
 
as
 
f›lds


26 
	g¦im_exam¶e_decod”
 = 
tf
.
cÚŒib
.
¦im
.
tãxam¶e_decod”


29 
şass
 
	$TfExam¶eDecod”
(
d©a_decod”
.
D©aDecod”
):

32 
def
 
	$__š™__
(
£lf
):

34 
£lf
.
keys_to_ã©u»s
 = {

35 'image/’coded': 
tf
.
	`FixedL’F—tu»
((),f.
¡ršg
, 
deçuÉ_v®ue
=''),

36 'image/fÜm©': 
tf
.
	`FixedL’F—tu»
((),f.
¡ršg
, 
deçuÉ_v®ue
='jpeg'),

37 'image/f’ame': 
tf
.
	`FixedL’F—tu»
((),f.
¡ršg
, 
deçuÉ_v®ue
=''),

38 'image/key/sha256': 
tf
.
	`FixedL’F—tu»
((),f.
¡ršg
, 
deçuÉ_v®ue
=''),

39 'image/sourû_id': 
tf
.
	`FixedL’F—tu»
((),f.
¡ršg
, 
deçuÉ_v®ue
=''),

40 'image/height': 
tf
.
	`FixedL’F—tu»
((),f.
št64
, 1),

41 'image/width': 
tf
.
	`FixedL’F—tu»
((),f.
št64
, 1),

42 #Objeù 
boxes
 
ªd
 
şas£s
.

43 'image/objeù/bbox/xmš': 
tf
.
	`V¬L’F—tu»
Ñf.
æßt32
),

44 'image/objeù/bbox/xmax': 
tf
.
	`V¬L’F—tu»
Ñf.
æßt32
),

45 'image/objeù/bbox/ymš': 
tf
.
	`V¬L’F—tu»
Ñf.
æßt32
),

46 'image/objeù/bbox/ymax': 
tf
.
	`V¬L’F—tu»
Ñf.
æßt32
),

47 'image/objeù/şass/Ïb–': 
tf
.
	`V¬L’F—tu»
Ñf.
št64
),

48 'image/objeù/¬—': 
tf
.
	`V¬L’F—tu»
Ñf.
æßt32
),

49 'image/objeù/is_üowd': 
tf
.
	`V¬L’F—tu»
Ñf.
št64
),

50 'image/objeù/difficuÉ': 
tf
.
	`V¬L’F—tu»
Ñf.
št64
),

51 #In¡ªû 
masks
 
ªd
 
şas£s
.

52 'image/£gm’tiÚ/objeù': 
tf
.
	`V¬L’F—tu»
Ñf.
št64
),

53 'image/£gm’tiÚ/objeù/şass': 
tf
.
	`V¬L’F—tu»
Ñf.
št64
)

54 
	}
}

55 
£lf
.
™ems_to_hªdËrs
 = {

56 
f›lds
.
IÅutD©aF›lds
.
image
: 
¦im_exam¶e_decod”
.
Image
(

57 
image_key
='image/’coded', 
fÜm©_key
='image/fÜm©', 
chªÃls
=3),

58 
	gf›lds
.
	gIÅutD©aF›lds
.
	gsourû_id
: (

59 
¦im_exam¶e_decod”
.
T’sÜ
('image/source_id')),

60 
	gf›lds
.
	gIÅutD©aF›lds
.
	gkey
: (

61 
¦im_exam¶e_decod”
.
T’sÜ
('image/key/sha256')),

62 
	gf›lds
.
	gIÅutD©aF›lds
.
	gf’ame
: (

63 
¦im_exam¶e_decod”
.
T’sÜ
('image/filename')),

64 #Objeù 
boxes
 
ªd
 
şas£s
.

65 
	gf›lds
.
	gIÅutD©aF›lds
.
	ggroundŒuth_boxes
: (

66 
¦im_exam¶e_decod”
.
BoundšgBox
(

68 
	gf›lds
.
	gIÅutD©aF›lds
.
	ggroundŒuth_şas£s
: (

69 
¦im_exam¶e_decod”
.
T’sÜ
('image/object/class/label')),

70 
	gf›lds
.
	gIÅutD©aF›lds
.
	ggroundŒuth_¬—
: 
¦im_exam¶e_decod”
.
T’sÜ
(

72 
	gf›lds
.
	gIÅutD©aF›lds
.
	ggroundŒuth_is_üowd
: (

73 
¦im_exam¶e_decod”
.
T’sÜ
('image/object/is_crowd')),

74 
	gf›lds
.
	gIÅutD©aF›lds
.
	ggroundŒuth_difficuÉ
: (

75 
¦im_exam¶e_decod”
.
T’sÜ
('image/object/difficult')),

76 #In¡ªû 
masks
 
ªd
 
şas£s
.

77 
	gf›lds
.
	gIÅutD©aF›lds
.
	ggroundŒuth_š¡ªû_masks
: (

78 
¦im_exam¶e_decod”
.
I‹mHªdËrC®lback
(

80 
£lf
.
_»sh­e_š¡ªû_masks
)),

81 
	gf›lds
.
	gIÅutD©aF›lds
.
	ggroundŒuth_š¡ªû_şas£s
: (

82 
¦im_exam¶e_decod”
.
T’sÜ
('image/segmentation/object/class')),

85 
def
 
	$decode
(
£lf
, 
tf_exam¶e_¡ršg_‹nsÜ
):

88 
Args
:

89 
tf_exam¶e_¡ršg_‹nsÜ
: 
a
 
¡ršg
 
‹nsÜ
 
hŞdšg
‡ 
£rŸlized
 
‹nsÜæow


90 
exam¶e
 
´Ùo
.

92 
R‘uºs
:

93 
A
 
diùiÚ¬y
 
of
 
the
 
fŞlowšg
 
‹nsÜs
.

94 
f›lds
.
IÅutD©aF›lds
.
image
 - 3D 
ušt8
 
‹nsÜ
 
of
 
sh­e
 [
NÚe
, None, 3]

95 
cÚššg
 
image
.

96 
f›lds
.
IÅutD©aF›lds
.
sourû_id
 - 
¡ršg
 
‹nsÜ
 
cÚššg
 
Üigš®


97 
image
 
id
.

98 
f›lds
.
IÅutD©aF›lds
.
key
 - 
¡ršg
 
‹nsÜ
 
w™h
 
unique
 
sha256
 
hash
 key.

99 
f›lds
.
IÅutD©aF›lds
.
f’ame
 - 
¡ršg
 
‹nsÜ
 
w™h
 
Üigš®
 
d©a£t


100 
f’ame
.

101 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
 - 2D 
æßt32
 
‹nsÜ
 
of
 
sh­e


102 [
NÚe
, 4] 
cÚššg
 
box
 
cÜÃrs
.

103 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
 - 1D 
št64
 
‹nsÜ
 
of
 
sh­e


104 [
NÚe
] 
cÚššg
 
şas£s
 
the
 
boxes
.

105 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—
 - 1D 
æßt32
 
‹nsÜ
 
of
 
sh­e


106 [
NÚe
] 
cÚššg
 cÚššg 
objeù
 
mask
 
¬—
 
š
 
pix–
 
squ¬ed
.

107 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd
 - 1D 
boŞ
 
‹nsÜ
 
of
 
sh­e


108 [
NÚe
] 
šdiÿtšg
 
the
 
boxes
 
’şo£
 
a
 
üowd
.

109 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_difficuÉ
 - 1D 
boŞ
 
‹nsÜ
 
of
 
sh­e


110 [
NÚe
] 
šdiÿtšg
 
the
 
boxes
 
»´e£Á
 `
difficuÉ
` 
š¡ªûs
.

111 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_š¡ªû_masks
 - 3D 
št64
 
‹nsÜ
 
of


112 
sh­e
 [
NÚe
, NÚe, NÚe] 
cÚššg
 
š¡ªû
 
masks
.

113 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_š¡ªû_şas£s
 - 1D 
št64
 
‹nsÜ


114 
of
 
sh­e
 [
NÚe
] 
cÚššg
 
şas£s
 
the
 
š¡ªû
 
masks
.

117 
£rŸlized_exam¶e
 = 
tf
.
	$»sh­e
(
tf_exam¶e_¡ršg_‹nsÜ
, 
sh­e
=[])

118 
decod”
 = 
¦im_exam¶e_decod”
.
	$TFExam¶eDecod”
(
£lf
.
keys_to_ã©u»s
,

119 
£lf
.
™ems_to_hªdËrs
)

120 
keys
 = 
decod”
.
	$li¡_™ems
()

121 
‹nsÜs
 = 
decod”
.
	$decode
(
£rŸlized_exam¶e
, 
™ems
=
keys
)

122 
‹nsÜ_diù
 = 
	`diù
(
	$z
(
keys
, 
‹nsÜs
))

123 
is_üowd
 = 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd


124 
‹nsÜ_diù
[
is_üowd
] = 
tf
.
	$ÿ¡
(
‹nsÜ_diù
[
is_üowd
], 
dty³
=
tf
.
boŞ
)

125 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
].
	$£t_sh­e
([
NÚe
, None, 3])

126  
‹nsÜ_diù


128 
def
 
	$_»sh­e_š¡ªû_masks
(
£lf
, 
keys_to_‹nsÜs
):

131 
The
 
š¡ªû
 
£gm’tiÚ
 
masks
 
¬e
 
»sh­ed
 
to
 [
num_š¡ªûs
, 
height
,

132 
width
] 
ªd
 
ÿ¡
 
to
 
boŞ—n
 
ty³
Ø
§ve
 
memÜy
.

134 
Args
:

135 
keys_to_‹nsÜs
: 
a
 
diùiÚ¬y
 
äom
 
keys
 
to
 
‹nsÜs
.

137 
R‘uºs
:

138 
A
 3-
D
 
boŞ—n
 
‹nsÜ
 
of
 
sh­e
 [
num_š¡ªûs
, 
height
, 
width
].

140 
masks
 = 
keys_to_‹nsÜs
['image/segmentation/object']

141 
	$isš¡ªû
(
masks
, 
tf
.
S·r£T’sÜ
):

142 
masks
 = 
tf
.
	$¥¬£_‹nsÜ_to_d’£
(
masks
)

143 
height
 = 
keys_to_‹nsÜs
['image/height']

144 
width
 = 
keys_to_‹nsÜs
['image/width']

145 
to_sh­e
 = 
tf
.
	`ÿ¡
Ñf.
	`¡ack
([-1, 
height
, 
width
]),f.
št32
)

147  
tf
.
	`ÿ¡
Ñf.
	`»sh­e
(
masks
, 
to_sh­e
),f.
boŞ
)

	@data_decoders/tf_example_decoder_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
numpy
 
as
 
Å


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
¡ªd¬d_f›lds
 
as
 
f›lds


22 
äom
 
	gobjeù_d‘eùiÚ
.
d©a_decod”s
 
impÜt
 
tf_exam¶e_decod”


25 
şass
 
	$TfExam¶eDecod”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

27 
def
 
	`_EncodeImage
(
£lf
, 
image_‹nsÜ
, 
’codšg_ty³
='jpeg'):

28 
w™h
 
£lf
.
	$‹¡_£ssiÚ
():

29 
’codšg_ty³
 == 'jpeg':

30 
image_’coded
 = 
tf
.
image
.
	`’code_j³g
Ñf.
	`cÚ¡ªt
(
image_‹nsÜ
)).
	$ev®
()

31 
–if
 
’codšg_ty³
 == 'png':

32 
image_’coded
 = 
tf
.
image
.
	`’code_²g
Ñf.
	`cÚ¡ªt
(
image_‹nsÜ
)).
	$ev®
()

34 
¿i£
 
	`V®ueE¼Ü
('Invalidƒncodingype.')

35  
image_’coded


37 
def
 
	`_DecodeImage
(
£lf
, 
image_’coded
, 
’codšg_ty³
='jpeg'):

38 
w™h
 
£lf
.
	$‹¡_£ssiÚ
():

39 
’codšg_ty³
 == 'jpeg':

40 
image_decoded
 = 
tf
.
image
.
	`decode_j³g
Ñf.
	`cÚ¡ªt
(
image_’coded
)).
	$ev®
()

41 
–if
 
’codšg_ty³
 == 'png':

42 
image_decoded
 = 
tf
.
image
.
	`decode_²g
Ñf.
	`cÚ¡ªt
(
image_’coded
)).
	$ev®
()

44 
¿i£
 
	`V®ueE¼Ü
('Invalidƒncodingype.')

45  
image_decoded


47 
def
 
	$_IÁ64F—tu»
(
£lf
, 
v®ue
):

48  
tf
.
Œaš
.
	`F—tu»
(
št64_li¡
ñf.Œaš.
	$IÁ64Li¡
(
v®ue
=value))

50 
def
 
	$_FlßtF—tu»
(
£lf
, 
v®ue
):

51  
tf
.
Œaš
.
	`F—tu»
(
æßt_li¡
ñf.Œaš.
	$FlßtLi¡
(
v®ue
=value))

53 
def
 
	$_By‹sF—tu»
(
£lf
, 
v®ue
):

54  
tf
.
Œaš
.
	`F—tu»
(
by‹s_li¡
ñf.Œaš.
	$By‹sLi¡
(
v®ue
=[value]))

56 
def
 
	$‹¡DecodeJ³gImage
(
£lf
):

57 
image_‹nsÜ
 = 
Å
.
¿ndom
.
	`¿ndšt
(255, 
size
=(4, 5, 3)).
	$a¡y³
(
Å
.
ušt8
)

58 
’coded_j³g
 = 
£lf
.
	$_EncodeImage
(
image_‹nsÜ
)

59 
decoded_j³g
 = 
£lf
.
	$_DecodeImage
(
’coded_j³g
)

60 
exam¶e
 = 
tf
.
Œaš
.
	`Exam¶e
(
ã©u»s
ñf.Œaš.
	`F—tu»s
(
ã©u»
={

61 'image/’coded': 
£lf
.
	`_By‹sF—tu»
(
’coded_j³g
),

62 'image/fÜm©': 
£lf
.
	`_By‹sF—tu»
('jpeg'),

63 'image/sourû_id': 
£lf
.
	`_By‹sF—tu»
('image_id'),

64 
	}
})).
	$S”ŸlizeToSŒšg
()

66 
exam¶e_decod”
 = 
tf_exam¶e_decod”
.
	$TfExam¶eDecod”
()

67 
‹nsÜ_diù
 = 
exam¶e_decod”
.
	`decode
(
tf
.
	$cÚv”t_to_‹nsÜ
(
exam¶e
))

69 
£lf
.
	`as£¹AÎEqu®
((
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
].

70 
	`g‘_sh­e
().
	`as_li¡
()), [
NÚe
, None, 3])

71 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

72 
‹nsÜ_diù
 = 
£ss
.
	$run
(
‹nsÜ_diù
)

74 
£lf
.
	$as£¹AÎEqu®
(
decoded_j³g
, 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
])

75 
£lf
.
	`as£¹Equ®
('image_id', 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
sourû_id
])

77 
def
 
	$‹¡DecodeImageKeyAndF’ame
(
£lf
):

78 
image_‹nsÜ
 = 
Å
.
¿ndom
.
	`¿ndšt
(255, 
size
=(4, 5, 3)).
	$a¡y³
(
Å
.
ušt8
)

79 
’coded_j³g
 = 
£lf
.
	$_EncodeImage
(
image_‹nsÜ
)

80 
exam¶e
 = 
tf
.
Œaš
.
	`Exam¶e
(
ã©u»s
ñf.Œaš.
	`F—tu»s
(
ã©u»
={

81 'image/’coded': 
£lf
.
	`_By‹sF—tu»
(
’coded_j³g
),

82 'image/key/sha256': 
£lf
.
	`_By‹sF—tu»
('abc'),

83 'image/f’ame': 
£lf
.
	`_By‹sF—tu»
('filename')

84 
	}
})).
	$S”ŸlizeToSŒšg
()

86 
exam¶e_decod”
 = 
tf_exam¶e_decod”
.
	$TfExam¶eDecod”
()

87 
‹nsÜ_diù
 = 
exam¶e_decod”
.
	`decode
(
tf
.
	$cÚv”t_to_‹nsÜ
(
exam¶e
))

89 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

90 
‹nsÜ_diù
 = 
£ss
.
	$run
(
‹nsÜ_diù
)

92 
£lf
.
	`as£¹Equ®
('abc', 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
key
])

93 
£lf
.
	`as£¹Equ®
('f’ame', 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
f’ame
])

95 
def
 
	$‹¡DecodePngImage
(
£lf
):

96 
image_‹nsÜ
 = 
Å
.
¿ndom
.
	`¿ndšt
(255, 
size
=(4, 5, 3)).
	$a¡y³
(
Å
.
ušt8
)

97 
’coded_²g
 = 
£lf
.
	`_EncodeImage
(
image_‹nsÜ
, 
’codšg_ty³
='png')

98 
decoded_²g
 = 
£lf
.
	`_DecodeImage
(
’coded_²g
, 
’codšg_ty³
='png')

99 
exam¶e
 = 
tf
.
Œaš
.
	`Exam¶e
(
ã©u»s
ñf.Œaš.
	`F—tu»s
(
ã©u»
={

100 'image/’coded': 
£lf
.
	`_By‹sF—tu»
(
’coded_²g
),

101 'image/fÜm©': 
£lf
.
	`_By‹sF—tu»
('png'),

102 'image/sourû_id': 
£lf
.
	`_By‹sF—tu»
('image_id')

103 
	}
})).
	$S”ŸlizeToSŒšg
()

105 
exam¶e_decod”
 = 
tf_exam¶e_decod”
.
	$TfExam¶eDecod”
()

106 
‹nsÜ_diù
 = 
exam¶e_decod”
.
	`decode
(
tf
.
	$cÚv”t_to_‹nsÜ
(
exam¶e
))

108 
£lf
.
	`as£¹AÎEqu®
((
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
].

109 
	`g‘_sh­e
().
	`as_li¡
()), [
NÚe
, None, 3])

110 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

111 
‹nsÜ_diù
 = 
£ss
.
	$run
(
‹nsÜ_diù
)

113 
£lf
.
	$as£¹AÎEqu®
(
decoded_²g
, 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
])

114 
£lf
.
	`as£¹Equ®
('image_id', 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
sourû_id
])

116 
def
 
	$‹¡DecodeBoundšgBox
(
£lf
):

117 
image_‹nsÜ
 = 
Å
.
¿ndom
.
	`¿ndšt
(255, 
size
=(4, 5, 3)).
	$a¡y³
(
Å
.
ušt8
)

118 
’coded_j³g
 = 
£lf
.
	$_EncodeImage
(
image_‹nsÜ
)

119 
bbox_ymšs
 = [0.0, 4.0]

120 
bbox_xmšs
 = [1.0, 5.0]

121 
bbox_ymaxs
 = [2.0, 6.0]

122 
bbox_xmaxs
 = [3.0, 7.0]

123 
exam¶e
 = 
tf
.
Œaš
.
	`Exam¶e
(
ã©u»s
ñf.Œaš.
	`F—tu»s
(
ã©u»
={

124 'image/’coded': 
£lf
.
	`_By‹sF—tu»
(
’coded_j³g
),

125 'image/fÜm©': 
£lf
.
	`_By‹sF—tu»
('jpeg'),

126 'image/objeù/bbox/ymš': 
£lf
.
	`_FlßtF—tu»
(
bbox_ymšs
),

127 'image/objeù/bbox/xmš': 
£lf
.
	`_FlßtF—tu»
(
bbox_xmšs
),

128 'image/objeù/bbox/ymax': 
£lf
.
	`_FlßtF—tu»
(
bbox_ymaxs
),

129 'image/objeù/bbox/xmax': 
£lf
.
	`_FlßtF—tu»
(
bbox_xmaxs
),

130 
	}
})).
	$S”ŸlizeToSŒšg
()

132 
exam¶e_decod”
 = 
tf_exam¶e_decod”
.
	$TfExam¶eDecod”
()

133 
‹nsÜ_diù
 = 
exam¶e_decod”
.
	`decode
(
tf
.
	$cÚv”t_to_‹nsÜ
(
exam¶e
))

135 
£lf
.
	`as£¹AÎEqu®
((
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
].

136 
	`g‘_sh­e
().
	`as_li¡
()), [
NÚe
, 4])

137 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

138 
‹nsÜ_diù
 = 
£ss
.
	$run
(
‹nsÜ_diù
)

140 
ex³ùed_boxes
 = 
Å
.
	`v¡ack
([
bbox_ymšs
, 
bbox_xmšs
,

141 
bbox_ymaxs
, 
bbox_xmaxs
]).
	$Œª¥o£
()

142 
£lf
.
	$as£¹AÎEqu®
(
ex³ùed_boxes
,

143 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
])

145 
def
 
	$‹¡DecodeObjeùLab–
(
£lf
):

146 
image_‹nsÜ
 = 
Å
.
¿ndom
.
	`¿ndšt
(255, 
size
=(4, 5, 3)).
	$a¡y³
(
Å
.
ušt8
)

147 
’coded_j³g
 = 
£lf
.
	$_EncodeImage
(
image_‹nsÜ
)

148 
bbox_şas£s
 = [0, 1]

149 
exam¶e
 = 
tf
.
Œaš
.
	`Exam¶e
(
ã©u»s
ñf.Œaš.
	`F—tu»s
(
ã©u»
={

150 'image/’coded': 
£lf
.
	`_By‹sF—tu»
(
’coded_j³g
),

151 'image/fÜm©': 
£lf
.
	`_By‹sF—tu»
('jpeg'),

152 'image/objeù/şass/Ïb–': 
£lf
.
	`_IÁ64F—tu»
(
bbox_şas£s
),

153 
	}
})).
	$S”ŸlizeToSŒšg
()

155 
exam¶e_decod”
 = 
tf_exam¶e_decod”
.
	$TfExam¶eDecod”
()

156 
‹nsÜ_diù
 = 
exam¶e_decod”
.
	`decode
(
tf
.
	$cÚv”t_to_‹nsÜ
(
exam¶e
))

158 
£lf
.
	`as£¹AÎEqu®
((
‹nsÜ_diù
[

159 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
].
	`g‘_sh­e
().
	`as_li¡
()),

160 [
NÚe
])

162 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

163 
‹nsÜ_diù
 = 
£ss
.
	$run
(
‹nsÜ_diù
)

165 
£lf
.
	$as£¹AÎEqu®
(
bbox_şas£s
,

166 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
])

168 
def
 
	$‹¡DecodeObjeùA»a
(
£lf
):

169 
image_‹nsÜ
 = 
Å
.
¿ndom
.
	`¿ndšt
(255, 
size
=(4, 5, 3)).
	$a¡y³
(
Å
.
ušt8
)

170 
’coded_j³g
 = 
£lf
.
	$_EncodeImage
(
image_‹nsÜ
)

171 
objeù_¬—
 = [100., 174.]

172 
exam¶e
 = 
tf
.
Œaš
.
	`Exam¶e
(
ã©u»s
ñf.Œaš.
	`F—tu»s
(
ã©u»
={

173 'image/’coded': 
£lf
.
	`_By‹sF—tu»
(
’coded_j³g
),

174 'image/fÜm©': 
£lf
.
	`_By‹sF—tu»
('jpeg'),

175 'image/objeù/¬—': 
£lf
.
	`_FlßtF—tu»
(
objeù_¬—
),

176 
	}
})).
	$S”ŸlizeToSŒšg
()

178 
exam¶e_decod”
 = 
tf_exam¶e_decod”
.
	$TfExam¶eDecod”
()

179 
‹nsÜ_diù
 = 
exam¶e_decod”
.
	`decode
(
tf
.
	$cÚv”t_to_‹nsÜ
(
exam¶e
))

181 
£lf
.
	`as£¹AÎEqu®
((
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—
].

182 
	`g‘_sh­e
().
	`as_li¡
()), [
NÚe
])

183 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

184 
‹nsÜ_diù
 = 
£ss
.
	$run
(
‹nsÜ_diù
)

186 
£lf
.
	$as£¹AÎEqu®
(
objeù_¬—
,

187 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—
])

189 
def
 
	$‹¡DecodeObjeùIsCrowd
(
£lf
):

190 
image_‹nsÜ
 = 
Å
.
¿ndom
.
	`¿ndšt
(255, 
size
=(4, 5, 3)).
	$a¡y³
(
Å
.
ušt8
)

191 
’coded_j³g
 = 
£lf
.
	$_EncodeImage
(
image_‹nsÜ
)

192 
objeù_is_üowd
 = [0, 1]

193 
exam¶e
 = 
tf
.
Œaš
.
	`Exam¶e
(
ã©u»s
ñf.Œaš.
	`F—tu»s
(
ã©u»
={

194 'image/’coded': 
£lf
.
	`_By‹sF—tu»
(
’coded_j³g
),

195 'image/fÜm©': 
£lf
.
	`_By‹sF—tu»
('jpeg'),

196 'image/objeù/is_üowd': 
£lf
.
	`_IÁ64F—tu»
(
objeù_is_üowd
),

197 
	}
})).
	$S”ŸlizeToSŒšg
()

199 
exam¶e_decod”
 = 
tf_exam¶e_decod”
.
	$TfExam¶eDecod”
()

200 
‹nsÜ_diù
 = 
exam¶e_decod”
.
	`decode
(
tf
.
	$cÚv”t_to_‹nsÜ
(
exam¶e
))

202 
£lf
.
	`as£¹AÎEqu®
((
‹nsÜ_diù
[

203 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd
].
	`g‘_sh­e
().
	`as_li¡
()),

204 [
NÚe
])

205 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

206 
‹nsÜ_diù
 = 
£ss
.
	$run
(
‹nsÜ_diù
)

208 
£lf
.
	`as£¹AÎEqu®
([
	$boŞ
(
™em
è™em 
š
 
objeù_is_üowd
],

209 
‹nsÜ_diù
[

210 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd
])

212 
def
 
	$‹¡DecodeObjeùDifficuÉ
(
£lf
):

213 
image_‹nsÜ
 = 
Å
.
¿ndom
.
	`¿ndšt
(255, 
size
=(4, 5, 3)).
	$a¡y³
(
Å
.
ušt8
)

214 
’coded_j³g
 = 
£lf
.
	$_EncodeImage
(
image_‹nsÜ
)

215 
objeù_difficuÉ
 = [0, 1]

216 
exam¶e
 = 
tf
.
Œaš
.
	`Exam¶e
(
ã©u»s
ñf.Œaš.
	`F—tu»s
(
ã©u»
={

217 'image/’coded': 
£lf
.
	`_By‹sF—tu»
(
’coded_j³g
),

218 'image/fÜm©': 
£lf
.
	`_By‹sF—tu»
('jpeg'),

219 'image/objeù/difficuÉ': 
£lf
.
	`_IÁ64F—tu»
(
objeù_difficuÉ
),

220 
	}
})).
	$S”ŸlizeToSŒšg
()

222 
exam¶e_decod”
 = 
tf_exam¶e_decod”
.
	$TfExam¶eDecod”
()

223 
‹nsÜ_diù
 = 
exam¶e_decod”
.
	`decode
(
tf
.
	$cÚv”t_to_‹nsÜ
(
exam¶e
))

225 
£lf
.
	`as£¹AÎEqu®
((
‹nsÜ_diù
[

226 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_difficuÉ
].
	`g‘_sh­e
().
	`as_li¡
()),

227 [
NÚe
])

228 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

229 
‹nsÜ_diù
 = 
£ss
.
	$run
(
‹nsÜ_diù
)

231 
£lf
.
	`as£¹AÎEqu®
([
	$boŞ
(
™em
è™em 
š
 
objeù_difficuÉ
],

232 
‹nsÜ_diù
[

233 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_difficuÉ
])

235 
def
 
	$‹¡DecodeIn¡ªûSegm’tiÚ
(
£lf
):

236 
num_š¡ªûs
 = 4

237 
image_height
 = 5

238 
image_width
 = 3

240 #Rªdomly 
g’”©e
 
image
.

241 
image_‹nsÜ
 = 
Å
.
¿ndom
.
	`¿ndšt
(255, 
size
=(
image_height
,

242 
image_width
,

243 3)).
	$a¡y³
(
Å
.
ušt8
)

244 
’coded_j³g
 = 
£lf
.
	$_EncodeImage
(
image_‹nsÜ
)

246 #Rªdomly 
g’”©e
 
š¡ªû
 
£gm’tiÚ
 
masks
.

247 
š¡ªû_£gm’tiÚ
 = (

248 
Å
.
¿ndom
.
	`¿ndšt
(2, 
size
=(
num_š¡ªûs
,

249 
image_height
,

250 
image_width
)).
	$a¡y³
(
Å
.
št64
))

252 #Rªdomly 
g’”©e
 
şass
 
Ïb–s
 
—ch
 
š¡ªû
.

253 
š¡ªû_£gm’tiÚ_şas£s
 = 
Å
.
¿ndom
.
	`¿ndšt
(

254 100, 
size
=(
num_š¡ªûs
)).
	$a¡y³
(
Å
.
št64
)

256 
exam¶e
 = 
tf
.
Œaš
.
	`Exam¶e
(
ã©u»s
ñf.Œaš.
	`F—tu»s
(
ã©u»
={

257 'image/’coded': 
£lf
.
	`_By‹sF—tu»
(
’coded_j³g
),

258 'image/fÜm©': 
£lf
.
	`_By‹sF—tu»
('jpeg'),

259 'image/height': 
£lf
.
	`_IÁ64F—tu»
([
image_height
]),

260 'image/width': 
£lf
.
	`_IÁ64F—tu»
([
image_width
]),

261 'image/£gm’tiÚ/objeù': 
£lf
.
	`_IÁ64F—tu»
(

262 
š¡ªû_£gm’tiÚ
.
	`æ©‹n
()),

263 'image/£gm’tiÚ/objeù/şass': 
£lf
.
	`_IÁ64F—tu»
(

264 
š¡ªû_£gm’tiÚ_şas£s
)
	}
})).
	$S”ŸlizeToSŒšg
()

265 
exam¶e_decod”
 = 
tf_exam¶e_decod”
.
	$TfExam¶eDecod”
()

266 
‹nsÜ_diù
 = 
exam¶e_decod”
.
	`decode
(
tf
.
	$cÚv”t_to_‹nsÜ
(
exam¶e
))

268 
£lf
.
	`as£¹AÎEqu®
((

269 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_š¡ªû_masks
].

270 
	`g‘_sh­e
().
	`as_li¡
()), [
NÚe
, None, None])

272 
£lf
.
	`as£¹AÎEqu®
((

273 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_š¡ªû_şas£s
].

274 
	`g‘_sh­e
().
	`as_li¡
()), [
NÚe
])

276 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

277 
‹nsÜ_diù
 = 
£ss
.
	$run
(
‹nsÜ_diù
)

279 
£lf
.
	`as£¹AÎEqu®
(

280 
š¡ªû_£gm’tiÚ
.
	`a¡y³
(
Å
.
boŞ
),

281 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_š¡ªû_masks
])

282 
£lf
.
	$as£¹AÎEqu®
(

283 
š¡ªû_£gm’tiÚ_şas£s
,

284 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_š¡ªû_şas£s
])

287 
__Çme__
 == '__main__':

288 
tf
.
‹¡
.
	`maš
()

	@eval.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

16 
	gr
"""Evaluationƒxecutable for detection models.

18 
This
 
execubË
 
is
 
u£d
 
to
 
ev®u©e
 
	gD‘eùiÚMod–s
. 
Th”e
 
¬e
 
two
 
ways
 
of


19 
cÚfiguršg
 
the
 
ev®
 
	gjob
.

21 1è
A
 
sšgË
 
	gp–še_pb2
.
T¿šEv®P–šeCÚfig
 
fe
 
maybe
 
¥ecif›d
 
	gš¡—d
.

22 
In
 
this
 
	gmode
, 
	gthe
 --
ev®_Œaššg_d©a
 
æag
 
may
 
be
 
giv’
 
to
 
fÜû
 
the
 
p–še


23 
to
 
ev®u©e
 
Ú
 
Œaššg
 
d©a
 
	gš¡—d
.

25 
Exam¶e
 
	gu§ge
:

26 ./
ev®
 \

27 --
logto¡d”r
 \

28 --
checkpošt_dœ
=
·th
/
to
/checkpoint_dir \

29 --
ev®_dœ
=
·th
/
to
/eval_dir \

30 --
p–še_cÚfig_·th
=
p–še_cÚfig
.
pbtxt


32 2è
Th»e
 
cÚfigu¿tiÚ
 
fes
 
may
 
be
 
´ovided
: 
a
 
mod–_pb2
.
D‘eùiÚMod–


33 
cÚfigu¿tiÚ
 
fe
 
to
 
defše
 
wh©
 
ty³
 
of
 
D‘eùiÚMod–
 
is
 
bešg
 
evauÏ‹d
, 
ª


34 
	gšput_»ad”_pb2
.
IÅutR—d”
 
fe
 
to
 
¥ecify
 
wh©
 
d©a
 
the
 
mod–
 
is
 
ev®u©šg


35 
ªd
 
ª
 
	gev®_pb2
.
Ev®CÚfig
 
fe
 
to
 
cÚfigu»
 
ev®u©iÚ
 
	g·¿m‘”s
.

37 
Exam¶e
 
	gu§ge
:

38 ./
ev®
 \

39 --
logto¡d”r
 \

40 --
checkpošt_dœ
=
·th
/
to
/checkpoint_dir \

41 --
ev®_dœ
=
·th
/
to
/eval_dir \

42 --
ev®_cÚfig_·th
=
ev®_cÚfig
.
pbtxt
 \

43 --
mod–_cÚfig_·th
=
mod–_cÚfig
.
pbtxt
 \

44 --
šput_cÚfig_·th
=
ev®_šput_cÚfig
.
pbtxt


46 
impÜt
 
funùoŞs


47 
impÜt
 
‹nsÜæow
 
as
 
tf


49 
äom
 
googË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


50 
äom
 
objeù_d‘eùiÚ
 
impÜt
 
ev®u©Ü


51 
äom
 
objeù_d‘eùiÚ
.
bud”s
 
impÜt
 
šput_»ad”_bud”


52 
äom
 
objeù_d‘eùiÚ
.
bud”s
 
impÜt
 
mod–_bud”


53 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
ev®_pb2


54 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
šput_»ad”_pb2


55 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
mod–_pb2


56 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
p–še_pb2


57 
äom
 
objeù_d‘eùiÚ
.
uts
 
impÜt
 
Ïb–_m­_ut


59 
tf
.
loggšg
.
	$£t_v”bos™y
(
tf
.
loggšg
.
INFO
)

61 
æags
 = 
tf
.
­p
.flags

62 
æags
.
	`DEFINE_boŞ—n
('ev®_Œaššg_d©a', 
F®£
,

64 
æags
.
	`DEFINE_¡ršg
('checkpoint_dir', '',

67 
æags
.
	`DEFINE_¡ršg
('eval_dir', '',

69 
æags
.
	`DEFINE_¡ršg
('pipeline_config_path', '',

72 
æags
.
	`DEFINE_¡ršg
('eval_config_path', '',

74 
æags
.
	`DEFINE_¡ršg
('input_config_path', '',

76 
æags
.
	`DEFINE_¡ršg
('model_config_path', '',

79 
FLAGS
 = 
æags
.FLAGS

82 
def
 
	$g‘_cÚfigs_äom_p–še_fe
():

85 
R—ds
 
ev®u©iÚ
 
cÚfig
 
äom
 
fe
 
¥ecif›d
 
by
 
p–še_cÚfig_·th
 
æag
.

87 
R‘uºs
:

88 
mod–_cÚfig
: 
a
 
mod–_pb2
.
D‘eùiÚMod–


89 
ev®_cÚfig
: 
a
 
ev®_pb2
.
Ev®CÚfig


90 
šput_cÚfig
: 
a
 
šput_»ad”_pb2
.
IÅutR—d”


92 
p–še_cÚfig
 = 
p–še_pb2
.
	$T¿šEv®P–šeCÚfig
()

93 
w™h
 
tf
.
gfe
.
	`GFe
(
FLAGS
.
p–še_cÚfig_·th
, 'r'è
as
 
f
:

94 
‹xt_fÜm©
.
	`M”ge
(
f
.
	`»ad
(), 
p–še_cÚfig
)

96 
mod–_cÚfig
 = 
p–še_cÚfig
.
mod–


97 
FLAGS
.
ev®_Œaššg_d©a
:

98 
ev®_cÚfig
 = 
p–še_cÚfig
.
Œaš_cÚfig


100 
ev®_cÚfig
 = 
p–še_cÚfig
.eval_config

101 
šput_cÚfig
 = 
p–še_cÚfig
.
ev®_šput_»ad”


103  
mod–_cÚfig
, 
ev®_cÚfig
, 
šput_cÚfig


106 
def
 
	$g‘_cÚfigs_äom_muÉË_fes
():

109 
R—ds
 
the
 
ev®u©iÚ
 
cÚfig
 
äom
h
fŞlowšg
 
fes
:

110 
mod–_cÚfig
: 
R—d
 
äom
 --
mod–_cÚfig_·th


111 
ev®_cÚfig
: 
R—d
 
äom
 --
ev®_cÚfig_·th


112 
šput_cÚfig
: 
R—d
 
äom
 --
šput_cÚfig_·th


114 
R‘uºs
:

115 
mod–_cÚfig
: 
a
 
mod–_pb2
.
D‘eùiÚMod–


116 
ev®_cÚfig
: 
a
 
ev®_pb2
.
Ev®CÚfig


117 
šput_cÚfig
: 
a
 
šput_»ad”_pb2
.
IÅutR—d”


119 
ev®_cÚfig
 = 
ev®_pb2
.
	$Ev®CÚfig
()

120 
w™h
 
tf
.
gfe
.
	`GFe
(
FLAGS
.
ev®_cÚfig_·th
, 'r'è
as
 
f
:

121 
‹xt_fÜm©
.
	`M”ge
(
f
.
	`»ad
(), 
ev®_cÚfig
)

123 
mod–_cÚfig
 = 
mod–_pb2
.
	$D‘eùiÚMod–
()

124 
w™h
 
tf
.
gfe
.
	`GFe
(
FLAGS
.
mod–_cÚfig_·th
, 'r'è
as
 
f
:

125 
‹xt_fÜm©
.
	`M”ge
(
f
.
	`»ad
(), 
mod–_cÚfig
)

127 
šput_cÚfig
 = 
šput_»ad”_pb2
.
	$IÅutR—d”
()

128 
w™h
 
tf
.
gfe
.
	`GFe
(
FLAGS
.
šput_cÚfig_·th
, 'r'è
as
 
f
:

129 
‹xt_fÜm©
.
	`M”ge
(
f
.
	`»ad
(), 
šput_cÚfig
)

131  
mod–_cÚfig
, 
ev®_cÚfig
, 
šput_cÚfig


134 
def
 
	$maš
(
unu£d_¬gv
):

135 
as£¹
 
FLAGS
.
checkpošt_dœ
, '`checkpoint_dir` is missing.'

136 
as£¹
 
FLAGS
.
ev®_dœ
, '`eval_dir` is missing.'

137 
FLAGS
.
p–še_cÚfig_·th
:

138 
mod–_cÚfig
, 
ev®_cÚfig
, 
šput_cÚfig
 = 
	$g‘_cÚfigs_äom_p–še_fe
()

140 
mod–_cÚfig
, 
ev®_cÚfig
, 
šput_cÚfig
 = 
	$g‘_cÚfigs_äom_muÉË_fes
()

142 
mod–_â
 = 
funùoŞs
.
	$·¹Ÿl
(

143 
mod–_bud”
.
bud
,

144 
mod–_cÚfig
=model_config,

145 
is_Œaššg
=
F®£
)

147 
ü—‹_šput_diù_â
 = 
funùoŞs
.
	$·¹Ÿl
(

148 
šput_»ad”_bud”
.
bud
,

149 
šput_cÚfig
)

151 
Ïb–_m­
 = 
Ïb–_m­_ut
.
	$lßd_Ïb–m­
(
šput_cÚfig
.
Ïb–_m­_·th
)

152 
max_num_şas£s
 = 
	$max
([
™em
.
id
 ™em 
š
 
Ïb–_m­
.item])

153 
ÿ‹gÜ›s
 = 
Ïb–_m­_ut
.
	$cÚv”t_Ïb–_m­_to_ÿ‹gÜ›s
(

154 
Ïb–_m­
, 
max_num_şas£s
)

156 
ev®u©Ü
.
	$ev®u©e
(
ü—‹_šput_diù_â
, 
mod–_â
, 
ev®_cÚfig
, 
ÿ‹gÜ›s
,

157 
FLAGS
.
checkpošt_dœ
, FLAGS.
ev®_dœ
)

160 
__Çme__
 == '__main__':

161 
tf
.
­p
.
	`run
()

	@eval_util.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
cİy


19 
impÜt
 
loggšg


20 
impÜt
 
os


21 
impÜt
 
time


23 
impÜt
 
numpy
 
as
 
Å


24 
impÜt
 
‹nsÜæow
 
as
 
tf


26 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
Ïb–_m­_ut


27 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
objeù_d‘eùiÚ_ev®u©iÚ


28 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
visu®iz©iÚ_uts
 
as
 
vis_uts


30 
	g¦im
 = 
tf
.
cÚŒib
.
¦im


33 
def
 
	$wr™e_m‘rics
(
m‘rics
, 
glob®_¡•
, 
summ¬y_dœ
):

36 
Args
:

37 
m‘rics
: 
A
 
diùiÚ¬y
 
cÚššg
 
m‘ric
 
Çmes
 
ªd
 
v®ues
.

38 
glob®_¡•
: 
Glob®
 
¡•
 
©
 
which
 
the
 
m‘rics
 
¬e
 
compu‹d
.

39 
summ¬y_dœ
: 
DœeùÜy
 
to
 
wr™e
 
‹nsÜæow
 
summ¬›s
o.

41 
loggšg
.
	`šfo
('Writing metricsof summary.')

42 
summ¬y_wr™”
 = 
tf
.
summ¬y
.
	$FeWr™”
(
summ¬y_dœ
)

43 
key
 
š
 
	$sÜ‹d
(
m‘rics
):

44 
summ¬y
 = 
tf
.
	`Summ¬y
(
v®ue
=[

45 
tf
.
Summ¬y
.
	`V®ue
(
g
=
key
, 
sim¶e_v®ue
=
m‘rics
[key]),

47 
summ¬y_wr™”
.
	$add_summ¬y
(
summ¬y
, 
glob®_¡•
)

48 
loggšg
.
	`šfo
('%s: %f', 
key
, 
m‘rics
[key])

49 
summ¬y_wr™”
.
	$şo£
()

50 
loggšg
.
	`šfo
('Metrics writtenof summary.')

53 
def
 
	$ev®u©e_d‘eùiÚ_»suÉs_·sÿl_voc
(
»suÉ_li¡s
,

54 
ÿ‹gÜ›s
,

55 
Ïb–_id_off£t
=0,

56 
iou_th»s
=0.5,

57 
cÜloc_summ¬y
=
F®£
):

60 
This
 
funùiÚ
 
compu‹s
 
Pasÿl
 
VOC
 
m‘rics
. Thi funùiÚ 
by
 

61 
kes
 
d‘eùiÚs
 
ªd
 
groundŒuth
 
boxes
 
’coded
 
š
 
»suÉ_li¡s
‡nd 
wr™es


62 
ev®u©iÚ
 
»suÉs
 
to
 
tf
 
summ¬›s
 
which
 
ÿn
 
be
 
v›wed
 
Ú
 
‹nsÜbßrd
.

64 
Args
:

65 
»suÉ_li¡s
: 
a
 
diùiÚ¬y
 
hŞdšg
 
li¡s
 
of
 
groundŒuth
 
ªd
 
d‘eùiÚ


66 
d©a
 
cÜ»¥Údšg
 
to
 
—ch
 
image
 
bešg
 
ev®u©ed
. 
The
 
fŞlowšg
 
keys


67 
¬e
 
»quœed
:

68 'image_id': 
a
 
li¡
 
of
 
¡ršg
 
ids


69 'd‘eùiÚ_boxes': 
a
 
li¡
 
of
 
æßt32
 
numpy
 
¬¿ys
 oà
sh­e
 [
N
, 4]

70 'd‘eùiÚ_scÜes': 
a
 
li¡
 
of
 
æßt32
 
numpy
 
¬¿ys
 oà
sh­e
 [
N
]

71 'd‘eùiÚ_şas£s': 
a
 
li¡
 
of
 
št32
 
numpy
 
¬¿ys
 oà
sh­e
 [
N
]

72 'groundŒuth_boxes': 
a
 
li¡
 
of
 
æßt32
 
numpy
 
¬¿ys
 oà
sh­e
 [
M
, 4]

73 'groundŒuth_şas£s': 
a
 
li¡
 
of
 
št32
 
numpy
 
¬¿ys
 oà
sh­e
 [
M
]

74 
ªd
 
the
 
»maššg
 
f›lds
 
b–ow
 
¬e
 
İtiÚ®
:

75 'difficuÉ': 
a
 
li¡
 
of
 
boŞ—n
 
¬¿ys
 oà
sh­e
 [
M
] 
šdiÿtšg
 
the


76 
difficuÉy
 
of
 
groundŒuth
 
boxes
. 
Some
 
d©a£ts
 
like
 
PASCAL
 
VOC
 
´ovide


77 
this
 
šfÜm©iÚ
 
ªd
 
™
 
is
 
u£d
 
to
 
»move
 
difficuÉ
 
exam¶es
 
äom
 
ev®


78 
š
 
Üd”
 
to
 
nÙ
 
³Çlize
 
the
 
mod–s
 
Ú
 
them
.

79 
NÙe
 
th©
 
™
 
is
 
okay
 
to
 
have
 
add™iÚ®
 
f›lds
 
š
 
»suÉ_li¡s
 --- 
they


80 
¬e
 
sim¶y
 
ignÜed
.

81 
ÿ‹gÜ›s
: 
a
 
li¡
 
of
 
diùiÚ¬›s
 
»´e£Ášg
 
®l
 
possibË
 categories.

82 
Each
 
diù
 
š
 
this
 
li¡
 
has
 
the
 
fŞlowšg
 
keys
:

83 'id': (
»quœed
è
ª
 
š‹g”
 
id
 
uniqu–y
 
id’tifyšg
 
this
 
ÿ‹gÜy


84 'Çme': (
»quœed
è
¡ršg
 
»´e£Ášg
 
ÿ‹gÜy
 
Çme


85 
e
.
g
., 'cat', 'dog', 'pizza'

86 
Ïb–_id_off£t
: 
ª
 
š‹g”
 
off£t
 
the
 
Ïb–
 
¥aû
.

87 
iou_th»s
: 
d‘”mššg
 
the
 
IoU
 
th»shŞd
 
©
 
which
 
a
 
box
 
is
 
cÚsid”ed


88 
cÜ»ù
. 
DeçuÉs
 
to
 
the
 
¡ªd¬d
 0.5.

89 
cÜloc_summ¬y
: 
boŞ—n
. 
If
 
True
, 
®so
 
ouuts
 
CÜLoc
 
m‘rics
.

91 
R‘uºs
:

92 
A
 
diùiÚ¬y
 
of
 
m‘ric
 
Çmes
 
to
 
sÿÏr
 
v®ues
.

94 
Rai£s
:

95 
V®ueE¼Ü
: 
the
 
£t
 
of
 
keys
 
š
 
»suÉ_li¡s
 
is
 
nÙ
 
a
 
su³r£t
 ofhe

96 
ex³ùed
 
li¡
 
of
 
keys
. 
UÃx³ùed
 key 
¬e
 
ignÜed
.

97 
V®ueE¼Ü
: 
the
 
li¡s
 
š
 
»suÉ_li¡s
 
have
 
šcÚsi¡’t
 
sizes
.

99 #check 
ex³ùed
 
keys
 
š
 
»suÉ_li¡s


100 
ex³ùed_keys
 = [

103 
ex³ùed_keys
 += ['groundtruth_boxes', 'groundtruth_classes']

104 
nÙ
 
	`£t
(
ex³ùed_keys
).
	`issub£t
(£t(
»suÉ_li¡s
.
	$keys
())):

105 
¿i£
 
	`V®ueE¼Ü
('result_lists does‚ot haveƒxpected key set.')

106 
num_»suÉs
 = 
	$Ën
(
»suÉ_li¡s
[
ex³ùed_keys
[0]])

107 
key
 
š
 
ex³ùed_keys
:

108 
	`Ën
(
»suÉ_li¡s
[
key
]è!ğ
num_»suÉs
:

109 
¿i£
 
	`V®ueE¼Ü
('Inconsistent†ist sizes in„esult_lists')

111 #PasÿÈ
VOC
 
ev®u©Ü
 
assumes
 
fÜeground
 
šdex
 
¡¬ts
 
äom
 
z”o
.

112 
ÿ‹gÜ›s
 = 
cİy
.
	$d“pcİy
(
ÿ‹gÜ›s
)

113 
idx
 
š
 
	`¿nge
(
	$Ën
(
ÿ‹gÜ›s
)):

114 
ÿ‹gÜ›s
[
idx
]['id'] -ğ
Ïb–_id_off£t


116 #num_şas£ (
maybe
 
’coded
 
as
 
ÿ‹gÜ›s
)

117 
num_şas£s
 = 
	`max
([
ÿt
['id'] ÿˆ
š
 
ÿ‹gÜ›s
]) + 1

118 
loggšg
.
	`šfo
('Computing Pascal VOC metrics on„esults.')

119 
	`®l
(
image_id
.
	$isdig™
(è
image_id
 
š
 
»suÉ_li¡s
['image_id']):

120 
image_ids
 = [(
image_id
èimage_id 
š
 
»suÉ_li¡s
['image_id']]

122 
image_ids
 = 
	$¿nge
(
num_»suÉs
)

124 
ev®u©Ü
 = 
objeù_d‘eùiÚ_ev®u©iÚ
.
	$ObjeùD‘eùiÚEv®u©iÚ
(

125 
num_şas£s
, 
m©chšg_iou_th»shŞd
=
iou_th»s
)

127 
difficuÉ_li¡s
 = 
NÚe


128 'difficuÉ' 
š
 
»suÉ_li¡s
 
ªd
„esult_lists['difficult']:

129 
difficuÉ_li¡s
 = 
»suÉ_li¡s
['difficult']

130 
idx
, 
image_id
 
š
 
	$’um”©e
(
image_ids
):

131 
difficuÉ
 = 
NÚe


132 
difficuÉ_li¡s
 
is
 
nÙ
 
NÚe
 
ªd
 difficuÉ_li¡s[
idx
].
size
:

133 
difficuÉ
 = 
difficuÉ_li¡s
[
idx
].
	$a¡y³
(
Å
.
boŞ
)

134 
ev®u©Ü
.
	`add_sšgË_ground_Œuth_image_šfo
(

135 
image_id
, 
»suÉ_li¡s
['groundŒuth_boxes'][
idx
],

136 
»suÉ_li¡s
['groundŒuth_şas£s'][
idx
] - 
Ïb–_id_off£t
,

137 
difficuÉ
)

138 
ev®u©Ü
.
	`add_sšgË_d‘eùed_image_šfo
(

139 
image_id
, 
»suÉ_li¡s
['d‘eùiÚ_boxes'][
idx
],

140 
»suÉ_li¡s
['d‘eùiÚ_scÜes'][
idx
],

141 
»suÉ_li¡s
['d‘eùiÚ_şas£s'][
idx
] - 
Ïb–_id_off£t
)

142 
³r_şass_­
, 
m—n_­
, 
_
, _, 
³r_şass_cÜloc
, 
m—n_cÜloc
 = (

143 
ev®u©Ü
.
	$ev®u©e
())

145 
m‘rics
 = {'P»cisiÚ/mAP@{}IOU'.
	`fÜm©
(
iou_th»s
): 
m—n_­
}

146 
ÿ‹gÜy_šdex
 = 
Ïb–_m­_ut
.
	$ü—‹_ÿ‹gÜy_šdex
(
ÿ‹gÜ›s
)

147 
idx
 
š
 
	$¿nge
(
³r_şass_­
.
size
):

148 
idx
 
š
 
ÿ‹gÜy_šdex
:

149 
di¥Ïy_Çme
 = ('PerformanceByCategory/mAP@{}IOU/{}'

150 .
	`fÜm©
(
iou_th»s
, 
ÿ‹gÜy_šdex
[
idx
]['name']))

151 
m‘rics
[
di¥Ïy_Çme
] = 
³r_şass_­
[
idx
]

153 
cÜloc_summ¬y
:

154 
m‘rics
['CÜLoc/CÜLoc@{}IOU'.
	`fÜm©
(
iou_th»s
)] = 
m—n_cÜloc


155 
idx
 
š
 
	$¿nge
(
³r_şass_cÜloc
.
size
):

156 
idx
 
š
 
ÿ‹gÜy_šdex
:

157 
di¥Ïy_Çme
 = (

158 'P”fÜmªûByC©egÜy/CÜLoc@{}IOU/{}'.
	`fÜm©
(

159 
iou_th»s
, 
ÿ‹gÜy_šdex
[
idx
]['name']))

160 
m‘rics
[
di¥Ïy_Çme
] = 
³r_şass_cÜloc
[
idx
]

161  
m‘rics


164 #TODO: 
Add
 
‹¡s
.

165 
def
 
	`visu®ize_d‘eùiÚ_»suÉs
(
»suÉ_diù
,

166 
g
,

167 
glob®_¡•
,

168 
ÿ‹gÜ›s
,

169 
summ¬y_dœ
='',

170 
expÜt_dœ
='',

171 
agno¡ic_mode
=
F®£
,

172 
show_groundŒuth
=
F®£
,

173 
mš_scÜe_th»sh
=.5,

174 
max_num_´ediùiÚs
=20):

177 
This
 
funùiÚ
 
visu®izes
 
ª
 
image
 
w™h
 
™s
 
d‘eùed
 
boundšg
 
boxes
 
ªd
 
wr™es


178 
to
 
image
 
summ¬›s
 
which
 
ÿn
 
be
 
v›wed
 
Ú
 
‹nsÜbßrd
. 
It
 
İtiÚ®ly
 
®so


179 
wr™es
 
images
 
to
 
a
 
dœeùÜy
. 
In
 
the
 
of
 
missšg
 
’Œy
 
š
h
Ïb–
 
m­
,

180 
unknown
 
şass
 
Çme
 
š
 
the
 
visu®iz©iÚ
 
is
 
shown
 
as
 "N/A".

182 
Args
:

183 
»suÉ_diù
: 
a
 
diùiÚ¬y
 
hŞdšg
 
groundŒuth
 
ªd
 
d‘eùiÚ


184 
d©a
 
cÜ»¥Údšg
 
to
 
—ch
 
image
 
bešg
 
ev®u©ed
. 
The
 
fŞlowšg
 
keys


185 
¬e
 
»quœed
:

186 'Üigš®_image': 
a
 
numpy
 
¬¿y
 
»´e£Ášg
 
the
 
image
 
w™h
 
sh­e


187 [1, 
height
, 
width
, 3]

188 'd‘eùiÚ_boxes': 
a
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 4]

189 'd‘eùiÚ_scÜes': 
a
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
]

190 'd‘eùiÚ_şas£s': 
a
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
]

191 
The
 
fŞlowšg
 
keys
 
¬e
 
İtiÚ®
:

192 'groundŒuth_boxes': 
a
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 4]

193 'groundŒuth_keypošts': 
a
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 
num_keypošts
, 2]

194 
D‘eùiÚs
 
¬e
 
assumed
 
to
 
be
 
´ovided
 
š
 
deü—sšg
 
Üd”
 
of
 
scÜe
 
ªd
 

195 
di¥Ïy
, 
ªd
 
we
 
assume
 
th©
 
scÜes
 
¬e
 
´obab™›s
 
b‘w“n
 0‡nd 1.

196 
g
: 
‹nsÜbßrd
 
	$g
 (
¡ršg
è
to
 
assocŸ‹
 
w™h
 
image
.

197 
glob®_¡•
: 
glob®
 
¡•
 
©
 
which
 
the
 
visu®iz©iÚ
 
¬e
 
g’”©ed
.

198 
ÿ‹gÜ›s
: 
a
 
li¡
 
of
 
diùiÚ¬›s
 
»´e£Ášg
 
®l
 
possibË
 categories.

199 
Each
 
diù
 
š
 
this
 
li¡
 
has
 
the
 
fŞlowšg
 
keys
:

200 'id': (
»quœed
è
ª
 
š‹g”
 
id
 
uniqu–y
 
id’tifyšg
 
this
 
ÿ‹gÜy


201 'Çme': (
»quœed
è
¡ršg
 
»´e£Ášg
 
ÿ‹gÜy
 
Çme


202 
e
.
g
., 'cat', 'dog', 'pizza'

203 'su³rÿ‹gÜy': (
İtiÚ®
è
¡ršg
 
»´e£Ášg
 
the
 
su³rÿ‹gÜy


204 
e
.
g
., 'ªim®', 'vehişe', 'food', 
‘c


205 
summ¬y_dœ
: 
the
 
ouut
 
dœeùÜy
 
to
 
which
h
image
 
summ¬›s
 
¬e
 
wr™‹n
.

206 
expÜt_dœ
: 
the
 
ouut
 
dœeùÜy
 
to
 
which
 
images
 
¬e
 
wr™‹n
. 
If
 
this
 
is


207 
	`em±y
 (), 
th’
 
images
 
¬e
 
nÙ
 
expÜ‹d
.

208 
agno¡ic_mode
: 
	$boŞ—n
 (: 
F®£
è
cÚŒŞlšg
 
wh‘h”
 
to
 
ev®u©e
 
š


209 
şass
-
agno¡ic
 
mode
 
Ü
 
nÙ
.

210 
show_groundŒuth
: 
	$boŞ—n
 (: 
F®£
è
cÚŒŞlšg
 
wh‘h”
 
to
 
show


211 
groundŒuth
 
boxes
 
š
 
add™iÚ
 
to
 
d‘eùed
 boxes

212 
mš_scÜe_th»sh
: 
mšimum
 
scÜe
 
th»shŞd
 
a
 
box
 
to
 
be
 
visu®ized


213 
max_num_´ediùiÚs
: 
maximum
 
numb”
 
of
 
d‘eùiÚs
 
to
 
visu®ize


214 
Rai£s
:

215 
V®ueE¼Ü
: 
»suÉ_diù
 
dÛs
 
nÙ
 
cÚš
 
the
 
ex³ùed
 
	`keys
 (
i
.
e
.,

219 
nÙ
 
	`£t
([

222 ]).
	`issub£t
(
	`£t
(
»suÉ_diù
.
	$keys
())):

223 
¿i£
 
	`V®ueE¼Ü
('result_dict does‚ot contain‡llƒxpected keys.')

224 
show_groundŒuth
 
ªd
 'groundŒuth_boxes' 
nÙ
 
š
 
»suÉ_diù
:

225 
¿i£
 
	`V®ueE¼Ü
('If show_groundtruth isƒnabled,„esult_dict must contain '

227 
loggšg
.
	`šfo
('Creating detection visualizations.')

228 
ÿ‹gÜy_šdex
 = 
Ïb–_m­_ut
.
	$ü—‹_ÿ‹gÜy_šdex
(
ÿ‹gÜ›s
)

230 
image
 = 
Å
.
	`squ“ze
(
»suÉ_diù
['Üigš®_image'], 
axis
=0)

231 
d‘eùiÚ_boxes
 = 
»suÉ_diù
['detection_boxes']

232 
d‘eùiÚ_scÜes
 = 
»suÉ_diù
['detection_scores']

233 
d‘eùiÚ_şas£s
 = 
Å
.
	`št32
((
»suÉ_diù
['detection_classes']))

234 
d‘eùiÚ_keypošts
 = 
»suÉ_diù
.
	`g‘
('d‘eùiÚ_keypošts', 
NÚe
)

235 
d‘eùiÚ_masks
 = 
»suÉ_diù
.
	`g‘
('d‘eùiÚ_masks', 
NÚe
)

237 #PlÙ 
groundŒuth
 
und”Ã©h
 
d‘eùiÚs


238 
show_groundŒuth
:

239 
groundŒuth_boxes
 = 
»suÉ_diù
['groundtruth_boxes']

240 
groundŒuth_keypošts
 = 
»suÉ_diù
.
	`g‘
('groundŒuth_keypošts', 
NÚe
)

241 
vis_uts
.
	$visu®ize_boxes_ªd_Ïb–s_Ú_image_¬¿y
(

242 
image
,

243 
groundŒuth_boxes
,

244 
NÚe
,

245 
NÚe
,

246 
ÿ‹gÜy_šdex
,

247 
keypošts
=
groundŒuth_keypošts
,

248 
u£_nÜm®ized_coÜdš©es
=
F®£
,

249 
max_boxes_to_d¿w
=
NÚe
)

250 
vis_uts
.
	$visu®ize_boxes_ªd_Ïb–s_Ú_image_¬¿y
(

251 
image
,

252 
d‘eùiÚ_boxes
,

253 
d‘eùiÚ_şas£s
,

254 
d‘eùiÚ_scÜes
,

255 
ÿ‹gÜy_šdex
,

256 
š¡ªû_masks
=
d‘eùiÚ_masks
,

257 
keypošts
=
d‘eùiÚ_keypošts
,

258 
u£_nÜm®ized_coÜdš©es
=
F®£
,

259 
max_boxes_to_d¿w
=
max_num_´ediùiÚs
,

260 
mš_scÜe_th»sh
=min_score_thresh,

261 
agno¡ic_mode
=agnostic_mode)

263 
expÜt_dœ
:

264 
expÜt_·th
 = 
os
.
·th
.
	`još
(
expÜt_dœ
, 'expÜt-{}.²g'.
	$fÜm©
(
g
))

265 
vis_uts
.
	$§ve_image_¬¿y_as_²g
(
image
, 
expÜt_·th
)

267 
summ¬y
 = 
tf
.
	`Summ¬y
(
v®ue
=[

268 
tf
.
Summ¬y
.
	`V®ue
(
g
ñag, 
image
ñf.Summ¬y.
	`Image
(

269 
’coded_image_¡ršg
=
vis_uts
.
	`’code_image_¬¿y_as_²g_¡r
(

270 
image
)))

272 
summ¬y_wr™”
 = 
tf
.
summ¬y
.
	$FeWr™”
(
summ¬y_dœ
)

273 
summ¬y_wr™”
.
	$add_summ¬y
(
summ¬y
, 
glob®_¡•
)

274 
summ¬y_wr™”
.
	$şo£
()

276 
loggšg
.
	`šfo
('D‘eùiÚ visu®iz©iÚ wr™‹ÀtØsumm¬y w™hag %s.', 
g
)

279 #TODO: 
Add
 
‹¡s
.

280 #TODO: 
Have
 
ª
 
¬gum’t
 
ÿÎed
 `
agg»g©ed_´oûssÜ_‹nsÜ_keys
` 
th©
 
cÚšs


281 #¨
wh™–i¡
 
of
 
‹nsÜs
 
u£d
 
by
 
the
 `
agg»g©ed_»suÉ_´oûssÜ
` 
š¡—d
 oà
a


282 #bÏckli¡. 
This
 
wl
 
´ev’t
 
us
 
äom
 
šadv”‹Ály
 
addšg
 
ªy
 
ev®u©ed


283 #‹nsÜ 
što
 
the
 `
»suÉs_li¡
` 
d©a
 
¡ruùu»
 
th©
 
¬e
 
nÙ
 
Ãeded
 
by


284 #`
agg»g©ed_»suÉ_´•roûssÜ
`.

285 
def
 
	`run_checkpošt_Úû
(
‹nsÜ_diù
,

286 
upd©e_İ
,

287 
summ¬y_dœ
,

288 
agg»g©ed_»suÉ_´oûssÜ
=
NÚe
,

289 
b©ch_´oûssÜ
=
NÚe
,

290 
checkpošt_dœs
=
NÚe
,

291 
v¬ŸbËs_to_»¡Üe
=
NÚe
,

292 
»¡Üe_â
=
NÚe
,

293 
num_b©ches
=1,

294 
ma¡”
='',

295 
§ve_g¿ph
=
F®£
,

296 
§ve_g¿ph_dœ
='',

297 
m‘ric_Çmes_to_v®ues
=
NÚe
,

298 
keys_to_exşude_äom_»suÉs
=()):

301 
PythÚ
 
m‘rics
 
¬e
 
´oûs£d
 
š
 
b©ch
 
by
 
the
 
agg»g©ed_»suÉ_´oûssÜ
,

302 
‹nsÜæow
 
¦im
 
m‘rics
 
¡©i¡ics
 
¬e
 
compu‹d
 
by
 
ruÂšg


303 
m‘ric_Çmes_to_upd©es
 
‹nsÜs
 
ªd
 
agg»g©ed
 
usšg
 
m‘ric_Çmes_to_v®ues


304 
‹nsÜ
.

306 
Args
:

307 
‹nsÜ_diù
: 
a
 
diùiÚ¬y
 
hŞdšg
 
‹nsÜs
 
»´e£Ášg
‡ 
b©ch
 
of
 
d‘eùiÚs


308 
ªd
 
cÜ»¥Údšg
 
groundŒuth
 
ªnÙ©iÚs
.

309 
upd©e_İ
: 
a
 
‹nsÜæow
 
upd©e
 
İ
 
th©
 
wl
 
run
 
—ch
 
b©ch
 
®Úg
 
w™h


310 
the
 
‹nsÜs
 
š
 
‹nsÜ_diù
..

311 
summ¬y_dœ
: 
a
 
dœeùÜy
 
to
 
wr™e
 
m‘rics
 
summ¬›s
.

312 
agg»g©ed_»suÉ_´oûssÜ
: 
a
 
funùiÚ
 
kšg
 
Úe
 
¬gum’ts
:

313 1. 
»suÉ_li¡s
: 
a
 
diùiÚ¬y
 
w™h
 
keys
 
m©chšg
 
tho£
 
š
 
‹nsÜ_diù


314 
ªd
 
cÜ»¥Údšg
 
v®ues
 
bešg
 
the
 
li¡
 
of
 
»suÉs
 
—ch
 
‹nsÜ


315 
š
 
‹nsÜ_diù
. 
The
 
Ëngth
 
of
 
—ch
 
such
 
li¡
 
is
 
num_b©ches
.

316 
b©ch_´oûssÜ
: 
a
 
funùiÚ
 
kšg
 
four
 
¬gum’ts
:

317 1. 
‹nsÜ_diù
: 
the
 
§me
’sÜ_diù 
th©
 
is
 
·s£d
 
š
 
as
h
fœ¡


318 
¬gum’t
 
to
 
this
 
funùiÚ
.

319 2. 
£ss
: 
a
 
‹nsÜæow
 
£ssiÚ


320 3. 
b©ch_šdex
: 
ª
 
š‹g”
 
»´e£Ášg
 
the
 
šdex
 
of
h
b©ch
 
amÚg¡


321 
®l
 
b©ches


322 4. 
upd©e_İ
: 
a
 
‹nsÜæow
 
upd©e
 
İ
 
th©
 
wl
 
run
 
—ch
 
b©ch
.

323 
ªd
 
»tuºs
 
»suÉ_diù
, 
a
 
diùiÚ¬y
 
of
 
»suÉs
 
th©
 
b©ch
.

324 
By
 , 
b©ch_´oûssÜ
 
is
 
NÚe
, 
which
 
deçuÉs
 
to
 
ruÂšg
:

325  
£ss
.
	$run
(
‹nsÜ_diù
)

326 
To
 
sk
 
ª
 
image
, 
™
 
suffiûs
 
to
 ‡À
em±y
 
diùiÚ¬y
 
š
 
¶aû
 
of


327 
»suÉ_diù
.

328 
checkpošt_dœs
: 
li¡
 
of
 
dœeùÜ›s
 
to
 
lßd
 
što
 
ª
 
En£mbËMod–
. 
If
 
™


329 
has
 
Úly
 
Úe
 
dœeùÜy
, 
En£mbËMod–
 
wl
 
nÙ
 
be
 
u£d
 -- 
a
 
D‘eùiÚMod–


330 
wl
 
be
 
š¡ªtŸ‹d
 
dœeùly
. 
NÙ
 
u£d
 
»¡Üe_â
 
is
 
£t
.

331 
v¬ŸbËs_to_»¡Üe
: 
NÚe
, 
Ü
 
a
 
diùiÚ¬y
 
m­pšg
 
v¬ŸbË
 
Çmes
 
found
 
š


332 
a
 
checkpošt
 
to
 
mod–
 
v¬ŸbËs
. 
The
 
diùiÚ¬y
 
would
 
nÜm®ly
 
be


333 
g’”©ed
 
by
 
ü—tšg
 
a
 
tf
.
Œaš
.
ExpÚ’tŸlMovšgAv”age
 
objeù
 
ªd


334 
ÿÎšg
 
™s
 
	$v¬ŸbËs_to_»¡Üe
(è
m‘hod
. 
NÙ
 
u£d
 
»¡Üe_â
 
is
 
£t
.

335 
»¡Üe_â
: 
NÚe
, 
Ü
 
a
 
funùiÚ
 
th©
 
kes
‡ 
tf
.
SessiÚ
 
objeù
 
ªd
 
cÜ»ùly


336 
»¡Ües
 
®l
 
Ãûs§ry
 
v¬ŸbËs
 
äom
 
the
 
cÜ»ù
 
checkpošt
 
fe
. 
If


337 
NÚe
, 
©‹m±s
 
to
 
»¡Üe
 
äom
 
the
 
fœ¡
 
dœeùÜy
 
š
 
checkpošt_dœs
.

338 
num_b©ches
: 
the
 
numb”
 
of
 
b©ches
 
to
 
u£
 
ev®u©iÚ
.

339 
ma¡”
: 
the
 
loÿtiÚ
 
of
h
T’sÜæow
 
£ssiÚ
.

340 
§ve_g¿ph
: 
wh‘h”
 
Ü
 
nÙ
 
the
 
T’sÜæow
 
g¿ph
 
is
 
¡Üed
 
as
 
a
 
pbtxt
 
fe
.

341 
§ve_g¿ph_dœ
: 
wh”e
 
to
 
¡Üe
 
the
 
T’sÜæow
 
g¿ph
 
Ú
 
disk
. 
If
 
§ve_g¿ph


342 
is
 
True
 
this
 
mu¡
 
be
 
nÚ
-
em±y
.

343 
m‘ric_Çmes_to_v®ues
: 
A
 
diùiÚ¬y
 
cÚššg
 
m‘ric
 
Çmes
 
to
 
‹nsÜs


344 
which
 
wl
 
be
 
ev®u©ed
 
aá”
 
´oûssšg
 
®l
 
b©ches


345 
of
 [
‹nsÜ_diù
, 
upd©e_İ
]. 
If
 
ªy
 
m‘rics
 
d•’d
 
Ú
 
¡©i¡ics
 
compu‹d


346 
duršg
 
—ch
 
b©ch
 
’su»
 
th©
 `
upd©e_İ
` 
‹nsÜ
 
has
 
a
 
cÚŒŞ
 
d•’d’cy


347 
Ú
 
the
 
upd©e
 
İs
 
th©
 
compu‹
h
¡©i¡ics
.

348 
keys_to_exşude_äom_»suÉs
: 
keys
 
š
 
‹nsÜ_diù
 
th©
 
wl
 
be
 
exşuded


349 
äom
 
»suÉs_li¡
. 
NÙe
 
th©
 
the
 
‹nsÜs
 
cÜ»¥Údšg
 
to
 
the£
 
keys
 
wl


350 
¡l
 
be
 
ev®u©ed
 
—ch
 
b©ch
, 
but
 
wÚ
't be‡ddedo„esults_list.

352 
Rai£s
:

353 
V®ueE¼Ü
: 
»¡Üe_â
 
is
 
NÚe
 
ªd
 
checkpošt_dœs
 
dÛ¢
't have‡t†east

354 
Úe
 
–em’t
.

355 
V®ueE¼Ü
: 
§ve_g¿ph
 
is
 
True
 
ªd
 
§ve_g¿ph_dœ
 i 
nÙ
 
defšed
.

357 
§ve_g¿ph
 
ªd
 
nÙ
 
§ve_g¿ph_dœ
:

358 
¿i£
 
	`V®ueE¼Ü
('`save_graph_dir` must be defined.')

359 
£ss
 = 
tf
.
	`SessiÚ
(
ma¡”
, 
g¿ph
ñf.
	$g‘_deçuÉ_g¿ph
())

360 
£ss
.
	`run
(
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
())

361 
£ss
.
	`run
(
tf
.
	$loÿl_v¬ŸbËs_š™Ÿliz”
())

362 
»¡Üe_â
:

363 
	$»¡Üe_â
(
£ss
)

365 
nÙ
 
checkpošt_dœs
:

366 
¿i£
 
	`V®ueE¼Ü
('`checkpoint_dirs` must have‡t†east oneƒntry.')

367 
checkpošt_fe
 = 
tf
.
Œaš
.
	$Ï‹¡_checkpošt
(
checkpošt_dœs
[0])

368 
§v”
 = 
tf
.
Œaš
.
	$Sav”
(
v¬ŸbËs_to_»¡Üe
)

369 
§v”
.
	$»¡Üe
(
£ss
, 
checkpošt_fe
)

371 
§ve_g¿ph
:

372 
tf
.
Œaš
.
	`wr™e_g¿ph
(
£ss
.
g¿ph_def
, 
§ve_g¿ph_dœ
, 'eval.pbtxt')

374 
v®id_keys
 = 
	`li¡
(
	`£t
(
‹nsÜ_diù
.
	`keys
()è- 
	$£t
(
keys_to_exşude_äom_»suÉs
))

375 
»suÉ_li¡s
 = {
key
: [] key 
š
 
v®id_keys
}

376 
couÁ”s
 = {'skipped': 0, 'success': 0}

377 
Ùh”_m‘rics
 = 
NÚe


378 
w™h
 
tf
.
cÚŒib
.
¦im
.
queues
.
	$QueueRuÂ”s
(
£ss
):

379 
Œy
:

380 
b©ch
 
š
 
	`¿nge
((
num_b©ches
)):

381 ià(
b©ch
 + 1) % 100 == 0:

382 
loggšg
.
	`šfo
('RuÂšgƒv® op b©ch %d/%d', 
b©ch
 + 1, 
num_b©ches
)

383 
nÙ
 
b©ch_´oûssÜ
:

384 
Œy
:

385 (
»suÉ_diù
, 
_
èğ
£ss
.
	$run
([
‹nsÜ_diù
, 
upd©e_İ
])

386 
couÁ”s
['success'] += 1

387 
exû±
 
tf
.
”rÜs
.
Inv®idArgum’tE¼Ü
:

388 
loggšg
.
	`šfo
('Skipping image')

389 
couÁ”s
['skipped'] += 1

390 
»suÉ_diù
 = {
	}
}

392 
»suÉ_diù
 = 
	$b©ch_´oûssÜ
(

393 
‹nsÜ_diù
, 
£ss
, 
b©ch
, 
couÁ”s
, 
upd©e_İ
)

394 
key
 
š
 
»suÉ_diù
:

395 
key
 
š
 
v®id_keys
:

396 
»suÉ_li¡s
[
key
].
	$­³nd
(
»suÉ_diù
[
key
])

397 
m‘ric_Çmes_to_v®ues
 
is
 
nÙ
 
NÚe
:

398 
Ùh”_m‘rics
 = 
£ss
.
	$run
(
m‘ric_Çmes_to_v®ues
)

399 
loggšg
.
	`šfo
('Runningƒval batches done.')

400 
exû±
 
tf
.
”rÜs
.
OutOfRªgeE¼Ü
:

401 
loggšg
.
	`šfo
('Doneƒvaluating --ƒpoch†imit„eached')

402 
fš®ly
:

403 #Wh’ 
dÚe
, 
ask
 
the
 
th»ads
 
to
 
¡İ
.

404 
m‘rics
 = 
	$agg»g©ed_»suÉ_´oûssÜ
(
»suÉ_li¡s
)

405 
Ùh”_m‘rics
 
is
 
nÙ
 
NÚe
:

406 
m‘rics
.
	$upd©e
(
Ùh”_m‘rics
)

407 
glob®_¡•
 = 
tf
.
Œaš
.
	`glob®_¡•
(
£ss
, 
¦im
.
	$g‘_glob®_¡•
())

408 
	$wr™e_m‘rics
(
m‘rics
, 
glob®_¡•
, 
summ¬y_dœ
)

409 
loggšg
.
	`šfo
('# sucûss: %d', 
couÁ”s
['success'])

410 
loggšg
.
	`šfo
('# sk³d: %d', 
couÁ”s
['skipped'])

411 
£ss
.
	$şo£
()

414 #TODO: 
Add
 
‹¡s
.

415 
def
 
	`»³©ed_checkpošt_run
(
‹nsÜ_diù
,

416 
upd©e_İ
,

417 
summ¬y_dœ
,

418 
agg»g©ed_»suÉ_´oûssÜ
=
NÚe
,

419 
b©ch_´oûssÜ
=
NÚe
,

420 
checkpošt_dœs
=
NÚe
,

421 
v¬ŸbËs_to_»¡Üe
=
NÚe
,

422 
»¡Üe_â
=
NÚe
,

423 
num_b©ches
=1,

424 
ev®_š‹rv®_£cs
=120,

425 
max_numb”_of_ev®u©iÚs
=
NÚe
,

426 
ma¡”
='',

427 
§ve_g¿ph
=
F®£
,

428 
§ve_g¿ph_dœ
='',

429 
m‘ric_Çmes_to_v®ues
=
NÚe
,

430 
keys_to_exşude_äom_»suÉs
=()):

433 
This
 
funùiÚ
 
»³©edly
 
lßds
 
a
 
checkpošt
 
ªd
 
ev®u©es
‡ 
desœed


434 
£t
 
of
 
	$‹nsÜs
 (
´ovided
 
by
 
‹nsÜ_diù
è
ªd
 
hªds
 
the
 
»suÉšg
 
numpy


435 
¬¿ys
 
to
 
a
 
funùiÚ
 
»suÉ_´oûssÜ
 
which
 
ÿn
 
be
 
u£d
Ø
fu¹h”


436 
´oûss
/
§ve
/
visu®ize
 
the
 
»suÉs
.

438 
Args
:

439 
‹nsÜ_diù
: 
a
 
diùiÚ¬y
 
hŞdšg
 
‹nsÜs
 
»´e£Ášg
‡ 
b©ch
 
of
 
d‘eùiÚs


440 
ªd
 
cÜ»¥Údšg
 
groundŒuth
 
ªnÙ©iÚs
.

441 
upd©e_İ
: 
a
 
‹nsÜæow
 
upd©e
 
İ
 
th©
 
wl
 
run
 
—ch
 
b©ch
 
®Úg
 
w™h


442 
the
 
‹nsÜs
 
š
 
‹nsÜ_diù
.

443 
summ¬y_dœ
: 
a
 
dœeùÜy
 
to
 
wr™e
 
m‘rics
 
summ¬›s
.

444 
agg»g©ed_»suÉ_´oûssÜ
: 
a
 
funùiÚ
 
kšg
 
Úe
 
¬gum’t
:

445 1. 
»suÉ_li¡s
: 
a
 
diùiÚ¬y
 
w™h
 
keys
 
m©chšg
 
tho£
 
š
 
‹nsÜ_diù


446 
ªd
 
cÜ»¥Údšg
 
v®ues
 
bešg
 
the
 
li¡
 
of
 
»suÉs
 
—ch
 
‹nsÜ


447 
š
 
‹nsÜ_diù
. 
The
 
Ëngth
 
of
 
—ch
 
such
 
li¡
 
is
 
num_b©ches
.

448 
b©ch_´oûssÜ
: 
a
 
funùiÚ
 
kšg
 
th»e
 
¬gum’ts
:

449 1. 
‹nsÜ_diù
: 
the
 
§me
’sÜ_diù 
th©
 
is
 
·s£d
 
š
 
as
h
fœ¡


450 
¬gum’t
 
to
 
this
 
funùiÚ
.

451 2. 
£ss
: 
a
 
‹nsÜæow
 
£ssiÚ


452 3. 
b©ch_šdex
: 
ª
 
š‹g”
 
»´e£Ášg
 
the
 
šdex
 
of
h
b©ch
 
amÚg¡


453 
®l
 
b©ches


454 4. 
upd©e_İ
: 
a
 
‹nsÜæow
 
upd©e
 
İ
 
th©
 
wl
 
run
 
—ch
 
b©ch
.

455 
ªd
 
»tuºs
 
»suÉ_diù
, 
a
 
diùiÚ¬y
 
of
 
»suÉs
 
th©
 
b©ch
.

456 
By
 , 
b©ch_´oûssÜ
 
is
 
NÚe
, 
which
 
deçuÉs
 
to
 
ruÂšg
:

457  
£ss
.
	$run
(
‹nsÜ_diù
)

458 
checkpošt_dœs
: 
li¡
 
of
 
dœeùÜ›s
 
to
 
lßd
 
što
 
a
 
D‘eùiÚMod–
 
Ü
 
ª


459 
En£mbËMod–
 
»¡Üe_â
 
i¢
't set. Also usedo determine wheno„un

460 
Ãxt
 
ev®u©iÚ
. 
Mu¡
 
have
 
©
 
Ëa¡
 
Úe
 
–em’t
.

461 
v¬ŸbËs_to_»¡Üe
: 
NÚe
, 
Ü
 
a
 
diùiÚ¬y
 
m­pšg
 
v¬ŸbË
 
Çmes
 
found
 
š


462 
a
 
checkpošt
 
to
 
mod–
 
v¬ŸbËs
. 
The
 
diùiÚ¬y
 
would
 
nÜm®ly
 
be


463 
g’”©ed
 
by
 
ü—tšg
 
a
 
tf
.
Œaš
.
ExpÚ’tŸlMovšgAv”age
 
objeù
 
ªd


464 
ÿÎšg
 
™s
 
	$v¬ŸbËs_to_»¡Üe
(è
m‘hod
. 
NÙ
 
u£d
 
»¡Üe_â
 
is
 
£t
.

465 
»¡Üe_â
: 
a
 
funùiÚ
 
th©
 
kes
‡ 
tf
.
SessiÚ
 
objeù
 
ªd
 
cÜ»ùly
 
»¡Ües


466 
®l
 
Ãûs§ry
 
v¬ŸbËs
 
äom
 
the
 
cÜ»ù
 
checkpošt
 
fe
.

467 
num_b©ches
: 
the
 
numb”
 
of
 
b©ches
 
to
 
u£
 
ev®u©iÚ
.

468 
ev®_š‹rv®_£cs
: 
the
 
numb”
 
of
 
£cÚds
 
b‘w“n
 
—ch
 
ev®u©iÚ
 
run
.

469 
max_numb”_of_ev®u©iÚs
: 
the
 
max
 
numb”
 
of
 
™”©iÚs
 oàth
ev®u©iÚ
.

470 
If
 
the
 
v®ue
 
is
 
Ëá
 
as
 
NÚe
h
ev®u©iÚ
 
cÚtšues
 
šdefš™–y
.

471 
ma¡”
: 
the
 
loÿtiÚ
 
of
h
T’sÜæow
 
£ssiÚ
.

472 
§ve_g¿ph
: 
wh‘h”
 
Ü
 
nÙ
 
the
 
T’sÜæow
 
g¿ph
 
is
 
§ved
 
as
 
a
 
pbtxt
 
fe
.

473 
§ve_g¿ph_dœ
: 
wh”e
 
to
 
§ve
 
Ú
 
disk
 
the
 
T’sÜæow
 
g¿ph
. 
If
 
¡Üe_g¿ph


474 
is
 
True
 
this
 
mu¡
 
be
 
nÚ
-
em±y
.

475 
m‘ric_Çmes_to_v®ues
: 
A
 
diùiÚ¬y
 
cÚššg
 
m‘ric
 
Çmes
 
to
 
‹nsÜs


476 
which
 
wl
 
be
 
ev®u©ed
 
aá”
 
´oûssšg
 
®l
 
b©ches


477 
of
 [
‹nsÜ_diù
, 
upd©e_İ
]. 
If
 
ªy
 
m‘rics
 
d•’d
 
Ú
 
¡©i¡ics
 
compu‹d


478 
duršg
 
—ch
 
b©ch
 
’su»
 
th©
 `
upd©e_İ
` 
‹nsÜ
 
has
 
a
 
cÚŒŞ
 
d•’d’cy


479 
Ú
 
the
 
upd©e
 
İs
 
th©
 
compu‹
h
¡©i¡ics
.

480 
keys_to_exşude_äom_»suÉs
: 
keys
 
š
 
‹nsÜ_diù
 
th©
 
wl
 
be
 
exşuded


481 
äom
 
»suÉs_li¡
. 
NÙe
 
th©
 
the
 
‹nsÜs
 
cÜ»¥Údšg
 
to
 
the£
 
keys
 
wl


482 
¡l
 
be
 
ev®u©ed
 
—ch
 
b©ch
, 
but
 
wÚ
't be‡ddedo„esults_list.

484 
Rai£s
:

485 
V®ueE¼Ü
: 
max_num_of_ev®u©iÚs
 
is
 
nÙ
 
NÚe
 
Ü
 
a
 
pos™ive
 
numb”
.

486 
V®ueE¼Ü
: 
checkpošt_dœs
 
dÛ¢
't have‡t†east oneƒlement.

488 
max_numb”_of_ev®u©iÚs
 
ªd
 max_number_of_evaluations <= 0:

489 
¿i£
 
	`V®ueE¼Ü
(

492 
nÙ
 
checkpošt_dœs
:

493 
¿i£
 
	`V®ueE¼Ü
('`checkpoint_dirs` must have‡t†east oneƒntry.')

495 
Ï¡_ev®u©ed_mod–_·th
 = 
NÚe


496 
numb”_of_ev®u©iÚs
 = 0

497 
True
:

498 
¡¬t
 = 
time
.
	$time
()

499 
loggšg
.
	`šfo
('S¹šgƒv®u©iÚ‡ˆ' + 
time
.
	`¡ráime
('%Y-%m-%d-%H:%M:%S',

500 
time
.
	$gmtime
()))

501 
mod–_·th
 = 
tf
.
Œaš
.
	$Ï‹¡_checkpošt
(
checkpošt_dœs
[0])

502 
nÙ
 
mod–_·th
:

503 
loggšg
.
	`šfo
('No model found in %s. Willry‡gain in %d seconds',

504 
checkpošt_dœs
[0], 
ev®_š‹rv®_£cs
)

505 
–if
 
mod–_·th
 =ğ
Ï¡_ev®u©ed_mod–_·th
:

506 
loggšg
.
	`šfo
('Found‡lreadyƒvaluated checkpoint. Willry‡gain in %d '

507 '£cÚds', 
ev®_š‹rv®_£cs
)

509 
Ï¡_ev®u©ed_mod–_·th
 = 
mod–_·th


510 
	$run_checkpošt_Úû
(
‹nsÜ_diù
, 
upd©e_İ
, 
summ¬y_dœ
,

511 
agg»g©ed_»suÉ_´oûssÜ
,

512 
b©ch_´oûssÜ
, 
checkpošt_dœs
,

513 
v¬ŸbËs_to_»¡Üe
, 
»¡Üe_â
, 
num_b©ches
, 
ma¡”
,

514 
§ve_g¿ph
, 
§ve_g¿ph_dœ
, 
m‘ric_Çmes_to_v®ues
,

515 
keys_to_exşude_äom_»suÉs
)

516 
numb”_of_ev®u©iÚs
 += 1

518 ià(
max_numb”_of_ev®u©iÚs
 
ªd


519 
numb”_of_ev®u©iÚs
 >ğ
max_numb”_of_ev®u©iÚs
):

520 
loggšg
.
	`šfo
('Finishedƒvaluation!')

522 
time_to_Ãxt_ev®
 = 
¡¬t
 + 
ev®_š‹rv®_£cs
 - 
time
.
	$time
()

523 
time_to_Ãxt_ev®
 > 0:

524 
time
.
	`¦“p
(
time_to_Ãxt_ev®
)

	@evaluator.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
This
 
fe
 
´ovides
 
a
 
g’”ic
 
ev®u©iÚ
 
m‘hod
 
th©
 
ÿn
 
be
 
u£d
 
to
 
ev®u©e
‡

19 
	gD‘eùiÚMod–
.

21 
impÜt
 
loggšg


22 
impÜt
 
‹nsÜæow
 
as
 
tf


24 
äom
 
objeù_d‘eùiÚ
 
impÜt
 
ev®_ut


25 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


26 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡_İs


27 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
´eãtch”


28 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
¡ªd¬d_f›lds
 
as
 
f›lds


29 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
İs


31 
	g¦im
 = 
tf
.
cÚŒib
.
¦im


33 
EVAL_METRICS_FN_DICT
 = {

34 '·sÿl_voc_m‘rics': 
ev®_ut
.
ev®u©e_d‘eùiÚ_»suÉs_·sÿl_voc


38 
def
 
	$_exŒaù_´ediùiÚ_‹nsÜs
(
mod–
,

39 
ü—‹_šput_diù_â
,

40 
ignÜe_groundŒuth
=
F®£
):

43 
Args
:

44 
mod–
: mod– 
to
 
³rfÜm
 
´ediùiÚs
 
w™h
.

45 
ü—‹_šput_diù_â
: 
funùiÚ
 
to
 
ü—‹
 
šput
 
‹nsÜ
 
diùiÚ¬›s
.

46 
ignÜe_groundŒuth
: 
wh‘h”
 
groundŒuth
 
should
 
be
 
ignÜed
.

48 
R‘uºs
:

49 
‹nsÜ_diù
: 
A
 
‹nsÜ
 
diùiÚ¬y
 
w™h
 
ev®u©iÚs
.

51 
šput_diù
 = 
	$ü—‹_šput_diù_â
()

52 
´eãtch_queue
 = 
´eãtch”
.
	$´eãtch
(
šput_diù
, 
ÿ·c™y
=500)

53 
šput_diù
 = 
´eãtch_queue
.
	$dequeue
()

54 
Üigš®_image
 = 
tf
.
	$ex·nd_dims
(
šput_diù
[
f›lds
.
IÅutD©aF›lds
.
image
], 0)

55 
´•roûs£d_image
 = 
mod–
.
	`´•roûss
(
tf
.
	$to_æßt
(
Üigš®_image
))

56 
´ediùiÚ_diù
 = 
mod–
.
	$´ediù
(
´•roûs£d_image
)

57 
d‘eùiÚs
 = 
mod–
.
	$po¡´oûss
(
´ediùiÚ_diù
)

59 
Üigš®_image_sh­e
 = 
tf
.
	$sh­e
(
Üigš®_image
)

60 
absŞu‹_d‘eùiÚ_boxli¡
 = 
box_li¡_İs
.
	`to_absŞu‹_coÜdš©es
(

61 
box_li¡
.
	`BoxLi¡
(
tf
.
	`squ“ze
(
d‘eùiÚs
['d‘eùiÚ_boxes'], 
axis
=0)),

62 
Üigš®_image_sh­e
[1], original_image_shape[2])

63 
Ïb–_id_off£t
 = 1

64 
‹nsÜ_diù
 = {

65 'Üigš®_image': 
Üigš®_image
,

66 'image_id': 
šput_diù
[
f›lds
.
IÅutD©aF›lds
.
sourû_id
],

67 'd‘eùiÚ_boxes': 
absŞu‹_d‘eùiÚ_boxli¡
.
	`g‘
(),

68 'd‘eùiÚ_scÜes': 
tf
.
	`squ“ze
(
d‘eùiÚs
['d‘eùiÚ_scÜes'], 
axis
=0),

70 
tf
.
	`squ“ze
(
d‘eùiÚs
['d‘eùiÚ_şas£s'], 
axis
=0) +

71 
Ïb–_id_off£t
),

72 
	}
}

73 'd‘eùiÚ_masks' 
š
 
	gd‘eùiÚs
:

74 
d‘eùiÚ_masks
 = 
tf
.
squ“ze
(
d‘eùiÚs
['detection_masks'],

75 
axis
=0)

76 
d‘eùiÚ_boxes
 = 
tf
.
squ“ze
(
d‘eùiÚs
['detection_boxes'],

77 
axis
=0)

78 #TODO: 
This
 
should
 
be
 
dÚe
 
š
 
mod–
's…ostprocess function ideally.

79 
d‘eùiÚ_masks_»äamed
 = 
İs
.
	$»äame_box_masks_to_image_masks
(

80 
d‘eùiÚ_masks
,

81 
d‘eùiÚ_boxes
,

82 
Üigš®_image_sh­e
[1], original_image_shape[2])

83 
d‘eùiÚ_masks_»äamed
 = 
tf
.
	`to_æßt
Ñf.
	$g»©”
(
d‘eùiÚ_masks_»äamed
,

86 
‹nsÜ_diù
['d‘eùiÚ_masks'] = 
d‘eùiÚ_masks_»äamed


87 #lßd 
groundŒuth
 
f›lds
 
što
 
‹nsÜ_diù


88 
nÙ
 
ignÜe_groundŒuth
:

89 
nÜm®ized_gt_boxli¡
 = 
box_li¡
.
	$BoxLi¡
(

90 
šput_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
])

91 
gt_boxli¡
 = 
box_li¡_İs
.
	`sÿË
(
nÜm®ized_gt_boxli¡
,

92 
tf
.
	`sh­e
(
Üigš®_image
)[1],

93 
tf
.
	`sh­e
(
Üigš®_image
)[2])

94 
groundŒuth_boxes
 = 
gt_boxli¡
.
	$g‘
()

95 
groundŒuth_şas£s
 = 
šput_diù
[
f›lds
.
IÅutD©aF›lds
.groundtruth_classes]

96 
‹nsÜ_diù
['groundŒuth_boxes'] = 
groundŒuth_boxes


97 
‹nsÜ_diù
['groundŒuth_şas£s'] = 
groundŒuth_şas£s


98 
‹nsÜ_diù
['¬—'] = 
šput_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—
]

99 
‹nsÜ_diù
['is_üowd'] = 
šput_diù
[

100 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd
]

101 
‹nsÜ_diù
['difficuÉ'] = 
šput_diù
[

102 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_difficuÉ
]

103 'd‘eùiÚ_masks' 
š
 
‹nsÜ_diù
:

104 
‹nsÜ_diù
['groundŒuth_š¡ªû_masks'] = 
šput_diù
[

105 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_š¡ªû_masks
]

106  
‹nsÜ_diù


109 
def
 
	$ev®u©e
(
ü—‹_šput_diù_â
, 
ü—‹_mod–_â
, 
ev®_cÚfig
, 
ÿ‹gÜ›s
,

110 
checkpošt_dœ
, 
ev®_dœ
):

113 
Args
:

114 
ü—‹_šput_diù_â
: 
a
 
funùiÚ
 
to
 
ü—‹
‡ 
‹nsÜ
 
šput
 
diùiÚ¬y
.

115 
ü—‹_mod–_â
: 
a
 
funùiÚ
 
th©
 
ü—‹s
‡ 
D‘eùiÚMod–
.

116 
ev®_cÚfig
: 
a
 
ev®_pb2
.
Ev®CÚfig
 
´Ùobuf
.

117 
ÿ‹gÜ›s
: 
a
 
li¡
 
of
 
ÿ‹gÜy
 
diùiÚ¬›s
. 
Each
 
diù
 
š
 
the
†i¡ 
should


118 
have
 
ª
 
š‹g”
 'id' 
f›ld
 
ªd
 
¡ršg
 'name' field.

119 
checkpošt_dœ
: 
dœeùÜy
 
to
 
lßd
 
the
 
checkpošts
Ø
ev®u©e
 
äom
.

120 
ev®_dœ
: 
dœeùÜy
 
to
 
wr™e
 
ev®u©iÚ
 
m‘rics
 
summ¬y
o.

123 
mod–
 = 
	$ü—‹_mod–_â
()

125 
ev®_cÚfig
.
ignÜe_groundŒuth
 
ªd
 
nÙ
ƒv®_cÚfig.
expÜt_·th
:

126 
loggšg
.
	`çl
('If ignore_groundtruth=Truehen‡nƒxport_path is '

129 
‹nsÜ_diù
 = 
	$_exŒaù_´ediùiÚ_‹nsÜs
(

130 
mod–
=model,

131 
ü—‹_šput_diù_â
=create_input_dict_fn,

132 
ignÜe_groundŒuth
=
ev®_cÚfig
.ignore_groundtruth)

134 
def
 
	$_´oûss_b©ch
(
‹nsÜ_diù
, 
£ss
, 
b©ch_šdex
, 
couÁ”s
, 
upd©e_İ
):

137 
This
 
funùiÚ
 
ÿÎs
 
£ss
.
run
 
Ú
 
‹nsÜ_diù
, 
ev®u©šg
 
the
 
Üigš®_image


138 
‹nsÜ
 
Úly
 
Ú
 
the
 
fœ¡
 
K
 
exam¶es
 
ªd
 
visu®izšg
 
d‘eùiÚs
 
ov”Ïid


139 
Ú
 
this
 
Üigš®_image
.

141 
Args
:

142 
‹nsÜ_diù
: 
a
 
diùiÚ¬y
 
of
 
‹nsÜs


143 
£ss
: 
‹nsÜæow
 
£ssiÚ


144 
b©ch_šdex
: 
the
 
šdex
 
of
h
b©ch
 
amÚg¡
 
®l
 
b©ches
 
š
h
run
.

145 
couÁ”s
: 
a
 
diùiÚ¬y
 
hŞdšg
 'sucûss' 
ªd
 'sk³d' 
f›lds
 
which
 
ÿn


146 
be
 
upd©ed
 
to
 
k“p
 
Œack
 
of
 
numb”
 oà
sucûssful
 
ªd
 
çed
 
runs
,

147 
»¥eùiv–y
. 
If
 
the£
 
f›lds
 
¬e
 
nÙ
 
upd©ed
, 
th’
 
the
 
sucûss
/
sk³d


148 
couÁ”
 
v®ues
 
shown
 
©
 
the
 
’d
 
of
 
ev®u©iÚ
 
wl
 
be
 
šcÜ»ù
.

149 
upd©e_İ
: 
An
 
upd©e
 
İ
 
th©
 
has
 
to
 
be
 
run
 
®Úg
 
w™h
 
ouut
 
‹nsÜs
. 
FÜ


150 
exam¶e
 
this
 
could
 
be
 
ª
 
İ
 
to
 
compu‹
 
¡©i¡ics
 
¦im
 
m‘rics
.

152 
R‘uºs
:

153 
»suÉ_diù
: 
a
 
diùiÚ¬y
 
of
 
numpy
 
¬¿ys


155 
b©ch_šdex
 >ğ
ev®_cÚfig
.
num_visu®iz©iÚs
:

156 'Üigš®_image' 
š
 
‹nsÜ_diù
:

157 
‹nsÜ_diù
 = {
k
: 
v
 k, vè
š
’sÜ_diù.
	`™ems
()

158 
k
 !ğ'Üigš®_image'
	}
}

159 
	gŒy
:

160 (
»suÉ_diù
, 
	g_
èğ
£ss
.
	$run
([
‹nsÜ_diù
, 
upd©e_İ
])

161 
couÁ”s
['success'] += 1

162 
exû±
 
tf
.
”rÜs
.
Inv®idArgum’tE¼Ü
:

163 
loggšg
.
	`šfo
('Skipping image')

164 
couÁ”s
['skipped'] += 1

165  {
	}
}

166 
glob®_¡•
 = 
tf
.
Œaš
.glob®_¡•(
£ss
, 
¦im
.
	$g‘_glob®_¡•
())

167 
b©ch_šdex
 < 
ev®_cÚfig
.
num_visu®iz©iÚs
:

168 
g
 = 'image-{}'.
	$fÜm©
(
b©ch_šdex
)

169 
ev®_ut
.
	$visu®ize_d‘eùiÚ_»suÉs
(

170 
»suÉ_diù
, 
g
, 
glob®_¡•
, 
ÿ‹gÜ›s
=categories,

171 
summ¬y_dœ
=
ev®_dœ
,

172 
expÜt_dœ
=
ev®_cÚfig
.
visu®iz©iÚ_expÜt_dœ
,

173 
show_groundŒuth
=
ev®_cÚfig
.
visu®iz©iÚ_expÜt_dœ
)

174  
»suÉ_diù


176 
def
 
	$_´oûss_agg»g©ed_»suÉs
(
»suÉ_li¡s
):

177 
ev®_m‘ric_â_key
 = 
ev®_cÚfig
.
m‘rics_£t


178 
ev®_m‘ric_â_key
 
nÙ
 
š
 
EVAL_METRICS_FN_DICT
:

179 
¿i£
 
	`V®ueE¼Ü
('M‘riønÙ found: {}'.
	$fÜm©
(
ev®_m‘ric_â_key
))

180  
EVAL_METRICS_FN_DICT
[
ev®_m‘ric_â_key
](
»suÉ_li¡s
,

181 
ÿ‹gÜ›s
=categories)

183 
v¬ŸbËs_to_»¡Üe
 = 
tf
.
	$glob®_v¬ŸbËs
()

184 
glob®_¡•
 = 
¦im
.
	$g‘_Ü_ü—‹_glob®_¡•
()

185 
v¬ŸbËs_to_»¡Üe
.
	$­³nd
(
glob®_¡•
)

186 
ev®_cÚfig
.
u£_movšg_av”ages
:

187 
v¬ŸbË_av”ages
 = 
tf
.
Œaš
.
	$ExpÚ’tŸlMovšgAv”age
(0.0)

188 
v¬ŸbËs_to_»¡Üe
 = 
v¬ŸbË_av”ages
.
	$v¬ŸbËs_to_»¡Üe
()

189 
§v”
 = 
tf
.
Œaš
.
	$Sav”
(
v¬ŸbËs_to_»¡Üe
)

190 
def
 
	$_»¡Üe_Ï‹¡_checkpošt
(
£ss
):

191 
Ï‹¡_checkpošt
 = 
tf
.
Œaš
.
	$Ï‹¡_checkpošt
(
checkpošt_dœ
)

192 
§v”
.
	$»¡Üe
(
£ss
, 
Ï‹¡_checkpošt
)

194 
ev®_ut
.
	`»³©ed_checkpošt_run
(

195 
‹nsÜ_diù
=tensor_dict,

196 
upd©e_İ
=
tf
.
	`no_İ
(),

197 
summ¬y_dœ
=
ev®_dœ
,

198 
agg»g©ed_»suÉ_´oûssÜ
=
_´oûss_agg»g©ed_»suÉs
,

199 
b©ch_´oûssÜ
=
_´oûss_b©ch
,

200 
checkpošt_dœs
=[
checkpošt_dœ
],

201 
v¬ŸbËs_to_»¡Üe
=
NÚe
,

202 
»¡Üe_â
=
_»¡Üe_Ï‹¡_checkpošt
,

203 
num_b©ches
=
ev®_cÚfig
.
num_exam¶es
,

204 
ev®_š‹rv®_£cs
=
ev®_cÚfig
.eval_interval_secs,

205 
max_numb”_of_ev®u©iÚs
=(

206 1 
ev®_cÚfig
.
ignÜe_groundŒuth
 

207 
ev®_cÚfig
.
max_ev®s
 eval_config.max_evals 

208 
NÚe
),

209 
ma¡”
=
ev®_cÚfig
.
ev®_ma¡”
,

210 
§ve_g¿ph
=
ev®_cÚfig
.save_graph,

211 
§ve_g¿ph_dœ
=(
ev®_dœ
 
ev®_cÚfig
.
§ve_g¿ph
 ''))

	@export_inference_graph.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

16 
	gr
"""Tooloƒxport‡n object detection model for inference.

18 
P»·»s
 
ª
 
objeù
 
d‘eùiÚ
 
‹nsÜæow
 
g¿ph
 
šã»nû
 
usšg
 
mod–


19 
cÚfigu¿tiÚ
 
ªd
 
ª
 
İtiÚ®
 
Œašed
 
	gcheckpošt
. 
Ouuts
 
šã»nû


20 
	gg¿ph
, 
assocŸ‹d
 
checkpošt
 
	gfes
, 
a
 
äoz’
 
šã»nû
 
g¿ph
 
ªd
‡

21 
SavedMod–
 (
h‰ps
:

23 
The
 
šã»nû
 
g¿ph
 
cÚšs
 
Úe
 
of
 
th»e
 
šput
 
nodes
 
d•’dšg
 
Ú
 
the
 
u£r


24 
¥ecif›d
 
İtiÚ
.

25 * `
image_‹nsÜ
`: 
Acû±s
 
a
 
ušt8
 4-
D
 
‹nsÜ
 
of
 
sh­e
 [
NÚe
, None, None, 3]

26 * `
’coded_image_¡ršg_‹nsÜ
`: 
Acû±s
 
a
 1-
D
 
¡ršg
 
‹nsÜ
 
of
 
sh­e
 [
NÚe
]

27 
cÚššg
 
’coded
 
PNG
 
Ü
 
JPEG
 
images
. 
Image
 
»sŞutiÚs
 
¬e
 
ex³ùed
 
to
 
be


28 
the
 
§me
 
mÜe
 
thª
 1 
image
 
is
 
´ovided
.

29 * `
tf_exam¶e
`: 
Acû±s
 
a
 1-
D
 
¡ršg
 
‹nsÜ
 
of
 
sh­e
 [
NÚe
] 
cÚššg


30 
£rŸlized
 
TFExam¶e
 
´Ùos
. 
Image
 
»sŞutiÚs
 
¬e
 
ex³ùed
 
to
 
be
 
the
 
§me


31 
mÜe
 
thª
 1 
image
 
is
 
´ovided
.

33 
ªd
 
the
 
fŞlowšg
 
ouut
 
nodes
 
»tuºed
 
by
h
mod–
.
	$po¡´oûss
(..):

34 * `
num_d‘eùiÚs
`: 
Ouuts
 
æßt32
 
‹nsÜs
 
of
 
the
 
fÜm
 [
b©ch
]

35 
th©
 
¥ecif›s
 
the
 
numb”
 
of
 
v®id
 
boxes
 
³r
 
image
 
š
h
b©ch
.

36 * `
d‘eùiÚ_boxes
`: 
Ouuts
 
æßt32
 
‹nsÜs
 
of
 
the
 
fÜm


37 [
b©ch
, 
num_boxes
, 4] 
cÚššg
 
d‘eùed
 
boxes
.

38 * `
d‘eùiÚ_scÜes
`: 
Ouuts
 
æßt32
 
‹nsÜs
 
of
 
the
 
fÜm


39 [
b©ch
, 
num_boxes
] 
cÚššg
 
şass
 
scÜes
 
the
 
d‘eùiÚs
.

40 * `
d‘eùiÚ_şas£s
`: 
Ouuts
 
æßt32
 
‹nsÜs
 
of
 
the
 
fÜm


41 [
b©ch
, 
num_boxes
] 
cÚššg
 
şas£s
 
the
 
d‘eùiÚs
.

42 * `
d‘eùiÚ_masks
`: 
Ouuts
 
æßt32
 
‹nsÜs
 
of
 
the
 
fÜm


43 [
b©ch
, 
num_boxes
, 
mask_height
, 
mask_width
] 
cÚššg
 
´ediùed
 
š¡ªû


44 
masks
 
—ch
 
box
 
™s
 
´e£Á
 
š
 
the
 
diùiÚ¬y
 
of
 
po¡´oûs£d


45 
‹nsÜs
 
»tuºed
 
by
 
the
 
mod–
.

47 
NÙes
:

48 * 
This
 
toŞ
 
u£s
 `
u£_movšg_av”ages
` 
äom
 
ev®_cÚfig
 
to
 
decide
 
which


49 
weights
 
to
 
ä“ze
.

51 
Exam¶e
 
U§ge
:

53 
pythÚ
 
expÜt_šã»nû_g¿ph
 \

54 --
šput_ty³
 
image_‹nsÜ
 \

55 --
p–še_cÚfig_·th
 
·th
/
to
/
ssd_šû±iÚ_v2
.
cÚfig
 \

56 --
Œašed_checkpošt_´efix
 
·th
/
to
/
mod–
.
ck±
 \

57 --
ouut_dœeùÜy
 
·th
/
to
/
expÜ‹d_mod–_dœeùÜy


59 
The
 
ex³ùed
 
ouut
 
would
 
be
 
š
 
the
 
dœeùÜy


60 
·th
/
to
/
	$expÜ‹d_mod–_dœeùÜy
 (
which
 
is
 
ü—‹d
 
™
 
dÛs
 
nÙ
 
exi¡
)

61 
w™h
 
cÚ‹Ás
:

62 - 
g¿ph
.
pbtxt


63 - 
mod–
.
ck±
.
d©a
-00000-
of
-00001

64 - 
mod–
.
ck±
.
šfo


65 - 
mod–
.
ck±
.
m‘a


66 - 
äoz’_šã»nû_g¿ph
.
pb


67 + 
	`§ved_mod–
 (
a
 
dœeùÜy
)

69 
impÜt
 
‹nsÜæow
 
as
 
tf


70 
äom
 
googË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


71 
äom
 
objeù_d‘eùiÚ
 
impÜt
 
expÜ‹r


72 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
p–še_pb2


74 
¦im
 = 
tf
.
cÚŒib
.slim

75 
æags
 = 
tf
.
­p
.flags

77 
æags
.
	`DEFINE_¡ršg
('input_type', 'image_tensor', 'Type of input‚ode. Can be '

80 
æags
.
	`DEFINE_¡ršg
('p–še_cÚfig_·th', 
NÚe
,

83 
æags
.
	`DEFINE_¡ršg
('Œašed_checkpošt_´efix', 
NÚe
,

86 
æags
.
	`DEFINE_¡ršg
('ouut_dœeùÜy', 
NÚe
, 'Patho write outputs.')

88 
FLAGS
 = 
æags
.FLAGS

91 
def
 
	$maš
(
_
):

92 
as£¹
 
FLAGS
.
p–še_cÚfig_·th
, '`pipeline_config_path` is missing'

93 
as£¹
 
FLAGS
.
Œašed_checkpošt_´efix
, (

95 
as£¹
 
FLAGS
.
ouut_dœeùÜy
, '`output_directory` is missing'

97 
p–še_cÚfig
 = 
p–še_pb2
.
	$T¿šEv®P–šeCÚfig
()

98 
w™h
 
tf
.
gfe
.
	`GFe
(
FLAGS
.
p–še_cÚfig_·th
, 'r'è
as
 
f
:

99 
‹xt_fÜm©
.
	`M”ge
(
f
.
	`»ad
(), 
p–še_cÚfig
)

100 
expÜ‹r
.
	$expÜt_šã»nû_g¿ph
(

101 
FLAGS
.
šput_ty³
, 
p–še_cÚfig
, FLAGS.
Œašed_checkpošt_´efix
,

102 
FLAGS
.
ouut_dœeùÜy
)

105 
__Çme__
 == '__main__':

106 
tf
.
­p
.
	`run
()

	@exporter.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
loggšg


18 
impÜt
 
os


19 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	g‹nsÜæow
.
	gcÜe
.
´Ùobuf
 
impÜt
 
»wr™”_cÚfig_pb2


21 
äom
 
	g‹nsÜæow
.
pythÚ
 
impÜt
 
pyw¿p_‹nsÜæow


22 
äom
 
	g‹nsÜæow
.
	gpythÚ
.
ş›Á
 
impÜt
 
£ssiÚ


23 
äom
 
	g‹nsÜæow
.
	gpythÚ
.
äamewÜk
 
impÜt
 
g¿ph_ut


24 
äom
 
	g‹nsÜæow
.
	gpythÚ
.
äamewÜk
 
impÜt
 
impÜ‹r


25 
äom
 
	g‹nsÜæow
.
	gpythÚ
.
¶©fÜm
 
impÜt
 
gfe


26 
äom
 
	g‹nsÜæow
.
	gpythÚ
.
§ved_mod–
 
impÜt
 
sigÇtu»_cÚ¡ªts


27 
äom
 
	g‹nsÜæow
.
	gpythÚ
.
Œaššg
 
impÜt
 
§v”
 
as
 
§v”_lib


28 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
mod–_bud”


29 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
¡ªd¬d_f›lds
 
as
 
f›lds


30 
äom
 
	gobjeù_d‘eùiÚ
.
d©a_decod”s
 
impÜt
 
tf_exam¶e_decod”


32 
	g¦im
 = 
tf
.
cÚŒib
.
¦im


35 #TODO: 
R•Ïû
 
w™h
 
ä“ze_g¿ph
.
ä“ze_g¿ph_w™h_def_´Ùos
 
wh’


36 #Ãw” 
v”siÚ
 
of
 
T’sÜæow
 
becomes
 
mÜe
 
commÚ
.

37 
def
 
ä“ze_g¿ph_w™h_def_´Ùos
(

38 
šput_g¿ph_def
,

39 
šput_§v”_def
,

40 
šput_checkpošt
,

41 
ouut_node_Çmes
,

42 
»¡Üe_İ_Çme
,

43 
f’ame_‹nsÜ_Çme
,

44 
ş—r_deviûs
,

45 
š™Ÿliz”_nodes
,

46 
İtimize_g¿ph
=
F®£
,

47 
v¬ŸbË_Çmes_bÏckli¡
=''):

49 
d–
 
»¡Üe_İ_Çme
, 
	gf’ame_‹nsÜ_Çme
 #Unu£d 
by
 
upd©ed
 
lßdšg
 
	gcode
.

51 #'
šput_checkpošt
' may b¨´efix iàwe'
»
 
usšg
 
Sav”
 
V2
 
fÜm©


52 
nÙ
 
	g§v”_lib
.
	$checkpošt_exi¡s
(
šput_checkpošt
):

53 
¿i£
 
	`V®ueE¼Ü
(

54 'IÅuˆcheckpošˆ"' + 
šput_checkpošt
 + '" does‚otƒxist!')

56 
nÙ
 
ouut_node_Çmes
:

57 
¿i£
 
	`V®ueE¼Ü
(

60 #Remov
®l
 
the
 
ex¶ic™
 
deviû
 
¥ecifiÿtiÚs
 
this
 
node
. 
This
 
h–ps
 
to


61 #mak
the
 
g¿ph
 
mÜe
 
pÜbË
.

62 
ş—r_deviûs
:

63 
node
 
š
 
šput_g¿ph_def
.node:

64 
node
.
deviû
 = ''

66 
w™h
 
tf
.
	`G¿ph
().
	$as_deçuÉ
():

67 
tf
.
	`impÜt_g¿ph_def
(
šput_g¿ph_def
, 
Çme
='')

69 
İtimize_g¿ph
:

70 
loggšg
.
	`šfo
('Graph Rewriter optimizationsƒnabled')

71 
»wr™e_İtiÚs
 = 
»wr™”_cÚfig_pb2
.
	$Rewr™”CÚfig
(

72 
İtimize_‹nsÜ_Ïyout
=
True
)

73 
»wr™e_İtiÚs
.
İtimiz”s
.
	`­³nd
('pruning')

74 
»wr™e_İtiÚs
.
İtimiz”s
.
	`­³nd
('constfold')

75 
»wr™e_İtiÚs
.
İtimiz”s
.
	`­³nd
('layout')

76 
g¿ph_İtiÚs
 = 
tf
.
	$G¿phO±iÚs
(

77 
»wr™e_İtiÚs
ôewr™e_İtiÚs, 
šãr_sh­es
=
True
)

79 
loggšg
.
	`šfo
('Graph Rewriter optimizations disabled')

80 
g¿ph_İtiÚs
 = 
tf
.
	$G¿phO±iÚs
()

81 
cÚfig
 = 
tf
.
	$CÚfigPrÙo
(
g¿ph_İtiÚs
=graph_options)

82 
w™h
 
£ssiÚ
.
	$SessiÚ
(
cÚfig
=cÚfigè
as
 
£ss
:

83 
šput_§v”_def
:

84 
§v”
 = 
§v”_lib
.
	$Sav”
(
§v”_def
=
šput_§v”_def
)

85 
§v”
.
	$»¡Üe
(
£ss
, 
šput_checkpošt
)

87 
v¬_li¡
 = {
	}
}

88 
»ad”
 = 
pyw¿p_‹nsÜæow
.
	$NewCheckpoštR—d”
(
šput_checkpošt
)

89 
v¬_to_sh­e_m­
 = 
»ad”
.
	$g‘_v¬ŸbË_to_sh­e_m­
()

90 
key
 
š
 
v¬_to_sh­e_m­
:

91 
Œy
:

92 
‹nsÜ
 = 
£ss
.
g¿ph
.
	`g‘_‹nsÜ_by_Çme
(
key
 + ':0')

93 
exû±
 
KeyE¼Ü
:

94 #Thi 
‹nsÜ
 
dÛ¢
'ˆexi¡ iÀthg¿ph (fÜƒxam¶™'
s


95 #'
glob®_¡•
' or‡ similar housekeepingƒlement) so skip it.

97 
v¬_li¡
[
key
] = 
‹nsÜ


98 
§v”
 = 
§v”_lib
.
	$Sav”
(
v¬_li¡
=var_list)

99 
§v”
.
	$»¡Üe
(
£ss
, 
šput_checkpošt
)

100 
š™Ÿliz”_nodes
:

101 
£ss
.
	$run
(
š™Ÿliz”_nodes
)

103 
v¬ŸbË_Çmes_bÏckli¡
 = (v¬ŸbË_Çmes_bÏckli¡.
	`¥l™
(',') 

104 
v¬ŸbË_Çmes_bÏckli¡
 
NÚe
)

105 
ouut_g¿ph_def
 = 
g¿ph_ut
.
	`cÚv”t_v¬ŸbËs_to_cÚ¡ªts
(

106 
£ss
,

107 
šput_g¿ph_def
,

108 
ouut_node_Çmes
.
	`¥l™
(','),

109 
v¬ŸbË_Çmes_bÏckli¡
=variable_names_blacklist)

111  
ouut_g¿ph_def


115 
def
 
	$_image_‹nsÜ_šput_¶aûhŞd”
():

117 
šput_‹nsÜ
 = 
tf
.
	`¶aûhŞd”
(
dty³
ñf.
ušt8
,

118 
sh­e
=(
NÚe
, None, None, 3),

119 
Çme
='image_tensor')

120  
šput_‹nsÜ
, input_tensor

123 
def
 
	$_tf_exam¶e_šput_¶aûhŞd”
():

126 
R‘uºs
:

127 
a
 
tu¶e
 
of
 
¶aûhŞd”
 
ªd
 
šput
 
nodes
 
th©
 
ouut
 
decoded
 
images
.

129 
b©ch_tf_exam¶e_¶aûhŞd”
 = 
tf
.
	`¶aûhŞd”
(

130 
tf
.
¡ršg
, 
sh­e
=[
NÚe
], 
Çme
='tf_example')

131 
def
 
	$decode
(
tf_exam¶e_¡ršg_‹nsÜ
):

132 
‹nsÜ_diù
 = 
tf_exam¶e_decod”
.
	`TfExam¶eDecod”
().
	$decode
(

133 
tf_exam¶e_¡ršg_‹nsÜ
)

134 
image_‹nsÜ
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

135  
image_‹nsÜ


136  (
b©ch_tf_exam¶e_¶aûhŞd”
,

137 
tf
.
	$m­_â
(
decode
,

138 
–ems
=
b©ch_tf_exam¶e_¶aûhŞd”
,

139 
dty³
=
tf
.
ušt8
,

140 
·¿Î–_™”©iÚs
=32,

141 
back_´İ
=
F®£
))

144 
def
 
	$_’coded_image_¡ršg_‹nsÜ_šput_¶aûhŞd”
():

147 
R‘uºs
:

148 
a
 
tu¶e
 
of
 
¶aûhŞd”
 
ªd
 
šput
 
nodes
 
th©
 
ouut
 
decoded
 
images
.

150 
b©ch_image_¡r_¶aûhŞd”
 = 
tf
.
	`¶aûhŞd”
(

151 
dty³
=
tf
.
¡ršg
,

152 
sh­e
=[
NÚe
],

153 
Çme
='encoded_image_string_tensor')

154 
def
 
	$decode
(
’coded_image_¡ršg_‹nsÜ
):

155 
image_‹nsÜ
 = 
tf
.
image
.
	$decode_image
(
’coded_image_¡ršg_‹nsÜ
,

156 
chªÃls
=3)

157 
image_‹nsÜ
.
	`£t_sh­e
((
NÚe
, None, 3))

158  
image_‹nsÜ


159  (
b©ch_image_¡r_¶aûhŞd”
,

160 
tf
.
	$m­_â
(

161 
decode
,

162 
–ems
=
b©ch_image_¡r_¶aûhŞd”
,

163 
dty³
=
tf
.
ušt8
,

164 
·¿Î–_™”©iÚs
=32,

165 
back_´İ
=
F®£
))

168 
šput_¶aûhŞd”_â_m­
 = {

169 'image_‹nsÜ': 
_image_‹nsÜ_šput_¶aûhŞd”
,

171 
_’coded_image_¡ršg_‹nsÜ_šput_¶aûhŞd”
,

172 'tf_exam¶e': 
_tf_exam¶e_šput_¶aûhŞd”
,

173 
	}
}

176 
def
 
_add_ouut_‹nsÜ_nodes
(
po¡´oûs£d_‹nsÜs
,

177 
ouut_cŞËùiÚ_Çme
='inference_op'):

180 
Adds
 
the
 
fŞlowšg
 
nodes
 
ouut
 
‹nsÜs
 -

181 * 
num_d‘eùiÚs
: 
æßt32
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
].

182 * 
d‘eùiÚ_boxes
: 
æßt32
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_boxes
, 4]

183 
cÚššg
 
d‘eùed
 
	gboxes
.

184 * 
	gd‘eùiÚ_scÜes
: 
æßt32
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_boxes
]

185 
cÚššg
 
scÜes
 
the
 
d‘eùed
 
	gboxes
.

186 * 
	gd‘eùiÚ_şas£s
: 
æßt32
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_boxes
]

187 
cÚššg
 
şass
 
´ediùiÚs
 
the
 
d‘eùed
 
	gboxes
.

188 * 
	gd‘eùiÚ_masks
: (
O±iÚ®
è
æßt32
 
‹nsÜ
 
of
 
sh­e


189 [
b©ch_size
, 
num_boxes
, 
mask_height
, 
mask_width
] 
cÚššg
 
masks
 
—ch


190 
d‘eùiÚ
 
	gbox
.

192 
	gArgs
:

193 
po¡´oûs£d_‹nsÜs
: 
a
 
diùiÚ¬y
 
cÚššg
 
the
 
fŞlowšg
 
f›lds


194 'd‘eùiÚ_boxes': [
b©ch
, 
max_d‘eùiÚs
, 4]

195 'd‘eùiÚ_scÜes': [
b©ch
, 
max_d‘eùiÚs
]

196 'd‘eùiÚ_şas£s': [
b©ch
, 
max_d‘eùiÚs
]

197 'd‘eùiÚ_masks': [
b©ch
, 
max_d‘eùiÚs
, 
mask_height
, 
mask_width
]

198 (
	gİtiÚ®
).

199 'num_d‘eùiÚs': [
b©ch
]

200 
ouut_cŞËùiÚ_Çme
: 
Name
 
of
 
cŞËùiÚ
 
to
 
add
 
ouut
 
‹nsÜs
o.

202 
R‘uºs
:

203 
A
 
‹nsÜ
 
diù
 
cÚššg
 
the
 
added
 
ouut
’sÜ 
nodes
.

205 
Ïb–_id_off£t
 = 1

206 
boxes
 = 
po¡´oûs£d_‹nsÜs
.
g‘
('detection_boxes')

207 
scÜes
 = 
po¡´oûs£d_‹nsÜs
.
g‘
('detection_scores')

208 
şas£s
 = 
po¡´oûs£d_‹nsÜs
.
g‘
('d‘eùiÚ_şas£s'è+ 
Ïb–_id_off£t


209 
masks
 = 
po¡´oûs£d_‹nsÜs
.
g‘
('detection_masks')

210 
num_d‘eùiÚs
 = 
po¡´oûs£d_‹nsÜs
.
g‘
('num_detections')

211 
ouuts
 = {}

212 
ouuts
['d‘eùiÚ_boxes'] = 
tf
.
id’t™y
(
boxes
, 
Çme
='detection_boxes')

213 
ouuts
['d‘eùiÚ_scÜes'] = 
tf
.
id’t™y
(
scÜes
, 
Çme
='detection_scores')

214 
ouuts
['d‘eùiÚ_şas£s'] = 
tf
.
id’t™y
(
şas£s
, 
Çme
='detection_classes')

215 
ouuts
['num_d‘eùiÚs'] = 
tf
.
id’t™y
(
num_d‘eùiÚs
, 
Çme
='num_detections')

216 
masks
 
is
 
nÙ
 
NÚe
:

217 
ouuts
['d‘eùiÚ_masks'] = 
tf
.
id’t™y
(
masks
, 
Çme
='detection_masks')

218 
ouut_key
 
š
 
ouuts
:

219 
tf
.
	$add_to_cŞËùiÚ
(
ouut_cŞËùiÚ_Çme
, 
ouuts
[
ouut_key
])

220 
masks
 
is
 
nÙ
 
NÚe
:

221 
tf
.
	`add_to_cŞËùiÚ
(
ouut_cŞËùiÚ_Çme
, 
ouuts
['detection_masks'])

222  
ouuts


225 
def
 
	$_wr™e_äoz’_g¿ph
(
äoz’_g¿ph_·th
, 
äoz’_g¿ph_def
):

228 
Args
:

229 
äoz’_g¿ph_·th
: 
P©h
 
to
 
wr™e
 
šã»nû
 
g¿ph
.

230 
äoz’_g¿ph_def
: 
tf
.
G¿phDef
 
hŞdšg
 
äoz’
 
g¿ph
.

232 
w™h
 
gfe
.
	`GFe
(
äoz’_g¿ph_·th
, 'wb'è
as
 
f
:

233 
f
.
	`wr™e
(
äoz’_g¿ph_def
.
	$S”ŸlizeToSŒšg
())

234 
loggšg
.
	`šfo
('%d op šhfš® g¿ph.', 
	$Ën
(
äoz’_g¿ph_def
.
node
))

237 
def
 
	$_wr™e_§ved_mod–
(
§ved_mod–_·th
,

238 
äoz’_g¿ph_def
,

239 
šputs
,

240 
ouuts
):

243 
If
 
checkpošt_·th
 
is
 
nÙ
 
NÚe
 
bakes
 
the
 
weights
 
što
h
g¿ph
 
th”eby


244 
–imš©šg
 
the
 
Ãed
 
of
 
checkpošt
 
fes
 
duršg
 
šã»nû
. 
If
h
mod–


245 
was
 
Œašed
 
w™h
 
movšg
 
av”ages
, 
£‰šg
 
u£_movšg_av”ages
 
to
 
Œue


246 
»¡Ües
 
the
 
movšg
 
av”ages
, 
Ùh”wi£
h
Üigš®
 
£t
 
of
 
v¬ŸbËs


247 
is
 
»¡Üed
.

249 
Args
:

250 
§ved_mod–_·th
: 
P©h
 
to
 
wr™e
 
SavedMod–
.

251 
äoz’_g¿ph_def
: 
tf
.
G¿phDef
 
hŞdšg
 
äoz’
 
g¿ph
.

252 
šputs
: 
The
 
šput
 
image
 
‹nsÜ
 
to
 
u£
 
d‘eùiÚ
.

253 
ouuts
: 
A
 
‹nsÜ
 
diùiÚ¬y
 
cÚššg
 
the
 ouut 
of
 
a
 
D‘eùiÚMod–
.

255 
w™h
 
tf
.
	`G¿ph
().
	$as_deçuÉ
():

256 
w™h
 
£ssiÚ
.
	$SessiÚ
(è
as
 
£ss
:

258 
tf
.
	`impÜt_g¿ph_def
(
äoz’_g¿ph_def
, 
Çme
='')

260 
bud”
 = 
tf
.
§ved_mod–
.bud”.
	$SavedMod–Bud”
(
§ved_mod–_·th
)

262 
‹nsÜ_šfo_šputs
 = {

263 'šputs': 
tf
.
§ved_mod–
.
uts
.
	`bud_‹nsÜ_šfo
(
šputs
)
	}
}

264 
‹nsÜ_šfo_ouuts
 = {}

265 
k
, 
v
 
š
 
	gouuts
.
	$™ems
():

266 
‹nsÜ_šfo_ouuts
[
k
] = 
tf
.
§ved_mod–
.
uts
.
	$bud_‹nsÜ_šfo
(
v
)

268 
d‘eùiÚ_sigÇtu»
 = (

269 
tf
.
§ved_mod–
.
sigÇtu»_def_uts
.
	$bud_sigÇtu»_def
(

270 
šputs
=
‹nsÜ_šfo_šputs
,

271 
ouuts
=
‹nsÜ_šfo_ouuts
,

272 
m‘hod_Çme
=
sigÇtu»_cÚ¡ªts
.
PREDICT_METHOD_NAME
))

274 
bud”
.
	`add_m‘a_g¿ph_ªd_v¬ŸbËs
(

275 
£ss
, [
tf
.
§ved_mod–
.
g_cÚ¡ªts
.
SERVING
],

276 
sigÇtu»_def_m­
={

277 
sigÇtu»_cÚ¡ªts
.
DEFAULT_SERVING_SIGNATURE_DEF_KEY
:

278 
d‘eùiÚ_sigÇtu»
,

279 
	}
},

281 
	gbud”
.
	$§ve
()

284 
def
 
	$_wr™e_g¿ph_ªd_checkpošt
(
šã»nû_g¿ph_def
,

285 
mod–_·th
,

286 
šput_§v”_def
,

287 
Œašed_checkpošt_´efix
):

288 
node
 
š
 
šã»nû_g¿ph_def
.node:

289 
node
.
deviû
 = ''

290 
w™h
 
tf
.
	`G¿ph
().
	$as_deçuÉ
():

291 
tf
.
	`impÜt_g¿ph_def
(
šã»nû_g¿ph_def
, 
Çme
='')

292 
w™h
 
£ssiÚ
.
	$SessiÚ
(è
as
 
£ss
:

293 
§v”
 = 
§v”_lib
.
	$Sav”
(
§v”_def
=
šput_§v”_def
,

294 
§ve_»Ïtive_·ths
=
True
)

295 
§v”
.
	$»¡Üe
(
£ss
, 
Œašed_checkpošt_´efix
)

296 
§v”
.
	$§ve
(
£ss
, 
mod–_·th
)

299 
def
 
	`_expÜt_šã»nû_g¿ph
(
šput_ty³
,

300 
d‘eùiÚ_mod–
,

301 
u£_movšg_av”ages
,

302 
Œašed_checkpošt_´efix
,

303 
ouut_dœeùÜy
,

304 
İtimize_g¿ph
=
F®£
,

305 
ouut_cŞËùiÚ_Çme
='inference_op'):

307 
tf
.
gfe
.
	$MakeDœs
(
ouut_dœeùÜy
)

308 
äoz’_g¿ph_·th
 = 
os
.
·th
.
	`još
(
ouut_dœeùÜy
,

310 
§ved_mod–_·th
 = 
os
.
·th
.
	`još
(
ouut_dœeùÜy
, 'saved_model')

311 
mod–_·th
 = 
os
.
·th
.
	`još
(
ouut_dœeùÜy
, 'model.ckpt')

313 
šput_ty³
 
nÙ
 
š
 
šput_¶aûhŞd”_â_m­
:

314 
¿i£
 
	`V®ueE¼Ü
('UnknowÀšpuˆty³: {}'.
	$fÜm©
(
šput_ty³
))

315 
¶aûhŞd”_‹nsÜ
, 
šput_‹nsÜs
 = 
šput_¶aûhŞd”_â_m­
[
šput_ty³
]()

316 
šputs
 = 
tf
.
	$to_æßt
(
šput_‹nsÜs
)

317 
´•roûs£d_šputs
 = 
d‘eùiÚ_mod–
.
	$´•roûss
(
šputs
)

318 
ouut_‹nsÜs
 = 
d‘eùiÚ_mod–
.
	$´ediù
(
´•roûs£d_šputs
)

319 
po¡´oûs£d_‹nsÜs
 = 
d‘eùiÚ_mod–
.
	$po¡´oûss
(
ouut_‹nsÜs
)

320 
ouuts
 = 
	$_add_ouut_‹nsÜ_nodes
(
po¡´oûs£d_‹nsÜs
,

321 
ouut_cŞËùiÚ_Çme
)

323 
§v”
 = 
NÚe


324 
u£_movšg_av”ages
:

325 
v¬ŸbË_av”ages
 = 
tf
.
Œaš
.
	$ExpÚ’tŸlMovšgAv”age
(0.0)

326 
v¬ŸbËs_to_»¡Üe
 = 
v¬ŸbË_av”ages
.
	$v¬ŸbËs_to_»¡Üe
()

327 
§v”
 = 
tf
.
Œaš
.
	$Sav”
(
v¬ŸbËs_to_»¡Üe
)

329 
§v”
 = 
tf
.
Œaš
.
	$Sav”
()

330 
šput_§v”_def
 = 
§v”
.
	$as_§v”_def
()

332 
	`_wr™e_g¿ph_ªd_checkpošt
(

333 
šã»nû_g¿ph_def
=
tf
.
	`g‘_deçuÉ_g¿ph
().
	`as_g¿ph_def
(),

334 
mod–_·th
=model_path,

335 
šput_§v”_def
=input_saver_def,

336 
Œašed_checkpošt_´efix
=trained_checkpoint_prefix)

338 
äoz’_g¿ph_def
 = 
	`ä“ze_g¿ph_w™h_def_´Ùos
(

339 
šput_g¿ph_def
=
tf
.
	`g‘_deçuÉ_g¿ph
().
	`as_g¿ph_def
(),

340 
šput_§v”_def
=input_saver_def,

341 
šput_checkpošt
=
Œašed_checkpošt_´efix
,

342 
ouut_node_Çmes
=','.
	`još
(
ouuts
.
	`keys
()),

343 
»¡Üe_İ_Çme
='save/restore_all',

344 
f’ame_‹nsÜ_Çme
='save/Const:0',

345 
ş—r_deviûs
=
True
,

346 
İtimize_g¿ph
=optimize_graph,

347 
š™Ÿliz”_nodes
='')

348 
	$_wr™e_äoz’_g¿ph
(
äoz’_g¿ph_·th
, 
äoz’_g¿ph_def
)

349 
	$_wr™e_§ved_mod–
(
§ved_mod–_·th
, 
äoz’_g¿ph_def
, 
¶aûhŞd”_‹nsÜ
,

350 
ouuts
)

353 
def
 
	`expÜt_šã»nû_g¿ph
(
šput_ty³
,

354 
p–še_cÚfig
,

355 
Œašed_checkpošt_´efix
,

356 
ouut_dœeùÜy
,

357 
İtimize_g¿ph
=
F®£
,

358 
ouut_cŞËùiÚ_Çme
='inference_op'):

361 
Args
:

362 
šput_ty³
: 
Ty³
 
of
 
šput
 
the
 
g¿ph
. 
Cª
 
be
 
Úe
 oà[`
image_‹nsÜ
`,

363 `
tf_exam¶e
`].

364 
p–še_cÚfig
: 
p–še_pb2
.
T¿šAndEv®P–šeCÚfig
 
´Ùo
.

365 
Œašed_checkpošt_´efix
: 
P©h
 
to
 
the
 
Œašed
 
checkpošt
 
fe
.

366 
ouut_dœeùÜy
: 
P©h
 
to
 
wr™e
 
ouuts
.

367 
İtimize_g¿ph
: 
Wh‘h”
 
to
 
İtimize
 
g¿ph
 
usšg
 
G¿µËr
.

368 
ouut_cŞËùiÚ_Çme
: 
Name
 
of
 
cŞËùiÚ
 
to
 
add
 
ouut
 
‹nsÜs
o.

369 
If
 
NÚe
, 
dÛs
 
nÙ
 
add
 
ouut
 
‹nsÜs
 
to
 
a
 
cŞËùiÚ
.

371 
d‘eùiÚ_mod–
 = 
mod–_bud”
.
	$bud
(
p–še_cÚfig
.
mod–
,

372 
is_Œaššg
=
F®£
)

373 
	`_expÜt_šã»nû_g¿ph
(
šput_ty³
, 
d‘eùiÚ_mod–
,

374 
p–še_cÚfig
.
ev®_cÚfig
.
u£_movšg_av”ages
,

375 
Œašed_checkpošt_´efix
, 
ouut_dœeùÜy
,

376 
İtimize_g¿ph
, 
ouut_cŞËùiÚ_Çme
)

	@exporter_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
os


18 
impÜt
 
numpy
 
as
 
Å


19 
impÜt
 
six


20 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
objeù_d‘eùiÚ
 
impÜt
 
expÜ‹r


22 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
mod–_bud”


23 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
mod–


24 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
p–še_pb2


26 
	gsix
.
	gPY2
:

27 
impÜt
 
mock
 #pylšt: 
di§bË
=
g
-impÜt-
nÙ
-
©
-
tİ


29 
äom
 
un™‹¡
 
impÜt
 
mock
 #pylšt: 
di§bË
=
g
-impÜt-
nÙ
-
©
-
tİ


32 
şass
 
	$FakeMod–
(
mod–
.
D‘eùiÚMod–
):

34 
def
 
	$__š™__
(
£lf
, 
add_d‘eùiÚ_masks
=
F®£
):

35 
£lf
.
_add_d‘eùiÚ_masks
 = 
add_d‘eùiÚ_masks


37 
def
 
	$´•roûss
(
£lf
, 
šputs
):

38  
tf
.
	$id’t™y
(
šputs
)

40 
def
 
	$´ediù
(
£lf
, 
´•roûs£d_šputs
):

41  {'image': 
tf
.
Ïy”s
.
	`cÚv2d
(
´•roûs£d_šputs
, 3, 1)
	}
}

43 
def
 
	$po¡´oûss
(
£lf
, 
´ediùiÚ_diù
):

44 
w™h
 
tf
.
	`cÚŒŞ_d•’d’c›s
(
´ediùiÚ_diù
.
	$v®ues
()):

45 
po¡´oûs£d_‹nsÜs
 = {

46 'd‘eùiÚ_boxes': 
tf
.
	`cÚ¡ªt
([[[0.0, 0.0, 0.5, 0.5],

49 [0.0, 0.0, 0.0, 0.0]]], 
tf
.
æßt32
),

50 'd‘eùiÚ_scÜes': 
tf
.
	`cÚ¡ªt
([[0.7, 0.6],

51 [0.9, 0.0]], 
tf
.
æßt32
),

52 'd‘eùiÚ_şas£s': 
tf
.
	`cÚ¡ªt
([[0, 1],

53 [1, 0]], 
tf
.
æßt32
),

54 'num_d‘eùiÚs': 
tf
.
	`cÚ¡ªt
([2, 1],f.
æßt32
)

55 
	}
}

56 
£lf
.
_add_d‘eùiÚ_masks
:

57 
po¡´oûs£d_‹nsÜs
['d‘eùiÚ_masks'] = 
tf
.
cÚ¡ªt
(

58 
Å
.
¬ªge
(64).
»sh­e
([2, 2, 4, 4]), 
tf
.
æßt32
)

59  
po¡´oûs£d_‹nsÜs


61 
def
 
	$»¡Üe_m­
(
£lf
, 
checkpošt_·th
, 
äom_d‘eùiÚ_checkpošt
):

62 
·ss


64 
def
 
	$loss
(
£lf
, 
´ediùiÚ_diù
):

65 
·ss


68 
şass
 
	$ExpÜtInã»nûG¿phTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

70 
def
 
	$_§ve_checkpošt_äom_mock_mod–
(
£lf
, 
checkpošt_·th
,

71 
u£_movšg_av”ages
):

72 
g
 = 
tf
.
	$G¿ph
()

73 
w™h
 
g
.
	$as_deçuÉ
():

74 
mock_mod–
 = 
	$FakeMod–
()

75 
´•roûs£d_šputs
 = 
mock_mod–
.
	`´•roûss
(

76 
tf
.
	$¶aûhŞd”
(
tf
.
æßt32
, 
sh­e
=[
NÚe
, None, None, 3]))

77 
´ediùiÚs
 = 
mock_mod–
.
	$´ediù
(
´•roûs£d_šputs
)

78 
mock_mod–
.
	$po¡´oûss
(
´ediùiÚs
)

79 
u£_movšg_av”ages
:

80 
tf
.
Œaš
.
	`ExpÚ’tŸlMovšgAv”age
(0.0).
	$­¶y
()

81 
§v”
 = 
tf
.
Œaš
.
	$Sav”
()

82 
š™
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

83 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

84 
£ss
.
	$run
(
š™
)

85 
§v”
.
	$§ve
(
£ss
, 
checkpošt_·th
)

87 
def
 
	$_lßd_šã»nû_g¿ph
(
£lf
, 
šã»nû_g¿ph_·th
):

88 
od_g¿ph
 = 
tf
.
	$G¿ph
()

89 
w™h
 
od_g¿ph
.
	$as_deçuÉ
():

90 
od_g¿ph_def
 = 
tf
.
	$G¿phDef
()

91 
w™h
 
tf
.
gfe
.
	$GFe
(
šã»nû_g¿ph_·th
è
as
 
fid
:

92 
£rŸlized_g¿ph
 = 
fid
.
	$»ad
()

93 
od_g¿ph_def
.
	$P¬£FromSŒšg
(
£rŸlized_g¿ph
)

94 
tf
.
	`impÜt_g¿ph_def
(
od_g¿ph_def
, 
Çme
='')

95  
od_g¿ph


97 
def
 
	$_ü—‹_tf_exam¶e
(
£lf
, 
image_¬¿y
):

98 
w™h
 
£lf
.
	$‹¡_£ssiÚ
():

99 
’coded_image
 = 
tf
.
image
.
	`’code_j³g
Ñf.
	`cÚ¡ªt
(
image_¬¿y
)).
	$ev®
()

100 
def
 
	$_by‹s_ã©u»
(
v®ue
):

101  
tf
.
Œaš
.
	`F—tu»
(
by‹s_li¡
ñf.Œaš.
	$By‹sLi¡
(
v®ue
=[value]))

102 
exam¶e
 = 
tf
.
Œaš
.
	`Exam¶e
(
ã©u»s
ñf.Œaš.
	`F—tu»s
(
ã©u»
={

103 'image/’coded': 
	`_by‹s_ã©u»
(
’coded_image
),

104 'image/fÜm©': 
	`_by‹s_ã©u»
('jpg'),

105 'image/sourû_id': 
	`_by‹s_ã©u»
('image_id')

106 
	}
})).
	$S”ŸlizeToSŒšg
()

107  
exam¶e


109 
def
 
	$‹¡_expÜt_g¿ph_w™h_image_‹nsÜ_šput
(
£lf
):

110 
tmp_dœ
 = 
£lf
.
	$g‘_‹mp_dœ
()

111 
Œašed_checkpošt_´efix
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'model.ckpt')

112 
£lf
.
	$_§ve_checkpošt_äom_mock_mod–
(
Œašed_checkpošt_´efix
,

113 
u£_movšg_av”ages
=
F®£
)

114 
w™h
 
mock
.
·tch
.
	`objeù
(

115 
mod–_bud”
, 'bud', 
auto¥ec
=
True
è
as
 
mock_bud”
:

116 
mock_bud”
.
»tuº_v®ue
 = 
	$FakeMod–
()

117 
ouut_dœeùÜy
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'output')

118 
p–še_cÚfig
 = 
p–še_pb2
.
	$T¿šEv®P–šeCÚfig
()

119 
p–še_cÚfig
.
ev®_cÚfig
.
u£_movšg_av”ages
 = 
F®£


120 
expÜ‹r
.
	`expÜt_šã»nû_g¿ph
(

121 
šput_ty³
='image_tensor',

122 
p–še_cÚfig
=pipeline_config,

123 
Œašed_checkpošt_´efix
=trained_checkpoint_prefix,

124 
ouut_dœeùÜy
=output_directory)

126 
def
 
	$‹¡_expÜt_g¿ph_w™h_tf_exam¶e_šput
(
£lf
):

127 
tmp_dœ
 = 
£lf
.
	$g‘_‹mp_dœ
()

128 
Œašed_checkpošt_´efix
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'model.ckpt')

129 
£lf
.
	$_§ve_checkpošt_äom_mock_mod–
(
Œašed_checkpošt_´efix
,

130 
u£_movšg_av”ages
=
F®£
)

131 
w™h
 
mock
.
·tch
.
	`objeù
(

132 
mod–_bud”
, 'bud', 
auto¥ec
=
True
è
as
 
mock_bud”
:

133 
mock_bud”
.
»tuº_v®ue
 = 
	$FakeMod–
()

134 
ouut_dœeùÜy
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'output')

135 
p–še_cÚfig
 = 
p–še_pb2
.
	$T¿šEv®P–šeCÚfig
()

136 
p–še_cÚfig
.
ev®_cÚfig
.
u£_movšg_av”ages
 = 
F®£


137 
expÜ‹r
.
	`expÜt_šã»nû_g¿ph
(

138 
šput_ty³
='tf_example',

139 
p–še_cÚfig
=pipeline_config,

140 
Œašed_checkpošt_´efix
=trained_checkpoint_prefix,

141 
ouut_dœeùÜy
=output_directory)

143 
def
 
	$‹¡_expÜt_g¿ph_w™h_’coded_image_¡ršg_šput
(
£lf
):

144 
tmp_dœ
 = 
£lf
.
	$g‘_‹mp_dœ
()

145 
Œašed_checkpošt_´efix
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'model.ckpt')

146 
£lf
.
	$_§ve_checkpošt_äom_mock_mod–
(
Œašed_checkpošt_´efix
,

147 
u£_movšg_av”ages
=
F®£
)

148 
w™h
 
mock
.
·tch
.
	`objeù
(

149 
mod–_bud”
, 'bud', 
auto¥ec
=
True
è
as
 
mock_bud”
:

150 
mock_bud”
.
»tuº_v®ue
 = 
	$FakeMod–
()

151 
ouut_dœeùÜy
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'output')

152 
p–še_cÚfig
 = 
p–še_pb2
.
	$T¿šEv®P–šeCÚfig
()

153 
p–še_cÚfig
.
ev®_cÚfig
.
u£_movšg_av”ages
 = 
F®£


154 
expÜ‹r
.
	`expÜt_šã»nû_g¿ph
(

155 
šput_ty³
='encoded_image_string_tensor',

156 
p–še_cÚfig
=pipeline_config,

157 
Œašed_checkpošt_´efix
=trained_checkpoint_prefix,

158 
ouut_dœeùÜy
=output_directory)

160 
def
 
	$‹¡_expÜt_g¿ph_w™h_movšg_av”ages
(
£lf
):

161 
tmp_dœ
 = 
£lf
.
	$g‘_‹mp_dœ
()

162 
Œašed_checkpošt_´efix
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'model.ckpt')

163 
£lf
.
	$_§ve_checkpošt_äom_mock_mod–
(
Œašed_checkpošt_´efix
,

164 
u£_movšg_av”ages
=
True
)

165 
ouut_dœeùÜy
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'output')

166 
w™h
 
mock
.
·tch
.
	`objeù
(

167 
mod–_bud”
, 'bud', 
auto¥ec
=
True
è
as
 
mock_bud”
:

168 
mock_bud”
.
»tuº_v®ue
 = 
	$FakeMod–
()

169 
p–še_cÚfig
 = 
p–še_pb2
.
	$T¿šEv®P–šeCÚfig
()

170 
p–še_cÚfig
.
ev®_cÚfig
.
u£_movšg_av”ages
 = 
True


171 
expÜ‹r
.
	`expÜt_šã»nû_g¿ph
(

172 
šput_ty³
='image_tensor',

173 
p–še_cÚfig
=pipeline_config,

174 
Œašed_checkpošt_´efix
=trained_checkpoint_prefix,

175 
ouut_dœeùÜy
=output_directory)

177 
def
 
	$‹¡_expÜt_mod–_w™h_®l_ouut_nodes
(
£lf
):

178 
tmp_dœ
 = 
£lf
.
	$g‘_‹mp_dœ
()

179 
Œašed_checkpošt_´efix
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'model.ckpt')

180 
£lf
.
	$_§ve_checkpošt_äom_mock_mod–
(
Œašed_checkpošt_´efix
,

181 
u£_movšg_av”ages
=
True
)

182 
ouut_dœeùÜy
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'output')

183 
šã»nû_g¿ph_·th
 = 
os
.
·th
.
	`još
(
ouut_dœeùÜy
,

185 
w™h
 
mock
.
·tch
.
	`objeù
(

186 
mod–_bud”
, 'bud', 
auto¥ec
=
True
è
as
 
mock_bud”
:

187 
mock_bud”
.
»tuº_v®ue
 = 
	$FakeMod–
(
add_d‘eùiÚ_masks
=
True
)

188 
p–še_cÚfig
 = 
p–še_pb2
.
	$T¿šEv®P–šeCÚfig
()

189 
expÜ‹r
.
	`expÜt_šã»nû_g¿ph
(

190 
šput_ty³
='image_tensor',

191 
p–še_cÚfig
=pipeline_config,

192 
Œašed_checkpošt_´efix
=trained_checkpoint_prefix,

193 
ouut_dœeùÜy
=output_directory)

194 
šã»nû_g¿ph
 = 
£lf
.
	$_lßd_šã»nû_g¿ph
(
šã»nû_g¿ph_·th
)

195 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(
g¿ph
=
šã»nû_g¿ph
):

196 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('image_tensor:0')

197 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_boxes:0')

198 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_scores:0')

199 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_classes:0')

200 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_masks:0')

201 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('num_detections:0')

203 
def
 
	$‹¡_expÜt_mod–_w™h_d‘eùiÚ_Úly_nodes
(
£lf
):

204 
tmp_dœ
 = 
£lf
.
	$g‘_‹mp_dœ
()

205 
Œašed_checkpošt_´efix
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'model.ckpt')

206 
£lf
.
	$_§ve_checkpošt_äom_mock_mod–
(
Œašed_checkpošt_´efix
,

207 
u£_movšg_av”ages
=
True
)

208 
ouut_dœeùÜy
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'output')

209 
šã»nû_g¿ph_·th
 = 
os
.
·th
.
	`još
(
ouut_dœeùÜy
,

211 
w™h
 
mock
.
·tch
.
	`objeù
(

212 
mod–_bud”
, 'bud', 
auto¥ec
=
True
è
as
 
mock_bud”
:

213 
mock_bud”
.
»tuº_v®ue
 = 
	$FakeMod–
(
add_d‘eùiÚ_masks
=
F®£
)

214 
p–še_cÚfig
 = 
p–še_pb2
.
	$T¿šEv®P–šeCÚfig
()

215 
expÜ‹r
.
	`expÜt_šã»nû_g¿ph
(

216 
šput_ty³
='image_tensor',

217 
p–še_cÚfig
=pipeline_config,

218 
Œašed_checkpošt_´efix
=trained_checkpoint_prefix,

219 
ouut_dœeùÜy
=output_directory)

220 
šã»nû_g¿ph
 = 
£lf
.
	$_lßd_šã»nû_g¿ph
(
šã»nû_g¿ph_·th
)

221 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(
g¿ph
=
šã»nû_g¿ph
):

222 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('image_tensor:0')

223 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_boxes:0')

224 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_scores:0')

225 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_classes:0')

226 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('num_detections:0')

227 
w™h
 
£lf
.
	$as£¹Rai£s
(
KeyE¼Ü
):

228 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_masks:0')

230 
def
 
	$‹¡_expÜt_ªd_run_šã»nû_w™h_image_‹nsÜ
(
£lf
):

231 
tmp_dœ
 = 
£lf
.
	$g‘_‹mp_dœ
()

232 
Œašed_checkpošt_´efix
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'model.ckpt')

233 
£lf
.
	$_§ve_checkpošt_äom_mock_mod–
(
Œašed_checkpošt_´efix
,

234 
u£_movšg_av”ages
=
True
)

235 
ouut_dœeùÜy
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'output')

236 
šã»nû_g¿ph_·th
 = 
os
.
·th
.
	`još
(
ouut_dœeùÜy
,

238 
w™h
 
mock
.
·tch
.
	`objeù
(

239 
mod–_bud”
, 'bud', 
auto¥ec
=
True
è
as
 
mock_bud”
:

240 
mock_bud”
.
»tuº_v®ue
 = 
	$FakeMod–
(
add_d‘eùiÚ_masks
=
True
)

241 
p–še_cÚfig
 = 
p–še_pb2
.
	$T¿šEv®P–šeCÚfig
()

242 
p–še_cÚfig
.
ev®_cÚfig
.
u£_movšg_av”ages
 = 
F®£


243 
expÜ‹r
.
	`expÜt_šã»nû_g¿ph
(

244 
šput_ty³
='image_tensor',

245 
p–še_cÚfig
=pipeline_config,

246 
Œašed_checkpošt_´efix
=trained_checkpoint_prefix,

247 
ouut_dœeùÜy
=output_directory)

249 
šã»nû_g¿ph
 = 
£lf
.
	$_lßd_šã»nû_g¿ph
(
šã»nû_g¿ph_·th
)

250 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(
g¿ph
=
šã»nû_g¿ph
è
as
 
£ss
:

251 
image_‹nsÜ
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('image_tensor:0')

252 
boxes
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_boxes:0')

253 
scÜes
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_scores:0')

254 
şas£s
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_classes:0')

255 
masks
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_masks:0')

256 
num_d‘eùiÚs
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('num_detections:0')

257 (
boxes_Å
, 
scÜes_Å
, 
şas£s_Å
, 
masks_Å
, 
num_d‘eùiÚs_Å
èğ
£ss
.
	`run
(

258 [
boxes
, 
scÜes
, 
şas£s
, 
masks
, 
num_d‘eùiÚs
],

259 
ãed_diù
={
image_‹nsÜ
: 
Å
.
	`Úes
((2, 4, 4, 3)).
	`a¡y³
Òp.
ušt8
)
	}
})

260 
£lf
.
	$as£¹AÎClo£
(
boxes_Å
, [[[0.0, 0.0, 0.5, 0.5],

264 
£lf
.
	$as£¹AÎClo£
(
scÜes_Å
, [[0.7, 0.6],

266 
£lf
.
	$as£¹AÎClo£
(
şas£s_Å
, [[1, 2],

268 
£lf
.
	`as£¹AÎClo£
(
masks_Å
, 
Å
.
	`¬ªge
(64).
	$»sh­e
([2, 2, 4, 4]))

269 
£lf
.
	$as£¹AÎClo£
(
num_d‘eùiÚs_Å
, [2, 1])

271 
def
 
	$_ü—‹_’coded_image_¡ršg
(
£lf
, 
image_¬¿y_Å
, 
’codšg_fÜm©
):

272 
od_g¿ph
 = 
tf
.
	$G¿ph
()

273 
w™h
 
od_g¿ph
.
	$as_deçuÉ
():

274 
’codšg_fÜm©
 == 'jpg':

275 
’coded_¡ršg
 = 
tf
.
image
.
	$’code_j³g
(
image_¬¿y_Å
)

276 
–if
 
’codšg_fÜm©
 == 'png':

277 
’coded_¡ršg
 = 
tf
.
image
.
	$’code_²g
(
image_¬¿y_Å
)

279 
¿i£
 
	`V®ueE¼Ü
('Supports onlyhe following formats: `jpg`, `png`')

280 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(
g¿ph
=
od_g¿ph
):

281  
’coded_¡ršg
.
	$ev®
()

283 
def
 
	$‹¡_expÜt_ªd_run_šã»nû_w™h_’coded_image_¡ršg_‹nsÜ
(
£lf
):

284 
tmp_dœ
 = 
£lf
.
	$g‘_‹mp_dœ
()

285 
Œašed_checkpošt_´efix
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'model.ckpt')

286 
£lf
.
	$_§ve_checkpošt_äom_mock_mod–
(
Œašed_checkpošt_´efix
,

287 
u£_movšg_av”ages
=
True
)

288 
ouut_dœeùÜy
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'output')

289 
šã»nû_g¿ph_·th
 = 
os
.
·th
.
	`još
(
ouut_dœeùÜy
,

291 
w™h
 
mock
.
·tch
.
	`objeù
(

292 
mod–_bud”
, 'bud', 
auto¥ec
=
True
è
as
 
mock_bud”
:

293 
mock_bud”
.
»tuº_v®ue
 = 
	$FakeMod–
(
add_d‘eùiÚ_masks
=
True
)

294 
p–še_cÚfig
 = 
p–še_pb2
.
	$T¿šEv®P–šeCÚfig
()

295 
p–še_cÚfig
.
ev®_cÚfig
.
u£_movšg_av”ages
 = 
F®£


296 
expÜ‹r
.
	`expÜt_šã»nû_g¿ph
(

297 
šput_ty³
='encoded_image_string_tensor',

298 
p–še_cÚfig
=pipeline_config,

299 
Œašed_checkpošt_´efix
=trained_checkpoint_prefix,

300 
ouut_dœeùÜy
=output_directory)

302 
šã»nû_g¿ph
 = 
£lf
.
	$_lßd_šã»nû_g¿ph
(
šã»nû_g¿ph_·th
)

303 
jpg_image_¡r
 = 
£lf
.
	`_ü—‹_’coded_image_¡ršg
(

304 
Å
.
	`Úes
((4, 4, 3)).
	`a¡y³
Òp.
ušt8
), 'jpg')

305 
²g_image_¡r
 = 
£lf
.
	`_ü—‹_’coded_image_¡ršg
(

306 
Å
.
	`Úes
((4, 4, 3)).
	`a¡y³
Òp.
ušt8
), 'png')

307 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(
g¿ph
=
šã»nû_g¿ph
è
as
 
£ss
:

308 
image_¡r_‹nsÜ
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
(

310 
boxes
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_boxes:0')

311 
scÜes
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_scores:0')

312 
şas£s
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_classes:0')

313 
masks
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_masks:0')

314 
num_d‘eùiÚs
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('num_detections:0')

315 
image_¡r
 
š
 [
jpg_image_¡r
, 
²g_image_¡r
]:

316 
image_¡r_b©ch_Å
 = 
Å
.
	$h¡ack
([
image_¡r
]* 2)

317 (
boxes_Å
, 
scÜes_Å
, 
şas£s_Å
, 
masks_Å
,

318 
num_d‘eùiÚs_Å
èğ
£ss
.
	`run
(

319 [
boxes
, 
scÜes
, 
şas£s
, 
masks
, 
num_d‘eùiÚs
],

320 
ãed_diù
={
image_¡r_‹nsÜ
: 
image_¡r_b©ch_Å
})

321 
£lf
.
	$as£¹AÎClo£
(
boxes_Å
, [[[0.0, 0.0, 0.5, 0.5],

325 
£lf
.
	$as£¹AÎClo£
(
scÜes_Å
, [[0.7, 0.6],

327 
£lf
.
	$as£¹AÎClo£
(
şas£s_Å
, [[1, 2],

329 
£lf
.
	`as£¹AÎClo£
(
masks_Å
, 
Å
.
	`¬ªge
(64).
	$»sh­e
([2, 2, 4, 4]))

330 
£lf
.
	$as£¹AÎClo£
(
num_d‘eùiÚs_Å
, [2, 1])

332 
def
 
	$‹¡_¿i£_ruÁime_”rÜ_Ú_images_w™h_difã»Á_sizes
(
£lf
):

333 
tmp_dœ
 = 
£lf
.
	$g‘_‹mp_dœ
()

334 
Œašed_checkpošt_´efix
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'model.ckpt')

335 
£lf
.
	$_§ve_checkpošt_äom_mock_mod–
(
Œašed_checkpošt_´efix
,

336 
u£_movšg_av”ages
=
True
)

337 
ouut_dœeùÜy
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'output')

338 
šã»nû_g¿ph_·th
 = 
os
.
·th
.
	`još
(
ouut_dœeùÜy
,

340 
w™h
 
mock
.
·tch
.
	`objeù
(

341 
mod–_bud”
, 'bud', 
auto¥ec
=
True
è
as
 
mock_bud”
:

342 
mock_bud”
.
»tuº_v®ue
 = 
	$FakeMod–
(
add_d‘eùiÚ_masks
=
True
)

343 
p–še_cÚfig
 = 
p–še_pb2
.
	$T¿šEv®P–šeCÚfig
()

344 
p–še_cÚfig
.
ev®_cÚfig
.
u£_movšg_av”ages
 = 
F®£


345 
expÜ‹r
.
	`expÜt_šã»nû_g¿ph
(

346 
šput_ty³
='encoded_image_string_tensor',

347 
p–še_cÚfig
=pipeline_config,

348 
Œašed_checkpošt_´efix
=trained_checkpoint_prefix,

349 
ouut_dœeùÜy
=output_directory)

351 
šã»nû_g¿ph
 = 
£lf
.
	$_lßd_šã»nû_g¿ph
(
šã»nû_g¿ph_·th
)

352 
Ïrge_image
 = 
£lf
.
	`_ü—‹_’coded_image_¡ršg
(

353 
Å
.
	`Úes
((4, 4, 3)).
	`a¡y³
Òp.
ušt8
), 'jpg')

354 
sm®l_image
 = 
£lf
.
	`_ü—‹_’coded_image_¡ršg
(

355 
Å
.
	`Úes
((2, 2, 3)).
	`a¡y³
Òp.
ušt8
), 'jpg')

357 
image_¡r_b©ch_Å
 = 
Å
.
	$h¡ack
([
Ïrge_image
, 
sm®l_image
])

358 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(
g¿ph
=
šã»nû_g¿ph
è
as
 
£ss
:

359 
image_¡r_‹nsÜ
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
(

361 
boxes
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_boxes:0')

362 
scÜes
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_scores:0')

363 
şas£s
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_classes:0')

364 
masks
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_masks:0')

365 
num_d‘eùiÚs
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('num_detections:0')

366 
w™h
 
£lf
.
	`as£¹Rai£sRegexp
(
tf
.
”rÜs
.
Inv®idArgum’tE¼Ü
,

368 
£ss
.
	`run
([
boxes
, 
scÜes
, 
şas£s
, 
masks
, 
num_d‘eùiÚs
],

369 
ãed_diù
={
image_¡r_‹nsÜ
: 
image_¡r_b©ch_Å
})

371 
def
 
	$‹¡_expÜt_ªd_run_šã»nû_w™h_tf_exam¶e
(
£lf
):

372 
tmp_dœ
 = 
£lf
.
	$g‘_‹mp_dœ
()

373 
Œašed_checkpošt_´efix
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'model.ckpt')

374 
£lf
.
	$_§ve_checkpošt_äom_mock_mod–
(
Œašed_checkpošt_´efix
,

375 
u£_movšg_av”ages
=
True
)

376 
ouut_dœeùÜy
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'output')

377 
šã»nû_g¿ph_·th
 = 
os
.
·th
.
	`još
(
ouut_dœeùÜy
,

379 
w™h
 
mock
.
·tch
.
	`objeù
(

380 
mod–_bud”
, 'bud', 
auto¥ec
=
True
è
as
 
mock_bud”
:

381 
mock_bud”
.
»tuº_v®ue
 = 
	$FakeMod–
(
add_d‘eùiÚ_masks
=
True
)

382 
p–še_cÚfig
 = 
p–še_pb2
.
	$T¿šEv®P–šeCÚfig
()

383 
p–še_cÚfig
.
ev®_cÚfig
.
u£_movšg_av”ages
 = 
F®£


384 
expÜ‹r
.
	`expÜt_šã»nû_g¿ph
(

385 
šput_ty³
='tf_example',

386 
p–še_cÚfig
=pipeline_config,

387 
Œašed_checkpošt_´efix
=trained_checkpoint_prefix,

388 
ouut_dœeùÜy
=output_directory)

390 
šã»nû_g¿ph
 = 
£lf
.
	$_lßd_šã»nû_g¿ph
(
šã»nû_g¿ph_·th
)

391 
tf_exam¶e_Å
 = 
Å
.
	`ex·nd_dims
(
£lf
.
	`_ü—‹_tf_exam¶e
(

392 
Å
.
	`Úes
((4, 4, 3)).
	`a¡y³
Òp.
ušt8
)), 
axis
=0)

393 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(
g¿ph
=
šã»nû_g¿ph
è
as
 
£ss
:

394 
tf_exam¶e
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('tf_example:0')

395 
boxes
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_boxes:0')

396 
scÜes
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_scores:0')

397 
şas£s
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_classes:0')

398 
masks
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_masks:0')

399 
num_d‘eùiÚs
 = 
šã»nû_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('num_detections:0')

400 (
boxes_Å
, 
scÜes_Å
, 
şas£s_Å
, 
masks_Å
, 
num_d‘eùiÚs_Å
èğ
£ss
.
	`run
(

401 [
boxes
, 
scÜes
, 
şas£s
, 
masks
, 
num_d‘eùiÚs
],

402 
ãed_diù
={
tf_exam¶e
: 
tf_exam¶e_Å
})

403 
£lf
.
	$as£¹AÎClo£
(
boxes_Å
, [[[0.0, 0.0, 0.5, 0.5],

407 
£lf
.
	$as£¹AÎClo£
(
scÜes_Å
, [[0.7, 0.6],

409 
£lf
.
	$as£¹AÎClo£
(
şas£s_Å
, [[1, 2],

411 
£lf
.
	`as£¹AÎClo£
(
masks_Å
, 
Å
.
	`¬ªge
(64).
	$»sh­e
([2, 2, 4, 4]))

412 
£lf
.
	$as£¹AÎClo£
(
num_d‘eùiÚs_Å
, [2, 1])

414 
def
 
	$‹¡_expÜt_§ved_mod–_ªd_run_šã»nû
(
£lf
):

415 
tmp_dœ
 = 
£lf
.
	$g‘_‹mp_dœ
()

416 
Œašed_checkpošt_´efix
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'model.ckpt')

417 
£lf
.
	$_§ve_checkpošt_äom_mock_mod–
(
Œašed_checkpošt_´efix
,

418 
u£_movšg_av”ages
=
F®£
)

419 
ouut_dœeùÜy
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'output')

420 
§ved_mod–_·th
 = 
os
.
·th
.
	`još
(
ouut_dœeùÜy
, 'saved_model')

422 
w™h
 
mock
.
·tch
.
	`objeù
(

423 
mod–_bud”
, 'bud', 
auto¥ec
=
True
è
as
 
mock_bud”
:

424 
mock_bud”
.
»tuº_v®ue
 = 
	$FakeMod–
(
add_d‘eùiÚ_masks
=
True
)

425 
p–še_cÚfig
 = 
p–še_pb2
.
	$T¿šEv®P–šeCÚfig
()

426 
p–še_cÚfig
.
ev®_cÚfig
.
u£_movšg_av”ages
 = 
F®£


427 
expÜ‹r
.
	`expÜt_šã»nû_g¿ph
(

428 
šput_ty³
='tf_example',

429 
p–še_cÚfig
=pipeline_config,

430 
Œašed_checkpošt_´efix
=trained_checkpoint_prefix,

431 
ouut_dœeùÜy
=output_directory)

433 
tf_exam¶e_Å
 = 
Å
.
	`h¡ack
([
£lf
.
	`_ü—‹_tf_exam¶e
(

434 
Å
.
	`Úes
((4, 4, 3)).
	`a¡y³
Òp.
ušt8
))] * 2)

435 
w™h
 
tf
.
	`G¿ph
().
	$as_deçuÉ
(è
as
 
od_g¿ph
:

436 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(
g¿ph
=
od_g¿ph
è
as
 
£ss
:

437 
tf
.
§ved_mod–
.
lßd”
.
	$lßd
(

438 
£ss
, [
tf
.
§ved_mod–
.
g_cÚ¡ªts
.
SERVING
], 
§ved_mod–_·th
)

439 
tf_exam¶e
 = 
od_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('tf_example:0')

440 
boxes
 = 
od_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_boxes:0')

441 
scÜes
 = 
od_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_scores:0')

442 
şas£s
 = 
od_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_classes:0')

443 
masks
 = 
od_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_masks:0')

444 
num_d‘eùiÚs
 = 
od_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('num_detections:0')

445 (
boxes_Å
, 
scÜes_Å
, 
şas£s_Å
, 
masks_Å
,

446 
num_d‘eùiÚs_Å
èğ
£ss
.
	`run
(

447 [
boxes
, 
scÜes
, 
şas£s
, 
masks
, 
num_d‘eùiÚs
],

448 
ãed_diù
={
tf_exam¶e
: 
tf_exam¶e_Å
})

449 
£lf
.
	$as£¹AÎClo£
(
boxes_Å
, [[[0.0, 0.0, 0.5, 0.5],

453 
£lf
.
	$as£¹AÎClo£
(
scÜes_Å
, [[0.7, 0.6],

455 
£lf
.
	$as£¹AÎClo£
(
şas£s_Å
, [[1, 2],

457 
£lf
.
	`as£¹AÎClo£
(
masks_Å
, 
Å
.
	`¬ªge
(64).
	$»sh­e
([2, 2, 4, 4]))

458 
£lf
.
	$as£¹AÎClo£
(
num_d‘eùiÚs_Å
, [2, 1])

460 
def
 
	$‹¡_expÜt_checkpošt_ªd_run_šã»nû
(
£lf
):

461 
tmp_dœ
 = 
£lf
.
	$g‘_‹mp_dœ
()

462 
Œašed_checkpošt_´efix
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'model.ckpt')

463 
£lf
.
	$_§ve_checkpošt_äom_mock_mod–
(
Œašed_checkpošt_´efix
,

464 
u£_movšg_av”ages
=
F®£
)

465 
ouut_dœeùÜy
 = 
os
.
·th
.
	`još
(
tmp_dœ
, 'output')

466 
mod–_·th
 = 
os
.
·th
.
	`još
(
ouut_dœeùÜy
, 'model.ckpt')

467 
m‘a_g¿ph_·th
 = 
mod–_·th
 + '.meta'

469 
w™h
 
mock
.
·tch
.
	`objeù
(

470 
mod–_bud”
, 'bud', 
auto¥ec
=
True
è
as
 
mock_bud”
:

471 
mock_bud”
.
»tuº_v®ue
 = 
	$FakeMod–
(
add_d‘eùiÚ_masks
=
True
)

472 
p–še_cÚfig
 = 
p–še_pb2
.
	$T¿šEv®P–šeCÚfig
()

473 
p–še_cÚfig
.
ev®_cÚfig
.
u£_movšg_av”ages
 = 
F®£


474 
expÜ‹r
.
	`expÜt_šã»nû_g¿ph
(

475 
šput_ty³
='tf_example',

476 
p–še_cÚfig
=pipeline_config,

477 
Œašed_checkpošt_´efix
=trained_checkpoint_prefix,

478 
ouut_dœeùÜy
=output_directory)

480 
tf_exam¶e_Å
 = 
Å
.
	`h¡ack
([
£lf
.
	`_ü—‹_tf_exam¶e
(

481 
Å
.
	`Úes
((4, 4, 3)).
	`a¡y³
Òp.
ušt8
))] * 2)

482 
w™h
 
tf
.
	`G¿ph
().
	$as_deçuÉ
(è
as
 
od_g¿ph
:

483 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(
g¿ph
=
od_g¿ph
è
as
 
£ss
:

484 
Ãw_§v”
 = 
tf
.
Œaš
.
	$impÜt_m‘a_g¿ph
(
m‘a_g¿ph_·th
)

485 
Ãw_§v”
.
	$»¡Üe
(
£ss
, 
mod–_·th
)

487 
tf_exam¶e
 = 
od_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('tf_example:0')

488 
boxes
 = 
od_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_boxes:0')

489 
scÜes
 = 
od_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_scores:0')

490 
şas£s
 = 
od_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_classes:0')

491 
masks
 = 
od_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('detection_masks:0')

492 
num_d‘eùiÚs
 = 
od_g¿ph
.
	`g‘_‹nsÜ_by_Çme
('num_detections:0')

493 (
boxes_Å
, 
scÜes_Å
, 
şas£s_Å
, 
masks_Å
,

494 
num_d‘eùiÚs_Å
èğ
£ss
.
	`run
(

495 [
boxes
, 
scÜes
, 
şas£s
, 
masks
, 
num_d‘eùiÚs
],

496 
ãed_diù
={
tf_exam¶e
: 
tf_exam¶e_Å
})

497 
£lf
.
	$as£¹AÎClo£
(
boxes_Å
, [[[0.0, 0.0, 0.5, 0.5],

501 
£lf
.
	$as£¹AÎClo£
(
scÜes_Å
, [[0.7, 0.6],

503 
£lf
.
	$as£¹AÎClo£
(
şas£s_Å
, [[1, 2],

505 
£lf
.
	`as£¹AÎClo£
(
masks_Å
, 
Å
.
	`¬ªge
(64).
	$»sh­e
([2, 2, 4, 4]))

506 
£lf
.
	$as£¹AÎClo£
(
num_d‘eùiÚs_Å
, [2, 1])

509 
__Çme__
 == '__main__':

510 
tf
.
‹¡
.
	`maš
()

	@matchers/__init__.py

	@matchers/argmax_matcher.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
This
 
şass
 
kes
 
a
 
sim¬™y
 
m©rix
 
ªd
 
m©ches
 
cŞumns
 
to
 
rows
 
ba£d
 
Ú
 
the


19 
maximum
 
v®ue
 
³r
 
	gcŞumn
. 
OÃ
 
ÿn
 
¥ecify
 
m©ched_th»shŞds
 
ªd


20 
to
 
´ev’t
 
cŞumns
 
äom
 
m©chšg
Ø
	$rows
 (
g’”®ly
 
»suÉšg
 
š
 
a
 
Ãg©ive


21 
Œaššg
 
exam¶e
è
ªd
 
unm©ched_theshŞd
 
to
 
ignÜe
 
the
 
	`m©ch
 (
g’”®ly


22 
»suÉšg
 
š
 
Ã™h”
 
a
 
pos™ive
 
Ü
 
Ãg©ive
 
Œaššg
 
exam¶e
).

24 
This
 
m©ch”
 
is
 
u£d
 
š
 
	`Fa¡
(
”
)-
RCNN
.

26 
NÙe
: 
m©ch”s
 
¬e
 
u£d
 
š
 
T¬g‘AssigÃrs
. 
Th”e
 
is
 
a
 
ü—‹_rg‘_assigÃr


27 
çùÜy
 
funùiÚ
 
pİuÏr
 
im¶em’tiÚs
.

30 
impÜt
 
‹nsÜæow
 
as
 
tf


32 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
m©ch”


35 
şass
 
	$ArgMaxM©ch”
(
m©ch”
.
M©ch”
):

38 
This
 
şass
 
compu‹s
 
m©ches
 
äom
 
a
 
sim¬™y
 
m©rix
. 
Each
 
cŞumn
 
is
 
m©ched


39 
to
 
a
 
sšgË
 
row
.

41 
To
 
suµÜt
 
objeù
 
d‘eùiÚ
 
rg‘
 
assignm’t
 
this
 
şass
 
’abËs
 
£‰šg
 
bÙh


42 
	$m©ched_th»shŞd
 (
uµ”
 
th»shŞd
è
ªd
 
	$unm©ched_th»shŞd
 (
low”
 
th»shŞds
)

43 
defššg
 
th»e
 
ÿ‹gÜ›s
 
of
 
sim¬™y
 
which
 
defše
 
wh‘h”
 
exam¶es
 
¬e


44 
pos™ive
, 
Ãg©ive
, 
Ü
 
ignÜed
:

45 (1è
sim¬™y
 >ğ
m©ched_th»shŞd
: 
Highe¡
 sim¬™y. 
M©ched
/
Pos™ive
!

46 (2è
m©ched_th»shŞd
 > 
sim¬™y
 >ğ
unm©ched_th»shŞd
: 
Medium
 similarity.

47 
D•’dšg
 
Ú
 
Ãg©ives_low”_thª_unm©ched
, 
this
 
is
 
e™h”


48 
Unm©ched
/
Neg©ive
 
OR
 
IgnÜe
.

49 (3è
unm©ched_th»shŞd
 > 
sim¬™y
: 
Lowe¡
 sim¬™y. 
D•’dšg
 
Ú
 
æag


50 
Ãg©ives_low”_thª_unm©ched
, 
e™h”
 
Unm©ched
/
Neg©ive
 
OR
 
IgnÜe
.

51 
FÜ
 
ignÜed
 
m©ches
 
this
 
şass
 
£ts
 
the
 
v®ues
 
š
h
M©ch
 
objeù
 
to
 -2.

54 
def
 
	$__š™__
(
£lf
,

55 
m©ched_th»shŞd
,

56 
unm©ched_th»shŞd
=
NÚe
,

57 
Ãg©ives_low”_thª_unm©ched
=
True
,

58 
fÜû_m©ch_fÜ_—ch_row
=
F®£
):

61 
Args
:

62 
m©ched_th»shŞd
: 
Th»shŞd
 
pos™ive
 
m©ches
. 
Pos™ive
 

63 
sim
 >ğ
m©ched_th»shŞd
, 
wh”e
 sim 
is
 
the
 
maximum
 
v®ue
 
of
he

64 
sim¬™y
 
m©rix
 
a
 
giv’
 
cŞumn
. 
S‘
 
to
 
NÚe
 
no
 
th»shŞd
.

65 
unm©ched_th»shŞd
: 
Th»shŞd
 
Ãg©ive
 
m©ches
. 
Neg©ive
 

66 
sim
 < 
unm©ched_th»shŞd
. 
DeçuÉs
 
to
 
m©ched_th»shŞd


67 
wh’
 
£t
 
to
 
NÚe
.

68 
Ãg©ives_low”_thª_unm©ched
: 
BoŞ—n
 
which
 
deçuÉs
 
to
 
True
. 
If
 True

69 
th’
 
Ãg©ive
 
m©ches
 
¬e
 
the
 
Úes
 
b–ow
h
unm©ched_th»shŞd
,

70 
wh”—s
 
ignÜed
 
m©ches
 
¬e
 
š
 
b‘w“n
 
the
 
m©ched
 
ªd
 
um©ched


71 
th»shŞd
. 
If
 
F®£
, 
th’
 
Ãg©ive
 
m©ches
 
¬e
 
š
 
b‘w“n
 
the
 
m©ched


72 
ªd
 
unm©ched
 
th»shŞd
,‡nd 
ev”ythšg
 
low”
 
thª
 unm©ched 
is
 
ignÜed
.

73 
fÜû_m©ch_fÜ_—ch_row
: 
If
 
True
, 
’su»s
 
th©
 
—ch
 
row
 
is
 
m©ched
 
to


74 
©
 
Ëa¡
 
Úe
 
	`cŞumn
 (
which
 
is
 
nÙ
 
gu¬ª‹ed
 
Ùh”wi£
 
the


75 
m©ched_th»shŞd
 
is
 
high
). 
DeçuÉs
 
to
 
F®£
. 
S“


76 
¬gmax_m©ch”_‹¡
.
	$‹¡M©ch”FÜûM©ch
(è
ª
 
exam¶e
.

78 
Rai£s
:

79 
V®ueE¼Ü
: 
unm©ched_th»shŞd
 
is
 
£t
 
but
 
m©ched_th»shŞd
 i 
nÙ
 set

80 
Ü
 
unm©ched_th»shŞd
 > 
m©ched_th»shŞd
.

82 ià(
m©ched_th»shŞd
 
is
 
NÚe
è
	$ªd
 (
unm©ched_th»shŞd
 
is
 
nÙ
 
NÚe
):

83 
¿i£
 
	`V®ueE¼Ü
('Needo‡lso define matched_threshold when'

85 
£lf
.
_m©ched_th»shŞd
 = 
m©ched_th»shŞd


86 
unm©ched_th»shŞd
 
is
 
NÚe
:

87 
£lf
.
_unm©ched_th»shŞd
 = 
m©ched_th»shŞd


89 
unm©ched_th»shŞd
 > 
m©ched_th»shŞd
:

90 
¿i£
 
	`V®ueE¼Ü
('unmatched_threshold‚eedso be smaller orƒqual'

92 
£lf
.
_unm©ched_th»shŞd
 = 
unm©ched_th»shŞd


93 
nÙ
 
Ãg©ives_low”_thª_unm©ched
:

94 
£lf
.
_unm©ched_th»shŞd
 =ğ£lf.
_m©ched_th»shŞd
:

95 
¿i£
 
	`V®ueE¼Ü
('When‚egatives‡re in between matched‡nd '

98 
£lf
.
_m©ched_th»shŞd
, s–f.
_unm©ched_th»shŞd
)

99 
£lf
.
_fÜû_m©ch_fÜ_—ch_row
 = 
fÜû_m©ch_fÜ_—ch_row


100 
£lf
.
_Ãg©ives_low”_thª_unm©ched
 = 
Ãg©ives_low”_thª_unm©ched


102 
def
 
	$_m©ch
(
£lf
, 
sim¬™y_m©rix
):

105 
Args
:

106 
sim¬™y_m©rix
: 
‹nsÜ
 
of
 
sh­e
 [
N
, 
M
] 
»´e£Ášg
 
ªy
 
sim¬™y


107 
m‘ric
.

109 
R‘uºs
:

110 
M©ch
 
objeù
 
w™h
 
cÜ»¥Údšg
 
m©ches
 
—ch
 
of
 
M
 
cŞumns
.

113 
def
 
	$_m©ch_wh’_rows_¬e_em±y
():

116 
Wh’
 
the
 
rows
 
¬e
 
em±y
, 
®l
 
d‘eùiÚs
‡» 
çl£
 
pos™ives
. 
So
 
we
 

117 
a
 
‹nsÜ
 
of
 -1'so indicatehathe columns do‚ot matcho‡ny„ows.

119 
R‘uºs
:

120 
m©ches
: 
št32
 
‹nsÜ
 
šdiÿtšg
 
the
 
row
 
—ch
 
cŞumn
 m©che 
to
.

122  -1 * 
tf
.
	`Úes
([tf.
	`sh­e
(
sim¬™y_m©rix
)[1]], 
dty³
ñf.
št32
)

124 
def
 
	$_m©ch_wh’_rows_¬e_nÚ_em±y
():

127 
R‘uºs
:

128 
m©ches
: 
št32
 
‹nsÜ
 
šdiÿtšg
 
the
 
row
 
—ch
 
cŞumn
 m©che 
to
.

130 #M©che 
—ch
 
cŞumn


131 
m©ches
 = 
tf
.
	$¬gmax
(
sim¬™y_m©rix
, 0)

133 #D—È
w™h
 
m©ched
 
ªd
 
unm©ched
 
th»shŞd


134 
£lf
.
_m©ched_th»shŞd
 
is
 
nÙ
 
NÚe
:

135 #G‘ 
logiÿl
 
šdiûs
 
of
 
ignÜed
 
ªd
 
unm©ched
 
cŞumns
 
as
 
tf
.
št64


136 
m©ched_v®s
 = 
tf
.
	$»duû_max
(
sim¬™y_m©rix
, 0)

137 
b–ow_unm©ched_th»shŞd
 = 
tf
.
	$g»©”
(
£lf
.
_unm©ched_th»shŞd
,

138 
m©ched_v®s
)

139 
b‘w“n_th»shŞds
 = 
tf
.
	`logiÿl_ªd
(

140 
tf
.
	`g»©”_equ®
(
m©ched_v®s
, 
£lf
.
_unm©ched_th»shŞd
),

141 
tf
.
	$g»©”
(
£lf
.
_m©ched_th»shŞd
, 
m©ched_v®s
))

143 
£lf
.
_Ãg©ives_low”_thª_unm©ched
:

144 
m©ches
 = 
£lf
.
	`_£t_v®ues_usšg_šdiÿtÜ
(matches,

145 
b–ow_unm©ched_th»shŞd
,

147 
m©ches
 = 
£lf
.
	`_£t_v®ues_usšg_šdiÿtÜ
(matches,

148 
b‘w“n_th»shŞds
,

151 
m©ches
 = 
£lf
.
	`_£t_v®ues_usšg_šdiÿtÜ
(matches,

152 
b–ow_unm©ched_th»shŞd
,

154 
m©ches
 = 
£lf
.
	`_£t_v®ues_usšg_šdiÿtÜ
(matches,

155 
b‘w“n_th»shŞds
,

158 
£lf
.
_fÜû_m©ch_fÜ_—ch_row
:

159 
fÜûd_m©ches_ids
 = 
tf
.
	`ÿ¡
Ñf.
	`¬gmax
(
sim¬™y_m©rix
, 1),f.
št32
)

161 #S‘ 
m©ches
[
fÜûd_m©ches_ids
] = [0, ..., 
R
], R 
is
 
numb”
 
of
 
rows
.

162 
row_¿nge
 = 
tf
.
	`¿nge
Ñf.
	`sh­e
(
sim¬™y_m©rix
)[0])

163 
cŞ_¿nge
 = 
tf
.
	`¿nge
Ñf.
	`sh­e
(
sim¬™y_m©rix
)[1])

164 
fÜûd_m©ches_v®ues
 = 
tf
.
	$ÿ¡
(
row_¿nge
, 
m©ches
.
dty³
)

165 
k“p_m©ches_ids
, 
_
 = 
tf
.
	$£tdiff1d
(
cŞ_¿nge
, 
fÜûd_m©ches_ids
)

166 
k“p_m©ches_v®ues
 = 
tf
.
	$g©h”
(
m©ches
, 
k“p_m©ches_ids
)

167 
m©ches
 = 
tf
.
	$dyÇmic_¡™ch
(

168 [
fÜûd_m©ches_ids
,

169 
k“p_m©ches_ids
], [
fÜûd_m©ches_v®ues
, 
k“p_m©ches_v®ues
])

171  
tf
.
	$ÿ¡
(
m©ches
, 
tf
.
št32
)

173  
tf
.
	`cÚd
(

174 
tf
.
	`g»©”
Ñf.
	`sh­e
(
sim¬™y_m©rix
)[0], 0),

175 
_m©ch_wh’_rows_¬e_nÚ_em±y
, 
_m©ch_wh’_rows_¬e_em±y
)

177 
def
 
	$_£t_v®ues_usšg_šdiÿtÜ
(
£lf
, 
x
, 
šdiÿtÜ
, 
v®
):

180 
Args
:

181 
x
: 
‹nsÜ
.

182 
šdiÿtÜ
: 
boŞ—n
 
w™h
 
§me
 
sh­e
 
as
 
x
.

183 
v®
: 
sÿÏr
 
w™h
 
v®ue
 
to
 
£t
.

185 
R‘uºs
:

186 
modif›d
 
‹nsÜ
.

188 
šdiÿtÜ
 = 
tf
.
	$ÿ¡
(
šdiÿtÜ
, 
x
.
dty³
)

189  
tf
.
	`add
Ñf.
	`muÉly
(
x
, 1 - 
šdiÿtÜ
), 
v®
 * indicator)

	@matchers/argmax_matcher_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
numpy
 
as
 
Å


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	gobjeù_d‘eùiÚ
.
m©ch”s
 
impÜt
 
¬gmax_m©ch”


24 
şass
 
	$ArgMaxM©ch”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$‹¡_»tuº_cÜ»ù_m©ches_w™h_deçuÉ_th»shŞds
(
£lf
):

27 
sim¬™y
 = 
Å
.
	`¬¿y
([[1., 1, 1, 3, 1],

31 
m©ch”
 = 
¬gmax_m©ch”
.
	$ArgMaxM©ch”
(
m©ched_th»shŞd
=
NÚe
)

32 
ex³ùed_m©ched_rows
 = 
Å
.
	$¬¿y
([2, 0, 1, 0, 1])

34 
sim
 = 
tf
.
	$cÚ¡ªt
(
sim¬™y
)

35 
m©ch
 = 
m©ch”
.
	$m©ch
(
sim
)

36 
m©ched_cŞs
 = 
m©ch
.
	$m©ched_cŞumn_šdiûs
()

37 
m©ched_rows
 = 
m©ch
.
	$m©ched_row_šdiûs
()

38 
unm©ched_cŞs
 = 
m©ch
.
	$unm©ched_cŞumn_šdiûs
()

40 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

41 
»s_m©ched_cŞs
 = 
£ss
.
	$run
(
m©ched_cŞs
)

42 
»s_m©ched_rows
 = 
£ss
.
	$run
(
m©ched_rows
)

43 
»s_unm©ched_cŞs
 = 
£ss
.
	$run
(
unm©ched_cŞs
)

45 
£lf
.
	$as£¹AÎEqu®
(
»s_m©ched_rows
, 
ex³ùed_m©ched_rows
)

46 
£lf
.
	`as£¹AÎEqu®
(
»s_m©ched_cŞs
, 
Å
.
	$¬ªge
(
sim¬™y
.
sh­e
[1]))

47 
£lf
.
	$as£¹Em±y
(
»s_unm©ched_cŞs
)

49 
def
 
	$‹¡_»tuº_cÜ»ù_m©ches_w™h_em±y_rows
(
£lf
):

51 
m©ch”
 = 
¬gmax_m©ch”
.
	$ArgMaxM©ch”
(
m©ched_th»shŞd
=
NÚe
)

52 
sim
 = 0.2*
tf
.
	$Úes
([0, 5])

53 
m©ch
 = 
m©ch”
.
	$m©ch
(
sim
)

54 
unm©ched_cŞs
 = 
m©ch
.
	$unm©ched_cŞumn_šdiûs
()

56 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

57 
»s_unm©ched_cŞs
 = 
£ss
.
	$run
(
unm©ched_cŞs
)

58 
£lf
.
	`as£¹AÎEqu®
(
»s_unm©ched_cŞs
, 
Å
.
	$¬ªge
(5))

60 
def
 
	$‹¡_»tuº_cÜ»ù_m©ches_w™h_m©ched_th»shŞd
(
£lf
):

61 
sim¬™y
 = 
Å
.
	`¬¿y
([[1, 1, 1, 3, 1],

63 [3, 0, -1, 0, 0]], 
dty³
=
Å
.
št32
)

65 
m©ch”
 = 
¬gmax_m©ch”
.
	$ArgMaxM©ch”
(
m©ched_th»shŞd
=3)

66 
ex³ùed_m©ched_cŞs
 = 
Å
.
	$¬¿y
([0, 3, 4])

67 
ex³ùed_m©ched_rows
 = 
Å
.
	$¬¿y
([2, 0, 1])

68 
ex³ùed_unm©ched_cŞs
 = 
Å
.
	$¬¿y
([1, 2])

70 
sim
 = 
tf
.
	$cÚ¡ªt
(
sim¬™y
)

71 
m©ch
 = 
m©ch”
.
	$m©ch
(
sim
)

72 
m©ched_cŞs
 = 
m©ch
.
	$m©ched_cŞumn_šdiûs
()

73 
m©ched_rows
 = 
m©ch
.
	$m©ched_row_šdiûs
()

74 
unm©ched_cŞs
 = 
m©ch
.
	$unm©ched_cŞumn_šdiûs
()

76 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

78 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

79 
£ss
.
	$run
(
š™_İ
)

80 
»s_m©ched_cŞs
 = 
£ss
.
	$run
(
m©ched_cŞs
)

81 
»s_m©ched_rows
 = 
£ss
.
	$run
(
m©ched_rows
)

82 
»s_unm©ched_cŞs
 = 
£ss
.
	$run
(
unm©ched_cŞs
)

84 
£lf
.
	$as£¹AÎEqu®
(
»s_m©ched_rows
, 
ex³ùed_m©ched_rows
)

85 
£lf
.
	$as£¹AÎEqu®
(
»s_m©ched_cŞs
, 
ex³ùed_m©ched_cŞs
)

86 
£lf
.
	$as£¹AÎEqu®
(
»s_unm©ched_cŞs
, 
ex³ùed_unm©ched_cŞs
)

88 
def
 
	$‹¡_»tuº_cÜ»ù_m©ches_w™h_m©ched_ªd_unm©ched_th»shŞd
(
£lf
):

89 
sim¬™y
 = 
Å
.
	`¬¿y
([[1, 1, 1, 3, 1],

91 [3, 0, -1, 0, 0]], 
dty³
=
Å
.
št32
)

93 
m©ch”
 = 
¬gmax_m©ch”
.
	$ArgMaxM©ch”
(
m©ched_th»shŞd
=3,

94 
unm©ched_th»shŞd
=2)

95 
ex³ùed_m©ched_cŞs
 = 
Å
.
	$¬¿y
([0, 3, 4])

96 
ex³ùed_m©ched_rows
 = 
Å
.
	$¬¿y
([2, 0, 1])

97 
ex³ùed_unm©ched_cŞs
 = 
Å
.
	$¬¿y
([1]è#cŞ 2 
has
 
too
 
high
 
maximum
 
v®


99 
sim
 = 
tf
.
	$cÚ¡ªt
(
sim¬™y
)

100 
m©ch
 = 
m©ch”
.
	$m©ch
(
sim
)

101 
m©ched_cŞs
 = 
m©ch
.
	$m©ched_cŞumn_šdiûs
()

102 
m©ched_rows
 = 
m©ch
.
	$m©ched_row_šdiûs
()

103 
unm©ched_cŞs
 = 
m©ch
.
	$unm©ched_cŞumn_šdiûs
()

105 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

106 
»s_m©ched_cŞs
 = 
£ss
.
	$run
(
m©ched_cŞs
)

107 
»s_m©ched_rows
 = 
£ss
.
	$run
(
m©ched_rows
)

108 
»s_unm©ched_cŞs
 = 
£ss
.
	$run
(
unm©ched_cŞs
)

110 
£lf
.
	$as£¹AÎEqu®
(
»s_m©ched_rows
, 
ex³ùed_m©ched_rows
)

111 
£lf
.
	$as£¹AÎEqu®
(
»s_m©ched_cŞs
, 
ex³ùed_m©ched_cŞs
)

112 
£lf
.
	$as£¹AÎEqu®
(
»s_unm©ched_cŞs
, 
ex³ùed_unm©ched_cŞs
)

114 
def
 
	$‹¡_»tuº_cÜ»ù_m©ches_Ãg©ives_low”_thª_unm©ched_çl£
(
£lf
):

115 
sim¬™y
 = 
Å
.
	`¬¿y
([[1, 1, 1, 3, 1],

117 [3, 0, -1, 0, 0]], 
dty³
=
Å
.
št32
)

119 
m©ch”
 = 
¬gmax_m©ch”
.
	$ArgMaxM©ch”
(
m©ched_th»shŞd
=3,

120 
unm©ched_th»shŞd
=2,

121 
Ãg©ives_low”_thª_unm©ched
=
F®£
)

122 
ex³ùed_m©ched_cŞs
 = 
Å
.
	$¬¿y
([0, 3, 4])

123 
ex³ùed_m©ched_rows
 = 
Å
.
	$¬¿y
([2, 0, 1])

124 
ex³ùed_unm©ched_cŞs
 = 
Å
.
	$¬¿y
([2]è#cŞ 1 
has
 
too
 
low
 
maximum
 
v®


126 
sim
 = 
tf
.
	$cÚ¡ªt
(
sim¬™y
)

127 
m©ch
 = 
m©ch”
.
	$m©ch
(
sim
)

128 
m©ched_cŞs
 = 
m©ch
.
	$m©ched_cŞumn_šdiûs
()

129 
m©ched_rows
 = 
m©ch
.
	$m©ched_row_šdiûs
()

130 
unm©ched_cŞs
 = 
m©ch
.
	$unm©ched_cŞumn_šdiûs
()

132 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

133 
»s_m©ched_cŞs
 = 
£ss
.
	$run
(
m©ched_cŞs
)

134 
»s_m©ched_rows
 = 
£ss
.
	$run
(
m©ched_rows
)

135 
»s_unm©ched_cŞs
 = 
£ss
.
	$run
(
unm©ched_cŞs
)

137 
£lf
.
	$as£¹AÎEqu®
(
»s_m©ched_rows
, 
ex³ùed_m©ched_rows
)

138 
£lf
.
	$as£¹AÎEqu®
(
»s_m©ched_cŞs
, 
ex³ùed_m©ched_cŞs
)

139 
£lf
.
	$as£¹AÎEqu®
(
»s_unm©ched_cŞs
, 
ex³ùed_unm©ched_cŞs
)

141 
def
 
	$‹¡_»tuº_cÜ»ù_m©ches_unm©ched_row_nÙ_usšg_fÜû_m©ch
(
£lf
):

142 
sim¬™y
 = 
Å
.
	`¬¿y
([[1, 1, 1, 3, 1],

144 [3, 0, -1, 2, 0]], 
dty³
=
Å
.
št32
)

146 
m©ch”
 = 
¬gmax_m©ch”
.
	$ArgMaxM©ch”
(
m©ched_th»shŞd
=3,

147 
unm©ched_th»shŞd
=2)

148 
ex³ùed_m©ched_cŞs
 = 
Å
.
	$¬¿y
([0, 3])

149 
ex³ùed_m©ched_rows
 = 
Å
.
	$¬¿y
([2, 0])

150 
ex³ùed_unm©ched_cŞs
 = 
Å
.
	$¬¿y
([1, 2, 4])

152 
sim
 = 
tf
.
	$cÚ¡ªt
(
sim¬™y
)

153 
m©ch
 = 
m©ch”
.
	$m©ch
(
sim
)

154 
m©ched_cŞs
 = 
m©ch
.
	$m©ched_cŞumn_šdiûs
()

155 
m©ched_rows
 = 
m©ch
.
	$m©ched_row_šdiûs
()

156 
unm©ched_cŞs
 = 
m©ch
.
	$unm©ched_cŞumn_šdiûs
()

158 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

159 
»s_m©ched_cŞs
 = 
£ss
.
	$run
(
m©ched_cŞs
)

160 
»s_m©ched_rows
 = 
£ss
.
	$run
(
m©ched_rows
)

161 
»s_unm©ched_cŞs
 = 
£ss
.
	$run
(
unm©ched_cŞs
)

163 
£lf
.
	$as£¹AÎEqu®
(
»s_m©ched_rows
, 
ex³ùed_m©ched_rows
)

164 
£lf
.
	$as£¹AÎEqu®
(
»s_m©ched_cŞs
, 
ex³ùed_m©ched_cŞs
)

165 
£lf
.
	$as£¹AÎEqu®
(
»s_unm©ched_cŞs
, 
ex³ùed_unm©ched_cŞs
)

167 
def
 
	$‹¡_»tuº_cÜ»ù_m©ches_unm©ched_row_whe_usšg_fÜû_m©ch
(
£lf
):

168 
sim¬™y
 = 
Å
.
	`¬¿y
([[1, 1, 1, 3, 1],

170 [3, 0, -1, 2, 0]], 
dty³
=
Å
.
št32
)

172 
m©ch”
 = 
¬gmax_m©ch”
.
	$ArgMaxM©ch”
(
m©ched_th»shŞd
=3,

173 
unm©ched_th»shŞd
=2,

174 
fÜû_m©ch_fÜ_—ch_row
=
True
)

175 
ex³ùed_m©ched_cŞs
 = 
Å
.
	$¬¿y
([0, 1, 3])

176 
ex³ùed_m©ched_rows
 = 
Å
.
	$¬¿y
([2, 1, 0])

177 
ex³ùed_unm©ched_cŞs
 = 
Å
.
	$¬¿y
([2, 4]è#cŞ 2 
has
 
too
 
high
 
max
 
v®


179 
sim
 = 
tf
.
	$cÚ¡ªt
(
sim¬™y
)

180 
m©ch
 = 
m©ch”
.
	$m©ch
(
sim
)

181 
m©ched_cŞs
 = 
m©ch
.
	$m©ched_cŞumn_šdiûs
()

182 
m©ched_rows
 = 
m©ch
.
	$m©ched_row_šdiûs
()

183 
unm©ched_cŞs
 = 
m©ch
.
	$unm©ched_cŞumn_šdiûs
()

185 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

186 
»s_m©ched_cŞs
 = 
£ss
.
	$run
(
m©ched_cŞs
)

187 
»s_m©ched_rows
 = 
£ss
.
	$run
(
m©ched_rows
)

188 
»s_unm©ched_cŞs
 = 
£ss
.
	$run
(
unm©ched_cŞs
)

190 
£lf
.
	$as£¹AÎEqu®
(
»s_m©ched_rows
, 
ex³ùed_m©ched_rows
)

191 
£lf
.
	$as£¹AÎEqu®
(
»s_m©ched_cŞs
, 
ex³ùed_m©ched_cŞs
)

192 
£lf
.
	$as£¹AÎEqu®
(
»s_unm©ched_cŞs
, 
ex³ùed_unm©ched_cŞs
)

194 
def
 
	$‹¡_v®id_¬gum’ts_cÜÃr_ÿ£
(
£lf
):

195 
¬gmax_m©ch”
.
	$ArgMaxM©ch”
(
m©ched_th»shŞd
=1,

196 
unm©ched_th»shŞd
=1)

198 
def
 
	$‹¡_šv®id_¬gum’ts_cÜÃr_ÿ£_Ãg©ives_low”_thª_th»s_çl£
(
£lf
):

199 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

200 
¬gmax_m©ch”
.
	$ArgMaxM©ch”
(
m©ched_th»shŞd
=1,

201 
unm©ched_th»shŞd
=1,

202 
Ãg©ives_low”_thª_unm©ched
=
F®£
)

204 
def
 
	$‹¡_šv®id_¬gum’ts_no_m©ched_th»shŞd
(
£lf
):

205 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

206 
¬gmax_m©ch”
.
	$ArgMaxM©ch”
(
m©ched_th»shŞd
=
NÚe
,

207 
unm©ched_th»shŞd
=4)

209 
def
 
	$‹¡_šv®id_¬gum’ts_unm©ched_th»s_Ïrg”_thª_m©ched_th»s
(
£lf
):

210 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

211 
¬gmax_m©ch”
.
	$ArgMaxM©ch”
(
m©ched_th»shŞd
=1,

212 
unm©ched_th»shŞd
=2)

214 
def
 
	$‹¡_£t_v®ues_usšg_šdiÿtÜ
(
£lf
):

215 
šput_a
 = 
Å
.
	$¬¿y
([3, 4, 5, 1, 4, 3, 2])

216 
ex³ùed_b
 = 
Å
.
	$¬¿y
([3, 0, 0, 1, 0, 3, 2]è#S‘ 
a
>3 
to
 0

217 
ex³ùed_c
 = 
Å
.
	`¬¿y
(

218 [3., 4., 5., -1., 4., 3., -1.]è#S‘ 
a
<3 
to
 -1. 
Flßt32


219 
idxb_
 = 
šput_a
 > 3

220 
idxc_
 = 
šput_a
 < 3

222 
m©ch”
 = 
¬gmax_m©ch”
.
	$ArgMaxM©ch”
(
m©ched_th»shŞd
=
NÚe
)

224 
a
 = 
tf
.
	$cÚ¡ªt
(
šput_a
)

225 
idxb
 = 
tf
.
	$cÚ¡ªt
(
idxb_
)

226 
idxc
 = 
tf
.
	$cÚ¡ªt
(
idxc_
)

227 
b
 = 
m©ch”
.
	$_£t_v®ues_usšg_šdiÿtÜ
(
a
, 
idxb
, 0)

228 
c
 = 
m©ch”
.
	`_£t_v®ues_usšg_šdiÿtÜ
(
tf
.
	`ÿ¡
(
a
,f.
æßt32
), 
idxc
, -1)

229 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

230 
»s_b
 = 
£ss
.
	$run
(
b
)

231 
»s_c
 = 
£ss
.
	$run
(
c
)

232 
£lf
.
	$as£¹AÎEqu®
(
»s_b
, 
ex³ùed_b
)

233 
£lf
.
	$as£¹AÎEqu®
(
»s_c
, 
ex³ùed_c
)

236 
__Çme__
 == '__main__':

237 
tf
.
‹¡
.
	`maš
()

	@matchers/bipartite_matcher.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	g‹nsÜæow
.
	gcÚŒib
.
	gimage
.
	gpythÚ
.
İs
 
impÜt
 
image_İs


21 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
m©ch”


24 
şass
 
	$G»edyB¬t™eM©ch”
(
m©ch”
.
M©ch”
):

27 
def
 
	`_m©ch
(
£lf
, 
sim¬™y_m©rix
, 
num_v®id_rows
=-1):

30 
TODO
: 
Add
 
num_v®id_cŞumns
 
İtiÚs
 
to
 
m©ch
 
Úly
 
th©
 
mªy
 
cŞumns
 
w™h


31 
®l
 
the
 
rows
.

33 
Args
:

34 
sim¬™y_m©rix
: 
Flßt
 
‹nsÜ
 
of
 
sh­e
 [
N
, 
M
] 
w™h
 
·œwi£
 
sim¬™y


35 
wh”e
 
high”
 
v®ues
 
m—n
 
mÜe
 
sim¬
.

36 
num_v®id_rows
: 
A
 
sÿÏr
 
Ü
 
a
 1-
D
 
‹nsÜ
 
w™h
 
Úe
 
–em’t
 
desüibšg
 
the


37 
numb”
 
of
 
v®id
 
rows
 oà
sim¬™y_m©rix
 
to
 
cÚsid”
 
the
 
b¬t™e


38 
m©chšg
. 
If
 
£t
 
to
 
be
 
Ãg©ive
, 
th’
 
®l
 
rows
 
äom
 
sim¬™y_m©rix


39 
¬e
 
u£d
.

41 
R‘uºs
:

42 
m©ch_»suÉs
: 
št32
 
‹nsÜ
 
of
 
sh­e
 [
M
] 
w™h
 m©ch_»suÉs[
i
]=-1

43 
m—nšg
 
th©
 
cŞumn
 
i
 
is
 
nÙ
 
m©ched
 
ªd
 
Ùh”wi£
h© 
™
 i m©ched 
to


44 
row
 
m©ch_»suÉs
[
i
].

46 #CÚv”ˆ
sim¬™y
 
m©rix
 
to
 
di¡ªû
 m©rix 
as
 
tf
.
image
.
b¬t™e
 
Œ›s


47 #tØ
fšd
 
mšimum
 
di¡ªû
 
m©ches
.

48 
di¡ªû_m©rix
 = -1 * 
sim¬™y_m©rix


49 
_
, 
m©ch_»suÉs
 = 
image_İs
.
	$b¬t™e_m©ch
(

50 
di¡ªû_m©rix
, 
num_v®id_rows
)

51 
m©ch_»suÉs
 = 
tf
.
	`»sh­e
(match_results, [-1])

52 
m©ch_»suÉs
 = 
tf
.
	$ÿ¡
(
m©ch_»suÉs
, 
tf
.
št32
)

53  
m©ch_»suÉs


	@matchers/bipartite_matcher_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
m©ch”s
 
impÜt
 
b¬t™e_m©ch”


23 
şass
 
	$G»edyB¬t™eM©ch”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

25 
def
 
	$‹¡_g‘_ex³ùed_m©ches_wh’_®l_rows_¬e_v®id
(
£lf
):

26 
sim¬™y_m©rix
 = 
tf
.
	$cÚ¡ªt
([[0.50, 0.1, 0.8], [0.15, 0.2, 0.3]])

27 
num_v®id_rows
 = 2

28 
ex³ùed_m©ch_»suÉs
 = [-1, 1, 0]

30 
m©ch”
 = 
b¬t™e_m©ch”
.
	$G»edyB¬t™eM©ch”
()

31 
m©ch
 = 
m©ch”
.
	$m©ch
(
sim¬™y_m©rix
, 
num_v®id_rows
=num_valid_rows)

32 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

33 
m©ch_»suÉs_out
 = 
£ss
.
	$run
(
m©ch
.
_m©ch_»suÉs
)

34 
£lf
.
	$as£¹AÎEqu®
(
m©ch_»suÉs_out
, 
ex³ùed_m©ch_»suÉs
)

36 
def
 
	$‹¡_g‘_ex³ùed_m©ches_w™h_v®id_rows_£t_to_mšus_Úe
(
£lf
):

37 
sim¬™y_m©rix
 = 
tf
.
	$cÚ¡ªt
([[0.50, 0.1, 0.8], [0.15, 0.2, 0.3]])

38 
num_v®id_rows
 = -1

39 
ex³ùed_m©ch_»suÉs
 = [-1, 1, 0]

41 
m©ch”
 = 
b¬t™e_m©ch”
.
	$G»edyB¬t™eM©ch”
()

42 
m©ch
 = 
m©ch”
.
	$m©ch
(
sim¬™y_m©rix
, 
num_v®id_rows
=num_valid_rows)

43 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

44 
m©ch_»suÉs_out
 = 
£ss
.
	$run
(
m©ch
.
_m©ch_»suÉs
)

45 
£lf
.
	$as£¹AÎEqu®
(
m©ch_»suÉs_out
, 
ex³ùed_m©ch_»suÉs
)

47 
def
 
	$‹¡_g‘_no_m©ches_w™h_z”o_v®id_rows
(
£lf
):

48 
sim¬™y_m©rix
 = 
tf
.
	$cÚ¡ªt
([[0.50, 0.1, 0.8], [0.15, 0.2, 0.3]])

49 
num_v®id_rows
 = 0

50 
ex³ùed_m©ch_»suÉs
 = [-1, -1, -1]

52 
m©ch”
 = 
b¬t™e_m©ch”
.
	$G»edyB¬t™eM©ch”
()

53 
m©ch
 = 
m©ch”
.
	$m©ch
(
sim¬™y_m©rix
, 
num_v®id_rows
=num_valid_rows)

54 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

55 
m©ch_»suÉs_out
 = 
£ss
.
	$run
(
m©ch
.
_m©ch_»suÉs
)

56 
£lf
.
	$as£¹AÎEqu®
(
m©ch_»suÉs_out
, 
ex³ùed_m©ch_»suÉs
)

58 
def
 
	$‹¡_g‘_ex³ùed_m©ches_w™h_Úly_Úe_v®id_row
(
£lf
):

59 
sim¬™y_m©rix
 = 
tf
.
	$cÚ¡ªt
([[0.50, 0.1, 0.8], [0.15, 0.2, 0.3]])

60 
num_v®id_rows
 = 1

61 
ex³ùed_m©ch_»suÉs
 = [-1, -1, 0]

63 
m©ch”
 = 
b¬t™e_m©ch”
.
	$G»edyB¬t™eM©ch”
()

64 
m©ch
 = 
m©ch”
.
	$m©ch
(
sim¬™y_m©rix
, 
num_v®id_rows
=num_valid_rows)

65 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

66 
m©ch_»suÉs_out
 = 
£ss
.
	$run
(
m©ch
.
_m©ch_»suÉs
)

67 
£lf
.
	$as£¹AÎEqu®
(
m©ch_»suÉs_out
, 
ex³ùed_m©ch_»suÉs
)

70 
__Çme__
 == '__main__':

71 
tf
.
‹¡
.
	`maš
()

	@meta_architectures/__init__.py

	@meta_architectures/faster_rcnn_meta_arch.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
G’”®
 
‹nsÜæow
 
im¶em’tiÚ
 
of
 
Fa¡”
 
	gR
-
CNN
 
d‘eùiÚ
 
	gmod–s
.

20 
S“
 
Fa¡”
 
	gR
-
	gCNN
: 
R’
, 
	gShaoqšg
, 
‘
 
	g®
.

22 
	gÃtwÜks
." Advances in‚eural information…rocessing systems. 2015.

24 
We
 
®low
 
two
 
	gmodes
: 
fœ¡_¡age_Úly
=
True
 
ªd
 fœ¡_¡age_Úly=
F®£
. 
In


25 
the
 
fÜm”
 
£‰šg
, 
®l
 
of
h
u£r
 
çcšg
 
	$m‘hods
 (
e
.
g
., 
´ediù
, 
po¡´oûss
,

26 
loss
è
ÿn
 
be
 
u£d
 
as
 
the
 
mod–
 
cÚsi¡ed
 
Úly
 
of
h
RPN
, 
»tuºšg
 
şass


27 
agno¡ic
 
	`´İo§ls
 (
the£
 
ÿn
 
be
 
thought
 
of
 
as
 
­´oxim©e
 
d‘eùiÚs
 
w™h
 
no


28 
assocŸ‹d
 
şass
 
šfÜm©iÚ
). 
In
 
the
 
Ï‰”
 
£‰šg
, 
´İo§ls
 
¬e
 
compu‹d
,

29 
th’
 
·s£d
 
through
 
a
 
£cÚd
 
¡age
 "box cÏssif›r" 
to
 
	`y›ld
 (
muÉi
-
şass
)

30 
d‘eùiÚs
.

32 
Im¶em’tiÚs
 
of
 
Fa¡”
 
R
-
CNN
 
mod–s
 
mu¡
 
defše
 
a
 
Ãw


33 
Fa¡”RCNNF—tu»ExŒaùÜ
 
ªd
 
ov”ride
 
th»e
 
m‘hods
: `
´•roûss
`,

34 `
_exŒaù_´İo§l_ã©u»s
` (
the
 
fœ¡
 
¡age
 
of
h
mod–
), 
ªd


35 `
_exŒaù_box_şassif›r_ã©u»s
` (
the
 
£cÚd
 
¡age
 
of
h
mod–
). 
O±iÚ®ly
,

36 
the
 `
»¡Üe_â
` 
m‘hod
 
ÿn
 
be
 
ov”ridd’
. 
S“
 
‹¡s
 
ª
 
exam¶e
.

38 
A
 
ãw
 
impÜÁ
 
nÙes
:

39 + 
B©chšg
 
cÚv’tiÚs
: 
We
 
suµÜt
 
b©ched
 
šã»nû
 
ªd
 
Œaššg
 
wh”e


40 
®l
 
images
 
w™hš
 
a
 
b©ch
 
have
 
the
 
§me
 
»sŞutiÚ
. 
B©ch
 
sizes
 
¬e
 
d‘”mšed


41 
dyÇmiÿÎy
 
vŸ
 
the
 
sh­e
 
of
h
šput
 
	`‹nsÜs
 (
¿th”
 
thª
 
bešg
 
¥ecif›d


42 
dœeùly
 
as
, 
e
.
g
., 
a
 
mod–
 
cÚ¡ruùÜ
).

44 
A
 
com¶iÿtiÚ
 
is
 
th©
 
due
 
to
 
nÚ
-
max
 
suµ»ssiÚ
, 
we
 
¬e
 
nÙ
 
gu¬ª‹ed
Ø
g‘


45 
the
 
§me
 
numb”
 
of
 
´İo§ls
 
äom
h
fœ¡
 
¡age
 
	$RPN
 (
»giÚ
 
´İo§l
 
ÃtwÜk
)

46 
—ch
 
	`image
 (
though
 
š
 
´aùiû
, 
we
 
should
 
oá’
 
g‘
 
the
 
§me
 
numb”
 
of


47 
´İo§ls
). 
FÜ
 
this
 
»asÚ
 
we
 
·d
 
to
 
a
 
max
 
numb”
 
of
…rİo§l 
³r
 
image


48 
w™hš
 
a
 
b©ch
. 
This
 `
£lf
.
max_num_´İo§ls
` 
´İ”ty
 
is
 
£t
 
to
 
the


49 `
fœ¡_¡age_max_´İo§ls
` 
·¿m‘”
 
©
 
šã»nû
 
time
 
ªd
 
the


50 `
£cÚd_¡age_b©ch_size
` 
©
 
Œaššg
 
time
 
sšû
 
we
 
sub§m¶e
 
the
 
b©ch
 
to


51 
be
 
£Á
 
through
 
the
 
box
 
şassif›r
 
duršg
 
Œaššg
.

53 
FÜ
 
the
 
£cÚd
 
¡age
 
of
h
p–še
, 
we
 
¬¿nge
h
´İo§ls
 
®l
 
images


54 
w™hš
 
the
 
b©ch
 
®Úg
 
a
 
sšgË
 b©ch 
dim’siÚ
. 
FÜ
 
exam¶e
,h
šput
 
to


55 
_exŒaù_box_şassif›r_ã©u»s
 
is
 
a
 
‹nsÜ
 
of
 
sh­e


56 `[
tÙ®_num_´İo§ls
, 
üİ_height
, 
üİ_width
, 
d•th
]` 
wh”e


57 
tÙ®_num_´İo§ls
 
is
 
b©ch_size
 * 
£lf
.
max_num_´İo§ls
. (
And
 
nÙe
 
th©
 
³r


58 
the
 
above
 
comm’t
, 
a
 
sub£t
 
of
 
the£
 
’Œ›s
 
cÜ»¥Úd
 
to
 
z”o
 
·ddšgs
.)

60 + 
CoÜdš©e
 
»´e£Á©iÚs
:

61 
FŞlowšg
 
the
 
	`API
 (
£e
 
mod–
.
D‘eùiÚMod–
 
defš™iÚ
), 
our
 
ouuts
 
aá”


62 
po¡´oûssšg
 
İ”©iÚs
 
¬e
 
®ways
 
nÜm®ized
 
boxes
 
howev”
, 
š‹º®ly
, 
we


63 
som‘imes
 
cÚv”t
 
to
 
absŞu‹
 --- 
e
.
g
. 
loss
 
computiÚ
. 
In
 
·¹icuÏr
,

64 
ªchÜs
 
ªd
 
´İo§l_boxes
 
¬e
 
bÙh
 
»´e£Áed
 
as
 
absŞu‹
 
coÜdš©es
.

66 
TODO
: 
SuµÜt
 
TPU
 
im¶em’tiÚs
 
ªd
 
sigmoid
 
loss
.

68 
äom
 
abc
 
impÜt
 
ab¡¿ùm‘hod


69 
äom
 
funùoŞs
 
impÜt
 
·¹Ÿl


70 
impÜt
 
‹nsÜæow
 
as
 
tf


72 
äom
 
objeù_d‘eùiÚ
.
ªchÜ_g’”©Üs
 
impÜt
 
grid_ªchÜ_g’”©Ü


73 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
b®ªûd_pos™ive_Ãg©ive_§m¶”
 
as
 
§m¶”


74 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


75 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡_İs


76 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_´ediùÜ


77 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
los£s


78 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
mod–


79 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
po¡_´oûssšg


80 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
¡ªd¬d_f›lds
 
as
 
f›lds


81 
äom
 
objeù_d‘eùiÚ
.
cÜe
 
impÜt
 
rg‘_assigÃr


82 
äom
 
objeù_d‘eùiÚ
.
uts
 
impÜt
 
İs


83 
äom
 
objeù_d‘eùiÚ
.
uts
 
impÜt
 
sh­e_uts


85 
¦im
 = 
tf
.
cÚŒib
.slim

88 
şass
 
	$Fa¡”RCNNF—tu»ExŒaùÜ
(
objeù
):

91 
def
 
	$__š™__
(
£lf
,

92 
is_Œaššg
,

93 
fœ¡_¡age_ã©u»s_¡ride
,

94 
»u£_weights
=
NÚe
,

95 
weight_deÿy
=0.0):

98 
Args
:

99 
is_Œaššg
: 
A
 
boŞ—n
 
šdiÿtšg
 
wh‘h”
 
the
 
Œaššg
 
v”siÚ
 
of
he

100 
computiÚ
 
g¿ph
 
should
 
be
 
cÚ¡ruùed
.

101 
fœ¡_¡age_ã©u»s_¡ride
: 
Ouut
 
¡ride
 
of
 
exŒaùed
 
RPN
 
ã©u»
 
m­
.

102 
»u£_weights
: 
Wh‘h”
 
to
 
»u£
 
v¬ŸbËs
. 
DeçuÉ
 
is
 
NÚe
.

103 
weight_deÿy
: 
weight
 
deÿy
 
ã©u»
 
	`exŒaùÜ
 (: 0.0).

105 
£lf
.
_is_Œaššg
 = 
is_Œaššg


106 
£lf
.
_fœ¡_¡age_ã©u»s_¡ride
 = 
fœ¡_¡age_ã©u»s_¡ride


107 
£lf
.
_»u£_weights
 = 
»u£_weights


108 
£lf
.
_weight_deÿy
 = 
weight_deÿy


110 @
ab¡¿ùm‘hod


111 
def
 
	$´•roûss
(
£lf
, 
»sized_šputs
):

113 
·ss


115 
def
 
	$exŒaù_´İo§l_ã©u»s
(
£lf
, 
´•roûs£d_šputs
, 
scİe
):

118 
This
 
funùiÚ
 
is
 
»¥ÚsibË
 
exŒaùšg
 
ã©u»
 
m­s
 
äom
 
´•roûs£d


119 
images
. 
The£
 
ã©u»s
 
¬e
 
u£d
 
by
 
the
 
»giÚ
 
´İo§l
 
	$ÃtwÜk
 (
RPN
è
to


120 
´ediù
 
´İo§ls
.

122 
Args
:

123 
´•roûs£d_šputs
: 
A
 [
b©ch
, 
height
, 
width
, 
chªÃls
] 
‹nsÜ


124 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

125 
scİe
: 
A
 scİ
Çme
.

127 
R‘uºs
:

128 
½n_ã©u»_m­
: 
A
 
‹nsÜ
 
w™h
 
sh­e
 [
b©ch
, 
height
, 
width
, 
d•th
]

130 
w™h
 
tf
.
	$v¬ŸbË_scİe
(
scİe
, 
v®ues
=[
´•roûs£d_šputs
]):

131  
£lf
.
	`_exŒaù_´İo§l_ã©u»s
(
´•roûs£d_šputs
, 
scİe
)

133 @
ab¡¿ùm‘hod


134 
def
 
	$_exŒaù_´İo§l_ã©u»s
(
£lf
, 
´•roûs£d_šputs
, 
scİe
):

136 
·ss


138 
def
 
	$exŒaù_box_şassif›r_ã©u»s
(
£lf
, 
´İo§l_ã©u»_m­s
, 
scİe
):

141 
Args
:

142 
´İo§l_ã©u»_m­s
: 
A
 4-
D
 
‹nsÜ
 
w™h
 
sh­e


143 [
b©ch_size
 * 
£lf
.
max_num_´İo§ls
, 
üİ_height
, 
üİ_width
, 
d•th
]

144 
»´e£Ášg
 
the
 
ã©u»
 
m­
 
üİ³d
 
to
 
—ch
 
´İo§l
.

145 
scİe
: 
A
 scİ
Çme
.

147 
R‘uºs
:

148 
´İo§l_şassif›r_ã©u»s
: 
A
 4-
D
 
‹nsÜ
 
w™h
 
sh­e


149 [
b©ch_size
 * 
£lf
.
max_num_´İo§ls
, 
height
, 
width
, 
d•th
]

150 
»´e£Ášg
 
box
 
şassif›r
 
ã©u»s
 
—ch
 
´İo§l
.

152 
w™h
 
tf
.
	$v¬ŸbË_scİe
(
scİe
, 
v®ues
=[
´İo§l_ã©u»_m­s
]):

153  
£lf
.
	`_exŒaù_box_şassif›r_ã©u»s
(
´İo§l_ã©u»_m­s
, 
scİe
)

155 @
ab¡¿ùm‘hod


156 
def
 
	$_exŒaù_box_şassif›r_ã©u»s
(
£lf
, 
´İo§l_ã©u»_m­s
, 
scİe
):

158 
·ss


160 
def
 
	$»¡Üe_äom_şassifiÿtiÚ_checkpošt_â
(

161 
£lf
,

162 
fœ¡_¡age_ã©u»_exŒaùÜ_scİe
,

163 
£cÚd_¡age_ã©u»_exŒaùÜ_scİe
):

166 
Args
:

167 
fœ¡_¡age_ã©u»_exŒaùÜ_scİe
: 
A
 
scİe
 
Çme
 
the
 
fœ¡
 
¡age


168 
ã©u»
 
exŒaùÜ
.

169 
£cÚd_¡age_ã©u»_exŒaùÜ_scİe
: 
A
 
scİe
 
Çme
 
the
 
£cÚd
 
¡age


170 
ã©u»
 
exŒaùÜ
.

172 
R‘uºs
:

173 
A
 
diù
 
m­pšg
 
v¬ŸbË
 
	$Çmes
 (
to
 
lßd
 
äom
 
a
 
checkpošt
ètØ
v¬ŸbËs
 
š


174 
the
 
mod–
 
g¿ph
.

176 
v¬ŸbËs_to_»¡Üe
 = {
	}
}

177 
v¬ŸbË
 
š
 
tf
.
	$glob®_v¬ŸbËs
():

178 
scİe_Çme
 
š
 [
fœ¡_¡age_ã©u»_exŒaùÜ_scİe
,

179 
£cÚd_¡age_ã©u»_exŒaùÜ_scİe
]:

180 
v¬ŸbË
.
İ
.
Çme
.
	$¡¬tsw™h
(
scİe_Çme
):

181 
v¬_Çme
 = 
v¬ŸbË
.
İ
.
Çme
.
	`»¶aû
(
scİe_Çme
 + '/', '')

182 
v¬ŸbËs_to_»¡Üe
[
v¬_Çme
] = 
v¬ŸbË


183  
v¬ŸbËs_to_»¡Üe


186 
şass
 
	$Fa¡”RCNNM‘aArch
(
mod–
.
D‘eùiÚMod–
):

189 
def
 
	$__š™__
(
£lf
,

190 
is_Œaššg
,

191 
num_şas£s
,

192 
image_»siz”_â
,

193 
ã©u»_exŒaùÜ
,

194 
fœ¡_¡age_Úly
,

195 
fœ¡_¡age_ªchÜ_g’”©Ü
,

196 
fœ¡_¡age_©rous_¿‹
,

197 
fœ¡_¡age_box_´ediùÜ_¬g_scİe
,

198 
fœ¡_¡age_box_´ediùÜ_k”Ãl_size
,

199 
fœ¡_¡age_box_´ediùÜ_d•th
,

200 
fœ¡_¡age_mšib©ch_size
,

201 
fœ¡_¡age_pos™ive_b®ªû_äaùiÚ
,

202 
fœ¡_¡age_nms_scÜe_th»shŞd
,

203 
fœ¡_¡age_nms_iou_th»shŞd
,

204 
fœ¡_¡age_max_´İo§ls
,

205 
fœ¡_¡age_loÿliz©iÚ_loss_weight
,

206 
fœ¡_¡age_objeùÃss_loss_weight
,

207 
š™Ÿl_üİ_size
,

208 
maxpoŞ_k”Ãl_size
,

209 
maxpoŞ_¡ride
,

210 
£cÚd_¡age_mask_rún_box_´ediùÜ
,

211 
£cÚd_¡age_b©ch_size
,

212 
£cÚd_¡age_b®ªû_äaùiÚ
,

213 
£cÚd_¡age_nÚ_max_suµ»ssiÚ_â
,

214 
£cÚd_¡age_scÜe_cÚv”siÚ_â
,

215 
£cÚd_¡age_loÿliz©iÚ_loss_weight
,

216 
£cÚd_¡age_şassifiÿtiÚ_loss_weight
,

217 
h¬d_exam¶e_mš”
,

218 
·¿Î–_™”©iÚs
=16):

221 
Args
:

222 
is_Œaššg
: 
A
 
boŞ—n
 
šdiÿtšg
 
wh‘h”
 
the
 
Œaššg
 
v”siÚ
 
of
he

223 
computiÚ
 
g¿ph
 
should
 
be
 
cÚ¡ruùed
.

224 
num_şas£s
: 
Numb”
 
of
 
şas£s
. 
NÙe
 
th©
‚um_şas£ *
dÛs
 
nÙ
*

225 
šşude
 
the
 
background
 
ÿ‹gÜy
, 
so
 
groundŒuth
 
Ïb–s
 
ke
 
v®ues


226 
š
 {0, 1, .., 
K
-1
	}
}, 
	gnum_şas£s
=K (
ªd
 
nÙ
 K+1, 
ev’
 
though
 
the


227 
assigÃd
 
şassifiÿtiÚ
 
rg‘s
 
ÿn
 
¿nge
 
äom
 {0,... 
K
}).

228 
	gimage_»siz”_â
: 
A
 
ÿÎabË
 
image
 
»sizšg
. 
This
 c®ÏbË 
®ways


229 
kes
 
a
 
¿nk
-3 
image
 
	$‹nsÜ
 (
cÜ»¥Údšg
 
to
 
a
 
sšgË
 
image
è
ªd


230 
»tuºs
 
a
 
¿nk
-3 
image
 
‹nsÜ
, 
possibly
 
w™h
 
Ãw
 
¥©Ÿl
 
dim’siÚs
.

231 
S“
 
bud”s
/
image_»siz”_bud”
.
py
.

232 
ã©u»_exŒaùÜ
: 
A
 
Fa¡”RCNNF—tu»ExŒaùÜ
 
objeù
.

233 
fœ¡_¡age_Úly
: 
Wh‘h”
 
to
 
cÚ¡ruù
 
Úly
 
the
 
RegiÚ
 
Prİo§l
 
N‘wÜk


234 (
RPN
è
·¹
 
of
 
the
 
mod–
.

235 
fœ¡_¡age_ªchÜ_g’”©Ü
: 
An
 
ªchÜ_g’”©Ü
.
AnchÜG’”©Ü
 
objeù


236 (
nÙe
 
th©
 
cu¼’y
 
we
 
Úly
 
suµÜt


237 
grid_ªchÜ_g’”©Ü
.
GridAnchÜG’”©Ü
 
objeùs
)

238 
fœ¡_¡age_©rous_¿‹
: 
A
 
sšgË
 
š‹g”
 
šdiÿtšg
 
the
 
©rous
 
¿‹
 

239 
the
 
sšgË
 
cÚvŞutiÚ
 
İ
 
which
 
is
 
­¶›d
 
to
h`
½n_ã©u»s_to_üİ
`

240 
‹nsÜ
 
to
 
obš
 
a
’sÜØ
be
 
u£d
 
box
 
´ediùiÚ
. 
Some
 
ã©u»


241 
exŒaùÜs
 
İtiÚ®ly
 
®low
 
´oducšg
 
ã©u»
 
m­s
 
compu‹d
 
©


242 
d’£r
 
»sŞutiÚs
. 
The
 
©rous
 
¿‹
 
is
 
u£d
 
to
 
com³n§‹
 
the


243 
d’£r
 
ã©u»
 
m­s
 
by
 
usšg
 
ª
 
efãùiv–y
 
Ïrg”
 
»û±ive
 
f›ld
.

244 (
This
 
should
 
typiÿÎy
 
be
 
£t
 
to
 1).

245 
fœ¡_¡age_box_´ediùÜ_¬g_scİe
: 
Slim
 
¬g_scİe
 
cÚv2d
,

246 
£·¿bË_cÚv2d
 
ªd
 
fuÎy_cÚÃùed
 
İs
 
the
 
RPN
 
box
 
´ediùÜ
.

247 
fœ¡_¡age_box_´ediùÜ_k”Ãl_size
: 
K”Ãl
 
size
 
to
 
u£
 
the


248 
cÚvŞutiÚ
 
İ
 
ju¡
 
´iÜ
 
to
 
RPN
 
box
 
´ediùiÚs
.

249 
fœ¡_¡age_box_´ediùÜ_d•th
: 
Ouut
 
d•th
 
the
 
cÚvŞutiÚ
 
İ


250 
ju¡
 
´iÜ
 
to
 
RPN
 
box
 
´ediùiÚs
.

251 
fœ¡_¡age_mšib©ch_size
: 
The
 "b©ch size" 
to
 
u£
 
computšg
 
the


252 
objeùÃss
 
ªd
 
loÿtiÚ
 
loss
 
of
 
the
 
»giÚ
 
´İo§l
 
ÃtwÜk
. 
This


253 "b©ch size" 
»ãrs
 
to
 
the
 
numb”
 
of
 
ªchÜs
 
£Ëùed
 
as
 
cÚŒibutšg


254 
to
 
the
 
loss
 
funùiÚ
 
ªy
 
giv’
 
image
 
w™hš
himag
b©ch
 
ªd
 
is


255 
Úly
 
ÿÎed
 "b©ch_size" 
due
 
to
 
‹rmšŞogy
 
äom
 
the
 
Fa¡”
 
R
-
CNN
 
·³r
.

256 
fœ¡_¡age_pos™ive_b®ªû_äaùiÚ
: 
F¿ùiÚ
 
of
 
pos™ive
 
exam¶es


257 
³r
 
image
 
the
 
RPN
. 
The
 
»comm’ded
 
v®ue
 
Fa¡”
 
RCNN
 
is
 0.5.

258 
fœ¡_¡age_nms_scÜe_th»shŞd
: 
ScÜe
 
th»shŞd
 
nÚ
 
max
 
suµ»ssiÚ


259 
the
 
RegiÚ
 
Prİo§l
 
	`N‘wÜk
 (
RPN
). 
This
 
v®ue
 
is
 
ex³ùed
 
to
 
be
 
š


260 [0, 1] 
as
 
™
 
is
 
­¶›d
 
dœeùly
 
aá”
 
a
 
soámax
 
ŒªsfÜm©iÚ
. 
The


261 
»comm’ded
 
v®ue
 
Fa¡”
 
R
-
CNN
 
is
 0.

262 
fœ¡_¡age_nms_iou_th»shŞd
: 
The
 
IÁ”£ùiÚ
 
Ov”
 
	$UniÚ
 (
IOU
è
th»shŞd


263 
³rfÜmšg
 
NÚ
-
Max
 
	$Suµ»ssiÚ
 (
NMS
è
Ú
 
the
 
boxes
 
´ediùed
 
by
he

264 
RegiÚ
 
Prİo§l
 
	`N‘wÜk
 (
RPN
).

265 
fœ¡_¡age_max_´İo§ls
: 
Maximum
 
numb”
 
of
 
boxes
 
to
 
»š
 
aá”


266 
³rfÜmšg
 
NÚ
-
Max
 
	$Suµ»ssiÚ
 (
NMS
è
Ú
 
the
 
boxes
 
´ediùed
 
by
he

267 
RegiÚ
 
Prİo§l
 
	`N‘wÜk
 (
RPN
).

268 
fœ¡_¡age_loÿliz©iÚ_loss_weight
: 
A
 

269 
fœ¡_¡age_objeùÃss_loss_weight
: 
A
 

270 
š™Ÿl_üİ_size
: 
A
 
sšgË
 
š‹g”
 
šdiÿtšg
 
the
 
ouut
 
size


271 (
width
 
ªd
 
height
 
¬e
 
£t
 
to
 
be
 
the
 
§me
è
of
h
š™Ÿl
 
bš—r


272 
š‹½Ş©iÚ
 
ba£d
 
üİpšg
 
duršg
 
ROI
 
poŞšg
.

273 
maxpoŞ_k”Ãl_size
: 
A
 
sšgË
 
š‹g”
 
šdiÿtšg
 
the
 
k”Ãl
 
size
 
of
he

274 
max
 
poŞ
 
İ
 
Ú
 
the
 
üİ³d
 
ã©u»
 
m­
 
duršg
 
ROI
 
poŞšg
.

275 
maxpoŞ_¡ride
: 
A
 
sšgË
 
š‹g”
 
šdiÿtšg
 
the
 
¡ride
 
of
h
max
 
poŞ


276 
İ
 
Ú
 
the
 
üİ³d
 
ã©u»
 
m­
 
duršg
 
ROI
 
poŞšg
.

277 
£cÚd_¡age_mask_rún_box_´ediùÜ
: 
Mask
 
R
-
CNN
 
box
 
´ediùÜ
 
to
 
u£
 

278 
the
 
£cÚd
 
¡age
.

279 
£cÚd_¡age_b©ch_size
: 
The
 
b©ch
 
size
 
u£d
 
computšg
 
the


280 
şassifiÿtiÚ
 
ªd
 
»fšed
 
loÿtiÚ
 
loss
 
of
 
the
 
box
 
şassif›r
. 
This


281 "b©ch size" 
»ãrs
 
to
 
the
 
numb”
 
of
 
´İo§ls
 
£Ëùed
 
as
 
cÚŒibutšg


282 
to
 
the
 
loss
 
funùiÚ
 
ªy
 
giv’
 
image
 
w™hš
himag
b©ch
 
ªd
 
is


283 
Úly
 
ÿÎed
 "b©ch_size" 
due
 
to
 
‹rmšŞogy
 
äom
 
the
 
Fa¡”
 
R
-
CNN
 
·³r
.

284 
£cÚd_¡age_b®ªû_äaùiÚ
: 
F¿ùiÚ
 
of
 
pos™ive
 
exam¶es
 
to
 
u£


285 
³r
 
image
 
the
 
box
 
şassif›r
. 
The
 
»comm’ded
 
v®ue
 
Fa¡”
 
RCNN


286 
is
 0.25.

287 
£cÚd_¡age_nÚ_max_suµ»ssiÚ_â
: 
b©ch_muÉişass_nÚ_max_suµ»ssiÚ


288 
ÿÎabË
 
th©
 
kes
 `
boxes
`, `
scÜes
`, 
İtiÚ®
 `
ş_wšdow
` 
ªd


289 
	`İtiÚ®
 (
kw¬g
è`
mask
` 
	$šputs
 (
w™h
 
®l
 
Ùh”
 
šputs
 
®»ady
 
£t
)

290 
ªd
 
»tuºs
 
a
 
diùiÚ¬y
 
cÚššg
 
‹nsÜs
 
w™h
 
keys
:

291 `
d‘eùiÚ_boxes
`, `
d‘eùiÚ_scÜes
`, `
d‘eùiÚ_şas£s
`,

292 `
num_d‘eùiÚs
`, 
	`ªd
 (
İtiÚ®ly
è`
d‘eùiÚ_masks
`. 
S“


293 `
po¡_´oûssšg
.
b©ch_muÉişass_nÚ_max_suµ»ssiÚ
` 
the
 
ty³
 
ªd


294 
sh­e
 
of
 
the£
 
‹nsÜs
.

295 
£cÚd_¡age_scÜe_cÚv”siÚ_â
: 
C®ÏbË
 
–em’twi£
 
nÚlš—r™y


296 (
th©
 
kes
 
‹nsÜs
 
as
 
šputs
 
ªd
 
»tuºs
’sÜs). 
This
 
is
 
usu®ly


297 
u£d
 
to
 
cÚv”t
 
log™s
Ø
´obab™›s
.

298 
£cÚd_¡age_loÿliz©iÚ_loss_weight
: 
A
 

299 
£cÚd_¡age_şassifiÿtiÚ_loss_weight
: 
A
 

300 
h¬d_exam¶e_mš”
: 
A
 
los£s
.
H¬dExam¶eMš”
 
	`objeù
 (
ÿn
 
be
 
NÚe
).

301 
·¿Î–_™”©iÚs
: (
O±iÚ®
è
The
 
numb”
 
of
 
™”©iÚs
 
®lowed
 
to
 
run


302 
š
 
·¿Î–
 
ÿÎs
 
to
 
tf
.
m­_â
.

303 
Rai£s
:

304 
V®ueE¼Ü
: 
If
 `
£cÚd_¡age_b©ch_size
` > `
fœ¡_¡age_max_´İo§ls
`

305 
V®ueE¼Ü
: 
If
 
fœ¡_¡age_ªchÜ_g’”©Ü
 
is
 
nÙ
 
of
 
ty³


306 
grid_ªchÜ_g’”©Ü
.
GridAnchÜG’”©Ü
.

308 
	`su³r
(
Fa¡”RCNNM‘aArch
, 
£lf
).
	$__š™__
(
num_şas£s
=num_classes)

310 
£cÚd_¡age_b©ch_size
 > 
fœ¡_¡age_max_´İo§ls
:

311 
¿i£
 
	`V®ueE¼Ü
('second_stage_batch_size should be‚o greaterhan '

313 
nÙ
 
	$isš¡ªû
(
fœ¡_¡age_ªchÜ_g’”©Ü
,

314 
grid_ªchÜ_g’”©Ü
.
GridAnchÜG’”©Ü
):

315 
¿i£
 
	`V®ueE¼Ü
('first_stage_anchor_generator must be ofype '

318 
£lf
.
_is_Œaššg
 = 
is_Œaššg


319 
£lf
.
_image_»siz”_â
 = 
image_»siz”_â


320 
£lf
.
_ã©u»_exŒaùÜ
 = 
ã©u»_exŒaùÜ


321 
£lf
.
_fœ¡_¡age_Úly
 = 
fœ¡_¡age_Úly


323 #Th
fœ¡
 
şass
 
is
 
»£rved
 
as
 
background
.

324 
unm©ched_şs_rg‘
 = 
tf
.
	`cÚ¡ªt
(

325 [1] + 
£lf
.
_num_şas£s
 * [0], 
dty³
=
tf
.
æßt32
)

326 
£lf
.
_´İo§l_rg‘_assigÃr
 = 
rg‘_assigÃr
.
	`ü—‹_rg‘_assigÃr
(

328 
£lf
.
_d‘eùÜ_rg‘_assigÃr
 = 
rg‘_assigÃr
.
	`ü—‹_rg‘_assigÃr
(

329 'Fa¡”RCNN', 'd‘eùiÚ', 
unm©ched_şs_rg‘
=unmatched_cls_target)

330 #BÙh 
´İo§l
 
ªd
 
d‘eùÜ
 
rg‘
 
assigÃrs
 
u£
 
the
 
§me
 
box
 
cod”


331 
£lf
.
_box_cod”
 = s–f.
_´İo§l_rg‘_assigÃr
.
box_cod”


333 #(
Fœ¡
 
¡age
è
RegiÚ
 
´İo§l
 
ÃtwÜk
 
·¿m‘”s


334 
£lf
.
_fœ¡_¡age_ªchÜ_g’”©Ü
 = 
fœ¡_¡age_ªchÜ_g’”©Ü


335 
£lf
.
_fœ¡_¡age_©rous_¿‹
 = 
fœ¡_¡age_©rous_¿‹


336 
£lf
.
_fœ¡_¡age_box_´ediùÜ_¬g_scİe
 = (

337 
fœ¡_¡age_box_´ediùÜ_¬g_scİe
)

338 
£lf
.
_fœ¡_¡age_box_´ediùÜ_k”Ãl_size
 = (

339 
fœ¡_¡age_box_´ediùÜ_k”Ãl_size
)

340 
£lf
.
_fœ¡_¡age_box_´ediùÜ_d•th
 = 
fœ¡_¡age_box_´ediùÜ_d•th


341 
£lf
.
_fœ¡_¡age_mšib©ch_size
 = 
fœ¡_¡age_mšib©ch_size


342 
£lf
.
_fœ¡_¡age_§m¶”
 = 
§m¶”
.
	$B®ªûdPos™iveNeg©iveSam¶”
(

343 
pos™ive_äaùiÚ
=
fœ¡_¡age_pos™ive_b®ªû_äaùiÚ
)

344 
£lf
.
_fœ¡_¡age_box_´ediùÜ
 = 
box_´ediùÜ
.
	$CÚvŞutiÚ®BoxP»diùÜ
(

345 
£lf
.
_is_Œaššg
, 
num_şas£s
=1,

346 
cÚv_hy³½¬ams
=
£lf
.
_fœ¡_¡age_box_´ediùÜ_¬g_scİe
,

347 
mš_d•th
=0, 
max_d•th
=0, 
num_Ïy”s_befÜe_´ediùÜ
=0,

348 
u£_drİout
=
F®£
, 
drİout_k“p_´ob
=1.0, 
k”Ãl_size
=1,

349 
box_code_size
=
£lf
.
_box_cod”
.
code_size
)

351 
£lf
.
_fœ¡_¡age_nms_scÜe_th»shŞd
 = 
fœ¡_¡age_nms_scÜe_th»shŞd


352 
£lf
.
_fœ¡_¡age_nms_iou_th»shŞd
 = 
fœ¡_¡age_nms_iou_th»shŞd


353 
£lf
.
_fœ¡_¡age_max_´İo§ls
 = 
fœ¡_¡age_max_´İo§ls


355 
£lf
.
_fœ¡_¡age_loÿliz©iÚ_loss
 = (

356 
los£s
.
	$Weigh‹dSmoÙhL1Loÿliz©iÚLoss
(
ªchÜwi£_ouut
=
True
))

357 
£lf
.
_fœ¡_¡age_objeùÃss_loss
 = (

358 
los£s
.
	$Weigh‹dSoámaxCÏssifiÿtiÚLoss
(
ªchÜwi£_ouut
=
True
))

359 
£lf
.
_fœ¡_¡age_loc_loss_weight
 = 
fœ¡_¡age_loÿliz©iÚ_loss_weight


360 
£lf
.
_fœ¡_¡age_obj_loss_weight
 = 
fœ¡_¡age_objeùÃss_loss_weight


362 #P”-
»giÚ
 
üİpšg
 
·¿m‘”s


363 
£lf
.
_š™Ÿl_üİ_size
 = 
š™Ÿl_üİ_size


364 
£lf
.
_maxpoŞ_k”Ãl_size
 = 
maxpoŞ_k”Ãl_size


365 
£lf
.
_maxpoŞ_¡ride
 = 
maxpoŞ_¡ride


367 
£lf
.
_mask_rún_box_´ediùÜ
 = 
£cÚd_¡age_mask_rún_box_´ediùÜ


369 
£lf
.
_£cÚd_¡age_b©ch_size
 = 
£cÚd_¡age_b©ch_size


370 
£lf
.
_£cÚd_¡age_§m¶”
 = 
§m¶”
.
	$B®ªûdPos™iveNeg©iveSam¶”
(

371 
pos™ive_äaùiÚ
=
£cÚd_¡age_b®ªû_äaùiÚ
)

373 
£lf
.
_£cÚd_¡age_nms_â
 = 
£cÚd_¡age_nÚ_max_suµ»ssiÚ_â


374 
£lf
.
_£cÚd_¡age_scÜe_cÚv”siÚ_â
 = 
£cÚd_¡age_scÜe_cÚv”siÚ_â


376 
£lf
.
_£cÚd_¡age_loÿliz©iÚ_loss
 = (

377 
los£s
.
	$Weigh‹dSmoÙhL1Loÿliz©iÚLoss
(
ªchÜwi£_ouut
=
True
))

378 
£lf
.
_£cÚd_¡age_şassifiÿtiÚ_loss
 = (

379 
los£s
.
	$Weigh‹dSoámaxCÏssifiÿtiÚLoss
(
ªchÜwi£_ouut
=
True
))

380 
£lf
.
_£cÚd_¡age_loc_loss_weight
 = 
£cÚd_¡age_loÿliz©iÚ_loss_weight


381 
£lf
.
_£cÚd_¡age_şs_loss_weight
 = 
£cÚd_¡age_şassifiÿtiÚ_loss_weight


382 
£lf
.
_h¬d_exam¶e_mš”
 = 
h¬d_exam¶e_mš”


383 
£lf
.
_·¿Î–_™”©iÚs
 = 
·¿Î–_™”©iÚs


385 @
´İ”ty


386 
def
 
	$fœ¡_¡age_ã©u»_exŒaùÜ_scİe
(
£lf
):

389 @
´İ”ty


390 
def
 
	$£cÚd_¡age_ã©u»_exŒaùÜ_scİe
(
£lf
):

393 @
´İ”ty


394 
def
 
	$fœ¡_¡age_box_´ediùÜ_scİe
(
£lf
):

397 @
´İ”ty


398 
def
 
	$£cÚd_¡age_box_´ediùÜ_scİe
(
£lf
):

401 @
´İ”ty


402 
def
 
	$max_num_´İo§ls
(
£lf
):

405 
At
 
Œaššg
 
time
, 
this
 
is
 
£t
 
to
 
be
 
the
 `
£cÚd_¡age_b©ch_size
` 
h¬d


406 
exam¶e
 
mš”
 
is
 
nÙ
 
cÚfigu»d
, 
™
 i 
£t
 
to


407 `
fœ¡_¡age_max_´İo§ls
`. 
At
 
šã»nû
 
time
, 
this
 
is
 
®ways
 
£t
 
to


408 `
fœ¡_¡age_max_´İo§ls
`.

410 
R‘uºs
:

411 
A
 
pos™ive
 
š‹g”
.

413 
£lf
.
_is_Œaššg
 
ªd
 
nÙ
 s–f.
_h¬d_exam¶e_mš”
:

414  
£lf
.
_£cÚd_¡age_b©ch_size


415  
£lf
.
_fœ¡_¡age_max_´İo§ls


417 
def
 
	$´•roûss
(
£lf
, 
šputs
):

420 
S“
 
ba£
 
şass
.

422 
FÜ
 
Fa¡”
 
R
-
CNN
, 
we
 
³rfÜm
 
image
 
»sizšg
 
š
 
the
 
ba£
 
şass
 --- 
—ch


423 
şass
 
subşassšg
 
Fa¡”RCNNM‘aArch
 
is
 
»¥ÚsibË
 
ªy
 
add™iÚ®


424 
	`´•roûssšg
 (
e
.
g
., 
sÿlšg
 
pix–
 
v®ues
 
to
 
be
 
š
 [-1, 1]).

426 
Args
:

427 
šputs
: 
a
 [
b©ch
, 
height_š
, 
width_š
, 
chªÃls
] 
‹nsÜ
 
»´e£Ášg


428 
a
 
b©ch
 
of
 
images
 
w™h
 
v®ues
 
b‘w“n
 0 
ªd
 255.0.

430 
R‘uºs
:

431 
´•roûs£d_šputs
: 
a
 [
b©ch
, 
height_out
, 
width_out
, 
chªÃls
] 

432 
‹nsÜ
 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

433 
Rai£s
:

434 
V®ueE¼Ü
: 
šputs
 
‹nsÜ
 
dÛs
 
nÙ
 
have
 
ty³
 
tf
.
æßt32


436 
šputs
.
dty³
 
is
 
nÙ
 
tf
.
æßt32
:

437 
¿i£
 
	`V®ueE¼Ü
('`preprocess`ƒxpects‡f.float32ensor')

438 
w™h
 
tf
.
	`Çme_scİe
('Preprocessor'):

439 
»sized_šputs
 = 
tf
.
	$m­_â
(
£lf
.
_image_»siz”_â
,

440 
–ems
=
šputs
,

441 
dty³
=
tf
.
æßt32
,

442 
·¿Î–_™”©iÚs
=
£lf
.
_·¿Î–_™”©iÚs
)

443  
£lf
.
_ã©u»_exŒaùÜ
.
	$´•roûss
(
»sized_šputs
)

445 
def
 
	$´ediù
(
£lf
, 
´•roûs£d_šputs
):

448 
This
 
funùiÚ
 
kes
 
ª
 
šput
 
b©ch
 
of
 
images
 
ªd
 
runs
 
™
 
through
 
the


449 
fÜw¬d
 
·ss
 
of
 
the
 
ÃtwÜk
 
to
 
y›ld
 "¿w" 
un
-
po¡´oûs£d
 
´ediùiÚs
.

450 
If
 `
fœ¡_¡age_Úly
` 
is
 
True
, 
this
 
funùiÚ
 
Úly
 
»tuºs
 
fœ¡
 
¡age


451 
RPN
 
	`´ediùiÚs
 (
un
-
po¡´oûs£d
). 
Oth”wi£
 
™
 
»tuºs
 
bÙh


452 
fœ¡
 
¡age
 
RPN
 
´ediùiÚs
 
as
 
w–l
‡ 
£cÚd
 sg
box
 
şassif›r


453 
´ediùiÚs
.

455 
Oth”
 
»m¬ks
:

456 + 
AnchÜ
 
´unšg
 
vs
. 
şpšg
: 
fŞlowšg
 
the
 
»comm’d©iÚ
 
of
h
Fa¡”


457 
R
-
CNN
 
·³r
, 
we
 
´uÃ
 
ªchÜs
 
th©
 
v’tu»
 
outside
 
the
 
image
 
wšdow
 
©


458 
Œaššg
 
time
 
ªd
 
ş
 
ªchÜs
 
to
 
the
 
image
 
wšdow
 
©
 
šã»nû
ime.

459 + 
Prİo§l
 
·ddšg
: 
as
 
desüibed
 
©
 
the
 
tİ
 
of
h
fe
, 
´İo§ls
 
¬e


460 
·dded
 
to
 
£lf
.
_max_num_´İo§ls
 
ªd
 
æ©‹Ãd
 
so
 
th©
 
´İo§ls
 
äom
 
®l


461 
images
 
w™hš
 
the
 
šput
 
b©ch
 
¬e
 
¬¿nged
 
®Úg
h
§me
 b©ch 
dim’siÚ
.

463 
Args
:

464 
´•roûs£d_šputs
: 
a
 [
b©ch
, 
height
, 
width
, 
chªÃls
] 
‹nsÜ


465 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

467 
R‘uºs
:

468 
´ediùiÚ_diù
: 
a
 
diùiÚ¬y
 
hŞdšg
 "¿w" 
´ediùiÚ
 
‹nsÜs
:

469 1è
½n_box_´ediùÜ_ã©u»s
: 
A
 4-
D
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


470 [
b©ch_size
, 
height
, 
width
, 
d•th
] 
to
 
be
 
u£d
 
´ediùšg
 
´İo§l


471 
boxes
 
ªd
 
cÜ»¥Údšg
 
objeùÃss
 
scÜes
.

472 2è
½n_ã©u»s_to_üİ
: 
A
 4-
D
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


473 [
b©ch_size
, 
height
, 
width
, 
d•th
] 
»´e£Ášg
 
image
 
ã©u»s
 
to
 
üİ


474 
usšg
 
the
 
´İo§l
 
boxes
 
´ediùed
 
by
h
RPN
.

475 3è
image_sh­e
: 
a
 1-
D
 
‹nsÜ
 
of
 
sh­e
 [4] 
»´e£Ášg
 
the
 
šput


476 
image
 
sh­e
.

477 4è
½n_box_’codšgs
: 3-
D
 
‹nsÜ
 
of
 
sh­e


478 [
b©ch_size
, 
num_ªchÜs
, 
£lf
.
_box_cod”
.
code_size
] 
cÚššg


479 
´ediùed
 
boxes
.

480 5è
½n_objeùÃss_´ediùiÚs_w™h_background
: 3-
D
 
‹nsÜ
 
of
 
sh­e


481 [
b©ch_size
, 
num_ªchÜs
, 2] 
cÚššg
 
şass


482 
	$´ediùiÚs
 (
log™s
è
—ch
 
of
 
the
 
ªchÜs
. 
NÙe
 
th©
 
this


483 
‹nsÜ
 *
šşudes
* 
background
 
şass
 
	`´ediùiÚs
 (
©
 cÏs 
šdex
 0).

484 6è
ªchÜs
: 
A
 2-
D
 
‹nsÜ
 
of
 
sh­e
 [
num_ªchÜs
, 4] 
»´e£Ášg
‡nchors

485 
the
 
fœ¡
 
¡age
 
	`RPN
 (
š
 
absŞu‹
 
coÜdš©es
). 
NÙe
 
th©


486 `
num_ªchÜs
` 
ÿn
 
difãr
 
d•’dšg
 
Ú
 
wh‘h”
 
the
 
mod–
 
is
 
ü—‹d
 
š


487 
Œaššg
 
Ü
 
šã»nû
 
mode
.

489 (
ªd
 
fœ¡_¡age_Úly
=
F®£
):

490 7è
»fšed_box_’codšgs
: 
a
 3-
D
 
‹nsÜ
 
w™h
 
sh­e


491 [
tÙ®_num_´İo§ls
, 
num_şas£s
, 4] 
»´e£Ášg
 
´ediùed


492 (
fš®
è
»fšed
 
box
 
’codšgs
, 
wh”e


493 
tÙ®_num_´İo§ls
=
b©ch_size
*
£lf
.
_max_num_´İo§ls


494 8è
şass_´ediùiÚs_w™h_background
: 
a
 3-
D
 
‹nsÜ
 
w™h
 
sh­e


495 [
tÙ®_num_´İo§ls
, 
num_şas£s
 + 1] 
cÚššg
 
şass


496 
	$´ediùiÚs
 (
log™s
è
—ch
 
of
 
the
 
ªchÜs
, 
wh”e


497 
tÙ®_num_´İo§ls
=
b©ch_size
*
£lf
.
_max_num_´İo§ls
.

498 
NÙe
 
th©
 
this
 
‹nsÜ
 *
šşudes
* 
background
 
şass
 
´ediùiÚs


499 (
©
 
şass
 
šdex
 0).

500 9è
num_´İo§ls
: 
An
 
št32
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
] 
»´e£Ášg
 
the


501 
numb”
 
of
 
´İo§ls
 
g’”©ed
 
by
 
the
 
RPN
. `
num_´İo§ls
` 
®lows
 
us


502 
to
 
k“p
 
Œack
 
of
 
which
 
’Œ›s
 
¬e
Ø
be
 
Œ—‹d
 
as
 
z”o
 
·ddšgs
 
ªd


503 
which
 
¬e
 
nÙ
 
sšû
 
we
 
®ways
 
·d
 
the
 
numb”
 
of
 
´İo§ls
 
to
 
be


504 `
£lf
.
max_num_´İo§ls
` 
—ch
 
image
.

505 10è
´İo§l_boxes
: 
A
 
æßt32
 
‹nsÜ
 
of
 
sh­e


506 [
b©ch_size
, 
£lf
.
max_num_´İo§ls
, 4] 
»´e£Ášg


507 
decoded
 
´İo§l
 
boundšg
 
	`boxes
 (
š
 
absŞu‹
 
coÜdš©es
).

508 11è
mask_´ediùiÚs
: (
İtiÚ®
è
a
 4-
D
 
‹nsÜ
 
w™h
 
sh­e


509 [
tÙ®_num_·dded_´İo§ls
, 
num_şas£s
, 
mask_height
, 
mask_width
]

510 
cÚššg
 
š¡ªû
 
mask
 
´ediùiÚs
.

512 (
½n_box_´ediùÜ_ã©u»s
, 
½n_ã©u»s_to_üİ
, 
ªchÜs_boxli¡
,

513 
image_sh­e
èğ
£lf
.
	$_exŒaù_½n_ã©u»_m­s
(
´•roûs£d_šputs
)

514 (
½n_box_’codšgs
, 
½n_objeùÃss_´ediùiÚs_w™h_background


515 èğ
£lf
.
	$_´ediù_½n_´İo§ls
(
½n_box_´ediùÜ_ã©u»s
)

517 #Th
Fa¡”
 
R
-
CNN
 
·³r
 
»comm’ds
 
´unšg
 
ªchÜs
 
th©
 
v’tu»
 
outside


518 #th
image
 
wšdow
 
©
 
Œaššg
 
time
 
ªd
 
şpšg
‡ˆ
šã»nû
ime.

519 
ş_wšdow
 = 
tf
.
	`to_æßt
Ñf.
	$¡ack
([0, 0, 
image_sh­e
[1], image_shape[2]]))

520 
£lf
.
_is_Œaššg
:

521 (
½n_box_’codšgs
, 
½n_objeùÃss_´ediùiÚs_w™h_background
,

522 
ªchÜs_boxli¡
èğ
£lf
.
	$_»move_šv®id_ªchÜs_ªd_´ediùiÚs
(

523 
½n_box_’codšgs
, 
½n_objeùÃss_´ediùiÚs_w™h_background
,

524 
ªchÜs_boxli¡
, 
ş_wšdow
)

526 
ªchÜs_boxli¡
 = 
box_li¡_İs
.
	$ş_to_wšdow
(

527 
ªchÜs_boxli¡
, 
ş_wšdow
)

529 
ªchÜs
 = 
ªchÜs_boxli¡
.
	$g‘
()

530 
´ediùiÚ_diù
 = {

531 '½n_box_´ediùÜ_ã©u»s': 
½n_box_´ediùÜ_ã©u»s
,

532 '½n_ã©u»s_to_üİ': 
½n_ã©u»s_to_üİ
,

533 'image_sh­e': 
image_sh­e
,

534 '½n_box_’codšgs': 
½n_box_’codšgs
,

536 
½n_objeùÃss_´ediùiÚs_w™h_background
,

537 'ªchÜs': 
ªchÜs


538 
	}
}

540 
nÙ
 
£lf
.
_fœ¡_¡age_Úly
:

541 
´ediùiÚ_diù
.
upd©e
(
£lf
.
	$_´ediù_£cÚd_¡age
(

542 
½n_box_’codšgs
,

543 
½n_objeùÃss_´ediùiÚs_w™h_background
,

544 
½n_ã©u»s_to_üİ
,

545 
ªchÜs
, 
image_sh­e
))

546  
´ediùiÚ_diù


548 
def
 
	$_´ediù_£cÚd_¡age
(
£lf
, 
½n_box_’codšgs
,

549 
½n_objeùÃss_´ediùiÚs_w™h_background
,

550 
½n_ã©u»s_to_üİ
,

551 
ªchÜs
,

552 
image_sh­e
):

555 
Args
:

556 
½n_box_’codšgs
: 4-
D
 
‹nsÜ
 
of
 
sh­e


557 [
b©ch_size
, 
num_v®id_ªchÜs
, 
£lf
.
_box_cod”
.
code_size
] 
cÚššg


558 
´ediùed
 
boxes
.

559 
½n_objeùÃss_´ediùiÚs_w™h_background
: 2-
D
 
‹nsÜ
 
of
 
sh­e


560 [
b©ch_size
, 
num_v®id_ªchÜs
, 2] 
cÚššg
 
şass


561 
	$´ediùiÚs
 (
log™s
è
—ch
 
of
 
the
 
ªchÜs
. 
NÙe
 
th©
 
this


562 
‹nsÜ
 *
šşudes
* 
background
 
şass
 
	`´ediùiÚs
 (
©
 cÏs 
šdex
 0).

563 
½n_ã©u»s_to_üİ
: 
A
 4-
D
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


564 [
b©ch_size
, 
height
, 
width
, 
d•th
] 
»´e£Ášg
 
image
 
ã©u»s
 
to
 
üİ


565 
usšg
 
the
 
´İo§l
 
boxes
 
´ediùed
 
by
h
RPN
.

566 
ªchÜs
: 2-
D
 
‹nsÜ
 
of
 
sh­e


567 [
num_ªchÜs
, 
£lf
.
_box_cod”
.
code_size
].

568 
image_sh­e
: 
A
 1D 
št32
 
‹nsÜs
 
of
 
size
 [4] 
cÚššg
 
the
 
image
 
sh­e
.

570 
R‘uºs
:

571 
´ediùiÚ_diù
: 
a
 
diùiÚ¬y
 
hŞdšg
 "¿w" 
´ediùiÚ
 
‹nsÜs
:

572 1è
»fšed_box_’codšgs
: 
a
 3-
D
 
‹nsÜ
 
w™h
 
sh­e


573 [
tÙ®_num_´İo§ls
, 
num_şas£s
, 4] 
»´e£Ášg
 
´ediùed


574 (
fš®
è
»fšed
 
box
 
’codšgs
, 
wh”e


575 
tÙ®_num_´İo§ls
=
b©ch_size
*
£lf
.
_max_num_´İo§ls


576 2è
şass_´ediùiÚs_w™h_background
: 
a
 3-
D
 
‹nsÜ
 
w™h
 
sh­e


577 [
tÙ®_num_´İo§ls
, 
num_şas£s
 + 1] 
cÚššg
 
şass


578 
	$´ediùiÚs
 (
log™s
è
—ch
 
of
 
the
 
ªchÜs
, 
wh”e


579 
tÙ®_num_´İo§ls
=
b©ch_size
*
£lf
.
_max_num_´İo§ls
.

580 
NÙe
 
th©
 
this
 
‹nsÜ
 *
šşudes
* 
background
 
şass
 
´ediùiÚs


581 (
©
 
şass
 
šdex
 0).

582 3è
num_´İo§ls
: 
An
 
št32
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
] 
»´e£Ášg
 
the


583 
numb”
 
of
 
´İo§ls
 
g’”©ed
 
by
 
the
 
RPN
. `
num_´İo§ls
` 
®lows
 
us


584 
to
 
k“p
 
Œack
 
of
 
which
 
’Œ›s
 
¬e
Ø
be
 
Œ—‹d
 
as
 
z”o
 
·ddšgs
 
ªd


585 
which
 
¬e
 
nÙ
 
sšû
 
we
 
®ways
 
·d
 
the
 
numb”
 
of
 
´İo§ls
 
to
 
be


586 `
£lf
.
max_num_´İo§ls
` 
—ch
 
image
.

587 4è
´İo§l_boxes
: 
A
 
æßt32
 
‹nsÜ
 
of
 
sh­e


588 [
b©ch_size
, 
£lf
.
max_num_´İo§ls
, 4] 
»´e£Ášg


589 
decoded
 
´İo§l
 
boundšg
 
	`boxes
 (
š
 
absŞu‹
 
coÜdš©es
).

590 5è
mask_´ediùiÚs
: (
İtiÚ®
è
a
 4-
D
 
‹nsÜ
 
w™h
 
sh­e


591 [
tÙ®_num_·dded_´İo§ls
, 
num_şas£s
, 
mask_height
, 
mask_width
]

592 
cÚššg
 
š¡ªû
 
mask
 
´ediùiÚs
.

594 
´İo§l_boxes_nÜm®ized
, 
_
, 
num_´İo§ls
 = 
£lf
.
	$_po¡´oûss_½n
(

595 
½n_box_’codšgs
, 
½n_objeùÃss_´ediùiÚs_w™h_background
,

596 
ªchÜs
, 
image_sh­e
)

598 
æ©‹Ãd_´İo§l_ã©u»_m­s
 = (

599 
£lf
.
	$_compu‹_£cÚd_¡age_šput_ã©u»_m­s
(

600 
½n_ã©u»s_to_üİ
, 
´İo§l_boxes_nÜm®ized
))

602 
box_şassif›r_ã©u»s
 = (

603 
£lf
.
_ã©u»_exŒaùÜ
.
	$exŒaù_box_şassif›r_ã©u»s
(

604 
æ©‹Ãd_´İo§l_ã©u»_m­s
,

605 
scİe
=
£lf
.
£cÚd_¡age_ã©u»_exŒaùÜ_scİe
))

607 
box_´ediùiÚs
 = 
£lf
.
_mask_rún_box_´ediùÜ
.
	$´ediù
(

608 
box_şassif›r_ã©u»s
,

609 
num_´ediùiÚs_³r_loÿtiÚ
=1,

610 
scİe
=
£lf
.
£cÚd_¡age_box_´ediùÜ_scİe
)

611 
»fšed_box_’codšgs
 = 
tf
.
	$squ“ze
(

612 
box_´ediùiÚs
[
box_´ediùÜ
.
BOX_ENCODINGS
], 
axis
=1)

613 
şass_´ediùiÚs_w™h_background
 = 
tf
.
	$squ“ze
(
box_´ediùiÚs
[

614 
box_´ediùÜ
.
CLASS_PREDICTIONS_WITH_BACKGROUND
], 
axis
=1)

616 
absŞu‹_´İo§l_boxes
 = 
İs
.
	$nÜm®ized_to_image_coÜdš©es
(

617 
´İo§l_boxes_nÜm®ized
, 
image_sh­e
, 
£lf
.
_·¿Î–_™”©iÚs
)

619 
´ediùiÚ_diù
 = {

620 '»fšed_box_’codšgs': 
»fšed_box_’codšgs
,

622 
şass_´ediùiÚs_w™h_background
,

623 'num_´İo§ls': 
num_´İo§ls
,

624 '´İo§l_boxes': 
absŞu‹_´İo§l_boxes
,

625 
	}
}

626  
´ediùiÚ_diù


628 
def
 
	$_exŒaù_½n_ã©u»_m­s
(
£lf
, 
´•roûs£d_šputs
):

631 
This
 
funùiÚ
 
exŒaùs
 
two
 
ã©u»
 
m­s
: 
a
 f—tu» 
m­
 
to
 
be
 
dœeùly


632 
ãd
 
to
 
a
 
box
 
	$´ediùÜ
 (
to
 
´ediù
 
loÿtiÚ
 
ªd
 
objeùÃss
 
scÜes
 

633 
´İo§ls
è
ªd
 
a
 
ã©u»
 
m­
 
äom
 
which
 
to
 
üİ
 
»giÚs
 which 
wl
 
th’


634 
be
 
£Á
 
to
 
the
 
£cÚd
 
¡age
 
box
 
şassif›r
.

636 
Args
:

637 
´•roûs£d_šputs
: 
a
 [
b©ch
, 
height
, 
width
, 
chªÃls
] 
image
 
‹nsÜ
.

639 
R‘uºs
:

640 
½n_box_´ediùÜ_ã©u»s
: 
A
 4-
D
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


641 [
b©ch
, 
height
, 
width
, 
d•th
] 
to
 
be
 
u£d
 
´ediùšg
 
´İo§l
 
boxes


642 
ªd
 
cÜ»¥Údšg
 
objeùÃss
 
scÜes
.

643 
½n_ã©u»s_to_üİ
: 
A
 4-
D
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


644 [
b©ch
, 
height
, 
width
, 
d•th
] 
»´e£Ášg
 
image
 
ã©u»s
 
to
 
üİ
 
usšg


645 
the
 
´İo§ls
 
boxes
.

646 
ªchÜs
: 
A
 
BoxLi¡
 
»´e£Ášg
 
	$ªchÜs
 (
the
 
RPN
è
š


647 
absŞu‹
 
coÜdš©es
.

648 
image_sh­e
: 
A
 1-
D
 
‹nsÜ
 
»´e£Ášg
 
the
 
šput
 
image
 
sh­e
.

650 
image_sh­e
 = 
tf
.
	$sh­e
(
´•roûs£d_šputs
)

651 
½n_ã©u»s_to_üİ
 = 
£lf
.
_ã©u»_exŒaùÜ
.
	$exŒaù_´İo§l_ã©u»s
(

652 
´•roûs£d_šputs
, 
scİe
=
£lf
.
fœ¡_¡age_ã©u»_exŒaùÜ_scİe
)

654 
ã©u»_m­_sh­e
 = 
tf
.
	$sh­e
(
½n_ã©u»s_to_üİ
)

655 
ªchÜs
 = 
£lf
.
_fœ¡_¡age_ªchÜ_g’”©Ü
.
	`g’”©e
(

656 [(
ã©u»_m­_sh­e
[1], feature_map_shape[2])])

657 
w™h
 
¦im
.
	$¬g_scİe
(
£lf
.
_fœ¡_¡age_box_´ediùÜ_¬g_scİe
):

658 
k”Ãl_size
 = 
£lf
.
_fœ¡_¡age_box_´ediùÜ_k”Ãl_size


659 
½n_box_´ediùÜ_ã©u»s
 = 
¦im
.
	$cÚv2d
(

660 
½n_ã©u»s_to_üİ
,

661 
£lf
.
_fœ¡_¡age_box_´ediùÜ_d•th
,

662 
k”Ãl_size
=[kernel_size, kernel_size],

663 
¿‹
=
£lf
.
_fœ¡_¡age_©rous_¿‹
,

664 
aùiv©iÚ_â
=
tf
.
Â
.
»lu6
)

665  (
½n_box_´ediùÜ_ã©u»s
, 
½n_ã©u»s_to_üİ
,

666 
ªchÜs
, 
image_sh­e
)

668 
def
 
	$_´ediù_½n_´İo§ls
(
£lf
, 
½n_box_´ediùÜ_ã©u»s
):

671 
NÙe
 
»suÉšg
 
‹nsÜs
 
wl
 
nÙ
 
have
 
b“n
 
po¡´oûs£d
.

673 
Args
:

674 
½n_box_´ediùÜ_ã©u»s
: 
A
 4-
D
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


675 [
b©ch
, 
height
, 
width
, 
d•th
] 
to
 
be
 
u£d
 
´ediùšg
 
´İo§l
 
boxes


676 
ªd
 
cÜ»¥Údšg
 
objeùÃss
 
scÜes
.

678 
R‘uºs
:

679 
box_’codšgs
: 3-
D
 
‹nsÜ
 
of
 
sh­e


680 [
b©ch_size
, 
num_ªchÜs
, 
£lf
.
_box_cod”
.
code_size
] 
cÚššg


681 
´ediùed
 
boxes
.

682 
objeùÃss_´ediùiÚs_w™h_background
: 3-
D
 
‹nsÜ
 
of
 
sh­e


683 [
b©ch_size
, 
num_ªchÜs
, 2] 
cÚššg
 
şass


684 
	$´ediùiÚs
 (
log™s
è
—ch
 
of
 
the
 
ªchÜs
. 
NÙe
 
th©
 
this


685 
‹nsÜ
 *
šşudes
* 
background
 
şass
 
	`´ediùiÚs
 (
©
 cÏs 
šdex
 0).

687 
Rai£s
:

688 
RuÁimeE¼Ü
: 
the
 
ªchÜ
 
g’”©Ü
 
g’”©es
 
ªchÜs
 
cÜ»¥Údšg
 
to


689 
muÉË
 
ã©u»
 
m­s
. 
We
 
cu¼’y
 
assume
 
th©
 
a
 
sšgË
 f—tu» 
m­


690 
is
 
g’”©ed
 
the
 
RPN
.

692 
num_ªchÜs_³r_loÿtiÚ
 = (

693 
£lf
.
_fœ¡_¡age_ªchÜ_g’”©Ü
.
	$num_ªchÜs_³r_loÿtiÚ
())

694 
	`Ën
(
num_ªchÜs_³r_loÿtiÚ
) != 1:

695 
¿i£
 
	`RuÁimeE¼Ü
('anchor_generator isƒxpectedo generate‡nchors '

697 
box_´ediùiÚs
 = 
£lf
.
_fœ¡_¡age_box_´ediùÜ
.
	$´ediù
(

698 
½n_box_´ediùÜ_ã©u»s
,

699 
num_ªchÜs_³r_loÿtiÚ
[0],

700 
scİe
=
£lf
.
fœ¡_¡age_box_´ediùÜ_scİe
)

702 
box_’codšgs
 = 
box_´ediùiÚs
[
box_´ediùÜ
.
BOX_ENCODINGS
]

703 
objeùÃss_´ediùiÚs_w™h_background
 = 
box_´ediùiÚs
[

704 
box_´ediùÜ
.
CLASS_PREDICTIONS_WITH_BACKGROUND
]

705  (
tf
.
	`squ“ze
(
box_’codšgs
, 
axis
=2),

706 
objeùÃss_´ediùiÚs_w™h_background
)

708 
def
 
	$_»move_šv®id_ªchÜs_ªd_´ediùiÚs
(

709 
£lf
,

710 
box_’codšgs
,

711 
objeùÃss_´ediùiÚs_w™h_background
,

712 
ªchÜs_boxli¡
,

713 
ş_wšdow
):

716 
Also
 
»moves
 
assocŸ‹d
 
box
 
’codšgs
 
ªd
 
objeùÃss
 
´ediùiÚs
.

718 
Args
:

719 
box_’codšgs
: 3-
D
 
‹nsÜ
 
of
 
sh­e


720 [
b©ch_size
, 
num_ªchÜs
, 
£lf
.
_box_cod”
.
code_size
] 
cÚššg


721 
´ediùed
 
boxes
.

722 
objeùÃss_´ediùiÚs_w™h_background
: 3-
D
 
‹nsÜ
 
of
 
sh­e


723 [
b©ch_size
, 
num_ªchÜs
, 2] 
cÚššg
 
şass


724 
	$´ediùiÚs
 (
log™s
è
—ch
 
of
 
the
 
ªchÜs
. 
NÙe
 
th©
 
this


725 
‹nsÜ
 *
šşudes
* 
background
 
şass
 
	`´ediùiÚs
 (
©
 cÏs 
šdex
 0).

726 
ªchÜs_boxli¡
: 
A
 
BoxLi¡
 
»´e£Ášg
 
num_ªchÜs
 
	$ªchÜs
 (
the
 
RPN
)

727 
š
 
absŞu‹
 
coÜdš©es
.

728 
ş_wšdow
: 
a
 1-
D
 
‹nsÜ
 
»´e£Ášg
 
the
 [
ymš
, 
xmš
, 
ymax
, 
xmax
]

729 
ex‹Á
 
of
 
the
 
wšdow
 
to
 
ş
/
´uÃ
o.

731 
R‘uºs
:

732 
box_’codšgs
: 4-
D
 
‹nsÜ
 
of
 
sh­e


733 [
b©ch_size
, 
num_v®id_ªchÜs
, 
£lf
.
_box_cod”
.
code_size
] 
cÚššg


734 
´ediùed
 
boxes
, 
wh”e
 
num_v®id_ªchÜs
 <ğ
num_ªchÜs


735 
objeùÃss_´ediùiÚs_w™h_background
: 2-
D
 
‹nsÜ
 
of
 
sh­e


736 [
b©ch_size
, 
num_v®id_ªchÜs
, 2] 
cÚššg
 
şass


737 
	$´ediùiÚs
 (
log™s
è
—ch
 
of
 
the
 
ªchÜs
, 
wh”e


738 
num_v®id_ªchÜs
 <ğ
num_ªchÜs
. 
NÙe
 
th©
 
this


739 
‹nsÜ
 *
šşudes
* 
background
 
şass
 
	`´ediùiÚs
 (
©
 cÏs 
šdex
 0).

740 
ªchÜs
: 
A
 
BoxLi¡
 
»´e£Ášg
 
num_v®id_ªchÜs
 
	$ªchÜs
 (
the
 
RPN
è
š


741 
absŞu‹
 
coÜdš©es
.

743 
´uÃd_ªchÜs_boxli¡
, 
k“p_šdiûs
 = 
box_li¡_İs
.
	$´uÃ_outside_wšdow
(

744 
ªchÜs_boxli¡
, 
ş_wšdow
)

745 
def
 
	$_b©ch_g©h”_k•t_šdiûs
(
´ediùiÚs_‹nsÜ
):

746  
tf
.
	`m­_â
(

747 
	`·¹Ÿl
(
tf
.
g©h”
, 
šdiûs
=
k“p_šdiûs
),

748 
–ems
=
´ediùiÚs_‹nsÜ
,

749 
dty³
=
tf
.
æßt32
,

750 
·¿Î–_™”©iÚs
=
£lf
.
_·¿Î–_™”©iÚs
,

751 
back_´İ
=
True
)

752  (
	`_b©ch_g©h”_k•t_šdiûs
(
box_’codšgs
),

753 
	`_b©ch_g©h”_k•t_šdiûs
(
objeùÃss_´ediùiÚs_w™h_background
),

754 
´uÃd_ªchÜs_boxli¡
)

756 
def
 
	$_æ©‹n_fœ¡_two_dim’siÚs
(
£lf
, 
šputs
):

759 
CÚv”ts
 `
šputs
` 
w™h
 
sh­e
 [
A
, 
B
, ..., 
d•th
] 
što
 
a
 
‹nsÜ
 
of
 shape

760 [
A
 * 
B
, ..., 
d•th
].

762 
Args
:

763 
šputs
: 
A
 
‹nsÜ
 
w™h
 
sh­e
 [A, 
B
, ..., 
d•th
]. 
NÙe
 
th©
 
the
 
fœ¡


764 
two
 
ªd
 
Ï¡
 
dim’siÚs
 
mu¡
 
be
 
¡©iÿÎy
 
defšed
.

765 
R‘uºs
:

766 
A
 
‹nsÜ
 
w™h
 
sh­e
 [A * 
B
, ..., 
d•th
] (
wh”e
 
the
 
fœ¡
 
ªd
 
Ï¡


767 
dim’siÚ
 
¬e
 
¡©iÿÎy
 
defšed
.

769 
combšed_sh­e
 = 
sh­e_uts
.
	$combšed_¡©ic_ªd_dyÇmic_sh­e
(
šputs
)

770 
æ©‹Ãd_sh­e
 = 
tf
.
	`¡ack
([
combšed_sh­e
[0] * combined_shape[1]] +

771 
combšed_sh­e
[2:])

772  
tf
.
	$»sh­e
(
šputs
, 
æ©‹Ãd_sh­e
)

774 
def
 
	$po¡´oûss
(
£lf
, 
´ediùiÚ_diù
):

777 
This
 
funùiÚ
 
cÚv”ts
 
¿w
 
´ediùiÚs
 
‹nsÜs
 
to
 
fš®
 
d‘eùiÚ
 
»suÉs
.

778 
S“
 
ba£
 
şass
 
ouut
 
fÜm©
 
cÚv’tiÚs
. 
NÙe
 
®so
 
th©
 
by
 ,

779 
scÜes
 
¬e
 
to
 
be
 
š‹½»‹d
 
as
 
log™s
, 
but
 
a
 
scÜe_cÚv”‹r
 
is
 
u£d
,

780 
th’
 
scÜes
 
¬e
 
	`»m­³d
 (
ªd
 
may
 
thus
 
have
 
a
 
difã»Á
 
š‹½»tiÚ
).

782 
If
 
fœ¡_¡age_Úly
=
True
, 
the
 
»tuºed
 
»suÉs
 
»´e£Á
 
´İo§ls
 
äom
he

783 
fœ¡
 
¡age
 
RPN
 
ªd
 
¬e
 
·dded
 
to
 
have
 
£lf
.
max_num_´İo§ls
 
—ch


784 
image
; 
Ùh”wi£
, 
the
 
»suÉs
 
ÿn
 
be
 
š‹½»‹d
 
as
 
muÉişass
 
d‘eùiÚs


785 
äom
 
the
 
fuÎ
 
two
-
¡age
 
mod–
 
ªd
 
¬e
 
·dded
 
to
 
£lf
.
_max_d‘eùiÚs
.

787 
Args
:

788 
´ediùiÚ_diù
: 
a
 
diùiÚ¬y
 
hŞdšg
 
´ediùiÚ
 
	`‹nsÜs
 (
£e
 
the


789 
docum’tiÚ
 
the
 
´ediù
 
m‘hod
. 
If
 
fœ¡_¡age_Úly
=
True
, 
we


790 
ex³ù
 
´ediùiÚ_diù
 
to
 
cÚš
 `
½n_box_’codšgs
`,

791 `
½n_objeùÃss_´ediùiÚs_w™h_background
`, `
½n_ã©u»s_to_üİ
`,

792 `
image_sh­e
`, 
ªd
 `
ªchÜs
` 
f›lds
. 
Oth”wi£
 
we
 
ex³ù


793 
´ediùiÚ_diù
 
to
 
add™iÚ®ly
 
cÚš
 `
»fšed_box_’codšgs
`,

794 `
şass_´ediùiÚs_w™h_background
`, `
num_´İo§ls
`,

795 `
´İo§l_boxes
` 
ªd
, 
İtiÚ®ly
, `
mask_´ediùiÚs
` 
f›lds
.

797 
R‘uºs
:

798 
d‘eùiÚs
: 
a
 
diùiÚ¬y
 
cÚššg
 
the
 
fŞlowšg
 
f›lds


799 
d‘eùiÚ_boxes
: [
b©ch
, 
max_d‘eùiÚ
, 4]

800 
d‘eùiÚ_scÜes
: [
b©ch
, 
max_d‘eùiÚs
]

801 
d‘eùiÚ_şas£s
: [
b©ch
, 
max_d‘eùiÚs
]

802 (
this
 
’Œy
 
is
 
Úly
 
ü—‹d
 
½n_mode
=
F®£
)

803 
num_d‘eùiÚs
: [
b©ch
]

805 
w™h
 
tf
.
	`Çme_scİe
('FirstStagePostprocessor'):

806 
image_sh­e
 = 
´ediùiÚ_diù
['image_shape']

807 
£lf
.
_fœ¡_¡age_Úly
:

808 
´İo§l_boxes
, 
´İo§l_scÜes
, 
num_´İo§ls
 = 
£lf
.
	`_po¡´oûss_½n
(

809 
´ediùiÚ_diù
['rpn_box_encodings'],

810 
´ediùiÚ_diù
['rpn_objectness_predictions_with_background'],

811 
´ediùiÚ_diù
['anchors'],

812 
image_sh­e
)

814 'd‘eùiÚ_boxes': 
´İo§l_boxes
,

815 'd‘eùiÚ_scÜes': 
´İo§l_scÜes
,

816 'num_d‘eùiÚs': 
num_´İo§ls


817 
	}
}

818 
w™h
 
tf
.
Çme_scİe
('SecondStagePostprocessor'):

819 
mask_´ediùiÚs
 = 
´ediùiÚ_diù
.
	$g‘
(
box_´ediùÜ
.
MASK_PREDICTIONS
)

820 
d‘eùiÚs_diù
 = 
£lf
.
	`_po¡´oûss_box_şassif›r
(

821 
´ediùiÚ_diù
['refined_box_encodings'],

822 
´ediùiÚ_diù
['class_predictions_with_background'],

823 
´ediùiÚ_diù
['proposal_boxes'],

824 
´ediùiÚ_diù
['num_proposals'],

825 
image_sh­e
,

826 
mask_´ediùiÚs
=mask_predictions)

827  
d‘eùiÚs_diù


829 
def
 
	$_po¡´oûss_½n
(
£lf
,

830 
½n_box_’codšgs_b©ch
,

831 
½n_objeùÃss_´ediùiÚs_w™h_background_b©ch
,

832 
ªchÜs
,

833 
image_sh­e
):

836 
This
 
funùiÚ
 
decodes
 
the
 
¿w
 
RPN
 
´ediùiÚs
, 
runs
 
nÚ
-
max
 
suµ»ssiÚ


837 
Ú
 
the
 
»suÉ
.

839 
NÙe
 
th©
 
the
 
behaviÜ
 
of
 
this
 
funùiÚ
 
is
 
¦ighy
 
modif›d
 
duršg


840 
Œaššg
 --- 
¥ecifiÿÎy
, 
we
 
¡İ
 
the
 
g¿d›Á
 
äom
 
·ssšg
 
through
he

841 
´İo§l
 
boxes
 
ªd
 
we
 
Úly
  
a
 
b®ªûd
 
§m¶ed
 
sub£t
 
of
 
´İo§ls


842 
w™h
 
size
 `
£cÚd_¡age_b©ch_size
`.

844 
Args
:

845 
½n_box_’codšgs_b©ch
: 
A
 3-
D
 
æßt32
 
‹nsÜ
 
of
 
sh­e


846 [
b©ch_size
, 
num_ªchÜs
, 
£lf
.
_box_cod”
.
code_size
] 
cÚššg


847 
´ediùed
 
´İo§l
 
box
 
’codšgs
.

848 
½n_objeùÃss_´ediùiÚs_w™h_background_b©ch
: 
A
 3-
D
 
‹nsÜ
 
of


849 
sh­e
 [
b©ch_size
, 
num_ªchÜs
, 2] 
cÚššg
 
objeùÃss
 
´ediùiÚs


850 (
log™s
è
—ch
 
of
 
the
 
ªchÜs
 
w™h
 0 
cÜ»¥Údšg
 
to
 
background


851 
ªd
 1 
cÜ»¥Údšg
 
to
 
objeù
.

852 
ªchÜs
: 
A
 2-
D
 
‹nsÜ
 
of
 
sh­e
 [
num_ªchÜs
, 4] 
»´e£Ášg
‡nchors

853 
the
 
fœ¡
 
¡age
 
RPN
. 
NÙe
 
th©
 `
num_ªchÜs
` 
ÿn
 
difãr
 
d•’dšg


854 
Ú
 
wh‘h”
 
the
 
mod–
 
is
 
ü—‹d
 
š
 
Œaššg
 
Ü
 
šã»nû
 
mode
.

855 
image_sh­e
: 
A
 1-
D
 
‹nsÜ
 
»´e£Ášg
 
the
 
šput
 
image
 
sh­e
.

857 
R‘uºs
:

858 
´İo§l_boxes
: 
A
 
‹nsÜ
 
w™h
 
sh­e


859 [
b©ch_size
, 
max_num_´İo§ls
, 4] 
»´e£Ášg
 
	$the
 (
pÙ’tŸÎy
 
z”o


860 
·dded
è
´İo§l
 
boxes
 
®l
 
images
 
š
 
the
 
b©ch
. 
The£
 boxe 
¬e


861 
»´e£Áed
 
as
 
nÜm®ized
 
coÜdš©es
.

862 
´İo§l_scÜes
: 
A
 
‹nsÜ
 
w™h
 
sh­e


863 [
b©ch_size
, 
max_num_´İo§ls
] 
»´e£Ášg
 
	$the
 (
pÙ’tŸÎy
 
z”o


864 
·dded
è
´İo§l
 
objeùÃss
 
scÜes
 
®l
 
images
 
š
 
the
 
b©ch
.

865 
num_´İo§ls
: 
A
 
T’sÜ
 
of
 
ty³
 `
št32
`. A 1-
D
 
‹nsÜ
 oà
sh­e
 [
b©ch
]

866 
»´e£Ášg
 
the
 
numb”
 
of
 
´İo§ls
 
´ediùed
 
—ch
 
image
 
š


867 
the
 
b©ch
.

869 
½n_box_’codšgs_b©ch
 = 
tf
.
	$ex·nd_dims
(
½n_box_’codšgs_b©ch
, 
axis
=2)

870 
½n_’codšgs_sh­e
 = 
sh­e_uts
.
	$combšed_¡©ic_ªd_dyÇmic_sh­e
(

871 
½n_box_’codšgs_b©ch
)

872 
ted_ªchÜ_boxes
 = 
tf
.
	`te
(

873 
tf
.
	`ex·nd_dims
(
ªchÜs
, 0), [
½n_’codšgs_sh­e
[0], 1, 1])

874 
´İo§l_boxes
 = 
£lf
.
	$_b©ch_decode_boxes
(
½n_box_’codšgs_b©ch
,

875 
ted_ªchÜ_boxes
)

876 
´İo§l_boxes
 = 
tf
.
	$squ“ze
(
´İo§l_boxes
, 
axis
=2)

877 
½n_objeùÃss_soámax_w™hout_background
 = 
tf
.
Â
.
	`soámax
(

878 
½n_objeùÃss_´ediùiÚs_w™h_background_b©ch
)[:, :, 1]

879 
ş_wšdow
 = 
tf
.
	`to_æßt
Ñf.
	$¡ack
([0, 0, 
image_sh­e
[1], image_shape[2]]))

880 (
´İo§l_boxes
, 
´İo§l_scÜes
, 
_
, _,

881 
num_´İo§ls
èğ
po¡_´oûssšg
.
	`b©ch_muÉişass_nÚ_max_suµ»ssiÚ
(

882 
tf
.
	`ex·nd_dims
(
´İo§l_boxes
, 
axis
=2),

883 
tf
.
	`ex·nd_dims
(
½n_objeùÃss_soámax_w™hout_background
,

884 
axis
=2),

885 
£lf
.
_fœ¡_¡age_nms_scÜe_th»shŞd
,

886 
£lf
.
_fœ¡_¡age_nms_iou_th»shŞd
,

887 
£lf
.
_fœ¡_¡age_max_´İo§ls
,

888 
£lf
.
_fœ¡_¡age_max_´İo§ls
,

889 
ş_wšdow
=clip_window)

890 
£lf
.
_is_Œaššg
:

891 
´İo§l_boxes
 = 
tf
.
	$¡İ_g¿d›Á
(
´İo§l_boxes
)

892 
nÙ
 
£lf
.
_h¬d_exam¶e_mš”
:

893 (
groundŒuth_boxli¡s
, 
groundŒuth_şas£s_w™h_background_li¡
,

894 èğ
£lf
.
	$_fÜm©_groundŒuth_d©a
(
image_sh­e
)

895 (
´İo§l_boxes
, 
´İo§l_scÜes
,

896 
num_´İo§ls
èğ
£lf
.
	$_uÅad_´İo§ls_ªd_§m¶e_box_şassif›r_b©ch
(

897 
´İo§l_boxes
, 
´İo§l_scÜes
, 
num_´İo§ls
,

898 
groundŒuth_boxli¡s
, 
groundŒuth_şas£s_w™h_background_li¡
)

899 #nÜm®iz
´İo§l
 
boxes


900 
´İo§l_boxes_»sh­ed
 = 
tf
.
	`»sh­e
(
´İo§l_boxes
, [-1, 4])

901 
nÜm®ized_´İo§l_boxes_»sh­ed
 = 
box_li¡_İs
.
	`to_nÜm®ized_coÜdš©es
(

902 
box_li¡
.
	`BoxLi¡
(
´İo§l_boxes_»sh­ed
),

903 
image_sh­e
[1], image_sh­e[2], 
check_¿nge
=
F®£
).
	$g‘
()

904 
´İo§l_boxes
 = 
tf
.
	`»sh­e
(
nÜm®ized_´İo§l_boxes_»sh­ed
,

905 [-1, 
´İo§l_boxes
.
sh­e
[1].
v®ue
, 4])

906  
´İo§l_boxes
, 
´İo§l_scÜes
, 
num_´İo§ls


908 
def
 
	$_uÅad_´İo§ls_ªd_§m¶e_box_şassif›r_b©ch
(

909 
£lf
,

910 
´İo§l_boxes
,

911 
´İo§l_scÜes
,

912 
num_´İo§ls
,

913 
groundŒuth_boxli¡s
,

914 
groundŒuth_şas£s_w™h_background_li¡
):

917 
Args
:

918 
´İo§l_boxes
: 
A
 
‹nsÜ
 
w™h
 
sh­e


919 [
b©ch_size
, 
num_´İo§ls
, 4] 
»´e£Ášg
 
	$the
 (
pÙ’tŸÎy
 
z”o


920 
·dded
è
´İo§l
 
boxes
 
®l
 
images
 
š
 
the
 
b©ch
. 
The£
 boxe 
¬e


921 
»´e£Áed
 
as
 
nÜm®ized
 
coÜdš©es
.

922 
´İo§l_scÜes
: 
A
 
‹nsÜ
 
w™h
 
sh­e


923 [
b©ch_size
, 
num_´İo§ls
] 
»´e£Ášg
 
	$the
 (
pÙ’tŸÎy
 
z”o


924 
·dded
è
´İo§l
 
objeùÃss
 
scÜes
 
®l
 
images
 
š
 
the
 
b©ch
.

925 
num_´İo§ls
: 
A
 
T’sÜ
 
of
 
ty³
 `
št32
`. A 1-
D
 
‹nsÜ
 oà
sh­e
 [
b©ch
]

926 
»´e£Ášg
 
the
 
numb”
 
of
 
´İo§ls
 
´ediùed
 
—ch
 
image
 
š


927 
the
 
b©ch
.

928 
groundŒuth_boxli¡s
: 
A
 
li¡
 
of
 
BoxLi¡s
 
	$cÚššg
 (
absŞu‹
è
coÜdš©es


929 
of
 
the
 
groundŒuth
 
boxes
.

930 
groundŒuth_şas£s_w™h_background_li¡
: 
A
 
li¡
 
of
 2-
D
 
Úe
-
hÙ


931 (
Ü
 
k
-
hÙ
è
‹nsÜs
 
of
 
sh­e
 [
num_boxes
, 
num_şas£s
+1] 
cÚššg
 
the


932 
şass
 
rg‘s
 
w™h
 
the
 0
th
 
šdex
 
assumed
 
to
 
m­
Øth
background
 class.

934 
R‘uºs
:

935 
´İo§l_boxes
: 
A
 
‹nsÜ
 
w™h
 
sh­e


936 [
b©ch_size
, 
£cÚd_¡age_b©ch_size
, 4] 
»´e£Ášg
 
	$the
 (
pÙ’tŸÎy


937 
z”o
 
·dded
è
´İo§l
 
boxes
 
®l
 
images
 
š
 
the
 
b©ch
. 
The£
 boxes

938 
¬e
 
»´e£Áed
 
as
 
nÜm®ized
 
coÜdš©es
.

939 
´İo§l_scÜes
: 
A
 
‹nsÜ
 
w™h
 
sh­e


940 [
b©ch_size
, 
£cÚd_¡age_b©ch_size
] 
»´e£Ášg
 
	$the
 (
pÙ’tŸÎy
 
z”o


941 
·dded
è
´İo§l
 
objeùÃss
 
scÜes
 
®l
 
images
 
š
 
the
 
b©ch
.

942 
num_´İo§ls
: 
A
 
T’sÜ
 
of
 
ty³
 `
št32
`. A 1-
D
 
‹nsÜ
 oà
sh­e
 [
b©ch
]

943 
»´e£Ášg
 
the
 
numb”
 
of
 
´İo§ls
 
´ediùed
 
—ch
 
image
 
š


944 
the
 
b©ch
.

946 
sšgË_image_´İo§l_box_§m¶e
 = []

947 
sšgË_image_´İo§l_scÜe_§m¶e
 = []

948 
sšgË_image_num_´İo§ls_§m¶e
 = []

949 
sšgË_image_´İo§l_boxes
,

950 
sšgË_image_´İo§l_scÜes
,

951 
sšgË_image_num_´İo§ls
,

952 
sšgË_image_groundŒuth_boxli¡
,

953 
sšgË_image_groundŒuth_şas£s_w™h_background
è
š
 
	`z
(

954 
tf
.
	`un¡ack
(
´İo§l_boxes
),

955 
tf
.
	`un¡ack
(
´İo§l_scÜes
),

956 
tf
.
	`un¡ack
(
num_´İo§ls
),

957 
groundŒuth_boxli¡s
,

958 
groundŒuth_şas£s_w™h_background_li¡
):

959 
¡©ic_sh­e
 = 
sšgË_image_´İo§l_boxes
.
	$g‘_sh­e
()

960 
¦iûd_¡©ic_sh­e
 = 
tf
.
	`T’sÜSh­e
([tf.
	`Dim’siÚ
(
NÚe
),

961 
¡©ic_sh­e
.
dims
[-1]])

962 
sšgË_image_´İo§l_boxes
 = 
tf
.
	`¦iû
(

963 
sšgË_image_´İo§l_boxes
,

965 [
sšgË_image_num_´İo§ls
, -1])

966 
sšgË_image_´İo§l_boxes
.
	$£t_sh­e
(
¦iûd_¡©ic_sh­e
)

968 
sšgË_image_´İo§l_scÜes
 = 
tf
.
	$¦iû
(
sšgË_image_´İo§l_scÜes
,

970 [
sšgË_image_num_´İo§ls
])

971 
sšgË_image_boxli¡
 = 
box_li¡
.
	$BoxLi¡
(
sšgË_image_´İo§l_boxes
)

972 
sšgË_image_boxli¡
.
	$add_f›ld
(
f›lds
.
BoxLi¡F›lds
.
scÜes
,

973 
sšgË_image_´İo§l_scÜes
)

974 
§m¶ed_boxli¡
 = 
£lf
.
	$_§m¶e_box_şassif›r_mšib©ch
(

975 
sšgË_image_boxli¡
,

976 
sšgË_image_groundŒuth_boxli¡
,

977 
sšgË_image_groundŒuth_şas£s_w™h_background
)

978 
§m¶ed_·dded_boxli¡
 = 
box_li¡_İs
.
	$·d_Ü_ş_box_li¡
(

979 
§m¶ed_boxli¡
,

980 
num_boxes
=
£lf
.
_£cÚd_¡age_b©ch_size
)

981 
sšgË_image_num_´İo§ls_§m¶e
.
	`­³nd
(
tf
.
	`mšimum
(

982 
§m¶ed_boxli¡
.
	`num_boxes
(),

983 
£lf
.
_£cÚd_¡age_b©ch_size
))

984 
bb
 = 
§m¶ed_·dded_boxli¡
.
	$g‘
()

985 
sšgË_image_´İo§l_box_§m¶e
.
	$­³nd
(
bb
)

986 
sšgË_image_´İo§l_scÜe_§m¶e
.
	`­³nd
(

987 
§m¶ed_·dded_boxli¡
.
	$g‘_f›ld
(
f›lds
.
BoxLi¡F›lds
.
scÜes
))

988  (
tf
.
	`¡ack
(
sšgË_image_´İo§l_box_§m¶e
),

989 
tf
.
	`¡ack
(
sšgË_image_´İo§l_scÜe_§m¶e
),

990 
tf
.
	$¡ack
(
sšgË_image_num_´İo§ls_§m¶e
))

992 
def
 
	$_fÜm©_groundŒuth_d©a
(
£lf
, 
image_sh­e
):

995 
In
 
Üd”
 
to
 
be
 
cÚsi¡’t
 
w™h
 
the
 
mod–
.
D‘eùiÚMod–
 
š‹rçû
,

996 
groundŒuth
 
boxes
 
¬e
 
¥ecif›d
 
š
 
nÜm®ized
 
coÜdš©es
 
ªd
 
şas£s
‡re

997 
¥ecif›d
 
as
 
Ïb–
 
šdiûs
 
w™h
 
no
 
assumed
 
background
 
ÿ‹gÜy
. 
To
 
´•¬e


998 
rg‘
 
assignm’t
, 
we
:

999 1è
cÚv”t
 
boxes
 
to
 
absŞu‹
 
coÜdš©es
,

1000 2è
add
 
a
 
background
 
şass
 
©
 cÏs 
šdex
 0

1002 
Args
:

1003 
image_sh­e
: 
A
 1-
D
 
št32
 
‹nsÜ
 
of
 
sh­e
 [4] 
»´e£Ášg
 
the
 shape ofhe

1004 
šput
 
image
 
b©ch
.

1006 
R‘uºs
:

1007 
groundŒuth_boxli¡s
: 
A
 
li¡
 
of
 
BoxLi¡s
 
	$cÚššg
 (
absŞu‹
è
coÜdš©es


1008 
of
 
the
 
groundŒuth
 
boxes
.

1009 
groundŒuth_şas£s_w™h_background_li¡
: 
A
 
li¡
 
of
 2-
D
 
Úe
-
hÙ


1010 (
Ü
 
k
-
hÙ
è
‹nsÜs
 
of
 
sh­e
 [
num_boxes
, 
num_şas£s
+1] 
cÚššg
 
the


1011 
şass
 
rg‘s
 
w™h
 
the
 0
th
 
šdex
 
assumed
 
to
 
m­
Øth
background
 class.

1013 
groundŒuth_boxli¡s
 = [

1014 
box_li¡_İs
.
	`to_absŞu‹_coÜdš©es
(

1015 
box_li¡
.
	`BoxLi¡
(
boxes
), 
image_sh­e
[1], image_shape[2])

1016 
boxes
 
š
 
£lf
.
	`groundŒuth_li¡s
(
f›lds
.
BoxLi¡F›lds
.boxes)]

1017 
groundŒuth_şas£s_w™h_background_li¡
 = [

1018 
tf
.
	`to_æßt
(

1019 
tf
.
	`·d
(
Úe_hÙ_’codšg
, [[0, 0], [1, 0]], 
mode
='CONSTANT'))

1020 
Úe_hÙ_’codšg
 
š
 
£lf
.
	`groundŒuth_li¡s
(

1021 
f›lds
.
BoxLi¡F›lds
.
şas£s
)]

1022  
groundŒuth_boxli¡s
, 
groundŒuth_şas£s_w™h_background_li¡


1024 
def
 
	$_§m¶e_box_şassif›r_mšib©ch
(
£lf
,

1025 
´İo§l_boxli¡
,

1026 
groundŒuth_boxli¡
,

1027 
groundŒuth_şas£s_w™h_background
):

1030 
H–³r
 
funùiÚ
 
£lf
.
_po¡´oûss_½n
.

1032 
Args
:

1033 
´İo§l_boxli¡
: 
A
 
BoxLi¡
 
cÚššg
 
K
 
´İo§l
 
boxes
 
š
 
absŞu‹


1034 
coÜdš©es
.

1035 
groundŒuth_boxli¡
: 
A
 
Boxli¡
 
cÚššg
 
N
 
groundŒuth
 
objeù
 
boxes
 
š


1036 
absŞu‹
 
coÜdš©es
.

1037 
groundŒuth_şas£s_w™h_background
: 
A
 
‹nsÜ
 
w™h
 
sh­e


1038 `[
N
, 
£lf
.
num_şas£s
 + 1]` 
»´e£Ášg
 
groundŒuth
 
şas£s
. 
The


1039 
şas£s
 
¬e
 
assumed
 
to
 
be
 
k
-
hÙ
 
’coded
, 
ªd
 
šşude
 
background
 
as
 
the


1040 
z”o
-
th
 
şass
.

1042 
R‘uºs
:

1043 
a
 
BoxLi¡
 
cÚšed
 
§m¶ed
 
´İo§ls
.

1045 (
şs_rg‘s
, 
şs_weights
, 
_
, _, _èğ
£lf
.
_d‘eùÜ_rg‘_assigÃr
.
	$assign
(

1046 
´İo§l_boxli¡
, 
groundŒuth_boxli¡
,

1047 
groundŒuth_şas£s_w™h_background
)

1048 #S–eù 
®l
 
boxes
 
as
 
ÿndid©es
 
nÚe
 
of
 
them
 
is
 
£Ëùed
 
accÜdšg


1049 #tØ
şs_weights
. 
This
 
could
 
h­³n
 
as
 
boxes
 
w™hš
 
û¹aš
 
IOU
 
¿nges


1050 #¬
ignÜed
. 
If
 
Œigg”ed
, 
the
 
£Ëùed
 
boxes
 
wl
 
¡l
 
be
 ignored

1051 #duršg 
loss
 
computiÚ
.

1052 
şs_weights
 +ğ
tf
.
	`to_æßt
Ñf.
	`equ®
Ñf.
	`»duû_sum
(cls_weights), 0))

1053 
pos™ive_šdiÿtÜ
 = 
tf
.
	`g»©”
Ñf.
	`¬gmax
(
şs_rg‘s
, 
axis
=1), 0)

1054 
§m¶ed_šdiûs
 = 
£lf
.
_£cÚd_¡age_§m¶”
.
	`sub§m¶e
(

1055 
tf
.
	`ÿ¡
(
şs_weights
,f.
boŞ
),

1056 
£lf
.
_£cÚd_¡age_b©ch_size
,

1057 
pos™ive_šdiÿtÜ
)

1058  
box_li¡_İs
.
	$boŞ—n_mask
(
´İo§l_boxli¡
, 
§m¶ed_šdiûs
)

1060 
def
 
	$_compu‹_£cÚd_¡age_šput_ã©u»_m­s
(
£lf
, 
ã©u»s_to_üİ
,

1061 
´İo§l_boxes_nÜm®ized
):

1064 
H–³r
 
funùiÚ
 
£lf
.
_po¡´oûss_½n
. 
This
 funùiÚ 
ÿÎs


1065 `
tf
.
image
.
üİ_ªd_»size
` 
to
 
ü—‹
 
the
 
ã©u»
 
m­
Ø
be
 
·s£d
ohe

1066 
£cÚd
 
¡age
 
box
 
şassif›r
 
—ch
 
´İo§l
.

1068 
Args
:

1069 
ã©u»s_to_üİ
: 
A
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


1070 [
b©ch_size
, 
height
, 
width
, 
d•th
]

1071 
´İo§l_boxes_nÜm®ized
: 
A
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
b©ch_size
,

1072 
num_´İo§ls
, 
box_code_size
] 
cÚššg
 
´İo§l
 
boxes
 
š


1073 
nÜm®ized
 
coÜdš©es
.

1075 
R‘uºs
:

1076 
A
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e
 [
K
, 
Ãw_height
, 
Ãw_width
, 
d•th
].

1078 
def
 
	$g‘_box_šds
(
´İo§ls
):

1079 
´İo§ls_sh­e
 = 
´İo§ls
.
	`g‘_sh­e
().
	$as_li¡
()

1080 
	$ªy
(
dim
 
is
 
NÚe
 dim 
š
 
´İo§ls_sh­e
):

1081 
´İo§ls_sh­e
 = 
tf
.
	$sh­e
(
´İo§ls
)

1082 
Úes_m©
 = 
tf
.
	$Úes
(
´İo§ls_sh­e
[:2], 
dty³
=
tf
.
št32
)

1083 
muÉl›r
 = 
tf
.
	`ex·nd_dims
(

1084 
tf
.
	`¿nge
(
¡¬t
=0, 
lim™
=
´İo§ls_sh­e
[0]), 1)

1085  
tf
.
	`»sh­e
(
Úes_m©
 * 
muÉl›r
, [-1])

1087 
üİ³d_»giÚs
 = 
tf
.
image
.
	`üİ_ªd_»size
(

1088 
ã©u»s_to_üİ
,

1089 
£lf
.
	`_æ©‹n_fœ¡_two_dim’siÚs
(
´İo§l_boxes_nÜm®ized
),

1090 
	`g‘_box_šds
(
´İo§l_boxes_nÜm®ized
),

1091 (
£lf
.
_š™Ÿl_üİ_size
, self._initial_crop_size))

1092  
¦im
.
	$max_poŞ2d
(

1093 
üİ³d_»giÚs
,

1094 [
£lf
.
_maxpoŞ_k”Ãl_size
, self._maxpool_kernel_size],

1095 
¡ride
=
£lf
.
_maxpoŞ_¡ride
)

1097 
def
 
	$_po¡´oûss_box_şassif›r
(
£lf
,

1098 
»fšed_box_’codšgs
,

1099 
şass_´ediùiÚs_w™h_background
,

1100 
´İo§l_boxes
,

1101 
num_´İo§ls
,

1102 
image_sh­e
,

1103 
mask_´ediùiÚs
=
NÚe
,

1104 
mask_th»shŞd
=0.5):

1107 
Args
:

1108 
»fšed_box_’codšgs
: 
a
 3-
D
 
‹nsÜ
 
w™h
 
sh­e


1109 [
tÙ®_num_·dded_´İo§ls
, 
num_şas£s
, 4] 
»´e£Ášg
 
´ediùed


1110 (
fš®
è
»fšed
 
box
 
’codšgs
.

1111 
şass_´ediùiÚs_w™h_background
: 
a
 3-
D
 
‹nsÜ
 
w™h
 
sh­e


1112 [
tÙ®_num_·dded_´İo§ls
, 
num_şas£s
 + 1] 
cÚššg
 
şass


1113 
	$´ediùiÚs
 (
log™s
è
—ch
 
of
 
the
 
´İo§ls
. 
NÙe
 
th©
 
this
 
‹nsÜ


1114 *
šşudes
* 
background
 
şass
 
	`´ediùiÚs
 (
©
 cÏs 
šdex
 0).

1115 
´İo§l_boxes
: [
b©ch_size
, 
£lf
.
max_num_´İo§ls
, 4] 
»´e£Ášg


1116 
decoded
 
´İo§l
 
boundšg
 
boxes
.

1117 
num_´İo§ls
: 
A
 
T’sÜ
 
of
 
ty³
 `
št32
`. A 1-
D
 
‹nsÜ
 oà
sh­e
 [
b©ch
]

1118 
»´e£Ášg
 
the
 
numb”
 
of
 
´İo§ls
 
´ediùed
 
—ch
 
image
 
š


1119 
the
 
b©ch
.

1120 
image_sh­e
: 
a
 1-
D
 
‹nsÜ
 
»´e£Ášg
 
the
 
šput
 
image
 
sh­e
.

1121 
mask_´ediùiÚs
: (
İtiÚ®
è
a
 4-
D
 
‹nsÜ
 
w™h
 
sh­e


1122 [
tÙ®_num_·dded_´İo§ls
, 
num_şas£s
, 
mask_height
, 
mask_width
]

1123 
cÚššg
 
š¡ªû
 
mask
 
´ediùiÚs
.

1124 
mask_th»shŞd
: 
a
 
sÿÏr
 
th»shŞd
 
d‘”mššg
 
which
 
mask
 
v®ues
 
¬e


1125 
rounded
 
to
 0 
Ü
 1.

1127 
R‘uºs
:

1128 
A
 
diùiÚ¬y
 
cÚššg
:

1129 `
d‘eùiÚ_boxes
`: [
b©ch
, 
max_d‘eùiÚ
, 4]

1130 `
d‘eùiÚ_scÜes
`: [
b©ch
, 
max_d‘eùiÚs
]

1131 `
d‘eùiÚ_şas£s
`: [
b©ch
, 
max_d‘eùiÚs
]

1132 `
num_d‘eùiÚs
`: [
b©ch
]

1133 `
d‘eùiÚ_masks
`:

1134 (
İtiÚ®
è[
b©ch
, 
max_d‘eùiÚs
, 
mask_height
, 
mask_width
]

1136 
»fšed_box_’codšgs_b©ch
 = 
tf
.
	`»sh­e
(
»fšed_box_’codšgs
,

1137 [-1, 
£lf
.
max_num_´İo§ls
,

1138 
£lf
.
num_şas£s
,

1139 
£lf
.
_box_cod”
.
code_size
])

1140 
şass_´ediùiÚs_w™h_background_b©ch
 = 
tf
.
	`»sh­e
(

1141 
şass_´ediùiÚs_w™h_background
,

1142 [-1, 
£lf
.
max_num_´İo§ls
, s–f.
num_şas£s
 + 1]

1144 
»fšed_decoded_boxes_b©ch
 = 
£lf
.
	$_b©ch_decode_boxes
(

1145 
»fšed_box_’codšgs_b©ch
, 
´İo§l_boxes
)

1146 
şass_´ediùiÚs_w™h_background_b©ch
 = (

1147 
£lf
.
	$_£cÚd_¡age_scÜe_cÚv”siÚ_â
(

1148 
şass_´ediùiÚs_w™h_background_b©ch
))

1149 
şass_´ediùiÚs_b©ch
 = 
tf
.
	`»sh­e
(

1150 
tf
.
	`¦iû
(
şass_´ediùiÚs_w™h_background_b©ch
,

1152 [-1, 
£lf
.
max_num_´İo§ls
, s–f.
num_şas£s
])

1153 
ş_wšdow
 = 
tf
.
	`to_æßt
Ñf.
	$¡ack
([0, 0, 
image_sh­e
[1], image_shape[2]]))

1155 
mask_´ediùiÚs_b©ch
 = 
NÚe


1156 
mask_´ediùiÚs
 
is
 
nÙ
 
NÚe
:

1157 
mask_height
 = 
mask_´ediùiÚs
.
sh­e
[2].
v®ue


1158 
mask_width
 = 
mask_´ediùiÚs
.
sh­e
[3].
v®ue


1159 
mask_´ediùiÚs_b©ch
 = 
tf
.
	`»sh­e
(

1160 
mask_´ediùiÚs
, [-1, 
£lf
.
max_num_´İo§ls
,

1161 
£lf
.
num_şas£s
, 
mask_height
, 
mask_width
])

1162 (
nm£d_boxes
, 
nm£d_scÜes
, 
nm£d_şas£s
, 
nm£d_masks
,

1163 
num_d‘eùiÚs
èğ
£lf
.
	$_£cÚd_¡age_nms_â
(

1164 
»fšed_decoded_boxes_b©ch
,

1165 
şass_´ediùiÚs_b©ch
,

1166 
ş_wšdow
=clip_window,

1167 
chªge_coÜdš©e_äame
=
True
,

1168 
num_v®id_boxes
=
num_´İo§ls
,

1169 
masks
=
mask_´ediùiÚs_b©ch
)

1170 
d‘eùiÚs
 = {'d‘eùiÚ_boxes': 
nm£d_boxes
,

1171 'd‘eùiÚ_scÜes': 
nm£d_scÜes
,

1172 'd‘eùiÚ_şas£s': 
nm£d_şas£s
,

1173 'num_d‘eùiÚs': 
tf
.
	`to_æßt
(
num_d‘eùiÚs
)
	}
}

1174 
nm£d_masks
 
is
 
nÙ
 
NÚe
:

1175 
d‘eùiÚs
['d‘eùiÚ_masks'] = 
nm£d_masks


1176 
mask_´ediùiÚs
 
is
 
nÙ
 
NÚe
:

1177 
d‘eùiÚs
['d‘eùiÚ_masks'] = 
tf
.
to_æßt
(

1178 
tf
.
g»©”_equ®
(
d‘eùiÚs
['d‘eùiÚ_masks'], 
mask_th»shŞd
))

1179  
d‘eùiÚs


1181 
def
 
	$_b©ch_decode_boxes
(
£lf
, 
box_’codšgs
, 
ªchÜ_boxes
):

1184 
Args
:

1185 
»fšed_box_’codšgs
: 
a
 3-
D
 
‹nsÜ
 
w™h
 
sh­e


1186 [
b©ch_size
, 
max_num_´İo§ls
, 
num_şas£s
, 
£lf
.
_box_cod”
.
code_size
]

1187 
»´e£Ášg
 
	$´ediùed
 (
fš®
è
»fšed
 
box
 
’codšgs
.

1188 
´İo§l_boxes
: [
b©ch_size
, 
£lf
.
max_num_´İo§ls
, 4] 
»´e£Ášg


1189 
decoded
 
´İo§l
 
boundšg
 
boxes
.

1191 
R‘uºs
:

1192 
»fšed_box_´ediùiÚs
: 
a
 [
b©ch_size
, 
max_num_´İo§ls
, 
num_şas£s
, 4]

1193 
‹nsÜ
 
	$»´e£Ášg
 (
·dded
è
»fšed
 
boundšg
 
box
 
´ediùiÚs


1194 (
—ch
 
image
 
š
 
b©ch
, 
´İo§l
 
ªd
 
şass
).

1198 
Args
:

1199 
box_’codšgs
: 
a
 4-
D
 
‹nsÜ
 
w™h
 
sh­e


1200 [
b©ch_size
, 
num_ªchÜs
, 
num_şas£s
, 
£lf
.
_box_cod”
.
code_size
]

1201 
»´e£Ášg
 
box
 
’codšgs
.

1202 
ªchÜ_boxes
: [
b©ch_size
, 
num_ªchÜs
, 4] 
»´e£Ášg


1203 
decoded
 
boundšg
 
boxes
.

1205 
R‘uºs
:

1206 
decoded_boxes
: 
a
 [
b©ch_size
, 
num_ªchÜs
, 
num_şas£s
, 4]

1207 
‹nsÜ
 
»´e£Ášg
 
boundšg
 
box
 
´ediùiÚs


1208 (
—ch
 
image
 
š
 
b©ch
, 
´İo§l
 
ªd
 
şass
).

1210 
combšed_sh­e
 = 
sh­e_uts
.
	$combšed_¡©ic_ªd_dyÇmic_sh­e
(

1211 
box_’codšgs
)

1212 
num_şas£s
 = 
combšed_sh­e
[2]

1213 
ted_ªchÜ_boxes
 = 
tf
.
	`te
(

1214 
tf
.
	`ex·nd_dims
(
ªchÜ_boxes
, 2), [1, 1, 
num_şas£s
, 1])

1215 
ted_ªchÜs_boxli¡
 = 
box_li¡
.
	`BoxLi¡
(

1216 
tf
.
	`»sh­e
(
ted_ªchÜ_boxes
, [-1, 4]))

1217 
decoded_boxes
 = 
£lf
.
_box_cod”
.
	`decode
(

1218 
tf
.
	`»sh­e
(
box_’codšgs
, [-1, 
£lf
.
_box_cod”
.
code_size
]),

1219 
ted_ªchÜs_boxli¡
)

1220  
tf
.
	`»sh­e
(
decoded_boxes
.
	`g‘
(),

1221 
tf
.
	$¡ack
([
combšed_sh­e
[0], combined_shape[1],

1222 
num_şas£s
, 4]))

1224 
def
 
	$loss
(
£lf
, 
´ediùiÚ_diù
, 
scİe
=
NÚe
):

1227 
If
 
fœ¡_¡age_Úly
=
True
, 
Úly
 
RPN
 
»Ï‹d
 
los£s
 
¬e
 
	`compu‹d
 (
i
.
e
.,

1228 `
½n_loÿliz©iÚ_loss
` 
ªd
 `
½n_objeùÃss_loss
`). 
Oth”wi£
 
®l


1229 
los£s
 
¬e
 
compu‹d
.

1231 
Args
:

1232 
´ediùiÚ_diù
: 
a
 
diùiÚ¬y
 
hŞdšg
 
´ediùiÚ
 
	`‹nsÜs
 (
£e
 
the


1233 
docum’tiÚ
 
the
 
´ediù
 
m‘hod
. 
If
 
fœ¡_¡age_Úly
=
True
, 
we


1234 
ex³ù
 
´ediùiÚ_diù
 
to
 
cÚš
 `
½n_box_’codšgs
`,

1235 `
½n_objeùÃss_´ediùiÚs_w™h_background
`, `
½n_ã©u»s_to_üİ
`,

1236 `
image_sh­e
`, 
ªd
 `
ªchÜs
` 
f›lds
. 
Oth”wi£
 
we
 
ex³ù


1237 
´ediùiÚ_diù
 
to
 
add™iÚ®ly
 
cÚš
 `
»fšed_box_’codšgs
`,

1238 `
şass_´ediùiÚs_w™h_background
`, `
num_´İo§ls
`, 
ªd


1239 `
´İo§l_boxes
` 
f›lds
.

1240 
scİe
: 
O±iÚ®
 scİ
Çme
.

1242 
R‘uºs
:

1243 
a
 
diùiÚ¬y
 
m­pšg
 
loss
 
	`keys
 (`
fœ¡_¡age_loÿliz©iÚ_loss
`,

1244 `
fœ¡_¡age_objeùÃss_loss
`, 'second_stage_localization_loss',

1245 '£cÚd_¡age_şassifiÿtiÚ_loss'è
to
 
sÿÏr
 
‹nsÜs
 
»´e£Ášg


1246 
cÜ»¥Údšg
 
loss
 
v®ues
.

1248 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'Loss', 
´ediùiÚ_diù
.
	$v®ues
()):

1249 (
groundŒuth_boxli¡s
, 
groundŒuth_şas£s_w™h_background_li¡


1250 èğ
£lf
.
	`_fÜm©_groundŒuth_d©a
(
´ediùiÚ_diù
['image_shape'])

1251 
loss_diù
 = 
£lf
.
	`_loss_½n
(

1252 
´ediùiÚ_diù
['rpn_box_encodings'],

1253 
´ediùiÚ_diù
['rpn_objectness_predictions_with_background'],

1254 
´ediùiÚ_diù
['anchors'],

1255 
groundŒuth_boxli¡s
,

1256 
groundŒuth_şas£s_w™h_background_li¡
)

1257 
nÙ
 
£lf
.
_fœ¡_¡age_Úly
:

1258 
loss_diù
.
	`upd©e
(

1259 
£lf
.
	`_loss_box_şassif›r
(

1260 
´ediùiÚ_diù
['refined_box_encodings'],

1261 
´ediùiÚ_diù
['class_predictions_with_background'],

1262 
´ediùiÚ_diù
['proposal_boxes'],

1263 
´ediùiÚ_diù
['num_proposals'],

1264 
groundŒuth_boxli¡s
,

1265 
groundŒuth_şas£s_w™h_background_li¡
))

1266  
loss_diù


1268 
def
 
	$_loss_½n
(
£lf
,

1269 
½n_box_’codšgs
,

1270 
½n_objeùÃss_´ediùiÚs_w™h_background
,

1271 
ªchÜs
,

1272 
groundŒuth_boxli¡s
,

1273 
groundŒuth_şas£s_w™h_background_li¡
):

1276 
U£s
 
£lf
.
_´İo§l_rg‘_assigÃr
 
to
 
obš
 
»g»ssiÚ
 
ªd
 
şassifiÿtiÚ


1277 
rg‘s
 
the
 
fœ¡
 
¡age
 
RPN
, 
§m¶es
 
a
 "mšib©ch" 
of
 
ªchÜs
 
to


1278 
·¹ic©e
 
š
 
the
 
loss
 
computiÚ
, 
ªd
 
»tuºs
h
RPN
 
los£s
.

1280 
Args
:

1281 
½n_box_’codšgs
: 
A
 4-
D
 
‹nsÜ
 
of
 
sh­e


1282 [
b©ch_size
, 
num_ªchÜs
, 
£lf
.
_box_cod”
.
code_size
] 
cÚššg


1283 
´ediùed
 
´İo§l
 
box
 
’codšgs
.

1284 
½n_objeùÃss_´ediùiÚs_w™h_background
: 
A
 2-
D
 
‹nsÜ
 
of
 
sh­e


1285 [
b©ch_size
, 
num_ªchÜs
, 2] 
cÚššg
 
objeùÃss
 
´ediùiÚs


1286 (
log™s
è
—ch
 
of
 
the
 
ªchÜs
 
w™h
 0 
cÜ»¥Údšg
 
to
 
background


1287 
ªd
 1 
cÜ»¥Údšg
 
to
 
objeù
.

1288 
ªchÜs
: 
A
 2-
D
 
‹nsÜ
 
of
 
sh­e
 [
num_ªchÜs
, 4] 
»´e£Ášg
‡nchors

1289 
the
 
fœ¡
 
¡age
 
RPN
. 
NÙe
 
th©
 `
num_ªchÜs
` 
ÿn
 
difãr
 
d•’dšg


1290 
Ú
 
wh‘h”
 
the
 
mod–
 
is
 
ü—‹d
 
š
 
Œaššg
 
Ü
 
šã»nû
 
mode
.

1291 
groundŒuth_boxli¡s
: 
A
 
li¡
 
of
 
BoxLi¡s
 
cÚššg
 
coÜdš©es
 oà
the


1292 
groundŒuth
 
boxes
.

1293 
groundŒuth_şas£s_w™h_background_li¡
: 
A
 
li¡
 
of
 2-
D
 
Úe
-
hÙ


1294 (
Ü
 
k
-
hÙ
è
‹nsÜs
 
of
 
sh­e
 [
num_boxes
, 
num_şas£s
+1] 
cÚššg
 
the


1295 
şass
 
rg‘s
 
w™h
 
the
 0
th
 
šdex
 
assumed
 
to
 
m­
Øth
background
 class.

1297 
R‘uºs
:

1298 
a
 
diùiÚ¬y
 
m­pšg
 
loss
 
	`keys
 (`
fœ¡_¡age_loÿliz©iÚ_loss
`,

1299 `
fœ¡_¡age_objeùÃss_loss
`è
to
 
sÿÏr
 
‹nsÜs
 
»´e£Ášg


1300 
cÜ»¥Údšg
 
loss
 
v®ues
.

1302 
w™h
 
tf
.
	`Çme_scİe
('RPNLoss'):

1303 (
b©ch_şs_rg‘s
, 
b©ch_şs_weights
, 
b©ch_»g_rg‘s
,

1304 
b©ch_»g_weights
, 
_
èğ
rg‘_assigÃr
.
	`b©ch_assign_rg‘s
(

1305 
£lf
.
_´İo§l_rg‘_assigÃr
, 
box_li¡
.
	`BoxLi¡
(
ªchÜs
),

1306 
groundŒuth_boxli¡s
, 
	`Ën
(groundŒuth_boxli¡s)*[
NÚe
])

1307 
b©ch_şs_rg‘s
 = 
tf
.
	$squ“ze
(
b©ch_şs_rg‘s
, 
axis
=2)

1309 
def
 
	$_mšib©ch_sub§m¶e_â
(
šputs
):

1310 
şs_rg‘s
, 
şs_weights
 = 
šputs


1311  
£lf
.
_fœ¡_¡age_§m¶”
.
	`sub§m¶e
(

1312 
tf
.
	`ÿ¡
(
şs_weights
,f.
boŞ
),

1313 
£lf
.
_fœ¡_¡age_mšib©ch_size
, 
tf
.
	$ÿ¡
(
şs_rg‘s
, 
tf
.
boŞ
))

1314 
b©ch_§m¶ed_šdiûs
 = 
tf
.
	`to_æßt
Ñf.
	$m­_â
(

1315 
_mšib©ch_sub§m¶e_â
,

1316 [
b©ch_şs_rg‘s
, 
b©ch_şs_weights
],

1317 
dty³
=
tf
.
boŞ
,

1318 
·¿Î–_™”©iÚs
=
£lf
.
_·¿Î–_™”©iÚs
,

1319 
back_´İ
=
True
))

1321 #NÜm®iz
by
 
numb”
 
of
 
exam¶es
 
š
 
§m¶ed
 
mšib©ch


1322 
nÜm®iz”
 = 
tf
.
	$»duû_sum
(
b©ch_§m¶ed_šdiûs
, 
axis
=1)

1323 
b©ch_Úe_hÙ_rg‘s
 = 
tf
.
	`Úe_hÙ
(

1324 
tf
.
	`to_št32
(
b©ch_şs_rg‘s
), 
d•th
=2)

1325 
§m¶ed_»g_šdiûs
 = 
tf
.
	$muÉly
(
b©ch_§m¶ed_šdiûs
,

1326 
b©ch_»g_weights
)

1328 
loÿliz©iÚ_los£s
 = 
£lf
.
	$_fœ¡_¡age_loÿliz©iÚ_loss
(

1329 
½n_box_’codšgs
, 
b©ch_»g_rg‘s
, 
weights
=
§m¶ed_»g_šdiûs
)

1330 
objeùÃss_los£s
 = 
£lf
.
	$_fœ¡_¡age_objeùÃss_loss
(

1331 
½n_objeùÃss_´ediùiÚs_w™h_background
,

1332 
b©ch_Úe_hÙ_rg‘s
, 
weights
=
b©ch_§m¶ed_šdiûs
)

1333 
loÿliz©iÚ_loss
 = 
tf
.
	`»duû_m—n
(

1334 
tf
.
	`»duû_sum
(
loÿliz©iÚ_los£s
, 
axis
=1è/ 
nÜm®iz”
)

1335 
objeùÃss_loss
 = 
tf
.
	`»duû_m—n
(

1336 
tf
.
	`»duû_sum
(
objeùÃss_los£s
, 
axis
=1è/ 
nÜm®iz”
)

1337 
loss_diù
 = {

1339 
£lf
.
_fœ¡_¡age_loc_loss_weight
 * 
loÿliz©iÚ_loss
,

1341 
£lf
.
_fœ¡_¡age_obj_loss_weight
 * 
objeùÃss_loss
,

1342 
	}
}

1343  
loss_diù


1345 
def
 
	$_loss_box_şassif›r
(
£lf
,

1346 
»fšed_box_’codšgs
,

1347 
şass_´ediùiÚs_w™h_background
,

1348 
´İo§l_boxes
,

1349 
num_´İo§ls
,

1350 
groundŒuth_boxli¡s
,

1351 
groundŒuth_şas£s_w™h_background_li¡
):

1354 
U£s
 
£lf
.
_d‘eùÜ_rg‘_assigÃr
 
to
 
obš
 
»g»ssiÚ
 
ªd
 
şassifiÿtiÚ


1355 
rg‘s
 
the
 
£cÚd
 
¡age
 
box
 
şassif›r
, 
İtiÚ®ly
 
³rfÜms


1356 
h¬d
 
mššg
, 
ªd
 
»tuºs
 
los£s
. 
AÎ
†os£ 
¬e
 
compu‹d
 
šd•’d’y


1357 
—ch
 
image
 
ªd
 
th’
 
av”aged
 
aüoss
 
the
 
b©ch
.

1359 
This
 
funùiÚ
 
assumes
 
th©
 
the
 
´İo§l
 
boxes
 
š
h"·dded" 
»giÚs
 
¬e


1360 
aùu®ly
 
	`z”o
 (
ªd
 
thus
 
should
 
nÙ
 
be
 
m©ched
 
to
).

1362 
Args
:

1363 
»fšed_box_’codšgs
: 
a
 3-
D
 
‹nsÜ
 
w™h
 
sh­e


1364 [
tÙ®_num_´İo§ls
, 
num_şas£s
, 
box_cod”
.
code_size
] 
»´e£Ášg


1365 
	$´ediùed
 (
fš®
è
»fšed
 
box
 
’codšgs
.

1366 
şass_´ediùiÚs_w™h_background
: 
a
 3-
D
 
‹nsÜ
 
w™h
 
sh­e


1367 [
tÙ®_num_´İo§ls
, 
num_şas£s
 + 1] 
cÚššg
 
şass


1368 
	$´ediùiÚs
 (
log™s
è
—ch
 
of
 
the
 
ªchÜs
. 
NÙe
 
th©
 
this
 
‹nsÜ


1369 *
šşudes
* 
background
 
şass
 
	`´ediùiÚs
 (
©
 cÏs 
šdex
 0).

1370 
´İo§l_boxes
: [
b©ch_size
, 
£lf
.
max_num_´İo§ls
, 4] 
»´e£Ášg


1371 
decoded
 
´İo§l
 
boundšg
 
boxes
.

1372 
num_´İo§ls
: 
A
 
T’sÜ
 
of
 
ty³
 `
št32
`. A 1-
D
 
‹nsÜ
 oà
sh­e
 [
b©ch
]

1373 
»´e£Ášg
 
the
 
numb”
 
of
 
´İo§ls
 
´ediùed
 
—ch
 
image
 
š


1374 
the
 
b©ch
.

1375 
groundŒuth_boxli¡s
: 
a
 
li¡
 
of
 
BoxLi¡s
 
cÚššg
 
coÜdš©es
 oà
the


1376 
groundŒuth
 
boxes
.

1377 
groundŒuth_şas£s_w™h_background_li¡
: 
a
 
li¡
 
of
 2-
D
 
Úe
-
hÙ


1378 (
Ü
 
k
-
hÙ
è
‹nsÜs
 
of
 
sh­e
 [
num_boxes
, 
num_şas£s
 + 1] 
cÚššg
 
the


1379 
şass
 
rg‘s
 
w™h
 
the
 0
th
 
šdex
 
assumed
 
to
 
m­
Øth
background
 class.

1381 
R‘uºs
:

1382 
a
 
diùiÚ¬y
 
m­pšg
 
loss
 
	`keys
 ('second_stage_localization_loss',

1383 '£cÚd_¡age_şassifiÿtiÚ_loss'è
to
 
sÿÏr
 
‹nsÜs
 
»´e£Ášg


1384 
cÜ»¥Údšg
 
loss
 
v®ues
.

1386 
w™h
 
tf
.
	`Çme_scİe
('BoxClassifierLoss'):

1387 
·ddšgs_šdiÿtÜ
 = 
£lf
.
	$_·dded_b©ched_´İo§ls_šdiÿtÜ
(

1388 
num_´İo§ls
, 
£lf
.
max_num_´İo§ls
)

1389 
´İo§l_boxli¡s
 = [

1390 
box_li¡
.
	$BoxLi¡
(
´İo§l_boxes_sšgË_image
)

1391 
´İo§l_boxes_sšgË_image
 
š
 
tf
.
	`un¡ack
(
´İo§l_boxes
)]

1392 
b©ch_size
 = 
	$Ën
(
´İo§l_boxli¡s
)

1394 
num_´İo§ls_Ü_Úe
 = 
tf
.
	`to_æßt
Ñf.
	`ex·nd_dims
(

1395 
tf
.
	`maximum
(
num_´İo§ls
,f.
	`Úes_like
(num_proposals)), 1))

1396 
nÜm®iz”
 = 
tf
.
	`te
(
num_´İo§ls_Ü_Úe
,

1397 [1, 
£lf
.
max_num_´İo§ls
]è* 
b©ch_size


1399 (
b©ch_şs_rg‘s_w™h_background
, 
b©ch_şs_weights
, 
b©ch_»g_rg‘s
,

1400 
b©ch_»g_weights
, 
_
èğ
rg‘_assigÃr
.
	$b©ch_assign_rg‘s
(

1401 
£lf
.
_d‘eùÜ_rg‘_assigÃr
, 
´İo§l_boxli¡s
,

1402 
groundŒuth_boxli¡s
, 
groundŒuth_şas£s_w™h_background_li¡
)

1404 #W
Úly
 
´ediù
 
»fšed
 
loÿtiÚ
 
’codšgs
 
the
 
nÚ
 
background


1405 #şas£s, 
but
 
we
 
now
 
·d
 
™
 
to
 
make
 iˆ
com·tibË
 
w™h
 
the
 
şass


1407 
æ©_şs_rg‘s_w™h_background
 = 
tf
.
	`»sh­e
(

1408 
b©ch_şs_rg‘s_w™h_background
,

1409 [
b©ch_size
 * 
£lf
.
max_num_´İo§ls
, -1])

1410 
»fšed_box_’codšgs_w™h_background
 = 
tf
.
	$·d
(

1411 
»fšed_box_’codšgs
, [[0, 0], [1, 0], [0, 0]])

1412 
»fšed_box_’codšgs_masked_by_şass_rg‘s
 = 
tf
.
	`boŞ—n_mask
(

1413 
»fšed_box_’codšgs_w™h_background
,

1414 
tf
.
	$g»©”
(
æ©_şs_rg‘s_w™h_background
, 0))

1415 
»sh­ed_»fšed_box_’codšgs
 = 
tf
.
	`»sh­e
(

1416 
»fšed_box_’codšgs_masked_by_şass_rg‘s
,

1417 [
b©ch_size
, -1, 4])

1419 
£cÚd_¡age_loc_los£s
 = 
£lf
.
	`_£cÚd_¡age_loÿliz©iÚ_loss
(

1420 
»sh­ed_»fšed_box_’codšgs
,

1421 
b©ch_»g_rg‘s
, 
weights
=
b©ch_»g_weights
è/ 
nÜm®iz”


1422 
£cÚd_¡age_şs_los£s
 = 
£lf
.
	`_£cÚd_¡age_şassifiÿtiÚ_loss
(

1423 
şass_´ediùiÚs_w™h_background
,

1424 
b©ch_şs_rg‘s_w™h_background
,

1425 
weights
=
b©ch_şs_weights
è/ 
nÜm®iz”


1426 
£cÚd_¡age_loc_loss
 = 
tf
.
	`»duû_sum
(

1427 
tf
.
	$boŞ—n_mask
(
£cÚd_¡age_loc_los£s
, 
·ddšgs_šdiÿtÜ
))

1428 
£cÚd_¡age_şs_loss
 = 
tf
.
	`»duû_sum
(

1429 
tf
.
	$boŞ—n_mask
(
£cÚd_¡age_şs_los£s
, 
·ddšgs_šdiÿtÜ
))

1431 
£lf
.
_h¬d_exam¶e_mš”
:

1432 (
£cÚd_¡age_loc_loss
, 
£cÚd_¡age_şs_loss


1433 èğ
£lf
.
	$_uÅad_´İo§ls_ªd_­¶y_h¬d_mššg
(

1434 
´İo§l_boxli¡s
, 
£cÚd_¡age_loc_los£s
,

1435 
£cÚd_¡age_şs_los£s
, 
num_´İo§ls
)

1436 
loss_diù
 = {

1438 (
£lf
.
_£cÚd_¡age_loc_loss_weight
 * 
£cÚd_¡age_loc_loss
),

1440 (
£lf
.
_£cÚd_¡age_şs_loss_weight
 * 
£cÚd_¡age_şs_loss
),

1441 
	}
}

1442  
loss_diù


1444 
def
 
	$_·dded_b©ched_´İo§ls_šdiÿtÜ
(
£lf
,

1445 
num_´İo§ls
,

1446 
max_num_´İo§ls
):

1449 
Args
:

1450 
num_´İo§ls
: 
T’sÜ
 
of
 
ty³
 
tf
.
št32
 
w™h
 
sh­e
 [
b©ch_size
].

1451 
max_num_´İo§ls
: 
Maximum
 
numb”
 
of
 
´İo§ls
 
³r
 
	`image
 (
š‹g”
).

1453 
R‘uºs
:

1454 
A
 
T’sÜ
 
of
 
ty³
 
tf
.
boŞ
 
w™h
 
sh­e
 [
b©ch_size
, 
max_num_´İo§ls
].

1456 
b©ch_size
 = 
tf
.
	$size
(
num_´İo§ls
)

1457 
ted_num_´İo§ls
 = 
tf
.
	`te
(

1458 
tf
.
	`ex·nd_dims
(
num_´İo§ls
, 1), [1, 
max_num_´İo§ls
])

1459 
ted_´İo§l_šdex
 = 
tf
.
	`te
(

1460 
tf
.
	`ex·nd_dims
Ñf.
	`¿nge
(
max_num_´İo§ls
), 0), [
b©ch_size
, 1])

1461  
tf
.
	$g»©”
(
ted_num_´İo§ls
, 
ted_´İo§l_šdex
)

1463 
def
 
	$_uÅad_´İo§ls_ªd_­¶y_h¬d_mššg
(
£lf
,

1464 
´İo§l_boxli¡s
,

1465 
£cÚd_¡age_loc_los£s
,

1466 
£cÚd_¡age_şs_los£s
,

1467 
num_´İo§ls
):

1470 
Args
:

1471 
´İo§l_boxli¡s
: 
A
 
li¡
 
of
 `
b©ch_size
` 
BoxLi¡s
 
—ch
 
»´e£Ášg


1472 `
£lf
.
max_num_´İo§ls
` 
»´e£Ášg
 
decoded
 
´İo§l
 
boundšg
 
boxes


1473 
—ch
 
image
.

1474 
£cÚd_¡age_loc_los£s
: 
A
 
T’sÜ
 
of
 
ty³
 `
æßt32
`. A 
‹nsÜ
 oà
sh­e


1475 `[
b©ch_size
, 
£lf
.
max_num_´İo§ls
]` 
»´e£Ášg
 
³r
-
ªchÜ


1476 
£cÚd
 
¡age
 
loÿliz©iÚ
 
loss
 
v®ues
.

1477 
£cÚd_¡age_şs_los£s
: 
A
 
T’sÜ
 
of
 
ty³
 `
æßt32
`. A 
‹nsÜ
 oà
sh­e


1478 `[
b©ch_size
, 
£lf
.
max_num_´İo§ls
]` 
»´e£Ášg
 
³r
-
ªchÜ


1479 
£cÚd
 
¡age
 
şassifiÿtiÚ
 
loss
 
v®ues
.

1480 
num_´İo§ls
: 
A
 
T’sÜ
 
of
 
ty³
 `
št32
`. A 1-
D
 
‹nsÜ
 oà
sh­e
 [
b©ch
]

1481 
»´e£Ášg
 
the
 
numb”
 
of
 
´İo§ls
 
´ediùed
 
—ch
 
image
 
š


1482 
the
 
b©ch
.

1484 
R‘uºs
:

1485 
£cÚd_¡age_loc_loss
: 
A
 
sÿÏr
 
æßt32
 
‹nsÜ
 
»´e£Ášg
 
the
 
£cÚd


1486 
¡age
 
loÿliz©iÚ
 
loss
.

1487 
£cÚd_¡age_şs_loss
: 
A
 
sÿÏr
 
æßt32
 
‹nsÜ
 
»´e£Ášg
 
the
 
£cÚd


1488 
¡age
 
şassifiÿtiÚ
 
loss
.

1490 
´İo§l_boxli¡
, 
sšgË_image_loc_loss
, 
sšgË_image_şs_loss
,

1491 
sšgË_image_num_´İo§ls
è
š
 
	`z
(

1492 
´İo§l_boxli¡s
,

1493 
tf
.
	`un¡ack
(
£cÚd_¡age_loc_los£s
),

1494 
tf
.
	`un¡ack
(
£cÚd_¡age_şs_los£s
),

1495 
tf
.
	$un¡ack
(
num_´İo§ls
)):

1496 
´İo§l_boxli¡
 = 
box_li¡
.
	`BoxLi¡
(

1497 
tf
.
	`¦iû
(
´İo§l_boxli¡
.
	`g‘
(),

1498 [0, 0], [
sšgË_image_num_´İo§ls
, -1]))

1499 
sšgË_image_loc_loss
 = 
tf
.
	$¦iû
(
sšgË_image_loc_loss
,

1500 [0], [
sšgË_image_num_´İo§ls
])

1501 
sšgË_image_şs_loss
 = 
tf
.
	$¦iû
(
sšgË_image_şs_loss
,

1502 [0], [
sšgË_image_num_´İo§ls
])

1503  
£lf
.
	`_h¬d_exam¶e_mš”
(

1504 
loÿtiÚ_los£s
=
tf
.
	`ex·nd_dims
(
sšgË_image_loc_loss
, 0),

1505 
şs_los£s
=
tf
.
	`ex·nd_dims
(
sšgË_image_şs_loss
, 0),

1506 
decoded_boxli¡_li¡
=[
´İo§l_boxli¡
])

1508 
def
 
	$»¡Üe_m­
(
£lf
, 
äom_d‘eùiÚ_checkpošt
=
True
):

1511 
S“
 
·»Á
 
şass
 
d‘as
.

1513 
Args
:

1514 
äom_d‘eùiÚ_checkpošt
: 
wh‘h”
 
to
 
»¡Üe
 
äom
 
a
 
fuÎ
 
d‘eùiÚ


1515 
	$checkpošt
 (
w™h
 
com·tibË
 
v¬ŸbË
 
Çmes
è
Ü
 
to
 
»¡Üe
 
äom
 
a


1516 
şassifiÿtiÚ
 
checkpošt
 
š™Ÿliz©iÚ
 
´iÜ
 
to
 
Œaššg
.

1518 
R‘uºs
:

1519 
A
 
diù
 
m­pšg
 
v¬ŸbË
 
	$Çmes
 (
to
 
lßd
 
äom
 
a
 
checkpošt
ètØ
v¬ŸbËs
 
š


1520 
the
 
mod–
 
g¿ph
.

1522 
nÙ
 
äom_d‘eùiÚ_checkpošt
:

1523  
£lf
.
_ã©u»_exŒaùÜ
.
	$»¡Üe_äom_şassifiÿtiÚ_checkpošt_â
(

1524 
£lf
.
fœ¡_¡age_ã©u»_exŒaùÜ_scİe
,

1525 
£lf
.
£cÚd_¡age_ã©u»_exŒaùÜ_scİe
)

1527 
v¬ŸbËs_to_»¡Üe
 = 
tf
.
	$glob®_v¬ŸbËs
()

1528 
v¬ŸbËs_to_»¡Üe
.
	`­³nd
(
¦im
.
	$g‘_Ü_ü—‹_glob®_¡•
())

1529 #OÆy 
lßd
 
ã©u»
 
exŒaùÜ
 
v¬ŸbËs
 
to
 
be
 
cÚsi¡’t
 
w™h
 
lßdšg
 
äom


1530 #¨
şassifiÿtiÚ
 
checkpošt
.

1531 
ã©u»_exŒaùÜ_v¬ŸbËs
 = 
tf
.
cÚŒib
.
äamewÜk
.
	$f‹r_v¬ŸbËs
(

1532 
v¬ŸbËs_to_»¡Üe
,

1533 
šşude_·‰”ns
=[
£lf
.
fœ¡_¡age_ã©u»_exŒaùÜ_scİe
,

1534 
£lf
.
£cÚd_¡age_ã©u»_exŒaùÜ_scİe
])

1535  {
v¬
.
İ
.
Çme
: v¬ v¬ 
š
 
ã©u»_exŒaùÜ_v¬ŸbËs
}

	@meta_architectures/faster_rcnn_meta_arch_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
m‘a_¬ch™eùu»s
 
impÜt
 
ç¡”_rún_m‘a_¬ch_‹¡_lib


23 
şass
 
	$Fa¡”RCNNM‘aArchTe¡
(

24 
ç¡”_rún_m‘a_¬ch_‹¡_lib
.
Fa¡”RCNNM‘aArchTe¡Ba£
):

26 
def
 
	$‹¡_po¡´oûss_£cÚd_¡age_Úly_šã»nû_mode_w™h_masks
(
£lf
):

27 
mod–
 = 
£lf
.
	$_bud_mod–
(

28 
is_Œaššg
=
F®£
, 
fœ¡_¡age_Úly
=F®£, 
£cÚd_¡age_b©ch_size
=6)

30 
b©ch_size
 = 2

31 
tÙ®_num_·dded_´İo§ls
 = 
b©ch_size
 * 
mod–
.
max_num_´İo§ls


32 
´İo§l_boxes
 = 
tf
.
	$cÚ¡ªt
(

39 4*[0], 4*[0], 4*[0], 4*[0], 4*[0], 4*[0]]], 
dty³
=
tf
.
æßt32
)

40 
num_´İo§ls
 = 
tf
.
	$cÚ¡ªt
([3, 2], 
dty³
=
tf
.
št32
)

41 
»fšed_box_’codšgs
 = 
tf
.
	$z”os
(

42 [
tÙ®_num_·dded_´İo§ls
, 
mod–
.
num_şas£s
, 4], 
dty³
=
tf
.
æßt32
)

43 
şass_´ediùiÚs_w™h_background
 = 
tf
.
	`Úes
(

44 [
tÙ®_num_·dded_´İo§ls
, 
mod–
.
num_şas£s
+1], 
dty³
=
tf
.
æßt32
)

45 
image_sh­e
 = 
tf
.
	$cÚ¡ªt
([
b©ch_size
, 36, 48, 3], 
dty³
=
tf
.
št32
)

47 
mask_height
 = 2

48 
mask_width
 = 2

49 
mask_´ediùiÚs
 = .6 * 
tf
.
	$Úes
(

50 [
tÙ®_num_·dded_´İo§ls
, 
mod–
.
num_şas£s
,

51 
mask_height
, 
mask_width
], 
dty³
=
tf
.
æßt32
)

52 
exp_d‘eùiÚ_masks
 = [[[[1, 1], [1, 1]],

63 
d‘eùiÚs
 = 
mod–
.
	`po¡´oûss
({

64 '»fšed_box_’codšgs': 
»fšed_box_’codšgs
,

65 'şass_´ediùiÚs_w™h_background': 
şass_´ediùiÚs_w™h_background
,

66 'num_´İo§ls': 
num_´İo§ls
,

67 '´İo§l_boxes': 
´İo§l_boxes
,

68 'image_sh­e': 
image_sh­e
,

69 'mask_´ediùiÚs': 
mask_´ediùiÚs


70 
	}
})

71 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

72 
d‘eùiÚs_out
 = 
£ss
.
	$run
(
d‘eùiÚs
)

73 
£lf
.
	`as£¹AÎEqu®
(
d‘eùiÚs_out
['d‘eùiÚ_boxes'].
sh­e
, [2, 5, 4])

74 
£lf
.
	`as£¹AÎClo£
(
d‘eùiÚs_out
['detection_scores'],

76 
£lf
.
	`as£¹AÎClo£
(
d‘eùiÚs_out
['detection_classes'],

78 
£lf
.
	`as£¹AÎClo£
(
d‘eùiÚs_out
['num_detections'], [5, 4])

79 
£lf
.
	`as£¹AÎClo£
(
d‘eùiÚs_out
['detection_masks'],

80 
exp_d‘eùiÚ_masks
)

83 
__Çme__
 == '__main__':

84 
tf
.
‹¡
.
	`maš
()

	@meta_architectures/faster_rcnn_meta_arch_test_lib.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
numpy
 
as
 
Å


18 
impÜt
 
‹nsÜæow
 
as
 
tf


19 
äom
 
	ggoogË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


20 
äom
 
	gobjeù_d‘eùiÚ
.
ªchÜ_g’”©Üs
 
impÜt
 
grid_ªchÜ_g’”©Ü


21 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
box_´ediùÜ_bud”


22 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
hy³½¬ams_bud”


23 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
po¡_´oûssšg_bud”


24 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
los£s


25 
äom
 
	gobjeù_d‘eùiÚ
.
m‘a_¬ch™eùu»s
 
impÜt
 
ç¡”_rún_m‘a_¬ch


26 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
box_´ediùÜ_pb2


27 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
hy³½¬ams_pb2


28 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
po¡_´oûssšg_pb2


30 
	g¦im
 = 
tf
.
cÚŒib
.
¦im


31 
BOX_CODE_SIZE
 = 4

34 
şass
 
	$FakeFa¡”RCNNF—tu»ExŒaùÜ
(

35 
ç¡”_rún_m‘a_¬ch
.
Fa¡”RCNNF—tu»ExŒaùÜ
):

38 
def
 
	$__š™__
(
£lf
):

39 
	`su³r
(
FakeFa¡”RCNNF—tu»ExŒaùÜ
, 
£lf
).
	$__š™__
(

40 
is_Œaššg
=
F®£
,

41 
fœ¡_¡age_ã©u»s_¡ride
=32,

42 
»u£_weights
=
NÚe
,

43 
weight_deÿy
=0.0)

45 
def
 
	$´•roûss
(
£lf
, 
»sized_šputs
):

46  
tf
.
	$id’t™y
(
»sized_šputs
)

48 
def
 
	$_exŒaù_´İo§l_ã©u»s
(
£lf
, 
´•roûs£d_šputs
, 
scİe
):

49 
w™h
 
tf
.
	`v¬ŸbË_scİe
('mock_model'):

50  0 * 
¦im
.
	`cÚv2d
(
´•roûs£d_šputs
,

51 
num_ouuts
=3, 
k”Ãl_size
=1, 
scİe
='layer1')

53 
def
 
	$_exŒaù_box_şassif›r_ã©u»s
(
£lf
, 
´İo§l_ã©u»_m­s
, 
scİe
):

54 
w™h
 
tf
.
	`v¬ŸbË_scİe
('mock_model'):

55  0 * 
¦im
.
	`cÚv2d
(
´İo§l_ã©u»_m­s
,

56 
num_ouuts
=3, 
k”Ãl_size
=1, 
scİe
='layer2')

59 
şass
 
	$Fa¡”RCNNM‘aArchTe¡Ba£
(
tf
.
‹¡
.
Te¡Ca£
):

62 
def
 
	$_bud_¬g_scİe_w™h_hy³½¬ams
(
£lf
,

63 
hy³½¬ams_‹xt_´Ùo
,

64 
is_Œaššg
):

65 
hy³½¬ams
 = 
hy³½¬ams_pb2
.
	$Hy³½¬ams
()

66 
‹xt_fÜm©
.
	$M”ge
(
hy³½¬ams_‹xt_´Ùo
, 
hy³½¬ams
)

67  
hy³½¬ams_bud”
.
	$bud
(
hy³½¬ams
, 
is_Œaššg
=is_training)

69 
def
 
	$_g‘_£cÚd_¡age_box_´ediùÜ_‹xt_´Ùo
(
£lf
):

70 
box_´ediùÜ_‹xt_´Ùo
 = """

71 
mask_rún_box_´ediùÜ
 {

72 
fc_hy³½¬ams
 {

73 
İ
: 
FC


74 
aùiv©iÚ
: 
NONE


75 
»guÏriz”
 {

76 
l2_»guÏriz”
 {

77 
weight
: 0.0005

80 
š™Ÿliz”
 {

81 
v¬Ÿnû_sÿlšg_š™Ÿliz”
 {

82 
çùÜ
: 1.0

83 
unifÜm
: 
Œue


84 
mode
: 
FAN_AVG


88 
	}
}

90  
box_´ediùÜ_‹xt_´Ùo


92 
def
 
	$_g‘_£cÚd_¡age_box_´ediùÜ
(
£lf
, 
num_şas£s
, 
is_Œaššg
):

93 
box_´ediùÜ_´Ùo
 = 
box_´ediùÜ_pb2
.
	$BoxP»diùÜ
()

94 
‹xt_fÜm©
.
	`M”ge
(
£lf
.
	`_g‘_£cÚd_¡age_box_´ediùÜ_‹xt_´Ùo
(),

95 
box_´ediùÜ_´Ùo
)

96  
box_´ediùÜ_bud”
.
	$bud
(

97 
hy³½¬ams_bud”
.
bud
,

98 
box_´ediùÜ_´Ùo
,

99 
num_şas£s
=num_classes,

100 
is_Œaššg
=is_training)

102 
def
 
	$_g‘_mod–
(
£lf
, 
box_´ediùÜ
, **
commÚ_kw¬gs
):

103  
ç¡”_rún_m‘a_¬ch
.
	$Fa¡”RCNNM‘aArch
(

104 
š™Ÿl_üİ_size
=3,

105 
maxpoŞ_k”Ãl_size
=1,

106 
maxpoŞ_¡ride
=1,

107 
£cÚd_¡age_mask_rún_box_´ediùÜ
=
box_´ediùÜ
,

108 **
commÚ_kw¬gs
)

110 
def
 
	$_bud_mod–
(
£lf
,

111 
is_Œaššg
,

112 
fœ¡_¡age_Úly
,

113 
£cÚd_¡age_b©ch_size
,

114 
fœ¡_¡age_max_´İo§ls
=8,

115 
num_şas£s
=2,

116 
h¬d_mššg
=
F®£
):

118 
def
 
	$image_»siz”_â
(
image
):

119  
tf
.
	$id’t™y
(
image
)

121 #ªchÜ 
š
 
this
 
‹¡
 
¬e
 
desigÃd
 
so
 
th©
 
a
 
sub£t
 
of
 
ªchÜs
‡» 
šside


122 #th
image
 
ªd
 
a
 
sub£t
 
of
 
ªchÜs
 
¬e
 
outside
.

123 
fœ¡_¡age_ªchÜ_sÿËs
 = (0.001, 0.005, 0.1)

124 
fœ¡_¡age_ªchÜ_a¥eù_¿tios
 = (0.5, 1.0, 2.0)

125 
fœ¡_¡age_ªchÜ_¡rides
 = (1, 1)

126 
fœ¡_¡age_ªchÜ_g’”©Ü
 = 
grid_ªchÜ_g’”©Ü
.
	$GridAnchÜG’”©Ü
(

127 
fœ¡_¡age_ªchÜ_sÿËs
,

128 
fœ¡_¡age_ªchÜ_a¥eù_¿tios
,

129 
ªchÜ_¡ride
=
fœ¡_¡age_ªchÜ_¡rides
)

131 
çke_ã©u»_exŒaùÜ
 = 
	$FakeFa¡”RCNNF—tu»ExŒaùÜ
()

133 
fœ¡_¡age_box_´ediùÜ_hy³½¬ams_‹xt_´Ùo
 = """

134 
İ
: 
CONV


135 
aùiv©iÚ
: 
RELU


136 
»guÏriz”
 {

137 
l2_»guÏriz”
 {

138 
weight
: 0.00004

140 
	}
}

141 
š™Ÿliz”
 {

142 
Œunÿ‹d_nÜm®_š™Ÿliz”
 {

143 
¡ddev
: 0.03

147 
fœ¡_¡age_box_´ediùÜ_¬g_scİe
 = (

148 
£lf
.
	$_bud_¬g_scİe_w™h_hy³½¬ams
(

149 
fœ¡_¡age_box_´ediùÜ_hy³½¬ams_‹xt_´Ùo
, 
is_Œaššg
))

151 
fœ¡_¡age_box_´ediùÜ_k”Ãl_size
 = 3

152 
fœ¡_¡age_©rous_¿‹
 = 1

153 
fœ¡_¡age_box_´ediùÜ_d•th
 = 512

154 
fœ¡_¡age_mšib©ch_size
 = 3

155 
fœ¡_¡age_pos™ive_b®ªû_äaùiÚ
 = .5

157 
fœ¡_¡age_nms_scÜe_th»shŞd
 = -1.0

158 
fœ¡_¡age_nms_iou_th»shŞd
 = 1.0

159 
fœ¡_¡age_max_´İo§ls
 = first_stage_max_proposals

161 
fœ¡_¡age_loÿliz©iÚ_loss_weight
 = 1.0

162 
fœ¡_¡age_objeùÃss_loss_weight
 = 1.0

164 
po¡_´oûssšg_‹xt_´Ùo
 = """

165 
b©ch_nÚ_max_suµ»ssiÚ
 {

166 
scÜe_th»shŞd
: -20.0

167 
iou_th»shŞd
: 1.0

168 
max_d‘eùiÚs_³r_şass
: 5

169 
max_tÙ®_d‘eùiÚs
: 5

170 
	}
}

172 
po¡_´oûssšg_cÚfig
 = 
po¡_´oûssšg_pb2
.
	$Po¡Proûssšg
()

173 
‹xt_fÜm©
.
	$M”ge
(
po¡_´oûssšg_‹xt_´Ùo
, 
po¡_´oûssšg_cÚfig
)

174 
£cÚd_¡age_nÚ_max_suµ»ssiÚ_â
, 
_
 = 
po¡_´oûssšg_bud”
.
	$bud
(

175 
po¡_´oûssšg_cÚfig
)

176 
£cÚd_¡age_b®ªû_äaùiÚ
 = 1.0

178 
£cÚd_¡age_scÜe_cÚv”siÚ_â
 = 
tf
.
id’t™y


179 
£cÚd_¡age_loÿliz©iÚ_loss_weight
 = 1.0

180 
£cÚd_¡age_şassifiÿtiÚ_loss_weight
 = 1.0

182 
h¬d_exam¶e_mš”
 = 
NÚe


183 
h¬d_mššg
:

184 
h¬d_exam¶e_mš”
 = 
los£s
.
	`H¬dExam¶eMš”
(

185 
num_h¬d_exam¶es
=1,

186 
iou_th»shŞd
=0.99,

187 
loss_ty³
='both',

188 
şs_loss_weight
=
£cÚd_¡age_şassifiÿtiÚ_loss_weight
,

189 
loc_loss_weight
=
£cÚd_¡age_loÿliz©iÚ_loss_weight
,

190 
max_Ãg©ives_³r_pos™ive
=
NÚe
)

192 
commÚ_kw¬gs
 = {

193 'is_Œaššg': 
is_Œaššg
,

194 'num_şas£s': 
num_şas£s
,

195 'image_»siz”_â': 
image_»siz”_â
,

196 'ã©u»_exŒaùÜ': 
çke_ã©u»_exŒaùÜ
,

197 'fœ¡_¡age_Úly': 
fœ¡_¡age_Úly
,

198 'fœ¡_¡age_ªchÜ_g’”©Ü': 
fœ¡_¡age_ªchÜ_g’”©Ü
,

199 'fœ¡_¡age_©rous_¿‹': 
fœ¡_¡age_©rous_¿‹
,

201 
fœ¡_¡age_box_´ediùÜ_¬g_scİe
,

203 
fœ¡_¡age_box_´ediùÜ_k”Ãl_size
,

204 'fœ¡_¡age_box_´ediùÜ_d•th': 
fœ¡_¡age_box_´ediùÜ_d•th
,

205 'fœ¡_¡age_mšib©ch_size': 
fœ¡_¡age_mšib©ch_size
,

207 
fœ¡_¡age_pos™ive_b®ªû_äaùiÚ
,

208 'fœ¡_¡age_nms_scÜe_th»shŞd': 
fœ¡_¡age_nms_scÜe_th»shŞd
,

209 'fœ¡_¡age_nms_iou_th»shŞd': 
fœ¡_¡age_nms_iou_th»shŞd
,

210 'fœ¡_¡age_max_´İo§ls': 
fœ¡_¡age_max_´İo§ls
,

212 
fœ¡_¡age_loÿliz©iÚ_loss_weight
,

214 
fœ¡_¡age_objeùÃss_loss_weight
,

215 '£cÚd_¡age_b©ch_size': 
£cÚd_¡age_b©ch_size
,

216 '£cÚd_¡age_b®ªû_äaùiÚ': 
£cÚd_¡age_b®ªû_äaùiÚ
,

218 
£cÚd_¡age_nÚ_max_suµ»ssiÚ_â
,

219 '£cÚd_¡age_scÜe_cÚv”siÚ_â': 
£cÚd_¡age_scÜe_cÚv”siÚ_â
,

221 
£cÚd_¡age_loÿliz©iÚ_loss_weight
,

223 
£cÚd_¡age_şassifiÿtiÚ_loss_weight
,

224 'h¬d_exam¶e_mš”': 
h¬d_exam¶e_mš”
}

226  
£lf
.
_g‘_mod–
(£lf.
_g‘_£cÚd_¡age_box_´ediùÜ
(

227 
num_şas£s
òum_şas£s, 
is_Œaššg
=is_Œaššg), **
commÚ_kw¬gs
)

229 
def
 
	$‹¡_´ediù_cÜ»ù_sh­es_š_šã»nû_mode_bÙh_¡ages
(

230 
£lf
):

231 
b©ch_size
 = 2

232 
image_size
 = 10

233 
šput_sh­es
 = [(
b©ch_size
, 
image_size
, image_size, 3),

234 (
NÚe
, 
image_size
, image_size, 3),

235 (
b©ch_size
, 
NÚe
, None, 3),

236 (
NÚe
, None, None, 3)]

237 
ex³ùed_num_ªchÜs
 = 
image_size
 * image_size * 3 * 3

238 
ex³ùed_sh­es
 = {

240 (2, 
image_size
, image_size, 512),

241 '½n_ã©u»s_to_üİ': (2, 
image_size
, image_size, 3),

243 '½n_box_’codšgs': (2, 
ex³ùed_num_ªchÜs
, 4),

245 (2, 
ex³ùed_num_ªchÜs
, 2),

246 'ªchÜs': (
ex³ùed_num_ªchÜs
, 4),

251 
	}
}

252 
šput_sh­e
 
š
 
šput_sh­es
:

253 
‹¡_g¿ph
 = 
tf
.
	$G¿ph
()

254 
w™h
 
‹¡_g¿ph
.
	$as_deçuÉ
():

255 
mod–
 = 
£lf
.
	$_bud_mod–
(

256 
is_Œaššg
=
F®£
, 
fœ¡_¡age_Úly
=False,

257 
£cÚd_¡age_b©ch_size
=2)

258 
´•roûs£d_šputs
 = 
tf
.
	$¶aûhŞd”
(
tf
.
æßt32
, 
sh­e
=
šput_sh­e
)

259 
»suÉ_‹nsÜ_diù
 = 
mod–
.
	$´ediù
(
´•roûs£d_šputs
)

260 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

261 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(
g¿ph
=
‹¡_g¿ph
è
as
 
£ss
:

262 
£ss
.
	$run
(
š™_İ
)

263 
‹nsÜ_diù_out
 = 
£ss
.
	`run
(
»suÉ_‹nsÜ_diù
, 
ãed_diù
={

264 
´•roûs£d_šputs
:

265 
Å
.
	`z”os
((
b©ch_size
, 
image_size
, image_size, 3))
	}
})

266 
£lf
.
as£¹Equ®
(
£t
(
‹nsÜ_diù_out
.
keys
()),

267 
£t
(
ex³ùed_sh­es
.
	$keys
()))

268 
key
 
š
 
ex³ùed_sh­es
:

269 
£lf
.
	$as£¹AÎEqu®
(
‹nsÜ_diù_out
[
key
].
sh­e
, 
ex³ùed_sh­es
[key])

271 
def
 
	$‹¡_´ediù_gives_v®id_ªchÜs_š_Œaššg_mode_fœ¡_¡age_Úly
(
£lf
):

272 
‹¡_g¿ph
 = 
tf
.
	$G¿ph
()

273 
w™h
 
‹¡_g¿ph
.
	$as_deçuÉ
():

274 
mod–
 = 
£lf
.
	$_bud_mod–
(

275 
is_Œaššg
=
True
, 
fœ¡_¡age_Úly
=True, 
£cÚd_¡age_b©ch_size
=2)

276 
b©ch_size
 = 2

277 
height
 = 10

278 
width
 = 12

279 
šput_image_sh­e
 = (
b©ch_size
, 
height
, 
width
, 3)

280 
´•roûs£d_šputs
 = 
tf
.
	`¶aûhŞd”
(
dty³
ñf.
æßt32
,

281 
sh­e
=(
b©ch_size
, 
NÚe
, None, 3))

282 
´ediùiÚ_diù
 = 
mod–
.
	$´ediù
(
´•roûs£d_šputs
)

284 
ex³ùed_ouut_keys
 = 
	`£t
([

288 #Aˆ
Œaššg
 
time
, 
ªchÜs
 
th©
 
exûed
 
image
 
bounds
 
¬e
 
´uÃd
. 
Thus


289 #th`
ex³ùed_num_ªchÜs
` 
š
 
the
 
above
 
šã»nû
 
mode
 
‹¡
 
is
 
now


290 #¨
¡riù
 
uµ”
 
bound
 
Ú
 
the
 
numb”
 
of
 
ªchÜs
.

291 
num_ªchÜs_¡riù_uµ”_bound
 = 
height
 * 
width
 * 3 * 3

293 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

294 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

295 
£ss
.
	$run
(
š™_İ
)

296 
´ediùiÚ_out
 = 
£ss
.
	`run
(
´ediùiÚ_diù
,

297 
ãed_diù
={

298 
´•roûs£d_šputs
:

299 
Å
.
	`z”os
(
šput_image_sh­e
)

300 
	}
})

302 
£lf
.
as£¹Equ®
(
£t
(
´ediùiÚ_out
.
keys
()), 
ex³ùed_ouut_keys
)

303 
	g£lf
.
as£¹AÎEqu®
(
´ediùiÚ_out
['image_sh­e'], 
šput_image_sh­e
)

305 #Check 
th©
 
ªchÜs
 
have
 
Ëss
 
thª
 
the
 
uµ”
 
bound
 
ªd


306 #¬
ş³d
 
to
 
wšdow
.

307 
	gªchÜs
 = 
´ediùiÚ_out
['anchors']

308 
£lf
.
as£¹True
(
Ën
(
ªchÜs
.
sh­e
è=ğ2 
ªd
‡nchors.shape[1] == 4)

309 
num_ªchÜs_out
 = 
ªchÜs
.
sh­e
[0]

310 
£lf
.
as£¹True
(
num_ªchÜs_out
 < 
num_ªchÜs_¡riù_uµ”_bound
)

312 
£lf
.
as£¹True
(
Å
.
®l
Òp.
	$g»©”_equ®
(
ªchÜs
, 0)))

313 
£lf
.
	`as£¹True
(
Å
.
	`®l
Òp.
	$Ëss_equ®
(
ªchÜs
[:, 0], 
height
)))

314 
£lf
.
	`as£¹True
(
Å
.
	`®l
Òp.
	$Ëss_equ®
(
ªchÜs
[:, 1], 
width
)))

315 
£lf
.
	`as£¹True
(
Å
.
	`®l
Òp.
	$Ëss_equ®
(
ªchÜs
[:, 2], 
height
)))

316 
£lf
.
	`as£¹True
(
Å
.
	`®l
Òp.
	$Ëss_equ®
(
ªchÜs
[:, 3], 
width
)))

318 
£lf
.
	`as£¹AÎEqu®
(
´ediùiÚ_out
['½n_box_’codšgs'].
sh­e
,

319 (
b©ch_size
, 
num_ªchÜs_out
, 4))

320 
£lf
.
	`as£¹AÎEqu®
(

321 
´ediùiÚ_out
['½n_objeùÃss_´ediùiÚs_w™h_background'].
sh­e
,

322 (
b©ch_size
, 
num_ªchÜs_out
, 2))

324 
def
 
	$‹¡_´ediù_gives_cÜ»ù_sh­es_š_šã»nû_mode_bÙh_¡ages
(
£lf
):

325 
‹¡_g¿ph
 = 
tf
.
	$G¿ph
()

326 
w™h
 
‹¡_g¿ph
.
	$as_deçuÉ
():

327 
mod–
 = 
£lf
.
	$_bud_mod–
(

328 
is_Œaššg
=
F®£
, 
fœ¡_¡age_Úly
=F®£, 
£cÚd_¡age_b©ch_size
=2)

329 
b©ch_size
 = 2

330 
image_size
 = 10

331 
image_sh­e
 = (
b©ch_size
, 
image_size
, image_size, 3)

332 
´•roûs£d_šputs
 = 
tf
.
	$z”os
(
image_sh­e
, 
dty³
=
tf
.
æßt32
)

333 
»suÉ_‹nsÜ_diù
 = 
mod–
.
	$´ediù
(
´•roûs£d_šputs
)

334 
ex³ùed_num_ªchÜs
 = 
image_size
 * image_size * 3 * 3

336 
ex³ùed_sh­es
 = {

338 (2, 
image_size
, image_size, 512),

339 '½n_ã©u»s_to_üİ': (2, 
image_size
, image_size, 3),

341 '½n_box_’codšgs': (2, 
ex³ùed_num_ªchÜs
, 4),

343 (2, 
ex³ùed_num_ªchÜs
, 2),

344 'ªchÜs': (
ex³ùed_num_ªchÜs
, 4),

349 
	}
}

350 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

351 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

352 
£ss
.
	$run
(
š™_İ
)

353 
‹nsÜ_diù_out
 = 
£ss
.
	$run
(
»suÉ_‹nsÜ_diù
)

354 
£lf
.
	`as£¹Equ®
(
	`£t
(
‹nsÜ_diù_out
.
	`keys
()),

355 
	`£t
(
ex³ùed_sh­es
.
	$keys
()))

356 
key
 
š
 
ex³ùed_sh­es
:

357 
£lf
.
	$as£¹AÎEqu®
(
‹nsÜ_diù_out
[
key
].
sh­e
, 
ex³ùed_sh­es
[key])

359 
def
 
	$‹¡_´ediù_gives_cÜ»ù_sh­es_š_Œaš_mode_bÙh_¡ages
(
£lf
):

360 
‹¡_g¿ph
 = 
tf
.
	$G¿ph
()

361 
w™h
 
‹¡_g¿ph
.
	$as_deçuÉ
():

362 
mod–
 = 
£lf
.
	$_bud_mod–
(

363 
is_Œaššg
=
True
, 
fœ¡_¡age_Úly
=
F®£
, 
£cÚd_¡age_b©ch_size
=7)

364 
b©ch_size
 = 2

365 
image_size
 = 10

366 
image_sh­e
 = (
b©ch_size
, 
image_size
, image_size, 3)

367 
´•roûs£d_šputs
 = 
tf
.
	$z”os
(
image_sh­e
, 
dty³
=
tf
.
æßt32
)

368 
groundŒuth_boxes_li¡
 = [

369 
tf
.
	`cÚ¡ªt
([[0, 0, .5, .5], [.5, .5, 1, 1]], 
dty³
ñf.
æßt32
),

370 
tf
.
	`cÚ¡ªt
([[0, .5, .5, 1], [.5, 0, 1, .5]], 
dty³
ñf.
æßt32
)]

371 
groundŒuth_şas£s_li¡
 = [

372 
tf
.
	`cÚ¡ªt
([[1, 0], [0, 1]], 
dty³
ñf.
æßt32
),

373 
tf
.
	`cÚ¡ªt
([[1, 0], [1, 0]], 
dty³
ñf.
æßt32
)]

375 
mod–
.
	$´ovide_groundŒuth
(
groundŒuth_boxes_li¡
,

376 
groundŒuth_şas£s_li¡
)

378 
»suÉ_‹nsÜ_diù
 = 
mod–
.
	$´ediù
(
´•roûs£d_šputs
)

379 
ex³ùed_sh­es
 = {

381 (2, 
image_size
, image_size, 512),

382 '½n_ã©u»s_to_üİ': (2, 
image_size
, image_size, 3),

388 
	}
}

389 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

390 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

391 
£ss
.
	$run
(
š™_İ
)

392 
‹nsÜ_diù_out
 = 
£ss
.
	$run
(
»suÉ_‹nsÜ_diù
)

393 
£lf
.
	`as£¹Equ®
(
	`£t
(
‹nsÜ_diù_out
.
	`keys
()),

394 
	`£t
(
ex³ùed_sh­es
.
	`keys
()).(set([

398 
key
 
š
 
ex³ùed_sh­es
:

399 
£lf
.
	$as£¹AÎEqu®
(
‹nsÜ_diù_out
[
key
].
sh­e
, 
ex³ùed_sh­es
[key])

401 
ªchÜs_sh­e_out
 = 
‹nsÜ_diù_out
['ªchÜs'].
sh­e


402 
£lf
.
	`as£¹Equ®
(2, 
	$Ën
(
ªchÜs_sh­e_out
))

403 
£lf
.
	$as£¹Equ®
(4, 
ªchÜs_sh­e_out
[1])

404 
num_ªchÜs_out
 = 
ªchÜs_sh­e_out
[0]

405 
£lf
.
	`as£¹AÎEqu®
(
‹nsÜ_diù_out
['½n_box_’codšgs'].
sh­e
,

406 (2, 
num_ªchÜs_out
, 4))

407 
£lf
.
	`as£¹AÎEqu®
(

408 
‹nsÜ_diù_out
['½n_objeùÃss_´ediùiÚs_w™h_background'].
sh­e
,

409 (2, 
num_ªchÜs_out
, 2))

411 
def
 
	$‹¡_po¡´oûss_fœ¡_¡age_Úly_šã»nû_mode
(
£lf
):

412 
mod–
 = 
£lf
.
	$_bud_mod–
(

413 
is_Œaššg
=
F®£
, 
fœ¡_¡age_Úly
=
True
, 
£cÚd_¡age_b©ch_size
=6)

414 
b©ch_size
 = 2

415 
ªchÜs
 = 
tf
.
	$cÚ¡ªt
(

419 [16, 16, 32, 32]], 
dty³
=
tf
.
æßt32
)

420 
½n_box_’codšgs
 = 
tf
.
	`z”os
(

421 [
b©ch_size
, 
ªchÜs
.
	`g‘_sh­e
().
	`as_li¡
()[0],

422 
BOX_CODE_SIZE
], 
dty³
=
tf
.
æßt32
)

423 #u£ 
difã»Á
 
numb”s
 
the
 
objeùÃss
 
ÿ‹gÜy
 
to
  
t›s
 
š


424 #Üd” 
of
 
boxes
 
»tuºed
 
by
 
NMS


425 
½n_objeùÃss_´ediùiÚs_w™h_background
 = 
tf
.
	`cÚ¡ªt
([

433 [10, -11]]], 
dty³
=
tf
.
æßt32
)

434 
½n_ã©u»s_to_üİ
 = 
tf
.
	`Úes
((
b©ch_size
, 8, 8, 10), 
dty³
ñf.
æßt32
)

435 
image_sh­e
 = 
tf
.
	$cÚ¡ªt
([
b©ch_size
, 32, 32, 3], 
dty³
=
tf
.
št32
)

436 
´İo§ls
 = 
mod–
.
	`po¡´oûss
({

437 '½n_box_’codšgs': 
½n_box_’codšgs
,

439 
½n_objeùÃss_´ediùiÚs_w™h_background
,

440 '½n_ã©u»s_to_üİ': 
½n_ã©u»s_to_üİ
,

441 'ªchÜs': 
ªchÜs
,

442 'image_sh­e': 
image_sh­e
})

443 
ex³ùed_´İo§l_boxes
 = [

448 
	gex³ùed_´İo§l_scÜes
 = [[1, 1, 0, 0, 0, 0, 0, 0],

450 
	gex³ùed_num_´İo§ls
 = [4, 4]

452 
	gex³ùed_ouut_keys
 = 
£t
(['detection_boxes', 'detection_scores',

454 
	g£lf
.
as£¹Equ®
(
£t
(
´İo§ls
.
keys
()), 
ex³ùed_ouut_keys
)

455 
w™h
 
	g£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

456 
´İo§ls_out
 = 
£ss
.
	$run
(
´İo§ls
)

457 
£lf
.
	`as£¹AÎClo£
(
´İo§ls_out
['detection_boxes'],

458 
ex³ùed_´İo§l_boxes
)

459 
£lf
.
	`as£¹AÎClo£
(
´İo§ls_out
['detection_scores'],

460 
ex³ùed_´İo§l_scÜes
)

461 
£lf
.
	`as£¹AÎEqu®
(
´İo§ls_out
['num_detections'],

462 
ex³ùed_num_´İo§ls
)

464 
def
 
	$‹¡_po¡´oûss_fœ¡_¡age_Úly_Œaš_mode
(
£lf
):

465 
mod–
 = 
£lf
.
	$_bud_mod–
(

466 
is_Œaššg
=
True
, 
fœ¡_¡age_Úly
=True, 
£cÚd_¡age_b©ch_size
=2)

467 
b©ch_size
 = 2

468 
ªchÜs
 = 
tf
.
	$cÚ¡ªt
(

472 [16, 16, 32, 32]], 
dty³
=
tf
.
æßt32
)

473 
½n_box_’codšgs
 = 
tf
.
	`z”os
(

474 [
b©ch_size
, 
ªchÜs
.
	`g‘_sh­e
().
	`as_li¡
()[0],

475 
BOX_CODE_SIZE
], 
dty³
=
tf
.
æßt32
)

476 #u£ 
difã»Á
 
numb”s
 
the
 
objeùÃss
 
ÿ‹gÜy
 
to
  
t›s
 
š


477 #Üd” 
of
 
boxes
 
»tuºed
 
by
 
NMS


478 
½n_objeùÃss_´ediùiÚs_w™h_background
 = 
tf
.
	`cÚ¡ªt
([

486 [-10, 10]]], 
dty³
=
tf
.
æßt32
)

487 
½n_ã©u»s_to_üİ
 = 
tf
.
	`Úes
((
b©ch_size
, 8, 8, 10), 
dty³
ñf.
æßt32
)

488 
image_sh­e
 = 
tf
.
	$cÚ¡ªt
([
b©ch_size
, 32, 32, 3], 
dty³
=
tf
.
št32
)

489 
groundŒuth_boxes_li¡
 = [

490 
tf
.
	`cÚ¡ªt
([[0, 0, .5, .5], [.5, .5, 1, 1]], 
dty³
ñf.
æßt32
),

491 
tf
.
	`cÚ¡ªt
([[0, .5, .5, 1], [.5, 0, 1, .5]], 
dty³
ñf.
æßt32
)]

492 
groundŒuth_şas£s_li¡
 = [
tf
.
	`cÚ¡ªt
([[1, 0], [0, 1]], 
dty³
ñf.
æßt32
),

493 
tf
.
	`cÚ¡ªt
([[1, 0], [1, 0]], 
dty³
ñf.
æßt32
)]

495 
mod–
.
	$´ovide_groundŒuth
(
groundŒuth_boxes_li¡
,

496 
groundŒuth_şas£s_li¡
)

497 
´İo§ls
 = 
mod–
.
	`po¡´oûss
({

498 '½n_box_’codšgs': 
½n_box_’codšgs
,

500 
½n_objeùÃss_´ediùiÚs_w™h_background
,

501 '½n_ã©u»s_to_üİ': 
½n_ã©u»s_to_üİ
,

502 'ªchÜs': 
ªchÜs
,

503 'image_sh­e': 
image_sh­e
})

504 
ex³ùed_´İo§l_boxes
 = [

506 
	gex³ùed_´İo§l_scÜes
 = [[1, 1],

508 
	gex³ùed_num_´İo§ls
 = [2, 2]

510 
	gex³ùed_ouut_keys
 = 
£t
(['detection_boxes', 'detection_scores',

512 
	g£lf
.
as£¹Equ®
(
£t
(
´İo§ls
.
keys
()), 
ex³ùed_ouut_keys
)

514 
w™h
 
	g£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

515 
´İo§ls_out
 = 
£ss
.
	$run
(
´İo§ls
)

516 
£lf
.
	`as£¹AÎClo£
(
´İo§ls_out
['detection_boxes'],

517 
ex³ùed_´İo§l_boxes
)

518 
£lf
.
	`as£¹AÎClo£
(
´İo§ls_out
['detection_scores'],

519 
ex³ùed_´İo§l_scÜes
)

520 
£lf
.
	`as£¹AÎEqu®
(
´İo§ls_out
['num_detections'],

521 
ex³ùed_num_´İo§ls
)

523 
def
 
	$‹¡_po¡´oûss_£cÚd_¡age_Úly_šã»nû_mode
(
£lf
):

524 
num_´İo§ls_sh­es
 = [(2), (
NÚe
)]

525 
»fšed_box_’codšgs_sh­es
 = [(16, 2, 4), (
NÚe
, 2, 4)]

526 
şass_´ediùiÚs_w™h_background_sh­es
 = [(16, 3), (
NÚe
, 3)]

527 
´İo§l_boxes_sh­es
 = [(2, 8, 4), (
NÚe
, 8, 4)]

528 
b©ch_size
 = 2

529 
image_sh­e
 = 
Å
.
	`¬¿y
((2, 36, 48, 3), 
dty³
òp.
št32
)

530 
num_´İo§ls_sh­e
, 
»fšed_box_’codšg_sh­e
,

531 
şass_´ediùiÚs_w™h_background_sh­e
,

532 
´İo§l_boxes_sh­e
è
š
 
	$z
(
num_´İo§ls_sh­es
,

533 
»fšed_box_’codšgs_sh­es
,

534 
şass_´ediùiÚs_w™h_background_sh­es
,

535 
´İo§l_boxes_sh­es
):

536 
tf_g¿ph
 = 
tf
.
	$G¿ph
()

537 
w™h
 
tf_g¿ph
.
	$as_deçuÉ
():

538 
mod–
 = 
£lf
.
	$_bud_mod–
(

539 
is_Œaššg
=
F®£
, 
fœ¡_¡age_Úly
=False,

540 
£cÚd_¡age_b©ch_size
=6)

541 
tÙ®_num_·dded_´İo§ls
 = 
b©ch_size
 * 
mod–
.
max_num_´İo§ls


542 
´İo§l_boxes
 = 
Å
.
	$¬¿y
(

550 
num_´İo§ls
 = 
Å
.
	$¬¿y
([3, 2], 
dty³
=
Å
.
št32
)

551 
»fšed_box_’codšgs
 = 
Å
.
	$z”os
(

552 [
tÙ®_num_·dded_´İo§ls
, 
mod–
.
num_şas£s
, 4])

553 
şass_´ediùiÚs_w™h_background
 = 
Å
.
	`Úes
(

554 [
tÙ®_num_·dded_´İo§ls
, 
mod–
.
num_şas£s
+1])

556 
num_´İo§ls_¶aûhŞd”
 = 
tf
.
	$¶aûhŞd”
(
tf
.
št32
,

557 
sh­e
=
num_´İo§ls_sh­e
)

558 
»fšed_box_’codšgs_¶aûhŞd”
 = 
tf
.
	$¶aûhŞd”
(

559 
tf
.
æßt32
, 
sh­e
=
»fšed_box_’codšg_sh­e
)

560 
şass_´ediùiÚs_w™h_background_¶aûhŞd”
 = 
tf
.
	$¶aûhŞd”
(

561 
tf
.
æßt32
, 
sh­e
=
şass_´ediùiÚs_w™h_background_sh­e
)

562 
´İo§l_boxes_¶aûhŞd”
 = 
tf
.
	$¶aûhŞd”
(

563 
tf
.
æßt32
, 
sh­e
=
´İo§l_boxes_sh­e
)

564 
image_sh­e_¶aûhŞd”
 = 
tf
.
	`¶aûhŞd”
Ñf.
št32
, 
sh­e
=(4))

566 
d‘eùiÚs
 = 
mod–
.
	`po¡´oûss
({

567 '»fšed_box_’codšgs': 
»fšed_box_’codšgs_¶aûhŞd”
,

569 
şass_´ediùiÚs_w™h_background_¶aûhŞd”
,

570 'num_´İo§ls': 
num_´İo§ls_¶aûhŞd”
,

571 '´İo§l_boxes': 
´İo§l_boxes_¶aûhŞd”
,

572 'image_sh­e': 
image_sh­e_¶aûhŞd”
,

573 
	}
})

574 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(
g¿ph
=
tf_g¿ph
è
as
 
£ss
:

575 
d‘eùiÚs_out
 = 
£ss
.
	`run
(

576 
d‘eùiÚs
,

577 
ãed_diù
={

578 
»fšed_box_’codšgs_¶aûhŞd”
: 
»fšed_box_’codšgs
,

579 
şass_´ediùiÚs_w™h_background_¶aûhŞd”
:

580 
şass_´ediùiÚs_w™h_background
,

581 
num_´İo§ls_¶aûhŞd”
: 
num_´İo§ls
,

582 
´İo§l_boxes_¶aûhŞd”
: 
´İo§l_boxes
,

583 
image_sh­e_¶aûhŞd”
: 
image_sh­e


584 
	}
})

585 
£lf
.
as£¹AÎEqu®
(
d‘eùiÚs_out
['d‘eùiÚ_boxes'].
sh­e
, [2, 5, 4])

586 
	g£lf
.
as£¹AÎClo£
(
d‘eùiÚs_out
['detection_scores'],

588 
	g£lf
.
as£¹AÎClo£
(
d‘eùiÚs_out
['detection_classes'],

590 
	g£lf
.
as£¹AÎClo£
(
d‘eùiÚs_out
['num_detections'], [5, 4])

592 
def
 
	$‹¡_´•roûss_´e£rves_šput_sh­es
(
£lf
):

593 
image_sh­es
 = [(3, 
NÚe
, None, 3),

594 (
NÚe
, 10, 10, 3),

595 (
NÚe
, None, None, 3)]

596 
image_sh­e
 
š
 
image_sh­es
:

597 
mod–
 = 
£lf
.
	$_bud_mod–
(

598 
is_Œaššg
=
F®£
, 
fœ¡_¡age_Úly
=F®£, 
£cÚd_¡age_b©ch_size
=6)

599 
image_¶aûhŞd”
 = 
tf
.
	$¶aûhŞd”
(
tf
.
æßt32
, 
sh­e
=
image_sh­e
)

600 
´•roûs£d_šputs
 = 
mod–
.
	$´•roûss
(
image_¶aûhŞd”
)

601 
£lf
.
	`as£¹AÎEqu®
(
´•roûs£d_šputs
.
sh­e
.
	`as_li¡
(), 
image_sh­e
)

603 
def
 
	$‹¡_loss_fœ¡_¡age_Úly_mode
(
£lf
):

604 
mod–
 = 
£lf
.
	$_bud_mod–
(

605 
is_Œaššg
=
True
, 
fœ¡_¡age_Úly
=True, 
£cÚd_¡age_b©ch_size
=6)

606 
b©ch_size
 = 2

607 
ªchÜs
 = 
tf
.
	$cÚ¡ªt
(

611 [16, 16, 32, 32]], 
dty³
=
tf
.
æßt32
)

613 
½n_box_’codšgs
 = 
tf
.
	`z”os
(

614 [
b©ch_size
,

615 
ªchÜs
.
	`g‘_sh­e
().
	`as_li¡
()[0],

616 
BOX_CODE_SIZE
], 
dty³
=
tf
.
æßt32
)

617 #u£ 
difã»Á
 
numb”s
 
the
 
objeùÃss
 
ÿ‹gÜy
 
to
  
t›s
 
š


618 #Üd” 
of
 
boxes
 
»tuºed
 
by
 
NMS


619 
½n_objeùÃss_´ediùiÚs_w™h_background
 = 
tf
.
	`cÚ¡ªt
([

627 [10, -11]]], 
dty³
=
tf
.
æßt32
)

628 
image_sh­e
 = 
tf
.
	$cÚ¡ªt
([
b©ch_size
, 32, 32, 3], 
dty³
=
tf
.
št32
)

630 
groundŒuth_boxes_li¡
 = [

631 
tf
.
	`cÚ¡ªt
([[0, 0, .5, .5], [.5, .5, 1, 1]], 
dty³
ñf.
æßt32
),

632 
tf
.
	`cÚ¡ªt
([[0, .5, .5, 1], [.5, 0, 1, .5]], 
dty³
ñf.
æßt32
)]

633 
groundŒuth_şas£s_li¡
 = [
tf
.
	`cÚ¡ªt
([[1, 0], [0, 1]], 
dty³
ñf.
æßt32
),

634 
tf
.
	`cÚ¡ªt
([[1, 0], [1, 0]], 
dty³
ñf.
æßt32
)]

636 
´ediùiÚ_diù
 = {

637 '½n_box_’codšgs': 
½n_box_’codšgs
,

639 
½n_objeùÃss_´ediùiÚs_w™h_background
,

640 'image_sh­e': 
image_sh­e
,

641 'ªchÜs': 
ªchÜs


642 
	}
}

643 
mod–
.
	$´ovide_groundŒuth
(
groundŒuth_boxes_li¡
,

644 
groundŒuth_şas£s_li¡
)

645 
loss_diù
 = 
mod–
.
	$loss
(
´ediùiÚ_diù
)

646 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

647 
loss_diù_out
 = 
£ss
.
	$run
(
loss_diù
)

648 
£lf
.
	`as£¹AÎClo£
(
loss_diù_out
['first_stage_localization_loss'], 0)

649 
£lf
.
	`as£¹AÎClo£
(
loss_diù_out
['first_stage_objectness_loss'], 0)

650 
£lf
.
	`as£¹True
('£cÚd_¡age_loÿliz©iÚ_loss' 
nÙ
 
š
 
loss_diù_out
)

651 
£lf
.
	`as£¹True
('£cÚd_¡age_şassifiÿtiÚ_loss' 
nÙ
 
š
 
loss_diù_out
)

653 
def
 
	$‹¡_loss_fuÎ
(
£lf
):

654 
mod–
 = 
£lf
.
	$_bud_mod–
(

655 
is_Œaššg
=
True
, 
fœ¡_¡age_Úly
=
F®£
, 
£cÚd_¡age_b©ch_size
=6)

656 
b©ch_size
 = 2

657 
ªchÜs
 = 
tf
.
	$cÚ¡ªt
(

661 [16, 16, 32, 32]], 
dty³
=
tf
.
æßt32
)

662 
½n_box_’codšgs
 = 
tf
.
	`z”os
(

663 [
b©ch_size
,

664 
ªchÜs
.
	`g‘_sh­e
().
	`as_li¡
()[0],

665 
BOX_CODE_SIZE
], 
dty³
=
tf
.
æßt32
)

666 #u£ 
difã»Á
 
numb”s
 
the
 
objeùÃss
 
ÿ‹gÜy
 
to
  
t›s
 
š


667 #Üd” 
of
 
boxes
 
»tuºed
 
by
 
NMS


668 
½n_objeùÃss_´ediùiÚs_w™h_background
 = 
tf
.
	`cÚ¡ªt
([

676 [10, -11]]], 
dty³
=
tf
.
æßt32
)

677 
image_sh­e
 = 
tf
.
	$cÚ¡ªt
([
b©ch_size
, 32, 32, 3], 
dty³
=
tf
.
št32
)

679 
num_´İo§ls
 = 
tf
.
	$cÚ¡ªt
([6, 6], 
dty³
=
tf
.
št32
)

680 
´İo§l_boxes
 = 
tf
.
	$cÚ¡ªt
(

686 [0, 16, 16, 32]]], 
dty³
=
tf
.
æßt32
)

687 
»fšed_box_’codšgs
 = 
tf
.
	`z”os
(

688 (
b©ch_size
 * 
mod–
.
max_num_´İo§ls
,

689 
mod–
.
num_şas£s
,

690 
BOX_CODE_SIZE
), 
dty³
=
tf
.
æßt32
)

691 
şass_´ediùiÚs_w™h_background
 = 
tf
.
	`cÚ¡ªt
(

692 [[-10, 10, -10], #fœ¡ 
image


698 [10, -10, -10], #£cÚd 
image


703 [-10, 10, -10]], 
dty³
=
tf
.
æßt32
)

705 
groundŒuth_boxes_li¡
 = [

706 
tf
.
	`cÚ¡ªt
([[0, 0, .5, .5], [.5, .5, 1, 1]], 
dty³
ñf.
æßt32
),

707 
tf
.
	`cÚ¡ªt
([[0, .5, .5, 1], [.5, 0, 1, .5]], 
dty³
ñf.
æßt32
)]

708 
groundŒuth_şas£s_li¡
 = [
tf
.
	`cÚ¡ªt
([[1, 0], [0, 1]], 
dty³
ñf.
æßt32
),

709 
tf
.
	`cÚ¡ªt
([[1, 0], [1, 0]], 
dty³
ñf.
æßt32
)]

711 
´ediùiÚ_diù
 = {

712 '½n_box_’codšgs': 
½n_box_’codšgs
,

714 
½n_objeùÃss_´ediùiÚs_w™h_background
,

715 'image_sh­e': 
image_sh­e
,

716 'ªchÜs': 
ªchÜs
,

717 '»fšed_box_’codšgs': 
»fšed_box_’codšgs
,

718 'şass_´ediùiÚs_w™h_background': 
şass_´ediùiÚs_w™h_background
,

719 '´İo§l_boxes': 
´İo§l_boxes
,

720 'num_´İo§ls': 
num_´İo§ls


721 
	}
}

722 
mod–
.
	$´ovide_groundŒuth
(
groundŒuth_boxes_li¡
,

723 
groundŒuth_şas£s_li¡
)

724 
loss_diù
 = 
mod–
.
	$loss
(
´ediùiÚ_diù
)

726 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

727 
loss_diù_out
 = 
£ss
.
	$run
(
loss_diù
)

728 
£lf
.
	`as£¹AÎClo£
(
loss_diù_out
['first_stage_localization_loss'], 0)

729 
£lf
.
	`as£¹AÎClo£
(
loss_diù_out
['first_stage_objectness_loss'], 0)

730 
£lf
.
	`as£¹AÎClo£
(
loss_diù_out
['second_stage_localization_loss'], 0)

731 
£lf
.
	`as£¹AÎClo£
(
loss_diù_out
['second_stage_classification_loss'], 0)

733 
def
 
	$‹¡_loss_fuÎ_z”o_·dded_´İo§ls
(
£lf
):

734 
mod–
 = 
£lf
.
	$_bud_mod–
(

735 
is_Œaššg
=
True
, 
fœ¡_¡age_Úly
=
F®£
, 
£cÚd_¡age_b©ch_size
=6)

736 
b©ch_size
 = 1

737 
ªchÜs
 = 
tf
.
	$cÚ¡ªt
(

741 [16, 16, 32, 32]], 
dty³
=
tf
.
æßt32
)

742 
½n_box_’codšgs
 = 
tf
.
	`z”os
(

743 [
b©ch_size
,

744 
ªchÜs
.
	`g‘_sh­e
().
	`as_li¡
()[0],

745 
BOX_CODE_SIZE
], 
dty³
=
tf
.
æßt32
)

746 #u£ 
difã»Á
 
numb”s
 
the
 
objeùÃss
 
ÿ‹gÜy
 
to
  
t›s
 
š


747 #Üd” 
of
 
boxes
 
»tuºed
 
by
 
NMS


748 
½n_objeùÃss_´ediùiÚs_w™h_background
 = 
tf
.
	`cÚ¡ªt
([

752 [10, -12]],], 
dty³
=
tf
.
æßt32
)

753 
image_sh­e
 = 
tf
.
	$cÚ¡ªt
([
b©ch_size
, 32, 32, 3], 
dty³
=
tf
.
št32
)

755 #box_şassif›r_b©ch_siz
is
 6, 
but
 
h”e
 
we
 
assume
 
th©
 
the
 
numb”
 
of


756 #aùu® 
	`´İo§ls
 (
nÙ
 
couÁšg
 
z”o
 
·ddšgs
è
is
 
	`ãw”
 (3).

757 
num_´İo§ls
 = 
tf
.
	$cÚ¡ªt
([3], 
dty³
=
tf
.
št32
)

758 
´İo§l_boxes
 = 
tf
.
	`cÚ¡ªt
(

762 [0, 0, 0, 0], #begš 
·ddšgs


764 [0, 0, 0, 0]]], 
dty³
=
tf
.
æßt32
)

766 
»fšed_box_’codšgs
 = 
tf
.
	`z”os
(

767 (
b©ch_size
 * 
mod–
.
max_num_´İo§ls
,

768 
mod–
.
num_şas£s
,

769 
BOX_CODE_SIZE
), 
dty³
=
tf
.
æßt32
)

770 
şass_´ediùiÚs_w™h_background
 = 
tf
.
	`cÚ¡ªt
(

774 [0, 0, 0], #begš 
·ddšgs


776 [0, 0, 0]], 
dty³
=
tf
.
æßt32
)

778 
groundŒuth_boxes_li¡
 = [

779 
tf
.
	`cÚ¡ªt
([[0, 0, .5, .5]], 
dty³
ñf.
æßt32
)]

780 
groundŒuth_şas£s_li¡
 = [
tf
.
	`cÚ¡ªt
([[1, 0]], 
dty³
ñf.
æßt32
)]

782 
´ediùiÚ_diù
 = {

783 '½n_box_’codšgs': 
½n_box_’codšgs
,

785 
½n_objeùÃss_´ediùiÚs_w™h_background
,

786 'image_sh­e': 
image_sh­e
,

787 'ªchÜs': 
ªchÜs
,

788 '»fšed_box_’codšgs': 
»fšed_box_’codšgs
,

789 'şass_´ediùiÚs_w™h_background': 
şass_´ediùiÚs_w™h_background
,

790 '´İo§l_boxes': 
´İo§l_boxes
,

791 'num_´İo§ls': 
num_´İo§ls


792 
	}
}

793 
mod–
.
	$´ovide_groundŒuth
(
groundŒuth_boxes_li¡
,

794 
groundŒuth_şas£s_li¡
)

795 
loss_diù
 = 
mod–
.
	$loss
(
´ediùiÚ_diù
)

797 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

798 
loss_diù_out
 = 
£ss
.
	$run
(
loss_diù
)

799 
£lf
.
	`as£¹AÎClo£
(
loss_diù_out
['first_stage_localization_loss'], 0)

800 
£lf
.
	`as£¹AÎClo£
(
loss_diù_out
['first_stage_objectness_loss'], 0)

801 
£lf
.
	`as£¹AÎClo£
(
loss_diù_out
['second_stage_localization_loss'], 0)

802 
£lf
.
	`as£¹AÎClo£
(
loss_diù_out
['second_stage_classification_loss'], 0)

804 
def
 
	$‹¡_loss_fuÎ_z”o_·dded_´İo§ls_nÚz”o_loss_w™h_two_images
(
£lf
):

805 
mod–
 = 
£lf
.
	$_bud_mod–
(

806 
is_Œaššg
=
True
, 
fœ¡_¡age_Úly
=
F®£
, 
£cÚd_¡age_b©ch_size
=6)

807 
b©ch_size
 = 2

808 
ªchÜs
 = 
tf
.
	$cÚ¡ªt
(

812 [16, 16, 32, 32]], 
dty³
=
tf
.
æßt32
)

813 
½n_box_’codšgs
 = 
tf
.
	`z”os
(

814 [
b©ch_size
,

815 
ªchÜs
.
	`g‘_sh­e
().
	`as_li¡
()[0],

816 
BOX_CODE_SIZE
], 
dty³
=
tf
.
æßt32
)

817 #u£ 
difã»Á
 
numb”s
 
the
 
objeùÃss
 
ÿ‹gÜy
 
to
  
t›s
 
š


818 #Üd” 
of
 
boxes
 
»tuºed
 
by
 
NMS


819 
½n_objeùÃss_´ediùiÚs_w™h_background
 = 
tf
.
	`cÚ¡ªt
(

827 [10, -12]]], 
dty³
=
tf
.
æßt32
)

828 
image_sh­e
 = 
tf
.
	$cÚ¡ªt
([
b©ch_size
, 32, 32, 3], 
dty³
=
tf
.
št32
)

830 #box_şassif›r_b©ch_siz
is
 6, 
but
 
h”e
 
we
 
assume
 
th©
 
the
 
numb”
 
of


831 #aùu® 
	`´İo§ls
 (
nÙ
 
couÁšg
 
z”o
 
·ddšgs
è
is
 
	`ãw”
 (3).

832 
num_´İo§ls
 = 
tf
.
	$cÚ¡ªt
([3, 2], 
dty³
=
tf
.
št32
)

833 
´İo§l_boxes
 = 
tf
.
	`cÚ¡ªt
(

837 [0, 0, 0, 0], #begš 
·ddšgs


843 [0, 0, 0, 0], #begš 
·ddšgs


845 [0, 0, 0, 0]]], 
dty³
=
tf
.
æßt32
)

847 
»fšed_box_’codšgs
 = 
tf
.
	`z”os
(

848 (
b©ch_size
 * 
mod–
.
max_num_´İo§ls
,

849 
mod–
.
num_şas£s
,

850 
BOX_CODE_SIZE
), 
dty³
=
tf
.
æßt32
)

851 
şass_´ediùiÚs_w™h_background
 = 
tf
.
	`cÚ¡ªt
(

852 [[-10, 10, -10], #fœ¡ 
image


855 [0, 0, 0], #begš 
·ddšgs


858 [-10, -10, 10], #£cÚd 
image


860 [0, 0, 0], #begš 
·ddšgs


863 [0, 0, 0],], 
dty³
=
tf
.
æßt32
)

865 #Th
fœ¡
 
groundŒuth
 
box
 
is
 4/5 
of
 
the
 
ªchÜ
 
size
 
š
 
bÙh
 
dœeùiÚs


866 #ex³r›ncšg 
a
 
loss
 
of
:

867 #2 * 
	`SmoÙhL1
(5 * 
	`log
(4/5)è/ 
num_´İo§ls


868 #ğ2 * (
	`abs
(5 * 
	`log
(1/2)) - .5) / 3

869 #Th
£cÚd
 
groundŒuth
 
box
 
is
 
id’tiÿl
 
to
 
the
 
´ediùiÚ
 
ªd
 
thus


870 #ex³r›nû 
z”o
 
loss
.

871 #TÙ® 
av”age
 
loss
 
	`is
 (
	`abs
(5 * 
	`log
(1/2)) - .5) / 3.

872 
groundŒuth_boxes_li¡
 = [

873 
tf
.
	`cÚ¡ªt
([[0.05, 0.05, 0.45, 0.45]], 
dty³
ñf.
æßt32
),

874 
tf
.
	`cÚ¡ªt
([[0.0, 0.0, 0.5, 0.5]], 
dty³
ñf.
æßt32
)]

875 
groundŒuth_şas£s_li¡
 = [
tf
.
	`cÚ¡ªt
([[1, 0]], 
dty³
ñf.
æßt32
),

876 
tf
.
	`cÚ¡ªt
([[0, 1]], 
dty³
ñf.
æßt32
)]

877 
exp_loc_loss
 = (-5 * 
Å
.
	`log
(.8) - 0.5) / 3.0

879 
´ediùiÚ_diù
 = {

880 '½n_box_’codšgs': 
½n_box_’codšgs
,

882 
½n_objeùÃss_´ediùiÚs_w™h_background
,

883 'image_sh­e': 
image_sh­e
,

884 'ªchÜs': 
ªchÜs
,

885 '»fšed_box_’codšgs': 
»fšed_box_’codšgs
,

886 'şass_´ediùiÚs_w™h_background': 
şass_´ediùiÚs_w™h_background
,

887 '´İo§l_boxes': 
´İo§l_boxes
,

888 'num_´İo§ls': 
num_´İo§ls


889 
	}
}

890 
mod–
.
	$´ovide_groundŒuth
(
groundŒuth_boxes_li¡
,

891 
groundŒuth_şas£s_li¡
)

892 
loss_diù
 = 
mod–
.
	$loss
(
´ediùiÚ_diù
)

894 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

895 
loss_diù_out
 = 
£ss
.
	$run
(
loss_diù
)

896 
£lf
.
	`as£¹AÎClo£
(
loss_diù_out
['first_stage_localization_loss'],

897 
exp_loc_loss
)

898 
£lf
.
	`as£¹AÎClo£
(
loss_diù_out
['first_stage_objectness_loss'], 0)

899 
£lf
.
	`as£¹AÎClo£
(
loss_diù_out
['second_stage_localization_loss'],

900 
exp_loc_loss
)

901 
£lf
.
	`as£¹AÎClo£
(
loss_diù_out
['second_stage_classification_loss'], 0)

903 
def
 
	$‹¡_loss_w™h_h¬d_mššg
(
£lf
):

904 
mod–
 = 
£lf
.
	$_bud_mod–
(
is_Œaššg
=
True
,

905 
fœ¡_¡age_Úly
=
F®£
,

906 
£cÚd_¡age_b©ch_size
=
NÚe
,

907 
fœ¡_¡age_max_´İo§ls
=6,

908 
h¬d_mššg
=
True
)

909 
b©ch_size
 = 1

910 
ªchÜs
 = 
tf
.
	$cÚ¡ªt
(

914 [16, 16, 32, 32]], 
dty³
=
tf
.
æßt32
)

915 
½n_box_’codšgs
 = 
tf
.
	`z”os
(

916 [
b©ch_size
,

917 
ªchÜs
.
	`g‘_sh­e
().
	`as_li¡
()[0],

918 
BOX_CODE_SIZE
], 
dty³
=
tf
.
æßt32
)

919 #u£ 
difã»Á
 
numb”s
 
the
 
objeùÃss
 
ÿ‹gÜy
 
to
  
t›s
 
š


920 #Üd” 
of
 
boxes
 
»tuºed
 
by
 
NMS


921 
½n_objeùÃss_´ediùiÚs_w™h_background
 = 
tf
.
	`cÚ¡ªt
(

925 [10, -12]]], 
dty³
=
tf
.
æßt32
)

926 
image_sh­e
 = 
tf
.
	$cÚ¡ªt
([
b©ch_size
, 32, 32, 3], 
dty³
=
tf
.
št32
)

928 #box_şassif›r_b©ch_siz
is
 6, 
but
 
h”e
 
we
 
assume
 
th©
 
the
 
numb”
 
of


929 #aùu® 
	`´İo§ls
 (
nÙ
 
couÁšg
 
z”o
 
·ddšgs
è
is
 
	`ãw”
 (3).

930 
num_´İo§ls
 = 
tf
.
	$cÚ¡ªt
([3], 
dty³
=
tf
.
št32
)

931 
´İo§l_boxes
 = 
tf
.
	`cÚ¡ªt
(

935 [0, 0, 0, 0], #begš 
·ddšgs


937 [0, 0, 0, 0]]], 
dty³
=
tf
.
æßt32
)

939 
»fšed_box_’codšgs
 = 
tf
.
	`z”os
(

940 (
b©ch_size
 * 
mod–
.
max_num_´İo§ls
,

941 
mod–
.
num_şas£s
,

942 
BOX_CODE_SIZE
), 
dty³
=
tf
.
æßt32
)

943 
şass_´ediùiÚs_w™h_background
 = 
tf
.
	`cÚ¡ªt
(

944 [[-10, 10, -10], #fœ¡ 
image


947 [0, 0, 0], #begš 
·ddšgs


949 [0, 0, 0]], 
dty³
=
tf
.
æßt32
)

951 #Th
fœ¡
 
groundŒuth
 
box
 
is
 4/5 
of
 
the
 
ªchÜ
 
size
 
š
 
bÙh
 
dœeùiÚs


952 #ex³r›ncšg 
a
 
loss
 
of
:

953 #2 * 
	`SmoÙhL1
(5 * 
	`log
(4/5)è/ 
num_´İo§ls


954 #ğ2 * (
	`abs
(5 * 
	`log
(1/2)) - .5) / 3

955 #Th
£cÚd
 
groundŒuth
 
box
 
is
 46/50 
of
 
the
 
ªchÜ
 
size
 
š
 
bÙh
 
dœeùiÚs


956 #ex³r›ncšg 
a
 
loss
 
of
:

957 #2 * 
	`SmoÙhL1
(5 * 
	`log
(42/50)è/ 
num_´İo§ls


958 #ğ2 * (.5(5 * 
	`log
(.92))^2 - .5) / 3.

959 #Sšû 
the
 
fœ¡
 
groundŒuth
 
box
 
ex³r›nûs
 
g»©”
 
loss
, 
ªd
 
we
 
have


960 #£ˆ
num_h¬d_exam¶es
=1 
š
 
the
 
H¬dMš”
,h
fš®
 
loÿliz©iÚ
 
loss


961 #cÜ»¥Úd 
to
 
th©
 
of
 
the
 
fœ¡
 
groundŒuth
 
box
.

962 
groundŒuth_boxes_li¡
 = [

963 
tf
.
	`cÚ¡ªt
([[0.05, 0.05, 0.45, 0.45],

964 [0.02, 0.52, 0.48, 0.98],], 
dty³
=
tf
.
æßt32
)]

965 
groundŒuth_şas£s_li¡
 = [
tf
.
	`cÚ¡ªt
([[1, 0], [0, 1]], 
dty³
ñf.
æßt32
)]

966 
exp_loc_loss
 = 2 * (-5 * 
Å
.
	`log
(.8) - 0.5) / 3.0

968 
´ediùiÚ_diù
 = {

969 '½n_box_’codšgs': 
½n_box_’codšgs
,

971 
½n_objeùÃss_´ediùiÚs_w™h_background
,

972 'image_sh­e': 
image_sh­e
,

973 'ªchÜs': 
ªchÜs
,

974 '»fšed_box_’codšgs': 
»fšed_box_’codšgs
,

975 'şass_´ediùiÚs_w™h_background': 
şass_´ediùiÚs_w™h_background
,

976 '´İo§l_boxes': 
´İo§l_boxes
,

977 'num_´İo§ls': 
num_´İo§ls


978 
	}
}

979 
mod–
.
	$´ovide_groundŒuth
(
groundŒuth_boxes_li¡
,

980 
groundŒuth_şas£s_li¡
)

981 
loss_diù
 = 
mod–
.
	$loss
(
´ediùiÚ_diù
)

983 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

984 
loss_diù_out
 = 
£ss
.
	$run
(
loss_diù
)

985 
£lf
.
	`as£¹AÎClo£
(
loss_diù_out
['second_stage_localization_loss'],

986 
exp_loc_loss
)

987 
£lf
.
	`as£¹AÎClo£
(
loss_diù_out
['second_stage_classification_loss'], 0)

989 
def
 
	$‹¡_»¡Üe_m­_fÜ_şassifiÿtiÚ_ck±
(
£lf
):

990 #Defš
mock
 
‹nsÜæow
 
şassifiÿtiÚ
 
g¿ph
 
ªd
 
§ve
 
v¬ŸbËs
.

991 
‹¡_g¿ph_şassifiÿtiÚ
 = 
tf
.
	$G¿ph
()

992 
w™h
 
‹¡_g¿ph_şassifiÿtiÚ
.
	$as_deçuÉ
():

993 
image
 = 
tf
.
	$¶aûhŞd”
(
dty³
=
tf
.
æßt32
, 
sh­e
=[1, 20, 20, 3])

994 
w™h
 
tf
.
	`v¬ŸbË_scİe
('mock_model'):

995 
Ãt
 = 
¦im
.
	`cÚv2d
(
image
, 
num_ouuts
=3, 
k”Ãl_size
=1, 
scİe
='layer1')

996 
¦im
.
	`cÚv2d
(
Ãt
, 
num_ouuts
=3, 
k”Ãl_size
=1, 
scİe
='layer2')

998 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

999 
§v”
 = 
tf
.
Œaš
.
	$Sav”
()

1000 
§ve_·th
 = 
£lf
.
	$g‘_‹mp_dœ
()

1001 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1002 
£ss
.
	$run
(
š™_İ
)

1003 
§ved_mod–_·th
 = 
§v”
.
	$§ve
(
£ss
, 
§ve_·th
)

1005 #C»©
‹nsÜæow
 
d‘eùiÚ
 
g¿ph
 
ªd
 
lßd
 
v¬ŸbËs
 
äom


1006 #şassifiÿtiÚ 
checkpošt
.

1007 
‹¡_g¿ph_d‘eùiÚ
 = 
tf
.
	$G¿ph
()

1008 
w™h
 
‹¡_g¿ph_d‘eùiÚ
.
	$as_deçuÉ
():

1009 
mod–
 = 
£lf
.
	$_bud_mod–
(

1010 
is_Œaššg
=
F®£
, 
fœ¡_¡age_Úly
=F®£, 
£cÚd_¡age_b©ch_size
=6)

1012 
šputs_sh­e
 = (2, 20, 20, 3)

1013 
šputs
 = 
tf
.
	`to_æßt
Ñf.
	$¿ndom_unifÜm
(

1014 
šputs_sh­e
, 
mšv®
=0, 
maxv®
=255, 
dty³
=
tf
.
št32
))

1015 
´•roûs£d_šputs
 = 
mod–
.
	$´•roûss
(
šputs
)

1016 
´ediùiÚ_diù
 = 
mod–
.
	$´ediù
(
´•roûs£d_šputs
)

1017 
mod–
.
	$po¡´oûss
(
´ediùiÚ_diù
)

1018 
v¬_m­
 = 
mod–
.
	$»¡Üe_m­
(
äom_d‘eùiÚ_checkpošt
=
F®£
)

1019 
£lf
.
	$as£¹IsIn¡ªû
(
v¬_m­
, 
diù
)

1020 
§v”
 = 
tf
.
Œaš
.
	$Sav”
(
v¬_m­
)

1021 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1022 
§v”
.
	$»¡Üe
(
£ss
, 
§ved_mod–_·th
)

1023 
v¬
 
š
 
£ss
.
	`run
(
tf
.
	$»pÜt_unš™Ÿlized_v¬ŸbËs
()):

1024 
£lf
.
	$as£¹NÙIn
(
mod–
.
fœ¡_¡age_ã©u»_exŒaùÜ_scİe
, 
v¬
.
Çme
)

1025 
£lf
.
	$as£¹NÙIn
(
mod–
.
£cÚd_¡age_ã©u»_exŒaùÜ_scİe
,

1026 
v¬
.
Çme
)

1028 
def
 
	$‹¡_»¡Üe_m­_fÜ_d‘eùiÚ_ck±
(
£lf
):

1029 #Defš
fœ¡
 
d‘eùiÚ
 
g¿ph
 
ªd
 
§ve
 
v¬ŸbËs
.

1030 
‹¡_g¿ph_d‘eùiÚ1
 = 
tf
.
	$G¿ph
()

1031 
w™h
 
‹¡_g¿ph_d‘eùiÚ1
.
	$as_deçuÉ
():

1032 
mod–
 = 
£lf
.
	$_bud_mod–
(

1033 
is_Œaššg
=
F®£
, 
fœ¡_¡age_Úly
=F®£, 
£cÚd_¡age_b©ch_size
=6)

1034 
šputs_sh­e
 = (2, 20, 20, 3)

1035 
šputs
 = 
tf
.
	`to_æßt
Ñf.
	$¿ndom_unifÜm
(

1036 
šputs_sh­e
, 
mšv®
=0, 
maxv®
=255, 
dty³
=
tf
.
št32
))

1037 
´•roûs£d_šputs
 = 
mod–
.
	$´•roûss
(
šputs
)

1038 
´ediùiÚ_diù
 = 
mod–
.
	$´ediù
(
´•roûs£d_šputs
)

1039 
mod–
.
	$po¡´oûss
(
´ediùiÚ_diù
)

1040 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

1041 
§v”
 = 
tf
.
Œaš
.
	$Sav”
()

1042 
§ve_·th
 = 
£lf
.
	$g‘_‹mp_dœ
()

1043 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1044 
£ss
.
	$run
(
š™_İ
)

1045 
§ved_mod–_·th
 = 
§v”
.
	$§ve
(
£ss
, 
§ve_·th
)

1047 #Defš
£cÚd
 
d‘eùiÚ
 
g¿ph
 
ªd
 
»¡Üe
 
v¬ŸbËs
.

1048 
‹¡_g¿ph_d‘eùiÚ2
 = 
tf
.
	$G¿ph
()

1049 
w™h
 
‹¡_g¿ph_d‘eùiÚ2
.
	$as_deçuÉ
():

1050 
mod–2
 = 
£lf
.
	$_bud_mod–
(
is_Œaššg
=
F®£
, 
fœ¡_¡age_Úly
=False,

1051 
£cÚd_¡age_b©ch_size
=6, 
num_şas£s
=42)

1053 
šputs_sh­e2
 = (2, 20, 20, 3)

1054 
šputs2
 = 
tf
.
	`to_æßt
Ñf.
	$¿ndom_unifÜm
(

1055 
šputs_sh­e2
, 
mšv®
=0, 
maxv®
=255, 
dty³
=
tf
.
št32
))

1056 
´•roûs£d_šputs2
 = 
mod–2
.
	$´•roûss
(
šputs2
)

1057 
´ediùiÚ_diù2
 = 
mod–2
.
	$´ediù
(
´•roûs£d_šputs2
)

1058 
mod–2
.
	$po¡´oûss
(
´ediùiÚ_diù2
)

1059 
v¬_m­
 = 
mod–2
.
	$»¡Üe_m­
(
äom_d‘eùiÚ_checkpošt
=
True
)

1060 
£lf
.
	$as£¹IsIn¡ªû
(
v¬_m­
, 
diù
)

1061 
§v”
 = 
tf
.
Œaš
.
	$Sav”
(
v¬_m­
)

1062 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1063 
§v”
.
	$»¡Üe
(
£ss
, 
§ved_mod–_·th
)

1064 
v¬
 
š
 
£ss
.
	`run
(
tf
.
	$»pÜt_unš™Ÿlized_v¬ŸbËs
()):

1065 
£lf
.
	$as£¹NÙIn
(
mod–2
.
fœ¡_¡age_ã©u»_exŒaùÜ_scİe
, 
v¬
.
Çme
)

1066 
£lf
.
	$as£¹NÙIn
(
mod–2
.
£cÚd_¡age_ã©u»_exŒaùÜ_scİe
,

1067 
v¬
.
Çme
)

1069 
__Çme__
 == '__main__':

1070 
tf
.
‹¡
.
	`maš
()

	@meta_architectures/rfcn_meta_arch.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
	gR
-
	gFCN
: 
Dai
, 
	gJiãng
, 
‘
 
	g®
. "R-FCN: Object Detection via Region-based

18 
FuÎy
 
CÚvŞutiÚ®
 
	gN‘wÜks
."‡rXiv…reprint‡rXiv:1605.06409 (2016).

20 
The
 
	gR
-
FCN
 
m‘a
 
¬ch™eùu»
 
is
 
sim¬
 
to
 
Fa¡”
 R-
CNN
 
ªd
 
Úly
 
difãrs
 
š
 
the


21 
£cÚd
 
	g¡age
. 
H’û
 
this
 
şass
 
šh”™s
 
Fa¡”RCNNM‘aArch
 
ªd
 
ov”rides
 
Úly


22 
	gthe
 `
	g_´ediù_£cÚd_¡age
` 
	gm‘hod
.

24 
Sim¬
 
to
 
Fa¡”
 
	gR
-
CNN
 
we
 
®low
 
two
 
	gmodes
: 
fœ¡_¡age_Úly
=
True
 
ªd


25 
fœ¡_¡age_Úly
=
F®£
. 
In
 
the
 
fÜm”
 
£‰šg
, 
®l
 
of
h
u£r
 
çcšg
 
	gm‘hods


26 (
	ge
.
	gg
., 
	g´ediù
, 
	gpo¡´oûss
, 
	gloss
è
ÿn
 
be
 
u£d
 
as
 
the
 
mod–
 
cÚsi¡ed


27 
Úly
 
of
 
the
 
	gRPN
, 
»tuºšg
 
şass
 
agno¡ic
 
´İo§ls
 (
the£
 
ÿn
 
be
 
thought
 oà
as


28 
­´oxim©e
 
d‘eùiÚs
 
w™h
 
no
 
assocŸ‹d
 
şass
 
šfÜm©iÚ
). 
In
 
the
 
Ï‰”


29 
	g£‰šg
, 
´İo§ls
 
¬e
 
	gcompu‹d
, 
th’
 
·s£d
 
through
 
a
 
£cÚd
 
	g¡age


30 "box cÏssif›r" 
to
 
y›ld
 (
muÉi
-
şass
è
	gd‘eùiÚs
.

32 
Im¶em’tiÚs
 
of
 
	gR
-
FCN
 
mod–s
 
mu¡
 
defše
 
a
 
Ãw
 
Fa¡”RCNNF—tu»ExŒaùÜ
 
ªd


33 
ov”ride
 
th»e
 
	gm‘hods
: `
´•roûss
`, `
	g_exŒaù_´İo§l_ã©u»s
` (
the
 
fœ¡


34 
¡age
 
of
 
the
 
	gmod–
), 
	gªd
 `
	g_exŒaù_box_şassif›r_ã©u»s
` (th
£cÚd
 stage of

35 
the
 
	gmod–
). 
	gO±iÚ®ly
, 
	gthe
 `
	g»¡Üe_â
` 
m‘hod
 
ÿn
 
be
 
	gov”ridd’
. 
S“
 
‹¡s


36 
ª
 
	gexam¶e
.

38 
S“
 
nÙes
 
š
 
the
 
docum’tiÚ
 
of
 
Fa¡”
 
	gR
-
CNN
 
	gm‘a
-
¬ch™eùu»
 
as
 
they
 
®l


39 
­¶y
 
	gh”e
.

41 
impÜt
 
‹nsÜæow
 
as
 
tf


43 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_´ediùÜ


44 
äom
 
	gobjeù_d‘eùiÚ
.
m‘a_¬ch™eùu»s
 
impÜt
 
ç¡”_rún_m‘a_¬ch


45 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
İs


48 
şass
 
	$RFCNM‘aArch
(
ç¡”_rún_m‘a_¬ch
.
Fa¡”RCNNM‘aArch
):

51 
def
 
	$__š™__
(
£lf
,

52 
is_Œaššg
,

53 
num_şas£s
,

54 
image_»siz”_â
,

55 
ã©u»_exŒaùÜ
,

56 
fœ¡_¡age_Úly
,

57 
fœ¡_¡age_ªchÜ_g’”©Ü
,

58 
fœ¡_¡age_©rous_¿‹
,

59 
fœ¡_¡age_box_´ediùÜ_¬g_scİe
,

60 
fœ¡_¡age_box_´ediùÜ_k”Ãl_size
,

61 
fœ¡_¡age_box_´ediùÜ_d•th
,

62 
fœ¡_¡age_mšib©ch_size
,

63 
fœ¡_¡age_pos™ive_b®ªû_äaùiÚ
,

64 
fœ¡_¡age_nms_scÜe_th»shŞd
,

65 
fœ¡_¡age_nms_iou_th»shŞd
,

66 
fœ¡_¡age_max_´İo§ls
,

67 
fœ¡_¡age_loÿliz©iÚ_loss_weight
,

68 
fœ¡_¡age_objeùÃss_loss_weight
,

69 
£cÚd_¡age_rfú_box_´ediùÜ
,

70 
£cÚd_¡age_b©ch_size
,

71 
£cÚd_¡age_b®ªû_äaùiÚ
,

72 
£cÚd_¡age_nÚ_max_suµ»ssiÚ_â
,

73 
£cÚd_¡age_scÜe_cÚv”siÚ_â
,

74 
£cÚd_¡age_loÿliz©iÚ_loss_weight
,

75 
£cÚd_¡age_şassifiÿtiÚ_loss_weight
,

76 
h¬d_exam¶e_mš”
,

77 
·¿Î–_™”©iÚs
=16):

80 
Args
:

81 
is_Œaššg
: 
A
 
boŞ—n
 
šdiÿtšg
 
wh‘h”
 
the
 
Œaššg
 
v”siÚ
 
of
he

82 
computiÚ
 
g¿ph
 
should
 
be
 
cÚ¡ruùed
.

83 
num_şas£s
: 
Numb”
 
of
 
şas£s
. 
NÙe
 
th©
‚um_şas£ *
dÛs
 
nÙ
*

84 
šşude
 
the
 
background
 
ÿ‹gÜy
, 
so
 
groundŒuth
 
Ïb–s
 
ke
 
v®ues


85 
š
 {0, 1, .., 
K
-1
	}
}, 
	gnum_şas£s
=K (
ªd
 
nÙ
 K+1, 
ev’
 
though
 
the


86 
assigÃd
 
şassifiÿtiÚ
 
rg‘s
 
ÿn
 
¿nge
 
äom
 {0,... 
K
}).

87 
	gimage_»siz”_â
: 
A
 
ÿÎabË
 
image
 
»sizšg
. 
This
 c®ÏbË 
®ways


88 
kes
 
a
 
¿nk
-3 
image
 
	$‹nsÜ
 (
cÜ»¥Údšg
 
to
 
a
 
sšgË
 
image
è
ªd


89 
»tuºs
 
a
 
¿nk
-3 
image
 
‹nsÜ
, 
possibly
 
w™h
 
Ãw
 
¥©Ÿl
 
dim’siÚs
.

90 
S“
 
bud”s
/
image_»siz”_bud”
.
py
.

91 
ã©u»_exŒaùÜ
: 
A
 
Fa¡”RCNNF—tu»ExŒaùÜ
 
objeù
.

92 
fœ¡_¡age_Úly
: 
Wh‘h”
 
to
 
cÚ¡ruù
 
Úly
 
the
 
RegiÚ
 
Prİo§l
 
N‘wÜk


93 (
RPN
è
·¹
 
of
 
the
 
mod–
.

94 
fœ¡_¡age_ªchÜ_g’”©Ü
: 
An
 
ªchÜ_g’”©Ü
.
AnchÜG’”©Ü
 
objeù


95 (
nÙe
 
th©
 
cu¼’y
 
we
 
Úly
 
suµÜt


96 
grid_ªchÜ_g’”©Ü
.
GridAnchÜG’”©Ü
 
objeùs
)

97 
fœ¡_¡age_©rous_¿‹
: 
A
 
sšgË
 
š‹g”
 
šdiÿtšg
 
the
 
©rous
 
¿‹
 

98 
the
 
sšgË
 
cÚvŞutiÚ
 
İ
 
which
 
is
 
­¶›d
 
to
h`
½n_ã©u»s_to_üİ
`

99 
‹nsÜ
 
to
 
obš
 
a
’sÜØ
be
 
u£d
 
box
 
´ediùiÚ
. 
Some
 
ã©u»


100 
exŒaùÜs
 
İtiÚ®ly
 
®low
 
´oducšg
 
ã©u»
 
m­s
 
compu‹d
 
©


101 
d’£r
 
»sŞutiÚs
. 
The
 
©rous
 
¿‹
 
is
 
u£d
 
to
 
com³n§‹
 
the


102 
d’£r
 
ã©u»
 
m­s
 
by
 
usšg
 
ª
 
efãùiv–y
 
Ïrg”
 
»û±ive
 
f›ld
.

103 (
This
 
should
 
typiÿÎy
 
be
 
£t
 
to
 1).

104 
fœ¡_¡age_box_´ediùÜ_¬g_scİe
: 
Slim
 
¬g_scİe
 
cÚv2d
,

105 
£·¿bË_cÚv2d
 
ªd
 
fuÎy_cÚÃùed
 
İs
 
the
 
RPN
 
box
 
´ediùÜ
.

106 
fœ¡_¡age_box_´ediùÜ_k”Ãl_size
: 
K”Ãl
 
size
 
to
 
u£
 
the


107 
cÚvŞutiÚ
 
İ
 
ju¡
 
´iÜ
 
to
 
RPN
 
box
 
´ediùiÚs
.

108 
fœ¡_¡age_box_´ediùÜ_d•th
: 
Ouut
 
d•th
 
the
 
cÚvŞutiÚ
 
İ


109 
ju¡
 
´iÜ
 
to
 
RPN
 
box
 
´ediùiÚs
.

110 
fœ¡_¡age_mšib©ch_size
: 
The
 "b©ch size" 
to
 
u£
 
computšg
 
the


111 
objeùÃss
 
ªd
 
loÿtiÚ
 
loss
 
of
 
the
 
»giÚ
 
´İo§l
 
ÃtwÜk
. 
This


112 "b©ch size" 
»ãrs
 
to
 
the
 
numb”
 
of
 
ªchÜs
 
£Ëùed
 
as
 
cÚŒibutšg


113 
to
 
the
 
loss
 
funùiÚ
 
ªy
 
giv’
 
image
 
w™hš
himag
b©ch
 
ªd
 
is


114 
Úly
 
ÿÎed
 "b©ch_size" 
due
 
to
 
‹rmšŞogy
 
äom
 
the
 
Fa¡”
 
R
-
CNN
 
·³r
.

115 
fœ¡_¡age_pos™ive_b®ªû_äaùiÚ
: 
F¿ùiÚ
 
of
 
pos™ive
 
exam¶es


116 
³r
 
image
 
the
 
RPN
. 
The
 
»comm’ded
 
v®ue
 
Fa¡”
 
RCNN
 
is
 0.5.

117 
fœ¡_¡age_nms_scÜe_th»shŞd
: 
ScÜe
 
th»shŞd
 
nÚ
 
max
 
suµ»ssiÚ


118 
the
 
RegiÚ
 
Prİo§l
 
	`N‘wÜk
 (
RPN
). 
This
 
v®ue
 
is
 
ex³ùed
 
to
 
be
 
š


119 [0, 1] 
as
 
™
 
is
 
­¶›d
 
dœeùly
 
aá”
 
a
 
soámax
 
ŒªsfÜm©iÚ
. 
The


120 
»comm’ded
 
v®ue
 
Fa¡”
 
R
-
CNN
 
is
 0.

121 
fœ¡_¡age_nms_iou_th»shŞd
: 
The
 
IÁ”£ùiÚ
 
Ov”
 
	$UniÚ
 (
IOU
è
th»shŞd


122 
³rfÜmšg
 
NÚ
-
Max
 
	$Suµ»ssiÚ
 (
NMS
è
Ú
 
the
 
boxes
 
´ediùed
 
by
he

123 
RegiÚ
 
Prİo§l
 
	`N‘wÜk
 (
RPN
).

124 
fœ¡_¡age_max_´İo§ls
: 
Maximum
 
numb”
 
of
 
boxes
 
to
 
»š
 
aá”


125 
³rfÜmšg
 
NÚ
-
Max
 
	$Suµ»ssiÚ
 (
NMS
è
Ú
 
the
 
boxes
 
´ediùed
 
by
he

126 
RegiÚ
 
Prİo§l
 
	`N‘wÜk
 (
RPN
).

127 
fœ¡_¡age_loÿliz©iÚ_loss_weight
: 
A
 

128 
fœ¡_¡age_objeùÃss_loss_weight
: 
A
 

129 
£cÚd_¡age_rfú_box_´ediùÜ
: 
RFCN
 
box
 
´ediùÜ
 
to
 
u£
 

130 
£cÚd
 
¡age
.

131 
£cÚd_¡age_b©ch_size
: 
The
 
b©ch
 
size
 
u£d
 
computšg
 
the


132 
şassifiÿtiÚ
 
ªd
 
»fšed
 
loÿtiÚ
 
loss
 
of
 
the
 
box
 
şassif›r
. 
This


133 "b©ch size" 
»ãrs
 
to
 
the
 
numb”
 
of
 
´İo§ls
 
£Ëùed
 
as
 
cÚŒibutšg


134 
to
 
the
 
loss
 
funùiÚ
 
ªy
 
giv’
 
image
 
w™hš
himag
b©ch
 
ªd
 
is


135 
Úly
 
ÿÎed
 "b©ch_size" 
due
 
to
 
‹rmšŞogy
 
äom
 
the
 
Fa¡”
 
R
-
CNN
 
·³r
.

136 
£cÚd_¡age_b®ªû_äaùiÚ
: 
F¿ùiÚ
 
of
 
pos™ive
 
exam¶es
 
to
 
u£


137 
³r
 
image
 
the
 
box
 
şassif›r
. 
The
 
»comm’ded
 
v®ue
 
Fa¡”
 
RCNN


138 
is
 0.25.

139 
£cÚd_¡age_nÚ_max_suµ»ssiÚ_â
: 
b©ch_muÉişass_nÚ_max_suµ»ssiÚ


140 
ÿÎabË
 
th©
 
kes
 `
boxes
`, `
scÜes
`, 
İtiÚ®
 `
ş_wšdow
` 
ªd


141 
	`İtiÚ®
 (
kw¬g
è`
mask
` 
	$šputs
 (
w™h
 
®l
 
Ùh”
 
šputs
 
®»ady
 
£t
)

142 
ªd
 
»tuºs
 
a
 
diùiÚ¬y
 
cÚššg
 
‹nsÜs
 
w™h
 
keys
:

143 `
d‘eùiÚ_boxes
`, `
d‘eùiÚ_scÜes
`, `
d‘eùiÚ_şas£s
`,

144 `
num_d‘eùiÚs
`, 
	`ªd
 (
İtiÚ®ly
è`
d‘eùiÚ_masks
`. 
S“


145 `
po¡_´oûssšg
.
b©ch_muÉişass_nÚ_max_suµ»ssiÚ
` 
the
 
ty³
 
ªd


146 
sh­e
 
of
 
the£
 
‹nsÜs
.

147 
£cÚd_¡age_scÜe_cÚv”siÚ_â
: 
C®ÏbË
 
–em’twi£
 
nÚlš—r™y


148 (
th©
 
kes
 
‹nsÜs
 
as
 
šputs
 
ªd
 
»tuºs
’sÜs). 
This
 
is
 
usu®ly


149 
u£d
 
to
 
cÚv”t
 
log™s
Ø
´obab™›s
.

150 
£cÚd_¡age_loÿliz©iÚ_loss_weight
: 
A
 

151 
£cÚd_¡age_şassifiÿtiÚ_loss_weight
: 
A
 

152 
h¬d_exam¶e_mš”
: 
A
 
los£s
.
H¬dExam¶eMš”
 
	`objeù
 (
ÿn
 
be
 
NÚe
).

153 
·¿Î–_™”©iÚs
: (
O±iÚ®
è
The
 
numb”
 
of
 
™”©iÚs
 
®lowed
 
to
 
run


154 
š
 
·¿Î–
 
ÿÎs
 
to
 
tf
.
m­_â
.

155 
Rai£s
:

156 
V®ueE¼Ü
: 
If
 `
£cÚd_¡age_b©ch_size
` > `
fœ¡_¡age_max_´İo§ls
`

157 
V®ueE¼Ü
: 
If
 
fœ¡_¡age_ªchÜ_g’”©Ü
 
is
 
nÙ
 
of
 
ty³


158 
grid_ªchÜ_g’”©Ü
.
GridAnchÜG’”©Ü
.

160 
	`su³r
(
RFCNM‘aArch
, 
£lf
).
	`__š™__
(

161 
is_Œaššg
,

162 
num_şas£s
,

163 
image_»siz”_â
,

164 
ã©u»_exŒaùÜ
,

165 
fœ¡_¡age_Úly
,

166 
fœ¡_¡age_ªchÜ_g’”©Ü
,

167 
fœ¡_¡age_©rous_¿‹
,

168 
fœ¡_¡age_box_´ediùÜ_¬g_scİe
,

169 
fœ¡_¡age_box_´ediùÜ_k”Ãl_size
,

170 
fœ¡_¡age_box_´ediùÜ_d•th
,

171 
fœ¡_¡age_mšib©ch_size
,

172 
fœ¡_¡age_pos™ive_b®ªû_äaùiÚ
,

173 
fœ¡_¡age_nms_scÜe_th»shŞd
,

174 
fœ¡_¡age_nms_iou_th»shŞd
,

175 
fœ¡_¡age_max_´İo§ls
,

176 
fœ¡_¡age_loÿliz©iÚ_loss_weight
,

177 
fœ¡_¡age_objeùÃss_loss_weight
,

178 
NÚe
, #š™Ÿl_üİ_siz
is
 
nÙ
 
u£d
 
š
 
R
-
FCN


179 
NÚe
, #maxpoŞ_k”Ãl_siz
is
 
nÙ
 
u£
 
š
 
R
-
FCN


180 
NÚe
, #maxpoŞ_¡rid
is
 
nÙ
 
u£
 
š
 
R
-
FCN


181 
NÚe
, #fuÎy_cÚÃùed_box_´ediùÜ 
is
 
nÙ
 
u£d
 
š
 
R
-
FCN
.

182 
£cÚd_¡age_b©ch_size
,

183 
£cÚd_¡age_b®ªû_äaùiÚ
,

184 
£cÚd_¡age_nÚ_max_suµ»ssiÚ_â
,

185 
£cÚd_¡age_scÜe_cÚv”siÚ_â
,

186 
£cÚd_¡age_loÿliz©iÚ_loss_weight
,

187 
£cÚd_¡age_şassifiÿtiÚ_loss_weight
,

188 
h¬d_exam¶e_mš”
,

189 
·¿Î–_™”©iÚs
)

191 
£lf
.
_rfú_box_´ediùÜ
 = 
£cÚd_¡age_rfú_box_´ediùÜ


193 
def
 
	$_´ediù_£cÚd_¡age
(
£lf
, 
½n_box_’codšgs
,

194 
½n_objeùÃss_´ediùiÚs_w™h_background
,

195 
½n_ã©u»s
,

196 
ªchÜs
,

197 
image_sh­e
):

200 
Args
:

201 
½n_box_’codšgs
: 4-
D
 
‹nsÜ
 
of
 
sh­e


202 [
b©ch_size
, 
num_v®id_ªchÜs
, 
£lf
.
_box_cod”
.
code_size
] 
cÚššg


203 
´ediùed
 
boxes
.

204 
½n_objeùÃss_´ediùiÚs_w™h_background
: 2-
D
 
‹nsÜ
 
of
 
sh­e


205 [
b©ch_size
, 
num_v®id_ªchÜs
, 2] 
cÚššg
 
şass


206 
	$´ediùiÚs
 (
log™s
è
—ch
 
of
 
the
 
ªchÜs
. 
NÙe
 
th©
 
this


207 
‹nsÜ
 *
šşudes
* 
background
 
şass
 
	`´ediùiÚs
 (
©
 cÏs 
šdex
 0).

208 
½n_ã©u»s
: 
A
 4-
D
 
æßt32
 
‹nsÜ
 
w™h
 
sh­e


209 [
b©ch_size
, 
height
, 
width
, 
d•th
] 
»´e£Ášg
 
image
 
ã©u»s
 
äom
 
the


210 
RPN
.

211 
ªchÜs
: 2-
D
 
‹nsÜ
 
of
 
sh­e


212 [
num_ªchÜs
, 
£lf
.
_box_cod”
.
code_size
].

213 
image_sh­e
: 
A
 1D 
št32
 
‹nsÜs
 
of
 
size
 [4] 
cÚššg
 
the
 
image
 
sh­e
.

215 
R‘uºs
:

216 
´ediùiÚ_diù
: 
a
 
diùiÚ¬y
 
hŞdšg
 "¿w" 
´ediùiÚ
 
‹nsÜs
:

217 1è
»fšed_box_’codšgs
: 
a
 3-
D
 
‹nsÜ
 
w™h
 
sh­e


218 [
tÙ®_num_´İo§ls
, 
num_şas£s
, 4] 
»´e£Ášg
 
´ediùed


219 (
fš®
è
»fšed
 
box
 
’codšgs
, 
wh”e


220 
tÙ®_num_´İo§ls
=
b©ch_size
*
£lf
.
_max_num_´İo§ls


221 2è
şass_´ediùiÚs_w™h_background
: 
a
 3-
D
 
‹nsÜ
 
w™h
 
sh­e


222 [
tÙ®_num_´İo§ls
, 
num_şas£s
 + 1] 
cÚššg
 
şass


223 
	$´ediùiÚs
 (
log™s
è
—ch
 
of
 
the
 
ªchÜs
, 
wh”e


224 
tÙ®_num_´İo§ls
=
b©ch_size
*
£lf
.
_max_num_´İo§ls
.

225 
NÙe
 
th©
 
this
 
‹nsÜ
 *
šşudes
* 
background
 
şass
 
´ediùiÚs


226 (
©
 
şass
 
šdex
 0).

227 3è
num_´İo§ls
: 
An
 
št32
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
] 
»´e£Ášg
 
the


228 
numb”
 
of
 
´İo§ls
 
g’”©ed
 
by
 
the
 
RPN
. `
num_´İo§ls
` 
®lows
 
us


229 
to
 
k“p
 
Œack
 
of
 
which
 
’Œ›s
 
¬e
Ø
be
 
Œ—‹d
 
as
 
z”o
 
·ddšgs
 
ªd


230 
which
 
¬e
 
nÙ
 
sšû
 
we
 
®ways
 
·d
 
the
 
numb”
 
of
 
´İo§ls
 
to
 
be


231 `
£lf
.
max_num_´İo§ls
` 
—ch
 
image
.

232 4è
´İo§l_boxes
: 
A
 
æßt32
 
‹nsÜ
 
of
 
sh­e


233 [
b©ch_size
, 
£lf
.
max_num_´İo§ls
, 4] 
»´e£Ášg


234 
decoded
 
´İo§l
 
boundšg
 
	`boxes
 (
š
 
absŞu‹
 
coÜdš©es
).

236 
´İo§l_boxes_nÜm®ized
, 
_
, 
num_´İo§ls
 = 
£lf
.
	$_po¡´oûss_½n
(

237 
½n_box_’codšgs
, 
½n_objeùÃss_´ediùiÚs_w™h_background
,

238 
ªchÜs
, 
image_sh­e
)

240 
box_şassif›r_ã©u»s
 = (

241 
£lf
.
_ã©u»_exŒaùÜ
.
	$exŒaù_box_şassif›r_ã©u»s
(

242 
½n_ã©u»s
,

243 
scİe
=
£lf
.
£cÚd_¡age_ã©u»_exŒaùÜ_scİe
))

245 
box_´ediùiÚs
 = 
£lf
.
_rfú_box_´ediùÜ
.
	$´ediù
(

246 
box_şassif›r_ã©u»s
,

247 
num_´ediùiÚs_³r_loÿtiÚ
=1,

248 
scİe
=
£lf
.
£cÚd_¡age_box_´ediùÜ_scİe
,

249 
´İo§l_boxes
=
´İo§l_boxes_nÜm®ized
)

250 
»fšed_box_’codšgs
 = 
tf
.
	$squ“ze
(

251 
box_´ediùiÚs
[
box_´ediùÜ
.
BOX_ENCODINGS
], 
axis
=1)

252 
şass_´ediùiÚs_w™h_background
 = 
tf
.
	$squ“ze
(

253 
box_´ediùiÚs
[
box_´ediùÜ
.
CLASS_PREDICTIONS_WITH_BACKGROUND
],

254 
axis
=1)

256 
absŞu‹_´İo§l_boxes
 = 
İs
.
	$nÜm®ized_to_image_coÜdš©es
(

257 
´İo§l_boxes_nÜm®ized
, 
image_sh­e
,

258 
·¿Î–_™”©iÚs
=
£lf
.
_·¿Î–_™”©iÚs
)

260 
´ediùiÚ_diù
 = {

261 '»fšed_box_’codšgs': 
»fšed_box_’codšgs
,

263 
şass_´ediùiÚs_w™h_background
,

264 'num_´İo§ls': 
num_´İo§ls
,

265 '´İo§l_boxes': 
absŞu‹_´İo§l_boxes
,

266 
	}
}

267  
´ediùiÚ_diù


	@meta_architectures/rfcn_meta_arch_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
m‘a_¬ch™eùu»s
 
impÜt
 
ç¡”_rún_m‘a_¬ch_‹¡_lib


21 
äom
 
	gobjeù_d‘eùiÚ
.
m‘a_¬ch™eùu»s
 
impÜt
 
rfú_m‘a_¬ch


24 
şass
 
	$RFCNM‘aArchTe¡
(

25 
ç¡”_rún_m‘a_¬ch_‹¡_lib
.
Fa¡”RCNNM‘aArchTe¡Ba£
):

27 
def
 
	$_g‘_£cÚd_¡age_box_´ediùÜ_‹xt_´Ùo
(
£lf
):

28 
box_´ediùÜ_‹xt_´Ùo
 = """

29 
rfú_box_´ediùÜ
 {

30 
cÚv_hy³½¬ams
 {

31 
İ
: 
CONV


32 
aùiv©iÚ
: 
NONE


33 
»guÏriz”
 {

34 
l2_»guÏriz”
 {

35 
weight
: 0.0005

38 
š™Ÿliz”
 {

39 
v¬Ÿnû_sÿlšg_š™Ÿliz”
 {

40 
çùÜ
: 1.0

41 
unifÜm
: 
Œue


42 
mode
: 
FAN_AVG


46 
	}
}

48  
box_´ediùÜ_‹xt_´Ùo


50 
def
 
	$_g‘_mod–
(
£lf
, 
box_´ediùÜ
, **
commÚ_kw¬gs
):

51  
rfú_m‘a_¬ch
.
	$RFCNM‘aArch
(

52 
£cÚd_¡age_rfú_box_´ediùÜ
=
box_´ediùÜ
, **
commÚ_kw¬gs
)

55 
__Çme__
 == '__main__':

56 
tf
.
‹¡
.
	`maš
()

	@meta_architectures/ssd_meta_arch.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
G’”®
 
‹nsÜæow
 
im¶em’tiÚ
 
of
 
cÚvŞutiÚ®
 
	gMuÉibox
/
SSD
 
d‘eùiÚ


19 
	gmod–s
.

21 
äom
 
abc
 
impÜt
 
ab¡¿ùm‘hod


23 
impÜt
 
»


24 
impÜt
 
‹nsÜæow
 
as
 
tf


26 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


27 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_´ediùÜ
 
as
 
b´ediùÜ


28 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
mod–


29 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
¡ªd¬d_f›lds
 
as
 
f›lds


30 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
rg‘_assigÃr


31 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
sh­e_uts


33 
	g¦im
 = 
tf
.
cÚŒib
.
¦im


36 
şass
 
	$SSDF—tu»ExŒaùÜ
(
objeù
):

39 
def
 
	$__š™__
(
£lf
,

40 
d•th_muÉl›r
,

41 
mš_d•th
,

42 
cÚv_hy³½¬ams
,

43 
»u£_weights
=
NÚe
):

44 
£lf
.
_d•th_muÉl›r
 = 
d•th_muÉl›r


45 
£lf
.
_mš_d•th
 = 
mš_d•th


46 
£lf
.
_cÚv_hy³½¬ams
 = 
cÚv_hy³½¬ams


47 
£lf
.
_»u£_weights
 = 
»u£_weights


49 @
ab¡¿ùm‘hod


50 
def
 
	$´•roûss
(
£lf
, 
»sized_šputs
):

53 
Args
:

54 
»sized_šputs
: 
a
 [
b©ch
, 
height
, 
width
, 
chªÃls
] 
‹nsÜ


55 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

57 
R‘uºs
:

58 
´•roûs£d_šputs
: 
a
 [
b©ch
, 
height
, 
width
, 
chªÃls
] 
‹nsÜ


59 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

61 
·ss


63 @
ab¡¿ùm‘hod


64 
def
 
	$exŒaù_ã©u»s
(
£lf
, 
´•roûs£d_šputs
):

67 
This
 
funùiÚ
 
is
 
»¥ÚsibË
 
exŒaùšg
 
ã©u»
 
m­s
 
äom
 
´•roûs£d


68 
images
.

70 
Args
:

71 
´•roûs£d_šputs
: 
a
 [
b©ch
, 
height
, 
width
, 
chªÃls
] 
‹nsÜ


72 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

74 
R‘uºs
:

75 
ã©u»_m­s
: 
a
 
li¡
 
of
 
‹nsÜs
 
wh”e
 
the
 
™h
 
‹nsÜ
 
has
 
sh­e


76 [
b©ch
, 
height_i
, 
width_i
, 
d•th_i
]

78 
·ss


81 
şass
 
	$SSDM‘aArch
(
mod–
.
D‘eùiÚMod–
):

84 
def
 
	$__š™__
(
£lf
,

85 
is_Œaššg
,

86 
ªchÜ_g’”©Ü
,

87 
box_´ediùÜ
,

88 
box_cod”
,

89 
ã©u»_exŒaùÜ
,

90 
m©ch”
,

91 
»giÚ_sim¬™y_ÿlcuÏtÜ
,

92 
image_»siz”_â
,

93 
nÚ_max_suµ»ssiÚ_â
,

94 
scÜe_cÚv”siÚ_â
,

95 
şassifiÿtiÚ_loss
,

96 
loÿliz©iÚ_loss
,

97 
şassifiÿtiÚ_loss_weight
,

98 
loÿliz©iÚ_loss_weight
,

99 
nÜm®ize_loss_by_num_m©ches
,

100 
h¬d_exam¶e_mš”
,

101 
add_summ¬›s
=
True
):

104 
TODO
: 
group
 
NMS
 
·¿m‘”s
 + 
scÜe
 
cÚv”‹r
 
što


105 
a
 
şass
 
ªd
 
loss
 
·¿m‘”s
 
što
‡ cÏs ªd 
wr™e
 
cÚfig
 
´Ùos
 

106 
po¡´oûssšg
 
ªd
 
los£s
.

108 
Args
:

109 
is_Œaššg
: 
A
 
boŞ—n
 
šdiÿtšg
 
wh‘h”
 
the
 
Œaššg
 
v”siÚ
 
of
he

110 
computiÚ
 
g¿ph
 
should
 
be
 
cÚ¡ruùed
.

111 
ªchÜ_g’”©Ü
: 
ª
‡nchÜ_g’”©Ü.
AnchÜG’”©Ü
 
objeù
.

112 
box_´ediùÜ
: 
a
 box_´ediùÜ.
BoxP»diùÜ
 
objeù
.

113 
box_cod”
: 
a
 box_cod”.
BoxCod”
 
objeù
.

114 
ã©u»_exŒaùÜ
: 
a
 
SSDF—tu»ExŒaùÜ
 
objeù
.

115 
m©ch”
: 
a
 m©ch”.
M©ch”
 
objeù
.

116 
»giÚ_sim¬™y_ÿlcuÏtÜ
: 
a


117 
»giÚ_sim¬™y_ÿlcuÏtÜ
.
RegiÚSim¬™yC®cuÏtÜ
 
objeù
.

118 
image_»siz”_â
: 
a
 
ÿÎabË
 
image
 
»sizšg
. 
This
 c®ÏbË 
®ways


119 
kes
 
a
 
¿nk
-3 
image
 
	$‹nsÜ
 (
cÜ»¥Údšg
 
to
 
a
 
sšgË
 
image
è
ªd


120 
»tuºs
 
a
 
¿nk
-3 
image
 
‹nsÜ
, 
possibly
 
w™h
 
Ãw
 
¥©Ÿl
 
dim’siÚs
.

121 
S“
 
bud”s
/
image_»siz”_bud”
.
py
.

122 
nÚ_max_suµ»ssiÚ_â
: 
b©ch_muÉişass_nÚ_max_suµ»ssiÚ


123 
ÿÎabË
 
th©
 
kes
 `
boxes
`, `
scÜes
` 
ªd
 
İtiÚ®
 `
ş_wšdow
`

124 
	$šputs
 (
w™h
 
®l
 
Ùh”
 
šputs
 
®»ady
 
£t
è
ªd
 
»tuºs
 
a
 
diùiÚ¬y


125 
hŞd
 
‹nsÜs
 
w™h
 
keys
: `
d‘eùiÚ_boxes
`, `
d‘eùiÚ_scÜes
`,

126 `
d‘eùiÚ_şas£s
` 
ªd
 `
num_d‘eùiÚs
`. 
S“
 `
po¡_´oûssšg
.

127 
b©ch_muÉişass_nÚ_max_suµ»ssiÚ
` 
the
 
ty³
 
ªd
 
sh­e
 
of
 
the£


128 
‹nsÜs
.

129 
scÜe_cÚv”siÚ_â
: 
ÿÎabË
 
–em’twi£
 
	`nÚlš—r™y
 (
th©
 
kes
 
‹nsÜs


130 
as
 
šputs
 
ªd
 
»tuºs
 
‹nsÜs
). 
This
 
is
 
usu®ly
 
u£d
 
to
 
cÚv”t
 
log™s


131 
to
 
´obab™›s
.

132 
şassifiÿtiÚ_loss
: 
ª
 
objeù_d‘eùiÚ
.
cÜe
.
los£s
.
Loss
 
objeù
.

133 
loÿliz©iÚ_loss
: 
a
 
objeù_d‘eùiÚ
.
cÜe
.
los£s
.
Loss
 
objeù
.

134 
şassifiÿtiÚ_loss_weight
: 

135 
loÿliz©iÚ_loss_weight
: 

136 
nÜm®ize_loss_by_num_m©ches
: 
boŞ—n


137 
h¬d_exam¶e_mš”
: 
a
 
los£s
.
H¬dExam¶eMš”
 
	$objeù
 (
ÿn
 
be
 
NÚe
)

138 
add_summ¬›s
: 
	$boŞ—n
 (: 
True
è
cÚŒŞlšg
 
wh‘h”
 
summ¬y
 
İs


139 
should
 
be
 
added
 
to
 
‹nsÜæow
 
g¿ph
.

141 
	`su³r
(
SSDM‘aArch
, 
£lf
).
	$__š™__
(
num_şas£s
=
box_´ediùÜ
.num_classes)

142 
£lf
.
_is_Œaššg
 = 
is_Œaššg


144 #N“ded 
fše
-
tunšg
 
äom
 
şassifiÿtiÚ
 
checkpošts
 
who£


145 #v¬ŸbË dØ
nÙ
 
have
 
the
 
ã©u»
 
exŒaùÜ
 
scİe
.

146 
£lf
.
_exŒaù_ã©u»s_scİe
 = 'FeatureExtractor'

148 
£lf
.
_ªchÜ_g’”©Ü
 = 
ªchÜ_g’”©Ü


149 
£lf
.
_box_´ediùÜ
 = 
box_´ediùÜ


151 
£lf
.
_box_cod”
 = 
box_cod”


152 
£lf
.
_ã©u»_exŒaùÜ
 = 
ã©u»_exŒaùÜ


153 
£lf
.
_m©ch”
 = 
m©ch”


154 
£lf
.
_»giÚ_sim¬™y_ÿlcuÏtÜ
 = 
»giÚ_sim¬™y_ÿlcuÏtÜ


156 #TODO: 
hªdË
 
agno¡ic
 
mode
 
ªd
 
pos™ive
/
Ãg©ive
 
şass
 
weights


157 
unm©ched_şs_rg‘
 = 
NÚe


158 
unm©ched_şs_rg‘
 = 
tf
.
	`cÚ¡ªt
([1] + 
£lf
.
num_şas£s
 * [0],f.
æßt32
)

159 
£lf
.
_rg‘_assigÃr
 = 
rg‘_assigÃr
.
	$T¬g‘AssigÃr
(

160 
£lf
.
_»giÚ_sim¬™y_ÿlcuÏtÜ
,

161 
£lf
.
_m©ch”
,

162 
£lf
.
_box_cod”
,

163 
pos™ive_şass_weight
=1.0,

164 
Ãg©ive_şass_weight
=1.0,

165 
unm©ched_şs_rg‘
=unmatched_cls_target)

167 
£lf
.
_şassifiÿtiÚ_loss
 = 
şassifiÿtiÚ_loss


168 
£lf
.
_loÿliz©iÚ_loss
 = 
loÿliz©iÚ_loss


169 
£lf
.
_şassifiÿtiÚ_loss_weight
 = 
şassifiÿtiÚ_loss_weight


170 
£lf
.
_loÿliz©iÚ_loss_weight
 = 
loÿliz©iÚ_loss_weight


171 
£lf
.
_nÜm®ize_loss_by_num_m©ches
 = 
nÜm®ize_loss_by_num_m©ches


172 
£lf
.
_h¬d_exam¶e_mš”
 = 
h¬d_exam¶e_mš”


174 
£lf
.
_image_»siz”_â
 = 
image_»siz”_â


175 
£lf
.
_nÚ_max_suµ»ssiÚ_â
 = 
nÚ_max_suµ»ssiÚ_â


176 
£lf
.
_scÜe_cÚv”siÚ_â
 = 
scÜe_cÚv”siÚ_â


178 
£lf
.
_ªchÜs
 = 
NÚe


179 
£lf
.
_add_summ¬›s
 = 
add_summ¬›s


181 @
´İ”ty


182 
def
 
	$ªchÜs
(
£lf
):

183 
nÙ
 
£lf
.
_ªchÜs
:

184 
¿i£
 
	`RuÁimeE¼Ü
('anchors have‚ot been constructed yet!')

185 
nÙ
 
	$isš¡ªû
(
£lf
.
_ªchÜs
, 
box_li¡
.
BoxLi¡
):

186 
¿i£
 
	`RuÁimeE¼Ü
('anchors should be‡ BoxList object, but is‚ot.')

187  
£lf
.
_ªchÜs


189 
def
 
	$´•roûss
(
£lf
, 
šputs
):

192 
S“
 
ba£
 
şass
.

194 
Args
:

195 
šputs
: 
a
 [
b©ch
, 
height_š
, 
width_š
, 
chªÃls
] 
‹nsÜ
 
»´e£Ášg


196 
a
 
b©ch
 
of
 
images
 
w™h
 
v®ues
 
b‘w“n
 0 
ªd
 255.0.

198 
R‘uºs
:

199 
´•roûs£d_šputs
: 
a
 [
b©ch
, 
height_out
, 
width_out
, 
chªÃls
] 

200 
‹nsÜ
 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

201 
Rai£s
:

202 
V®ueE¼Ü
: 
šputs
 
‹nsÜ
 
dÛs
 
nÙ
 
have
 
ty³
 
tf
.
æßt32


204 
šputs
.
dty³
 
is
 
nÙ
 
tf
.
æßt32
:

205 
¿i£
 
	`V®ueE¼Ü
('`preprocess`ƒxpects‡f.float32ensor')

206 
w™h
 
tf
.
	`Çme_scİe
('Preprocessor'):

207 #TODO: 
»vis™
 
wh‘h”
 
to
 
®ways
 
u£
 
b©ch
 
size
 
as
 
the
 
numb”
 
of


208 #·¿Î– 
™”©iÚs
 
vs
 
®low
 
dyÇmic
 
b©chšg
.

209 
»sized_šputs
 = 
tf
.
	$m­_â
(
£lf
.
_image_»siz”_â
,

210 
–ems
=
šputs
,

211 
dty³
=
tf
.
æßt32
)

212  
£lf
.
_ã©u»_exŒaùÜ
.
	$´•roûss
(
»sized_šputs
)

214 
def
 
	$´ediù
(
£lf
, 
´•roûs£d_šputs
):

217 
This
 
funùiÚ
 
kes
 
ª
 
šput
 
b©ch
 
of
 
images
 
ªd
 
runs
 
™
 
through
 
the
 
fÜw¬d


218 
·ss
 
of
 
the
 
ÃtwÜk
 
to
 
y›ld
 
uÅo¡´oûs££d
 
´ediùiÚs
.

220 
A
 
side
 
efãù
 
of
 
ÿÎšg
 
the
 
´ediù
 
m‘hod
 
is
 
th©
 
£lf
.
_ªchÜs
 is

221 
pİuÏ‹d
 
w™h
 
a
 
box_li¡
.
BoxLi¡
 
of
 
ªchÜs
. 
The£
‡nchÜ 
mu¡
 
be


222 
cÚ¡ruùed
 
befÜe
 
the
 
po¡´oûss
 
Ü
 
loss
 
funùiÚs
 
ÿn
 
be
 
ÿÎed
.

224 
Args
:

225 
´•roûs£d_šputs
: 
a
 [
b©ch
, 
height
, 
width
, 
chªÃls
] 
image
 
‹nsÜ
.

227 
R‘uºs
:

228 
´ediùiÚ_diù
: 
a
 
diùiÚ¬y
 
hŞdšg
 "¿w" 
´ediùiÚ
 
‹nsÜs
:

229 1è
box_’codšgs
: 4-
D
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

230 
box_code_dim’siÚ
] 
cÚššg
 
´ediùed
 
boxes
.

231 2è
şass_´ediùiÚs_w™h_background
: 3-
D
 
‹nsÜ
 
of
 
sh­e


232 [
b©ch_size
, 
num_ªchÜs
, 
num_şas£s
+1] 
cÚššg
 
şass
 
´ediùiÚs


233 (
log™s
è
—ch
 
of
 
the
 
ªchÜs
. 
NÙe
 
th©
 
this
 
‹nsÜ
 *
šşudes
*

234 
background
 
şass
 
	`´ediùiÚs
 (
©
 cÏs 
šdex
 0).

235 3è
ã©u»_m­s
: 
a
 
li¡
 
of
 
‹nsÜs
 
wh”e
 
the
 
™h
 
‹nsÜ
 
has
 
sh­e


236 [
b©ch
, 
height_i
, 
width_i
, 
d•th_i
].

238 
w™h
 
tf
.
	$v¬ŸbË_scİe
(
NÚe
, 
£lf
.
_exŒaù_ã©u»s_scİe
,

239 [
´•roûs£d_šputs
]):

240 
ã©u»_m­s
 = 
£lf
.
_ã©u»_exŒaùÜ
.
	$exŒaù_ã©u»s
(

241 
´•roûs£d_šputs
)

242 
ã©u»_m­_¥©Ÿl_dims
 = 
£lf
.
	$_g‘_ã©u»_m­_¥©Ÿl_dims
(
ã©u»_m­s
)

243 
£lf
.
_ªchÜs
 = s–f.
_ªchÜ_g’”©Ü
.
	$g’”©e
(
ã©u»_m­_¥©Ÿl_dims
)

244 (
box_’codšgs
, 
şass_´ediùiÚs_w™h_background


245 èğ
£lf
.
	$_add_box_´ediùiÚs_to_ã©u»_m­s
(
ã©u»_m­s
)

246 
´ediùiÚs_diù
 = {

247 'box_’codšgs': 
box_’codšgs
,

248 'şass_´ediùiÚs_w™h_background': 
şass_´ediùiÚs_w™h_background
,

249 'ã©u»_m­s': 
ã©u»_m­s


250 
	}
}

251  
´ediùiÚs_diù


253 
def
 
	$_add_box_´ediùiÚs_to_ã©u»_m­s
(
£lf
, 
ã©u»_m­s
):

256 
Args
:

257 
ã©u»_m­s
: 
a
 
li¡
 
of
 
‹nsÜs
 
wh”e
 
the
 
™h
 
‹nsÜ
 
has
 
sh­e


258 [
b©ch
, 
height_i
, 
width_i
, 
d•th_i
]

260 
R‘uºs
:

261 
box_’codšgs
: 4-
D
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

262 
box_code_dim’siÚ
] 
cÚššg
 
´ediùed
 
boxes
.

263 
şass_´ediùiÚs_w™h_background
: 2-
D
 
‹nsÜ
 
of
 
sh­e


264 [
b©ch_size
, 
num_ªchÜs
, 
num_şas£s
+1] 
cÚššg
 
şass
 
´ediùiÚs


265 (
log™s
è
—ch
 
of
 
the
 
ªchÜs
. 
NÙe
 
th©
 
this
 
‹nsÜ
 *
šşudes
*

266 
background
 
şass
 
	`´ediùiÚs
 (
©
 cÏs 
šdex
 0).

268 
Rai£s
:

269 
RuÁimeE¼Ü
: 
the
 
numb”
 
of
 
ã©u»
 
m­s
 
exŒaùed
 
vŸ
he

270 
exŒaù_ã©u»s
 
m‘hod
 
dÛs
 
nÙ
 
m©ch
 
the
 
Ëngth
 
of
he

271 
num_ªchÜs_³r_loÿtiÚs
 
li¡
 
th©
 
was
 
·s£d
 
to
 
the
 
cÚ¡ruùÜ
.

272 
RuÁimeE¼Ü
: 
box_’codšgs
 
äom
 
the
 
box_´ediùÜ
 
dÛs
 
nÙ
 
have


273 
sh­e
 
of
 
the
 
fÜm
 [
b©ch_size
, 
num_ªchÜs
, 1, 
code_size
].

275 
num_ªchÜs_³r_loÿtiÚ_li¡
 = (

276 
£lf
.
_ªchÜ_g’”©Ü
.
	$num_ªchÜs_³r_loÿtiÚ
())

277 
	`Ën
(
ã©u»_m­s
è!ğ
	$Ën
(
num_ªchÜs_³r_loÿtiÚ_li¡
):

278 
¿i£
 
	`RuÁimeE¼Ü
('the‚umber of feature maps must matchhe '

280 
box_’codšgs_li¡
 = []

281 
şs_´ediùiÚs_w™h_background_li¡
 = []

282 
idx
, (
ã©u»_m­
, 
num_ªchÜs_³r_loÿtiÚ


283 è
š
 
	`’um”©e
(
	$z
(
ã©u»_m­s
, 
num_ªchÜs_³r_loÿtiÚ_li¡
)):

284 
box_´ediùÜ_scİe
 = 'BoxP»diùÜ_{}'.
	$fÜm©
(
idx
)

285 
box_´ediùiÚs
 = 
£lf
.
_box_´ediùÜ
.
	$´ediù
(
ã©u»_m­
,

286 
num_ªchÜs_³r_loÿtiÚ
,

287 
box_´ediùÜ_scİe
)

288 
box_’codšgs
 = 
box_´ediùiÚs
[
b´ediùÜ
.
BOX_ENCODINGS
]

289 
şs_´ediùiÚs_w™h_background
 = 
box_´ediùiÚs
[

290 
b´ediùÜ
.
CLASS_PREDICTIONS_WITH_BACKGROUND
]

292 
box_’codšgs_sh­e
 = 
box_’codšgs
.
	`g‘_sh­e
().
	$as_li¡
()

293 
	`Ën
(
box_’codšgs_sh­e
è!ğ4 
Ü
 box_encodings_shape[2] != 1:

294 
¿i£
 
	`RuÁimeE¼Ü
('box_encodings fromhe box_predictor must be of '

296 'aùu® sh­e', 
box_’codšgs_sh­e
)

297 
box_’codšgs
 = 
tf
.
	$squ“ze
(
box_’codšgs
, 
axis
=2)

298 
box_’codšgs_li¡
.
	$­³nd
(
box_’codšgs
)

299 
şs_´ediùiÚs_w™h_background_li¡
.
	$­³nd
(

300 
şs_´ediùiÚs_w™h_background
)

302 
num_´ediùiÚs
 = 
	`sum
(

303 [
tf
.
	`sh­e
(
box_’codšgs
)[1] box_’codšg 
š
 
box_’codšgs_li¡
])

304 
num_ªchÜs
 = 
£lf
.
ªchÜs
.
	$num_boxes
()

305 
ªchÜs_as£¹
 = 
tf
.
	`as£¹_equ®
(
num_ªchÜs
, 
num_´ediùiÚs
, [

306 'Mism©ch:‚umb” oàªchÜ v numb” oà´ediùiÚs', 
num_ªchÜs
,

307 
num_´ediùiÚs


309 
w™h
 
tf
.
	$cÚŒŞ_d•’d’c›s
([
ªchÜs_as£¹
]):

310 
box_’codšgs
 = 
tf
.
	$cÚÿt
(
box_’codšgs_li¡
, 1)

311 
şass_´ediùiÚs_w™h_background
 = 
tf
.
	$cÚÿt
(

312 
şs_´ediùiÚs_w™h_background_li¡
, 1)

313  
box_’codšgs
, 
şass_´ediùiÚs_w™h_background


315 
def
 
	$_g‘_ã©u»_m­_¥©Ÿl_dims
(
£lf
, 
ã©u»_m­s
):

318 
Args
:

319 
ã©u»_m­s
: 
a
 
li¡
 
of
 
‹nsÜs
 
wh”e
 
the
 
™h
 
‹nsÜ
 
has
 
sh­e


320 [
b©ch
, 
height_i
, 
width_i
, 
d•th_i
].

322 
R‘uºs
:

323 
a
 
li¡
 
of
 
	$·œs
 (
height
, 
width
è
—ch
 
ã©u»
 
m­
 
š
 
ã©u»_m­s


325 
ã©u»_m­_sh­es
 = [

326 
sh­e_uts
.
	$combšed_¡©ic_ªd_dyÇmic_sh­e
(

327 
ã©u»_m­
èã©u»_m­ 
š
 
ã©u»_m­s


329  [(
sh­e
[1], sh­e[2]èsh­
š
 
ã©u»_m­_sh­es
]

331 
def
 
	$po¡´oûss
(
£lf
, 
´ediùiÚ_diù
):

334 
This
 
funùiÚ
 
cÚv”ts
 
¿w
 
´ediùiÚs
 
‹nsÜs
 
to
 
fš®
 
d‘eùiÚ
 
»suÉs
 
by


335 
¦icšg
 
off
 
the
 
background
 
şass
, 
decodšg
 
box
 
´ediùiÚs
 
ªd
 
­¶yšg


336 
nÚ
 
max
 
suµ»ssiÚ
 
ªd
 
şpšg
 
to
 
the
 
image
 
wšdow
.

338 
S“
 
ba£
 
şass
 
ouut
 
fÜm©
 
cÚv’tiÚs
. 
NÙe
 
®so
 
th©
 
by
 ,

339 
scÜes
 
¬e
 
to
 
be
 
š‹½»‹d
 
as
 
log™s
, 
but
 
a
 
scÜe_cÚv”siÚ_â
 
is


340 
u£d
, 
th’
 
scÜes
 
¬e
 
	`»m­³d
 (
ªd
 
may
 
thus
 
have
 
a
 
difã»Á


341 
š‹½»tiÚ
).

343 
Args
:

344 
´ediùiÚ_diù
: 
a
 
diùiÚ¬y
 
hŞdšg
 
´ediùiÚ
 
‹nsÜs
 
w™h


345 1è
box_’codšgs
: 4-
D
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

346 
box_code_dim’siÚ
] 
cÚššg
 
´ediùed
 
boxes
.

347 2è
şass_´ediùiÚs_w™h_background
: 2-
D
 
‹nsÜ
 
of
 
sh­e


348 [
b©ch_size
, 
num_ªchÜs
, 
num_şas£s
+1] 
cÚššg
 
şass
 
´ediùiÚs


349 (
log™s
è
—ch
 
of
 
the
 
ªchÜs
. 
NÙe
 
th©
 
this
 
‹nsÜ
 *
šşudes
*

350 
background
 
şass
 
´ediùiÚs
.

352 
R‘uºs
:

353 
d‘eùiÚs
: 
a
 
diùiÚ¬y
 
cÚššg
 
the
 
fŞlowšg
 
f›lds


354 
d‘eùiÚ_boxes
: [
b©ch
, 
max_d‘eùiÚ
, 4]

355 
d‘eùiÚ_scÜes
: [
b©ch
, 
max_d‘eùiÚs
]

356 
d‘eùiÚ_şas£s
: [
b©ch
, 
max_d‘eùiÚs
]

357 
num_d‘eùiÚs
: [
b©ch
]

358 
Rai£s
:

359 
V®ueE¼Ü
: 
´ediùiÚ_diù
 
dÛs
 
nÙ
 
cÚš
 `
box_’codšgs
` 
Ü


360 `
şass_´ediùiÚs_w™h_background
` 
f›lds
.

362 ià('box_’codšgs' 
nÙ
 
š
 
´ediùiÚ_diù
 
Ü


363 'şass_´ediùiÚs_w™h_background' 
nÙ
 
š
 
´ediùiÚ_diù
):

364 
¿i£
 
	`V®ueE¼Ü
('prediction_dict does‚ot containƒxpectedƒntries.')

365 
w™h
 
tf
.
	`Çme_scİe
('Postprocessor'):

366 
box_’codšgs
 = 
´ediùiÚ_diù
['box_encodings']

367 
şass_´ediùiÚs
 = 
´ediùiÚ_diù
['class_predictions_with_background']

368 
d‘eùiÚ_boxes
 = 
£lf
.
	$_b©ch_decode
(
box_’codšgs
)

369 
d‘eùiÚ_boxes
 = 
tf
.
	$ex·nd_dims
(
d‘eùiÚ_boxes
, 
axis
=2)

371 
şass_´ediùiÚs_w™hout_background
 = 
tf
.
	`¦iû
(
şass_´ediùiÚs
,

374 
d‘eùiÚ_scÜes
 = 
£lf
.
	$_scÜe_cÚv”siÚ_â
(

375 
şass_´ediùiÚs_w™hout_background
)

376 
ş_wšdow
 = 
tf
.
	$cÚ¡ªt
([0, 0, 1, 1], 
tf
.
æßt32
)

377 (
nm£d_boxes
, 
nm£d_scÜes
, 
nm£d_şas£s
, 
_
,

378 
num_d‘eùiÚs
èğ
£lf
.
	$_nÚ_max_suµ»ssiÚ_â
(
d‘eùiÚ_boxes
,

379 
d‘eùiÚ_scÜes
,

380 
ş_wšdow
=clip_window)

381  {'d‘eùiÚ_boxes': 
nm£d_boxes
,

382 'd‘eùiÚ_scÜes': 
nm£d_scÜes
,

383 'd‘eùiÚ_şas£s': 
nm£d_şas£s
,

384 'num_d‘eùiÚs': 
tf
.
	`to_æßt
(
num_d‘eùiÚs
)
	}
}

386 
def
 
	$loss
(
£lf
, 
´ediùiÚ_diù
, 
scİe
=
NÚe
):

389 
C®lšg
 
this
 
funùiÚ
 
»quœes
 
th©
 
groundŒuth
 
‹nsÜs
 
have
 
b“n


390 
´ovided
 
vŸ
 
the
 
´ovide_groundŒuth
 
funùiÚ
.

392 
Args
:

393 
´ediùiÚ_diù
: 
a
 
diùiÚ¬y
 
hŞdšg
 
´ediùiÚ
 
‹nsÜs
 
w™h


394 1è
box_’codšgs
: 4-
D
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

395 
box_code_dim’siÚ
] 
cÚššg
 
´ediùed
 
boxes
.

396 2è
şass_´ediùiÚs_w™h_background
: 2-
D
 
‹nsÜ
 
of
 
sh­e


397 [
b©ch_size
, 
num_ªchÜs
, 
num_şas£s
+1] 
cÚššg
 
şass
 
´ediùiÚs


398 (
log™s
è
—ch
 
of
 
the
 
ªchÜs
. 
NÙe
 
th©
 
this
 
‹nsÜ
 *
šşudes
*

399 
background
 
şass
 
´ediùiÚs
.

400 
scİe
: 
O±iÚ®
 scİ
Çme
.

402 
R‘uºs
:

403 
a
 
diùiÚ¬y
 
m­pšg
 
loss
 
	`keys
 (`
loÿliz©iÚ_loss
` 
ªd


404 `
şassifiÿtiÚ_loss
`è
to
 
sÿÏr
 
‹nsÜs
 
»´e£Ášg
 
cÜ»¥Údšg
 
loss


405 
v®ues
.

407 
w™h
 
tf
.
	`Çme_scİe
(
scİe
, 'Loss', 
´ediùiÚ_diù
.
	$v®ues
()):

408 (
b©ch_şs_rg‘s
, 
b©ch_şs_weights
, 
b©ch_»g_rg‘s
,

409 
b©ch_»g_weights
, 
m©ch_li¡
èğ
£lf
.
	`_assign_rg‘s
(

410 
£lf
.
	`groundŒuth_li¡s
(
f›lds
.
BoxLi¡F›lds
.
boxes
),

411 
£lf
.
	$groundŒuth_li¡s
(
f›lds
.
BoxLi¡F›lds
.
şas£s
))

412 
£lf
.
_add_summ¬›s
:

413 
£lf
.
	`_summ¬ize_šput
(

414 
£lf
.
	`groundŒuth_li¡s
(
f›lds
.
BoxLi¡F›lds
.
boxes
), 
m©ch_li¡
)

415 
num_m©ches
 = 
tf
.
	`¡ack
(

416 [
m©ch
.
	$num_m©ched_cŞumns
(è
m©ch
 
š
 
m©ch_li¡
])

417 
loÿtiÚ_los£s
 = 
£lf
.
	`_loÿliz©iÚ_loss
(

418 
´ediùiÚ_diù
['box_encodings'],

419 
b©ch_»g_rg‘s
,

420 
weights
=
b©ch_»g_weights
)

421 
şs_los£s
 = 
£lf
.
	`_şassifiÿtiÚ_loss
(

422 
´ediùiÚ_diù
['class_predictions_with_background'],

423 
b©ch_şs_rg‘s
,

424 
weights
=
b©ch_şs_weights
)

426 #O±iÚ®ly 
­¶y
 
h¬d
 
mššg
 
Ú
 
tİ
 
of
 
loss
 
v®ues


427 
loÿliz©iÚ_loss
 = 
tf
.
	$»duû_sum
(
loÿtiÚ_los£s
)

428 
şassifiÿtiÚ_loss
 = 
tf
.
	$»duû_sum
(
şs_los£s
)

429 
£lf
.
_h¬d_exam¶e_mš”
:

430 (
loÿliz©iÚ_loss
, 
şassifiÿtiÚ_loss
èğ
£lf
.
	$_­¶y_h¬d_mššg
(

431 
loÿtiÚ_los£s
, 
şs_los£s
, 
´ediùiÚ_diù
, 
m©ch_li¡
)

432 
£lf
.
_add_summ¬›s
:

433 
£lf
.
_h¬d_exam¶e_mš”
.
	$summ¬ize
()

435 #O±iÚ®ly 
nÜm®ize
 
by
 
numb”
 
of
 
pos™ive
 
m©ches


436 
nÜm®iz”
 = 
tf
.
	$cÚ¡ªt
(1.0, 
dty³
=
tf
.
æßt32
)

437 
£lf
.
_nÜm®ize_loss_by_num_m©ches
:

438 
nÜm®iz”
 = 
tf
.
	`maximum
Ñf.
	`to_æßt
Ñf.
	`»duû_sum
(
num_m©ches
)), 1.0)

440 
loss_diù
 = {

441 'loÿliz©iÚ_loss': (
£lf
.
_loÿliz©iÚ_loss_weight
 / 
nÜm®iz”
) *

442 
loÿliz©iÚ_loss
,

443 'şassifiÿtiÚ_loss': (
£lf
.
_şassifiÿtiÚ_loss_weight
 /

444 
nÜm®iz”
è* 
şassifiÿtiÚ_loss


445 
	}
}

446  
loss_diù


448 
def
 
	$_assign_rg‘s
(
£lf
, 
groundŒuth_boxes_li¡
, 
groundŒuth_şas£s_li¡
):

451 
Adds
 
a
 
background
 
şass
 
to
 
—ch
 
Úe
-
hÙ
 
’codšg
 
of
 
groundŒuth
 
şas£s


452 
ªd
 
u£s
 
rg‘
 
assigÃr
 
to
 
obš
 
»g»ssiÚ
‡nd 
şassifiÿtiÚ
 
rg‘s
.

454 
Args
:

455 
groundŒuth_boxes_li¡
: 
a
 
li¡
 
of
 2-
D
 
‹nsÜs
 oà
sh­e
 [
num_boxes
, 4]

456 
cÚššg
 
coÜdš©es
 
of
 
the
 
groundŒuth
 
boxes
.

457 
GroundŒuth
 
boxes
 
¬e
 
´ovided
 
š
 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
]

458 
fÜm©
 
ªd
 
assumed
 
to
 
be
 
nÜm®ized
‡nd 
ş³d


459 
»Ïtive
 
to
 
the
 
image
 
wšdow
 
w™h
 
y_mš
 <ğ
y_max
 
ªd
 
x_mš
 <ğ
x_max
.

460 
groundŒuth_şas£s_li¡
: 
a
 
li¡
 
of
 2-
D
 
Úe
-
	`hÙ
 (
Ü
 
k
-
hÙ
è
‹nsÜs
 of

461 
sh­e
 [
num_boxes
, 
num_şas£s
] 
cÚššg
 
the
 
şass
 
rg‘s
 
w™h
h0
th


462 
šdex
 
assumed
 
to
 
m­
Ø
the
 
fœ¡
 
nÚ
-
background
 
şass
.

464 
R‘uºs
:

465 
b©ch_şs_rg‘s
: 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

466 
num_şas£s
],

467 
b©ch_şs_weights
: 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
],

468 
b©ch_»g_rg‘s
: 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

469 
box_code_dim’siÚ
]

470 
b©ch_»g_weights
: 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
],

471 
m©ch_li¡
: 
a
 
li¡
 
of
 
m©ch”
.
M©ch
 
objeùs
 
’codšg
 
the
 
m©ch
 
b‘w“n


472 
ªchÜs
 
ªd
 
groundŒuth
 
boxes
 
—ch
 
image
 
of
 
the
 
b©ch
,

473 
w™h
 
rows
 
of
 
the
 
M©ch
 
objeùs
 
cÜ»¥Údšg
 
to
 
groundŒuth
 
boxes


474 
ªd
 
cŞumns
 
cÜ»¥Údšg
 
to
 
ªchÜs
.

476 
groundŒuth_boxli¡s
 = [

477 
box_li¡
.
	$BoxLi¡
(
boxes
èboxe 
š
 
groundŒuth_boxes_li¡


479 
groundŒuth_şas£s_w™h_background_li¡
 = [

480 
tf
.
	`·d
(
Úe_hÙ_’codšg
, [[0, 0], [1, 0]], 
mode
='CONSTANT')

481 
Úe_hÙ_’codšg
 
š
 
groundŒuth_şas£s_li¡


483  
rg‘_assigÃr
.
	$b©ch_assign_rg‘s
(

484 
£lf
.
_rg‘_assigÃr
, s–f.
ªchÜs
, 
groundŒuth_boxli¡s
,

485 
groundŒuth_şas£s_w™h_background_li¡
)

487 
def
 
	$_summ¬ize_šput
(
£lf
, 
groundŒuth_boxes_li¡
, 
m©ch_li¡
):

490 
This
 
funùiÚ
 
ü—‹s
 
four
 
summ¬›s
 
cÜ»¥Údšg
 
to
 
the
 
av”age


491 
	$numb”
 (
ov”
 
images
 
š
 
a
 
b©ch
è
	$of
 (1è
groundŒuth
 
boxes
, (2è
ªchÜs


492 
m¬ked
 
as
 
pos™ive
, (3è
ªchÜs
 m¬ked‡ 
Ãg©ive
, 
	$ªd
 (4è
ªchÜs
 
m¬ked


493 
as
 
ignÜed
.

495 
Args
:

496 
groundŒuth_boxes_li¡
: 
a
 
li¡
 
of
 2-
D
 
‹nsÜs
 oà
sh­e
 [
num_boxes
, 4]

497 
cÚššg
 
cÜÃrs
 
of
 
the
 
groundŒuth
 
boxes
.

498 
m©ch_li¡
: 
a
 
li¡
 
of
 
m©ch”
.
M©ch
 
objeùs
 
’codšg
 
the
 
m©ch
 
b‘w“n


499 
ªchÜs
 
ªd
 
groundŒuth
 
boxes
 
—ch
 
image
 
of
 
the
 
b©ch
,

500 
w™h
 
rows
 
of
 
the
 
M©ch
 
objeùs
 
cÜ»¥Údšg
 
to
 
groundŒuth
 
boxes


501 
ªd
 
cŞumns
 
cÜ»¥Údšg
 
to
 
ªchÜs
.

503 
num_boxes_³r_image
 = 
tf
.
	`¡ack
(

504 [
tf
.
	`sh­e
(
x
)[0] x 
š
 
groundŒuth_boxes_li¡
])

505 
pos_ªchÜs_³r_image
 = 
tf
.
	`¡ack
(

506 [
m©ch
.
	$num_m©ched_cŞumns
(è
m©ch
 
š
 
m©ch_li¡
])

507 
Ãg_ªchÜs_³r_image
 = 
tf
.
	`¡ack
(

508 [
m©ch
.
	$num_unm©ched_cŞumns
(è
m©ch
 
š
 
m©ch_li¡
])

509 
ignÜed_ªchÜs_³r_image
 = 
tf
.
	`¡ack
(

510 [
m©ch
.
	$num_ignÜed_cŞumns
(è
m©ch
 
š
 
m©ch_li¡
])

511 
tf
.
summ¬y
.
	`sÿÏr
('Input/AvgNumGroundtruthBoxesPerImage',

512 
tf
.
	`»duû_m—n
Ñf.
	$to_æßt
(
num_boxes_³r_image
)))

513 
tf
.
summ¬y
.
	`sÿÏr
('Input/AvgNumPositiveAnchorsPerImage',

514 
tf
.
	`»duû_m—n
Ñf.
	$to_æßt
(
pos_ªchÜs_³r_image
)))

515 
tf
.
summ¬y
.
	`sÿÏr
('Input/AvgNumNegativeAnchorsPerImage',

516 
tf
.
	`»duû_m—n
Ñf.
	$to_æßt
(
Ãg_ªchÜs_³r_image
)))

517 
tf
.
summ¬y
.
	`sÿÏr
('Input/AvgNumIgnoredAnchorsPerImage',

518 
tf
.
	`»duû_m—n
Ñf.
	$to_æßt
(
ignÜed_ªchÜs_³r_image
)))

520 
def
 
	$_­¶y_h¬d_mššg
(
£lf
, 
loÿtiÚ_los£s
, 
şs_los£s
, 
´ediùiÚ_diù
,

521 
m©ch_li¡
):

524 
Args
:

525 
loÿtiÚ_los£s
: 
Flßt
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
]

526 
»´e£Ášg
 
ªchÜwi£
 
loÿtiÚ
 
los£s
.

527 
şs_los£s
: 
Flßt
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
]

528 
»´e£Ášg
 
ªchÜwi£
 
şassifiÿtiÚ
 
los£s
.

529 
´ediùiÚ_diù
: 
p
 
a
 
diùiÚ¬y
 
hŞdšg
 
´ediùiÚ
 
‹nsÜs
 
w™h


530 1è
box_’codšgs
: 4-
D
 
‹nsÜ
 
of
 
sh­e
 [
b©ch_size
, 
num_ªchÜs
,

531 
box_code_dim’siÚ
] 
cÚššg
 
´ediùed
 
boxes
.

532 2è
şass_´ediùiÚs_w™h_background
: 2-
D
 
‹nsÜ
 
of
 
sh­e


533 [
b©ch_size
, 
num_ªchÜs
, 
num_şas£s
+1] 
cÚššg
 
şass
 
´ediùiÚs


534 (
log™s
è
—ch
 
of
 
the
 
ªchÜs
. 
NÙe
 
th©
 
this
 
‹nsÜ
 *
šşudes
*

535 
background
 
şass
 
´ediùiÚs
.

536 
m©ch_li¡
: 
a
 
li¡
 
of
 
m©ch”
.
M©ch
 
objeùs
 
’codšg
 
the
 
m©ch
 
b‘w“n


537 
ªchÜs
 
ªd
 
groundŒuth
 
boxes
 
—ch
 
image
 
of
 
the
 
b©ch
,

538 
w™h
 
rows
 
of
 
the
 
M©ch
 
objeùs
 
cÜ»¥Údšg
 
to
 
groundŒuth
 
boxes


539 
ªd
 
cŞumns
 
cÜ»¥Údšg
 
to
 
ªchÜs
.

541 
R‘uºs
:

542 
mšed_loÿtiÚ_loss
: 
a
 
sÿÏr
 
w™h
 
sum
 
of
 
loÿliz©iÚ
 
los£s
 
äom


543 
£Ëùed
 
h¬d
 
exam¶es
.

544 
mšed_şs_loss
: 
a
 
sÿÏr
 
w™h
 
sum
 
of
 
şassifiÿtiÚ
 
los£s
 
äom


545 
£Ëùed
 
h¬d
 
exam¶es
.

547 
şass_´ed_sh­e
 = [-1, 
£lf
.
ªchÜs
.
	`num_boxes_¡©ic
(), s–f.
num_şas£s
]

548 
şass_´ediùiÚs
 = 
tf
.
	`»sh­e
(

549 
tf
.
	`¦iû
(
´ediùiÚ_diù
['class_predictions_with_background'],

550 [0, 0, 1], 
şass_´ed_sh­e
), class_pred_shape)

552 
decoded_boxes
 = 
£lf
.
	`_b©ch_decode
(
´ediùiÚ_diù
['box_encodings'])

553 
decoded_box_‹nsÜs_li¡
 = 
tf
.
	$un¡ack
(
decoded_boxes
)

554 
şass_´ediùiÚ_li¡
 = 
tf
.
	$un¡ack
(
şass_´ediùiÚs
)

555 
decoded_boxli¡_li¡
 = []

556 
box_loÿtiÚ
, 
box_scÜe
 
š
 
	$z
(
decoded_box_‹nsÜs_li¡
,

557 
şass_´ediùiÚ_li¡
):

558 
decoded_boxli¡
 = 
box_li¡
.
	$BoxLi¡
(
box_loÿtiÚ
)

559 
decoded_boxli¡
.
	`add_f›ld
('scÜes', 
box_scÜe
)

560 
decoded_boxli¡_li¡
.
	$­³nd
(
decoded_boxli¡
)

561  
£lf
.
	$_h¬d_exam¶e_mš”
(

562 
loÿtiÚ_los£s
=location_losses,

563 
şs_los£s
=cls_losses,

564 
decoded_boxli¡_li¡
=decoded_boxlist_list,

565 
m©ch_li¡
=match_list)

567 
def
 
	$_b©ch_decode
(
£lf
, 
box_’codšgs
):

570 
Args
:

571 
box_’codšgs
: 
A
 
æßt32
 
‹nsÜ
 
of
 
sh­e


572 [
b©ch_size
, 
num_ªchÜs
, 
box_code_size
] 
cÚššg
 
box
 
’codšgs
.

574 
R‘uºs
:

575 
decoded_boxes
: 
A
 
æßt32
 
‹nsÜ
 
of
 
sh­e


576 [
b©ch_size
, 
num_ªchÜs
, 4] 
cÚššg
 
the
 
decoded
 
boxes
.

578 
combšed_sh­e
 = 
sh­e_uts
.
	$combšed_¡©ic_ªd_dyÇmic_sh­e
(

579 
box_’codšgs
)

580 
b©ch_size
 = 
combšed_sh­e
[0]

581 
ted_ªchÜ_boxes
 = 
tf
.
	`te
(

582 
tf
.
	`ex·nd_dims
(
£lf
.
ªchÜs
.
	`g‘
(), 0), [
b©ch_size
, 1, 1])

583 
ted_ªchÜs_boxli¡
 = 
box_li¡
.
	`BoxLi¡
(

584 
tf
.
	`»sh­e
(
ted_ªchÜ_boxes
, [-1, 
£lf
.
_box_cod”
.
code_size
]))

585 
decoded_boxes
 = 
£lf
.
_box_cod”
.
	`decode
(

586 
tf
.
	`»sh­e
(
box_’codšgs
, [-1, 
£lf
.
_box_cod”
.
code_size
]),

587 
ted_ªchÜs_boxli¡
)

588  
tf
.
	`»sh­e
(
decoded_boxes
.
	`g‘
(),

589 
tf
.
	$¡ack
([
combšed_sh­e
[0], combined_shape[1],

592 
def
 
	$»¡Üe_m­
(
£lf
, 
äom_d‘eùiÚ_checkpošt
=
True
):

595 
S“
 
·»Á
 
şass
 
d‘as
.

597 
Args
:

598 
äom_d‘eùiÚ_checkpošt
: 
wh‘h”
 
to
 
»¡Üe
 
äom
 
a
 
fuÎ
 
d‘eùiÚ


599 
	$checkpošt
 (
w™h
 
com·tibË
 
v¬ŸbË
 
Çmes
è
Ü
 
to
 
»¡Üe
 
äom
 
a


600 
şassifiÿtiÚ
 
checkpošt
 
š™Ÿliz©iÚ
 
´iÜ
 
to
 
Œaššg
.

602 
R‘uºs
:

603 
A
 
diù
 
m­pšg
 
v¬ŸbË
 
	$Çmes
 (
to
 
lßd
 
äom
 
a
 
checkpošt
ètØ
v¬ŸbËs
 
š


604 
the
 
mod–
 
g¿ph
.

606 
v¬ŸbËs_to_»¡Üe
 = {
	}
}

607 
v¬ŸbË
 
š
 
tf
.
	$®l_v¬ŸbËs
():

608 
v¬ŸbË
.
İ
.
Çme
.
	$¡¬tsw™h
(
£lf
.
_exŒaù_ã©u»s_scİe
):

609 
v¬_Çme
 = 
v¬ŸbË
.
İ
.
Çme


610 
nÙ
 
äom_d‘eùiÚ_checkpošt
:

611 
v¬_Çme
 = (
»
.
	`¥l™
('^' + 
£lf
.
_exŒaù_ã©u»s_scİe
 + '/',

612 
v¬_Çme
)[-1])

613 
v¬ŸbËs_to_»¡Üe
[
v¬_Çme
] = 
v¬ŸbË


614  
v¬ŸbËs_to_»¡Üe


	@meta_architectures/ssd_meta_arch_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
funùoŞs


18 
impÜt
 
numpy
 
as
 
Å


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	g‹nsÜæow
.
	gpythÚ
.
Œaššg
 
impÜt
 
§v”
 
as
 
tf_§v”


22 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
ªchÜ_g’”©Ü


23 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


24 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
los£s


25 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
po¡_´oûssšg


26 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
»giÚ_sim¬™y_ÿlcuÏtÜ
 
as
 
sim_ÿlc


27 
äom
 
	gobjeù_d‘eùiÚ
.
m‘a_¬ch™eùu»s
 
impÜt
 
ssd_m‘a_¬ch


28 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
‹¡_uts


30 
	g¦im
 = 
tf
.
cÚŒib
.
¦im


33 
şass
 
	$FakeSSDF—tu»ExŒaùÜ
(
ssd_m‘a_¬ch
.
SSDF—tu»ExŒaùÜ
):

35 
def
 
	$__š™__
(
£lf
):

36 
	`su³r
(
FakeSSDF—tu»ExŒaùÜ
, 
£lf
).
	$__š™__
(

37 
d•th_muÉl›r
=0, 
mš_d•th
=0, 
cÚv_hy³½¬ams
=
NÚe
)

39 
def
 
	$´•roûss
(
£lf
, 
»sized_šputs
):

40  
tf
.
	$id’t™y
(
»sized_šputs
)

42 
def
 
	$exŒaù_ã©u»s
(
£lf
, 
´•roûs£d_šputs
):

43 
w™h
 
tf
.
	`v¬ŸbË_scİe
('mock_model'):

44 
ã©u»s
 = 
¦im
.
	`cÚv2d
(
šputs
=
´•roûs£d_šputs
, 
num_ouuts
=32,

45 
k”Ãl_size
=[1, 1], 
scİe
='layer1')

46  [
ã©u»s
]

49 
şass
 
	$MockAnchÜG’”©Ü2x2
(
ªchÜ_g’”©Ü
.
AnchÜG’”©Ü
):

52 
def
 
	$Çme_scİe
(
£lf
):

55 
def
 
	$num_ªchÜs_³r_loÿtiÚ
(
£lf
):

58 
def
 
	$_g’”©e
(
£lf
, 
ã©u»_m­_sh­e_li¡
):

59  
box_li¡
.
	`BoxLi¡
(

60 
tf
.
	$cÚ¡ªt
([[0, 0, .5, .5],

63 [.5, .5, 1, 1]], 
tf
.
æßt32
))

66 
şass
 
	$SsdM‘aArchTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

68 
def
 
	$£tUp
(
£lf
):

71 
H”e
 
we
 
£t
 
up
 
a
 
sim¶e
 
mock
 
SSD
 
mod–
 
th©
 
wl
 
®ways
 
´ediù
 4

72 
d‘eùiÚs
 
th©
 
h­³n
 
to
 
®ways
 
be
 
exaùly
 
the
 
ªchÜs
h© 
¬e
 
£t
 
up


73 
š
 
the
 
above
 
MockAnchÜG’”©Ü
. 
Beÿu£
 
we
 
Ët
 
max_d‘eùiÚs
=5,

74 
we
 
wl
 
®so
 
®ways
 
’d
 
up
 
w™h
 
ª
 
exŒa
 
·dded
 
row
 
š
 
the
 
d‘eùiÚ


75 
»suÉs
.

77 
is_Œaššg
 = 
F®£


78 
£lf
.
_num_şas£s
 = 1

79 
mock_ªchÜ_g’”©Ü
 = 
	$MockAnchÜG’”©Ü2x2
()

80 
mock_box_´ediùÜ
 = 
‹¡_uts
.
	$MockBoxP»diùÜ
(

81 
is_Œaššg
, 
£lf
.
_num_şas£s
)

82 
mock_box_cod”
 = 
‹¡_uts
.
	$MockBoxCod”
()

83 
çke_ã©u»_exŒaùÜ
 = 
	$FakeSSDF—tu»ExŒaùÜ
()

84 
mock_m©ch”
 = 
‹¡_uts
.
	$MockM©ch”
()

85 
»giÚ_sim¬™y_ÿlcuÏtÜ
 = 
sim_ÿlc
.
	$IouSim¬™y
()

87 
def
 
	$image_»siz”_â
(
image
):

88  
tf
.
	$id’t™y
(
image
)

90 
şassifiÿtiÚ_loss
 = 
los£s
.
	$Weigh‹dSigmoidCÏssifiÿtiÚLoss
(

91 
ªchÜwi£_ouut
=
True
)

92 
loÿliz©iÚ_loss
 = 
los£s
.
	$Weigh‹dSmoÙhL1Loÿliz©iÚLoss
(

93 
ªchÜwi£_ouut
=
True
)

94 
nÚ_max_suµ»ssiÚ_â
 = 
funùoŞs
.
	`·¹Ÿl
(

95 
po¡_´oûssšg
.
b©ch_muÉişass_nÚ_max_suµ»ssiÚ
,

96 
scÜe_th»sh
=-20.0,

97 
iou_th»sh
=1.0,

98 
max_size_³r_şass
=5,

99 
max_tÙ®_size
=5)

100 
şassifiÿtiÚ_loss_weight
 = 1.0

101 
loÿliz©iÚ_loss_weight
 = 1.0

102 
nÜm®ize_loss_by_num_m©ches
 = 
F®£


104 #Thi 
h¬d
 
exam¶e
 
mš”
 
is
 
ex³ùed
 
to
 
be
 
a
 
no
-
İ
.

105 
h¬d_exam¶e_mš”
 = 
los£s
.
	$H¬dExam¶eMš”
(

106 
num_h¬d_exam¶es
=
NÚe
,

107 
iou_th»shŞd
=1.0)

109 
£lf
.
_num_ªchÜs
 = 4

110 
£lf
.
_code_size
 = 4

111 
£lf
.
_mod–
 = 
ssd_m‘a_¬ch
.
	$SSDM‘aArch
(

112 
is_Œaššg
, 
mock_ªchÜ_g’”©Ü
, 
mock_box_´ediùÜ
, 
mock_box_cod”
,

113 
çke_ã©u»_exŒaùÜ
, 
mock_m©ch”
, 
»giÚ_sim¬™y_ÿlcuÏtÜ
,

114 
image_»siz”_â
, 
nÚ_max_suµ»ssiÚ_â
, 
tf
.
id’t™y
,

115 
şassifiÿtiÚ_loss
, 
loÿliz©iÚ_loss
, 
şassifiÿtiÚ_loss_weight
,

116 
loÿliz©iÚ_loss_weight
, 
nÜm®ize_loss_by_num_m©ches
,

117 
h¬d_exam¶e_mš”
)

119 
def
 
	$‹¡_´•roûss_´e£rves_šput_sh­es
(
£lf
):

120 
image_sh­es
 = [(3, 
NÚe
, None, 3),

121 (
NÚe
, 10, 10, 3),

122 (
NÚe
, None, None, 3)]

123 
image_sh­e
 
š
 
image_sh­es
:

124 
image_¶aûhŞd”
 = 
tf
.
	$¶aûhŞd”
(
tf
.
æßt32
, 
sh­e
=
image_sh­e
)

125 
´•roûs£d_šputs
 = 
£lf
.
_mod–
.
	$´•roûss
(
image_¶aûhŞd”
)

126 
£lf
.
	`as£¹AÎEqu®
(
´•roûs£d_šputs
.
sh­e
.
	`as_li¡
(), 
image_sh­e
)

128 
def
 
	$‹¡_´ediù_»suÉs_have_cÜ»ù_keys_ªd_sh­es
(
£lf
):

129 
b©ch_size
 = 3

130 
image_size
 = 2

131 
šput_sh­es
 = [(
b©ch_size
, 
image_size
, image_size, 3),

132 (
NÚe
, 
image_size
, image_size, 3),

133 (
b©ch_size
, 
NÚe
, None, 3),

134 (
NÚe
, None, None, 3)]

135 
ex³ùed_box_’codšgs_sh­e_out
 = (

136 
b©ch_size
, 
£lf
.
_num_ªchÜs
, s–f.
_code_size
)

137 
ex³ùed_şass_´ediùiÚs_w™h_background_sh­e_out
 = (

138 
b©ch_size
, 
£lf
.
_num_ªchÜs
, s–f.
_num_şas£s
+1)

140 
šput_sh­e
 
š
 
šput_sh­es
:

141 
tf_g¿ph
 = 
tf
.
	$G¿ph
()

142 
w™h
 
tf_g¿ph
.
	$as_deçuÉ
():

143 
´•roûs£d_šput_¶aûhŞd”
 = 
tf
.
	$¶aûhŞd”
(
tf
.
æßt32
,

144 
sh­e
=
šput_sh­e
)

145 
´ediùiÚ_diù
 = 
£lf
.
_mod–
.
	$´ediù
(
´•roûs£d_šput_¶aûhŞd”
)

147 
£lf
.
	`as£¹True
('box_’codšgs' 
š
 
´ediùiÚ_diù
)

148 
£lf
.
	`as£¹True
('şass_´ediùiÚs_w™h_background' 
š
 
´ediùiÚ_diù
)

149 
£lf
.
	`as£¹True
('ã©u»_m­s' 
š
 
´ediùiÚ_diù
)

151 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

152 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(
g¿ph
=
tf_g¿ph
è
as
 
£ss
:

153 
£ss
.
	$run
(
š™_İ
)

154 
´ediùiÚ_out
 = 
£ss
.
	`run
(
´ediùiÚ_diù
,

155 
ãed_diù
={

156 
´•roûs£d_šput_¶aûhŞd”
:

157 
Å
.
¿ndom
.
	`unifÜm
(

158 
size
=(
b©ch_size
, 2, 2, 3))
	}
})

159 
	g£lf
.
as£¹AÎEqu®
(
´ediùiÚ_out
['box_’codšgs'].
sh­e
,

160 
ex³ùed_box_’codšgs_sh­e_out
)

161 
	g£lf
.
as£¹AÎEqu®
(

162 
´ediùiÚ_out
['şass_´ediùiÚs_w™h_background'].
sh­e
,

163 
ex³ùed_şass_´ediùiÚs_w™h_background_sh­e_out
)

165 
def
 
	$‹¡_po¡´oûss_»suÉs_¬e_cÜ»ù
(
£lf
):

166 
b©ch_size
 = 2

167 
image_size
 = 2

168 
šput_sh­es
 = [(
b©ch_size
, 
image_size
, image_size, 3),

169 (
NÚe
, 
image_size
, image_size, 3),

170 (
b©ch_size
, 
NÚe
, None, 3),

171 (
NÚe
, None, None, 3)]

173 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([[[0, 0, .5, .5],

183 
ex³ùed_scÜes
 = 
Å
.
	$¬¿y
([[0, 0, 0, 0, 0],

185 
ex³ùed_şas£s
 = 
Å
.
	$¬¿y
([[0, 0, 0, 0, 0],

187 
ex³ùed_num_d‘eùiÚs
 = 
Å
.
	$¬¿y
([4, 4])

189 
šput_sh­e
 
š
 
šput_sh­es
:

190 
tf_g¿ph
 = 
tf
.
	$G¿ph
()

191 
w™h
 
tf_g¿ph
.
	$as_deçuÉ
():

192 
´•roûs£d_šput_¶aûhŞd”
 = 
tf
.
	$¶aûhŞd”
(
tf
.
æßt32
,

193 
sh­e
=
šput_sh­e
)

194 
´ediùiÚ_diù
 = 
£lf
.
_mod–
.
	$´ediù
(
´•roûs£d_šput_¶aûhŞd”
)

195 
d‘eùiÚs
 = 
£lf
.
_mod–
.
	$po¡´oûss
(
´ediùiÚ_diù
)

196 
£lf
.
	`as£¹True
('d‘eùiÚ_boxes' 
š
 
d‘eùiÚs
)

197 
£lf
.
	`as£¹True
('d‘eùiÚ_scÜes' 
š
 
d‘eùiÚs
)

198 
£lf
.
	`as£¹True
('d‘eùiÚ_şas£s' 
š
 
d‘eùiÚs
)

199 
£lf
.
	`as£¹True
('num_d‘eùiÚs' 
š
 
d‘eùiÚs
)

200 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

201 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(
g¿ph
=
tf_g¿ph
è
as
 
£ss
:

202 
£ss
.
	$run
(
š™_İ
)

203 
d‘eùiÚs_out
 = 
£ss
.
	`run
(
d‘eùiÚs
,

204 
ãed_diù
={

205 
´•roûs£d_šput_¶aûhŞd”
:

206 
Å
.
¿ndom
.
	`unifÜm
(

207 
size
=(
b©ch_size
, 2, 2, 3))
	}
})

208 
	g£lf
.
as£¹AÎClo£
(
d‘eùiÚs_out
['d‘eùiÚ_boxes'], 
ex³ùed_boxes
)

209 
	g£lf
.
as£¹AÎClo£
(
d‘eùiÚs_out
['d‘eùiÚ_scÜes'], 
ex³ùed_scÜes
)

210 
	g£lf
.
as£¹AÎClo£
(
d‘eùiÚs_out
['d‘eùiÚ_şas£s'], 
ex³ùed_şas£s
)

211 
	g£lf
.
as£¹AÎClo£
(
d‘eùiÚs_out
['num_detections'],

212 
ex³ùed_num_d‘eùiÚs
)

214 
def
 
	$‹¡_loss_»suÉs_¬e_cÜ»ù
(
£lf
):

215 
b©ch_size
 = 2

216 
´•roûs£d_šput
 = 
tf
.
	`¿ndom_unifÜm
((
b©ch_size
, 2, 2, 3),

217 
dty³
=
tf
.
æßt32
)

218 
groundŒuth_boxes_li¡
 = [
tf
.
	`cÚ¡ªt
([[0, 0, .5, .5]], 
dty³
ñf.
æßt32
),

219 
tf
.
	`cÚ¡ªt
([[0, 0, .5, .5]], 
dty³
ñf.
æßt32
)]

220 
groundŒuth_şas£s_li¡
 = [
tf
.
	`cÚ¡ªt
([[1]], 
dty³
ñf.
æßt32
),

221 
tf
.
	`cÚ¡ªt
([[1]], 
dty³
ñf.
æßt32
)]

222 
£lf
.
_mod–
.
	$´ovide_groundŒuth
(
groundŒuth_boxes_li¡
,

223 
groundŒuth_şas£s_li¡
)

224 
´ediùiÚ_diù
 = 
£lf
.
_mod–
.
	$´ediù
(
´•roûs£d_šput
)

225 
loss_diù
 = 
£lf
.
_mod–
.
	$loss
(
´ediùiÚ_diù
)

227 
£lf
.
	`as£¹True
('loÿliz©iÚ_loss' 
š
 
loss_diù
)

228 
£lf
.
	`as£¹True
('şassifiÿtiÚ_loss' 
š
 
loss_diù
)

230 
ex³ùed_loÿliz©iÚ_loss
 = 0.0

231 
ex³ùed_şassifiÿtiÚ_loss
 = (
b©ch_size
 * 
£lf
.
_num_ªchÜs


232 * (
£lf
.
_num_şas£s
+1è* 
Å
.
	$log
(2.0))

233 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

234 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

235 
£ss
.
	$run
(
š™_İ
)

236 
los£s_out
 = 
£ss
.
	$run
(
loss_diù
)

238 
£lf
.
	`as£¹AÎClo£
(
los£s_out
['localization_loss'],

239 
ex³ùed_loÿliz©iÚ_loss
)

240 
£lf
.
	`as£¹AÎClo£
(
los£s_out
['classification_loss'],

241 
ex³ùed_şassifiÿtiÚ_loss
)

243 
def
 
	$‹¡_»¡Üe_m­_fÜ_d‘eùiÚ_ck±
(
£lf
):

244 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

245 
§v”
 = 
tf_§v”
.
	$Sav”
()

246 
§ve_·th
 = 
£lf
.
	$g‘_‹mp_dœ
()

247 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

248 
£ss
.
	$run
(
š™_İ
)

249 
§ved_mod–_·th
 = 
§v”
.
	$§ve
(
£ss
, 
§ve_·th
)

250 
v¬_m­
 = 
£lf
.
_mod–
.
	$»¡Üe_m­
(
äom_d‘eùiÚ_checkpošt
=
True
)

251 
£lf
.
	$as£¹IsIn¡ªû
(
v¬_m­
, 
diù
)

252 
§v”
 = 
tf
.
Œaš
.
	$Sav”
(
v¬_m­
)

253 
§v”
.
	$»¡Üe
(
£ss
, 
§ved_mod–_·th
)

254 
v¬
 
š
 
£ss
.
	`run
(
tf
.
	$»pÜt_unš™Ÿlized_v¬ŸbËs
()):

255 
£lf
.
	`as£¹NÙIn
('F—tu»ExŒaùÜ', 
v¬
.
Çme
)

257 
def
 
	$‹¡_»¡Üe_m­_fÜ_şassifiÿtiÚ_ck±
(
£lf
):

258 #Defš
mock
 
‹nsÜæow
 
şassifiÿtiÚ
 
g¿ph
 
ªd
 
§ve
 
v¬ŸbËs
.

259 
‹¡_g¿ph_şassifiÿtiÚ
 = 
tf
.
	$G¿ph
()

260 
w™h
 
‹¡_g¿ph_şassifiÿtiÚ
.
	$as_deçuÉ
():

261 
image
 = 
tf
.
	$¶aûhŞd”
(
dty³
=
tf
.
æßt32
, 
sh­e
=[1, 20, 20, 3])

262 
w™h
 
tf
.
	`v¬ŸbË_scİe
('mock_model'):

263 
Ãt
 = 
¦im
.
	`cÚv2d
(
image
, 
num_ouuts
=32, 
k”Ãl_size
=1, 
scİe
='layer1')

264 
¦im
.
	`cÚv2d
(
Ãt
, 
num_ouuts
=3, 
k”Ãl_size
=1, 
scİe
='layer2')

266 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

267 
§v”
 = 
tf
.
Œaš
.
	$Sav”
()

268 
§ve_·th
 = 
£lf
.
	$g‘_‹mp_dœ
()

269 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

270 
£ss
.
	$run
(
š™_İ
)

271 
§ved_mod–_·th
 = 
§v”
.
	$§ve
(
£ss
, 
§ve_·th
)

273 #C»©
‹nsÜæow
 
d‘eùiÚ
 
g¿ph
 
ªd
 
lßd
 
v¬ŸbËs
 
äom


274 #şassifiÿtiÚ 
checkpošt
.

275 
‹¡_g¿ph_d‘eùiÚ
 = 
tf
.
	$G¿ph
()

276 
w™h
 
‹¡_g¿ph_d‘eùiÚ
.
	$as_deçuÉ
():

277 
šputs_sh­e
 = [2, 2, 2, 3]

278 
šputs
 = 
tf
.
	`to_æßt
Ñf.
	$¿ndom_unifÜm
(

279 
šputs_sh­e
, 
mšv®
=0, 
maxv®
=255, 
dty³
=
tf
.
št32
))

280 
´•roûs£d_šputs
 = 
£lf
.
_mod–
.
	$´•roûss
(
šputs
)

281 
´ediùiÚ_diù
 = 
£lf
.
_mod–
.
	$´ediù
(
´•roûs£d_šputs
)

282 
£lf
.
_mod–
.
	$po¡´oûss
(
´ediùiÚ_diù
)

283 
v¬_m­
 = 
£lf
.
_mod–
.
	$»¡Üe_m­
(
äom_d‘eùiÚ_checkpošt
=
F®£
)

284 
£lf
.
	$as£¹IsIn¡ªû
(
v¬_m­
, 
diù
)

285 
§v”
 = 
tf
.
Œaš
.
	$Sav”
(
v¬_m­
)

286 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

287 
§v”
.
	$»¡Üe
(
£ss
, 
§ved_mod–_·th
)

288 
v¬
 
š
 
£ss
.
	`run
(
tf
.
	$»pÜt_unš™Ÿlized_v¬ŸbËs
()):

289 
£lf
.
	`as£¹NÙIn
('F—tu»ExŒaùÜ', 
v¬
.
Çme
)

292 
__Çme__
 == '__main__':

293 
tf
.
‹¡
.
	`maš
()

	@models/__init__.py

	@models/faster_rcnn_inception_resnet_v2_feature_extractor.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
	gS“
 "Inception-v4, Inception-ResNet‡ndhe Impact of Residual Connections on

19 
	gL—ºšg
" by Szegedyƒt‡l. (https://arxiv.org/abs/1602.07261)

20 
as
 
w–l
 
	gas


21 "S³ed/accu¿cy¿de-off fÜ mod”ÀcÚvŞutiÚ® objeù d‘eùÜs" 
by


22 
Huªg
 
‘
 
	g®
. (
	gh‰ps
:

25 
impÜt
 
‹nsÜæow
 
as
 
tf


27 
äom
 
objeù_d‘eùiÚ
.
m‘a_¬ch™eùu»s
 
impÜt
 
ç¡”_rún_m‘a_¬ch


28 
äom
 
Ãts
 
impÜt
 
šû±iÚ_»¢‘_v2


30 
¦im
 = 
tf
.
cÚŒib
.slim

33 
şass
 
	$Fa¡”RCNNInû±iÚRe¢‘V2F—tu»ExŒaùÜ
(

34 
ç¡”_rún_m‘a_¬ch
.
Fa¡”RCNNF—tu»ExŒaùÜ
):

37 
def
 
	$__š™__
(
£lf
,

38 
is_Œaššg
,

39 
fœ¡_¡age_ã©u»s_¡ride
,

40 
»u£_weights
=
NÚe
,

41 
weight_deÿy
=0.0):

44 
Args
:

45 
is_Œaššg
: 
S“
 
ba£
 
şass
.

46 
fœ¡_¡age_ã©u»s_¡ride
: 
S“
 
ba£
 
şass
.

47 
»u£_weights
: 
S“
 
ba£
 
şass
.

48 
weight_deÿy
: 
S“
 
ba£
 
şass
.

50 
Rai£s
:

51 
V®ueE¼Ü
: 
If
 `
fœ¡_¡age_ã©u»s_¡ride
` 
is
 
nÙ
 8 
Ü
 16.

53 
fœ¡_¡age_ã©u»s_¡ride
 !ğ8 
ªd
 first_stage_features_stride != 16:

54 
¿i£
 
	`V®ueE¼Ü
('`first_stage_features_stride` must be 8 or 16.')

55 
	`su³r
(
Fa¡”RCNNInû±iÚRe¢‘V2F—tu»ExŒaùÜ
, 
£lf
).
	$__š™__
(

56 
is_Œaššg
, 
fœ¡_¡age_ã©u»s_¡ride
, 
»u£_weights
, 
weight_deÿy
)

58 
def
 
	$´•roûss
(
£lf
, 
»sized_šputs
):

61 
M­s
 
pix–
 
v®ues
 
to
 
the
 
¿nge
 [-1, 1].

63 
Args
:

64 
»sized_šputs
: 
A
 [
b©ch
, 
height_š
, 
width_š
, 
chªÃls
] 
æßt32
 
‹nsÜ


65 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
 
w™h
 
v®ues
 
b‘w“n
 0 
ªd
 255.0.

67 
R‘uºs
:

68 
´•roûs£d_šputs
: 
A
 [
b©ch
, 
height_out
, 
width_out
, 
chªÃls
] 
æßt32


69 
‹nsÜ
 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

72  (2.0 / 255.0è* 
»sized_šputs
 - 1.0

74 
def
 
	$_exŒaù_´İo§l_ã©u»s
(
£lf
, 
´•roûs£d_šputs
, 
scİe
):

77 
ExŒaùs
 
ã©u»s
 
usšg
 
the
 
fœ¡
 
h®f
 
of
h
Inû±iÚ
 
Re¢‘
 
v2
 
ÃtwÜk
.

78 
We
 
cÚ¡ruù
 
the
 
ÃtwÜk
 
š
 `
®ign_ã©u»_m­s
=
True
` 
mode
, 
which
 
m—ns


79 
th©
 
®l
 
VALID
 
·ddšgs
 
š
 
the
 
ÃtwÜk
 
¬e
 
chªged
 
to
 
SAME
 
·ddšg
 
so
hat

80 
the
 
ã©u»
 
m­s
 
¬e
 
®igÃd
.

82 
Args
:

83 
´•roûs£d_šputs
: 
A
 [
b©ch
, 
height
, 
width
, 
chªÃls
] 
æßt32
 
‹nsÜ


84 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

85 
scİe
: 
A
 scİ
Çme
.

87 
R‘uºs
:

88 
½n_ã©u»_m­
: 
A
 
‹nsÜ
 
w™h
 
sh­e
 [
b©ch
, 
height
, 
width
, 
d•th
]

89 
Rai£s
:

90 
Inv®idArgum’tE¼Ü
: 
If
 
the
 
¥©Ÿl
 
size
 
of
 `
´•roûs£d_šputs
`

91 (
height
 
Ü
 
width
è
is
 
Ëss
 
thª
 33.

92 
V®ueE¼Ü
: 
If
 
the
 
ü—‹d
 
ÃtwÜk
 
is
 
missšg
h
»quœed
 
aùiv©iÚ
.

94 
	`Ën
(
´•roûs£d_šputs
.
	`g‘_sh­e
().
	`as_li¡
()) != 4:

95 
¿i£
 
	`V®ueE¼Ü
('`preprocessed_inputs` must be 4 dimensional, got‡ '

96 '‹nsÜ oàsh­%s' % 
´•roûs£d_šputs
.
	$g‘_sh­e
())

98 
w™h
 
¦im
.
	`¬g_scİe
(
šû±iÚ_»¢‘_v2
.
	$šû±iÚ_»¢‘_v2_¬g_scİe
(

99 
weight_deÿy
=
£lf
.
_weight_deÿy
)):

100 #FÜû 
is_Œaššg
 
to
 
F®£
Ø
di§bË
 
b©ch
 
nÜm
 
upd©e
.

101 
w™h
 
¦im
.
	$¬g_scİe
([
¦im
.
b©ch_nÜm
], 
is_Œaššg
=
F®£
):

102 
w™h
 
tf
.
	`v¬ŸbË_scİe
('InceptionResnetV2',

103 
»u£
=
£lf
.
_»u£_weights
è
as
 
scİe
:

104 
½n_ã©u»_m­
, 
_
 = (

105 
šû±iÚ_»¢‘_v2
.
	`šû±iÚ_»¢‘_v2_ba£
(

106 
´•roûs£d_šputs
, 
fš®_’dpošt
='PreAuxLogits',

107 
scİe
=scİe, 
ouut_¡ride
=
£lf
.
_fœ¡_¡age_ã©u»s_¡ride
,

108 
®ign_ã©u»_m­s
=
True
))

109  
½n_ã©u»_m­


111 
def
 
	$_exŒaù_box_şassif›r_ã©u»s
(
£lf
, 
´İo§l_ã©u»_m­s
, 
scİe
):

114 
This
 
funùiÚ
 
»cÚ¡ruùs
 
the
 "£cÚd h®f" 
of
h
Inû±iÚ
 
ResN‘
 
v2


115 
ÃtwÜk
 
aá”
 
the
 
·¹
 
defšed
 
š
 `
_exŒaù_´İo§l_ã©u»s
`.

117 
Args
:

118 
´İo§l_ã©u»_m­s
: 
A
 4-
D
 
‹nsÜ
 
w™h
 
sh­e


119 [
b©ch_size
 * 
£lf
.
max_num_´İo§ls
, 
üİ_height
, 
üİ_width
, 
d•th
]

120 
»´e£Ášg
 
the
 
ã©u»
 
m­
 
üİ³d
 
to
 
—ch
 
´İo§l
.

121 
scİe
: 
A
 scİ
Çme
.

123 
R‘uºs
:

124 
´İo§l_şassif›r_ã©u»s
: 
A
 4-
D
 
‹nsÜ
 
w™h
 
sh­e


125 [
b©ch_size
 * 
£lf
.
max_num_´İo§ls
, 
height
, 
width
, 
d•th
]

126 
»´e£Ášg
 
box
 
şassif›r
 
ã©u»s
 
—ch
 
´İo§l
.

128 
w™h
 
tf
.
	`v¬ŸbË_scİe
('Inû±iÚRe¢‘V2', 
»u£
=
£lf
.
_»u£_weights
):

129 
w™h
 
¦im
.
	`¬g_scİe
(
šû±iÚ_»¢‘_v2
.
	$šû±iÚ_»¢‘_v2_¬g_scİe
(

130 
weight_deÿy
=
£lf
.
_weight_deÿy
)):

131 #FÜû 
is_Œaššg
 
to
 
F®£
Ø
di§bË
 
b©ch
 
nÜm
 
upd©e
.

132 
w™h
 
¦im
.
	$¬g_scİe
([
¦im
.
b©ch_nÜm
], 
is_Œaššg
=
F®£
):

133 
w™h
 
¦im
.
	`¬g_scİe
([¦im.
cÚv2d
, slim.
max_poŞ2d
, slim.
avg_poŞ2d
],

134 
¡ride
=1, 
·ddšg
='SAME'):

135 
w™h
 
tf
.
	`v¬ŸbË_scİe
('Mixed_7a'):

136 
w™h
 
tf
.
	`v¬ŸbË_scİe
('Branch_0'):

137 
tow”_cÚv
 = 
¦im
.
	`cÚv2d
(
´İo§l_ã©u»_m­s
,

138 256, 1, 
scİe
='Conv2d_0a_1x1')

139 
tow”_cÚv_1
 = 
¦im
.
	`cÚv2d
(

140 
tow”_cÚv
, 384, 3, 
¡ride
=2,

141 
·ddšg
='VALID', 
scİe
='Conv2d_1a_3x3')

142 
w™h
 
tf
.
	`v¬ŸbË_scİe
('Branch_1'):

143 
tow”_cÚv1
 = 
¦im
.
	`cÚv2d
(

144 
´İo§l_ã©u»_m­s
, 256, 1, 
scİe
='Conv2d_0a_1x1')

145 
tow”_cÚv1_1
 = 
¦im
.
	`cÚv2d
(

146 
tow”_cÚv1
, 288, 3, 
¡ride
=2,

147 
·ddšg
='VALID', 
scİe
='Conv2d_1a_3x3')

148 
w™h
 
tf
.
	`v¬ŸbË_scİe
('Branch_2'):

149 
tow”_cÚv2
 = 
¦im
.
	`cÚv2d
(

150 
´İo§l_ã©u»_m­s
, 256, 1, 
scİe
='Conv2d_0a_1x1')

151 
tow”_cÚv2_1
 = 
¦im
.
	`cÚv2d
(
tow”_cÚv2
, 288, 3,

152 
scİe
='Conv2d_0b_3x3')

153 
tow”_cÚv2_2
 = 
¦im
.
	`cÚv2d
(

154 
tow”_cÚv2_1
, 320, 3, 
¡ride
=2,

155 
·ddšg
='VALID', 
scİe
='Conv2d_1a_3x3')

156 
w™h
 
tf
.
	`v¬ŸbË_scİe
('Branch_3'):

157 
tow”_poŞ
 = 
¦im
.
	`max_poŞ2d
(

158 
´İo§l_ã©u»_m­s
, 3, 
¡ride
=2, 
·ddšg
='VALID',

159 
scİe
='MaxPool_1a_3x3')

160 
Ãt
 = 
tf
.
	$cÚÿt
(

161 [
tow”_cÚv_1
, 
tow”_cÚv1_1
, 
tow”_cÚv2_2
, 
tow”_poŞ
], 3)

162 
Ãt
 = 
¦im
.
	$»³©
(
Ãt
, 9, 
šû±iÚ_»¢‘_v2
.
block8
, 
sÿË
=0.20)

163 
Ãt
 = 
šû±iÚ_»¢‘_v2
.
	$block8
(
Ãt
, 
aùiv©iÚ_â
=
NÚe
)

164 
´İo§l_şassif›r_ã©u»s
 = 
¦im
.
	`cÚv2d
(

165 
Ãt
, 1536, 1, 
scİe
='Conv2d_7b_1x1')

166  
´İo§l_şassif›r_ã©u»s


168 
def
 
	$»¡Üe_äom_şassifiÿtiÚ_checkpošt_â
(

169 
£lf
,

170 
fœ¡_¡age_ã©u»_exŒaùÜ_scİe
,

171 
£cÚd_¡age_ã©u»_exŒaùÜ_scİe
):

174 
NÙe
 
th©
 
this
 
ov”rides
 
the
  
im¶em’tiÚ
 
š


175 
ç¡”_rún_m‘a_¬ch
.
Fa¡”RCNNF—tu»ExŒaùÜ
 
which
 
dÛs
 
nÙ
 
wÜk
 

176 
Inû±iÚRe¢‘V2
 
checkpošts
.

178 
TODO
: 
»vis™
 
wh‘h”
 
™
's…ossibleo forcehe

179 `
R•—t
` 
Çmescİe
 
as
 
ü—‹d
 
š
 `
_exŒaù_box_şassif›r_ã©u»s
` 
to


180 
¡¬t
 
couÁšg
 
©
 2 (
e
.
g
. `
R•—t_2
`è
so
 
th©
 
the
  
»¡Üe_â
 
ÿn


181 
be
 
u£d
.

183 
Args
:

184 
fœ¡_¡age_ã©u»_exŒaùÜ_scİe
: 
A
 
scİe
 
Çme
 
the
 
fœ¡
 
¡age


185 
ã©u»
 
exŒaùÜ
.

186 
£cÚd_¡age_ã©u»_exŒaùÜ_scİe
: 
A
 
scİe
 
Çme
 
the
 
£cÚd
 
¡age


187 
ã©u»
 
exŒaùÜ
.

189 
R‘uºs
:

190 
A
 
diù
 
m­pšg
 
v¬ŸbË
 
	$Çmes
 (
to
 
lßd
 
äom
 
a
 
checkpošt
ètØ
v¬ŸbËs
 
š


191 
the
 
mod–
 
g¿ph
.

194 
v¬ŸbËs_to_»¡Üe
 = {
	}
}

195 
v¬ŸbË
 
š
 
tf
.
	$glob®_v¬ŸbËs
():

196 
v¬ŸbË
.
İ
.
Çme
.
	$¡¬tsw™h
(

197 
fœ¡_¡age_ã©u»_exŒaùÜ_scİe
):

198 
v¬_Çme
 = 
v¬ŸbË
.
İ
.
Çme
.
	`»¶aû
(

199 
fœ¡_¡age_ã©u»_exŒaùÜ_scİe
 + '/', '')

200 
v¬ŸbËs_to_»¡Üe
[
v¬_Çme
] = 
v¬ŸbË


201 
v¬ŸbË
.
İ
.
Çme
.
	$¡¬tsw™h
(

202 
£cÚd_¡age_ã©u»_exŒaùÜ_scİe
):

203 
v¬_Çme
 = 
v¬ŸbË
.
İ
.
Çme
.
	`»¶aû
(

204 
£cÚd_¡age_ã©u»_exŒaùÜ_scİe


206 
v¬_Çme
 = v¬_Çme.
	`»¶aû
(

207 
£cÚd_¡age_ã©u»_exŒaùÜ_scİe
 + '/', '')

208 
v¬ŸbËs_to_»¡Üe
[
v¬_Çme
] = 
v¬ŸbË


209  
v¬ŸbËs_to_»¡Üe


	@models/faster_rcnn_inception_resnet_v2_feature_extractor_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
mod–s
 
impÜt
 
ç¡”_rún_šû±iÚ_»¢‘_v2_ã©u»_exŒaùÜ
 
as
 
äún_šc_»s


23 
şass
 
	$Fa¡”RúnInû±iÚRe¢‘V2F—tu»ExŒaùÜTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

25 
def
 
	$_bud_ã©u»_exŒaùÜ
(
£lf
, 
fœ¡_¡age_ã©u»s_¡ride
):

26  
äún_šc_»s
.
	$Fa¡”RCNNInû±iÚRe¢‘V2F—tu»ExŒaùÜ
(

27 
is_Œaššg
=
F®£
,

28 
fœ¡_¡age_ã©u»s_¡ride
=first_stage_features_stride,

29 
»u£_weights
=
NÚe
,

30 
weight_deÿy
=0.0)

32 
def
 
	$‹¡_exŒaù_´İo§l_ã©u»s_»tuºs_ex³ùed_size
(
£lf
):

33 
ã©u»_exŒaùÜ
 = 
£lf
.
	$_bud_ã©u»_exŒaùÜ
(

34 
fœ¡_¡age_ã©u»s_¡ride
=16)

35 
´•roûs£d_šputs
 = 
tf
.
	$¿ndom_unifÜm
(

36 [1, 299, 299, 3], 
maxv®
=255, 
dty³
=
tf
.
æßt32
)

37 
½n_ã©u»_m­
 = 
ã©u»_exŒaùÜ
.
	`exŒaù_´İo§l_ã©u»s
(

38 
´•roûs£d_šputs
, 
scİe
='TestScope')

39 
ã©u»s_sh­e
 = 
tf
.
	$sh­e
(
½n_ã©u»_m­
)

41 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

42 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

43 
£ss
.
	$run
(
š™_İ
)

44 
ã©u»s_sh­e_out
 = 
£ss
.
	$run
(
ã©u»s_sh­e
)

45 
£lf
.
	$as£¹AÎEqu®
(
ã©u»s_sh­e_out
, [1, 19, 19, 1088])

47 
def
 
	$‹¡_exŒaù_´İo§l_ã©u»s_¡ride_eight
(
£lf
):

48 
ã©u»_exŒaùÜ
 = 
£lf
.
	$_bud_ã©u»_exŒaùÜ
(

49 
fœ¡_¡age_ã©u»s_¡ride
=8)

50 
´•roûs£d_šputs
 = 
tf
.
	$¿ndom_unifÜm
(

51 [1, 224, 224, 3], 
maxv®
=255, 
dty³
=
tf
.
æßt32
)

52 
½n_ã©u»_m­
 = 
ã©u»_exŒaùÜ
.
	`exŒaù_´İo§l_ã©u»s
(

53 
´•roûs£d_šputs
, 
scİe
='TestScope')

54 
ã©u»s_sh­e
 = 
tf
.
	$sh­e
(
½n_ã©u»_m­
)

56 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

57 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

58 
£ss
.
	$run
(
š™_İ
)

59 
ã©u»s_sh­e_out
 = 
£ss
.
	$run
(
ã©u»s_sh­e
)

60 
£lf
.
	$as£¹AÎEqu®
(
ã©u»s_sh­e_out
, [1, 28, 28, 1088])

62 
def
 
	$‹¡_exŒaù_´İo§l_ã©u»s_h®f_size_šput
(
£lf
):

63 
ã©u»_exŒaùÜ
 = 
£lf
.
	$_bud_ã©u»_exŒaùÜ
(

64 
fœ¡_¡age_ã©u»s_¡ride
=16)

65 
´•roûs£d_šputs
 = 
tf
.
	$¿ndom_unifÜm
(

66 [1, 112, 112, 3], 
maxv®
=255, 
dty³
=
tf
.
æßt32
)

67 
½n_ã©u»_m­
 = 
ã©u»_exŒaùÜ
.
	`exŒaù_´İo§l_ã©u»s
(

68 
´•roûs£d_šputs
, 
scİe
='TestScope')

69 
ã©u»s_sh­e
 = 
tf
.
	$sh­e
(
½n_ã©u»_m­
)

71 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

72 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

73 
£ss
.
	$run
(
š™_İ
)

74 
ã©u»s_sh­e_out
 = 
£ss
.
	$run
(
ã©u»s_sh­e
)

75 
£lf
.
	$as£¹AÎEqu®
(
ã©u»s_sh­e_out
, [1, 7, 7, 1088])

77 
def
 
	$‹¡_exŒaù_´İo§l_ã©u»s_d›s_Ú_šv®id_¡ride
(
£lf
):

78 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

79 
£lf
.
	$_bud_ã©u»_exŒaùÜ
(
fœ¡_¡age_ã©u»s_¡ride
=99)

81 
def
 
	$‹¡_exŒaù_´İo§l_ã©u»s_d›s_w™h_šcÜ»ù_¿nk_šputs
(
£lf
):

82 
ã©u»_exŒaùÜ
 = 
£lf
.
	$_bud_ã©u»_exŒaùÜ
(

83 
fœ¡_¡age_ã©u»s_¡ride
=16)

84 
´•roûs£d_šputs
 = 
tf
.
	$¿ndom_unifÜm
(

85 [224, 224, 3], 
maxv®
=255, 
dty³
=
tf
.
æßt32
)

86 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

87 
ã©u»_exŒaùÜ
.
	`exŒaù_´İo§l_ã©u»s
(

88 
´•roûs£d_šputs
, 
scİe
='TestScope')

90 
def
 
	$‹¡_exŒaù_box_şassif›r_ã©u»s_»tuºs_ex³ùed_size
(
£lf
):

91 
ã©u»_exŒaùÜ
 = 
£lf
.
	$_bud_ã©u»_exŒaùÜ
(

92 
fœ¡_¡age_ã©u»s_¡ride
=16)

93 
´İo§l_ã©u»_m­s
 = 
tf
.
	$¿ndom_unifÜm
(

94 [2, 17, 17, 1088], 
maxv®
=255, 
dty³
=
tf
.
æßt32
)

95 
´İo§l_şassif›r_ã©u»s
 = (

96 
ã©u»_exŒaùÜ
.
	`exŒaù_box_şassif›r_ã©u»s
(

97 
´İo§l_ã©u»_m­s
, 
scİe
='TestScope'))

98 
ã©u»s_sh­e
 = 
tf
.
	$sh­e
(
´İo§l_şassif›r_ã©u»s
)

100 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

101 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

102 
£ss
.
	$run
(
š™_İ
)

103 
ã©u»s_sh­e_out
 = 
£ss
.
	$run
(
ã©u»s_sh­e
)

104 
£lf
.
	$as£¹AÎEqu®
(
ã©u»s_sh­e_out
, [2, 8, 8, 1536])

107 
__Çme__
 == '__main__':

108 
tf
.
‹¡
.
	`maš
()

	@models/faster_rcnn_resnet_v1_feature_extractor.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
	gS“
 "D“°Residu® L—ºšg fÜ ImagRecogn™iÚ" 
by
 
He
 
‘
 
	g®
., 2015.

19 
	gh‰ps
:

21 
NÙe
: 
this
 
im¶em’tiÚ
 
assumes
 
th©
 
the
 
şassifiÿtiÚ
 
checkpošt
 
u£d


22 
to
 
fš‘uÃ
 
this
 
mod–
 
is
 
Œašed
 
usšg
 
the
 
§me
 
cÚfigu¿tiÚ
 
as
 
th©
 
of


23 
the
 
MSRA
 
´ovided
 
checkpošts


24 (
£e
 
h‰ps
:

25 
§me
 
´•roûssšg
, 
b©ch
 
nÜm
 
	gsÿlšg
, 
	g‘c
.

27 
impÜt
 
‹nsÜæow
 
as
 
tf


29 
äom
 
	gobjeù_d‘eùiÚ
.
m‘a_¬ch™eùu»s
 
impÜt
 
ç¡”_rún_m‘a_¬ch


30 
äom
 
Ãts
 
impÜt
 
»¢‘_uts


31 
äom
 
Ãts
 
impÜt
 
»¢‘_v1


33 
	g¦im
 = 
tf
.
cÚŒib
.
¦im


36 
şass
 
	$Fa¡”RCNNRe¢‘V1F—tu»ExŒaùÜ
(

37 
ç¡”_rún_m‘a_¬ch
.
Fa¡”RCNNF—tu»ExŒaùÜ
):

40 
def
 
	$__š™__
(
£lf
,

41 
¬ch™eùu»
,

42 
»¢‘_mod–
,

43 
is_Œaššg
,

44 
fœ¡_¡age_ã©u»s_¡ride
,

45 
»u£_weights
=
NÚe
,

46 
weight_deÿy
=0.0):

49 
Args
:

50 
¬ch™eùu»
: 
Arch™eùu»
 
Çme
 
of
 
the
 
Re¢‘
 
V1
 
mod–
.

51 
»¢‘_mod–
: 
Defš™iÚ
 
of
 
the
 
Re¢‘
 
V1
 
mod–
.

52 
is_Œaššg
: 
S“
 
ba£
 
şass
.

53 
fœ¡_¡age_ã©u»s_¡ride
: 
S“
 
ba£
 
şass
.

54 
»u£_weights
: 
S“
 
ba£
 
şass
.

55 
weight_deÿy
: 
S“
 
ba£
 
şass
.

57 
Rai£s
:

58 
V®ueE¼Ü
: 
If
 `
fœ¡_¡age_ã©u»s_¡ride
` 
is
 
nÙ
 8 
Ü
 16.

60 
fœ¡_¡age_ã©u»s_¡ride
 !ğ8 
ªd
 first_stage_features_stride != 16:

61 
¿i£
 
	`V®ueE¼Ü
('`first_stage_features_stride` must be 8 or 16.')

62 
£lf
.
_¬ch™eùu»
 = 
¬ch™eùu»


63 
£lf
.
_»¢‘_mod–
 = 
»¢‘_mod–


64 
	`su³r
(
Fa¡”RCNNRe¢‘V1F—tu»ExŒaùÜ
, 
£lf
).
	$__š™__
(

65 
is_Œaššg
, 
fœ¡_¡age_ã©u»s_¡ride
, 
»u£_weights
, 
weight_deÿy
)

67 
def
 
	$´•roûss
(
£lf
, 
»sized_šputs
):

70 
VGG
 
¡yË
 
chªÃl
 
m—n
 
subŒaùiÚ
 
as
 
desüibed
 
h”e
:

71 
h‰ps
:

73 
Args
:

74 
»sized_šputs
: 
A
 [
b©ch
, 
height_š
, 
width_š
, 
chªÃls
] 
æßt32
 
‹nsÜ


75 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
 
w™h
 
v®ues
 
b‘w“n
 0 
ªd
 255.0.

77 
R‘uºs
:

78 
´•roûs£d_šputs
: 
A
 [
b©ch
, 
height_out
, 
width_out
, 
chªÃls
] 
æßt32


79 
‹nsÜ
 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

82 
chªÃl_m—ns
 = [123.68, 116.779, 103.939]

83  
»sized_šputs
 - [[
chªÃl_m—ns
]]

85 
def
 
	$_exŒaù_´İo§l_ã©u»s
(
£lf
, 
´•roûs£d_šputs
, 
scİe
):

88 
Args
:

89 
´•roûs£d_šputs
: 
A
 [
b©ch
, 
height
, 
width
, 
chªÃls
] 
æßt32
 
‹nsÜ


90 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

91 
scİe
: 
A
 scİ
Çme
.

93 
R‘uºs
:

94 
½n_ã©u»_m­
: 
A
 
‹nsÜ
 
w™h
 
sh­e
 [
b©ch
, 
height
, 
width
, 
d•th
]

95 
Rai£s
:

96 
Inv®idArgum’tE¼Ü
: 
If
 
the
 
¥©Ÿl
 
size
 
of
 `
´•roûs£d_šputs
`

97 (
height
 
Ü
 
width
è
is
 
Ëss
 
thª
 33.

98 
V®ueE¼Ü
: 
If
 
the
 
ü—‹d
 
ÃtwÜk
 
is
 
missšg
h
»quœed
 
aùiv©iÚ
.

100 
	`Ën
(
´•roûs£d_šputs
.
	`g‘_sh­e
().
	`as_li¡
()) != 4:

101 
¿i£
 
	`V®ueE¼Ü
('`preprocessed_inputs` must be 4 dimensional, got‡ '

102 '‹nsÜ oàsh­%s' % 
´•roûs£d_šputs
.
	$g‘_sh­e
())

103 
sh­e_as£¹
 = 
tf
.
	`As£¹
(

104 
tf
.
	`logiÿl_ªd
(

105 
tf
.
	`g»©”_equ®
Ñf.
	`sh­e
(
´•roûs£d_šputs
)[1], 33),

106 
tf
.
	`g»©”_equ®
Ñf.
	`sh­e
(
´•roûs£d_šputs
)[2], 33)),

109 
w™h
 
tf
.
	$cÚŒŞ_d•’d’c›s
([
sh­e_as£¹
]):

110 #Di§bË 
b©chnÜm
 
fše
-
tunšg
 
w™h
 
sm®Ër
 
b©ch
 
sizes
.

111 #TODO: 
Figu»
 
out
 
™
 
is
 
Ãeded
 
wh’
 
image
 
b©ch
 
size
 i 
bigg”
.

112 
w™h
 
¦im
.
	`¬g_scİe
(

113 
»¢‘_uts
.
	`»¢‘_¬g_scİe
(

114 
b©ch_nÜm_•sÚ
=1e-5,

115 
b©ch_nÜm_sÿË
=
True
,

116 
weight_deÿy
=
£lf
.
_weight_deÿy
)):

117 
w™h
 
tf
.
	$v¬ŸbË_scİe
(

118 
£lf
.
_¬ch™eùu»
, 
»u£
=£lf.
_»u£_weights
è
as
 
v¬_scİe
:

119 
_
, 
aùiv©iÚs
 = 
£lf
.
	$_»¢‘_mod–
(

120 
´•roûs£d_šputs
,

121 
num_şas£s
=
NÚe
,

122 
is_Œaššg
=
F®£
,

123 
glob®_poŞ
=
F®£
,

124 
ouut_¡ride
=
£lf
.
_fœ¡_¡age_ã©u»s_¡ride
,

125 
¥©Ÿl_squ“ze
=
F®£
,

126 
scİe
=
v¬_scİe
)

128 
hªdË
 = 
scİe
 + '/%s/block3' % 
£lf
.
_¬ch™eùu»


129  
aùiv©iÚs
[
hªdË
]

131 
def
 
	$_exŒaù_box_şassif›r_ã©u»s
(
£lf
, 
´İo§l_ã©u»_m­s
, 
scİe
):

134 
Args
:

135 
´İo§l_ã©u»_m­s
: 
A
 4-
D
 
‹nsÜ
 
w™h
 
sh­e


136 [
b©ch_size
 * 
£lf
.
max_num_´İo§ls
, 
üİ_height
, 
üİ_width
, 
d•th
]

137 
»´e£Ášg
 
the
 
ã©u»
 
m­
 
üİ³d
 
to
 
—ch
 
´İo§l
.

138 
scİe
: 
A
 scİ
	`Çme
 (
unu£d
).

140 
R‘uºs
:

141 
´İo§l_şassif›r_ã©u»s
: 
A
 4-
D
 
‹nsÜ
 
w™h
 
sh­e


142 [
b©ch_size
 * 
£lf
.
max_num_´İo§ls
, 
height
, 
width
, 
d•th
]

143 
»´e£Ášg
 
box
 
şassif›r
 
ã©u»s
 
—ch
 
´İo§l
.

145 
w™h
 
tf
.
	$v¬ŸbË_scİe
(
£lf
.
_¬ch™eùu»
, 
»u£
=£lf.
_»u£_weights
):

146 
w™h
 
¦im
.
	`¬g_scİe
(

147 
»¢‘_uts
.
	`»¢‘_¬g_scİe
(

148 
b©ch_nÜm_•sÚ
=1e-5,

149 
b©ch_nÜm_sÿË
=
True
,

150 
weight_deÿy
=
£lf
.
_weight_deÿy
)):

151 
w™h
 
¦im
.
	$¬g_scİe
([
¦im
.
b©ch_nÜm
], 
is_Œaššg
=
F®£
):

152 
blocks
 = [

153 
»¢‘_uts
.
	`Block
('block4', 
»¢‘_v1
.
bÙ’eck
, [{

157 
	}
}] * 3)

159 
´İo§l_şassif›r_ã©u»s
 = 
»¢‘_uts
.
	$¡ack_blocks_d’£
(

160 
´İo§l_ã©u»_m­s
, 
blocks
)

161  
´İo§l_şassif›r_ã©u»s


164 
şass
 
	$Fa¡”RCNNRe¢‘50F—tu»ExŒaùÜ
(
Fa¡”RCNNRe¢‘V1F—tu»ExŒaùÜ
):

167 
def
 
	$__š™__
(
£lf
,

168 
is_Œaššg
,

169 
fœ¡_¡age_ã©u»s_¡ride
,

170 
»u£_weights
=
NÚe
,

171 
weight_deÿy
=0.0):

174 
Args
:

175 
is_Œaššg
: 
S“
 
ba£
 
şass
.

176 
fœ¡_¡age_ã©u»s_¡ride
: 
S“
 
ba£
 
şass
.

177 
»u£_weights
: 
S“
 
ba£
 
şass
.

178 
weight_deÿy
: 
S“
 
ba£
 
şass
.

180 
Rai£s
:

181 
V®ueE¼Ü
: 
If
 `
fœ¡_¡age_ã©u»s_¡ride
` 
is
 
nÙ
 8 
Ü
 16,

182 
Ü
 `
¬ch™eùu»
` 
is
 
nÙ
 
suµÜ‹d
.

184 
	`su³r
(
Fa¡”RCNNRe¢‘50F—tu»ExŒaùÜ
, 
£lf
).
	`__š™__
(

185 '»¢‘_v1_50', 
»¢‘_v1
.
»¢‘_v1_50
, 
is_Œaššg
,

186 
fœ¡_¡age_ã©u»s_¡ride
, 
»u£_weights
, 
weight_deÿy
)

189 
şass
 
	$Fa¡”RCNNRe¢‘101F—tu»ExŒaùÜ
(
Fa¡”RCNNRe¢‘V1F—tu»ExŒaùÜ
):

192 
def
 
	$__š™__
(
£lf
,

193 
is_Œaššg
,

194 
fœ¡_¡age_ã©u»s_¡ride
,

195 
»u£_weights
=
NÚe
,

196 
weight_deÿy
=0.0):

199 
Args
:

200 
is_Œaššg
: 
S“
 
ba£
 
şass
.

201 
fœ¡_¡age_ã©u»s_¡ride
: 
S“
 
ba£
 
şass
.

202 
»u£_weights
: 
S“
 
ba£
 
şass
.

203 
weight_deÿy
: 
S“
 
ba£
 
şass
.

205 
Rai£s
:

206 
V®ueE¼Ü
: 
If
 `
fœ¡_¡age_ã©u»s_¡ride
` 
is
 
nÙ
 8 
Ü
 16,

207 
Ü
 `
¬ch™eùu»
` 
is
 
nÙ
 
suµÜ‹d
.

209 
	`su³r
(
Fa¡”RCNNRe¢‘101F—tu»ExŒaùÜ
, 
£lf
).
	`__š™__
(

210 '»¢‘_v1_101', 
»¢‘_v1
.
»¢‘_v1_101
, 
is_Œaššg
,

211 
fœ¡_¡age_ã©u»s_¡ride
, 
»u£_weights
, 
weight_deÿy
)

214 
şass
 
	$Fa¡”RCNNRe¢‘152F—tu»ExŒaùÜ
(
Fa¡”RCNNRe¢‘V1F—tu»ExŒaùÜ
):

217 
def
 
	$__š™__
(
£lf
,

218 
is_Œaššg
,

219 
fœ¡_¡age_ã©u»s_¡ride
,

220 
»u£_weights
=
NÚe
,

221 
weight_deÿy
=0.0):

224 
Args
:

225 
is_Œaššg
: 
S“
 
ba£
 
şass
.

226 
fœ¡_¡age_ã©u»s_¡ride
: 
S“
 
ba£
 
şass
.

227 
»u£_weights
: 
S“
 
ba£
 
şass
.

228 
weight_deÿy
: 
S“
 
ba£
 
şass
.

230 
Rai£s
:

231 
V®ueE¼Ü
: 
If
 `
fœ¡_¡age_ã©u»s_¡ride
` 
is
 
nÙ
 8 
Ü
 16,

232 
Ü
 `
¬ch™eùu»
` 
is
 
nÙ
 
suµÜ‹d
.

234 
	`su³r
(
Fa¡”RCNNRe¢‘152F—tu»ExŒaùÜ
, 
£lf
).
	`__š™__
(

235 '»¢‘_v1_152', 
»¢‘_v1
.
»¢‘_v1_152
, 
is_Œaššg
,

236 
fœ¡_¡age_ã©u»s_¡ride
, 
»u£_weights
, 
weight_deÿy
)

	@models/faster_rcnn_resnet_v1_feature_extractor_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
numpy
 
as
 
Å


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	gobjeù_d‘eùiÚ
.
mod–s
 
impÜt
 
ç¡”_rún_»¢‘_v1_ã©u»_exŒaùÜ
 
as
 
ç¡”_rún_»¢‘_v1


24 
şass
 
	$Fa¡”RúnRe¢‘V1F—tu»ExŒaùÜTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	`_bud_ã©u»_exŒaùÜ
(
£lf
,

27 
fœ¡_¡age_ã©u»s_¡ride
,

28 
¬ch™eùu»
='resnet_v1_101'):

29 
ã©u»_exŒaùÜ_m­
 = {

31 
ç¡”_rún_»¢‘_v1
.
Fa¡”RCNNRe¢‘50F—tu»ExŒaùÜ
,

33 
ç¡”_rún_»¢‘_v1
.
Fa¡”RCNNRe¢‘101F—tu»ExŒaùÜ
,

35 
ç¡”_rún_»¢‘_v1
.
Fa¡”RCNNRe¢‘152F—tu»ExŒaùÜ


36 
	}
}

37  
ã©u»_exŒaùÜ_m­
[
¬ch™eùu»
](

38 
is_Œaššg
=
F®£
,

39 
	gfœ¡_¡age_ã©u»s_¡ride
=
fœ¡_¡age_ã©u»s_¡ride
,

40 
	g»u£_weights
=
NÚe
,

41 
	gweight_deÿy
=0.0)

43 
def
 
	$‹¡_exŒaù_´İo§l_ã©u»s_»tuºs_ex³ùed_size
(
£lf
):

44 
¬ch™eùu»
 
š
 ['resnet_v1_50', 'resnet_v1_101', 'resnet_v1_152']:

45 
ã©u»_exŒaùÜ
 = 
£lf
.
	$_bud_ã©u»_exŒaùÜ
(

46 
fœ¡_¡age_ã©u»s_¡ride
=16, 
¬ch™eùu»
=architecture)

47 
´•roûs£d_šputs
 = 
tf
.
	$¿ndom_unifÜm
(

48 [4, 224, 224, 3], 
maxv®
=255, 
dty³
=
tf
.
æßt32
)

49 
½n_ã©u»_m­
 = 
ã©u»_exŒaùÜ
.
	`exŒaù_´İo§l_ã©u»s
(

50 
´•roûs£d_šputs
, 
scİe
='TestScope')

51 
ã©u»s_sh­e
 = 
tf
.
	$sh­e
(
½n_ã©u»_m­
)

53 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

54 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

55 
£ss
.
	$run
(
š™_İ
)

56 
ã©u»s_sh­e_out
 = 
£ss
.
	$run
(
ã©u»s_sh­e
)

57 
£lf
.
	$as£¹AÎEqu®
(
ã©u»s_sh­e_out
, [4, 14, 14, 1024])

59 
def
 
	$‹¡_exŒaù_´İo§l_ã©u»s_¡ride_eight
(
£lf
):

60 
ã©u»_exŒaùÜ
 = 
£lf
.
	$_bud_ã©u»_exŒaùÜ
(

61 
fœ¡_¡age_ã©u»s_¡ride
=8)

62 
´•roûs£d_šputs
 = 
tf
.
	$¿ndom_unifÜm
(

63 [4, 224, 224, 3], 
maxv®
=255, 
dty³
=
tf
.
æßt32
)

64 
½n_ã©u»_m­
 = 
ã©u»_exŒaùÜ
.
	`exŒaù_´İo§l_ã©u»s
(

65 
´•roûs£d_šputs
, 
scİe
='TestScope')

66 
ã©u»s_sh­e
 = 
tf
.
	$sh­e
(
½n_ã©u»_m­
)

68 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

69 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

70 
£ss
.
	$run
(
š™_İ
)

71 
ã©u»s_sh­e_out
 = 
£ss
.
	$run
(
ã©u»s_sh­e
)

72 
£lf
.
	$as£¹AÎEqu®
(
ã©u»s_sh­e_out
, [4, 28, 28, 1024])

74 
def
 
	$‹¡_exŒaù_´İo§l_ã©u»s_h®f_size_šput
(
£lf
):

75 
ã©u»_exŒaùÜ
 = 
£lf
.
	$_bud_ã©u»_exŒaùÜ
(

76 
fœ¡_¡age_ã©u»s_¡ride
=16)

77 
´•roûs£d_šputs
 = 
tf
.
	$¿ndom_unifÜm
(

78 [1, 112, 112, 3], 
maxv®
=255, 
dty³
=
tf
.
æßt32
)

79 
½n_ã©u»_m­
 = 
ã©u»_exŒaùÜ
.
	`exŒaù_´İo§l_ã©u»s
(

80 
´•roûs£d_šputs
, 
scİe
='TestScope')

81 
ã©u»s_sh­e
 = 
tf
.
	$sh­e
(
½n_ã©u»_m­
)

83 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

84 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

85 
£ss
.
	$run
(
š™_İ
)

86 
ã©u»s_sh­e_out
 = 
£ss
.
	$run
(
ã©u»s_sh­e
)

87 
£lf
.
	$as£¹AÎEqu®
(
ã©u»s_sh­e_out
, [1, 7, 7, 1024])

89 
def
 
	$‹¡_exŒaù_´İo§l_ã©u»s_d›s_Ú_šv®id_¡ride
(
£lf
):

90 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

91 
£lf
.
	$_bud_ã©u»_exŒaùÜ
(
fœ¡_¡age_ã©u»s_¡ride
=99)

93 
def
 
	$‹¡_exŒaù_´İo§l_ã©u»s_d›s_Ú_v”y_sm®l_images
(
£lf
):

94 
ã©u»_exŒaùÜ
 = 
£lf
.
	$_bud_ã©u»_exŒaùÜ
(

95 
fœ¡_¡age_ã©u»s_¡ride
=16)

96 
´•roûs£d_šputs
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, (4, 
NÚe
, None, 3))

97 
½n_ã©u»_m­
 = 
ã©u»_exŒaùÜ
.
	`exŒaù_´İo§l_ã©u»s
(

98 
´•roûs£d_šputs
, 
scİe
='TestScope')

99 
ã©u»s_sh­e
 = 
tf
.
	$sh­e
(
½n_ã©u»_m­
)

101 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

102 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

103 
£ss
.
	$run
(
š™_İ
)

104 
w™h
 
£lf
.
	$as£¹Rai£s
(
tf
.
”rÜs
.
Inv®idArgum’tE¼Ü
):

105 
£ss
.
	`run
(

106 
ã©u»s_sh­e
,

107 
ãed_diù
={
´•roûs£d_šputs
: 
Å
.
¿ndom
.
	`¿nd
(4, 32, 32, 3)
	}
})

109 
def
 
	$‹¡_exŒaù_´İo§l_ã©u»s_d›s_w™h_šcÜ»ù_¿nk_šputs
(
£lf
):

110 
ã©u»_exŒaùÜ
 = 
£lf
.
	$_bud_ã©u»_exŒaùÜ
(

111 
fœ¡_¡age_ã©u»s_¡ride
=16)

112 
´•roûs£d_šputs
 = 
tf
.
	$¿ndom_unifÜm
(

113 [224, 224, 3], 
maxv®
=255, 
dty³
=
tf
.
æßt32
)

114 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

115 
ã©u»_exŒaùÜ
.
	`exŒaù_´İo§l_ã©u»s
(

116 
´•roûs£d_šputs
, 
scİe
='TestScope')

118 
def
 
	$‹¡_exŒaù_box_şassif›r_ã©u»s_»tuºs_ex³ùed_size
(
£lf
):

119 
ã©u»_exŒaùÜ
 = 
£lf
.
	$_bud_ã©u»_exŒaùÜ
(

120 
fœ¡_¡age_ã©u»s_¡ride
=16)

121 
´İo§l_ã©u»_m­s
 = 
tf
.
	$¿ndom_unifÜm
(

122 [3, 7, 7, 1024], 
maxv®
=255, 
dty³
=
tf
.
æßt32
)

123 
´İo§l_şassif›r_ã©u»s
 = (

124 
ã©u»_exŒaùÜ
.
	`exŒaù_box_şassif›r_ã©u»s
(

125 
´İo§l_ã©u»_m­s
, 
scİe
='TestScope'))

126 
ã©u»s_sh­e
 = 
tf
.
	$sh­e
(
´İo§l_şassif›r_ã©u»s
)

128 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

129 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

130 
£ss
.
	$run
(
š™_İ
)

131 
ã©u»s_sh­e_out
 = 
£ss
.
	$run
(
ã©u»s_sh­e
)

132 
£lf
.
	$as£¹AÎEqu®
(
ã©u»s_sh­e_out
, [3, 7, 7, 2048])

135 
__Çme__
 == '__main__':

136 
tf
.
‹¡
.
	`maš
()

	@models/feature_map_generators.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
Provides
 
£v”®
 
ã©u»
 
m­
 
g’”©Üs
 
th©
 
ÿn
 
be
 
u£d
 
to
 
bud
 
objeù


19 
d‘eùiÚ
 
ã©u»
 
	gexŒaùÜs
.

21 
Objeù
 
d‘eùiÚ
 
ã©u»
 
exŒaùÜs
 
usu®ly
 
¬e
 
but
 
by
 
¡ackšg
 
two
 
	gcompÚ’ts


22 - 
A
 
ba£
 
ã©u»
 
exŒaùÜ
 
such
 
as
 
Inû±iÚ
 
V3
 
ªd
 
a
 f—tu» 
m­
 
	gg’”©Ü
.

23 
F—tu»
 
m­
 
g’”©Üs
 
bud
 
Ú
 
the
 
ba£
 
ã©u»
 
exŒaùÜs
 
ªd
 
´oduû
 
a
 
li¡


24 
of
 
fš®
 
ã©u»
 
	gm­s
.

26 
impÜt
 
cŞËùiÚs


27 
impÜt
 
‹nsÜæow
 
as
 
tf


28 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
İs


29 
	g¦im
 = 
tf
.
cÚŒib
.
¦im


32 
def
 
	$g‘_d•th_â
(
d•th_muÉl›r
, 
mš_d•th
):

35 
Args
:

36 
d•th_muÉl›r
: 
a
 
muÉl›r
 
the
 
nomš®
 
d•th
.

37 
mš_d•th
: 
a
 
low”
 
bound
 
Ú
 
the
 
d•th
 
of
 
f‹rs
.

39 
R‘uºs
:

40 
A
 
ÿÎabË
 
th©
 
kes
 
š
 
a
 
nomš®
 
d•th
 
ªd
 
»tuºs
 
the
 d•th 
to
 
u£
.

42 
def
 
	$muÉly_d•th
(
d•th
):

43 
Ãw_d•th
 = (
d•th
 * 
d•th_muÉl›r
)

44  
	$max
(
Ãw_d•th
, 
mš_d•th
)

45  
muÉly_d•th


48 
def
 
	$muÉi_»sŞutiÚ_ã©u»_m­s
(
ã©u»_m­_Ïyout
, 
d•th_muÉl›r
,

49 
mš_d•th
, 
š£¹_1x1_cÚv
, 
image_ã©u»s
):

52 
G’”©es
 
muÉi
-
sÿË
 
ã©u»
 
m­s
 
d‘eùiÚ
 
as
 
š
 
the
 
SSD
 
·³rs
 
by


53 
Liu
 
‘
 
®
: 
h‰ps
:

55 
MÜe
 
¥ecifiÿÎy
, 
™
 
³rfÜms
 
the
 
fŞlowšg
 
two
 
sks
:

56 1è
If
 
a
 
Ïy”
 
Çme
 
is
 
´ovided
 
š
 
the
 
cÚfigu¿tiÚ
, 
»tuºs
 
th©
†ay” 
as
‡

57 
ã©u»
 
m­
.

58 2è
If
 
a
 
Ïy”
 
Çme
 
is
 
Ëá
 
as
 
ª
 
em±y
 
¡ršg
, 
cÚ¡ruùs
‡ 
Ãw
 
ã©u»
 
m­


59 
ba£d
 
Ú
 
the
 
¥©Ÿl
 
sh­e
 
ªd
 
d•th
 
cÚfigu¿tiÚ
. 
NÙe
 
th©
h
cu¼’t


60 
im¶em’tiÚ
 
Úly
 
suµÜts
 
g’”©šg
 
Ãw
 
Ïy”s
 
usšg
 
cÚvŞutiÚ
 
of


61 
¡ride
 2 
»suÉšg
 
š
 
a
 
¥©Ÿl
 
»sŞutiÚ
 
»duùiÚ
 
by
‡ 
çùÜ
 
of
 2.

63 
An
 
exam¶e
 
of
 
the
 
cÚfigu¿tiÚ
 
Inû±iÚ
 
V3
:

68 
	}
}

70 
	gArgs
:

71 
ã©u»_m­_Ïyout
: 
DiùiÚ¬y
 
of
 
¥ecifiÿtiÚs
 
the
 
ã©u»
 
m­


72 
Ïyouts
 
š
 
the
 
fŞlowšg
 
fÜm©
 (
Inû±iÚ
 
V2
/
V3
 
»¥eùiv–y
):

78 
	gÜ


84 
	gIf
 'äom_Ïy”' 
is
 
	g¥ecif›d
, 
the
 
¥ecif›d
 
ã©u»
 
m­
 i 
dœeùly
 
u£d


85 
as
 
a
 
box
 
´ediùÜ
 
	gÏy”
, 
ªd
 
the
 
Ïy”_d•th
 
is
 
dœeùly
 
šã»d
 
äom
he

86 
ã©u»
 
m­
 (
š¡—d
 
of
 
usšg
 
the
 
´ovided
 'Ïy”_d•th' 
·¿m‘”
). 
In


87 
this
 , 
our
 
cÚv’tiÚ
 
is
 
to
 
	g£t
 'Ïy”_d•th' 
	gto
 -1 
	gş¬™y
.

88 
	gOth”wi£
, 'äom_Ïy”' 
is
 
ª
 
em±y
 
	g¡ršg
, 
th’
 
the
 
box
 
´ediùÜ


89 
Ïy”
 
wl
 
be
 
but
 
äom
 
the
 
´evious
†ay” 
usšg
 
cÚvŞutiÚ
 
	gİ”©iÚs
.

90 
NÙe
 
th©
 
the
 
cu¼’t
 
im¶em’tiÚ
 
Úly
 
suµÜts
 
g’”©šg
 
Ãw
 
Ïy”s


91 
usšg
 
cÚvŞutiÚs
 
of
 
	g¡ride
 2 (
»suÉšg
 
š
 
a
 
¥©Ÿl
 
»sŞutiÚ


92 
»duùiÚ
 
by
 
a
 
çùÜ
 
	gof
 2), 
ªd
 
wl
 
be
 
ex‹nded
 
to
‡ 
mÜe
 
æexibË


93 
	gdesign
. 
	gFš®ly
, 
the
 
	gİtiÚ®
 'ªchÜ_¡rides' 
ÿn
 
be
 
u£d
 
to
 
¥ecify
he

94 
ªchÜ
 
¡ride
 
©
 
—ch
 
Ïy”
 
	gwh”e
 'äom_Ïy”' 
is
 
	g¥ecif›d
. 
Our


95 
cÚv’tiÚ
 
is
 
to
 
	g£t
 'ªchÜ_¡rides' 
	gto
 -1 
wh’ev”
 
©
 
the
 
pos™iÚs
 
	gth©


96 'äom_Ïy”' 
is
 
ª
 
em±y
 
	g¡ršg
, 
ªd
 
ªchÜ
 
¡rides
 
©
 
the£
 
Ïy”s
 
wl


97 
be
 
šã¼ed
 
äom
 
the
 
´evious
 
	gÏy”
's‡nchor strides‡ndhe current

98 
	gÏy”
' ¡ridËngth. IÀthÿ£ wh”'
	gªchÜ_¡rides
' is‚ot

99 
	g¥ecif›d
, 
the
 
ªchÜ
 
¡rides
 
wl
  
to
h
image
 
width
 
ªd
 
height


100 
divided
 
by
 
the
 
numb”
 
of
 
	gªchÜs
.

101 
	gd•th_muÉl›r
: 
D•th
 
muÉl›r
 
cÚvŞutiÚ®
 
Ïy”s
.

102 
mš_d•th
: 
Mšimum
 
d•th
 
cÚvŞutiÚ®
 
Ïy”s
.

103 
š£¹_1x1_cÚv
: 
A
 
boŞ—n
 
šdiÿtšg
 
wh‘h”
 
ª
 
add™iÚ®
 1x1 
cÚvŞutiÚ


104 
should
 
be
 
š£¹ed
 
befÜe
 
shrškšg
 
the
 
ã©u»
 
m­
.

105 
image_ã©u»s
: 
A
 
diùiÚ¬y
 
of
 
hªdËs
 
to
 
aùiv©iÚ
 
‹nsÜs
 
äom
 
the


106 
ba£
 
ã©u»
 
exŒaùÜ
.

108 
R‘uºs
:

109 
ã©u»_m­s
: 
ª
 
Ord”edDiù
 
m­pšg
 
	$keys
 (
ã©u»
 
m­
 
Çmes
è
to


110 
‹nsÜs
 
wh”e
 
—ch
 
‹nsÜ
 
has
 
sh­e
 [
b©ch
, 
height_i
, 
width_i
, 
d•th_i
].

112 
Rai£s
:

113 
V®ueE¼Ü
: 
the
 
numb”
 
’Œ›s
 
š
 'äom_Ïy”' 
ªd


114 'Ïy”_d•th' dØ
nÙ
 
m©ch
.

115 
V®ueE¼Ü
: 
the
 
g’”©ed
 
Ïy”
 
dÛs
 
nÙ
 
have
h
§me
 
»sŞutiÚ


116 
as
 
¥ecif›d
.

118 
d•th_â
 = 
	$g‘_d•th_â
(
d•th_muÉl›r
, 
mš_d•th
)

120 
ã©u»_m­_keys
 = []

121 
ã©u»_m­s
 = []

122 
ba£_äom_Ïy”
 = ''

123 
ã©u»_m­_¡rides
 = 
NÚe


124 
u£_d•thwi£
 = 
F®£


125 'ªchÜ_¡rides' 
š
 
ã©u»_m­_Ïyout
:

126 
ã©u»_m­_¡rides
 = (
ã©u»_m­_Ïyout
['anchor_strides'])

127 'u£_d•thwi£' 
š
 
ã©u»_m­_Ïyout
:

128 
u£_d•thwi£
 = 
ã©u»_m­_Ïyout
['use_depthwise']

129 
šdex
, (
äom_Ïy”
, 
Ïy”_d•th
è
š
 
	`’um”©e
(

130 
	`z
(
ã©u»_m­_Ïyout
['from_layer'], feature_map_layout['layer_depth'])):

131 
äom_Ïy”
:

132 
ã©u»_m­
 = 
image_ã©u»s
[
äom_Ïy”
]

133 
ba£_äom_Ïy”
 = 
äom_Ïy”


134 
ã©u»_m­_keys
.
	$­³nd
(
äom_Ïy”
)

136 
´e_Ïy”
 = 
ã©u»_m­s
[-1]

137 
š‹rmedŸ‹_Ïy”
 = 
´e_Ïy”


138 
š£¹_1x1_cÚv
:

139 
Ïy”_Çme
 = '{}_1_CÚv2d_{}_1x1_{}'.
	`fÜm©
(

140 
ba£_äom_Ïy”
, 
šdex
, 
	`d•th_â
(
Ïy”_d•th
 / 2))

141 
š‹rmedŸ‹_Ïy”
 = 
¦im
.
	`cÚv2d
(

142 
´e_Ïy”
,

143 
	`d•th_â
(
Ïy”_d•th
 / 2), [1, 1],

144 
·ddšg
='SAME',

145 
¡ride
=1,

146 
scİe
=
Ïy”_Çme
)

147 
¡ride
 = 2

148 
Ïy”_Çme
 = '{}_2_CÚv2d_{}_3x3_s2_{}'.
	`fÜm©
(

149 
ba£_äom_Ïy”
, 
šdex
, 
	$d•th_â
(
Ïy”_d•th
))

150 
u£_d•thwi£
:

151 
ã©u»_m­
 = 
¦im
.
	`£·¿bË_cÚv2d
(

152 
İs
.
	`·d_to_muÉË
(
š‹rmedŸ‹_Ïy”
, 
¡ride
),

153 
NÚe
, [3, 3],

154 
d•th_muÉl›r
=1,

155 
·ddšg
='SAME',

156 
¡ride
=stride,

157 
scİe
=
Ïy”_Çme
 + '_depthwise')

158 
ã©u»_m­
 = 
¦im
.
	`cÚv2d
(

159 
ã©u»_m­
,

160 
	`d•th_â
(
Ïy”_d•th
), [1, 1],

161 
·ddšg
='SAME',

162 
¡ride
=1,

163 
scİe
=
Ïy”_Çme
)

165 
ã©u»_m­
 = 
¦im
.
	`cÚv2d
(

166 
İs
.
	`·d_to_muÉË
(
š‹rmedŸ‹_Ïy”
, 
¡ride
),

167 
	`d•th_â
(
Ïy”_d•th
), [3, 3],

168 
·ddšg
='SAME',

169 
¡ride
=stride,

170 
scİe
=
Ïy”_Çme
)

172 ià(
šdex
 > 0 
ªd
 
ã©u»_m­_¡rides
‡nd

173 
ã©u»_m­_¡rides
[
šdex
 - 1] > 0):

174 
ã©u»_m­_¡rides
[
šdex
] = (

175 
¡ride
 * 
ã©u»_m­_¡rides
[
šdex
 - 1])

176 
ã©u»_m­_keys
.
	$­³nd
(
Ïy”_Çme
)

177 
ã©u»_m­s
.
	$­³nd
(
ã©u»_m­
)

178  
cŞËùiÚs
.
	`Ord”edDiù
(

179 [(
x
, 
y
èx, yè
š
 
	`z
(
ã©u»_m­_keys
, 
ã©u»_m­s
)])

	@models/feature_map_generators_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
mod–s
 
impÜt
 
ã©u»_m­_g’”©Üs


22 
	gINCEPTION_V2_LAYOUT
 = {

29 
INCEPTION_V3_LAYOUT
 = {

37 #TODO: 
add
 
‹¡s
 
w™h
 
difã»Á
 
ªchÜ
 
¡rides
.

38 
şass
 
	$MuÉiResŞutiÚF—tu»M­G’”©ÜTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

40 
def
 
	$‹¡_g‘_ex³ùed_ã©u»_m­_sh­es_w™h_šû±iÚ_v2
(
£lf
):

41 
image_ã©u»s
 = {

42 'Mixed_3c': 
tf
.
	`¿ndom_unifÜm
([4, 28, 28, 256], 
dty³
ñf.
æßt32
),

43 'Mixed_4c': 
tf
.
	`¿ndom_unifÜm
([4, 14, 14, 576], 
dty³
ñf.
æßt32
),

44 'Mixed_5c': 
tf
.
	`¿ndom_unifÜm
([4, 7, 7, 1024], 
dty³
ñf.
æßt32
)

45 
	}
}

46 
	gã©u»_m­s
 = 
ã©u»_m­_g’”©Üs
.
	$muÉi_»sŞutiÚ_ã©u»_m­s
(

47 
ã©u»_m­_Ïyout
=
INCEPTION_V2_LAYOUT
,

48 
d•th_muÉl›r
=1,

49 
mš_d•th
=32,

50 
š£¹_1x1_cÚv
=
True
,

51 
image_ã©u»s
=image_features)

53 
ex³ùed_ã©u»_m­_sh­es
 = {

59 'Mixed_5c_2_CÚv2d_5_3x3_s2_256': (4, 1, 1, 256)
	}
}

61 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

62 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

63 
£ss
.
	$run
(
š™_İ
)

64 
out_ã©u»_m­s
 = 
£ss
.
	$run
(
ã©u»_m­s
)

65 
out_ã©u»_m­_sh­es
 = 
	`diù
(

66 (
key
, 
v®ue
.
sh­e
èkey, v®u
š
 
out_ã©u»_m­s
.
	$™ems
())

67 
£lf
.
	$as£¹DiùEqu®
(
out_ã©u»_m­_sh­es
, 
ex³ùed_ã©u»_m­_sh­es
)

69 
def
 
	$‹¡_g‘_ex³ùed_ã©u»_m­_sh­es_w™h_šû±iÚ_v3
(
£lf
):

70 
image_ã©u»s
 = {

71 'Mixed_5d': 
tf
.
	`¿ndom_unifÜm
([4, 35, 35, 256], 
dty³
ñf.
æßt32
),

72 'Mixed_6e': 
tf
.
	`¿ndom_unifÜm
([4, 17, 17, 576], 
dty³
ñf.
æßt32
),

73 'Mixed_7c': 
tf
.
	`¿ndom_unifÜm
([4, 8, 8, 1024], 
dty³
ñf.
æßt32
)

74 
	}
}

76 
	gã©u»_m­s
 = 
ã©u»_m­_g’”©Üs
.
	$muÉi_»sŞutiÚ_ã©u»_m­s
(

77 
ã©u»_m­_Ïyout
=
INCEPTION_V3_LAYOUT
,

78 
d•th_muÉl›r
=1,

79 
mš_d•th
=32,

80 
š£¹_1x1_cÚv
=
True
,

81 
image_ã©u»s
=image_features)

83 
ex³ùed_ã©u»_m­_sh­es
 = {

89 'Mixed_7c_2_CÚv2d_5_3x3_s2_128': (4, 1, 1, 128)
	}
}

91 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

92 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

93 
£ss
.
	$run
(
š™_İ
)

94 
out_ã©u»_m­s
 = 
£ss
.
	$run
(
ã©u»_m­s
)

95 
out_ã©u»_m­_sh­es
 = 
	`diù
(

96 (
key
, 
v®ue
.
sh­e
èkey, v®u
š
 
out_ã©u»_m­s
.
	$™ems
())

97 
£lf
.
	$as£¹DiùEqu®
(
out_ã©u»_m­_sh­es
, 
ex³ùed_ã©u»_m­_sh­es
)

100 
şass
 
	$G‘D•thFunùiÚTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

102 
def
 
	$‹¡_»tuº_mš_d•th_wh’_muÉl›r_is_sm®l
(
£lf
):

103 
d•th_â
 = 
ã©u»_m­_g’”©Üs
.
	$g‘_d•th_â
(
d•th_muÉl›r
=0.5,

104 
mš_d•th
=16)

105 
£lf
.
	`as£¹Equ®
(
	`d•th_â
(16), 16)

107 
def
 
	$‹¡_»tuº_cÜ»ù_d•th_w™h_muÉl›r
(
£lf
):

108 
d•th_â
 = 
ã©u»_m­_g’”©Üs
.
	$g‘_d•th_â
(
d•th_muÉl›r
=0.5,

109 
mš_d•th
=16)

110 
£lf
.
	`as£¹Equ®
(
	`d•th_â
(64), 32)

113 
__Çme__
 == '__main__':

114 
tf
.
‹¡
.
	`maš
()

	@models/ssd_feature_extractor_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
äom
 
abc
 
impÜt
 
ab¡¿ùm‘hod


20 
impÜt
 
numpy
 
as
 
Å


21 
impÜt
 
‹nsÜæow
 
as
 
tf


24 
şass
 
	$SsdF—tu»ExŒaùÜTe¡Ba£
(
objeù
):

26 
def
 
	$_v®id©e_ã©u»s_sh­e
(
£lf
,

27 
ã©u»_exŒaùÜ
,

28 
´•roûs£d_šputs
,

29 
ex³ùed_ã©u»_m­_sh­es
):

32 
Args
:

33 
ã©u»_exŒaùÜ
: 
The
 
ã©u»
 
exŒaùÜ
 
to
 
‹¡
.

34 
´•roûs£d_šputs
: 
A
 [
b©ch
, 
height
, 
width
, 3] 
‹nsÜ
 
to
 
exŒaù


35 
ã©u»s
 
w™h
.

36 
ex³ùed_ã©u»_m­_sh­es
: 
The
 
ex³ùed
 
sh­e
 
of
 
the
 
exŒaùed
 
ã©u»s
.

38 
ã©u»_m­s
 = 
ã©u»_exŒaùÜ
.
	$exŒaù_ã©u»s
(
´•roûs£d_šputs
)

39 
ã©u»_m­_sh­es
 = [
tf
.
	$sh­e
(
ã©u»_m­
èã©u»_m­ 
š
 
ã©u»_m­s
]

40 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

41 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

42 
£ss
.
	$run
(
š™_İ
)

43 
ã©u»_m­_sh­es_out
 = 
£ss
.
	$run
(
ã©u»_m­_sh­es
)

44 
sh­e_out
, 
exp_sh­e_out
 
š
 
	$z
(

45 
ã©u»_m­_sh­es_out
, 
ex³ùed_ã©u»_m­_sh­es
):

46 
£lf
.
	`as£¹AÎEqu®
(
sh­e_out
, 
exp_sh­e_out
)

48 @
ab¡¿ùm‘hod


49 
def
 
	$_ü—‹_ã©u»_exŒaùÜ
(
£lf
, 
d•th_muÉl›r
):

52 
Args
:

53 
d•th_muÉl›r
: 
d•th
 
muÉl›r
 
ã©u»
 
exŒaùÜ


54 
R‘uºs
:

55 
ª
 
ssd_m‘a_¬ch
.
SSDF—tu»ExŒaùÜ
 
objeù
.

57 
·ss


59 
def
 
	$check_exŒaù_ã©u»s_»tuºs_cÜ»ù_sh­e
(

60 
£lf
,

61 
image_height
,

62 
image_width
,

63 
d•th_muÉl›r
,

64 
ex³ùed_ã©u»_m­_sh­es_out
):

65 
ã©u»_exŒaùÜ
 = 
£lf
.
	$_ü—‹_ã©u»_exŒaùÜ
(
d•th_muÉl›r
)

66 
´•roûs£d_šputs
 = 
tf
.
	$¿ndom_unifÜm
(

67 [4, 
image_height
, 
image_width
, 3], 
dty³
=
tf
.
æßt32
)

68 
£lf
.
	$_v®id©e_ã©u»s_sh­e
(

69 
ã©u»_exŒaùÜ
, 
´•roûs£d_šputs
, 
ex³ùed_ã©u»_m­_sh­es_out
)

71 
def
 
	$check_exŒaù_ã©u»s_¿i£s_”rÜ_w™h_šv®id_image_size
(

72 
£lf
,

73 
image_height
,

74 
image_width
,

75 
d•th_muÉl›r
):

76 
ã©u»_exŒaùÜ
 = 
£lf
.
	$_ü—‹_ã©u»_exŒaùÜ
(
d•th_muÉl›r
)

77 
´•roûs£d_šputs
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, (4, 
NÚe
, None, 3))

78 
ã©u»_m­s
 = 
ã©u»_exŒaùÜ
.
	$exŒaù_ã©u»s
(
´•roûs£d_šputs
)

79 
‹¡_´•roûs£d_image
 = 
Å
.
¿ndom
.
	$¿nd
(4, 
image_height
, 
image_width
, 3)

80 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

81 
£ss
.
	`run
(
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
())

82 
w™h
 
£lf
.
	$as£¹Rai£s
(
tf
.
”rÜs
.
Inv®idArgum’tE¼Ü
):

83 
£ss
.
	`run
(
ã©u»_m­s
,

84 
ãed_diù
={
´•roûs£d_šputs
: 
‹¡_´•roûs£d_image
})

86 
def
 
	$check_ã©u»_exŒaùÜ_v¬ŸbËs_und”_scİe
(
£lf
,

87 
d•th_muÉl›r
,

88 
scİe_Çme
):

89 
g
 = 
tf
.
	$G¿ph
()

90 
w™h
 
g
.
	$as_deçuÉ
():

91 
ã©u»_exŒaùÜ
 = 
£lf
.
	$_ü—‹_ã©u»_exŒaùÜ
(
d•th_muÉl›r
)

92 
´•roûs£d_šputs
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, (4, 
NÚe
, None, 3))

93 
ã©u»_exŒaùÜ
.
	$exŒaù_ã©u»s
(
´•roûs£d_šputs
)

94 
v¬ŸbËs
 = 
g
.
	$g‘_cŞËùiÚ
(
tf
.
G¿phKeys
.
GLOBAL_VARIABLES
)

95 
v¬ŸbË
 
š
 
v¬ŸbËs
:

96 
£lf
.
	`as£¹True
(
v¬ŸbË
.
Çme
.
	`¡¬tsw™h
(
scİe_Çme
))

	@models/ssd_inception_v2_feature_extractor.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
‹nsÜæow
 
as
 
tf


19 
äom
 
	gobjeù_d‘eùiÚ
.
m‘a_¬ch™eùu»s
 
impÜt
 
ssd_m‘a_¬ch


20 
äom
 
	gobjeù_d‘eùiÚ
.
mod–s
 
impÜt
 
ã©u»_m­_g’”©Üs


21 
äom
 
Ãts
 
impÜt
 
šû±iÚ_v2


23 
	g¦im
 = 
tf
.
cÚŒib
.
¦im


26 
şass
 
	$SSDInû±iÚV2F—tu»ExŒaùÜ
(
ssd_m‘a_¬ch
.
SSDF—tu»ExŒaùÜ
):

29 
def
 
	$__š™__
(
£lf
,

30 
d•th_muÉl›r
,

31 
mš_d•th
,

32 
cÚv_hy³½¬ams
,

33 
»u£_weights
=
NÚe
):

36 
Args
:

37 
d•th_muÉl›r
: 
d•th
 
muÉl›r
 
ã©u»
 
exŒaùÜ
.

38 
mš_d•th
: 
mšimum
 
ã©u»
 
exŒaùÜ
 
d•th
.

39 
cÚv_hy³½¬ams
: 
tf
 
¦im
 
¬g_scİe
 
cÚv2d
 
ªd
 
£·¿bË_cÚv2d
 
İs
.

40 
»u£_weights
: 
Wh‘h”
 
to
 
»u£
 
v¬ŸbËs
. 
DeçuÉ
 
is
 
NÚe
.

42 
	`su³r
(
SSDInû±iÚV2F—tu»ExŒaùÜ
, 
£lf
).
	$__š™__
(

43 
d•th_muÉl›r
, 
mš_d•th
, 
cÚv_hy³½¬ams
, 
»u£_weights
)

45 
def
 
	$´•roûss
(
£lf
, 
»sized_šputs
):

48 
M­s
 
pix–
 
v®ues
 
to
 
the
 
¿nge
 [-1, 1].

50 
Args
:

51 
»sized_šputs
: 
a
 [
b©ch
, 
height
, 
width
, 
chªÃls
] 
‹nsÜ


52 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

54 
R‘uºs
:

55 
´•roûs£d_šputs
: 
a
 [
b©ch
, 
height
, 
width
, 
chªÃls
] 
‹nsÜ


56 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

58  (2.0 / 255.0è* 
»sized_šputs
 - 1.0

60 
def
 
	$exŒaù_ã©u»s
(
£lf
, 
´•roûs£d_šputs
):

63 
Args
:

64 
´•roûs£d_šputs
: 
a
 [
b©ch
, 
height
, 
width
, 
chªÃls
] 
‹nsÜ


65 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

67 
R‘uºs
:

68 
ã©u»_m­s
: 
a
 
li¡
 
of
 
‹nsÜs
 
wh”e
 
the
 
™h
 
‹nsÜ
 
has
 
sh­e


69 [
b©ch
, 
height_i
, 
width_i
, 
d•th_i
]

71 
´•roûs£d_šputs
.
	`g‘_sh­e
().
	$as£¹_has_¿nk
(4)

72 
sh­e_as£¹
 = 
tf
.
	`As£¹
(

73 
tf
.
	`logiÿl_ªd
Ñf.
	`g»©”_equ®
Ñf.
	`sh­e
(
´•roûs£d_šputs
)[1], 33),

74 
tf
.
	`g»©”_equ®
Ñf.
	`sh­e
(
´•roûs£d_šputs
)[2], 33)),

77 
ã©u»_m­_Ïyout
 = {

80 
	}
}

82 
w™h
 
tf
.
	$cÚŒŞ_d•’d’c›s
([
sh­e_as£¹
]):

83 
w™h
 
¦im
.
	$¬g_scİe
(
£lf
.
_cÚv_hy³½¬ams
):

84 
w™h
 
tf
.
	`v¬ŸbË_scİe
('InceptionV2',

85 
»u£
=
£lf
.
_»u£_weights
è
as
 
scİe
:

86 
_
, 
image_ã©u»s
 = 
šû±iÚ_v2
.
	`šû±iÚ_v2_ba£
(

87 
´•roûs£d_šputs
,

88 
fš®_’dpošt
='Mixed_5c',

89 
mš_d•th
=
£lf
.
_mš_d•th
,

90 
d•th_muÉl›r
=
£lf
.
_d•th_muÉl›r
,

91 
scİe
=scope)

92 
ã©u»_m­s
 = 
ã©u»_m­_g’”©Üs
.
	$muÉi_»sŞutiÚ_ã©u»_m­s
(

93 
ã©u»_m­_Ïyout
=feature_map_layout,

94 
d•th_muÉl›r
=
£lf
.
_d•th_muÉl›r
,

95 
mš_d•th
=
£lf
.
_mš_d•th
,

96 
š£¹_1x1_cÚv
=
True
,

97 
image_ã©u»s
=image_features)

99  
ã©u»_m­s
.
	`v®ues
()

	@models/ssd_inception_v2_feature_extractor_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
numpy
 
as
 
Å


18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
mod–s
 
impÜt
 
ssd_ã©u»_exŒaùÜ_‹¡


21 
äom
 
	gobjeù_d‘eùiÚ
.
mod–s
 
impÜt
 
ssd_šû±iÚ_v2_ã©u»_exŒaùÜ


24 
şass
 
	$SsdInû±iÚV2F—tu»ExŒaùÜTe¡
(

25 
ssd_ã©u»_exŒaùÜ_‹¡
.
SsdF—tu»ExŒaùÜTe¡Ba£
,

26 
tf
.
‹¡
.
Te¡Ca£
):

28 
def
 
	$_ü—‹_ã©u»_exŒaùÜ
(
£lf
, 
d•th_muÉl›r
):

31 
Args
:

32 
d•th_muÉl›r
: 
d•th
 
muÉl›r
 
ã©u»
 
exŒaùÜ


33 
R‘uºs
:

34 
ª
 
ssd_šû±iÚ_v2_ã©u»_exŒaùÜ
.
SsdInû±iÚV2F—tu»ExŒaùÜ
.

36 
mš_d•th
 = 32

37 
cÚv_hy³½¬ams
 = {
	}
}

38  
ssd_šû±iÚ_v2_ã©u»_exŒaùÜ
.
	$SSDInû±iÚV2F—tu»ExŒaùÜ
(

39 
d•th_muÉl›r
, 
mš_d•th
, 
cÚv_hy³½¬ams
)

41 
def
 
	$‹¡_exŒaù_ã©u»s_»tuºs_cÜ»ù_sh­es_128
(
£lf
):

42 
image_height
 = 128

43 
image_width
 = 128

44 
d•th_muÉl›r
 = 1.0

45 
ex³ùed_ã©u»_m­_sh­e
 = [(4, 8, 8, 576), (4, 4, 4, 1024),

48 
£lf
.
	$check_exŒaù_ã©u»s_»tuºs_cÜ»ù_sh­e
(

49 
image_height
, 
image_width
, 
d•th_muÉl›r
, 
ex³ùed_ã©u»_m­_sh­e
)

51 
def
 
	$‹¡_exŒaù_ã©u»s_»tuºs_cÜ»ù_sh­es_299
(
£lf
):

52 
image_height
 = 299

53 
image_width
 = 299

54 
d•th_muÉl›r
 = 1.0

55 
ex³ùed_ã©u»_m­_sh­e
 = [(4, 19, 19, 576), (4, 10, 10, 1024),

58 
£lf
.
	$check_exŒaù_ã©u»s_»tuºs_cÜ»ù_sh­e
(

59 
image_height
, 
image_width
, 
d•th_muÉl›r
, 
ex³ùed_ã©u»_m­_sh­e
)

61 
def
 
	$‹¡_exŒaù_ã©u»s_»tuºs_cÜ»ù_sh­es_’fÜcšg_mš_d•th
(
£lf
):

62 
image_height
 = 299

63 
image_width
 = 299

64 
d•th_muÉl›r
 = 0.5**12

65 
ex³ùed_ã©u»_m­_sh­e
 = [(4, 19, 19, 128), (4, 10, 10, 128),

68 
£lf
.
	$check_exŒaù_ã©u»s_»tuºs_cÜ»ù_sh­e
(

69 
image_height
, 
image_width
, 
d•th_muÉl›r
, 
ex³ùed_ã©u»_m­_sh­e
)

71 
def
 
	$‹¡_exŒaù_ã©u»s_¿i£s_”rÜ_w™h_šv®id_image_size
(
£lf
):

72 
image_height
 = 32

73 
image_width
 = 32

74 
d•th_muÉl›r
 = 1.0

75 
£lf
.
	$check_exŒaù_ã©u»s_¿i£s_”rÜ_w™h_šv®id_image_size
(

76 
image_height
, 
image_width
, 
d•th_muÉl›r
)

78 
def
 
	$‹¡_´•roûss_»tuºs_cÜ»ù_v®ue_¿nge
(
£lf
):

79 
image_height
 = 128

80 
image_width
 = 128

81 
d•th_muÉl›r
 = 1

82 
‹¡_image
 = 
Å
.
¿ndom
.
	$¿nd
(4, 
image_height
, 
image_width
, 3)

83 
ã©u»_exŒaùÜ
 = 
£lf
.
	$_ü—‹_ã©u»_exŒaùÜ
(
d•th_muÉl›r
)

84 
´•roûs£d_image
 = 
ã©u»_exŒaùÜ
.
	$´•roûss
(
‹¡_image
)

85 
£lf
.
	`as£¹True
(
Å
.
	`®l
Òp.
	`Ëss_equ®
Òp.
	`abs
(
´•roûs£d_image
), 1.0)))

87 
def
 
	$‹¡_v¬ŸbËs_Úly_ü—‹d_š_scİe
(
£lf
):

88 
d•th_muÉl›r
 = 1

89 
scİe_Çme
 = 'InceptionV2'

90 
£lf
.
	$check_ã©u»_exŒaùÜ_v¬ŸbËs_und”_scİe
(
d•th_muÉl›r
,

91 
scİe_Çme
)

94 
__Çme__
 == '__main__':

95 
tf
.
‹¡
.
	`maš
()

	@models/ssd_mobilenet_v1_feature_extractor.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
m‘a_¬ch™eùu»s
 
impÜt
 
ssd_m‘a_¬ch


21 
äom
 
	gobjeù_d‘eùiÚ
.
mod–s
 
impÜt
 
ã©u»_m­_g’”©Üs


22 
äom
 
Ãts
 
impÜt
 
mob’‘_v1


24 
	g¦im
 = 
tf
.
cÚŒib
.
¦im


27 
şass
 
	$SSDMobeN‘V1F—tu»ExŒaùÜ
(
ssd_m‘a_¬ch
.
SSDF—tu»ExŒaùÜ
):

30 
def
 
	$__š™__
(
£lf
,

31 
d•th_muÉl›r
,

32 
mš_d•th
,

33 
cÚv_hy³½¬ams
,

34 
»u£_weights
=
NÚe
):

37 
Args
:

38 
d•th_muÉl›r
: 
d•th
 
muÉl›r
 
ã©u»
 
exŒaùÜ
.

39 
mš_d•th
: 
mšimum
 
ã©u»
 
exŒaùÜ
 
d•th
.

40 
cÚv_hy³½¬ams
: 
tf
 
¦im
 
¬g_scİe
 
cÚv2d
 
ªd
 
£·¿bË_cÚv2d
 
İs
.

41 
»u£_weights
: 
Wh‘h”
 
to
 
»u£
 
v¬ŸbËs
. 
DeçuÉ
 
is
 
NÚe
.

43 
	`su³r
(
SSDMobeN‘V1F—tu»ExŒaùÜ
, 
£lf
).
	$__š™__
(

44 
d•th_muÉl›r
, 
mš_d•th
, 
cÚv_hy³½¬ams
, 
»u£_weights
)

46 
def
 
	$´•roûss
(
£lf
, 
»sized_šputs
):

49 
M­s
 
pix–
 
v®ues
 
to
 
the
 
¿nge
 [-1, 1].

51 
Args
:

52 
»sized_šputs
: 
a
 [
b©ch
, 
height
, 
width
, 
chªÃls
] 
‹nsÜ


53 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

55 
R‘uºs
:

56 
´•roûs£d_šputs
: 
a
 [
b©ch
, 
height
, 
width
, 
chªÃls
] 
‹nsÜ


57 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

59  (2.0 / 255.0è* 
»sized_šputs
 - 1.0

61 
def
 
	$exŒaù_ã©u»s
(
£lf
, 
´•roûs£d_šputs
):

64 
Args
:

65 
´•roûs£d_šputs
: 
a
 [
b©ch
, 
height
, 
width
, 
chªÃls
] 
‹nsÜ


66 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
.

68 
R‘uºs
:

69 
ã©u»_m­s
: 
a
 
li¡
 
of
 
‹nsÜs
 
wh”e
 
the
 
™h
 
‹nsÜ
 
has
 
sh­e


70 [
b©ch
, 
height_i
, 
width_i
, 
d•th_i
]

72 
´•roûs£d_šputs
.
	`g‘_sh­e
().
	$as£¹_has_¿nk
(4)

73 
sh­e_as£¹
 = 
tf
.
	`As£¹
(

74 
tf
.
	`logiÿl_ªd
Ñf.
	`g»©”_equ®
Ñf.
	`sh­e
(
´•roûs£d_šputs
)[1], 33),

75 
tf
.
	`g»©”_equ®
Ñf.
	`sh­e
(
´•roûs£d_šputs
)[2], 33)),

78 
ã©u»_m­_Ïyout
 = {

82 
	}
}

84 
w™h
 
tf
.
	$cÚŒŞ_d•’d’c›s
([
sh­e_as£¹
]):

85 
w™h
 
¦im
.
	$¬g_scİe
(
£lf
.
_cÚv_hy³½¬ams
):

86 
w™h
 
tf
.
	`v¬ŸbË_scİe
('MobilenetV1',

87 
»u£
=
£lf
.
_»u£_weights
è
as
 
scİe
:

88 
_
, 
image_ã©u»s
 = 
mob’‘_v1
.
	`mob’‘_v1_ba£
(

89 
´•roûs£d_šputs
,

90 
fš®_’dpošt
='Conv2d_13_pointwise',

91 
mš_d•th
=
£lf
.
_mš_d•th
,

92 
d•th_muÉl›r
=
£lf
.
_d•th_muÉl›r
,

93 
scİe
=scope)

94 
ã©u»_m­s
 = 
ã©u»_m­_g’”©Üs
.
	$muÉi_»sŞutiÚ_ã©u»_m­s
(

95 
ã©u»_m­_Ïyout
=feature_map_layout,

96 
d•th_muÉl›r
=
£lf
.
_d•th_muÉl›r
,

97 
mš_d•th
=
£lf
.
_mš_d•th
,

98 
š£¹_1x1_cÚv
=
True
,

99 
image_ã©u»s
=image_features)

101  
ã©u»_m­s
.
	`v®ues
()

	@models/ssd_mobilenet_v1_feature_extractor_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
numpy
 
as
 
Å


18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
mod–s
 
impÜt
 
ssd_ã©u»_exŒaùÜ_‹¡


21 
äom
 
	gobjeù_d‘eùiÚ
.
mod–s
 
impÜt
 
ssd_mob’‘_v1_ã©u»_exŒaùÜ


24 
şass
 
	$SsdMob’‘V1F—tu»ExŒaùÜTe¡
(

25 
ssd_ã©u»_exŒaùÜ_‹¡
.
SsdF—tu»ExŒaùÜTe¡Ba£
, 
tf
.
‹¡
.
Te¡Ca£
):

27 
def
 
	$_ü—‹_ã©u»_exŒaùÜ
(
£lf
, 
d•th_muÉl›r
):

30 
Args
:

31 
d•th_muÉl›r
: 
d•th
 
muÉl›r
 
ã©u»
 
exŒaùÜ


32 
R‘uºs
:

33 
ª
 
ssd_m‘a_¬ch
.
SSDF—tu»ExŒaùÜ
 
objeù
.

35 
mš_d•th
 = 32

36 
cÚv_hy³½¬ams
 = {
	}
}

37  
ssd_mob’‘_v1_ã©u»_exŒaùÜ
.
	$SSDMobeN‘V1F—tu»ExŒaùÜ
(

38 
d•th_muÉl›r
, 
mš_d•th
, 
cÚv_hy³½¬ams
)

40 
def
 
	$‹¡_exŒaù_ã©u»s_»tuºs_cÜ»ù_sh­es_128
(
£lf
):

41 
image_height
 = 128

42 
image_width
 = 128

43 
d•th_muÉl›r
 = 1.0

44 
ex³ùed_ã©u»_m­_sh­e
 = [(4, 8, 8, 512), (4, 4, 4, 1024),

47 
£lf
.
	$check_exŒaù_ã©u»s_»tuºs_cÜ»ù_sh­e
(

48 
image_height
, 
image_width
, 
d•th_muÉl›r
, 
ex³ùed_ã©u»_m­_sh­e
)

50 
def
 
	$‹¡_exŒaù_ã©u»s_»tuºs_cÜ»ù_sh­es_299
(
£lf
):

51 
image_height
 = 299

52 
image_width
 = 299

53 
d•th_muÉl›r
 = 1.0

54 
ex³ùed_ã©u»_m­_sh­e
 = [(4, 19, 19, 512), (4, 10, 10, 1024),

57 
£lf
.
	$check_exŒaù_ã©u»s_»tuºs_cÜ»ù_sh­e
(

58 
image_height
, 
image_width
, 
d•th_muÉl›r
, 
ex³ùed_ã©u»_m­_sh­e
)

60 
def
 
	$‹¡_exŒaù_ã©u»s_»tuºs_cÜ»ù_sh­es_’fÜcšg_mš_d•th
(
£lf
):

61 
image_height
 = 299

62 
image_width
 = 299

63 
d•th_muÉl›r
 = 0.5**12

64 
ex³ùed_ã©u»_m­_sh­e
 = [(4, 19, 19, 32), (4, 10, 10, 32),

67 
£lf
.
	$check_exŒaù_ã©u»s_»tuºs_cÜ»ù_sh­e
(

68 
image_height
, 
image_width
, 
d•th_muÉl›r
, 
ex³ùed_ã©u»_m­_sh­e
)

70 
def
 
	$‹¡_exŒaù_ã©u»s_¿i£s_”rÜ_w™h_šv®id_image_size
(
£lf
):

71 
image_height
 = 32

72 
image_width
 = 32

73 
d•th_muÉl›r
 = 1.0

74 
£lf
.
	$check_exŒaù_ã©u»s_¿i£s_”rÜ_w™h_šv®id_image_size
(

75 
image_height
, 
image_width
, 
d•th_muÉl›r
)

77 
def
 
	$‹¡_´•roûss_»tuºs_cÜ»ù_v®ue_¿nge
(
£lf
):

78 
image_height
 = 128

79 
image_width
 = 128

80 
d•th_muÉl›r
 = 1

81 
‹¡_image
 = 
Å
.
¿ndom
.
	$¿nd
(4, 
image_height
, 
image_width
, 3)

82 
ã©u»_exŒaùÜ
 = 
£lf
.
	$_ü—‹_ã©u»_exŒaùÜ
(
d•th_muÉl›r
)

83 
´•roûs£d_image
 = 
ã©u»_exŒaùÜ
.
	$´•roûss
(
‹¡_image
)

84 
£lf
.
	`as£¹True
(
Å
.
	`®l
Òp.
	`Ëss_equ®
Òp.
	`abs
(
´•roûs£d_image
), 1.0)))

86 
def
 
	$‹¡_v¬ŸbËs_Úly_ü—‹d_š_scİe
(
£lf
):

87 
d•th_muÉl›r
 = 1

88 
scİe_Çme
 = 'MobilenetV1'

89 
£lf
.
	$check_ã©u»_exŒaùÜ_v¬ŸbËs_und”_scİe
(
d•th_muÉl›r
,

90 
scİe_Çme
)

93 
__Çme__
 == '__main__':

94 
tf
.
‹¡
.
	`maš
()

	@protos/__init__.py

	@protos/anchor_generator_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
ªchÜ_g’”©Ü
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

16 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
grid_ªchÜ_g’”©Ü_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_grid__ªchÜ__g’”©Ü__pb2


17 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
ssd_ªchÜ_g’”©Ü_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ssd__ªchÜ__g’”©Ü__pb2


20 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

21 
Çme
='object_detection/protos/anchor_generator.proto',

22 
·ckage
='object_detection.protos',

23 
syÁax
='proto2',

24 
£rŸlized_pb
=
	`_b
('\n.object_detection/protos/anchor_generator.proto\x12\x17object_detection.protos\x1a\x33object_detection/protos/grid_anchor_generator.proto\x1a\x32object_detection/protos/ssd_anchor_generator.proto\"\xc7\x01\n\x0f\x41nchorGenerator\x12M\n\x15grid_anchor_generator\x18\x01 \x01(\x0b\x32,.object_detection.protos.GridAnchorGeneratorH\x00\x12K\n\x14ssd_anchor_generator\x18\x02 \x01(\x0b\x32+.object_detection.protos.SsdAnchorGeneratorH\x00\x42\x18\n\x16\x61nchor_generator_oneof')

26 
d•’d’c›s
=[
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_grid__ªchÜ__g’”©Ü__pb2
.
DESCRIPTOR
,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ssd__ªchÜ__g’”©Ü__pb2
.DESCRIPTOR,])

31 
_ANCHORGENERATOR
 = 
_desütÜ
.
	`DesütÜ
(

32 
Çme
='AnchorGenerator',

33 
fuÎ_Çme
='object_detection.protos.AnchorGenerator',

34 
f’ame
=
NÚe
,

35 
fe
=
DESCRIPTOR
,

36 
cÚššg_ty³
=
NÚe
,

37 
f›lds
=[

38 
_desütÜ
.
	`F›ldDesütÜ
(

39 
Çme
='grid_ªchÜ_g’”©Ü', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.AnchÜG’”©Ü.grid_ªchÜ_g’”©Ü', 
šdex
=0,

40 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

41 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

42 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

43 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

44 
İtiÚs
=
NÚe
),

45 
_desütÜ
.
	`F›ldDesütÜ
(

46 
Çme
='ssd_ªchÜ_g’”©Ü', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.AnchÜG’”©Ü.ssd_ªchÜ_g’”©Ü', 
šdex
=1,

47 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

48 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

49 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

50 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

51 
İtiÚs
=
NÚe
),

53 
ex‹nsiÚs
=[

55 
Ã¡ed_ty³s
=[],

56 
’um_ty³s
=[

58 
İtiÚs
=
NÚe
,

59 
is_ex‹ndabË
=
F®£
,

60 
syÁax
='proto2',

61 
ex‹nsiÚ_¿nges
=[],

62 
Úeofs
=[

63 
_desütÜ
.
	`OÃofDesütÜ
(

64 
Çme
='ªchÜ_g’”©Ü_Úeof', 
fuÎ_Çme
='object_detection.protos.AnchorGenerator.anchor_generator_oneof',

65 
šdex
=0, 
cÚššg_ty³
=
NÚe
, 
f›lds
=[]),

67 
£rŸlized_¡¬t
=181,

68 
£rŸlized_’d
=380,

71 
_ANCHORGENERATOR
.
f›lds_by_Çme
['grid_ªchÜ_g’”©Ü'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_grid__ªchÜ__g’”©Ü__pb2
.
_GRIDANCHORGENERATOR


72 
_ANCHORGENERATOR
.
f›lds_by_Çme
['ssd_ªchÜ_g’”©Ü'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ssd__ªchÜ__g’”©Ü__pb2
.
_SSDANCHORGENERATOR


73 
_ANCHORGENERATOR
.
Úeofs_by_Çme
['ªchÜ_g’”©Ü_Úeof'].
f›lds
.
	`­³nd
(

74 
_ANCHORGENERATOR
.
f›lds_by_Çme
['grid_anchor_generator'])

75 
_ANCHORGENERATOR
.
f›lds_by_Çme
['grid_ªchÜ_g’”©Ü'].
cÚššg_Úeof
 = _ANCHORGENERATOR.
Úeofs_by_Çme
['anchor_generator_oneof']

76 
_ANCHORGENERATOR
.
Úeofs_by_Çme
['ªchÜ_g’”©Ü_Úeof'].
f›lds
.
	`­³nd
(

77 
_ANCHORGENERATOR
.
f›lds_by_Çme
['ssd_anchor_generator'])

78 
_ANCHORGENERATOR
.
f›lds_by_Çme
['ssd_ªchÜ_g’”©Ü'].
cÚššg_Úeof
 = _ANCHORGENERATOR.
Úeofs_by_Çme
['anchor_generator_oneof']

79 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['AnchÜG’”©Ü'] = 
_ANCHORGENERATOR


80 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

82 
AnchÜG’”©Ü
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('AnchÜG’”©Ü', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

83 
DESCRIPTOR
 = 
_ANCHORGENERATOR
,

84 
__moduË__
 = 'object_detection.protos.anchor_generator_pb2'

85 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
AnchÜG’”©Ü
)

87 
_sym_db
.
	$Regi¡”Mes§ge
(
AnchÜG’”©Ü
)

90 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/argmax_matcher_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
¬gmax_m©ch”
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

18 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

19 
Çme
='object_detection/protos/argmax_matcher.proto',

20 
·ckage
='object_detection.protos',

21 
syÁax
='proto2',

22 
£rŸlized_pb
=
	`_b
('\n,object_detection/protos/argmax_matcher.proto\x12\x17object_detection.protos\"\xca\x01\n\rArgMaxMatcher\x12\x1e\n\x11matched_threshold\x18\x01 \x01(\x02:\x03\x30.5\x12 \n\x13unmatched_threshold\x18\x02 \x01(\x02:\x03\x30.5\x12 \n\x11ignore_thresholds\x18\x03 \x01(\x08:\x05\x66\x61lse\x12,\n\x1enegatives_lower_than_unmatched\x18\x04 \x01(\x08:\x04true\x12\'\n\x18\x66orce_match_for_each_row\x18\x05 \x01(\x08:\x05\x66\x61lse')

28 
_ARGMAXMATCHER
 = 
_desütÜ
.
	`DesütÜ
(

29 
Çme
='ArgMaxMatcher',

30 
fuÎ_Çme
='object_detection.protos.ArgMaxMatcher',

31 
f’ame
=
NÚe
,

32 
fe
=
DESCRIPTOR
,

33 
cÚššg_ty³
=
NÚe
,

34 
f›lds
=[

35 
_desütÜ
.
	`F›ldDesütÜ
(

36 
Çme
='m©ched_th»shŞd', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.ArgMaxM©ch”.m©ched_th»shŞd', 
šdex
=0,

37 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

38 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.5),

39 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

40 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

41 
İtiÚs
=
NÚe
),

42 
_desütÜ
.
	`F›ldDesütÜ
(

43 
Çme
='unm©ched_th»shŞd', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.ArgMaxM©ch”.unm©ched_th»shŞd', 
šdex
=1,

44 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

45 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.5),

46 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

47 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

48 
İtiÚs
=
NÚe
),

49 
_desütÜ
.
	`F›ldDesütÜ
(

50 
Çme
='ignÜe_th»shŞds', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.ArgMaxM©ch”.ignÜe_th»shŞds', 
šdex
=2,

51 
numb”
=3, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

52 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

53 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

54 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

55 
İtiÚs
=
NÚe
),

56 
_desütÜ
.
	`F›ldDesütÜ
(

57 
Çme
='Ãg©ives_low”_thª_unm©ched', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.ArgMaxM©ch”.Ãg©ives_low”_thª_unm©ched', 
šdex
=3,

58 
numb”
=4, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

59 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=True,

60 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

61 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

62 
İtiÚs
=
NÚe
),

63 
_desütÜ
.
	`F›ldDesütÜ
(

64 
Çme
='fÜû_m©ch_fÜ_—ch_row', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.ArgMaxM©ch”.fÜû_m©ch_fÜ_—ch_row', 
šdex
=4,

65 
numb”
=5, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

66 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

67 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

68 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

69 
İtiÚs
=
NÚe
),

71 
ex‹nsiÚs
=[

73 
Ã¡ed_ty³s
=[],

74 
’um_ty³s
=[

76 
İtiÚs
=
NÚe
,

77 
is_ex‹ndabË
=
F®£
,

78 
syÁax
='proto2',

79 
ex‹nsiÚ_¿nges
=[],

80 
Úeofs
=[

82 
£rŸlized_¡¬t
=74,

83 
£rŸlized_’d
=276,

86 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['ArgMaxM©ch”'] = 
_ARGMAXMATCHER


87 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

89 
ArgMaxM©ch”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('ArgMaxM©ch”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

90 
DESCRIPTOR
 = 
_ARGMAXMATCHER
,

91 
__moduË__
 = 'object_detection.protos.argmax_matcher_pb2'

92 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
ArgMaxM©ch”
)

94 
_sym_db
.
	$Regi¡”Mes§ge
(
ArgMaxM©ch”
)

97 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/bipartite_matcher_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
b¬t™e_m©ch”
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

18 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

19 
Çme
='object_detection/protos/bipartite_matcher.proto',

20 
·ckage
='object_detection.protos',

21 
syÁax
='proto2',

22 
£rŸlized_pb
=
	`_b
('\n/object_detection/protos/bipartite_matcher.proto\x12\x17object_detection.protos\"\x12\n\x10\x42ipartiteMatcher')

28 
_BIPARTITEMATCHER
 = 
_desütÜ
.
	`DesütÜ
(

29 
Çme
='BipartiteMatcher',

30 
fuÎ_Çme
='object_detection.protos.BipartiteMatcher',

31 
f’ame
=
NÚe
,

32 
fe
=
DESCRIPTOR
,

33 
cÚššg_ty³
=
NÚe
,

34 
f›lds
=[

36 
ex‹nsiÚs
=[

38 
Ã¡ed_ty³s
=[],

39 
’um_ty³s
=[

41 
İtiÚs
=
NÚe
,

42 
is_ex‹ndabË
=
F®£
,

43 
syÁax
='proto2',

44 
ex‹nsiÚ_¿nges
=[],

45 
Úeofs
=[

47 
£rŸlized_¡¬t
=76,

48 
£rŸlized_’d
=94,

51 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['B¬t™eM©ch”'] = 
_BIPARTITEMATCHER


52 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

54 
B¬t™eM©ch”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('B¬t™eM©ch”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

55 
DESCRIPTOR
 = 
_BIPARTITEMATCHER
,

56 
__moduË__
 = 'object_detection.protos.bipartite_matcher_pb2'

57 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
B¬t™eM©ch”
)

59 
_sym_db
.
	$Regi¡”Mes§ge
(
B¬t™eM©ch”
)

62 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/box_coder_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
box_cod”
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

16 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
ç¡”_rún_box_cod”_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ç¡”__rún__box__cod”__pb2


17 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
m—n_¡ddev_box_cod”_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_m—n__¡ddev__box__cod”__pb2


18 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
squ¬e_box_cod”_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_squ¬e__box__cod”__pb2


21 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

22 
Çme
='object_detection/protos/box_coder.proto',

23 
·ckage
='object_detection.protos',

24 
syÁax
='proto2',

25 
£rŸlized_pb
=
	`_b
('\n\'object_detection/protos/box_coder.proto\x12\x17object_detection.protos\x1a\x33object_detection/protos/faster_rcnn_box_coder.proto\x1a\x33object_detection/protos/mean_stddev_box_coder.proto\x1a.object_detection/protos/square_box_coder.proto\"\xfe\x01\n\x08\x42oxCoder\x12L\n\x15\x66\x61ster_rcnn_box_coder\x18\x01 \x01(\x0b\x32+.object_detection.protos.FasterRcnnBoxCoderH\x00\x12L\n\x15mean_stddev_box_coder\x18\x02 \x01(\x0b\x32+.object_detection.protos.MeanStddevBoxCoderH\x00\x12\x43\n\x10square_box_coder\x18\x03 \x01(\x0b\x32\'.object_detection.protos.SquareBoxCoderH\x00\x42\x11\n\x0f\x62ox_coder_oneof')

27 
d•’d’c›s
=[
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ç¡”__rún__box__cod”__pb2
.
DESCRIPTOR
,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_m—n__¡ddev__box__cod”__pb2
.DESCRIPTOR,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_squ¬e__box__cod”__pb2
.DESCRIPTOR,])

32 
_BOXCODER
 = 
_desütÜ
.
	`DesütÜ
(

33 
Çme
='BoxCoder',

34 
fuÎ_Çme
='object_detection.protos.BoxCoder',

35 
f’ame
=
NÚe
,

36 
fe
=
DESCRIPTOR
,

37 
cÚššg_ty³
=
NÚe
,

38 
f›lds
=[

39 
_desütÜ
.
	`F›ldDesütÜ
(

40 
Çme
='ç¡”_rún_box_cod”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.BoxCod”.ç¡”_rún_box_cod”', 
šdex
=0,

41 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

42 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

43 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

44 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

45 
İtiÚs
=
NÚe
),

46 
_desütÜ
.
	`F›ldDesütÜ
(

47 
Çme
='m—n_¡ddev_box_cod”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.BoxCod”.m—n_¡ddev_box_cod”', 
šdex
=1,

48 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

49 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

50 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

51 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

52 
İtiÚs
=
NÚe
),

53 
_desütÜ
.
	`F›ldDesütÜ
(

54 
Çme
='squ¬e_box_cod”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.BoxCod”.squ¬e_box_cod”', 
šdex
=2,

55 
numb”
=3, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

56 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

57 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

58 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

59 
İtiÚs
=
NÚe
),

61 
ex‹nsiÚs
=[

63 
Ã¡ed_ty³s
=[],

64 
’um_ty³s
=[

66 
İtiÚs
=
NÚe
,

67 
is_ex‹ndabË
=
F®£
,

68 
syÁax
='proto2',

69 
ex‹nsiÚ_¿nges
=[],

70 
Úeofs
=[

71 
_desütÜ
.
	`OÃofDesütÜ
(

72 
Çme
='box_cod”_Úeof', 
fuÎ_Çme
='object_detection.protos.BoxCoder.box_coder_oneof',

73 
šdex
=0, 
cÚššg_ty³
=
NÚe
, 
f›lds
=[]),

75 
£rŸlized_¡¬t
=223,

76 
£rŸlized_’d
=477,

79 
_BOXCODER
.
f›lds_by_Çme
['ç¡”_rún_box_cod”'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ç¡”__rún__box__cod”__pb2
.
_FASTERRCNNBOXCODER


80 
_BOXCODER
.
f›lds_by_Çme
['m—n_¡ddev_box_cod”'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_m—n__¡ddev__box__cod”__pb2
.
_MEANSTDDEVBOXCODER


81 
_BOXCODER
.
f›lds_by_Çme
['squ¬e_box_cod”'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_squ¬e__box__cod”__pb2
.
_SQUAREBOXCODER


82 
_BOXCODER
.
Úeofs_by_Çme
['box_cod”_Úeof'].
f›lds
.
	`­³nd
(

83 
_BOXCODER
.
f›lds_by_Çme
['faster_rcnn_box_coder'])

84 
_BOXCODER
.
f›lds_by_Çme
['ç¡”_rún_box_cod”'].
cÚššg_Úeof
 = _BOXCODER.
Úeofs_by_Çme
['box_coder_oneof']

85 
_BOXCODER
.
Úeofs_by_Çme
['box_cod”_Úeof'].
f›lds
.
	`­³nd
(

86 
_BOXCODER
.
f›lds_by_Çme
['mean_stddev_box_coder'])

87 
_BOXCODER
.
f›lds_by_Çme
['m—n_¡ddev_box_cod”'].
cÚššg_Úeof
 = _BOXCODER.
Úeofs_by_Çme
['box_coder_oneof']

88 
_BOXCODER
.
Úeofs_by_Çme
['box_cod”_Úeof'].
f›lds
.
	`­³nd
(

89 
_BOXCODER
.
f›lds_by_Çme
['square_box_coder'])

90 
_BOXCODER
.
f›lds_by_Çme
['squ¬e_box_cod”'].
cÚššg_Úeof
 = _BOXCODER.
Úeofs_by_Çme
['box_coder_oneof']

91 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['BoxCod”'] = 
_BOXCODER


92 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

94 
BoxCod”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('BoxCod”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

95 
DESCRIPTOR
 = 
_BOXCODER
,

96 
__moduË__
 = 'object_detection.protos.box_coder_pb2'

97 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
BoxCod”
)

99 
_sym_db
.
	$Regi¡”Mes§ge
(
BoxCod”
)

102 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/box_predictor_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
box_´ediùÜ
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

16 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
hy³½¬ams_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_hy³½¬ams__pb2


19 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

20 
Çme
='object_detection/protos/box_predictor.proto',

21 
·ckage
='object_detection.protos',

22 
syÁax
='proto2',

23 
£rŸlized_pb
=
	`_b
('\n+object_detection/protos/box_predictor.proto\x12\x17object_detection.protos\x1a)object_detection/protos/hyperparams.proto\"\x9b\x02\n\x0c\x42oxPredictor\x12Y\n\x1b\x63onvolutional_box_predictor\x18\x01 \x01(\x0b\x32\x32.object_detection.protos.ConvolutionalBoxPredictorH\x00\x12P\n\x17mask_rcnn_box_predictor\x18\x02 \x01(\x0b\x32-.object_detection.protos.MaskRCNNBoxPredictorH\x00\x12G\n\x12rfcn_box_predictor\x18\x03 \x01(\x0b\x32).object_detection.protos.RfcnBoxPredictorH\x00\x42\x15\n\x13\x62ox_predictor_oneof\"\xcb\x02\n\x19\x43onvolutionalBoxPredictor\x12>\n\x10\x63onv_hyperparams\x18\x01 \x01(\x0b\x32$.object_detection.protos.Hyperparams\x12\x14\n\tmin_depth\x18\x02 \x01(\x05:\x01\x30\x12\x14\n\tmax_depth\x18\x03 \x01(\x05:\x01\x30\x12&\n\x1bnum_layers_before_predictor\x18\x04 \x01(\x05:\x01\x30\x12\x19\n\x0buse_dropout\x18\x05 \x01(\x08:\x04true\x12%\n\x18\x64ropout_keep_probability\x18\x06 \x01(\x02:\x03\x30.8\x12\x16\n\x0bkernel_size\x18\x07 \x01(\x05:\x01\x31\x12\x18\n\rbox_code_size\x18\x08 \x01(\x05:\x01\x34\x12&\n\x17\x61pply_sigmoid_to_scores\x18\t \x01(\x08:\x05\x66\x61lse\"\xe3\x02\n\x14MaskRCNNBoxPredictor\x12<\n\x0e\x66\x63_hyperparams\x18\x01 \x01(\x0b\x32$.object_detection.protos.Hyperparams\x12\x1a\n\x0buse_dropout\x18\x02 \x01(\x08:\x05\x66\x61lse\x12%\n\x18\x64ropout_keep_probability\x18\x03 \x01(\x02:\x03\x30.5\x12\x18\n\rbox_code_size\x18\x04 \x01(\x05:\x01\x34\x12>\n\x10\x63onv_hyperparams\x18\x05 \x01(\x0b\x32$.object_detection.protos.Hyperparams\x12%\n\x16predict_instance_masks\x18\x06 \x01(\x08:\x05\x66\x61lse\x12\'\n\x1amask_prediction_conv_depth\x18\x07 \x01(\x05:\x03\x32\x35\x36\x12 \n\x11predict_keypoints\x18\x08 \x01(\x08:\x05\x66\x61lse\"\xf9\x01\n\x10RfcnBoxPredictor\x12>\n\x10\x63onv_hyperparams\x18\x01 \x01(\x0b\x32$.object_detection.protos.Hyperparams\x12\"\n\x17num_spatial_bins_height\x18\x02 \x01(\x05:\x01\x33\x12!\n\x16num_spatial_bins_width\x18\x03 \x01(\x05:\x01\x33\x12\x13\n\x05\x64\x65pth\x18\x04 \x01(\x05:\x04\x31\x30\x32\x34\x12\x18\n\rbox_code_size\x18\x05 \x01(\x05:\x01\x34\x12\x17\n\x0b\x63rop_height\x18\x06 \x01(\x05:\x02\x31\x32\x12\x16\n\ncrop_width\x18\x07 \x01(\x05:\x02\x31\x32')

25 
d•’d’c›s
=[
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_hy³½¬ams__pb2
.
DESCRIPTOR
,])

30 
_BOXPREDICTOR
 = 
_desütÜ
.
	`DesütÜ
(

31 
Çme
='BoxPredictor',

32 
fuÎ_Çme
='object_detection.protos.BoxPredictor',

33 
f’ame
=
NÚe
,

34 
fe
=
DESCRIPTOR
,

35 
cÚššg_ty³
=
NÚe
,

36 
f›lds
=[

37 
_desütÜ
.
	`F›ldDesütÜ
(

38 
Çme
='cÚvŞutiÚ®_box_´ediùÜ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.BoxP»diùÜ.cÚvŞutiÚ®_box_´ediùÜ', 
šdex
=0,

39 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

40 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

41 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

42 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

43 
İtiÚs
=
NÚe
),

44 
_desütÜ
.
	`F›ldDesütÜ
(

45 
Çme
='mask_rún_box_´ediùÜ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.BoxP»diùÜ.mask_rún_box_´ediùÜ', 
šdex
=1,

46 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

47 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

48 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

49 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

50 
İtiÚs
=
NÚe
),

51 
_desütÜ
.
	`F›ldDesütÜ
(

52 
Çme
='rfú_box_´ediùÜ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.BoxP»diùÜ.rfú_box_´ediùÜ', 
šdex
=2,

53 
numb”
=3, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

54 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

55 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

56 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

57 
İtiÚs
=
NÚe
),

59 
ex‹nsiÚs
=[

61 
Ã¡ed_ty³s
=[],

62 
’um_ty³s
=[

64 
İtiÚs
=
NÚe
,

65 
is_ex‹ndabË
=
F®£
,

66 
syÁax
='proto2',

67 
ex‹nsiÚ_¿nges
=[],

68 
Úeofs
=[

69 
_desütÜ
.
	`OÃofDesütÜ
(

70 
Çme
='box_´ediùÜ_Úeof', 
fuÎ_Çme
='object_detection.protos.BoxPredictor.box_predictor_oneof',

71 
šdex
=0, 
cÚššg_ty³
=
NÚe
, 
f›lds
=[]),

73 
£rŸlized_¡¬t
=116,

74 
£rŸlized_’d
=399,

78 
_CONVOLUTIONALBOXPREDICTOR
 = 
_desütÜ
.
	`DesütÜ
(

79 
Çme
='ConvolutionalBoxPredictor',

80 
fuÎ_Çme
='object_detection.protos.ConvolutionalBoxPredictor',

81 
f’ame
=
NÚe
,

82 
fe
=
DESCRIPTOR
,

83 
cÚššg_ty³
=
NÚe
,

84 
f›lds
=[

85 
_desütÜ
.
	`F›ldDesütÜ
(

86 
Çme
='cÚv_hy³½¬ams', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.CÚvŞutiÚ®BoxP»diùÜ.cÚv_hy³½¬ams', 
šdex
=0,

87 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

88 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

89 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

90 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

91 
İtiÚs
=
NÚe
),

92 
_desütÜ
.
	`F›ldDesütÜ
(

93 
Çme
='mš_d•th', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.CÚvŞutiÚ®BoxP»diùÜ.mš_d•th', 
šdex
=1,

94 
numb”
=2, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

95 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=0,

96 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

97 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

98 
İtiÚs
=
NÚe
),

99 
_desütÜ
.
	`F›ldDesütÜ
(

100 
Çme
='max_d•th', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.CÚvŞutiÚ®BoxP»diùÜ.max_d•th', 
šdex
=2,

101 
numb”
=3, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

102 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=0,

103 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

104 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

105 
İtiÚs
=
NÚe
),

106 
_desütÜ
.
	`F›ldDesütÜ
(

107 
Çme
='num_Ïy”s_befÜe_´ediùÜ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.CÚvŞutiÚ®BoxP»diùÜ.num_Ïy”s_befÜe_´ediùÜ', 
šdex
=3,

108 
numb”
=4, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

109 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=0,

110 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

111 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

112 
İtiÚs
=
NÚe
),

113 
_desütÜ
.
	`F›ldDesütÜ
(

114 
Çme
='u£_drİout', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.CÚvŞutiÚ®BoxP»diùÜ.u£_drİout', 
šdex
=4,

115 
numb”
=5, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

116 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=True,

117 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

118 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

119 
İtiÚs
=
NÚe
),

120 
_desütÜ
.
	`F›ldDesütÜ
(

121 
Çme
='drİout_k“p_´obab™y', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.CÚvŞutiÚ®BoxP»diùÜ.drİout_k“p_´obab™y', 
šdex
=5,

122 
numb”
=6, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

123 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.8),

124 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

125 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

126 
İtiÚs
=
NÚe
),

127 
_desütÜ
.
	`F›ldDesütÜ
(

128 
Çme
='k”Ãl_size', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.CÚvŞutiÚ®BoxP»diùÜ.k”Ãl_size', 
šdex
=6,

129 
numb”
=7, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

130 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=1,

131 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

132 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

133 
İtiÚs
=
NÚe
),

134 
_desütÜ
.
	`F›ldDesütÜ
(

135 
Çme
='box_code_size', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.CÚvŞutiÚ®BoxP»diùÜ.box_code_size', 
šdex
=7,

136 
numb”
=8, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

137 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=4,

138 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

139 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

140 
İtiÚs
=
NÚe
),

141 
_desütÜ
.
	`F›ldDesütÜ
(

142 
Çme
='­¶y_sigmoid_to_scÜes', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.CÚvŞutiÚ®BoxP»diùÜ.­¶y_sigmoid_to_scÜes', 
šdex
=8,

143 
numb”
=9, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

144 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

145 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

146 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

147 
İtiÚs
=
NÚe
),

149 
ex‹nsiÚs
=[

151 
Ã¡ed_ty³s
=[],

152 
’um_ty³s
=[

154 
İtiÚs
=
NÚe
,

155 
is_ex‹ndabË
=
F®£
,

156 
syÁax
='proto2',

157 
ex‹nsiÚ_¿nges
=[],

158 
Úeofs
=[

160 
£rŸlized_¡¬t
=402,

161 
£rŸlized_’d
=733,

165 
_MASKRCNNBOXPREDICTOR
 = 
_desütÜ
.
	`DesütÜ
(

166 
Çme
='MaskRCNNBoxPredictor',

167 
fuÎ_Çme
='object_detection.protos.MaskRCNNBoxPredictor',

168 
f’ame
=
NÚe
,

169 
fe
=
DESCRIPTOR
,

170 
cÚššg_ty³
=
NÚe
,

171 
f›lds
=[

172 
_desütÜ
.
	`F›ldDesütÜ
(

173 
Çme
='fc_hy³½¬ams', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.MaskRCNNBoxP»diùÜ.fc_hy³½¬ams', 
šdex
=0,

174 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

175 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

176 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

177 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

178 
İtiÚs
=
NÚe
),

179 
_desütÜ
.
	`F›ldDesütÜ
(

180 
Çme
='u£_drİout', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.MaskRCNNBoxP»diùÜ.u£_drİout', 
šdex
=1,

181 
numb”
=2, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

182 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

183 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

184 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

185 
İtiÚs
=
NÚe
),

186 
_desütÜ
.
	`F›ldDesütÜ
(

187 
Çme
='drİout_k“p_´obab™y', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.MaskRCNNBoxP»diùÜ.drİout_k“p_´obab™y', 
šdex
=2,

188 
numb”
=3, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

189 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.5),

190 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

191 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

192 
İtiÚs
=
NÚe
),

193 
_desütÜ
.
	`F›ldDesütÜ
(

194 
Çme
='box_code_size', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.MaskRCNNBoxP»diùÜ.box_code_size', 
šdex
=3,

195 
numb”
=4, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

196 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=4,

197 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

198 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

199 
İtiÚs
=
NÚe
),

200 
_desütÜ
.
	`F›ldDesütÜ
(

201 
Çme
='cÚv_hy³½¬ams', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.MaskRCNNBoxP»diùÜ.cÚv_hy³½¬ams', 
šdex
=4,

202 
numb”
=5, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

203 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

204 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

205 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

206 
İtiÚs
=
NÚe
),

207 
_desütÜ
.
	`F›ldDesütÜ
(

208 
Çme
='´ediù_š¡ªû_masks', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.MaskRCNNBoxP»diùÜ.´ediù_š¡ªû_masks', 
šdex
=5,

209 
numb”
=6, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

210 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

211 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

212 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

213 
İtiÚs
=
NÚe
),

214 
_desütÜ
.
	`F›ldDesütÜ
(

215 
Çme
='mask_´ediùiÚ_cÚv_d•th', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.MaskRCNNBoxP»diùÜ.mask_´ediùiÚ_cÚv_d•th', 
šdex
=6,

216 
numb”
=7, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

217 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=256,

218 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

219 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

220 
İtiÚs
=
NÚe
),

221 
_desütÜ
.
	`F›ldDesütÜ
(

222 
Çme
='´ediù_keypošts', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.MaskRCNNBoxP»diùÜ.´ediù_keypošts', 
šdex
=7,

223 
numb”
=8, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

224 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

225 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

226 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

227 
İtiÚs
=
NÚe
),

229 
ex‹nsiÚs
=[

231 
Ã¡ed_ty³s
=[],

232 
’um_ty³s
=[

234 
İtiÚs
=
NÚe
,

235 
is_ex‹ndabË
=
F®£
,

236 
syÁax
='proto2',

237 
ex‹nsiÚ_¿nges
=[],

238 
Úeofs
=[

240 
£rŸlized_¡¬t
=736,

241 
£rŸlized_’d
=1091,

245 
_RFCNBOXPREDICTOR
 = 
_desütÜ
.
	`DesütÜ
(

246 
Çme
='RfcnBoxPredictor',

247 
fuÎ_Çme
='object_detection.protos.RfcnBoxPredictor',

248 
f’ame
=
NÚe
,

249 
fe
=
DESCRIPTOR
,

250 
cÚššg_ty³
=
NÚe
,

251 
f›lds
=[

252 
_desütÜ
.
	`F›ldDesütÜ
(

253 
Çme
='cÚv_hy³½¬ams', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RfúBoxP»diùÜ.cÚv_hy³½¬ams', 
šdex
=0,

254 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

255 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

256 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

257 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

258 
İtiÚs
=
NÚe
),

259 
_desütÜ
.
	`F›ldDesütÜ
(

260 
Çme
='num_¥©Ÿl_bšs_height', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RfúBoxP»diùÜ.num_¥©Ÿl_bšs_height', 
šdex
=1,

261 
numb”
=2, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

262 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=3,

263 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

264 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

265 
İtiÚs
=
NÚe
),

266 
_desütÜ
.
	`F›ldDesütÜ
(

267 
Çme
='num_¥©Ÿl_bšs_width', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RfúBoxP»diùÜ.num_¥©Ÿl_bšs_width', 
šdex
=2,

268 
numb”
=3, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

269 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=3,

270 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

271 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

272 
İtiÚs
=
NÚe
),

273 
_desütÜ
.
	`F›ldDesütÜ
(

274 
Çme
='d•th', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RfúBoxP»diùÜ.d•th', 
šdex
=3,

275 
numb”
=4, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

276 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=1024,

277 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

278 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

279 
İtiÚs
=
NÚe
),

280 
_desütÜ
.
	`F›ldDesütÜ
(

281 
Çme
='box_code_size', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RfúBoxP»diùÜ.box_code_size', 
šdex
=4,

282 
numb”
=5, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

283 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=4,

284 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

285 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

286 
İtiÚs
=
NÚe
),

287 
_desütÜ
.
	`F›ldDesütÜ
(

288 
Çme
='üİ_height', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RfúBoxP»diùÜ.üİ_height', 
šdex
=5,

289 
numb”
=6, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

290 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=12,

291 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

292 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

293 
İtiÚs
=
NÚe
),

294 
_desütÜ
.
	`F›ldDesütÜ
(

295 
Çme
='üİ_width', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RfúBoxP»diùÜ.üİ_width', 
šdex
=6,

296 
numb”
=7, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

297 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=12,

298 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

299 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

300 
İtiÚs
=
NÚe
),

302 
ex‹nsiÚs
=[

304 
Ã¡ed_ty³s
=[],

305 
’um_ty³s
=[

307 
İtiÚs
=
NÚe
,

308 
is_ex‹ndabË
=
F®£
,

309 
syÁax
='proto2',

310 
ex‹nsiÚ_¿nges
=[],

311 
Úeofs
=[

313 
£rŸlized_¡¬t
=1094,

314 
£rŸlized_’d
=1343,

317 
_BOXPREDICTOR
.
f›lds_by_Çme
['cÚvŞutiÚ®_box_´ediùÜ'].
mes§ge_ty³
 = 
_CONVOLUTIONALBOXPREDICTOR


318 
_BOXPREDICTOR
.
f›lds_by_Çme
['mask_rún_box_´ediùÜ'].
mes§ge_ty³
 = 
_MASKRCNNBOXPREDICTOR


319 
_BOXPREDICTOR
.
f›lds_by_Çme
['rfú_box_´ediùÜ'].
mes§ge_ty³
 = 
_RFCNBOXPREDICTOR


320 
_BOXPREDICTOR
.
Úeofs_by_Çme
['box_´ediùÜ_Úeof'].
f›lds
.
	`­³nd
(

321 
_BOXPREDICTOR
.
f›lds_by_Çme
['convolutional_box_predictor'])

322 
_BOXPREDICTOR
.
f›lds_by_Çme
['cÚvŞutiÚ®_box_´ediùÜ'].
cÚššg_Úeof
 = _BOXPREDICTOR.
Úeofs_by_Çme
['box_predictor_oneof']

323 
_BOXPREDICTOR
.
Úeofs_by_Çme
['box_´ediùÜ_Úeof'].
f›lds
.
	`­³nd
(

324 
_BOXPREDICTOR
.
f›lds_by_Çme
['mask_rcnn_box_predictor'])

325 
_BOXPREDICTOR
.
f›lds_by_Çme
['mask_rún_box_´ediùÜ'].
cÚššg_Úeof
 = _BOXPREDICTOR.
Úeofs_by_Çme
['box_predictor_oneof']

326 
_BOXPREDICTOR
.
Úeofs_by_Çme
['box_´ediùÜ_Úeof'].
f›lds
.
	`­³nd
(

327 
_BOXPREDICTOR
.
f›lds_by_Çme
['rfcn_box_predictor'])

328 
_BOXPREDICTOR
.
f›lds_by_Çme
['rfú_box_´ediùÜ'].
cÚššg_Úeof
 = _BOXPREDICTOR.
Úeofs_by_Çme
['box_predictor_oneof']

329 
_CONVOLUTIONALBOXPREDICTOR
.
f›lds_by_Çme
['cÚv_hy³½¬ams'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_hy³½¬ams__pb2
.
_HYPERPARAMS


330 
_MASKRCNNBOXPREDICTOR
.
f›lds_by_Çme
['fc_hy³½¬ams'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_hy³½¬ams__pb2
.
_HYPERPARAMS


331 
_MASKRCNNBOXPREDICTOR
.
f›lds_by_Çme
['cÚv_hy³½¬ams'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_hy³½¬ams__pb2
.
_HYPERPARAMS


332 
_RFCNBOXPREDICTOR
.
f›lds_by_Çme
['cÚv_hy³½¬ams'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_hy³½¬ams__pb2
.
_HYPERPARAMS


333 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['BoxP»diùÜ'] = 
_BOXPREDICTOR


334 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['CÚvŞutiÚ®BoxP»diùÜ'] = 
_CONVOLUTIONALBOXPREDICTOR


335 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['MaskRCNNBoxP»diùÜ'] = 
_MASKRCNNBOXPREDICTOR


336 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RfúBoxP»diùÜ'] = 
_RFCNBOXPREDICTOR


337 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

339 
BoxP»diùÜ
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('BoxP»diùÜ', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

340 
DESCRIPTOR
 = 
_BOXPREDICTOR
,

341 
__moduË__
 = 'object_detection.protos.box_predictor_pb2'

342 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
BoxP»diùÜ
)

344 
_sym_db
.
	$Regi¡”Mes§ge
(
BoxP»diùÜ
)

346 
CÚvŞutiÚ®BoxP»diùÜ
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('CÚvŞutiÚ®BoxP»diùÜ', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

347 
DESCRIPTOR
 = 
_CONVOLUTIONALBOXPREDICTOR
,

348 
__moduË__
 = 'object_detection.protos.box_predictor_pb2'

349 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
CÚvŞutiÚ®BoxP»diùÜ
)

351 
_sym_db
.
	$Regi¡”Mes§ge
(
CÚvŞutiÚ®BoxP»diùÜ
)

353 
MaskRCNNBoxP»diùÜ
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('MaskRCNNBoxP»diùÜ', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

354 
DESCRIPTOR
 = 
_MASKRCNNBOXPREDICTOR
,

355 
__moduË__
 = 'object_detection.protos.box_predictor_pb2'

356 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
MaskRCNNBoxP»diùÜ
)

358 
_sym_db
.
	$Regi¡”Mes§ge
(
MaskRCNNBoxP»diùÜ
)

360 
RfúBoxP»diùÜ
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RfúBoxP»diùÜ', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

361 
DESCRIPTOR
 = 
_RFCNBOXPREDICTOR
,

362 
__moduË__
 = 'object_detection.protos.box_predictor_pb2'

363 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RfúBoxP»diùÜ
)

365 
_sym_db
.
	$Regi¡”Mes§ge
(
RfúBoxP»diùÜ
)

368 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/eval_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
ev®
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

18 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

19 
Çme
='object_detection/protos/eval.proto',

20 
·ckage
='object_detection.protos',

21 
syÁax
='proto2',

22 
£rŸlized_pb
=
	`_b
('\n\"object_detection/protos/eval.proto\x12\x17object_detection.protos\"\x80\x03\n\nEvalConfig\x12\x1e\n\x12num_visualizations\x18\x01 \x01(\r:\x02\x31\x30\x12\x1a\n\x0cnum_examples\x18\x02 \x01(\r:\x04\x35\x30\x30\x30\x12\x1f\n\x12\x65val_interval_secs\x18\x03 \x01(\r:\x03\x33\x30\x30\x12\x14\n\tmax_evals\x18\x04 \x01(\r:\x01\x30\x12\x19\n\nsave_graph\x18\x05 \x01(\x08:\x05\x66\x61lse\x12\"\n\x18visualization_export_dir\x18\x06 \x01(\t:\x00\x12\x15\n\x0b\x65val_master\x18\x07 \x01(\t:\x00\x12\'\n\x0bmetrics_set\x18\x08 \x01(\t:\x12pascal_voc_metrics\x12\x15\n\x0b\x65xport_path\x18\t \x01(\t:\x00\x12!\n\x12ignore_groundtruth\x18\n \x01(\x08:\x05\x66\x61lse\x12\"\n\x13use_moving_averages\x18\x0b \x01(\x08:\x05\x66\x61lse\x12\"\n\x13\x65val_instance_masks\x18\x0c \x01(\x08:\x05\x66\x61lse')

28 
_EVALCONFIG
 = 
_desütÜ
.
	`DesütÜ
(

29 
Çme
='EvalConfig',

30 
fuÎ_Çme
='object_detection.protos.EvalConfig',

31 
f’ame
=
NÚe
,

32 
fe
=
DESCRIPTOR
,

33 
cÚššg_ty³
=
NÚe
,

34 
f›lds
=[

35 
_desütÜ
.
	`F›ldDesütÜ
(

36 
Çme
='num_visu®iz©iÚs', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ev®CÚfig.num_visu®iz©iÚs', 
šdex
=0,

37 
numb”
=1, 
ty³
=13, 
ıp_ty³
=3, 
Ïb–
=1,

38 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=10,

39 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

40 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

41 
İtiÚs
=
NÚe
),

42 
_desütÜ
.
	`F›ldDesütÜ
(

43 
Çme
='num_exam¶es', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ev®CÚfig.num_exam¶es', 
šdex
=1,

44 
numb”
=2, 
ty³
=13, 
ıp_ty³
=3, 
Ïb–
=1,

45 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=5000,

46 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

47 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

48 
İtiÚs
=
NÚe
),

49 
_desütÜ
.
	`F›ldDesütÜ
(

50 
Çme
='ev®_š‹rv®_£cs', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ev®CÚfig.ev®_š‹rv®_£cs', 
šdex
=2,

51 
numb”
=3, 
ty³
=13, 
ıp_ty³
=3, 
Ïb–
=1,

52 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=300,

53 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

54 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

55 
İtiÚs
=
NÚe
),

56 
_desütÜ
.
	`F›ldDesütÜ
(

57 
Çme
='max_ev®s', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ev®CÚfig.max_ev®s', 
šdex
=3,

58 
numb”
=4, 
ty³
=13, 
ıp_ty³
=3, 
Ïb–
=1,

59 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=0,

60 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

61 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

62 
İtiÚs
=
NÚe
),

63 
_desütÜ
.
	`F›ldDesütÜ
(

64 
Çme
='§ve_g¿ph', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ev®CÚfig.§ve_g¿ph', 
šdex
=4,

65 
numb”
=5, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

66 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

67 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

68 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

69 
İtiÚs
=
NÚe
),

70 
_desütÜ
.
	`F›ldDesütÜ
(

71 
Çme
='visu®iz©iÚ_expÜt_dœ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ev®CÚfig.visu®iz©iÚ_expÜt_dœ', 
šdex
=5,

72 
numb”
=6, 
ty³
=9, 
ıp_ty³
=9, 
Ïb–
=1,

73 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
	`_b
("").
	`decode
('utf-8'),

74 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

75 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

76 
İtiÚs
=
NÚe
),

77 
_desütÜ
.
	`F›ldDesütÜ
(

78 
Çme
='ev®_ma¡”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ev®CÚfig.ev®_ma¡”', 
šdex
=6,

79 
numb”
=7, 
ty³
=9, 
ıp_ty³
=9, 
Ïb–
=1,

80 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
	`_b
("").
	`decode
('utf-8'),

81 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

82 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

83 
İtiÚs
=
NÚe
),

84 
_desütÜ
.
	`F›ldDesütÜ
(

85 
Çme
='m‘rics_£t', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ev®CÚfig.m‘rics_£t', 
šdex
=7,

86 
numb”
=8, 
ty³
=9, 
ıp_ty³
=9, 
Ïb–
=1,

87 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
	`_b
("·sÿl_voc_m‘rics").
	`decode
('utf-8'),

88 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

89 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

90 
İtiÚs
=
NÚe
),

91 
_desütÜ
.
	`F›ldDesütÜ
(

92 
Çme
='expÜt_·th', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ev®CÚfig.expÜt_·th', 
šdex
=8,

93 
numb”
=9, 
ty³
=9, 
ıp_ty³
=9, 
Ïb–
=1,

94 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
	`_b
("").
	`decode
('utf-8'),

95 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

96 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

97 
İtiÚs
=
NÚe
),

98 
_desütÜ
.
	`F›ldDesütÜ
(

99 
Çme
='ignÜe_groundŒuth', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ev®CÚfig.ignÜe_groundŒuth', 
šdex
=9,

100 
numb”
=10, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

101 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

102 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

103 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

104 
İtiÚs
=
NÚe
),

105 
_desütÜ
.
	`F›ldDesütÜ
(

106 
Çme
='u£_movšg_av”ages', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ev®CÚfig.u£_movšg_av”ages', 
šdex
=10,

107 
numb”
=11, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

108 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

109 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

110 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

111 
İtiÚs
=
NÚe
),

112 
_desütÜ
.
	`F›ldDesütÜ
(

113 
Çme
='ev®_š¡ªû_masks', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ev®CÚfig.ev®_š¡ªû_masks', 
šdex
=11,

114 
numb”
=12, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

115 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

116 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

117 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

118 
İtiÚs
=
NÚe
),

120 
ex‹nsiÚs
=[

122 
Ã¡ed_ty³s
=[],

123 
’um_ty³s
=[

125 
İtiÚs
=
NÚe
,

126 
is_ex‹ndabË
=
F®£
,

127 
syÁax
='proto2',

128 
ex‹nsiÚ_¿nges
=[],

129 
Úeofs
=[

131 
£rŸlized_¡¬t
=64,

132 
£rŸlized_’d
=448,

135 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Ev®CÚfig'] = 
_EVALCONFIG


136 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

138 
Ev®CÚfig
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Ev®CÚfig', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

139 
DESCRIPTOR
 = 
_EVALCONFIG
,

140 
__moduË__
 = 'object_detection.protos.eval_pb2'

141 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Ev®CÚfig
)

143 
_sym_db
.
	$Regi¡”Mes§ge
(
Ev®CÚfig
)

146 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/faster_rcnn_box_coder_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
ç¡”_rún_box_cod”
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

18 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

19 
Çme
='object_detection/protos/faster_rcnn_box_coder.proto',

20 
·ckage
='object_detection.protos',

21 
syÁax
='proto2',

22 
£rŸlized_pb
=
	`_b
('\n3object_detection/protos/faster_rcnn_box_coder.proto\x12\x17object_detection.protos\"o\n\x12\x46\x61sterRcnnBoxCoder\x12\x13\n\x07y_scale\x18\x01 \x01(\x02:\x02\x31\x30\x12\x13\n\x07x_scale\x18\x02 \x01(\x02:\x02\x31\x30\x12\x17\n\x0cheight_scale\x18\x03 \x01(\x02:\x01\x35\x12\x16\n\x0bwidth_scale\x18\x04 \x01(\x02:\x01\x35')

28 
_FASTERRCNNBOXCODER
 = 
_desütÜ
.
	`DesütÜ
(

29 
Çme
='FasterRcnnBoxCoder',

30 
fuÎ_Çme
='object_detection.protos.FasterRcnnBoxCoder',

31 
f’ame
=
NÚe
,

32 
fe
=
DESCRIPTOR
,

33 
cÚššg_ty³
=
NÚe
,

34 
f›lds
=[

35 
_desütÜ
.
	`F›ldDesütÜ
(

36 
Çme
='y_sÿË', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”RúnBoxCod”.y_sÿË', 
šdex
=0,

37 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

38 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(10),

39 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

40 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

41 
İtiÚs
=
NÚe
),

42 
_desütÜ
.
	`F›ldDesütÜ
(

43 
Çme
='x_sÿË', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”RúnBoxCod”.x_sÿË', 
šdex
=1,

44 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

45 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(10),

46 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

47 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

48 
İtiÚs
=
NÚe
),

49 
_desütÜ
.
	`F›ldDesütÜ
(

50 
Çme
='height_sÿË', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”RúnBoxCod”.height_sÿË', 
šdex
=2,

51 
numb”
=3, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

52 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(5),

53 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

54 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

55 
İtiÚs
=
NÚe
),

56 
_desütÜ
.
	`F›ldDesütÜ
(

57 
Çme
='width_sÿË', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”RúnBoxCod”.width_sÿË', 
šdex
=3,

58 
numb”
=4, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

59 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(5),

60 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

61 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

62 
İtiÚs
=
NÚe
),

64 
ex‹nsiÚs
=[

66 
Ã¡ed_ty³s
=[],

67 
’um_ty³s
=[

69 
İtiÚs
=
NÚe
,

70 
is_ex‹ndabË
=
F®£
,

71 
syÁax
='proto2',

72 
ex‹nsiÚ_¿nges
=[],

73 
Úeofs
=[

75 
£rŸlized_¡¬t
=80,

76 
£rŸlized_’d
=191,

79 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Fa¡”RúnBoxCod”'] = 
_FASTERRCNNBOXCODER


80 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

82 
Fa¡”RúnBoxCod”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Fa¡”RúnBoxCod”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

83 
DESCRIPTOR
 = 
_FASTERRCNNBOXCODER
,

84 
__moduË__
 = 'object_detection.protos.faster_rcnn_box_coder_pb2'

85 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Fa¡”RúnBoxCod”
)

87 
_sym_db
.
	$Regi¡”Mes§ge
(
Fa¡”RúnBoxCod”
)

90 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/faster_rcnn_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
ç¡”_rún
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

16 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
ªchÜ_g’”©Ü_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ªchÜ__g’”©Ü__pb2


17 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
box_´ediùÜ_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_box__´ediùÜ__pb2


18 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
hy³½¬ams_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_hy³½¬ams__pb2


19 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
image_»siz”_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_image__»siz”__pb2


20 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
los£s_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_los£s__pb2


21 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
po¡_´oûssšg_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_po¡__´oûssšg__pb2


24 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

25 
Çme
='object_detection/protos/faster_rcnn.proto',

26 
·ckage
='object_detection.protos',

27 
syÁax
='proto2',

28 
£rŸlized_pb
=
	`_b
('\n)object_detection/protos/faster_rcnn.proto\x12\x17object_detection.protos\x1a.object_detection/protos/anchor_generator.proto\x1a+object_detection/protos/box_predictor.proto\x1a)object_detection/protos/hyperparams.proto\x1a+object_detection/protos/image_resizer.proto\x1a$object_detection/protos/losses.proto\x1a-object_detection/protos/post_processing.proto\"\xa4\n\n\nFasterRcnn\x12\x1f\n\x10\x66irst_stage_only\x18\x01 \x01(\x08:\x05\x66\x61lse\x12\x13\n\x0bnum_classes\x18\x03 \x01(\x05\x12<\n\rimage_resizer\x18\x04 \x01(\x0b\x32%.object_detection.protos.ImageResizer\x12N\n\x11\x66\x65\x61ture_extractor\x18\x05 \x01(\x0b\x32\x33.object_detection.protos.FasterRcnnFeatureExtractor\x12N\n\x1c\x66irst_stage_anchor_generator\x18\x06 \x01(\x0b\x32(.object_detection.protos.AnchorGenerator\x12\"\n\x17\x66irst_stage_atrous_rate\x18\x07 \x01(\x05:\x01\x31\x12X\n*first_stage_box_predictor_conv_hyperparams\x18\x08 \x01(\x0b\x32$.object_detection.protos.Hyperparams\x12\x30\n%first_stage_box_predictor_kernel_size\x18\t \x01(\x05:\x01\x33\x12,\n\x1f\x66irst_stage_box_predictor_depth\x18\n \x01(\x05:\x03\x35\x31\x32\x12\'\n\x1a\x66irst_stage_minibatch_size\x18\x0b \x01(\x05:\x03\x32\x35\x36\x12\x32\n%first_stage_positive_balance_fraction\x18\x0c \x01(\x02:\x03\x30.5\x12*\n\x1f\x66irst_stage_nms_score_threshold\x18\r \x01(\x02:\x01\x30\x12*\n\x1d\x66irst_stage_nms_iou_threshold\x18\x0e \x01(\x02:\x03\x30.7\x12&\n\x19\x66irst_stage_max_proposals\x18\x0f \x01(\x05:\x03\x33\x30\x30\x12/\n$first_stage_localization_loss_weight\x18\x10 \x01(\x02:\x01\x31\x12-\n\"first_stage_objectness_loss_weight\x18\x11 \x01(\x02:\x01\x31\x12\x19\n\x11initial_crop_size\x18\x12 \x01(\x05\x12\x1b\n\x13maxpool_kernel_size\x18\x13 \x01(\x05\x12\x16\n\x0emaxpool_stride\x18\x14 \x01(\x05\x12I\n\x1asecond_stage_box_predictor\x18\x15 \x01(\x0b\x32%.object_detection.protos.BoxPredictor\x12#\n\x17second_stage_batch_size\x18\x16 \x01(\x05:\x02\x36\x34\x12+\n\x1dsecond_stage_balance_fraction\x18\x17 \x01(\x02:\x04\x30.25\x12M\n\x1csecond_stage_post_processing\x18\x18 \x01(\x0b\x32\'.object_detection.protos.PostProcessing\x12\x30\n%second_stage_localization_loss_weight\x18\x19 \x01(\x02:\x01\x31\x12\x32\n\'second_stage_classification_loss_weight\x18\x1a \x01(\x02:\x01\x31\x12\x45\n\x12hard_example_miner\x18\x1b \x01(\x0b\x32).object_detection.protos.HardExampleMiner\"S\n\x1a\x46\x61sterRcnnFeatureExtractor\x12\x0c\n\x04type\x18\x01 \x01(\t\x12\'\n\x1b\x66irst_stage_features_stride\x18\x02 \x01(\x05:\x02\x31\x36')

30 
d•’d’c›s
=[
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ªchÜ__g’”©Ü__pb2
.
DESCRIPTOR
,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_box__´ediùÜ__pb2
.DESCRIPTOR,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_hy³½¬ams__pb2
.DESCRIPTOR,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_image__»siz”__pb2
.DESCRIPTOR,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_los£s__pb2
.DESCRIPTOR,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_po¡__´oûssšg__pb2
.DESCRIPTOR,])

35 
_FASTERRCNN
 = 
_desütÜ
.
	`DesütÜ
(

36 
Çme
='FasterRcnn',

37 
fuÎ_Çme
='object_detection.protos.FasterRcnn',

38 
f’ame
=
NÚe
,

39 
fe
=
DESCRIPTOR
,

40 
cÚššg_ty³
=
NÚe
,

41 
f›lds
=[

42 
_desütÜ
.
	`F›ldDesütÜ
(

43 
Çme
='fœ¡_¡age_Úly', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.fœ¡_¡age_Úly', 
šdex
=0,

44 
numb”
=1, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

45 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

46 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

47 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

48 
İtiÚs
=
NÚe
),

49 
_desütÜ
.
	`F›ldDesütÜ
(

50 
Çme
='num_şas£s', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.num_şas£s', 
šdex
=1,

51 
numb”
=3, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

52 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=0,

53 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

54 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

55 
İtiÚs
=
NÚe
),

56 
_desütÜ
.
	`F›ldDesütÜ
(

57 
Çme
='image_»siz”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.image_»siz”', 
šdex
=2,

58 
numb”
=4, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

59 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

60 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

61 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

62 
İtiÚs
=
NÚe
),

63 
_desütÜ
.
	`F›ldDesütÜ
(

64 
Çme
='ã©u»_exŒaùÜ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.ã©u»_exŒaùÜ', 
šdex
=3,

65 
numb”
=5, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

66 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

67 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

68 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

69 
İtiÚs
=
NÚe
),

70 
_desütÜ
.
	`F›ldDesütÜ
(

71 
Çme
='fœ¡_¡age_ªchÜ_g’”©Ü', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.fœ¡_¡age_ªchÜ_g’”©Ü', 
šdex
=4,

72 
numb”
=6, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

73 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

74 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

75 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

76 
İtiÚs
=
NÚe
),

77 
_desütÜ
.
	`F›ldDesütÜ
(

78 
Çme
='fœ¡_¡age_©rous_¿‹', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.fœ¡_¡age_©rous_¿‹', 
šdex
=5,

79 
numb”
=7, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

80 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=1,

81 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

82 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

83 
İtiÚs
=
NÚe
),

84 
_desütÜ
.
	`F›ldDesütÜ
(

85 
Çme
='fœ¡_¡age_box_´ediùÜ_cÚv_hy³½¬ams', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.fœ¡_¡age_box_´ediùÜ_cÚv_hy³½¬ams', 
šdex
=6,

86 
numb”
=8, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

87 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

88 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

89 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

90 
İtiÚs
=
NÚe
),

91 
_desütÜ
.
	`F›ldDesütÜ
(

92 
Çme
='fœ¡_¡age_box_´ediùÜ_k”Ãl_size', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.fœ¡_¡age_box_´ediùÜ_k”Ãl_size', 
šdex
=7,

93 
numb”
=9, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

94 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=3,

95 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

96 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

97 
İtiÚs
=
NÚe
),

98 
_desütÜ
.
	`F›ldDesütÜ
(

99 
Çme
='fœ¡_¡age_box_´ediùÜ_d•th', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.fœ¡_¡age_box_´ediùÜ_d•th', 
šdex
=8,

100 
numb”
=10, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

101 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=512,

102 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

103 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

104 
İtiÚs
=
NÚe
),

105 
_desütÜ
.
	`F›ldDesütÜ
(

106 
Çme
='fœ¡_¡age_mšib©ch_size', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.fœ¡_¡age_mšib©ch_size', 
šdex
=9,

107 
numb”
=11, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

108 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=256,

109 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

110 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

111 
İtiÚs
=
NÚe
),

112 
_desütÜ
.
	`F›ldDesütÜ
(

113 
Çme
='fœ¡_¡age_pos™ive_b®ªû_äaùiÚ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.fœ¡_¡age_pos™ive_b®ªû_äaùiÚ', 
šdex
=10,

114 
numb”
=12, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

115 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.5),

116 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

117 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

118 
İtiÚs
=
NÚe
),

119 
_desütÜ
.
	`F›ldDesütÜ
(

120 
Çme
='fœ¡_¡age_nms_scÜe_th»shŞd', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.fœ¡_¡age_nms_scÜe_th»shŞd', 
šdex
=11,

121 
numb”
=13, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

122 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0),

123 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

124 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

125 
İtiÚs
=
NÚe
),

126 
_desütÜ
.
	`F›ldDesütÜ
(

127 
Çme
='fœ¡_¡age_nms_iou_th»shŞd', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.fœ¡_¡age_nms_iou_th»shŞd', 
šdex
=12,

128 
numb”
=14, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

129 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.7),

130 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

131 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

132 
İtiÚs
=
NÚe
),

133 
_desütÜ
.
	`F›ldDesütÜ
(

134 
Çme
='fœ¡_¡age_max_´İo§ls', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.fœ¡_¡age_max_´İo§ls', 
šdex
=13,

135 
numb”
=15, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

136 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=300,

137 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

138 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

139 
İtiÚs
=
NÚe
),

140 
_desütÜ
.
	`F›ldDesütÜ
(

141 
Çme
='fœ¡_¡age_loÿliz©iÚ_loss_weight', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.fœ¡_¡age_loÿliz©iÚ_loss_weight', 
šdex
=14,

142 
numb”
=16, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

143 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1),

144 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

145 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

146 
İtiÚs
=
NÚe
),

147 
_desütÜ
.
	`F›ldDesütÜ
(

148 
Çme
='fœ¡_¡age_objeùÃss_loss_weight', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.fœ¡_¡age_objeùÃss_loss_weight', 
šdex
=15,

149 
numb”
=17, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

150 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1),

151 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

152 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

153 
İtiÚs
=
NÚe
),

154 
_desütÜ
.
	`F›ldDesütÜ
(

155 
Çme
='š™Ÿl_üİ_size', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.š™Ÿl_üİ_size', 
šdex
=16,

156 
numb”
=18, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

157 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=0,

158 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

159 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

160 
İtiÚs
=
NÚe
),

161 
_desütÜ
.
	`F›ldDesütÜ
(

162 
Çme
='maxpoŞ_k”Ãl_size', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.maxpoŞ_k”Ãl_size', 
šdex
=17,

163 
numb”
=19, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

164 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=0,

165 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

166 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

167 
İtiÚs
=
NÚe
),

168 
_desütÜ
.
	`F›ldDesütÜ
(

169 
Çme
='maxpoŞ_¡ride', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.maxpoŞ_¡ride', 
šdex
=18,

170 
numb”
=20, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

171 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=0,

172 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

173 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

174 
İtiÚs
=
NÚe
),

175 
_desütÜ
.
	`F›ldDesütÜ
(

176 
Çme
='£cÚd_¡age_box_´ediùÜ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.£cÚd_¡age_box_´ediùÜ', 
šdex
=19,

177 
numb”
=21, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

178 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

179 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

180 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

181 
İtiÚs
=
NÚe
),

182 
_desütÜ
.
	`F›ldDesütÜ
(

183 
Çme
='£cÚd_¡age_b©ch_size', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.£cÚd_¡age_b©ch_size', 
šdex
=20,

184 
numb”
=22, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

185 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=64,

186 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

187 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

188 
İtiÚs
=
NÚe
),

189 
_desütÜ
.
	`F›ldDesütÜ
(

190 
Çme
='£cÚd_¡age_b®ªû_äaùiÚ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.£cÚd_¡age_b®ªû_äaùiÚ', 
šdex
=21,

191 
numb”
=23, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

192 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.25),

193 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

194 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

195 
İtiÚs
=
NÚe
),

196 
_desütÜ
.
	`F›ldDesütÜ
(

197 
Çme
='£cÚd_¡age_po¡_´oûssšg', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.£cÚd_¡age_po¡_´oûssšg', 
šdex
=22,

198 
numb”
=24, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

199 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

200 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

201 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

202 
İtiÚs
=
NÚe
),

203 
_desütÜ
.
	`F›ldDesütÜ
(

204 
Çme
='£cÚd_¡age_loÿliz©iÚ_loss_weight', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.£cÚd_¡age_loÿliz©iÚ_loss_weight', 
šdex
=23,

205 
numb”
=25, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

206 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1),

207 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

208 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

209 
İtiÚs
=
NÚe
),

210 
_desütÜ
.
	`F›ldDesütÜ
(

211 
Çme
='£cÚd_¡age_şassifiÿtiÚ_loss_weight', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.£cÚd_¡age_şassifiÿtiÚ_loss_weight', 
šdex
=24,

212 
numb”
=26, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

213 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1),

214 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

215 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

216 
İtiÚs
=
NÚe
),

217 
_desütÜ
.
	`F›ldDesütÜ
(

218 
Çme
='h¬d_exam¶e_mš”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”Rún.h¬d_exam¶e_mš”', 
šdex
=25,

219 
numb”
=27, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

220 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

221 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

222 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

223 
İtiÚs
=
NÚe
),

225 
ex‹nsiÚs
=[

227 
Ã¡ed_ty³s
=[],

228 
’um_ty³s
=[

230 
İtiÚs
=
NÚe
,

231 
is_ex‹ndabË
=
F®£
,

232 
syÁax
='proto2',

233 
ex‹nsiÚ_¿nges
=[],

234 
Úeofs
=[

236 
£rŸlized_¡¬t
=337,

237 
£rŸlized_’d
=1653,

241 
_FASTERRCNNFEATUREEXTRACTOR
 = 
_desütÜ
.
	`DesütÜ
(

242 
Çme
='FasterRcnnFeatureExtractor',

243 
fuÎ_Çme
='object_detection.protos.FasterRcnnFeatureExtractor',

244 
f’ame
=
NÚe
,

245 
fe
=
DESCRIPTOR
,

246 
cÚššg_ty³
=
NÚe
,

247 
f›lds
=[

248 
_desütÜ
.
	`F›ldDesütÜ
(

249 
Çme
='ty³', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”RúnF—tu»ExŒaùÜ.ty³', 
šdex
=0,

250 
numb”
=1, 
ty³
=9, 
ıp_ty³
=9, 
Ïb–
=1,

251 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
	`_b
("").
	`decode
('utf-8'),

252 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

253 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

254 
İtiÚs
=
NÚe
),

255 
_desütÜ
.
	`F›ldDesütÜ
(

256 
Çme
='fœ¡_¡age_ã©u»s_¡ride', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Fa¡”RúnF—tu»ExŒaùÜ.fœ¡_¡age_ã©u»s_¡ride', 
šdex
=1,

257 
numb”
=2, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

258 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=16,

259 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

260 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

261 
İtiÚs
=
NÚe
),

263 
ex‹nsiÚs
=[

265 
Ã¡ed_ty³s
=[],

266 
’um_ty³s
=[

268 
İtiÚs
=
NÚe
,

269 
is_ex‹ndabË
=
F®£
,

270 
syÁax
='proto2',

271 
ex‹nsiÚ_¿nges
=[],

272 
Úeofs
=[

274 
£rŸlized_¡¬t
=1655,

275 
£rŸlized_’d
=1738,

278 
_FASTERRCNN
.
f›lds_by_Çme
['image_»siz”'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_image__»siz”__pb2
.
_IMAGERESIZER


279 
_FASTERRCNN
.
f›lds_by_Çme
['ã©u»_exŒaùÜ'].
mes§ge_ty³
 = 
_FASTERRCNNFEATUREEXTRACTOR


280 
_FASTERRCNN
.
f›lds_by_Çme
['fœ¡_¡age_ªchÜ_g’”©Ü'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ªchÜ__g’”©Ü__pb2
.
_ANCHORGENERATOR


281 
_FASTERRCNN
.
f›lds_by_Çme
['fœ¡_¡age_box_´ediùÜ_cÚv_hy³½¬ams'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_hy³½¬ams__pb2
.
_HYPERPARAMS


282 
_FASTERRCNN
.
f›lds_by_Çme
['£cÚd_¡age_box_´ediùÜ'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_box__´ediùÜ__pb2
.
_BOXPREDICTOR


283 
_FASTERRCNN
.
f›lds_by_Çme
['£cÚd_¡age_po¡_´oûssšg'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_po¡__´oûssšg__pb2
.
_POSTPROCESSING


284 
_FASTERRCNN
.
f›lds_by_Çme
['h¬d_exam¶e_mš”'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_los£s__pb2
.
_HARDEXAMPLEMINER


285 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Fa¡”Rún'] = 
_FASTERRCNN


286 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Fa¡”RúnF—tu»ExŒaùÜ'] = 
_FASTERRCNNFEATUREEXTRACTOR


287 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

289 
Fa¡”Rún
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Fa¡”Rún', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

290 
DESCRIPTOR
 = 
_FASTERRCNN
,

291 
__moduË__
 = 'object_detection.protos.faster_rcnn_pb2'

292 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Fa¡”Rún
)

294 
_sym_db
.
	$Regi¡”Mes§ge
(
Fa¡”Rún
)

296 
Fa¡”RúnF—tu»ExŒaùÜ
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Fa¡”RúnF—tu»ExŒaùÜ', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

297 
DESCRIPTOR
 = 
_FASTERRCNNFEATUREEXTRACTOR
,

298 
__moduË__
 = 'object_detection.protos.faster_rcnn_pb2'

299 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Fa¡”RúnF—tu»ExŒaùÜ
)

301 
_sym_db
.
	$Regi¡”Mes§ge
(
Fa¡”RúnF—tu»ExŒaùÜ
)

304 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/grid_anchor_generator_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
grid_ªchÜ_g’”©Ü
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

18 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

19 
Çme
='object_detection/protos/grid_anchor_generator.proto',

20 
·ckage
='object_detection.protos',

21 
syÁax
='proto2',

22 
£rŸlized_pb
=
	`_b
('\n3object_detection/protos/grid_anchor_generator.proto\x12\x17object_detection.protos\"\xcd\x01\n\x13GridAnchorGenerator\x12\x13\n\x06height\x18\x01 \x01(\x05:\x03\x32\x35\x36\x12\x12\n\x05width\x18\x02 \x01(\x05:\x03\x32\x35\x36\x12\x19\n\rheight_stride\x18\x03 \x01(\x05:\x02\x31\x36\x12\x18\n\x0cwidth_stride\x18\x04 \x01(\x05:\x02\x31\x36\x12\x18\n\rheight_offset\x18\x05 \x01(\x05:\x01\x30\x12\x17\n\x0cwidth_offset\x18\x06 \x01(\x05:\x01\x30\x12\x0e\n\x06scales\x18\x07 \x03(\x02\x12\x15\n\raspect_ratios\x18\x08 \x03(\x02')

28 
_GRIDANCHORGENERATOR
 = 
_desütÜ
.
	`DesütÜ
(

29 
Çme
='GridAnchorGenerator',

30 
fuÎ_Çme
='object_detection.protos.GridAnchorGenerator',

31 
f’ame
=
NÚe
,

32 
fe
=
DESCRIPTOR
,

33 
cÚššg_ty³
=
NÚe
,

34 
f›lds
=[

35 
_desütÜ
.
	`F›ldDesütÜ
(

36 
Çme
='height', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.GridAnchÜG’”©Ü.height', 
šdex
=0,

37 
numb”
=1, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

38 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=256,

39 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

40 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

41 
İtiÚs
=
NÚe
),

42 
_desütÜ
.
	`F›ldDesütÜ
(

43 
Çme
='width', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.GridAnchÜG’”©Ü.width', 
šdex
=1,

44 
numb”
=2, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

45 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=256,

46 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

47 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

48 
İtiÚs
=
NÚe
),

49 
_desütÜ
.
	`F›ldDesütÜ
(

50 
Çme
='height_¡ride', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.GridAnchÜG’”©Ü.height_¡ride', 
šdex
=2,

51 
numb”
=3, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

52 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=16,

53 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

54 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

55 
İtiÚs
=
NÚe
),

56 
_desütÜ
.
	`F›ldDesütÜ
(

57 
Çme
='width_¡ride', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.GridAnchÜG’”©Ü.width_¡ride', 
šdex
=3,

58 
numb”
=4, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

59 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=16,

60 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

61 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

62 
İtiÚs
=
NÚe
),

63 
_desütÜ
.
	`F›ldDesütÜ
(

64 
Çme
='height_off£t', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.GridAnchÜG’”©Ü.height_off£t', 
šdex
=4,

65 
numb”
=5, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

66 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=0,

67 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

68 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

69 
İtiÚs
=
NÚe
),

70 
_desütÜ
.
	`F›ldDesütÜ
(

71 
Çme
='width_off£t', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.GridAnchÜG’”©Ü.width_off£t', 
šdex
=5,

72 
numb”
=6, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

73 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=0,

74 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

75 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

76 
İtiÚs
=
NÚe
),

77 
_desütÜ
.
	`F›ldDesütÜ
(

78 
Çme
='sÿËs', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.GridAnchÜG’”©Ü.sÿËs', 
šdex
=6,

79 
numb”
=7, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=3,

80 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=[],

81 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

82 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

83 
İtiÚs
=
NÚe
),

84 
_desütÜ
.
	`F›ldDesütÜ
(

85 
Çme
='a¥eù_¿tios', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.GridAnchÜG’”©Ü.a¥eù_¿tios', 
šdex
=7,

86 
numb”
=8, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=3,

87 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=[],

88 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

89 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

90 
İtiÚs
=
NÚe
),

92 
ex‹nsiÚs
=[

94 
Ã¡ed_ty³s
=[],

95 
’um_ty³s
=[

97 
İtiÚs
=
NÚe
,

98 
is_ex‹ndabË
=
F®£
,

99 
syÁax
='proto2',

100 
ex‹nsiÚ_¿nges
=[],

101 
Úeofs
=[

103 
£rŸlized_¡¬t
=81,

104 
£rŸlized_’d
=286,

107 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['GridAnchÜG’”©Ü'] = 
_GRIDANCHORGENERATOR


108 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

110 
GridAnchÜG’”©Ü
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('GridAnchÜG’”©Ü', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

111 
DESCRIPTOR
 = 
_GRIDANCHORGENERATOR
,

112 
__moduË__
 = 'object_detection.protos.grid_anchor_generator_pb2'

113 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
GridAnchÜG’”©Ü
)

115 
_sym_db
.
	$Regi¡”Mes§ge
(
GridAnchÜG’”©Ü
)

118 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/hyperparams_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
hy³½¬ams
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

18 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

19 
Çme
='object_detection/protos/hyperparams.proto',

20 
·ckage
='object_detection.protos',

21 
syÁax
='proto2',

22 
£rŸlized_pb
=
	`_b
('\n)object_detection/protos/hyperparams.proto\x12\x17object_detection.protos\"\x87\x03\n\x0bHyperparams\x12\x39\n\x02op\x18\x01 \x01(\x0e\x32\'.object_detection.protos.Hyperparams.Op:\x04\x43ONV\x12\x39\n\x0bregularizer\x18\x02 \x01(\x0b\x32$.object_detection.protos.Regularizer\x12\x39\n\x0binitializer\x18\x03 \x01(\x0b\x32$.object_detection.protos.Initializer\x12I\n\nactivation\x18\x04 \x01(\x0e\x32/.object_detection.protos.Hyperparams.Activation:\x04RELU\x12\x36\n\nbatch_norm\x18\x05 \x01(\x0b\x32\".object_detection.protos.BatchNorm\"\x16\n\x02Op\x12\x08\n\x04\x43ONV\x10\x01\x12\x06\n\x02\x46\x43\x10\x02\",\n\nActivation\x12\x08\n\x04NONE\x10\x00\x12\x08\n\x04RELU\x10\x01\x12\n\n\x06RELU_6\x10\x02\"\xa6\x01\n\x0bRegularizer\x12@\n\x0el1_regularizer\x18\x01 \x01(\x0b\x32&.object_detection.protos.L1RegularizerH\x00\x12@\n\x0el2_regularizer\x18\x02 \x01(\x0b\x32&.object_detection.protos.L2RegularizerH\x00\x42\x13\n\x11regularizer_oneof\"\"\n\rL1Regularizer\x12\x11\n\x06weight\x18\x01 \x01(\x02:\x01\x31\"\"\n\rL2Regularizer\x12\x11\n\x06weight\x18\x01 \x01(\x02:\x01\x31\"\xdc\x01\n\x0bInitializer\x12[\n\x1ctruncated_normal_initializer\x18\x01 \x01(\x0b\x32\x33.object_detection.protos.TruncatedNormalInitializerH\x00\x12[\n\x1cvariance_scaling_initializer\x18\x02 \x01(\x0b\x32\x33.object_detection.protos.VarianceScalingInitializerH\x00\x42\x13\n\x11initializer_oneof\"@\n\x1aTruncatedNormalInitializer\x12\x0f\n\x04mean\x18\x01 \x01(\x02:\x01\x30\x12\x11\n\x06stddev\x18\x02 \x01(\x02:\x01\x31\"\xc5\x01\n\x1aVarianceScalingInitializer\x12\x11\n\x06\x66\x61\x63tor\x18\x01 \x01(\x02:\x01\x32\x12\x16\n\x07uniform\x18\x02 \x01(\x08:\x05\x66\x61lse\x12N\n\x04mode\x18\x03 \x01(\x0e\x32\x38.object_detection.protos.VarianceScalingInitializer.Mode:\x06\x46\x41N_IN\",\n\x04Mode\x12\n\n\x06\x46\x41N_IN\x10\x00\x12\x0b\n\x07\x46\x41N_OUT\x10\x01\x12\x0b\n\x07\x46\x41N_AVG\x10\x02\"z\n\tBatchNorm\x12\x14\n\x05\x64\x65\x63\x61y\x18\x01 \x01(\x02:\x05\x30.999\x12\x14\n\x06\x63\x65nter\x18\x02 \x01(\x08:\x04true\x12\x14\n\x05scale\x18\x03 \x01(\x08:\x05\x66\x61lse\x12\x16\n\x07\x65psilon\x18\x04 \x01(\x02:\x05\x30.001\x12\x13\n\x05train\x18\x05 \x01(\x08:\x04true')

27 
_HYPERPARAMS_OP
 = 
_desütÜ
.
	`EnumDesütÜ
(

28 
Çme
='Op',

29 
fuÎ_Çme
='object_detection.protos.Hyperparams.Op',

30 
f’ame
=
NÚe
,

31 
fe
=
DESCRIPTOR
,

32 
v®ues
=[

33 
_desütÜ
.
	`EnumV®ueDesütÜ
(

34 
Çme
='CONV', 
šdex
=0, 
numb”
=1,

35 
İtiÚs
=
NÚe
,

36 
ty³
=
NÚe
),

37 
_desütÜ
.
	`EnumV®ueDesütÜ
(

38 
Çme
='FC', 
šdex
=1, 
numb”
=2,

39 
İtiÚs
=
NÚe
,

40 
ty³
=
NÚe
),

42 
cÚššg_ty³
=
NÚe
,

43 
İtiÚs
=
NÚe
,

44 
£rŸlized_¡¬t
=394,

45 
£rŸlized_’d
=416,

47 
_sym_db
.
	$Regi¡”EnumDesütÜ
(
_HYPERPARAMS_OP
)

49 
_HYPERPARAMS_ACTIVATION
 = 
_desütÜ
.
	`EnumDesütÜ
(

50 
Çme
='Activation',

51 
fuÎ_Çme
='object_detection.protos.Hyperparams.Activation',

52 
f’ame
=
NÚe
,

53 
fe
=
DESCRIPTOR
,

54 
v®ues
=[

55 
_desütÜ
.
	`EnumV®ueDesütÜ
(

56 
Çme
='NONE', 
šdex
=0, 
numb”
=0,

57 
İtiÚs
=
NÚe
,

58 
ty³
=
NÚe
),

59 
_desütÜ
.
	`EnumV®ueDesütÜ
(

60 
Çme
='RELU', 
šdex
=1, 
numb”
=1,

61 
İtiÚs
=
NÚe
,

62 
ty³
=
NÚe
),

63 
_desütÜ
.
	`EnumV®ueDesütÜ
(

64 
Çme
='RELU_6', 
šdex
=2, 
numb”
=2,

65 
İtiÚs
=
NÚe
,

66 
ty³
=
NÚe
),

68 
cÚššg_ty³
=
NÚe
,

69 
İtiÚs
=
NÚe
,

70 
£rŸlized_¡¬t
=418,

71 
£rŸlized_’d
=462,

73 
_sym_db
.
	$Regi¡”EnumDesütÜ
(
_HYPERPARAMS_ACTIVATION
)

75 
_VARIANCESCALINGINITIALIZER_MODE
 = 
_desütÜ
.
	`EnumDesütÜ
(

76 
Çme
='Mode',

77 
fuÎ_Çme
='object_detection.protos.VarianceScalingInitializer.Mode',

78 
f’ame
=
NÚe
,

79 
fe
=
DESCRIPTOR
,

80 
v®ues
=[

81 
_desütÜ
.
	`EnumV®ueDesütÜ
(

82 
Çme
='FAN_IN', 
šdex
=0, 
numb”
=0,

83 
İtiÚs
=
NÚe
,

84 
ty³
=
NÚe
),

85 
_desütÜ
.
	`EnumV®ueDesütÜ
(

86 
Çme
='FAN_OUT', 
šdex
=1, 
numb”
=1,

87 
İtiÚs
=
NÚe
,

88 
ty³
=
NÚe
),

89 
_desütÜ
.
	`EnumV®ueDesütÜ
(

90 
Çme
='FAN_AVG', 
šdex
=2, 
numb”
=2,

91 
İtiÚs
=
NÚe
,

92 
ty³
=
NÚe
),

94 
cÚššg_ty³
=
NÚe
,

95 
İtiÚs
=
NÚe
,

96 
£rŸlized_¡¬t
=1148,

97 
£rŸlized_’d
=1192,

99 
_sym_db
.
	$Regi¡”EnumDesütÜ
(
_VARIANCESCALINGINITIALIZER_MODE
)

102 
_HYPERPARAMS
 = 
_desütÜ
.
	`DesütÜ
(

103 
Çme
='Hyperparams',

104 
fuÎ_Çme
='object_detection.protos.Hyperparams',

105 
f’ame
=
NÚe
,

106 
fe
=
DESCRIPTOR
,

107 
cÚššg_ty³
=
NÚe
,

108 
f›lds
=[

109 
_desütÜ
.
	`F›ldDesütÜ
(

110 
Çme
='İ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Hy³½¬ams.İ', 
šdex
=0,

111 
numb”
=1, 
ty³
=14, 
ıp_ty³
=8, 
Ïb–
=1,

112 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=1,

113 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

114 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

115 
İtiÚs
=
NÚe
),

116 
_desütÜ
.
	`F›ldDesütÜ
(

117 
Çme
='»guÏriz”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Hy³½¬ams.»guÏriz”', 
šdex
=1,

118 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

119 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

120 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

121 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

122 
İtiÚs
=
NÚe
),

123 
_desütÜ
.
	`F›ldDesütÜ
(

124 
Çme
='š™Ÿliz”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Hy³½¬ams.š™Ÿliz”', 
šdex
=2,

125 
numb”
=3, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

126 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

127 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

128 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

129 
İtiÚs
=
NÚe
),

130 
_desütÜ
.
	`F›ldDesütÜ
(

131 
Çme
='aùiv©iÚ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Hy³½¬ams.aùiv©iÚ', 
šdex
=3,

132 
numb”
=4, 
ty³
=14, 
ıp_ty³
=8, 
Ïb–
=1,

133 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=1,

134 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

135 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

136 
İtiÚs
=
NÚe
),

137 
_desütÜ
.
	`F›ldDesütÜ
(

138 
Çme
='b©ch_nÜm', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Hy³½¬ams.b©ch_nÜm', 
šdex
=4,

139 
numb”
=5, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

140 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

141 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

142 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

143 
İtiÚs
=
NÚe
),

145 
ex‹nsiÚs
=[

147 
Ã¡ed_ty³s
=[],

148 
’um_ty³s
=[

149 
_HYPERPARAMS_OP
,

150 
_HYPERPARAMS_ACTIVATION
,

152 
İtiÚs
=
NÚe
,

153 
is_ex‹ndabË
=
F®£
,

154 
syÁax
='proto2',

155 
ex‹nsiÚ_¿nges
=[],

156 
Úeofs
=[

158 
£rŸlized_¡¬t
=71,

159 
£rŸlized_’d
=462,

163 
_REGULARIZER
 = 
_desütÜ
.
	`DesütÜ
(

164 
Çme
='Regularizer',

165 
fuÎ_Çme
='object_detection.protos.Regularizer',

166 
f’ame
=
NÚe
,

167 
fe
=
DESCRIPTOR
,

168 
cÚššg_ty³
=
NÚe
,

169 
f›lds
=[

170 
_desütÜ
.
	`F›ldDesütÜ
(

171 
Çme
='l1_»guÏriz”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.ReguÏriz”.l1_»guÏriz”', 
šdex
=0,

172 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

173 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

174 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

175 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

176 
İtiÚs
=
NÚe
),

177 
_desütÜ
.
	`F›ldDesütÜ
(

178 
Çme
='l2_»guÏriz”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.ReguÏriz”.l2_»guÏriz”', 
šdex
=1,

179 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

180 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

181 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

182 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

183 
İtiÚs
=
NÚe
),

185 
ex‹nsiÚs
=[

187 
Ã¡ed_ty³s
=[],

188 
’um_ty³s
=[

190 
İtiÚs
=
NÚe
,

191 
is_ex‹ndabË
=
F®£
,

192 
syÁax
='proto2',

193 
ex‹nsiÚ_¿nges
=[],

194 
Úeofs
=[

195 
_desütÜ
.
	`OÃofDesütÜ
(

196 
Çme
='»guÏriz”_Úeof', 
fuÎ_Çme
='object_detection.protos.Regularizer.regularizer_oneof',

197 
šdex
=0, 
cÚššg_ty³
=
NÚe
, 
f›lds
=[]),

199 
£rŸlized_¡¬t
=465,

200 
£rŸlized_’d
=631,

204 
_L1REGULARIZER
 = 
_desütÜ
.
	`DesütÜ
(

205 
Çme
='L1Regularizer',

206 
fuÎ_Çme
='object_detection.protos.L1Regularizer',

207 
f’ame
=
NÚe
,

208 
fe
=
DESCRIPTOR
,

209 
cÚššg_ty³
=
NÚe
,

210 
f›lds
=[

211 
_desütÜ
.
	`F›ldDesütÜ
(

212 
Çme
='weight', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.L1ReguÏriz”.weight', 
šdex
=0,

213 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

214 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1),

215 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

216 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

217 
İtiÚs
=
NÚe
),

219 
ex‹nsiÚs
=[

221 
Ã¡ed_ty³s
=[],

222 
’um_ty³s
=[

224 
İtiÚs
=
NÚe
,

225 
is_ex‹ndabË
=
F®£
,

226 
syÁax
='proto2',

227 
ex‹nsiÚ_¿nges
=[],

228 
Úeofs
=[

230 
£rŸlized_¡¬t
=633,

231 
£rŸlized_’d
=667,

235 
_L2REGULARIZER
 = 
_desütÜ
.
	`DesütÜ
(

236 
Çme
='L2Regularizer',

237 
fuÎ_Çme
='object_detection.protos.L2Regularizer',

238 
f’ame
=
NÚe
,

239 
fe
=
DESCRIPTOR
,

240 
cÚššg_ty³
=
NÚe
,

241 
f›lds
=[

242 
_desütÜ
.
	`F›ldDesütÜ
(

243 
Çme
='weight', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.L2ReguÏriz”.weight', 
šdex
=0,

244 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

245 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1),

246 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

247 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

248 
İtiÚs
=
NÚe
),

250 
ex‹nsiÚs
=[

252 
Ã¡ed_ty³s
=[],

253 
’um_ty³s
=[

255 
İtiÚs
=
NÚe
,

256 
is_ex‹ndabË
=
F®£
,

257 
syÁax
='proto2',

258 
ex‹nsiÚ_¿nges
=[],

259 
Úeofs
=[

261 
£rŸlized_¡¬t
=669,

262 
£rŸlized_’d
=703,

266 
_INITIALIZER
 = 
_desütÜ
.
	`DesütÜ
(

267 
Çme
='Initializer',

268 
fuÎ_Çme
='object_detection.protos.Initializer',

269 
f’ame
=
NÚe
,

270 
fe
=
DESCRIPTOR
,

271 
cÚššg_ty³
=
NÚe
,

272 
f›lds
=[

273 
_desütÜ
.
	`F›ldDesütÜ
(

274 
Çme
='Œunÿ‹d_nÜm®_š™Ÿliz”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.In™Ÿliz”.Œunÿ‹d_nÜm®_š™Ÿliz”', 
šdex
=0,

275 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

276 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

277 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

278 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

279 
İtiÚs
=
NÚe
),

280 
_desütÜ
.
	`F›ldDesütÜ
(

281 
Çme
='v¬Ÿnû_sÿlšg_š™Ÿliz”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.In™Ÿliz”.v¬Ÿnû_sÿlšg_š™Ÿliz”', 
šdex
=1,

282 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

283 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

284 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

285 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

286 
İtiÚs
=
NÚe
),

288 
ex‹nsiÚs
=[

290 
Ã¡ed_ty³s
=[],

291 
’um_ty³s
=[

293 
İtiÚs
=
NÚe
,

294 
is_ex‹ndabË
=
F®£
,

295 
syÁax
='proto2',

296 
ex‹nsiÚ_¿nges
=[],

297 
Úeofs
=[

298 
_desütÜ
.
	`OÃofDesütÜ
(

299 
Çme
='š™Ÿliz”_Úeof', 
fuÎ_Çme
='object_detection.protos.Initializer.initializer_oneof',

300 
šdex
=0, 
cÚššg_ty³
=
NÚe
, 
f›lds
=[]),

302 
£rŸlized_¡¬t
=706,

303 
£rŸlized_’d
=926,

307 
_TRUNCATEDNORMALINITIALIZER
 = 
_desütÜ
.
	`DesütÜ
(

308 
Çme
='TruncatedNormalInitializer',

309 
fuÎ_Çme
='object_detection.protos.TruncatedNormalInitializer',

310 
f’ame
=
NÚe
,

311 
fe
=
DESCRIPTOR
,

312 
cÚššg_ty³
=
NÚe
,

313 
f›lds
=[

314 
_desütÜ
.
	`F›ldDesütÜ
(

315 
Çme
='m—n', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Trunÿ‹dNÜm®In™Ÿliz”.m—n', 
šdex
=0,

316 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

317 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0),

318 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

319 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

320 
İtiÚs
=
NÚe
),

321 
_desütÜ
.
	`F›ldDesütÜ
(

322 
Çme
='¡ddev', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Trunÿ‹dNÜm®In™Ÿliz”.¡ddev', 
šdex
=1,

323 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

324 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1),

325 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

326 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

327 
İtiÚs
=
NÚe
),

329 
ex‹nsiÚs
=[

331 
Ã¡ed_ty³s
=[],

332 
’um_ty³s
=[

334 
İtiÚs
=
NÚe
,

335 
is_ex‹ndabË
=
F®£
,

336 
syÁax
='proto2',

337 
ex‹nsiÚ_¿nges
=[],

338 
Úeofs
=[

340 
£rŸlized_¡¬t
=928,

341 
£rŸlized_’d
=992,

345 
_VARIANCESCALINGINITIALIZER
 = 
_desütÜ
.
	`DesütÜ
(

346 
Çme
='VarianceScalingInitializer',

347 
fuÎ_Çme
='object_detection.protos.VarianceScalingInitializer',

348 
f’ame
=
NÚe
,

349 
fe
=
DESCRIPTOR
,

350 
cÚššg_ty³
=
NÚe
,

351 
f›lds
=[

352 
_desütÜ
.
	`F›ldDesütÜ
(

353 
Çme
='çùÜ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.V¬ŸnûSÿlšgIn™Ÿliz”.çùÜ', 
šdex
=0,

354 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

355 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(2),

356 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

357 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

358 
İtiÚs
=
NÚe
),

359 
_desütÜ
.
	`F›ldDesütÜ
(

360 
Çme
='unifÜm', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.V¬ŸnûSÿlšgIn™Ÿliz”.unifÜm', 
šdex
=1,

361 
numb”
=2, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

362 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

363 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

364 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

365 
İtiÚs
=
NÚe
),

366 
_desütÜ
.
	`F›ldDesütÜ
(

367 
Çme
='mode', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.V¬ŸnûSÿlšgIn™Ÿliz”.mode', 
šdex
=2,

368 
numb”
=3, 
ty³
=14, 
ıp_ty³
=8, 
Ïb–
=1,

369 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=0,

370 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

371 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

372 
İtiÚs
=
NÚe
),

374 
ex‹nsiÚs
=[

376 
Ã¡ed_ty³s
=[],

377 
’um_ty³s
=[

378 
_VARIANCESCALINGINITIALIZER_MODE
,

380 
İtiÚs
=
NÚe
,

381 
is_ex‹ndabË
=
F®£
,

382 
syÁax
='proto2',

383 
ex‹nsiÚ_¿nges
=[],

384 
Úeofs
=[

386 
£rŸlized_¡¬t
=995,

387 
£rŸlized_’d
=1192,

391 
_BATCHNORM
 = 
_desütÜ
.
	`DesütÜ
(

392 
Çme
='BatchNorm',

393 
fuÎ_Çme
='object_detection.protos.BatchNorm',

394 
f’ame
=
NÚe
,

395 
fe
=
DESCRIPTOR
,

396 
cÚššg_ty³
=
NÚe
,

397 
f›lds
=[

398 
_desütÜ
.
	`F›ldDesütÜ
(

399 
Çme
='deÿy', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.B©chNÜm.deÿy', 
šdex
=0,

400 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

401 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.999),

402 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

403 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

404 
İtiÚs
=
NÚe
),

405 
_desütÜ
.
	`F›ldDesütÜ
(

406 
Çme
='ûÁ”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.B©chNÜm.ûÁ”', 
šdex
=1,

407 
numb”
=2, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

408 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=True,

409 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

410 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

411 
İtiÚs
=
NÚe
),

412 
_desütÜ
.
	`F›ldDesütÜ
(

413 
Çme
='sÿË', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.B©chNÜm.sÿË', 
šdex
=2,

414 
numb”
=3, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

415 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

416 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

417 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

418 
İtiÚs
=
NÚe
),

419 
_desütÜ
.
	`F›ldDesütÜ
(

420 
Çme
='•sÚ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.B©chNÜm.•sÚ', 
šdex
=3,

421 
numb”
=4, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

422 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.001),

423 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

424 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

425 
İtiÚs
=
NÚe
),

426 
_desütÜ
.
	`F›ldDesütÜ
(

427 
Çme
='Œaš', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.B©chNÜm.Œaš', 
šdex
=4,

428 
numb”
=5, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

429 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=True,

430 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

431 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

432 
İtiÚs
=
NÚe
),

434 
ex‹nsiÚs
=[

436 
Ã¡ed_ty³s
=[],

437 
’um_ty³s
=[

439 
İtiÚs
=
NÚe
,

440 
is_ex‹ndabË
=
F®£
,

441 
syÁax
='proto2',

442 
ex‹nsiÚ_¿nges
=[],

443 
Úeofs
=[

445 
£rŸlized_¡¬t
=1194,

446 
£rŸlized_’d
=1316,

449 
_HYPERPARAMS
.
f›lds_by_Çme
['İ'].
’um_ty³
 = 
_HYPERPARAMS_OP


450 
_HYPERPARAMS
.
f›lds_by_Çme
['»guÏriz”'].
mes§ge_ty³
 = 
_REGULARIZER


451 
_HYPERPARAMS
.
f›lds_by_Çme
['š™Ÿliz”'].
mes§ge_ty³
 = 
_INITIALIZER


452 
_HYPERPARAMS
.
f›lds_by_Çme
['aùiv©iÚ'].
’um_ty³
 = 
_HYPERPARAMS_ACTIVATION


453 
_HYPERPARAMS
.
f›lds_by_Çme
['b©ch_nÜm'].
mes§ge_ty³
 = 
_BATCHNORM


454 
_HYPERPARAMS_OP
.
cÚššg_ty³
 = 
_HYPERPARAMS


455 
_HYPERPARAMS_ACTIVATION
.
cÚššg_ty³
 = 
_HYPERPARAMS


456 
_REGULARIZER
.
f›lds_by_Çme
['l1_»guÏriz”'].
mes§ge_ty³
 = 
_L1REGULARIZER


457 
_REGULARIZER
.
f›lds_by_Çme
['l2_»guÏriz”'].
mes§ge_ty³
 = 
_L2REGULARIZER


458 
_REGULARIZER
.
Úeofs_by_Çme
['»guÏriz”_Úeof'].
f›lds
.
	`­³nd
(

459 
_REGULARIZER
.
f›lds_by_Çme
['l1_regularizer'])

460 
_REGULARIZER
.
f›lds_by_Çme
['l1_»guÏriz”'].
cÚššg_Úeof
 = _REGULARIZER.
Úeofs_by_Çme
['regularizer_oneof']

461 
_REGULARIZER
.
Úeofs_by_Çme
['»guÏriz”_Úeof'].
f›lds
.
	`­³nd
(

462 
_REGULARIZER
.
f›lds_by_Çme
['l2_regularizer'])

463 
_REGULARIZER
.
f›lds_by_Çme
['l2_»guÏriz”'].
cÚššg_Úeof
 = _REGULARIZER.
Úeofs_by_Çme
['regularizer_oneof']

464 
_INITIALIZER
.
f›lds_by_Çme
['Œunÿ‹d_nÜm®_š™Ÿliz”'].
mes§ge_ty³
 = 
_TRUNCATEDNORMALINITIALIZER


465 
_INITIALIZER
.
f›lds_by_Çme
['v¬Ÿnû_sÿlšg_š™Ÿliz”'].
mes§ge_ty³
 = 
_VARIANCESCALINGINITIALIZER


466 
_INITIALIZER
.
Úeofs_by_Çme
['š™Ÿliz”_Úeof'].
f›lds
.
	`­³nd
(

467 
_INITIALIZER
.
f›lds_by_Çme
['truncated_normal_initializer'])

468 
_INITIALIZER
.
f›lds_by_Çme
['Œunÿ‹d_nÜm®_š™Ÿliz”'].
cÚššg_Úeof
 = _INITIALIZER.
Úeofs_by_Çme
['initializer_oneof']

469 
_INITIALIZER
.
Úeofs_by_Çme
['š™Ÿliz”_Úeof'].
f›lds
.
	`­³nd
(

470 
_INITIALIZER
.
f›lds_by_Çme
['variance_scaling_initializer'])

471 
_INITIALIZER
.
f›lds_by_Çme
['v¬Ÿnû_sÿlšg_š™Ÿliz”'].
cÚššg_Úeof
 = _INITIALIZER.
Úeofs_by_Çme
['initializer_oneof']

472 
_VARIANCESCALINGINITIALIZER
.
f›lds_by_Çme
['mode'].
’um_ty³
 = 
_VARIANCESCALINGINITIALIZER_MODE


473 
_VARIANCESCALINGINITIALIZER_MODE
.
cÚššg_ty³
 = 
_VARIANCESCALINGINITIALIZER


474 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Hy³½¬ams'] = 
_HYPERPARAMS


475 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['ReguÏriz”'] = 
_REGULARIZER


476 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['L1ReguÏriz”'] = 
_L1REGULARIZER


477 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['L2ReguÏriz”'] = 
_L2REGULARIZER


478 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['In™Ÿliz”'] = 
_INITIALIZER


479 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Trunÿ‹dNÜm®In™Ÿliz”'] = 
_TRUNCATEDNORMALINITIALIZER


480 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['V¬ŸnûSÿlšgIn™Ÿliz”'] = 
_VARIANCESCALINGINITIALIZER


481 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['B©chNÜm'] = 
_BATCHNORM


482 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

484 
Hy³½¬ams
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Hy³½¬ams', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

485 
DESCRIPTOR
 = 
_HYPERPARAMS
,

486 
__moduË__
 = 'object_detection.protos.hyperparams_pb2'

487 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Hy³½¬ams
)

489 
_sym_db
.
	$Regi¡”Mes§ge
(
Hy³½¬ams
)

491 
ReguÏriz”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('ReguÏriz”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

492 
DESCRIPTOR
 = 
_REGULARIZER
,

493 
__moduË__
 = 'object_detection.protos.hyperparams_pb2'

494 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
ReguÏriz”
)

496 
_sym_db
.
	$Regi¡”Mes§ge
(
ReguÏriz”
)

498 
L1ReguÏriz”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('L1ReguÏriz”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

499 
DESCRIPTOR
 = 
_L1REGULARIZER
,

500 
__moduË__
 = 'object_detection.protos.hyperparams_pb2'

501 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
L1ReguÏriz”
)

503 
_sym_db
.
	$Regi¡”Mes§ge
(
L1ReguÏriz”
)

505 
L2ReguÏriz”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('L2ReguÏriz”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

506 
DESCRIPTOR
 = 
_L2REGULARIZER
,

507 
__moduË__
 = 'object_detection.protos.hyperparams_pb2'

508 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
L2ReguÏriz”
)

510 
_sym_db
.
	$Regi¡”Mes§ge
(
L2ReguÏriz”
)

512 
In™Ÿliz”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('In™Ÿliz”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

513 
DESCRIPTOR
 = 
_INITIALIZER
,

514 
__moduË__
 = 'object_detection.protos.hyperparams_pb2'

515 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
In™Ÿliz”
)

517 
_sym_db
.
	$Regi¡”Mes§ge
(
In™Ÿliz”
)

519 
Trunÿ‹dNÜm®In™Ÿliz”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Trunÿ‹dNÜm®In™Ÿliz”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

520 
DESCRIPTOR
 = 
_TRUNCATEDNORMALINITIALIZER
,

521 
__moduË__
 = 'object_detection.protos.hyperparams_pb2'

522 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Trunÿ‹dNÜm®In™Ÿliz”
)

524 
_sym_db
.
	$Regi¡”Mes§ge
(
Trunÿ‹dNÜm®In™Ÿliz”
)

526 
V¬ŸnûSÿlšgIn™Ÿliz”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('V¬ŸnûSÿlšgIn™Ÿliz”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

527 
DESCRIPTOR
 = 
_VARIANCESCALINGINITIALIZER
,

528 
__moduË__
 = 'object_detection.protos.hyperparams_pb2'

529 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
V¬ŸnûSÿlšgIn™Ÿliz”
)

531 
_sym_db
.
	$Regi¡”Mes§ge
(
V¬ŸnûSÿlšgIn™Ÿliz”
)

533 
B©chNÜm
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('B©chNÜm', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

534 
DESCRIPTOR
 = 
_BATCHNORM
,

535 
__moduË__
 = 'object_detection.protos.hyperparams_pb2'

536 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
B©chNÜm
)

538 
_sym_db
.
	$Regi¡”Mes§ge
(
B©chNÜm
)

541 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/image_resizer_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
image_»siz”
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

18 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

19 
Çme
='object_detection/protos/image_resizer.proto',

20 
·ckage
='object_detection.protos',

21 
syÁax
='proto2',

22 
£rŸlized_pb
=
	`_b
('\n+object_detection/protos/image_resizer.proto\x12\x17object_detection.protos\"\xc6\x01\n\x0cImageResizer\x12T\n\x19keep_aspect_ratio_resizer\x18\x01 \x01(\x0b\x32/.object_detection.protos.KeepAspectRatioResizerH\x00\x12I\n\x13\x66ixed_shape_resizer\x18\x02 \x01(\x0b\x32*.object_detection.protos.FixedShapeResizerH\x00\x42\x15\n\x13image_resizer_oneof\"Q\n\x16KeepAspectRatioResizer\x12\x1a\n\rmin_dimension\x18\x01 \x01(\x05:\x03\x36\x30\x30\x12\x1b\n\rmax_dimension\x18\x02 \x01(\x05:\x04\x31\x30\x32\x34\"<\n\x11\x46ixedShapeResizer\x12\x13\n\x06height\x18\x01 \x01(\x05:\x03\x33\x30\x30\x12\x12\n\x05width\x18\x02 \x01(\x05:\x03\x33\x30\x30')

28 
_IMAGERESIZER
 = 
_desütÜ
.
	`DesütÜ
(

29 
Çme
='ImageResizer',

30 
fuÎ_Çme
='object_detection.protos.ImageResizer',

31 
f’ame
=
NÚe
,

32 
fe
=
DESCRIPTOR
,

33 
cÚššg_ty³
=
NÚe
,

34 
f›lds
=[

35 
_desütÜ
.
	`F›ldDesütÜ
(

36 
Çme
='k“p_a¥eù_¿tio_»siz”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.ImageResiz”.k“p_a¥eù_¿tio_»siz”', 
šdex
=0,

37 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

38 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

39 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

40 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

41 
İtiÚs
=
NÚe
),

42 
_desütÜ
.
	`F›ldDesütÜ
(

43 
Çme
='fixed_sh­e_»siz”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.ImageResiz”.fixed_sh­e_»siz”', 
šdex
=1,

44 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

45 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

46 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

47 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

48 
İtiÚs
=
NÚe
),

50 
ex‹nsiÚs
=[

52 
Ã¡ed_ty³s
=[],

53 
’um_ty³s
=[

55 
İtiÚs
=
NÚe
,

56 
is_ex‹ndabË
=
F®£
,

57 
syÁax
='proto2',

58 
ex‹nsiÚ_¿nges
=[],

59 
Úeofs
=[

60 
_desütÜ
.
	`OÃofDesütÜ
(

61 
Çme
='image_»siz”_Úeof', 
fuÎ_Çme
='object_detection.protos.ImageResizer.image_resizer_oneof',

62 
šdex
=0, 
cÚššg_ty³
=
NÚe
, 
f›lds
=[]),

64 
£rŸlized_¡¬t
=73,

65 
£rŸlized_’d
=271,

69 
_KEEPASPECTRATIORESIZER
 = 
_desütÜ
.
	`DesütÜ
(

70 
Çme
='KeepAspectRatioResizer',

71 
fuÎ_Çme
='object_detection.protos.KeepAspectRatioResizer',

72 
f’ame
=
NÚe
,

73 
fe
=
DESCRIPTOR
,

74 
cÚššg_ty³
=
NÚe
,

75 
f›lds
=[

76 
_desütÜ
.
	`F›ldDesütÜ
(

77 
Çme
='mš_dim’siÚ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.K“pA¥eùR©ioResiz”.mš_dim’siÚ', 
šdex
=0,

78 
numb”
=1, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

79 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=600,

80 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

81 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

82 
İtiÚs
=
NÚe
),

83 
_desütÜ
.
	`F›ldDesütÜ
(

84 
Çme
='max_dim’siÚ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.K“pA¥eùR©ioResiz”.max_dim’siÚ', 
šdex
=1,

85 
numb”
=2, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

86 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=1024,

87 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

88 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

89 
İtiÚs
=
NÚe
),

91 
ex‹nsiÚs
=[

93 
Ã¡ed_ty³s
=[],

94 
’um_ty³s
=[

96 
İtiÚs
=
NÚe
,

97 
is_ex‹ndabË
=
F®£
,

98 
syÁax
='proto2',

99 
ex‹nsiÚ_¿nges
=[],

100 
Úeofs
=[

102 
£rŸlized_¡¬t
=273,

103 
£rŸlized_’d
=354,

107 
_FIXEDSHAPERESIZER
 = 
_desütÜ
.
	`DesütÜ
(

108 
Çme
='FixedShapeResizer',

109 
fuÎ_Çme
='object_detection.protos.FixedShapeResizer',

110 
f’ame
=
NÚe
,

111 
fe
=
DESCRIPTOR
,

112 
cÚššg_ty³
=
NÚe
,

113 
f›lds
=[

114 
_desütÜ
.
	`F›ldDesütÜ
(

115 
Çme
='height', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.FixedSh­eResiz”.height', 
šdex
=0,

116 
numb”
=1, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

117 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=300,

118 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

119 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

120 
İtiÚs
=
NÚe
),

121 
_desütÜ
.
	`F›ldDesütÜ
(

122 
Çme
='width', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.FixedSh­eResiz”.width', 
šdex
=1,

123 
numb”
=2, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

124 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=300,

125 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

126 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

127 
İtiÚs
=
NÚe
),

129 
ex‹nsiÚs
=[

131 
Ã¡ed_ty³s
=[],

132 
’um_ty³s
=[

134 
İtiÚs
=
NÚe
,

135 
is_ex‹ndabË
=
F®£
,

136 
syÁax
='proto2',

137 
ex‹nsiÚ_¿nges
=[],

138 
Úeofs
=[

140 
£rŸlized_¡¬t
=356,

141 
£rŸlized_’d
=416,

144 
_IMAGERESIZER
.
f›lds_by_Çme
['k“p_a¥eù_¿tio_»siz”'].
mes§ge_ty³
 = 
_KEEPASPECTRATIORESIZER


145 
_IMAGERESIZER
.
f›lds_by_Çme
['fixed_sh­e_»siz”'].
mes§ge_ty³
 = 
_FIXEDSHAPERESIZER


146 
_IMAGERESIZER
.
Úeofs_by_Çme
['image_»siz”_Úeof'].
f›lds
.
	`­³nd
(

147 
_IMAGERESIZER
.
f›lds_by_Çme
['keep_aspect_ratio_resizer'])

148 
_IMAGERESIZER
.
f›lds_by_Çme
['k“p_a¥eù_¿tio_»siz”'].
cÚššg_Úeof
 = _IMAGERESIZER.
Úeofs_by_Çme
['image_resizer_oneof']

149 
_IMAGERESIZER
.
Úeofs_by_Çme
['image_»siz”_Úeof'].
f›lds
.
	`­³nd
(

150 
_IMAGERESIZER
.
f›lds_by_Çme
['fixed_shape_resizer'])

151 
_IMAGERESIZER
.
f›lds_by_Çme
['fixed_sh­e_»siz”'].
cÚššg_Úeof
 = _IMAGERESIZER.
Úeofs_by_Çme
['image_resizer_oneof']

152 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['ImageResiz”'] = 
_IMAGERESIZER


153 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['K“pA¥eùR©ioResiz”'] = 
_KEEPASPECTRATIORESIZER


154 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['FixedSh­eResiz”'] = 
_FIXEDSHAPERESIZER


155 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

157 
ImageResiz”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('ImageResiz”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

158 
DESCRIPTOR
 = 
_IMAGERESIZER
,

159 
__moduË__
 = 'object_detection.protos.image_resizer_pb2'

160 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
ImageResiz”
)

162 
_sym_db
.
	$Regi¡”Mes§ge
(
ImageResiz”
)

164 
K“pA¥eùR©ioResiz”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('K“pA¥eùR©ioResiz”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

165 
DESCRIPTOR
 = 
_KEEPASPECTRATIORESIZER
,

166 
__moduË__
 = 'object_detection.protos.image_resizer_pb2'

167 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
K“pA¥eùR©ioResiz”
)

169 
_sym_db
.
	$Regi¡”Mes§ge
(
K“pA¥eùR©ioResiz”
)

171 
FixedSh­eResiz”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('FixedSh­eResiz”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

172 
DESCRIPTOR
 = 
_FIXEDSHAPERESIZER
,

173 
__moduË__
 = 'object_detection.protos.image_resizer_pb2'

174 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
FixedSh­eResiz”
)

176 
_sym_db
.
	$Regi¡”Mes§ge
(
FixedSh­eResiz”
)

179 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/input_reader_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
šput_»ad”
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

18 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

19 
Çme
='object_detection/protos/input_reader.proto',

20 
·ckage
='object_detection.protos',

21 
syÁax
='proto2',

22 
£rŸlized_pb
=
	`_b
('\n*object_detection/protos/input_reader.proto\x12\x17object_detection.protos\"\xff\x02\n\x0bInputReader\x12\x18\n\x0elabel_map_path\x18\x01 \x01(\t:\x00\x12\x15\n\x07shuffle\x18\x02 \x01(\x08:\x04true\x12\x1c\n\x0equeue_capacity\x18\x03 \x01(\r:\x04\x32\x30\x30\x30\x12\x1f\n\x11min_after_dequeue\x18\x04 \x01(\r:\x04\x31\x30\x30\x30\x12\x15\n\nnum_epochs\x18\x05 \x01(\r:\x01\x30\x12\x16\n\x0bnum_readers\x18\x06 \x01(\r:\x01\x38\x12\"\n\x13load_instance_masks\x18\x07 \x01(\x08:\x05\x66\x61lse\x12N\n\x16tf_record_input_reader\x18\x08 \x01(\x0b\x32,.object_detection.protos.TFRecordInputReaderH\x00\x12M\n\x15\x65xternal_input_reader\x18\t \x01(\x0b\x32,.object_detection.protos.ExternalInputReaderH\x00\x42\x0e\n\x0cinput_reader\"+\n\x13TFRecordInputReader\x12\x14\n\ninput_path\x18\x01 \x01(\t:\x00\"\x1c\n\x13\x45xternalInputReader*\x05\x08\x01\x10\xe8\x07')

28 
_INPUTREADER
 = 
_desütÜ
.
	`DesütÜ
(

29 
Çme
='InputReader',

30 
fuÎ_Çme
='object_detection.protos.InputReader',

31 
f’ame
=
NÚe
,

32 
fe
=
DESCRIPTOR
,

33 
cÚššg_ty³
=
NÚe
,

34 
f›lds
=[

35 
_desütÜ
.
	`F›ldDesütÜ
(

36 
Çme
='Ïb–_m­_·th', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.IÅutR—d”.Ïb–_m­_·th', 
šdex
=0,

37 
numb”
=1, 
ty³
=9, 
ıp_ty³
=9, 
Ïb–
=1,

38 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
	`_b
("").
	`decode
('utf-8'),

39 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

40 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

41 
İtiÚs
=
NÚe
),

42 
_desütÜ
.
	`F›ldDesütÜ
(

43 
Çme
='shufæe', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.IÅutR—d”.shufæe', 
šdex
=1,

44 
numb”
=2, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

45 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=True,

46 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

47 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

48 
İtiÚs
=
NÚe
),

49 
_desütÜ
.
	`F›ldDesütÜ
(

50 
Çme
='queue_ÿ·c™y', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.IÅutR—d”.queue_ÿ·c™y', 
šdex
=2,

51 
numb”
=3, 
ty³
=13, 
ıp_ty³
=3, 
Ïb–
=1,

52 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=2000,

53 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

54 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

55 
İtiÚs
=
NÚe
),

56 
_desütÜ
.
	`F›ldDesütÜ
(

57 
Çme
='mš_aá”_dequeue', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.IÅutR—d”.mš_aá”_dequeue', 
šdex
=3,

58 
numb”
=4, 
ty³
=13, 
ıp_ty³
=3, 
Ïb–
=1,

59 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=1000,

60 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

61 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

62 
İtiÚs
=
NÚe
),

63 
_desütÜ
.
	`F›ldDesütÜ
(

64 
Çme
='num_•ochs', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.IÅutR—d”.num_•ochs', 
šdex
=4,

65 
numb”
=5, 
ty³
=13, 
ıp_ty³
=3, 
Ïb–
=1,

66 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=0,

67 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

68 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

69 
İtiÚs
=
NÚe
),

70 
_desütÜ
.
	`F›ldDesütÜ
(

71 
Çme
='num_»ad”s', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.IÅutR—d”.num_»ad”s', 
šdex
=5,

72 
numb”
=6, 
ty³
=13, 
ıp_ty³
=3, 
Ïb–
=1,

73 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=8,

74 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

75 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

76 
İtiÚs
=
NÚe
),

77 
_desütÜ
.
	`F›ldDesütÜ
(

78 
Çme
='lßd_š¡ªû_masks', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.IÅutR—d”.lßd_š¡ªû_masks', 
šdex
=6,

79 
numb”
=7, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

80 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

81 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

82 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

83 
İtiÚs
=
NÚe
),

84 
_desütÜ
.
	`F›ldDesütÜ
(

85 
Çme
='tf_»cÜd_šput_»ad”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.IÅutR—d”.tf_»cÜd_šput_»ad”', 
šdex
=7,

86 
numb”
=8, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

87 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

88 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

89 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

90 
İtiÚs
=
NÚe
),

91 
_desütÜ
.
	`F›ldDesütÜ
(

92 
Çme
='ex‹º®_šput_»ad”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.IÅutR—d”.ex‹º®_šput_»ad”', 
šdex
=8,

93 
numb”
=9, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

94 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

95 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

96 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

97 
İtiÚs
=
NÚe
),

99 
ex‹nsiÚs
=[

101 
Ã¡ed_ty³s
=[],

102 
’um_ty³s
=[

104 
İtiÚs
=
NÚe
,

105 
is_ex‹ndabË
=
F®£
,

106 
syÁax
='proto2',

107 
ex‹nsiÚ_¿nges
=[],

108 
Úeofs
=[

109 
_desütÜ
.
	`OÃofDesütÜ
(

110 
Çme
='šput_»ad”', 
fuÎ_Çme
='object_detection.protos.InputReader.input_reader',

111 
šdex
=0, 
cÚššg_ty³
=
NÚe
, 
f›lds
=[]),

113 
£rŸlized_¡¬t
=72,

114 
£rŸlized_’d
=455,

118 
_TFRECORDINPUTREADER
 = 
_desütÜ
.
	`DesütÜ
(

119 
Çme
='TFRecordInputReader',

120 
fuÎ_Çme
='object_detection.protos.TFRecordInputReader',

121 
f’ame
=
NÚe
,

122 
fe
=
DESCRIPTOR
,

123 
cÚššg_ty³
=
NÚe
,

124 
f›lds
=[

125 
_desütÜ
.
	`F›ldDesütÜ
(

126 
Çme
='šput_·th', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.TFRecÜdIÅutR—d”.šput_·th', 
šdex
=0,

127 
numb”
=1, 
ty³
=9, 
ıp_ty³
=9, 
Ïb–
=1,

128 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
	`_b
("").
	`decode
('utf-8'),

129 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

130 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

131 
İtiÚs
=
NÚe
),

133 
ex‹nsiÚs
=[

135 
Ã¡ed_ty³s
=[],

136 
’um_ty³s
=[

138 
İtiÚs
=
NÚe
,

139 
is_ex‹ndabË
=
F®£
,

140 
syÁax
='proto2',

141 
ex‹nsiÚ_¿nges
=[],

142 
Úeofs
=[

144 
£rŸlized_¡¬t
=457,

145 
£rŸlized_’d
=500,

149 
_EXTERNALINPUTREADER
 = 
_desütÜ
.
	`DesütÜ
(

150 
Çme
='ExternalInputReader',

151 
fuÎ_Çme
='object_detection.protos.ExternalInputReader',

152 
f’ame
=
NÚe
,

153 
fe
=
DESCRIPTOR
,

154 
cÚššg_ty³
=
NÚe
,

155 
f›lds
=[

157 
ex‹nsiÚs
=[

159 
Ã¡ed_ty³s
=[],

160 
’um_ty³s
=[

162 
İtiÚs
=
NÚe
,

163 
is_ex‹ndabË
=
True
,

164 
syÁax
='proto2',

165 
ex‹nsiÚ_¿nges
=[(1, 1000), ],

166 
Úeofs
=[

168 
£rŸlized_¡¬t
=502,

169 
£rŸlized_’d
=530,

172 
_INPUTREADER
.
f›lds_by_Çme
['tf_»cÜd_šput_»ad”'].
mes§ge_ty³
 = 
_TFRECORDINPUTREADER


173 
_INPUTREADER
.
f›lds_by_Çme
['ex‹º®_šput_»ad”'].
mes§ge_ty³
 = 
_EXTERNALINPUTREADER


174 
_INPUTREADER
.
Úeofs_by_Çme
['šput_»ad”'].
f›lds
.
	`­³nd
(

175 
_INPUTREADER
.
f›lds_by_Çme
['tf_record_input_reader'])

176 
_INPUTREADER
.
f›lds_by_Çme
['tf_»cÜd_šput_»ad”'].
cÚššg_Úeof
 = _INPUTREADER.
Úeofs_by_Çme
['input_reader']

177 
_INPUTREADER
.
Úeofs_by_Çme
['šput_»ad”'].
f›lds
.
	`­³nd
(

178 
_INPUTREADER
.
f›lds_by_Çme
['external_input_reader'])

179 
_INPUTREADER
.
f›lds_by_Çme
['ex‹º®_šput_»ad”'].
cÚššg_Úeof
 = _INPUTREADER.
Úeofs_by_Çme
['input_reader']

180 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['IÅutR—d”'] = 
_INPUTREADER


181 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['TFRecÜdIÅutR—d”'] = 
_TFRECORDINPUTREADER


182 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Ex‹º®IÅutR—d”'] = 
_EXTERNALINPUTREADER


183 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

185 
IÅutR—d”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('IÅutR—d”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

186 
DESCRIPTOR
 = 
_INPUTREADER
,

187 
__moduË__
 = 'object_detection.protos.input_reader_pb2'

188 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
IÅutR—d”
)

190 
_sym_db
.
	$Regi¡”Mes§ge
(
IÅutR—d”
)

192 
TFRecÜdIÅutR—d”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('TFRecÜdIÅutR—d”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

193 
DESCRIPTOR
 = 
_TFRECORDINPUTREADER
,

194 
__moduË__
 = 'object_detection.protos.input_reader_pb2'

195 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
TFRecÜdIÅutR—d”
)

197 
_sym_db
.
	$Regi¡”Mes§ge
(
TFRecÜdIÅutR—d”
)

199 
Ex‹º®IÅutR—d”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Ex‹º®IÅutR—d”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

200 
DESCRIPTOR
 = 
_EXTERNALINPUTREADER
,

201 
__moduË__
 = 'object_detection.protos.input_reader_pb2'

202 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Ex‹º®IÅutR—d”
)

204 
_sym_db
.
	$Regi¡”Mes§ge
(
Ex‹º®IÅutR—d”
)

207 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/losses_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
los£s
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

18 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

19 
Çme
='object_detection/protos/losses.proto',

20 
·ckage
='object_detection.protos',

21 
syÁax
='proto2',

22 
£rŸlized_pb
=
	`_b
('\n$object_detection/protos/losses.proto\x12\x17object_detection.protos\"\x9f\x02\n\x04Loss\x12\x44\n\x11localization_loss\x18\x01 \x01(\x0b\x32).object_detection.protos.LocalizationLoss\x12H\n\x13\x63lassification_loss\x18\x02 \x01(\x0b\x32+.object_detection.protos.ClassificationLoss\x12\x45\n\x12hard_example_miner\x18\x03 \x01(\x0b\x32).object_detection.protos.HardExampleMiner\x12 \n\x15\x63lassification_weight\x18\x04 \x01(\x02:\x01\x31\x12\x1e\n\x13localization_weight\x18\x05 \x01(\x02:\x01\x31\"\x9a\x02\n\x10LocalizationLoss\x12J\n\x0bweighted_l2\x18\x01 \x01(\x0b\x32\x33.object_detection.protos.WeightedL2LocalizationLossH\x00\x12W\n\x12weighted_smooth_l1\x18\x02 \x01(\x0b\x32\x39.object_detection.protos.WeightedSmoothL1LocalizationLossH\x00\x12L\n\x0cweighted_iou\x18\x03 \x01(\x0b\x32\x34.object_detection.protos.WeightedIOULocalizationLossH\x00\x42\x13\n\x11localization_loss\">\n\x1aWeightedL2LocalizationLoss\x12 \n\x11\x61nchorwise_output\x18\x01 \x01(\x08:\x05\x66\x61lse\"D\n WeightedSmoothL1LocalizationLoss\x12 \n\x11\x61nchorwise_output\x18\x01 \x01(\x08:\x05\x66\x61lse\"\x1d\n\x1bWeightedIOULocalizationLoss\"\xbb\x02\n\x12\x43lassificationLoss\x12V\n\x10weighted_sigmoid\x18\x01 \x01(\x0b\x32:.object_detection.protos.WeightedSigmoidClassificationLossH\x00\x12V\n\x10weighted_softmax\x18\x02 \x01(\x0b\x32:.object_detection.protos.WeightedSoftmaxClassificationLossH\x00\x12^\n\x14\x62ootstrapped_sigmoid\x18\x03 \x01(\x0b\x32>.object_detection.protos.BootstrappedSigmoidClassificationLossH\x00\x42\x15\n\x13\x63lassification_loss\"E\n!WeightedSigmoidClassificationLoss\x12 \n\x11\x61nchorwise_output\x18\x01 \x01(\x08:\x05\x66\x61lse\"E\n!WeightedSoftmaxClassificationLoss\x12 \n\x11\x61nchorwise_output\x18\x01 \x01(\x08:\x05\x66\x61lse\"w\n%BootstrappedSigmoidClassificationLoss\x12\r\n\x05\x61lpha\x18\x01 \x01(\x02\x12\x1d\n\x0ehard_bootstrap\x18\x02 \x01(\x08:\x05\x66\x61lse\x12 \n\x11\x61nchorwise_output\x18\x03 \x01(\x08:\x05\x66\x61lse\"\xa1\x02\n\x10HardExampleMiner\x12\x1d\n\x11num_hard_examples\x18\x01 \x01(\x05:\x02\x36\x34\x12\x1a\n\riou_threshold\x18\x02 \x01(\x02:\x03\x30.7\x12K\n\tloss_type\x18\x03 \x01(\x0e\x32\x32.object_detection.protos.HardExampleMiner.LossType:\x04\x42OTH\x12%\n\x1amax_negatives_per_positive\x18\x04 \x01(\x05:\x01\x30\x12\"\n\x17min_negatives_per_image\x18\x05 \x01(\x05:\x01\x30\":\n\x08LossType\x12\x08\n\x04\x42OTH\x10\x00\x12\x12\n\x0e\x43LASSIFICATION\x10\x01\x12\x10\n\x0cLOCALIZATION\x10\x02')

27 
_HARDEXAMPLEMINER_LOSSTYPE
 = 
_desütÜ
.
	`EnumDesütÜ
(

28 
Çme
='LossType',

29 
fuÎ_Çme
='object_detection.protos.HardExampleMiner.LossType',

30 
f’ame
=
NÚe
,

31 
fe
=
DESCRIPTOR
,

32 
v®ues
=[

33 
_desütÜ
.
	`EnumV®ueDesütÜ
(

34 
Çme
='BOTH', 
šdex
=0, 
numb”
=0,

35 
İtiÚs
=
NÚe
,

36 
ty³
=
NÚe
),

37 
_desütÜ
.
	`EnumV®ueDesütÜ
(

38 
Çme
='CLASSIFICATION', 
šdex
=1, 
numb”
=1,

39 
İtiÚs
=
NÚe
,

40 
ty³
=
NÚe
),

41 
_desütÜ
.
	`EnumV®ueDesütÜ
(

42 
Çme
='LOCALIZATION', 
šdex
=2, 
numb”
=2,

43 
İtiÚs
=
NÚe
,

44 
ty³
=
NÚe
),

46 
cÚššg_ty³
=
NÚe
,

47 
İtiÚs
=
NÚe
,

48 
£rŸlized_¡¬t
=1618,

49 
£rŸlized_’d
=1676,

51 
_sym_db
.
	$Regi¡”EnumDesütÜ
(
_HARDEXAMPLEMINER_LOSSTYPE
)

54 
_LOSS
 = 
_desütÜ
.
	`DesütÜ
(

55 
Çme
='Loss',

56 
fuÎ_Çme
='object_detection.protos.Loss',

57 
f’ame
=
NÚe
,

58 
fe
=
DESCRIPTOR
,

59 
cÚššg_ty³
=
NÚe
,

60 
f›lds
=[

61 
_desütÜ
.
	`F›ldDesütÜ
(

62 
Çme
='loÿliz©iÚ_loss', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Loss.loÿliz©iÚ_loss', 
šdex
=0,

63 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

64 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

65 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

66 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

67 
İtiÚs
=
NÚe
),

68 
_desütÜ
.
	`F›ldDesütÜ
(

69 
Çme
='şassifiÿtiÚ_loss', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Loss.şassifiÿtiÚ_loss', 
šdex
=1,

70 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

71 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

72 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

73 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

74 
İtiÚs
=
NÚe
),

75 
_desütÜ
.
	`F›ldDesütÜ
(

76 
Çme
='h¬d_exam¶e_mš”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Loss.h¬d_exam¶e_mš”', 
šdex
=2,

77 
numb”
=3, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

78 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

79 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

80 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

81 
İtiÚs
=
NÚe
),

82 
_desütÜ
.
	`F›ldDesütÜ
(

83 
Çme
='şassifiÿtiÚ_weight', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Loss.şassifiÿtiÚ_weight', 
šdex
=3,

84 
numb”
=4, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

85 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1),

86 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

87 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

88 
İtiÚs
=
NÚe
),

89 
_desütÜ
.
	`F›ldDesütÜ
(

90 
Çme
='loÿliz©iÚ_weight', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Loss.loÿliz©iÚ_weight', 
šdex
=4,

91 
numb”
=5, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

92 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1),

93 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

94 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

95 
İtiÚs
=
NÚe
),

97 
ex‹nsiÚs
=[

99 
Ã¡ed_ty³s
=[],

100 
’um_ty³s
=[

102 
İtiÚs
=
NÚe
,

103 
is_ex‹ndabË
=
F®£
,

104 
syÁax
='proto2',

105 
ex‹nsiÚ_¿nges
=[],

106 
Úeofs
=[

108 
£rŸlized_¡¬t
=66,

109 
£rŸlized_’d
=353,

113 
_LOCALIZATIONLOSS
 = 
_desütÜ
.
	`DesütÜ
(

114 
Çme
='LocalizationLoss',

115 
fuÎ_Çme
='object_detection.protos.LocalizationLoss',

116 
f’ame
=
NÚe
,

117 
fe
=
DESCRIPTOR
,

118 
cÚššg_ty³
=
NÚe
,

119 
f›lds
=[

120 
_desütÜ
.
	`F›ldDesütÜ
(

121 
Çme
='weigh‹d_l2', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Loÿliz©iÚLoss.weigh‹d_l2', 
šdex
=0,

122 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

123 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

124 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

125 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

126 
İtiÚs
=
NÚe
),

127 
_desütÜ
.
	`F›ldDesütÜ
(

128 
Çme
='weigh‹d_smoÙh_l1', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Loÿliz©iÚLoss.weigh‹d_smoÙh_l1', 
šdex
=1,

129 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

130 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

131 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

132 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

133 
İtiÚs
=
NÚe
),

134 
_desütÜ
.
	`F›ldDesütÜ
(

135 
Çme
='weigh‹d_iou', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Loÿliz©iÚLoss.weigh‹d_iou', 
šdex
=2,

136 
numb”
=3, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

137 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

138 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

139 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

140 
İtiÚs
=
NÚe
),

142 
ex‹nsiÚs
=[

144 
Ã¡ed_ty³s
=[],

145 
’um_ty³s
=[

147 
İtiÚs
=
NÚe
,

148 
is_ex‹ndabË
=
F®£
,

149 
syÁax
='proto2',

150 
ex‹nsiÚ_¿nges
=[],

151 
Úeofs
=[

152 
_desütÜ
.
	`OÃofDesütÜ
(

153 
Çme
='loÿliz©iÚ_loss', 
fuÎ_Çme
='object_detection.protos.LocalizationLoss.localization_loss',

154 
šdex
=0, 
cÚššg_ty³
=
NÚe
, 
f›lds
=[]),

156 
£rŸlized_¡¬t
=356,

157 
£rŸlized_’d
=638,

161 
_WEIGHTEDL2LOCALIZATIONLOSS
 = 
_desütÜ
.
	`DesütÜ
(

162 
Çme
='WeightedL2LocalizationLoss',

163 
fuÎ_Çme
='object_detection.protos.WeightedL2LocalizationLoss',

164 
f’ame
=
NÚe
,

165 
fe
=
DESCRIPTOR
,

166 
cÚššg_ty³
=
NÚe
,

167 
f›lds
=[

168 
_desütÜ
.
	`F›ldDesütÜ
(

169 
Çme
='ªchÜwi£_ouut', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Weigh‹dL2Loÿliz©iÚLoss.ªchÜwi£_ouut', 
šdex
=0,

170 
numb”
=1, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

171 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

172 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

173 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

174 
İtiÚs
=
NÚe
),

176 
ex‹nsiÚs
=[

178 
Ã¡ed_ty³s
=[],

179 
’um_ty³s
=[

181 
İtiÚs
=
NÚe
,

182 
is_ex‹ndabË
=
F®£
,

183 
syÁax
='proto2',

184 
ex‹nsiÚ_¿nges
=[],

185 
Úeofs
=[

187 
£rŸlized_¡¬t
=640,

188 
£rŸlized_’d
=702,

192 
_WEIGHTEDSMOOTHL1LOCALIZATIONLOSS
 = 
_desütÜ
.
	`DesütÜ
(

193 
Çme
='WeightedSmoothL1LocalizationLoss',

194 
fuÎ_Çme
='object_detection.protos.WeightedSmoothL1LocalizationLoss',

195 
f’ame
=
NÚe
,

196 
fe
=
DESCRIPTOR
,

197 
cÚššg_ty³
=
NÚe
,

198 
f›lds
=[

199 
_desütÜ
.
	`F›ldDesütÜ
(

200 
Çme
='ªchÜwi£_ouut', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Weigh‹dSmoÙhL1Loÿliz©iÚLoss.ªchÜwi£_ouut', 
šdex
=0,

201 
numb”
=1, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

202 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

203 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

204 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

205 
İtiÚs
=
NÚe
),

207 
ex‹nsiÚs
=[

209 
Ã¡ed_ty³s
=[],

210 
’um_ty³s
=[

212 
İtiÚs
=
NÚe
,

213 
is_ex‹ndabË
=
F®£
,

214 
syÁax
='proto2',

215 
ex‹nsiÚ_¿nges
=[],

216 
Úeofs
=[

218 
£rŸlized_¡¬t
=704,

219 
£rŸlized_’d
=772,

223 
_WEIGHTEDIOULOCALIZATIONLOSS
 = 
_desütÜ
.
	`DesütÜ
(

224 
Çme
='WeightedIOULocalizationLoss',

225 
fuÎ_Çme
='object_detection.protos.WeightedIOULocalizationLoss',

226 
f’ame
=
NÚe
,

227 
fe
=
DESCRIPTOR
,

228 
cÚššg_ty³
=
NÚe
,

229 
f›lds
=[

231 
ex‹nsiÚs
=[

233 
Ã¡ed_ty³s
=[],

234 
’um_ty³s
=[

236 
İtiÚs
=
NÚe
,

237 
is_ex‹ndabË
=
F®£
,

238 
syÁax
='proto2',

239 
ex‹nsiÚ_¿nges
=[],

240 
Úeofs
=[

242 
£rŸlized_¡¬t
=774,

243 
£rŸlized_’d
=803,

247 
_CLASSIFICATIONLOSS
 = 
_desütÜ
.
	`DesütÜ
(

248 
Çme
='ClassificationLoss',

249 
fuÎ_Çme
='object_detection.protos.ClassificationLoss',

250 
f’ame
=
NÚe
,

251 
fe
=
DESCRIPTOR
,

252 
cÚššg_ty³
=
NÚe
,

253 
f›lds
=[

254 
_desütÜ
.
	`F›ldDesütÜ
(

255 
Çme
='weigh‹d_sigmoid', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.CÏssifiÿtiÚLoss.weigh‹d_sigmoid', 
šdex
=0,

256 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

257 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

258 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

259 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

260 
İtiÚs
=
NÚe
),

261 
_desütÜ
.
	`F›ldDesütÜ
(

262 
Çme
='weigh‹d_soámax', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.CÏssifiÿtiÚLoss.weigh‹d_soámax', 
šdex
=1,

263 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

264 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

265 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

266 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

267 
İtiÚs
=
NÚe
),

268 
_desütÜ
.
	`F›ldDesütÜ
(

269 
Çme
='boÙ¡¿µed_sigmoid', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.CÏssifiÿtiÚLoss.boÙ¡¿µed_sigmoid', 
šdex
=2,

270 
numb”
=3, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

271 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

272 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

273 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

274 
İtiÚs
=
NÚe
),

276 
ex‹nsiÚs
=[

278 
Ã¡ed_ty³s
=[],

279 
’um_ty³s
=[

281 
İtiÚs
=
NÚe
,

282 
is_ex‹ndabË
=
F®£
,

283 
syÁax
='proto2',

284 
ex‹nsiÚ_¿nges
=[],

285 
Úeofs
=[

286 
_desütÜ
.
	`OÃofDesütÜ
(

287 
Çme
='şassifiÿtiÚ_loss', 
fuÎ_Çme
='object_detection.protos.ClassificationLoss.classification_loss',

288 
šdex
=0, 
cÚššg_ty³
=
NÚe
, 
f›lds
=[]),

290 
£rŸlized_¡¬t
=806,

291 
£rŸlized_’d
=1121,

295 
_WEIGHTEDSIGMOIDCLASSIFICATIONLOSS
 = 
_desütÜ
.
	`DesütÜ
(

296 
Çme
='WeightedSigmoidClassificationLoss',

297 
fuÎ_Çme
='object_detection.protos.WeightedSigmoidClassificationLoss',

298 
f’ame
=
NÚe
,

299 
fe
=
DESCRIPTOR
,

300 
cÚššg_ty³
=
NÚe
,

301 
f›lds
=[

302 
_desütÜ
.
	`F›ldDesütÜ
(

303 
Çme
='ªchÜwi£_ouut', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Weigh‹dSigmoidCÏssifiÿtiÚLoss.ªchÜwi£_ouut', 
šdex
=0,

304 
numb”
=1, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

305 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

306 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

307 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

308 
İtiÚs
=
NÚe
),

310 
ex‹nsiÚs
=[

312 
Ã¡ed_ty³s
=[],

313 
’um_ty³s
=[

315 
İtiÚs
=
NÚe
,

316 
is_ex‹ndabË
=
F®£
,

317 
syÁax
='proto2',

318 
ex‹nsiÚ_¿nges
=[],

319 
Úeofs
=[

321 
£rŸlized_¡¬t
=1123,

322 
£rŸlized_’d
=1192,

326 
_WEIGHTEDSOFTMAXCLASSIFICATIONLOSS
 = 
_desütÜ
.
	`DesütÜ
(

327 
Çme
='WeightedSoftmaxClassificationLoss',

328 
fuÎ_Çme
='object_detection.protos.WeightedSoftmaxClassificationLoss',

329 
f’ame
=
NÚe
,

330 
fe
=
DESCRIPTOR
,

331 
cÚššg_ty³
=
NÚe
,

332 
f›lds
=[

333 
_desütÜ
.
	`F›ldDesütÜ
(

334 
Çme
='ªchÜwi£_ouut', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Weigh‹dSoámaxCÏssifiÿtiÚLoss.ªchÜwi£_ouut', 
šdex
=0,

335 
numb”
=1, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

336 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

337 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

338 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

339 
İtiÚs
=
NÚe
),

341 
ex‹nsiÚs
=[

343 
Ã¡ed_ty³s
=[],

344 
’um_ty³s
=[

346 
İtiÚs
=
NÚe
,

347 
is_ex‹ndabË
=
F®£
,

348 
syÁax
='proto2',

349 
ex‹nsiÚ_¿nges
=[],

350 
Úeofs
=[

352 
£rŸlized_¡¬t
=1194,

353 
£rŸlized_’d
=1263,

357 
_BOOTSTRAPPEDSIGMOIDCLASSIFICATIONLOSS
 = 
_desütÜ
.
	`DesütÜ
(

358 
Çme
='BootstrappedSigmoidClassificationLoss',

359 
fuÎ_Çme
='object_detection.protos.BootstrappedSigmoidClassificationLoss',

360 
f’ame
=
NÚe
,

361 
fe
=
DESCRIPTOR
,

362 
cÚššg_ty³
=
NÚe
,

363 
f›lds
=[

364 
_desütÜ
.
	`F›ldDesütÜ
(

365 
Çme
='®pha', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.BoÙ¡¿µedSigmoidCÏssifiÿtiÚLoss.®pha', 
šdex
=0,

366 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

367 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

368 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

369 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

370 
İtiÚs
=
NÚe
),

371 
_desütÜ
.
	`F›ldDesütÜ
(

372 
Çme
='h¬d_boÙ¡¿p', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.BoÙ¡¿µedSigmoidCÏssifiÿtiÚLoss.h¬d_boÙ¡¿p', 
šdex
=1,

373 
numb”
=2, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

374 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

375 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

376 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

377 
İtiÚs
=
NÚe
),

378 
_desütÜ
.
	`F›ldDesütÜ
(

379 
Çme
='ªchÜwi£_ouut', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.BoÙ¡¿µedSigmoidCÏssifiÿtiÚLoss.ªchÜwi£_ouut', 
šdex
=2,

380 
numb”
=3, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

381 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

382 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

383 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

384 
İtiÚs
=
NÚe
),

386 
ex‹nsiÚs
=[

388 
Ã¡ed_ty³s
=[],

389 
’um_ty³s
=[

391 
İtiÚs
=
NÚe
,

392 
is_ex‹ndabË
=
F®£
,

393 
syÁax
='proto2',

394 
ex‹nsiÚ_¿nges
=[],

395 
Úeofs
=[

397 
£rŸlized_¡¬t
=1265,

398 
£rŸlized_’d
=1384,

402 
_HARDEXAMPLEMINER
 = 
_desütÜ
.
	`DesütÜ
(

403 
Çme
='HardExampleMiner',

404 
fuÎ_Çme
='object_detection.protos.HardExampleMiner',

405 
f’ame
=
NÚe
,

406 
fe
=
DESCRIPTOR
,

407 
cÚššg_ty³
=
NÚe
,

408 
f›lds
=[

409 
_desütÜ
.
	`F›ldDesütÜ
(

410 
Çme
='num_h¬d_exam¶es', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.H¬dExam¶eMš”.num_h¬d_exam¶es', 
šdex
=0,

411 
numb”
=1, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

412 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=64,

413 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

414 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

415 
İtiÚs
=
NÚe
),

416 
_desütÜ
.
	`F›ldDesütÜ
(

417 
Çme
='iou_th»shŞd', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.H¬dExam¶eMš”.iou_th»shŞd', 
šdex
=1,

418 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

419 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.7),

420 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

421 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

422 
İtiÚs
=
NÚe
),

423 
_desütÜ
.
	`F›ldDesütÜ
(

424 
Çme
='loss_ty³', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.H¬dExam¶eMš”.loss_ty³', 
šdex
=2,

425 
numb”
=3, 
ty³
=14, 
ıp_ty³
=8, 
Ïb–
=1,

426 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=0,

427 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

428 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

429 
İtiÚs
=
NÚe
),

430 
_desütÜ
.
	`F›ldDesütÜ
(

431 
Çme
='max_Ãg©ives_³r_pos™ive', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.H¬dExam¶eMš”.max_Ãg©ives_³r_pos™ive', 
šdex
=3,

432 
numb”
=4, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

433 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=0,

434 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

435 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

436 
İtiÚs
=
NÚe
),

437 
_desütÜ
.
	`F›ldDesütÜ
(

438 
Çme
='mš_Ãg©ives_³r_image', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.H¬dExam¶eMš”.mš_Ãg©ives_³r_image', 
šdex
=4,

439 
numb”
=5, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

440 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=0,

441 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

442 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

443 
İtiÚs
=
NÚe
),

445 
ex‹nsiÚs
=[

447 
Ã¡ed_ty³s
=[],

448 
’um_ty³s
=[

449 
_HARDEXAMPLEMINER_LOSSTYPE
,

451 
İtiÚs
=
NÚe
,

452 
is_ex‹ndabË
=
F®£
,

453 
syÁax
='proto2',

454 
ex‹nsiÚ_¿nges
=[],

455 
Úeofs
=[

457 
£rŸlized_¡¬t
=1387,

458 
£rŸlized_’d
=1676,

461 
_LOSS
.
f›lds_by_Çme
['loÿliz©iÚ_loss'].
mes§ge_ty³
 = 
_LOCALIZATIONLOSS


462 
_LOSS
.
f›lds_by_Çme
['şassifiÿtiÚ_loss'].
mes§ge_ty³
 = 
_CLASSIFICATIONLOSS


463 
_LOSS
.
f›lds_by_Çme
['h¬d_exam¶e_mš”'].
mes§ge_ty³
 = 
_HARDEXAMPLEMINER


464 
_LOCALIZATIONLOSS
.
f›lds_by_Çme
['weigh‹d_l2'].
mes§ge_ty³
 = 
_WEIGHTEDL2LOCALIZATIONLOSS


465 
_LOCALIZATIONLOSS
.
f›lds_by_Çme
['weigh‹d_smoÙh_l1'].
mes§ge_ty³
 = 
_WEIGHTEDSMOOTHL1LOCALIZATIONLOSS


466 
_LOCALIZATIONLOSS
.
f›lds_by_Çme
['weigh‹d_iou'].
mes§ge_ty³
 = 
_WEIGHTEDIOULOCALIZATIONLOSS


467 
_LOCALIZATIONLOSS
.
Úeofs_by_Çme
['loÿliz©iÚ_loss'].
f›lds
.
	`­³nd
(

468 
_LOCALIZATIONLOSS
.
f›lds_by_Çme
['weighted_l2'])

469 
_LOCALIZATIONLOSS
.
f›lds_by_Çme
['weigh‹d_l2'].
cÚššg_Úeof
 = _LOCALIZATIONLOSS.
Úeofs_by_Çme
['localization_loss']

470 
_LOCALIZATIONLOSS
.
Úeofs_by_Çme
['loÿliz©iÚ_loss'].
f›lds
.
	`­³nd
(

471 
_LOCALIZATIONLOSS
.
f›lds_by_Çme
['weighted_smooth_l1'])

472 
_LOCALIZATIONLOSS
.
f›lds_by_Çme
['weigh‹d_smoÙh_l1'].
cÚššg_Úeof
 = _LOCALIZATIONLOSS.
Úeofs_by_Çme
['localization_loss']

473 
_LOCALIZATIONLOSS
.
Úeofs_by_Çme
['loÿliz©iÚ_loss'].
f›lds
.
	`­³nd
(

474 
_LOCALIZATIONLOSS
.
f›lds_by_Çme
['weighted_iou'])

475 
_LOCALIZATIONLOSS
.
f›lds_by_Çme
['weigh‹d_iou'].
cÚššg_Úeof
 = _LOCALIZATIONLOSS.
Úeofs_by_Çme
['localization_loss']

476 
_CLASSIFICATIONLOSS
.
f›lds_by_Çme
['weigh‹d_sigmoid'].
mes§ge_ty³
 = 
_WEIGHTEDSIGMOIDCLASSIFICATIONLOSS


477 
_CLASSIFICATIONLOSS
.
f›lds_by_Çme
['weigh‹d_soámax'].
mes§ge_ty³
 = 
_WEIGHTEDSOFTMAXCLASSIFICATIONLOSS


478 
_CLASSIFICATIONLOSS
.
f›lds_by_Çme
['boÙ¡¿µed_sigmoid'].
mes§ge_ty³
 = 
_BOOTSTRAPPEDSIGMOIDCLASSIFICATIONLOSS


479 
_CLASSIFICATIONLOSS
.
Úeofs_by_Çme
['şassifiÿtiÚ_loss'].
f›lds
.
	`­³nd
(

480 
_CLASSIFICATIONLOSS
.
f›lds_by_Çme
['weighted_sigmoid'])

481 
_CLASSIFICATIONLOSS
.
f›lds_by_Çme
['weigh‹d_sigmoid'].
cÚššg_Úeof
 = _CLASSIFICATIONLOSS.
Úeofs_by_Çme
['classification_loss']

482 
_CLASSIFICATIONLOSS
.
Úeofs_by_Çme
['şassifiÿtiÚ_loss'].
f›lds
.
	`­³nd
(

483 
_CLASSIFICATIONLOSS
.
f›lds_by_Çme
['weighted_softmax'])

484 
_CLASSIFICATIONLOSS
.
f›lds_by_Çme
['weigh‹d_soámax'].
cÚššg_Úeof
 = _CLASSIFICATIONLOSS.
Úeofs_by_Çme
['classification_loss']

485 
_CLASSIFICATIONLOSS
.
Úeofs_by_Çme
['şassifiÿtiÚ_loss'].
f›lds
.
	`­³nd
(

486 
_CLASSIFICATIONLOSS
.
f›lds_by_Çme
['bootstrapped_sigmoid'])

487 
_CLASSIFICATIONLOSS
.
f›lds_by_Çme
['boÙ¡¿µed_sigmoid'].
cÚššg_Úeof
 = _CLASSIFICATIONLOSS.
Úeofs_by_Çme
['classification_loss']

488 
_HARDEXAMPLEMINER
.
f›lds_by_Çme
['loss_ty³'].
’um_ty³
 = 
_HARDEXAMPLEMINER_LOSSTYPE


489 
_HARDEXAMPLEMINER_LOSSTYPE
.
cÚššg_ty³
 = 
_HARDEXAMPLEMINER


490 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Loss'] = 
_LOSS


491 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Loÿliz©iÚLoss'] = 
_LOCALIZATIONLOSS


492 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Weigh‹dL2Loÿliz©iÚLoss'] = 
_WEIGHTEDL2LOCALIZATIONLOSS


493 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Weigh‹dSmoÙhL1Loÿliz©iÚLoss'] = 
_WEIGHTEDSMOOTHL1LOCALIZATIONLOSS


494 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Weigh‹dIOULoÿliz©iÚLoss'] = 
_WEIGHTEDIOULOCALIZATIONLOSS


495 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['CÏssifiÿtiÚLoss'] = 
_CLASSIFICATIONLOSS


496 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Weigh‹dSigmoidCÏssifiÿtiÚLoss'] = 
_WEIGHTEDSIGMOIDCLASSIFICATIONLOSS


497 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Weigh‹dSoámaxCÏssifiÿtiÚLoss'] = 
_WEIGHTEDSOFTMAXCLASSIFICATIONLOSS


498 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['BoÙ¡¿µedSigmoidCÏssifiÿtiÚLoss'] = 
_BOOTSTRAPPEDSIGMOIDCLASSIFICATIONLOSS


499 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['H¬dExam¶eMš”'] = 
_HARDEXAMPLEMINER


500 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

502 
Loss
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Loss', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

503 
DESCRIPTOR
 = 
_LOSS
,

504 
__moduË__
 = 'object_detection.protos.losses_pb2'

505 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Loss
)

507 
_sym_db
.
	$Regi¡”Mes§ge
(
Loss
)

509 
Loÿliz©iÚLoss
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Loÿliz©iÚLoss', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

510 
DESCRIPTOR
 = 
_LOCALIZATIONLOSS
,

511 
__moduË__
 = 'object_detection.protos.losses_pb2'

512 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Loÿliz©iÚLoss
)

514 
_sym_db
.
	$Regi¡”Mes§ge
(
Loÿliz©iÚLoss
)

516 
Weigh‹dL2Loÿliz©iÚLoss
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Weigh‹dL2Loÿliz©iÚLoss', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

517 
DESCRIPTOR
 = 
_WEIGHTEDL2LOCALIZATIONLOSS
,

518 
__moduË__
 = 'object_detection.protos.losses_pb2'

519 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Weigh‹dL2Loÿliz©iÚLoss
)

521 
_sym_db
.
	$Regi¡”Mes§ge
(
Weigh‹dL2Loÿliz©iÚLoss
)

523 
Weigh‹dSmoÙhL1Loÿliz©iÚLoss
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Weigh‹dSmoÙhL1Loÿliz©iÚLoss', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

524 
DESCRIPTOR
 = 
_WEIGHTEDSMOOTHL1LOCALIZATIONLOSS
,

525 
__moduË__
 = 'object_detection.protos.losses_pb2'

526 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Weigh‹dSmoÙhL1Loÿliz©iÚLoss
)

528 
_sym_db
.
	$Regi¡”Mes§ge
(
Weigh‹dSmoÙhL1Loÿliz©iÚLoss
)

530 
Weigh‹dIOULoÿliz©iÚLoss
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Weigh‹dIOULoÿliz©iÚLoss', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

531 
DESCRIPTOR
 = 
_WEIGHTEDIOULOCALIZATIONLOSS
,

532 
__moduË__
 = 'object_detection.protos.losses_pb2'

533 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Weigh‹dIOULoÿliz©iÚLoss
)

535 
_sym_db
.
	$Regi¡”Mes§ge
(
Weigh‹dIOULoÿliz©iÚLoss
)

537 
CÏssifiÿtiÚLoss
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('CÏssifiÿtiÚLoss', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

538 
DESCRIPTOR
 = 
_CLASSIFICATIONLOSS
,

539 
__moduË__
 = 'object_detection.protos.losses_pb2'

540 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
CÏssifiÿtiÚLoss
)

542 
_sym_db
.
	$Regi¡”Mes§ge
(
CÏssifiÿtiÚLoss
)

544 
Weigh‹dSigmoidCÏssifiÿtiÚLoss
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Weigh‹dSigmoidCÏssifiÿtiÚLoss', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

545 
DESCRIPTOR
 = 
_WEIGHTEDSIGMOIDCLASSIFICATIONLOSS
,

546 
__moduË__
 = 'object_detection.protos.losses_pb2'

547 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Weigh‹dSigmoidCÏssifiÿtiÚLoss
)

549 
_sym_db
.
	$Regi¡”Mes§ge
(
Weigh‹dSigmoidCÏssifiÿtiÚLoss
)

551 
Weigh‹dSoámaxCÏssifiÿtiÚLoss
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Weigh‹dSoámaxCÏssifiÿtiÚLoss', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

552 
DESCRIPTOR
 = 
_WEIGHTEDSOFTMAXCLASSIFICATIONLOSS
,

553 
__moduË__
 = 'object_detection.protos.losses_pb2'

554 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Weigh‹dSoámaxCÏssifiÿtiÚLoss
)

556 
_sym_db
.
	$Regi¡”Mes§ge
(
Weigh‹dSoámaxCÏssifiÿtiÚLoss
)

558 
BoÙ¡¿µedSigmoidCÏssifiÿtiÚLoss
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('BoÙ¡¿µedSigmoidCÏssifiÿtiÚLoss', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

559 
DESCRIPTOR
 = 
_BOOTSTRAPPEDSIGMOIDCLASSIFICATIONLOSS
,

560 
__moduË__
 = 'object_detection.protos.losses_pb2'

561 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
BoÙ¡¿µedSigmoidCÏssifiÿtiÚLoss
)

563 
_sym_db
.
	$Regi¡”Mes§ge
(
BoÙ¡¿µedSigmoidCÏssifiÿtiÚLoss
)

565 
H¬dExam¶eMš”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('H¬dExam¶eMš”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

566 
DESCRIPTOR
 = 
_HARDEXAMPLEMINER
,

567 
__moduË__
 = 'object_detection.protos.losses_pb2'

568 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
H¬dExam¶eMš”
)

570 
_sym_db
.
	$Regi¡”Mes§ge
(
H¬dExam¶eMš”
)

573 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/matcher_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
m©ch”
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

16 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
¬gmax_m©ch”_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_¬gmax__m©ch”__pb2


17 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
b¬t™e_m©ch”_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_b¬t™e__m©ch”__pb2


20 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

21 
Çme
='object_detection/protos/matcher.proto',

22 
·ckage
='object_detection.protos',

23 
syÁax
='proto2',

24 
£rŸlized_pb
=
	`_b
('\n%object_detection/protos/matcher.proto\x12\x17object_detection.protos\x1a,object_detection/protos/argmax_matcher.proto\x1a/object_detection/protos/bipartite_matcher.proto\"\xa4\x01\n\x07Matcher\x12@\n\x0e\x61rgmax_matcher\x18\x01 \x01(\x0b\x32&.object_detection.protos.ArgMaxMatcherH\x00\x12\x46\n\x11\x62ipartite_matcher\x18\x02 \x01(\x0b\x32).object_detection.protos.BipartiteMatcherH\x00\x42\x0f\n\rmatcher_oneof')

26 
d•’d’c›s
=[
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_¬gmax__m©ch”__pb2
.
DESCRIPTOR
,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_b¬t™e__m©ch”__pb2
.DESCRIPTOR,])

31 
_MATCHER
 = 
_desütÜ
.
	`DesütÜ
(

32 
Çme
='Matcher',

33 
fuÎ_Çme
='object_detection.protos.Matcher',

34 
f’ame
=
NÚe
,

35 
fe
=
DESCRIPTOR
,

36 
cÚššg_ty³
=
NÚe
,

37 
f›lds
=[

38 
_desütÜ
.
	`F›ldDesütÜ
(

39 
Çme
='¬gmax_m©ch”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.M©ch”.¬gmax_m©ch”', 
šdex
=0,

40 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

41 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

42 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

43 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

44 
İtiÚs
=
NÚe
),

45 
_desütÜ
.
	`F›ldDesütÜ
(

46 
Çme
='b¬t™e_m©ch”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.M©ch”.b¬t™e_m©ch”', 
šdex
=1,

47 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

48 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

49 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

50 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

51 
İtiÚs
=
NÚe
),

53 
ex‹nsiÚs
=[

55 
Ã¡ed_ty³s
=[],

56 
’um_ty³s
=[

58 
İtiÚs
=
NÚe
,

59 
is_ex‹ndabË
=
F®£
,

60 
syÁax
='proto2',

61 
ex‹nsiÚ_¿nges
=[],

62 
Úeofs
=[

63 
_desütÜ
.
	`OÃofDesütÜ
(

64 
Çme
='m©ch”_Úeof', 
fuÎ_Çme
='object_detection.protos.Matcher.matcher_oneof',

65 
šdex
=0, 
cÚššg_ty³
=
NÚe
, 
f›lds
=[]),

67 
£rŸlized_¡¬t
=162,

68 
£rŸlized_’d
=326,

71 
_MATCHER
.
f›lds_by_Çme
['¬gmax_m©ch”'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_¬gmax__m©ch”__pb2
.
_ARGMAXMATCHER


72 
_MATCHER
.
f›lds_by_Çme
['b¬t™e_m©ch”'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_b¬t™e__m©ch”__pb2
.
_BIPARTITEMATCHER


73 
_MATCHER
.
Úeofs_by_Çme
['m©ch”_Úeof'].
f›lds
.
	`­³nd
(

74 
_MATCHER
.
f›lds_by_Çme
['argmax_matcher'])

75 
_MATCHER
.
f›lds_by_Çme
['¬gmax_m©ch”'].
cÚššg_Úeof
 = _MATCHER.
Úeofs_by_Çme
['matcher_oneof']

76 
_MATCHER
.
Úeofs_by_Çme
['m©ch”_Úeof'].
f›lds
.
	`­³nd
(

77 
_MATCHER
.
f›lds_by_Çme
['bipartite_matcher'])

78 
_MATCHER
.
f›lds_by_Çme
['b¬t™e_m©ch”'].
cÚššg_Úeof
 = _MATCHER.
Úeofs_by_Çme
['matcher_oneof']

79 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['M©ch”'] = 
_MATCHER


80 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

82 
M©ch”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('M©ch”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

83 
DESCRIPTOR
 = 
_MATCHER
,

84 
__moduË__
 = 'object_detection.protos.matcher_pb2'

85 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
M©ch”
)

87 
_sym_db
.
	$Regi¡”Mes§ge
(
M©ch”
)

90 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/mean_stddev_box_coder_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
m—n_¡ddev_box_cod”
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

18 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

19 
Çme
='object_detection/protos/mean_stddev_box_coder.proto',

20 
·ckage
='object_detection.protos',

21 
syÁax
='proto2',

22 
£rŸlized_pb
=
	`_b
('\n3object_detection/protos/mean_stddev_box_coder.proto\x12\x17object_detection.protos\"\x14\n\x12MeanStddevBoxCoder')

28 
_MEANSTDDEVBOXCODER
 = 
_desütÜ
.
	`DesütÜ
(

29 
Çme
='MeanStddevBoxCoder',

30 
fuÎ_Çme
='object_detection.protos.MeanStddevBoxCoder',

31 
f’ame
=
NÚe
,

32 
fe
=
DESCRIPTOR
,

33 
cÚššg_ty³
=
NÚe
,

34 
f›lds
=[

36 
ex‹nsiÚs
=[

38 
Ã¡ed_ty³s
=[],

39 
’um_ty³s
=[

41 
İtiÚs
=
NÚe
,

42 
is_ex‹ndabË
=
F®£
,

43 
syÁax
='proto2',

44 
ex‹nsiÚ_¿nges
=[],

45 
Úeofs
=[

47 
£rŸlized_¡¬t
=80,

48 
£rŸlized_’d
=100,

51 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['M—nStddevBoxCod”'] = 
_MEANSTDDEVBOXCODER


52 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

54 
M—nStddevBoxCod”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('M—nStddevBoxCod”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

55 
DESCRIPTOR
 = 
_MEANSTDDEVBOXCODER
,

56 
__moduË__
 = 'object_detection.protos.mean_stddev_box_coder_pb2'

57 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
M—nStddevBoxCod”
)

59 
_sym_db
.
	$Regi¡”Mes§ge
(
M—nStddevBoxCod”
)

62 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/model_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
mod–
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

16 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
ç¡”_rún_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ç¡”__rún__pb2


17 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
ssd_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ssd__pb2


20 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

21 
Çme
='object_detection/protos/model.proto',

22 
·ckage
='object_detection.protos',

23 
syÁax
='proto2',

24 
£rŸlized_pb
=
	`_b
('\n#object_detection/protos/model.proto\x12\x17object_detection.protos\x1a)object_detection/protos/faster_rcnn.proto\x1a!object_detection/protos/ssd.proto\"\x82\x01\n\x0e\x44\x65tectionModel\x12:\n\x0b\x66\x61ster_rcnn\x18\x01 \x01(\x0b\x32#.object_detection.protos.FasterRcnnH\x00\x12+\n\x03ssd\x18\x02 \x01(\x0b\x32\x1c.object_detection.protos.SsdH\x00\x42\x07\n\x05model')

26 
d•’d’c›s
=[
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ç¡”__rún__pb2
.
DESCRIPTOR
,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ssd__pb2
.DESCRIPTOR,])

31 
_DETECTIONMODEL
 = 
_desütÜ
.
	`DesütÜ
(

32 
Çme
='DetectionModel',

33 
fuÎ_Çme
='object_detection.protos.DetectionModel',

34 
f’ame
=
NÚe
,

35 
fe
=
DESCRIPTOR
,

36 
cÚššg_ty³
=
NÚe
,

37 
f›lds
=[

38 
_desütÜ
.
	`F›ldDesütÜ
(

39 
Çme
='ç¡”_rún', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.D‘eùiÚMod–.ç¡”_rún', 
šdex
=0,

40 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

41 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

42 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

43 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

44 
İtiÚs
=
NÚe
),

45 
_desütÜ
.
	`F›ldDesütÜ
(

46 
Çme
='ssd', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.D‘eùiÚMod–.ssd', 
šdex
=1,

47 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

48 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

49 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

50 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

51 
İtiÚs
=
NÚe
),

53 
ex‹nsiÚs
=[

55 
Ã¡ed_ty³s
=[],

56 
’um_ty³s
=[

58 
İtiÚs
=
NÚe
,

59 
is_ex‹ndabË
=
F®£
,

60 
syÁax
='proto2',

61 
ex‹nsiÚ_¿nges
=[],

62 
Úeofs
=[

63 
_desütÜ
.
	`OÃofDesütÜ
(

64 
Çme
='mod–', 
fuÎ_Çme
='object_detection.protos.DetectionModel.model',

65 
šdex
=0, 
cÚššg_ty³
=
NÚe
, 
f›lds
=[]),

67 
£rŸlized_¡¬t
=143,

68 
£rŸlized_’d
=273,

71 
_DETECTIONMODEL
.
f›lds_by_Çme
['ç¡”_rún'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ç¡”__rún__pb2
.
_FASTERRCNN


72 
_DETECTIONMODEL
.
f›lds_by_Çme
['ssd'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ssd__pb2
.
_SSD


73 
_DETECTIONMODEL
.
Úeofs_by_Çme
['mod–'].
f›lds
.
	`­³nd
(

74 
_DETECTIONMODEL
.
f›lds_by_Çme
['faster_rcnn'])

75 
_DETECTIONMODEL
.
f›lds_by_Çme
['ç¡”_rún'].
cÚššg_Úeof
 = _DETECTIONMODEL.
Úeofs_by_Çme
['model']

76 
_DETECTIONMODEL
.
Úeofs_by_Çme
['mod–'].
f›lds
.
	`­³nd
(

77 
_DETECTIONMODEL
.
f›lds_by_Çme
['ssd'])

78 
_DETECTIONMODEL
.
f›lds_by_Çme
['ssd'].
cÚššg_Úeof
 = _DETECTIONMODEL.
Úeofs_by_Çme
['model']

79 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['D‘eùiÚMod–'] = 
_DETECTIONMODEL


80 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

82 
D‘eùiÚMod–
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('D‘eùiÚMod–', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

83 
DESCRIPTOR
 = 
_DETECTIONMODEL
,

84 
__moduË__
 = 'object_detection.protos.model_pb2'

85 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
D‘eùiÚMod–
)

87 
_sym_db
.
	$Regi¡”Mes§ge
(
D‘eùiÚMod–
)

90 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/optimizer_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
İtimiz”
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

18 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

19 
Çme
='object_detection/protos/optimizer.proto',

20 
·ckage
='object_detection.protos',

21 
syÁax
='proto2',

22 
£rŸlized_pb
=
	`_b
('\n\'object_detection/protos/optimizer.proto\x12\x17object_detection.protos\"\xb5\x02\n\tOptimizer\x12G\n\x12rms_prop_optimizer\x18\x01 \x01(\x0b\x32).object_detection.protos.RMSPropOptimizerH\x00\x12H\n\x12momentum_optimizer\x18\x02 \x01(\x0b\x32*.object_detection.protos.MomentumOptimizerH\x00\x12@\n\x0e\x61\x64\x61m_optimizer\x18\x03 \x01(\x0b\x32&.object_detection.protos.AdamOptimizerH\x00\x12 \n\x12use_moving_average\x18\x04 \x01(\x08:\x04true\x12$\n\x14moving_average_decay\x18\x05 \x01(\x02:\x06\x30.9999B\x0b\n\toptimizer\"\x9f\x01\n\x10RMSPropOptimizer\x12<\n\rlearning_rate\x18\x01 \x01(\x0b\x32%.object_detection.protos.LearningRate\x12%\n\x18momentum_optimizer_value\x18\x02 \x01(\x02:\x03\x30.9\x12\x12\n\x05\x64\x65\x63\x61y\x18\x03 \x01(\x02:\x03\x30.9\x12\x12\n\x07\x65psilon\x18\x04 \x01(\x02:\x01\x31\"x\n\x11MomentumOptimizer\x12<\n\rlearning_rate\x18\x01 \x01(\x0b\x32%.object_detection.protos.LearningRate\x12%\n\x18momentum_optimizer_value\x18\x02 \x01(\x02:\x03\x30.9\"M\n\rAdamOptimizer\x12<\n\rlearning_rate\x18\x01 \x01(\x0b\x32%.object_detection.protos.LearningRate\"\xa8\x02\n\x0cLearningRate\x12O\n\x16\x63onstant_learning_rate\x18\x01 \x01(\x0b\x32-.object_detection.protos.ConstantLearningRateH\x00\x12`\n\x1f\x65xponential_decay_learning_rate\x18\x02 \x01(\x0b\x32\x35.object_detection.protos.ExponentialDecayLearningRateH\x00\x12T\n\x19manual_step_learning_rate\x18\x03 \x01(\x0b\x32/.object_detection.protos.ManualStepLearningRateH\x00\x42\x0f\n\rlearning_rate\"4\n\x14\x43onstantLearningRate\x12\x1c\n\rlearning_rate\x18\x01 \x01(\x02:\x05\x30.002\"\x97\x01\n\x1c\x45xponentialDecayLearningRate\x12$\n\x15initial_learning_rate\x18\x01 \x01(\x02:\x05\x30.002\x12\x1c\n\x0b\x64\x65\x63\x61y_steps\x18\x02 \x01(\r:\x07\x34\x30\x30\x30\x30\x30\x30\x12\x1a\n\x0c\x64\x65\x63\x61y_factor\x18\x03 \x01(\x02:\x04\x30.95\x12\x17\n\tstaircase\x18\x04 \x01(\x08:\x04true\"\xda\x01\n\x16ManualStepLearningRate\x12$\n\x15initial_learning_rate\x18\x01 \x01(\x02:\x05\x30.002\x12V\n\x08schedule\x18\x02 \x03(\x0b\x32\x44.object_detection.protos.ManualStepLearningRate.LearningRateSchedule\x1a\x42\n\x14LearningRateSchedule\x12\x0c\n\x04step\x18\x01 \x01(\r\x12\x1c\n\rlearning_rate\x18\x02 \x01(\x02:\x05\x30.002')

28 
_OPTIMIZER
 = 
_desütÜ
.
	`DesütÜ
(

29 
Çme
='Optimizer',

30 
fuÎ_Çme
='object_detection.protos.Optimizer',

31 
f’ame
=
NÚe
,

32 
fe
=
DESCRIPTOR
,

33 
cÚššg_ty³
=
NÚe
,

34 
f›lds
=[

35 
_desütÜ
.
	`F›ldDesütÜ
(

36 
Çme
='rms_´İ_İtimiz”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.O±imiz”.rms_´İ_İtimiz”', 
šdex
=0,

37 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

38 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

39 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

40 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

41 
İtiÚs
=
NÚe
),

42 
_desütÜ
.
	`F›ldDesütÜ
(

43 
Çme
='mom’tum_İtimiz”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.O±imiz”.mom’tum_İtimiz”', 
šdex
=1,

44 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

45 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

46 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

47 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

48 
İtiÚs
=
NÚe
),

49 
_desütÜ
.
	`F›ldDesütÜ
(

50 
Çme
='adam_İtimiz”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.O±imiz”.adam_İtimiz”', 
šdex
=2,

51 
numb”
=3, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

52 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

53 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

54 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

55 
İtiÚs
=
NÚe
),

56 
_desütÜ
.
	`F›ldDesütÜ
(

57 
Çme
='u£_movšg_av”age', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.O±imiz”.u£_movšg_av”age', 
šdex
=3,

58 
numb”
=4, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

59 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=True,

60 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

61 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

62 
İtiÚs
=
NÚe
),

63 
_desütÜ
.
	`F›ldDesütÜ
(

64 
Çme
='movšg_av”age_deÿy', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.O±imiz”.movšg_av”age_deÿy', 
šdex
=4,

65 
numb”
=5, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

66 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.9999),

67 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

68 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

69 
İtiÚs
=
NÚe
),

71 
ex‹nsiÚs
=[

73 
Ã¡ed_ty³s
=[],

74 
’um_ty³s
=[

76 
İtiÚs
=
NÚe
,

77 
is_ex‹ndabË
=
F®£
,

78 
syÁax
='proto2',

79 
ex‹nsiÚ_¿nges
=[],

80 
Úeofs
=[

81 
_desütÜ
.
	`OÃofDesütÜ
(

82 
Çme
='İtimiz”', 
fuÎ_Çme
='object_detection.protos.Optimizer.optimizer',

83 
šdex
=0, 
cÚššg_ty³
=
NÚe
, 
f›lds
=[]),

85 
£rŸlized_¡¬t
=69,

86 
£rŸlized_’d
=378,

90 
_RMSPROPOPTIMIZER
 = 
_desütÜ
.
	`DesütÜ
(

91 
Çme
='RMSPropOptimizer',

92 
fuÎ_Çme
='object_detection.protos.RMSPropOptimizer',

93 
f’ame
=
NÚe
,

94 
fe
=
DESCRIPTOR
,

95 
cÚššg_ty³
=
NÚe
,

96 
f›lds
=[

97 
_desütÜ
.
	`F›ldDesütÜ
(

98 
Çme
='Ë¬nšg_¿‹', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RMSPrİO±imiz”.Ë¬nšg_¿‹', 
šdex
=0,

99 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

100 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

101 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

102 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

103 
İtiÚs
=
NÚe
),

104 
_desütÜ
.
	`F›ldDesütÜ
(

105 
Çme
='mom’tum_İtimiz”_v®ue', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RMSPrİO±imiz”.mom’tum_İtimiz”_v®ue', 
šdex
=1,

106 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

107 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.9),

108 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

109 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

110 
İtiÚs
=
NÚe
),

111 
_desütÜ
.
	`F›ldDesütÜ
(

112 
Çme
='deÿy', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RMSPrİO±imiz”.deÿy', 
šdex
=2,

113 
numb”
=3, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

114 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.9),

115 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

116 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

117 
İtiÚs
=
NÚe
),

118 
_desütÜ
.
	`F›ldDesütÜ
(

119 
Çme
='•sÚ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RMSPrİO±imiz”.•sÚ', 
šdex
=3,

120 
numb”
=4, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

121 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1),

122 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

123 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

124 
İtiÚs
=
NÚe
),

126 
ex‹nsiÚs
=[

128 
Ã¡ed_ty³s
=[],

129 
’um_ty³s
=[

131 
İtiÚs
=
NÚe
,

132 
is_ex‹ndabË
=
F®£
,

133 
syÁax
='proto2',

134 
ex‹nsiÚ_¿nges
=[],

135 
Úeofs
=[

137 
£rŸlized_¡¬t
=381,

138 
£rŸlized_’d
=540,

142 
_MOMENTUMOPTIMIZER
 = 
_desütÜ
.
	`DesütÜ
(

143 
Çme
='MomentumOptimizer',

144 
fuÎ_Çme
='object_detection.protos.MomentumOptimizer',

145 
f’ame
=
NÚe
,

146 
fe
=
DESCRIPTOR
,

147 
cÚššg_ty³
=
NÚe
,

148 
f›lds
=[

149 
_desütÜ
.
	`F›ldDesütÜ
(

150 
Çme
='Ë¬nšg_¿‹', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Mom’tumO±imiz”.Ë¬nšg_¿‹', 
šdex
=0,

151 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

152 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

153 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

154 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

155 
İtiÚs
=
NÚe
),

156 
_desütÜ
.
	`F›ldDesütÜ
(

157 
Çme
='mom’tum_İtimiz”_v®ue', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Mom’tumO±imiz”.mom’tum_İtimiz”_v®ue', 
šdex
=1,

158 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

159 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.9),

160 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

161 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

162 
İtiÚs
=
NÚe
),

164 
ex‹nsiÚs
=[

166 
Ã¡ed_ty³s
=[],

167 
’um_ty³s
=[

169 
İtiÚs
=
NÚe
,

170 
is_ex‹ndabË
=
F®£
,

171 
syÁax
='proto2',

172 
ex‹nsiÚ_¿nges
=[],

173 
Úeofs
=[

175 
£rŸlized_¡¬t
=542,

176 
£rŸlized_’d
=662,

180 
_ADAMOPTIMIZER
 = 
_desütÜ
.
	`DesütÜ
(

181 
Çme
='AdamOptimizer',

182 
fuÎ_Çme
='object_detection.protos.AdamOptimizer',

183 
f’ame
=
NÚe
,

184 
fe
=
DESCRIPTOR
,

185 
cÚššg_ty³
=
NÚe
,

186 
f›lds
=[

187 
_desütÜ
.
	`F›ldDesütÜ
(

188 
Çme
='Ë¬nšg_¿‹', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.AdamO±imiz”.Ë¬nšg_¿‹', 
šdex
=0,

189 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

190 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

191 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

192 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

193 
İtiÚs
=
NÚe
),

195 
ex‹nsiÚs
=[

197 
Ã¡ed_ty³s
=[],

198 
’um_ty³s
=[

200 
İtiÚs
=
NÚe
,

201 
is_ex‹ndabË
=
F®£
,

202 
syÁax
='proto2',

203 
ex‹nsiÚ_¿nges
=[],

204 
Úeofs
=[

206 
£rŸlized_¡¬t
=664,

207 
£rŸlized_’d
=741,

211 
_LEARNINGRATE
 = 
_desütÜ
.
	`DesütÜ
(

212 
Çme
='LearningRate',

213 
fuÎ_Çme
='object_detection.protos.LearningRate',

214 
f’ame
=
NÚe
,

215 
fe
=
DESCRIPTOR
,

216 
cÚššg_ty³
=
NÚe
,

217 
f›lds
=[

218 
_desütÜ
.
	`F›ldDesütÜ
(

219 
Çme
='cÚ¡ªt_Ë¬nšg_¿‹', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.L—ºšgR©e.cÚ¡ªt_Ë¬nšg_¿‹', 
šdex
=0,

220 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

221 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

222 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

223 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

224 
İtiÚs
=
NÚe
),

225 
_desütÜ
.
	`F›ldDesütÜ
(

226 
Çme
='expÚ’tŸl_deÿy_Ë¬nšg_¿‹', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.L—ºšgR©e.expÚ’tŸl_deÿy_Ë¬nšg_¿‹', 
šdex
=1,

227 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

228 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

229 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

230 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

231 
İtiÚs
=
NÚe
),

232 
_desütÜ
.
	`F›ldDesütÜ
(

233 
Çme
='mªu®_¡•_Ë¬nšg_¿‹', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.L—ºšgR©e.mªu®_¡•_Ë¬nšg_¿‹', 
šdex
=2,

234 
numb”
=3, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

235 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

236 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

237 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

238 
İtiÚs
=
NÚe
),

240 
ex‹nsiÚs
=[

242 
Ã¡ed_ty³s
=[],

243 
’um_ty³s
=[

245 
İtiÚs
=
NÚe
,

246 
is_ex‹ndabË
=
F®£
,

247 
syÁax
='proto2',

248 
ex‹nsiÚ_¿nges
=[],

249 
Úeofs
=[

250 
_desütÜ
.
	`OÃofDesütÜ
(

251 
Çme
='Ë¬nšg_¿‹', 
fuÎ_Çme
='object_detection.protos.LearningRate.learning_rate',

252 
šdex
=0, 
cÚššg_ty³
=
NÚe
, 
f›lds
=[]),

254 
£rŸlized_¡¬t
=744,

255 
£rŸlized_’d
=1040,

259 
_CONSTANTLEARNINGRATE
 = 
_desütÜ
.
	`DesütÜ
(

260 
Çme
='ConstantLearningRate',

261 
fuÎ_Çme
='object_detection.protos.ConstantLearningRate',

262 
f’ame
=
NÚe
,

263 
fe
=
DESCRIPTOR
,

264 
cÚššg_ty³
=
NÚe
,

265 
f›lds
=[

266 
_desütÜ
.
	`F›ldDesütÜ
(

267 
Çme
='Ë¬nšg_¿‹', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.CÚ¡ªtL—ºšgR©e.Ë¬nšg_¿‹', 
šdex
=0,

268 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

269 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.002),

270 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

271 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

272 
İtiÚs
=
NÚe
),

274 
ex‹nsiÚs
=[

276 
Ã¡ed_ty³s
=[],

277 
’um_ty³s
=[

279 
İtiÚs
=
NÚe
,

280 
is_ex‹ndabË
=
F®£
,

281 
syÁax
='proto2',

282 
ex‹nsiÚ_¿nges
=[],

283 
Úeofs
=[

285 
£rŸlized_¡¬t
=1042,

286 
£rŸlized_’d
=1094,

290 
_EXPONENTIALDECAYLEARNINGRATE
 = 
_desütÜ
.
	`DesütÜ
(

291 
Çme
='ExponentialDecayLearningRate',

292 
fuÎ_Çme
='object_detection.protos.ExponentialDecayLearningRate',

293 
f’ame
=
NÚe
,

294 
fe
=
DESCRIPTOR
,

295 
cÚššg_ty³
=
NÚe
,

296 
f›lds
=[

297 
_desütÜ
.
	`F›ldDesütÜ
(

298 
Çme
='š™Ÿl_Ë¬nšg_¿‹', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.ExpÚ’tŸlDeÿyL—ºšgR©e.š™Ÿl_Ë¬nšg_¿‹', 
šdex
=0,

299 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

300 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.002),

301 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

302 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

303 
İtiÚs
=
NÚe
),

304 
_desütÜ
.
	`F›ldDesütÜ
(

305 
Çme
='deÿy_¡•s', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.ExpÚ’tŸlDeÿyL—ºšgR©e.deÿy_¡•s', 
šdex
=1,

306 
numb”
=2, 
ty³
=13, 
ıp_ty³
=3, 
Ïb–
=1,

307 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=4000000,

308 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

309 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

310 
İtiÚs
=
NÚe
),

311 
_desütÜ
.
	`F›ldDesütÜ
(

312 
Çme
='deÿy_çùÜ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.ExpÚ’tŸlDeÿyL—ºšgR©e.deÿy_çùÜ', 
šdex
=2,

313 
numb”
=3, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

314 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.95),

315 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

316 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

317 
İtiÚs
=
NÚe
),

318 
_desütÜ
.
	`F›ldDesütÜ
(

319 
Çme
='¡aœÿ£', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.ExpÚ’tŸlDeÿyL—ºšgR©e.¡aœÿ£', 
šdex
=3,

320 
numb”
=4, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

321 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=True,

322 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

323 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

324 
İtiÚs
=
NÚe
),

326 
ex‹nsiÚs
=[

328 
Ã¡ed_ty³s
=[],

329 
’um_ty³s
=[

331 
İtiÚs
=
NÚe
,

332 
is_ex‹ndabË
=
F®£
,

333 
syÁax
='proto2',

334 
ex‹nsiÚ_¿nges
=[],

335 
Úeofs
=[

337 
£rŸlized_¡¬t
=1097,

338 
£rŸlized_’d
=1248,

342 
_MANUALSTEPLEARNINGRATE_LEARNINGRATESCHEDULE
 = 
_desütÜ
.
	`DesütÜ
(

343 
Çme
='LearningRateSchedule',

344 
fuÎ_Çme
='object_detection.protos.ManualStepLearningRate.LearningRateSchedule',

345 
f’ame
=
NÚe
,

346 
fe
=
DESCRIPTOR
,

347 
cÚššg_ty³
=
NÚe
,

348 
f›lds
=[

349 
_desütÜ
.
	`F›ldDesütÜ
(

350 
Çme
='¡•', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Mªu®S‹pL—ºšgR©e.L—ºšgR©eScheduË.¡•', 
šdex
=0,

351 
numb”
=1, 
ty³
=13, 
ıp_ty³
=3, 
Ïb–
=1,

352 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=0,

353 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

354 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

355 
İtiÚs
=
NÚe
),

356 
_desütÜ
.
	`F›ldDesütÜ
(

357 
Çme
='Ë¬nšg_¿‹', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Mªu®S‹pL—ºšgR©e.L—ºšgR©eScheduË.Ë¬nšg_¿‹', 
šdex
=1,

358 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

359 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.002),

360 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

361 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

362 
İtiÚs
=
NÚe
),

364 
ex‹nsiÚs
=[

366 
Ã¡ed_ty³s
=[],

367 
’um_ty³s
=[

369 
İtiÚs
=
NÚe
,

370 
is_ex‹ndabË
=
F®£
,

371 
syÁax
='proto2',

372 
ex‹nsiÚ_¿nges
=[],

373 
Úeofs
=[

375 
£rŸlized_¡¬t
=1403,

376 
£rŸlized_’d
=1469,

379 
_MANUALSTEPLEARNINGRATE
 = 
_desütÜ
.
	`DesütÜ
(

380 
Çme
='ManualStepLearningRate',

381 
fuÎ_Çme
='object_detection.protos.ManualStepLearningRate',

382 
f’ame
=
NÚe
,

383 
fe
=
DESCRIPTOR
,

384 
cÚššg_ty³
=
NÚe
,

385 
f›lds
=[

386 
_desütÜ
.
	`F›ldDesütÜ
(

387 
Çme
='š™Ÿl_Ë¬nšg_¿‹', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Mªu®S‹pL—ºšgR©e.š™Ÿl_Ë¬nšg_¿‹', 
šdex
=0,

388 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

389 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.002),

390 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

391 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

392 
İtiÚs
=
NÚe
),

393 
_desütÜ
.
	`F›ldDesütÜ
(

394 
Çme
='scheduË', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Mªu®S‹pL—ºšgR©e.scheduË', 
šdex
=1,

395 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=3,

396 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=[],

397 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

398 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

399 
İtiÚs
=
NÚe
),

401 
ex‹nsiÚs
=[

403 
Ã¡ed_ty³s
=[
_MANUALSTEPLEARNINGRATE_LEARNINGRATESCHEDULE
, ],

404 
’um_ty³s
=[

406 
İtiÚs
=
NÚe
,

407 
is_ex‹ndabË
=
F®£
,

408 
syÁax
='proto2',

409 
ex‹nsiÚ_¿nges
=[],

410 
Úeofs
=[

412 
£rŸlized_¡¬t
=1251,

413 
£rŸlized_’d
=1469,

416 
_OPTIMIZER
.
f›lds_by_Çme
['rms_´İ_İtimiz”'].
mes§ge_ty³
 = 
_RMSPROPOPTIMIZER


417 
_OPTIMIZER
.
f›lds_by_Çme
['mom’tum_İtimiz”'].
mes§ge_ty³
 = 
_MOMENTUMOPTIMIZER


418 
_OPTIMIZER
.
f›lds_by_Çme
['adam_İtimiz”'].
mes§ge_ty³
 = 
_ADAMOPTIMIZER


419 
_OPTIMIZER
.
Úeofs_by_Çme
['İtimiz”'].
f›lds
.
	`­³nd
(

420 
_OPTIMIZER
.
f›lds_by_Çme
['rms_prop_optimizer'])

421 
_OPTIMIZER
.
f›lds_by_Çme
['rms_´İ_İtimiz”'].
cÚššg_Úeof
 = _OPTIMIZER.
Úeofs_by_Çme
['optimizer']

422 
_OPTIMIZER
.
Úeofs_by_Çme
['İtimiz”'].
f›lds
.
	`­³nd
(

423 
_OPTIMIZER
.
f›lds_by_Çme
['momentum_optimizer'])

424 
_OPTIMIZER
.
f›lds_by_Çme
['mom’tum_İtimiz”'].
cÚššg_Úeof
 = _OPTIMIZER.
Úeofs_by_Çme
['optimizer']

425 
_OPTIMIZER
.
Úeofs_by_Çme
['İtimiz”'].
f›lds
.
	`­³nd
(

426 
_OPTIMIZER
.
f›lds_by_Çme
['adam_optimizer'])

427 
_OPTIMIZER
.
f›lds_by_Çme
['adam_İtimiz”'].
cÚššg_Úeof
 = _OPTIMIZER.
Úeofs_by_Çme
['optimizer']

428 
_RMSPROPOPTIMIZER
.
f›lds_by_Çme
['Ë¬nšg_¿‹'].
mes§ge_ty³
 = 
_LEARNINGRATE


429 
_MOMENTUMOPTIMIZER
.
f›lds_by_Çme
['Ë¬nšg_¿‹'].
mes§ge_ty³
 = 
_LEARNINGRATE


430 
_ADAMOPTIMIZER
.
f›lds_by_Çme
['Ë¬nšg_¿‹'].
mes§ge_ty³
 = 
_LEARNINGRATE


431 
_LEARNINGRATE
.
f›lds_by_Çme
['cÚ¡ªt_Ë¬nšg_¿‹'].
mes§ge_ty³
 = 
_CONSTANTLEARNINGRATE


432 
_LEARNINGRATE
.
f›lds_by_Çme
['expÚ’tŸl_deÿy_Ë¬nšg_¿‹'].
mes§ge_ty³
 = 
_EXPONENTIALDECAYLEARNINGRATE


433 
_LEARNINGRATE
.
f›lds_by_Çme
['mªu®_¡•_Ë¬nšg_¿‹'].
mes§ge_ty³
 = 
_MANUALSTEPLEARNINGRATE


434 
_LEARNINGRATE
.
Úeofs_by_Çme
['Ë¬nšg_¿‹'].
f›lds
.
	`­³nd
(

435 
_LEARNINGRATE
.
f›lds_by_Çme
['constant_learning_rate'])

436 
_LEARNINGRATE
.
f›lds_by_Çme
['cÚ¡ªt_Ë¬nšg_¿‹'].
cÚššg_Úeof
 = _LEARNINGRATE.
Úeofs_by_Çme
['learning_rate']

437 
_LEARNINGRATE
.
Úeofs_by_Çme
['Ë¬nšg_¿‹'].
f›lds
.
	`­³nd
(

438 
_LEARNINGRATE
.
f›lds_by_Çme
['exponential_decay_learning_rate'])

439 
_LEARNINGRATE
.
f›lds_by_Çme
['expÚ’tŸl_deÿy_Ë¬nšg_¿‹'].
cÚššg_Úeof
 = _LEARNINGRATE.
Úeofs_by_Çme
['learning_rate']

440 
_LEARNINGRATE
.
Úeofs_by_Çme
['Ë¬nšg_¿‹'].
f›lds
.
	`­³nd
(

441 
_LEARNINGRATE
.
f›lds_by_Çme
['manual_step_learning_rate'])

442 
_LEARNINGRATE
.
f›lds_by_Çme
['mªu®_¡•_Ë¬nšg_¿‹'].
cÚššg_Úeof
 = _LEARNINGRATE.
Úeofs_by_Çme
['learning_rate']

443 
_MANUALSTEPLEARNINGRATE_LEARNINGRATESCHEDULE
.
cÚššg_ty³
 = 
_MANUALSTEPLEARNINGRATE


444 
_MANUALSTEPLEARNINGRATE
.
f›lds_by_Çme
['scheduË'].
mes§ge_ty³
 = 
_MANUALSTEPLEARNINGRATE_LEARNINGRATESCHEDULE


445 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['O±imiz”'] = 
_OPTIMIZER


446 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RMSPrİO±imiz”'] = 
_RMSPROPOPTIMIZER


447 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Mom’tumO±imiz”'] = 
_MOMENTUMOPTIMIZER


448 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['AdamO±imiz”'] = 
_ADAMOPTIMIZER


449 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['L—ºšgR©e'] = 
_LEARNINGRATE


450 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['CÚ¡ªtL—ºšgR©e'] = 
_CONSTANTLEARNINGRATE


451 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['ExpÚ’tŸlDeÿyL—ºšgR©e'] = 
_EXPONENTIALDECAYLEARNINGRATE


452 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Mªu®S‹pL—ºšgR©e'] = 
_MANUALSTEPLEARNINGRATE


453 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

455 
O±imiz”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('O±imiz”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

456 
DESCRIPTOR
 = 
_OPTIMIZER
,

457 
__moduË__
 = 'object_detection.protos.optimizer_pb2'

458 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
O±imiz”
)

460 
_sym_db
.
	$Regi¡”Mes§ge
(
O±imiz”
)

462 
RMSPrİO±imiz”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RMSPrİO±imiz”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

463 
DESCRIPTOR
 = 
_RMSPROPOPTIMIZER
,

464 
__moduË__
 = 'object_detection.protos.optimizer_pb2'

465 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RMSPrİO±imiz”
)

467 
_sym_db
.
	$Regi¡”Mes§ge
(
RMSPrİO±imiz”
)

469 
Mom’tumO±imiz”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Mom’tumO±imiz”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

470 
DESCRIPTOR
 = 
_MOMENTUMOPTIMIZER
,

471 
__moduË__
 = 'object_detection.protos.optimizer_pb2'

472 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Mom’tumO±imiz”
)

474 
_sym_db
.
	$Regi¡”Mes§ge
(
Mom’tumO±imiz”
)

476 
AdamO±imiz”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('AdamO±imiz”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

477 
DESCRIPTOR
 = 
_ADAMOPTIMIZER
,

478 
__moduË__
 = 'object_detection.protos.optimizer_pb2'

479 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
AdamO±imiz”
)

481 
_sym_db
.
	$Regi¡”Mes§ge
(
AdamO±imiz”
)

483 
L—ºšgR©e
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('L—ºšgR©e', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

484 
DESCRIPTOR
 = 
_LEARNINGRATE
,

485 
__moduË__
 = 'object_detection.protos.optimizer_pb2'

486 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
L—ºšgR©e
)

488 
_sym_db
.
	$Regi¡”Mes§ge
(
L—ºšgR©e
)

490 
CÚ¡ªtL—ºšgR©e
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('CÚ¡ªtL—ºšgR©e', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

491 
DESCRIPTOR
 = 
_CONSTANTLEARNINGRATE
,

492 
__moduË__
 = 'object_detection.protos.optimizer_pb2'

493 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
CÚ¡ªtL—ºšgR©e
)

495 
_sym_db
.
	$Regi¡”Mes§ge
(
CÚ¡ªtL—ºšgR©e
)

497 
ExpÚ’tŸlDeÿyL—ºšgR©e
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('ExpÚ’tŸlDeÿyL—ºšgR©e', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

498 
DESCRIPTOR
 = 
_EXPONENTIALDECAYLEARNINGRATE
,

499 
__moduË__
 = 'object_detection.protos.optimizer_pb2'

500 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
ExpÚ’tŸlDeÿyL—ºšgR©e
)

502 
_sym_db
.
	$Regi¡”Mes§ge
(
ExpÚ’tŸlDeÿyL—ºšgR©e
)

504 
Mªu®S‹pL—ºšgR©e
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Mªu®S‹pL—ºšgR©e', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

506 
L—ºšgR©eScheduË
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('L—ºšgR©eScheduË', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

507 
DESCRIPTOR
 = 
_MANUALSTEPLEARNINGRATE_LEARNINGRATESCHEDULE
,

508 
__moduË__
 = 'object_detection.protos.optimizer_pb2'

509 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Mªu®S‹pL—ºšgR©e
.
L—ºšgR©eScheduË
)

512 
DESCRIPTOR
 = 
_MANUALSTEPLEARNINGRATE
,

513 
__moduË__
 = 'object_detection.protos.optimizer_pb2'

514 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Mªu®S‹pL—ºšgR©e
)

516 
_sym_db
.
	$Regi¡”Mes§ge
(
Mªu®S‹pL—ºšgR©e
)

517 
_sym_db
.
	$Regi¡”Mes§ge
(
Mªu®S‹pL—ºšgR©e
.
L—ºšgR©eScheduË
)

520 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/pipeline_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
p–še
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

16 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
ev®_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ev®__pb2


17 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
šput_»ad”_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_šput__»ad”__pb2


18 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
mod–_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_mod–__pb2


19 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
Œaš_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_Œaš__pb2


22 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

23 
Çme
='object_detection/protos/pipeline.proto',

24 
·ckage
='object_detection.protos',

25 
syÁax
='proto2',

26 
£rŸlized_pb
=
	`_b
('\n&object_detection/protos/pipeline.proto\x12\x17object_detection.protos\x1a\"object_detection/protos/eval.proto\x1a*object_detection/protos/input_reader.proto\x1a#object_detection/protos/model.proto\x1a#object_detection/protos/train.proto\"\xca\x02\n\x17TrainEvalPipelineConfig\x12\x36\n\x05model\x18\x01 \x01(\x0b\x32\'.object_detection.protos.DetectionModel\x12:\n\x0ctrain_config\x18\x02 \x01(\x0b\x32$.object_detection.protos.TrainConfig\x12@\n\x12train_input_reader\x18\x03 \x01(\x0b\x32$.object_detection.protos.InputReader\x12\x38\n\x0b\x65val_config\x18\x04 \x01(\x0b\x32#.object_detection.protos.EvalConfig\x12?\n\x11\x65val_input_reader\x18\x05 \x01(\x0b\x32$.object_detection.protos.InputReader')

28 
d•’d’c›s
=[
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ev®__pb2
.
DESCRIPTOR
,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_šput__»ad”__pb2
.DESCRIPTOR,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_mod–__pb2
.DESCRIPTOR,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_Œaš__pb2
.DESCRIPTOR,])

33 
_TRAINEVALPIPELINECONFIG
 = 
_desütÜ
.
	`DesütÜ
(

34 
Çme
='TrainEvalPipelineConfig',

35 
fuÎ_Çme
='object_detection.protos.TrainEvalPipelineConfig',

36 
f’ame
=
NÚe
,

37 
fe
=
DESCRIPTOR
,

38 
cÚššg_ty³
=
NÚe
,

39 
f›lds
=[

40 
_desütÜ
.
	`F›ldDesütÜ
(

41 
Çme
='mod–', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šEv®P–šeCÚfig.mod–', 
šdex
=0,

42 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

43 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

44 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

45 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

46 
İtiÚs
=
NÚe
),

47 
_desütÜ
.
	`F›ldDesütÜ
(

48 
Çme
='Œaš_cÚfig', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šEv®P–šeCÚfig.Œaš_cÚfig', 
šdex
=1,

49 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

50 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

51 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

52 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

53 
İtiÚs
=
NÚe
),

54 
_desütÜ
.
	`F›ldDesütÜ
(

55 
Çme
='Œaš_šput_»ad”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šEv®P–šeCÚfig.Œaš_šput_»ad”', 
šdex
=2,

56 
numb”
=3, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

57 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

58 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

59 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

60 
İtiÚs
=
NÚe
),

61 
_desütÜ
.
	`F›ldDesütÜ
(

62 
Çme
='ev®_cÚfig', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šEv®P–šeCÚfig.ev®_cÚfig', 
šdex
=3,

63 
numb”
=4, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

64 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

65 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

66 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

67 
İtiÚs
=
NÚe
),

68 
_desütÜ
.
	`F›ldDesütÜ
(

69 
Çme
='ev®_šput_»ad”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šEv®P–šeCÚfig.ev®_šput_»ad”', 
šdex
=4,

70 
numb”
=5, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

71 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

72 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

73 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

74 
İtiÚs
=
NÚe
),

76 
ex‹nsiÚs
=[

78 
Ã¡ed_ty³s
=[],

79 
’um_ty³s
=[

81 
İtiÚs
=
NÚe
,

82 
is_ex‹ndabË
=
F®£
,

83 
syÁax
='proto2',

84 
ex‹nsiÚ_¿nges
=[],

85 
Úeofs
=[

87 
£rŸlized_¡¬t
=222,

88 
£rŸlized_’d
=552,

91 
_TRAINEVALPIPELINECONFIG
.
f›lds_by_Çme
['mod–'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_mod–__pb2
.
_DETECTIONMODEL


92 
_TRAINEVALPIPELINECONFIG
.
f›lds_by_Çme
['Œaš_cÚfig'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_Œaš__pb2
.
_TRAINCONFIG


93 
_TRAINEVALPIPELINECONFIG
.
f›lds_by_Çme
['Œaš_šput_»ad”'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_šput__»ad”__pb2
.
_INPUTREADER


94 
_TRAINEVALPIPELINECONFIG
.
f›lds_by_Çme
['ev®_cÚfig'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ev®__pb2
.
_EVALCONFIG


95 
_TRAINEVALPIPELINECONFIG
.
f›lds_by_Çme
['ev®_šput_»ad”'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_šput__»ad”__pb2
.
_INPUTREADER


96 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['T¿šEv®P–šeCÚfig'] = 
_TRAINEVALPIPELINECONFIG


97 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

99 
T¿šEv®P–šeCÚfig
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('T¿šEv®P–šeCÚfig', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

100 
DESCRIPTOR
 = 
_TRAINEVALPIPELINECONFIG
,

101 
__moduË__
 = 'object_detection.protos.pipeline_pb2'

102 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
T¿šEv®P–šeCÚfig
)

104 
_sym_db
.
	$Regi¡”Mes§ge
(
T¿šEv®P–šeCÚfig
)

107 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/post_processing_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
po¡_´oûssšg
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

18 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

19 
Çme
='object_detection/protos/post_processing.proto',

20 
·ckage
='object_detection.protos',

21 
syÁax
='proto2',

22 
£rŸlized_pb
=
	`_b
('\n-object_detection/protos/post_processing.proto\x12\x17object_detection.protos\"\x9a\x01\n\x16\x42\x61tchNonMaxSuppression\x12\x1a\n\x0fscore_threshold\x18\x01 \x01(\x02:\x01\x30\x12\x1a\n\riou_threshold\x18\x02 \x01(\x02:\x03\x30.6\x12%\n\x18max_detections_per_class\x18\x03 \x01(\x05:\x03\x31\x30\x30\x12!\n\x14max_total_detections\x18\x05 \x01(\x05:\x03\x31\x30\x30\"\xf9\x01\n\x0ePostProcessing\x12R\n\x19\x62\x61tch_non_max_suppression\x18\x01 \x01(\x0b\x32/.object_detection.protos.BatchNonMaxSuppression\x12Y\n\x0fscore_converter\x18\x02 \x01(\x0e\x32\x36.object_detection.protos.PostProcessing.ScoreConverter:\x08IDENTITY\"8\n\x0eScoreConverter\x12\x0c\n\x08IDENTITY\x10\x00\x12\x0b\n\x07SIGMOID\x10\x01\x12\x0b\n\x07SOFTMAX\x10\x02')

27 
_POSTPROCESSING_SCORECONVERTER
 = 
_desütÜ
.
	`EnumDesütÜ
(

28 
Çme
='ScoreConverter',

29 
fuÎ_Çme
='object_detection.protos.PostProcessing.ScoreConverter',

30 
f’ame
=
NÚe
,

31 
fe
=
DESCRIPTOR
,

32 
v®ues
=[

33 
_desütÜ
.
	`EnumV®ueDesütÜ
(

34 
Çme
='IDENTITY', 
šdex
=0, 
numb”
=0,

35 
İtiÚs
=
NÚe
,

36 
ty³
=
NÚe
),

37 
_desütÜ
.
	`EnumV®ueDesütÜ
(

38 
Çme
='SIGMOID', 
šdex
=1, 
numb”
=1,

39 
İtiÚs
=
NÚe
,

40 
ty³
=
NÚe
),

41 
_desütÜ
.
	`EnumV®ueDesütÜ
(

42 
Çme
='SOFTMAX', 
šdex
=2, 
numb”
=2,

43 
İtiÚs
=
NÚe
,

44 
ty³
=
NÚe
),

46 
cÚššg_ty³
=
NÚe
,

47 
İtiÚs
=
NÚe
,

48 
£rŸlized_¡¬t
=425,

49 
£rŸlized_’d
=481,

51 
_sym_db
.
	$Regi¡”EnumDesütÜ
(
_POSTPROCESSING_SCORECONVERTER
)

54 
_BATCHNONMAXSUPPRESSION
 = 
_desütÜ
.
	`DesütÜ
(

55 
Çme
='BatchNonMaxSuppression',

56 
fuÎ_Çme
='object_detection.protos.BatchNonMaxSuppression',

57 
f’ame
=
NÚe
,

58 
fe
=
DESCRIPTOR
,

59 
cÚššg_ty³
=
NÚe
,

60 
f›lds
=[

61 
_desütÜ
.
	`F›ldDesütÜ
(

62 
Çme
='scÜe_th»shŞd', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.B©chNÚMaxSuµ»ssiÚ.scÜe_th»shŞd', 
šdex
=0,

63 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

64 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0),

65 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

66 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

67 
İtiÚs
=
NÚe
),

68 
_desütÜ
.
	`F›ldDesütÜ
(

69 
Çme
='iou_th»shŞd', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.B©chNÚMaxSuµ»ssiÚ.iou_th»shŞd', 
šdex
=1,

70 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

71 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.6),

72 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

73 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

74 
İtiÚs
=
NÚe
),

75 
_desütÜ
.
	`F›ldDesütÜ
(

76 
Çme
='max_d‘eùiÚs_³r_şass', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.B©chNÚMaxSuµ»ssiÚ.max_d‘eùiÚs_³r_şass', 
šdex
=2,

77 
numb”
=3, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

78 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=100,

79 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

80 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

81 
İtiÚs
=
NÚe
),

82 
_desütÜ
.
	`F›ldDesütÜ
(

83 
Çme
='max_tÙ®_d‘eùiÚs', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.B©chNÚMaxSuµ»ssiÚ.max_tÙ®_d‘eùiÚs', 
šdex
=3,

84 
numb”
=5, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

85 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=100,

86 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

87 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

88 
İtiÚs
=
NÚe
),

90 
ex‹nsiÚs
=[

92 
Ã¡ed_ty³s
=[],

93 
’um_ty³s
=[

95 
İtiÚs
=
NÚe
,

96 
is_ex‹ndabË
=
F®£
,

97 
syÁax
='proto2',

98 
ex‹nsiÚ_¿nges
=[],

99 
Úeofs
=[

101 
£rŸlized_¡¬t
=75,

102 
£rŸlized_’d
=229,

106 
_POSTPROCESSING
 = 
_desütÜ
.
	`DesütÜ
(

107 
Çme
='PostProcessing',

108 
fuÎ_Çme
='object_detection.protos.PostProcessing',

109 
f’ame
=
NÚe
,

110 
fe
=
DESCRIPTOR
,

111 
cÚššg_ty³
=
NÚe
,

112 
f›lds
=[

113 
_desütÜ
.
	`F›ldDesütÜ
(

114 
Çme
='b©ch_nÚ_max_suµ»ssiÚ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Po¡Proûssšg.b©ch_nÚ_max_suµ»ssiÚ', 
šdex
=0,

115 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

116 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

117 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

118 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

119 
İtiÚs
=
NÚe
),

120 
_desütÜ
.
	`F›ldDesütÜ
(

121 
Çme
='scÜe_cÚv”‹r', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Po¡Proûssšg.scÜe_cÚv”‹r', 
šdex
=1,

122 
numb”
=2, 
ty³
=14, 
ıp_ty³
=8, 
Ïb–
=1,

123 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=0,

124 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

125 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

126 
İtiÚs
=
NÚe
),

128 
ex‹nsiÚs
=[

130 
Ã¡ed_ty³s
=[],

131 
’um_ty³s
=[

132 
_POSTPROCESSING_SCORECONVERTER
,

134 
İtiÚs
=
NÚe
,

135 
is_ex‹ndabË
=
F®£
,

136 
syÁax
='proto2',

137 
ex‹nsiÚ_¿nges
=[],

138 
Úeofs
=[

140 
£rŸlized_¡¬t
=232,

141 
£rŸlized_’d
=481,

144 
_POSTPROCESSING
.
f›lds_by_Çme
['b©ch_nÚ_max_suµ»ssiÚ'].
mes§ge_ty³
 = 
_BATCHNONMAXSUPPRESSION


145 
_POSTPROCESSING
.
f›lds_by_Çme
['scÜe_cÚv”‹r'].
’um_ty³
 = 
_POSTPROCESSING_SCORECONVERTER


146 
_POSTPROCESSING_SCORECONVERTER
.
cÚššg_ty³
 = 
_POSTPROCESSING


147 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['B©chNÚMaxSuµ»ssiÚ'] = 
_BATCHNONMAXSUPPRESSION


148 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Po¡Proûssšg'] = 
_POSTPROCESSING


149 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

151 
B©chNÚMaxSuµ»ssiÚ
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('B©chNÚMaxSuµ»ssiÚ', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

152 
DESCRIPTOR
 = 
_BATCHNONMAXSUPPRESSION
,

153 
__moduË__
 = 'object_detection.protos.post_processing_pb2'

154 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
B©chNÚMaxSuµ»ssiÚ
)

156 
_sym_db
.
	$Regi¡”Mes§ge
(
B©chNÚMaxSuµ»ssiÚ
)

158 
Po¡Proûssšg
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Po¡Proûssšg', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

159 
DESCRIPTOR
 = 
_POSTPROCESSING
,

160 
__moduË__
 = 'object_detection.protos.post_processing_pb2'

161 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Po¡Proûssšg
)

163 
_sym_db
.
	$Regi¡”Mes§ge
(
Po¡Proûssšg
)

166 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/preprocessor_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
´•roûssÜ
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

18 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

19 
Çme
='object_detection/protos/preprocessor.proto',

20 
·ckage
='object_detection.protos',

21 
syÁax
='proto2',

22 
£rŸlized_pb
=
	`_b
('\n*object_detection/protos/preprocessor.proto\x12\x17object_detection.protos\"\xad\x0e\n\x11PreprocessingStep\x12\x42\n\x0fnormalize_image\x18\x01 \x01(\x0b\x32\'.object_detection.protos.NormalizeImageH\x00\x12O\n\x16random_horizontal_flip\x18\x02 \x01(\x0b\x32-.object_detection.protos.RandomHorizontalFlipH\x00\x12R\n\x18random_pixel_value_scale\x18\x03 \x01(\x0b\x32..object_detection.protos.RandomPixelValueScaleH\x00\x12G\n\x12random_image_scale\x18\x04 \x01(\x0b\x32).object_detection.protos.RandomImageScaleH\x00\x12\x46\n\x12random_rgb_to_gray\x18\x05 \x01(\x0b\x32(.object_detection.protos.RandomRGBtoGrayH\x00\x12S\n\x18random_adjust_brightness\x18\x06 \x01(\x0b\x32/.object_detection.protos.RandomAdjustBrightnessH\x00\x12O\n\x16random_adjust_contrast\x18\x07 \x01(\x0b\x32-.object_detection.protos.RandomAdjustContrastH\x00\x12\x45\n\x11random_adjust_hue\x18\x08 \x01(\x0b\x32(.object_detection.protos.RandomAdjustHueH\x00\x12S\n\x18random_adjust_saturation\x18\t \x01(\x0b\x32/.object_detection.protos.RandomAdjustSaturationH\x00\x12K\n\x14random_distort_color\x18\n \x01(\x0b\x32+.object_detection.protos.RandomDistortColorH\x00\x12I\n\x13random_jitter_boxes\x18\x0b \x01(\x0b\x32*.object_detection.protos.RandomJitterBoxesH\x00\x12\x45\n\x11random_crop_image\x18\x0c \x01(\x0b\x32(.object_detection.protos.RandomCropImageH\x00\x12\x43\n\x10random_pad_image\x18\r \x01(\x0b\x32\'.object_detection.protos.RandomPadImageH\x00\x12L\n\x15random_crop_pad_image\x18\x0e \x01(\x0b\x32+.object_detection.protos.RandomCropPadImageH\x00\x12W\n\x1brandom_crop_to_aspect_ratio\x18\x0f \x01(\x0b\x32\x30.object_detection.protos.RandomCropToAspectRatioH\x00\x12K\n\x14random_black_patches\x18\x10 \x01(\x0b\x32+.object_detection.protos.RandomBlackPatchesH\x00\x12K\n\x14random_resize_method\x18\x11 \x01(\x0b\x32+.object_detection.protos.RandomResizeMethodH\x00\x12\x61\n scale_boxes_to_pixel_coordinates\x18\x12 \x01(\x0b\x32\x35.object_detection.protos.ScaleBoxesToPixelCoordinatesH\x00\x12<\n\x0cresize_image\x18\x13 \x01(\x0b\x32$.object_detection.protos.ResizeImageH\x00\x12M\n\x15subtract_channel_mean\x18\x14 \x01(\x0b\x32,.object_detection.protos.SubtractChannelMeanH\x00\x12\x41\n\x0fssd_random_crop\x18\x15 \x01(\x0b\x32&.object_detection.protos.SSDRandomCropH\x00\x12H\n\x13ssd_random_crop_pad\x18\x16 \x01(\x0b\x32).object_detection.protos.SSDRandomCropPadH\x00\x12\x64\n\"ssd_random_crop_fixed_aspect_ratio\x18\x17 \x01(\x0b\x32\x36.object_detection.protos.SSDRandomCropFixedAspectRatioH\x00\x42\x14\n\x12preprocessing_step\"v\n\x0eNormalizeImage\x12\x17\n\x0foriginal_minval\x18\x01 \x01(\x02\x12\x17\n\x0foriginal_maxval\x18\x02 \x01(\x02\x12\x18\n\rtarget_minval\x18\x03 \x01(\x02:\x01\x30\x12\x18\n\rtarget_maxval\x18\x04 \x01(\x02:\x01\x31\"\x16\n\x14RandomHorizontalFlip\"A\n\x15RandomPixelValueScale\x12\x13\n\x06minval\x18\x01 \x01(\x02:\x03\x30.9\x12\x13\n\x06maxval\x18\x02 \x01(\x02:\x03\x31.1\"L\n\x10RandomImageScale\x12\x1c\n\x0fmin_scale_ratio\x18\x01 \x01(\x02:\x03\x30.5\x12\x1a\n\x0fmax_scale_ratio\x18\x02 \x01(\x02:\x01\x32\"+\n\x0fRandomRGBtoGray\x12\x18\n\x0bprobability\x18\x01 \x01(\x02:\x03\x30.1\"0\n\x16RandomAdjustBrightness\x12\x16\n\tmax_delta\x18\x01 \x01(\x02:\x03\x30.2\"G\n\x14RandomAdjustContrast\x12\x16\n\tmin_delta\x18\x01 \x01(\x02:\x03\x30.8\x12\x17\n\tmax_delta\x18\x02 \x01(\x02:\x04\x31.25\"*\n\x0fRandomAdjustHue\x12\x17\n\tmax_delta\x18\x01 \x01(\x02:\x04\x30.02\"I\n\x16RandomAdjustSaturation\x12\x16\n\tmin_delta\x18\x01 \x01(\x02:\x03\x30.8\x12\x17\n\tmax_delta\x18\x02 \x01(\x02:\x04\x31.25\",\n\x12RandomDistortColor\x12\x16\n\x0e\x63olor_ordering\x18\x01 \x01(\x05\"(\n\x11RandomJitterBoxes\x12\x13\n\x05ratio\x18\x01 \x01(\x02:\x04\x30.05\"\xd1\x01\n\x0fRandomCropImage\x12\x1d\n\x12min_object_covered\x18\x01 \x01(\x02:\x01\x31\x12\x1e\n\x10min_aspect_ratio\x18\x02 \x01(\x02:\x04\x30.75\x12\x1e\n\x10max_aspect_ratio\x18\x03 \x01(\x02:\x04\x31.33\x12\x15\n\x08min_area\x18\x04 \x01(\x02:\x03\x30.1\x12\x13\n\x08max_area\x18\x05 \x01(\x02:\x01\x31\x12\x1b\n\x0eoverlap_thresh\x18\x06 \x01(\x02:\x03\x30.3\x12\x16\n\x0brandom_coef\x18\x07 \x01(\x02:\x01\x30\"\x89\x01\n\x0eRandomPadImage\x12\x18\n\x10min_image_height\x18\x01 \x01(\x02\x12\x17\n\x0fmin_image_width\x18\x02 \x01(\x02\x12\x18\n\x10max_image_height\x18\x03 \x01(\x02\x12\x17\n\x0fmax_image_width\x18\x04 \x01(\x02\x12\x11\n\tpad_color\x18\x05 \x03(\x02\"\xa5\x02\n\x12RandomCropPadImage\x12\x1d\n\x12min_object_covered\x18\x01 \x01(\x02:\x01\x31\x12\x1e\n\x10min_aspect_ratio\x18\x02 \x01(\x02:\x04\x30.75\x12\x1e\n\x10max_aspect_ratio\x18\x03 \x01(\x02:\x04\x31.33\x12\x15\n\x08min_area\x18\x04 \x01(\x02:\x03\x30.1\x12\x13\n\x08max_area\x18\x05 \x01(\x02:\x01\x31\x12\x1b\n\x0eoverlap_thresh\x18\x06 \x01(\x02:\x03\x30.3\x12\x16\n\x0brandom_coef\x18\x07 \x01(\x02:\x01\x30\x12\x1d\n\x15min_padded_size_ratio\x18\x08 \x03(\x02\x12\x1d\n\x15max_padded_size_ratio\x18\t \x03(\x02\x12\x11\n\tpad_color\x18\n \x03(\x02\"O\n\x17RandomCropToAspectRatio\x12\x17\n\x0c\x61spect_ratio\x18\x01 \x01(\x02:\x01\x31\x12\x1b\n\x0eoverlap_thresh\x18\x02 \x01(\x02:\x03\x30.3\"o\n\x12RandomBlackPatches\x12\x1d\n\x11max_black_patches\x18\x01 \x01(\x05:\x02\x31\x30\x12\x18\n\x0bprobability\x18\x02 \x01(\x02:\x03\x30.5\x12 \n\x13size_to_image_ratio\x18\x03 \x01(\x02:\x03\x30.1\"A\n\x12RandomResizeMethod\x12\x15\n\rtarget_height\x18\x01 \x01(\x02\x12\x14\n\x0ctarget_width\x18\x02 \x01(\x02\"\x1e\n\x1cScaleBoxesToPixelCoordinates\"\xc0\x01\n\x0bResizeImage\x12\x12\n\nnew_height\x18\x01 \x01(\x05\x12\x11\n\tnew_width\x18\x02 \x01(\x05\x12\x45\n\x06method\x18\x03 \x01(\x0e\x32+.object_detection.protos.ResizeImage.Method:\x08\x42ILINEAR\"C\n\x06Method\x12\x08\n\x04\x41REA\x10\x01\x12\x0b\n\x07\x42ICUBIC\x10\x02\x12\x0c\n\x08\x42ILINEAR\x10\x03\x12\x14\n\x10NEAREST_NEIGHBOR\x10\x04\"$\n\x13SubtractChannelMean\x12\r\n\x05means\x18\x01 \x03(\x02\"\xb9\x01\n\x16SSDRandomCropOperation\x12\x1a\n\x12min_object_covered\x18\x01 \x01(\x02\x12\x18\n\x10min_aspect_ratio\x18\x02 \x01(\x02\x12\x18\n\x10max_aspect_ratio\x18\x03 \x01(\x02\x12\x10\n\x08min_area\x18\x04 \x01(\x02\x12\x10\n\x08max_area\x18\x05 \x01(\x02\x12\x16\n\x0eoverlap_thresh\x18\x06 \x01(\x02\x12\x13\n\x0brandom_coef\x18\x07 \x01(\x02\"T\n\rSSDRandomCrop\x12\x43\n\noperations\x18\x01 \x03(\x0b\x32/.object_detection.protos.SSDRandomCropOperation\"\xb9\x02\n\x19SSDRandomCropPadOperation\x12\x1a\n\x12min_object_covered\x18\x01 \x01(\x02\x12\x18\n\x10min_aspect_ratio\x18\x02 \x01(\x02\x12\x18\n\x10max_aspect_ratio\x18\x03 \x01(\x02\x12\x10\n\x08min_area\x18\x04 \x01(\x02\x12\x10\n\x08max_area\x18\x05 \x01(\x02\x12\x16\n\x0eoverlap_thresh\x18\x06 \x01(\x02\x12\x13\n\x0brandom_coef\x18\x07 \x01(\x02\x12\x1d\n\x15min_padded_size_ratio\x18\x08 \x03(\x02\x12\x1d\n\x15max_padded_size_ratio\x18\t \x03(\x02\x12\x13\n\x0bpad_color_r\x18\n \x01(\x02\x12\x13\n\x0bpad_color_g\x18\x0b \x01(\x02\x12\x13\n\x0bpad_color_b\x18\x0c \x01(\x02\"Z\n\x10SSDRandomCropPad\x12\x46\n\noperations\x18\x01 \x03(\x0b\x32\x32.object_detection.protos.SSDRandomCropPadOperation\"\x95\x01\n&SSDRandomCropFixedAspectRatioOperation\x12\x1a\n\x12min_object_covered\x18\x01 \x01(\x02\x12\x10\n\x08min_area\x18\x04 \x01(\x02\x12\x10\n\x08max_area\x18\x05 \x01(\x02\x12\x16\n\x0eoverlap_thresh\x18\x06 \x01(\x02\x12\x13\n\x0brandom_coef\x18\x07 \x01(\x02\"\x8d\x01\n\x1dSSDRandomCropFixedAspectRatio\x12S\n\noperations\x18\x01 \x03(\x0b\x32?.object_detection.protos.SSDRandomCropFixedAspectRatioOperation\x12\x17\n\x0c\x61spect_ratio\x18\x02 \x01(\x02:\x01\x31')

27 
_RESIZEIMAGE_METHOD
 = 
_desütÜ
.
	`EnumDesütÜ
(

28 
Çme
='Method',

29 
fuÎ_Çme
='object_detection.protos.ResizeImage.Method',

30 
f’ame
=
NÚe
,

31 
fe
=
DESCRIPTOR
,

32 
v®ues
=[

33 
_desütÜ
.
	`EnumV®ueDesütÜ
(

34 
Çme
='AREA', 
šdex
=0, 
numb”
=1,

35 
İtiÚs
=
NÚe
,

36 
ty³
=
NÚe
),

37 
_desütÜ
.
	`EnumV®ueDesütÜ
(

38 
Çme
='BICUBIC', 
šdex
=1, 
numb”
=2,

39 
İtiÚs
=
NÚe
,

40 
ty³
=
NÚe
),

41 
_desütÜ
.
	`EnumV®ueDesütÜ
(

42 
Çme
='BILINEAR', 
šdex
=2, 
numb”
=3,

43 
İtiÚs
=
NÚe
,

44 
ty³
=
NÚe
),

45 
_desütÜ
.
	`EnumV®ueDesütÜ
(

46 
Çme
='NEAREST_NEIGHBOR', 
šdex
=3, 
numb”
=4,

47 
İtiÚs
=
NÚe
,

48 
ty³
=
NÚe
),

50 
cÚššg_ty³
=
NÚe
,

51 
İtiÚs
=
NÚe
,

52 
£rŸlized_¡¬t
=3642,

53 
£rŸlized_’d
=3709,

55 
_sym_db
.
	$Regi¡”EnumDesütÜ
(
_RESIZEIMAGE_METHOD
)

58 
_PREPROCESSINGSTEP
 = 
_desütÜ
.
	`DesütÜ
(

59 
Çme
='PreprocessingStep',

60 
fuÎ_Çme
='object_detection.protos.PreprocessingStep',

61 
f’ame
=
NÚe
,

62 
fe
=
DESCRIPTOR
,

63 
cÚššg_ty³
=
NÚe
,

64 
f›lds
=[

65 
_desütÜ
.
	`F›ldDesütÜ
(

66 
Çme
='nÜm®ize_image', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.nÜm®ize_image', 
šdex
=0,

67 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

68 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

69 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

70 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

71 
İtiÚs
=
NÚe
),

72 
_desütÜ
.
	`F›ldDesütÜ
(

73 
Çme
='¿ndom_hÜizÚl_æ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.¿ndom_hÜizÚl_æ', 
šdex
=1,

74 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

75 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

76 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

77 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

78 
İtiÚs
=
NÚe
),

79 
_desütÜ
.
	`F›ldDesütÜ
(

80 
Çme
='¿ndom_pix–_v®ue_sÿË', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.¿ndom_pix–_v®ue_sÿË', 
šdex
=2,

81 
numb”
=3, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

82 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

83 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

84 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

85 
İtiÚs
=
NÚe
),

86 
_desütÜ
.
	`F›ldDesütÜ
(

87 
Çme
='¿ndom_image_sÿË', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.¿ndom_image_sÿË', 
šdex
=3,

88 
numb”
=4, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

89 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

90 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

91 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

92 
İtiÚs
=
NÚe
),

93 
_desütÜ
.
	`F›ldDesütÜ
(

94 
Çme
='¿ndom_rgb_to_g¿y', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.¿ndom_rgb_to_g¿y', 
šdex
=4,

95 
numb”
=5, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

96 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

97 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

98 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

99 
İtiÚs
=
NÚe
),

100 
_desütÜ
.
	`F›ldDesütÜ
(

101 
Çme
='¿ndom_adju¡_brighŠess', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.¿ndom_adju¡_brighŠess', 
šdex
=5,

102 
numb”
=6, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

103 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

104 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

105 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

106 
İtiÚs
=
NÚe
),

107 
_desütÜ
.
	`F›ldDesütÜ
(

108 
Çme
='¿ndom_adju¡_cÚŒa¡', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.¿ndom_adju¡_cÚŒa¡', 
šdex
=6,

109 
numb”
=7, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

110 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

111 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

112 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

113 
İtiÚs
=
NÚe
),

114 
_desütÜ
.
	`F›ldDesütÜ
(

115 
Çme
='¿ndom_adju¡_hue', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.¿ndom_adju¡_hue', 
šdex
=7,

116 
numb”
=8, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

117 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

118 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

119 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

120 
İtiÚs
=
NÚe
),

121 
_desütÜ
.
	`F›ldDesütÜ
(

122 
Çme
='¿ndom_adju¡_§tu¿tiÚ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.¿ndom_adju¡_§tu¿tiÚ', 
šdex
=8,

123 
numb”
=9, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

124 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

125 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

126 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

127 
İtiÚs
=
NÚe
),

128 
_desütÜ
.
	`F›ldDesütÜ
(

129 
Çme
='¿ndom_di¡Üt_cŞÜ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.¿ndom_di¡Üt_cŞÜ', 
šdex
=9,

130 
numb”
=10, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

131 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

132 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

133 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

134 
İtiÚs
=
NÚe
),

135 
_desütÜ
.
	`F›ldDesütÜ
(

136 
Çme
='¿ndom_j™‹r_boxes', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.¿ndom_j™‹r_boxes', 
šdex
=10,

137 
numb”
=11, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

138 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

139 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

140 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

141 
İtiÚs
=
NÚe
),

142 
_desütÜ
.
	`F›ldDesütÜ
(

143 
Çme
='¿ndom_üİ_image', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.¿ndom_üİ_image', 
šdex
=11,

144 
numb”
=12, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

145 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

146 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

147 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

148 
İtiÚs
=
NÚe
),

149 
_desütÜ
.
	`F›ldDesütÜ
(

150 
Çme
='¿ndom_·d_image', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.¿ndom_·d_image', 
šdex
=12,

151 
numb”
=13, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

152 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

153 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

154 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

155 
İtiÚs
=
NÚe
),

156 
_desütÜ
.
	`F›ldDesütÜ
(

157 
Çme
='¿ndom_üİ_·d_image', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.¿ndom_üİ_·d_image', 
šdex
=13,

158 
numb”
=14, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

159 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

160 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

161 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

162 
İtiÚs
=
NÚe
),

163 
_desütÜ
.
	`F›ldDesütÜ
(

164 
Çme
='¿ndom_üİ_to_a¥eù_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.¿ndom_üİ_to_a¥eù_¿tio', 
šdex
=14,

165 
numb”
=15, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

166 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

167 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

168 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

169 
İtiÚs
=
NÚe
),

170 
_desütÜ
.
	`F›ldDesütÜ
(

171 
Çme
='¿ndom_bÏck_·tches', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.¿ndom_bÏck_·tches', 
šdex
=15,

172 
numb”
=16, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

173 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

174 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

175 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

176 
İtiÚs
=
NÚe
),

177 
_desütÜ
.
	`F›ldDesütÜ
(

178 
Çme
='¿ndom_»size_m‘hod', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.¿ndom_»size_m‘hod', 
šdex
=16,

179 
numb”
=17, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

180 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

181 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

182 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

183 
İtiÚs
=
NÚe
),

184 
_desütÜ
.
	`F›ldDesütÜ
(

185 
Çme
='sÿË_boxes_to_pix–_coÜdš©es', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.sÿË_boxes_to_pix–_coÜdš©es', 
šdex
=17,

186 
numb”
=18, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

187 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

188 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

189 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

190 
İtiÚs
=
NÚe
),

191 
_desütÜ
.
	`F›ldDesütÜ
(

192 
Çme
='»size_image', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.»size_image', 
šdex
=18,

193 
numb”
=19, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

194 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

195 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

196 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

197 
İtiÚs
=
NÚe
),

198 
_desütÜ
.
	`F›ldDesütÜ
(

199 
Çme
='subŒaù_chªÃl_m—n', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.subŒaù_chªÃl_m—n', 
šdex
=19,

200 
numb”
=20, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

201 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

202 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

203 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

204 
İtiÚs
=
NÚe
),

205 
_desütÜ
.
	`F›ldDesütÜ
(

206 
Çme
='ssd_¿ndom_üİ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.ssd_¿ndom_üİ', 
šdex
=20,

207 
numb”
=21, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

208 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

209 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

210 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

211 
İtiÚs
=
NÚe
),

212 
_desütÜ
.
	`F›ldDesütÜ
(

213 
Çme
='ssd_¿ndom_üİ_·d', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.ssd_¿ndom_üİ_·d', 
šdex
=21,

214 
numb”
=22, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

215 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

216 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

217 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

218 
İtiÚs
=
NÚe
),

219 
_desütÜ
.
	`F›ldDesütÜ
(

220 
Çme
='ssd_¿ndom_üİ_fixed_a¥eù_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.P»´oûssšgS‹p.ssd_¿ndom_üİ_fixed_a¥eù_¿tio', 
šdex
=22,

221 
numb”
=23, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

222 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

223 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

224 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

225 
İtiÚs
=
NÚe
),

227 
ex‹nsiÚs
=[

229 
Ã¡ed_ty³s
=[],

230 
’um_ty³s
=[

232 
İtiÚs
=
NÚe
,

233 
is_ex‹ndabË
=
F®£
,

234 
syÁax
='proto2',

235 
ex‹nsiÚ_¿nges
=[],

236 
Úeofs
=[

237 
_desütÜ
.
	`OÃofDesütÜ
(

238 
Çme
='´•roûssšg_¡•', 
fuÎ_Çme
='object_detection.protos.PreprocessingStep.preprocessing_step',

239 
šdex
=0, 
cÚššg_ty³
=
NÚe
, 
f›lds
=[]),

241 
£rŸlized_¡¬t
=72,

242 
£rŸlized_’d
=1909,

246 
_NORMALIZEIMAGE
 = 
_desütÜ
.
	`DesütÜ
(

247 
Çme
='NormalizeImage',

248 
fuÎ_Çme
='object_detection.protos.NormalizeImage',

249 
f’ame
=
NÚe
,

250 
fe
=
DESCRIPTOR
,

251 
cÚššg_ty³
=
NÚe
,

252 
f›lds
=[

253 
_desütÜ
.
	`F›ldDesütÜ
(

254 
Çme
='Üigš®_mšv®', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.NÜm®izeImage.Üigš®_mšv®', 
šdex
=0,

255 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

256 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

257 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

258 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

259 
İtiÚs
=
NÚe
),

260 
_desütÜ
.
	`F›ldDesütÜ
(

261 
Çme
='Üigš®_maxv®', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.NÜm®izeImage.Üigš®_maxv®', 
šdex
=1,

262 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

263 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

264 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

265 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

266 
İtiÚs
=
NÚe
),

267 
_desütÜ
.
	`F›ldDesütÜ
(

268 
Çme
='rg‘_mšv®', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.NÜm®izeImage.rg‘_mšv®', 
šdex
=2,

269 
numb”
=3, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

270 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0),

271 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

272 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

273 
İtiÚs
=
NÚe
),

274 
_desütÜ
.
	`F›ldDesütÜ
(

275 
Çme
='rg‘_maxv®', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.NÜm®izeImage.rg‘_maxv®', 
šdex
=3,

276 
numb”
=4, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

277 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1),

278 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

279 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

280 
İtiÚs
=
NÚe
),

282 
ex‹nsiÚs
=[

284 
Ã¡ed_ty³s
=[],

285 
’um_ty³s
=[

287 
İtiÚs
=
NÚe
,

288 
is_ex‹ndabË
=
F®£
,

289 
syÁax
='proto2',

290 
ex‹nsiÚ_¿nges
=[],

291 
Úeofs
=[

293 
£rŸlized_¡¬t
=1911,

294 
£rŸlized_’d
=2029,

298 
_RANDOMHORIZONTALFLIP
 = 
_desütÜ
.
	`DesütÜ
(

299 
Çme
='RandomHorizontalFlip',

300 
fuÎ_Çme
='object_detection.protos.RandomHorizontalFlip',

301 
f’ame
=
NÚe
,

302 
fe
=
DESCRIPTOR
,

303 
cÚššg_ty³
=
NÚe
,

304 
f›lds
=[

306 
ex‹nsiÚs
=[

308 
Ã¡ed_ty³s
=[],

309 
’um_ty³s
=[

311 
İtiÚs
=
NÚe
,

312 
is_ex‹ndabË
=
F®£
,

313 
syÁax
='proto2',

314 
ex‹nsiÚ_¿nges
=[],

315 
Úeofs
=[

317 
£rŸlized_¡¬t
=2031,

318 
£rŸlized_’d
=2053,

322 
_RANDOMPIXELVALUESCALE
 = 
_desütÜ
.
	`DesütÜ
(

323 
Çme
='RandomPixelValueScale',

324 
fuÎ_Çme
='object_detection.protos.RandomPixelValueScale',

325 
f’ame
=
NÚe
,

326 
fe
=
DESCRIPTOR
,

327 
cÚššg_ty³
=
NÚe
,

328 
f›lds
=[

329 
_desütÜ
.
	`F›ldDesütÜ
(

330 
Çme
='mšv®', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomPix–V®ueSÿË.mšv®', 
šdex
=0,

331 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

332 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.9),

333 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

334 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

335 
İtiÚs
=
NÚe
),

336 
_desütÜ
.
	`F›ldDesütÜ
(

337 
Çme
='maxv®', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomPix–V®ueSÿË.maxv®', 
šdex
=1,

338 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

339 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1.1),

340 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

341 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

342 
İtiÚs
=
NÚe
),

344 
ex‹nsiÚs
=[

346 
Ã¡ed_ty³s
=[],

347 
’um_ty³s
=[

349 
İtiÚs
=
NÚe
,

350 
is_ex‹ndabË
=
F®£
,

351 
syÁax
='proto2',

352 
ex‹nsiÚ_¿nges
=[],

353 
Úeofs
=[

355 
£rŸlized_¡¬t
=2055,

356 
£rŸlized_’d
=2120,

360 
_RANDOMIMAGESCALE
 = 
_desütÜ
.
	`DesütÜ
(

361 
Çme
='RandomImageScale',

362 
fuÎ_Çme
='object_detection.protos.RandomImageScale',

363 
f’ame
=
NÚe
,

364 
fe
=
DESCRIPTOR
,

365 
cÚššg_ty³
=
NÚe
,

366 
f›lds
=[

367 
_desütÜ
.
	`F›ldDesütÜ
(

368 
Çme
='mš_sÿË_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomImageSÿË.mš_sÿË_¿tio', 
šdex
=0,

369 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

370 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.5),

371 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

372 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

373 
İtiÚs
=
NÚe
),

374 
_desütÜ
.
	`F›ldDesütÜ
(

375 
Çme
='max_sÿË_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomImageSÿË.max_sÿË_¿tio', 
šdex
=1,

376 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

377 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(2),

378 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

379 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

380 
İtiÚs
=
NÚe
),

382 
ex‹nsiÚs
=[

384 
Ã¡ed_ty³s
=[],

385 
’um_ty³s
=[

387 
İtiÚs
=
NÚe
,

388 
is_ex‹ndabË
=
F®£
,

389 
syÁax
='proto2',

390 
ex‹nsiÚ_¿nges
=[],

391 
Úeofs
=[

393 
£rŸlized_¡¬t
=2122,

394 
£rŸlized_’d
=2198,

398 
_RANDOMRGBTOGRAY
 = 
_desütÜ
.
	`DesütÜ
(

399 
Çme
='RandomRGBtoGray',

400 
fuÎ_Çme
='object_detection.protos.RandomRGBtoGray',

401 
f’ame
=
NÚe
,

402 
fe
=
DESCRIPTOR
,

403 
cÚššg_ty³
=
NÚe
,

404 
f›lds
=[

405 
_desütÜ
.
	`F›ldDesütÜ
(

406 
Çme
='´obab™y', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomRGBtoG¿y.´obab™y', 
šdex
=0,

407 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

408 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.1),

409 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

410 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

411 
İtiÚs
=
NÚe
),

413 
ex‹nsiÚs
=[

415 
Ã¡ed_ty³s
=[],

416 
’um_ty³s
=[

418 
İtiÚs
=
NÚe
,

419 
is_ex‹ndabË
=
F®£
,

420 
syÁax
='proto2',

421 
ex‹nsiÚ_¿nges
=[],

422 
Úeofs
=[

424 
£rŸlized_¡¬t
=2200,

425 
£rŸlized_’d
=2243,

429 
_RANDOMADJUSTBRIGHTNESS
 = 
_desütÜ
.
	`DesütÜ
(

430 
Çme
='RandomAdjustBrightness',

431 
fuÎ_Çme
='object_detection.protos.RandomAdjustBrightness',

432 
f’ame
=
NÚe
,

433 
fe
=
DESCRIPTOR
,

434 
cÚššg_ty³
=
NÚe
,

435 
f›lds
=[

436 
_desütÜ
.
	`F›ldDesütÜ
(

437 
Çme
='max_d–', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomAdju¡BrighŠess.max_d–', 
šdex
=0,

438 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

439 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.2),

440 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

441 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

442 
İtiÚs
=
NÚe
),

444 
ex‹nsiÚs
=[

446 
Ã¡ed_ty³s
=[],

447 
’um_ty³s
=[

449 
İtiÚs
=
NÚe
,

450 
is_ex‹ndabË
=
F®£
,

451 
syÁax
='proto2',

452 
ex‹nsiÚ_¿nges
=[],

453 
Úeofs
=[

455 
£rŸlized_¡¬t
=2245,

456 
£rŸlized_’d
=2293,

460 
_RANDOMADJUSTCONTRAST
 = 
_desütÜ
.
	`DesütÜ
(

461 
Çme
='RandomAdjustContrast',

462 
fuÎ_Çme
='object_detection.protos.RandomAdjustContrast',

463 
f’ame
=
NÚe
,

464 
fe
=
DESCRIPTOR
,

465 
cÚššg_ty³
=
NÚe
,

466 
f›lds
=[

467 
_desütÜ
.
	`F›ldDesütÜ
(

468 
Çme
='mš_d–', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomAdju¡CÚŒa¡.mš_d–', 
šdex
=0,

469 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

470 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.8),

471 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

472 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

473 
İtiÚs
=
NÚe
),

474 
_desütÜ
.
	`F›ldDesütÜ
(

475 
Çme
='max_d–', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomAdju¡CÚŒa¡.max_d–', 
šdex
=1,

476 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

477 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1.25),

478 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

479 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

480 
İtiÚs
=
NÚe
),

482 
ex‹nsiÚs
=[

484 
Ã¡ed_ty³s
=[],

485 
’um_ty³s
=[

487 
İtiÚs
=
NÚe
,

488 
is_ex‹ndabË
=
F®£
,

489 
syÁax
='proto2',

490 
ex‹nsiÚ_¿nges
=[],

491 
Úeofs
=[

493 
£rŸlized_¡¬t
=2295,

494 
£rŸlized_’d
=2366,

498 
_RANDOMADJUSTHUE
 = 
_desütÜ
.
	`DesütÜ
(

499 
Çme
='RandomAdjustHue',

500 
fuÎ_Çme
='object_detection.protos.RandomAdjustHue',

501 
f’ame
=
NÚe
,

502 
fe
=
DESCRIPTOR
,

503 
cÚššg_ty³
=
NÚe
,

504 
f›lds
=[

505 
_desütÜ
.
	`F›ldDesütÜ
(

506 
Çme
='max_d–', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomAdju¡Hue.max_d–', 
šdex
=0,

507 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

508 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.02),

509 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

510 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

511 
İtiÚs
=
NÚe
),

513 
ex‹nsiÚs
=[

515 
Ã¡ed_ty³s
=[],

516 
’um_ty³s
=[

518 
İtiÚs
=
NÚe
,

519 
is_ex‹ndabË
=
F®£
,

520 
syÁax
='proto2',

521 
ex‹nsiÚ_¿nges
=[],

522 
Úeofs
=[

524 
£rŸlized_¡¬t
=2368,

525 
£rŸlized_’d
=2410,

529 
_RANDOMADJUSTSATURATION
 = 
_desütÜ
.
	`DesütÜ
(

530 
Çme
='RandomAdjustSaturation',

531 
fuÎ_Çme
='object_detection.protos.RandomAdjustSaturation',

532 
f’ame
=
NÚe
,

533 
fe
=
DESCRIPTOR
,

534 
cÚššg_ty³
=
NÚe
,

535 
f›lds
=[

536 
_desütÜ
.
	`F›ldDesütÜ
(

537 
Çme
='mš_d–', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomAdju¡S©u¿tiÚ.mš_d–', 
šdex
=0,

538 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

539 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.8),

540 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

541 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

542 
İtiÚs
=
NÚe
),

543 
_desütÜ
.
	`F›ldDesütÜ
(

544 
Çme
='max_d–', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomAdju¡S©u¿tiÚ.max_d–', 
šdex
=1,

545 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

546 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1.25),

547 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

548 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

549 
İtiÚs
=
NÚe
),

551 
ex‹nsiÚs
=[

553 
Ã¡ed_ty³s
=[],

554 
’um_ty³s
=[

556 
İtiÚs
=
NÚe
,

557 
is_ex‹ndabË
=
F®£
,

558 
syÁax
='proto2',

559 
ex‹nsiÚ_¿nges
=[],

560 
Úeofs
=[

562 
£rŸlized_¡¬t
=2412,

563 
£rŸlized_’d
=2485,

567 
_RANDOMDISTORTCOLOR
 = 
_desütÜ
.
	`DesütÜ
(

568 
Çme
='RandomDistortColor',

569 
fuÎ_Çme
='object_detection.protos.RandomDistortColor',

570 
f’ame
=
NÚe
,

571 
fe
=
DESCRIPTOR
,

572 
cÚššg_ty³
=
NÚe
,

573 
f›lds
=[

574 
_desütÜ
.
	`F›ldDesütÜ
(

575 
Çme
='cŞÜ_Üd”šg', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomDi¡ÜtCŞÜ.cŞÜ_Üd”šg', 
šdex
=0,

576 
numb”
=1, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

577 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=0,

578 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

579 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

580 
İtiÚs
=
NÚe
),

582 
ex‹nsiÚs
=[

584 
Ã¡ed_ty³s
=[],

585 
’um_ty³s
=[

587 
İtiÚs
=
NÚe
,

588 
is_ex‹ndabË
=
F®£
,

589 
syÁax
='proto2',

590 
ex‹nsiÚ_¿nges
=[],

591 
Úeofs
=[

593 
£rŸlized_¡¬t
=2487,

594 
£rŸlized_’d
=2531,

598 
_RANDOMJITTERBOXES
 = 
_desütÜ
.
	`DesütÜ
(

599 
Çme
='RandomJitterBoxes',

600 
fuÎ_Çme
='object_detection.protos.RandomJitterBoxes',

601 
f’ame
=
NÚe
,

602 
fe
=
DESCRIPTOR
,

603 
cÚššg_ty³
=
NÚe
,

604 
f›lds
=[

605 
_desütÜ
.
	`F›ldDesütÜ
(

606 
Çme
='¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomJ™‹rBoxes.¿tio', 
šdex
=0,

607 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

608 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.05),

609 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

610 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

611 
İtiÚs
=
NÚe
),

613 
ex‹nsiÚs
=[

615 
Ã¡ed_ty³s
=[],

616 
’um_ty³s
=[

618 
İtiÚs
=
NÚe
,

619 
is_ex‹ndabË
=
F®£
,

620 
syÁax
='proto2',

621 
ex‹nsiÚ_¿nges
=[],

622 
Úeofs
=[

624 
£rŸlized_¡¬t
=2533,

625 
£rŸlized_’d
=2573,

629 
_RANDOMCROPIMAGE
 = 
_desütÜ
.
	`DesütÜ
(

630 
Çme
='RandomCropImage',

631 
fuÎ_Çme
='object_detection.protos.RandomCropImage',

632 
f’ame
=
NÚe
,

633 
fe
=
DESCRIPTOR
,

634 
cÚššg_ty³
=
NÚe
,

635 
f›lds
=[

636 
_desütÜ
.
	`F›ldDesütÜ
(

637 
Çme
='mš_objeù_cov”ed', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİImage.mš_objeù_cov”ed', 
šdex
=0,

638 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

639 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1),

640 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

641 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

642 
İtiÚs
=
NÚe
),

643 
_desütÜ
.
	`F›ldDesütÜ
(

644 
Çme
='mš_a¥eù_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİImage.mš_a¥eù_¿tio', 
šdex
=1,

645 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

646 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.75),

647 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

648 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

649 
İtiÚs
=
NÚe
),

650 
_desütÜ
.
	`F›ldDesütÜ
(

651 
Çme
='max_a¥eù_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİImage.max_a¥eù_¿tio', 
šdex
=2,

652 
numb”
=3, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

653 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1.33),

654 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

655 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

656 
İtiÚs
=
NÚe
),

657 
_desütÜ
.
	`F›ldDesütÜ
(

658 
Çme
='mš_¬—', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİImage.mš_¬—', 
šdex
=3,

659 
numb”
=4, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

660 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.1),

661 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

662 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

663 
İtiÚs
=
NÚe
),

664 
_desütÜ
.
	`F›ldDesütÜ
(

665 
Çme
='max_¬—', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİImage.max_¬—', 
šdex
=4,

666 
numb”
=5, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

667 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1),

668 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

669 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

670 
İtiÚs
=
NÚe
),

671 
_desütÜ
.
	`F›ldDesütÜ
(

672 
Çme
='ov”Ïp_th»sh', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİImage.ov”Ïp_th»sh', 
šdex
=5,

673 
numb”
=6, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

674 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.3),

675 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

676 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

677 
İtiÚs
=
NÚe
),

678 
_desütÜ
.
	`F›ldDesütÜ
(

679 
Çme
='¿ndom_cÛf', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİImage.¿ndom_cÛf', 
šdex
=6,

680 
numb”
=7, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

681 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0),

682 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

683 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

684 
İtiÚs
=
NÚe
),

686 
ex‹nsiÚs
=[

688 
Ã¡ed_ty³s
=[],

689 
’um_ty³s
=[

691 
İtiÚs
=
NÚe
,

692 
is_ex‹ndabË
=
F®£
,

693 
syÁax
='proto2',

694 
ex‹nsiÚ_¿nges
=[],

695 
Úeofs
=[

697 
£rŸlized_¡¬t
=2576,

698 
£rŸlized_’d
=2785,

702 
_RANDOMPADIMAGE
 = 
_desütÜ
.
	`DesütÜ
(

703 
Çme
='RandomPadImage',

704 
fuÎ_Çme
='object_detection.protos.RandomPadImage',

705 
f’ame
=
NÚe
,

706 
fe
=
DESCRIPTOR
,

707 
cÚššg_ty³
=
NÚe
,

708 
f›lds
=[

709 
_desütÜ
.
	`F›ldDesütÜ
(

710 
Çme
='mš_image_height', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomPadImage.mš_image_height', 
šdex
=0,

711 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

712 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

713 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

714 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

715 
İtiÚs
=
NÚe
),

716 
_desütÜ
.
	`F›ldDesütÜ
(

717 
Çme
='mš_image_width', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomPadImage.mš_image_width', 
šdex
=1,

718 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

719 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

720 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

721 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

722 
İtiÚs
=
NÚe
),

723 
_desütÜ
.
	`F›ldDesütÜ
(

724 
Çme
='max_image_height', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomPadImage.max_image_height', 
šdex
=2,

725 
numb”
=3, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

726 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

727 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

728 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

729 
İtiÚs
=
NÚe
),

730 
_desütÜ
.
	`F›ldDesütÜ
(

731 
Çme
='max_image_width', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomPadImage.max_image_width', 
šdex
=3,

732 
numb”
=4, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

733 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

734 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

735 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

736 
İtiÚs
=
NÚe
),

737 
_desütÜ
.
	`F›ldDesütÜ
(

738 
Çme
='·d_cŞÜ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomPadImage.·d_cŞÜ', 
šdex
=4,

739 
numb”
=5, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=3,

740 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=[],

741 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

742 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

743 
İtiÚs
=
NÚe
),

745 
ex‹nsiÚs
=[

747 
Ã¡ed_ty³s
=[],

748 
’um_ty³s
=[

750 
İtiÚs
=
NÚe
,

751 
is_ex‹ndabË
=
F®£
,

752 
syÁax
='proto2',

753 
ex‹nsiÚ_¿nges
=[],

754 
Úeofs
=[

756 
£rŸlized_¡¬t
=2788,

757 
£rŸlized_’d
=2925,

761 
_RANDOMCROPPADIMAGE
 = 
_desütÜ
.
	`DesütÜ
(

762 
Çme
='RandomCropPadImage',

763 
fuÎ_Çme
='object_detection.protos.RandomCropPadImage',

764 
f’ame
=
NÚe
,

765 
fe
=
DESCRIPTOR
,

766 
cÚššg_ty³
=
NÚe
,

767 
f›lds
=[

768 
_desütÜ
.
	`F›ldDesütÜ
(

769 
Çme
='mš_objeù_cov”ed', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİPadImage.mš_objeù_cov”ed', 
šdex
=0,

770 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

771 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1),

772 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

773 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

774 
İtiÚs
=
NÚe
),

775 
_desütÜ
.
	`F›ldDesütÜ
(

776 
Çme
='mš_a¥eù_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİPadImage.mš_a¥eù_¿tio', 
šdex
=1,

777 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

778 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.75),

779 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

780 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

781 
İtiÚs
=
NÚe
),

782 
_desütÜ
.
	`F›ldDesütÜ
(

783 
Çme
='max_a¥eù_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİPadImage.max_a¥eù_¿tio', 
šdex
=2,

784 
numb”
=3, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

785 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1.33),

786 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

787 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

788 
İtiÚs
=
NÚe
),

789 
_desütÜ
.
	`F›ldDesütÜ
(

790 
Çme
='mš_¬—', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİPadImage.mš_¬—', 
šdex
=3,

791 
numb”
=4, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

792 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.1),

793 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

794 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

795 
İtiÚs
=
NÚe
),

796 
_desütÜ
.
	`F›ldDesütÜ
(

797 
Çme
='max_¬—', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİPadImage.max_¬—', 
šdex
=4,

798 
numb”
=5, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

799 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1),

800 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

801 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

802 
İtiÚs
=
NÚe
),

803 
_desütÜ
.
	`F›ldDesütÜ
(

804 
Çme
='ov”Ïp_th»sh', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİPadImage.ov”Ïp_th»sh', 
šdex
=5,

805 
numb”
=6, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

806 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.3),

807 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

808 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

809 
İtiÚs
=
NÚe
),

810 
_desütÜ
.
	`F›ldDesütÜ
(

811 
Çme
='¿ndom_cÛf', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİPadImage.¿ndom_cÛf', 
šdex
=6,

812 
numb”
=7, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

813 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0),

814 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

815 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

816 
İtiÚs
=
NÚe
),

817 
_desütÜ
.
	`F›ldDesütÜ
(

818 
Çme
='mš_·dded_size_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİPadImage.mš_·dded_size_¿tio', 
šdex
=7,

819 
numb”
=8, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=3,

820 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=[],

821 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

822 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

823 
İtiÚs
=
NÚe
),

824 
_desütÜ
.
	`F›ldDesütÜ
(

825 
Çme
='max_·dded_size_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİPadImage.max_·dded_size_¿tio', 
šdex
=8,

826 
numb”
=9, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=3,

827 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=[],

828 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

829 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

830 
İtiÚs
=
NÚe
),

831 
_desütÜ
.
	`F›ldDesütÜ
(

832 
Çme
='·d_cŞÜ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİPadImage.·d_cŞÜ', 
šdex
=9,

833 
numb”
=10, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=3,

834 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=[],

835 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

836 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

837 
İtiÚs
=
NÚe
),

839 
ex‹nsiÚs
=[

841 
Ã¡ed_ty³s
=[],

842 
’um_ty³s
=[

844 
İtiÚs
=
NÚe
,

845 
is_ex‹ndabË
=
F®£
,

846 
syÁax
='proto2',

847 
ex‹nsiÚ_¿nges
=[],

848 
Úeofs
=[

850 
£rŸlized_¡¬t
=2928,

851 
£rŸlized_’d
=3221,

855 
_RANDOMCROPTOASPECTRATIO
 = 
_desütÜ
.
	`DesütÜ
(

856 
Çme
='RandomCropToAspectRatio',

857 
fuÎ_Çme
='object_detection.protos.RandomCropToAspectRatio',

858 
f’ame
=
NÚe
,

859 
fe
=
DESCRIPTOR
,

860 
cÚššg_ty³
=
NÚe
,

861 
f›lds
=[

862 
_desütÜ
.
	`F›ldDesütÜ
(

863 
Çme
='a¥eù_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİToA¥eùR©io.a¥eù_¿tio', 
šdex
=0,

864 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

865 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1),

866 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

867 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

868 
İtiÚs
=
NÚe
),

869 
_desütÜ
.
	`F›ldDesütÜ
(

870 
Çme
='ov”Ïp_th»sh', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomCrİToA¥eùR©io.ov”Ïp_th»sh', 
šdex
=1,

871 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

872 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.3),

873 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

874 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

875 
İtiÚs
=
NÚe
),

877 
ex‹nsiÚs
=[

879 
Ã¡ed_ty³s
=[],

880 
’um_ty³s
=[

882 
İtiÚs
=
NÚe
,

883 
is_ex‹ndabË
=
F®£
,

884 
syÁax
='proto2',

885 
ex‹nsiÚ_¿nges
=[],

886 
Úeofs
=[

888 
£rŸlized_¡¬t
=3223,

889 
£rŸlized_’d
=3302,

893 
_RANDOMBLACKPATCHES
 = 
_desütÜ
.
	`DesütÜ
(

894 
Çme
='RandomBlackPatches',

895 
fuÎ_Çme
='object_detection.protos.RandomBlackPatches',

896 
f’ame
=
NÚe
,

897 
fe
=
DESCRIPTOR
,

898 
cÚššg_ty³
=
NÚe
,

899 
f›lds
=[

900 
_desütÜ
.
	`F›ldDesütÜ
(

901 
Çme
='max_bÏck_·tches', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomBÏckP©ches.max_bÏck_·tches', 
šdex
=0,

902 
numb”
=1, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

903 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=10,

904 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

905 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

906 
İtiÚs
=
NÚe
),

907 
_desütÜ
.
	`F›ldDesütÜ
(

908 
Çme
='´obab™y', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomBÏckP©ches.´obab™y', 
šdex
=1,

909 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

910 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.5),

911 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

912 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

913 
İtiÚs
=
NÚe
),

914 
_desütÜ
.
	`F›ldDesütÜ
(

915 
Çme
='size_to_image_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomBÏckP©ches.size_to_image_¿tio', 
šdex
=2,

916 
numb”
=3, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

917 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.1),

918 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

919 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

920 
İtiÚs
=
NÚe
),

922 
ex‹nsiÚs
=[

924 
Ã¡ed_ty³s
=[],

925 
’um_ty³s
=[

927 
İtiÚs
=
NÚe
,

928 
is_ex‹ndabË
=
F®£
,

929 
syÁax
='proto2',

930 
ex‹nsiÚ_¿nges
=[],

931 
Úeofs
=[

933 
£rŸlized_¡¬t
=3304,

934 
£rŸlized_’d
=3415,

938 
_RANDOMRESIZEMETHOD
 = 
_desütÜ
.
	`DesütÜ
(

939 
Çme
='RandomResizeMethod',

940 
fuÎ_Çme
='object_detection.protos.RandomResizeMethod',

941 
f’ame
=
NÚe
,

942 
fe
=
DESCRIPTOR
,

943 
cÚššg_ty³
=
NÚe
,

944 
f›lds
=[

945 
_desütÜ
.
	`F›ldDesütÜ
(

946 
Çme
='rg‘_height', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomResizeM‘hod.rg‘_height', 
šdex
=0,

947 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

948 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

949 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

950 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

951 
İtiÚs
=
NÚe
),

952 
_desütÜ
.
	`F›ldDesütÜ
(

953 
Çme
='rg‘_width', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RªdomResizeM‘hod.rg‘_width', 
šdex
=1,

954 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

955 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

956 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

957 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

958 
İtiÚs
=
NÚe
),

960 
ex‹nsiÚs
=[

962 
Ã¡ed_ty³s
=[],

963 
’um_ty³s
=[

965 
İtiÚs
=
NÚe
,

966 
is_ex‹ndabË
=
F®£
,

967 
syÁax
='proto2',

968 
ex‹nsiÚ_¿nges
=[],

969 
Úeofs
=[

971 
£rŸlized_¡¬t
=3417,

972 
£rŸlized_’d
=3482,

976 
_SCALEBOXESTOPIXELCOORDINATES
 = 
_desütÜ
.
	`DesütÜ
(

977 
Çme
='ScaleBoxesToPixelCoordinates',

978 
fuÎ_Çme
='object_detection.protos.ScaleBoxesToPixelCoordinates',

979 
f’ame
=
NÚe
,

980 
fe
=
DESCRIPTOR
,

981 
cÚššg_ty³
=
NÚe
,

982 
f›lds
=[

984 
ex‹nsiÚs
=[

986 
Ã¡ed_ty³s
=[],

987 
’um_ty³s
=[

989 
İtiÚs
=
NÚe
,

990 
is_ex‹ndabË
=
F®£
,

991 
syÁax
='proto2',

992 
ex‹nsiÚ_¿nges
=[],

993 
Úeofs
=[

995 
£rŸlized_¡¬t
=3484,

996 
£rŸlized_’d
=3514,

1000 
_RESIZEIMAGE
 = 
_desütÜ
.
	`DesütÜ
(

1001 
Çme
='ResizeImage',

1002 
fuÎ_Çme
='object_detection.protos.ResizeImage',

1003 
f’ame
=
NÚe
,

1004 
fe
=
DESCRIPTOR
,

1005 
cÚššg_ty³
=
NÚe
,

1006 
f›lds
=[

1007 
_desütÜ
.
	`F›ldDesütÜ
(

1008 
Çme
='Ãw_height', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.ResizeImage.Ãw_height', 
šdex
=0,

1009 
numb”
=1, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

1010 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=0,

1011 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1012 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1013 
İtiÚs
=
NÚe
),

1014 
_desütÜ
.
	`F›ldDesütÜ
(

1015 
Çme
='Ãw_width', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.ResizeImage.Ãw_width', 
šdex
=1,

1016 
numb”
=2, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

1017 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=0,

1018 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1019 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1020 
İtiÚs
=
NÚe
),

1021 
_desütÜ
.
	`F›ldDesütÜ
(

1022 
Çme
='m‘hod', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.ResizeImage.m‘hod', 
šdex
=2,

1023 
numb”
=3, 
ty³
=14, 
ıp_ty³
=8, 
Ïb–
=1,

1024 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=3,

1025 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1026 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1027 
İtiÚs
=
NÚe
),

1029 
ex‹nsiÚs
=[

1031 
Ã¡ed_ty³s
=[],

1032 
’um_ty³s
=[

1033 
_RESIZEIMAGE_METHOD
,

1035 
İtiÚs
=
NÚe
,

1036 
is_ex‹ndabË
=
F®£
,

1037 
syÁax
='proto2',

1038 
ex‹nsiÚ_¿nges
=[],

1039 
Úeofs
=[

1041 
£rŸlized_¡¬t
=3517,

1042 
£rŸlized_’d
=3709,

1046 
_SUBTRACTCHANNELMEAN
 = 
_desütÜ
.
	`DesütÜ
(

1047 
Çme
='SubtractChannelMean',

1048 
fuÎ_Çme
='object_detection.protos.SubtractChannelMean',

1049 
f’ame
=
NÚe
,

1050 
fe
=
DESCRIPTOR
,

1051 
cÚššg_ty³
=
NÚe
,

1052 
f›lds
=[

1053 
_desütÜ
.
	`F›ldDesütÜ
(

1054 
Çme
='m—ns', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SubŒaùChªÃlM—n.m—ns', 
šdex
=0,

1055 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=3,

1056 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=[],

1057 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1058 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1059 
İtiÚs
=
NÚe
),

1061 
ex‹nsiÚs
=[

1063 
Ã¡ed_ty³s
=[],

1064 
’um_ty³s
=[

1066 
İtiÚs
=
NÚe
,

1067 
is_ex‹ndabË
=
F®£
,

1068 
syÁax
='proto2',

1069 
ex‹nsiÚ_¿nges
=[],

1070 
Úeofs
=[

1072 
£rŸlized_¡¬t
=3711,

1073 
£rŸlized_’d
=3747,

1077 
_SSDRANDOMCROPOPERATION
 = 
_desütÜ
.
	`DesütÜ
(

1078 
Çme
='SSDRandomCropOperation',

1079 
fuÎ_Çme
='object_detection.protos.SSDRandomCropOperation',

1080 
f’ame
=
NÚe
,

1081 
fe
=
DESCRIPTOR
,

1082 
cÚššg_ty³
=
NÚe
,

1083 
f›lds
=[

1084 
_desütÜ
.
	`F›ldDesütÜ
(

1085 
Çme
='mš_objeù_cov”ed', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİO³¿tiÚ.mš_objeù_cov”ed', 
šdex
=0,

1086 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1087 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1088 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1089 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1090 
İtiÚs
=
NÚe
),

1091 
_desütÜ
.
	`F›ldDesütÜ
(

1092 
Çme
='mš_a¥eù_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİO³¿tiÚ.mš_a¥eù_¿tio', 
šdex
=1,

1093 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1094 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1095 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1096 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1097 
İtiÚs
=
NÚe
),

1098 
_desütÜ
.
	`F›ldDesütÜ
(

1099 
Çme
='max_a¥eù_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİO³¿tiÚ.max_a¥eù_¿tio', 
šdex
=2,

1100 
numb”
=3, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1101 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1102 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1103 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1104 
İtiÚs
=
NÚe
),

1105 
_desütÜ
.
	`F›ldDesütÜ
(

1106 
Çme
='mš_¬—', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİO³¿tiÚ.mš_¬—', 
šdex
=3,

1107 
numb”
=4, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1108 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1109 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1110 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1111 
İtiÚs
=
NÚe
),

1112 
_desütÜ
.
	`F›ldDesütÜ
(

1113 
Çme
='max_¬—', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİO³¿tiÚ.max_¬—', 
šdex
=4,

1114 
numb”
=5, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1115 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1116 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1117 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1118 
İtiÚs
=
NÚe
),

1119 
_desütÜ
.
	`F›ldDesütÜ
(

1120 
Çme
='ov”Ïp_th»sh', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİO³¿tiÚ.ov”Ïp_th»sh', 
šdex
=5,

1121 
numb”
=6, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1122 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1123 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1124 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1125 
İtiÚs
=
NÚe
),

1126 
_desütÜ
.
	`F›ldDesütÜ
(

1127 
Çme
='¿ndom_cÛf', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİO³¿tiÚ.¿ndom_cÛf', 
šdex
=6,

1128 
numb”
=7, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1129 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1130 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1131 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1132 
İtiÚs
=
NÚe
),

1134 
ex‹nsiÚs
=[

1136 
Ã¡ed_ty³s
=[],

1137 
’um_ty³s
=[

1139 
İtiÚs
=
NÚe
,

1140 
is_ex‹ndabË
=
F®£
,

1141 
syÁax
='proto2',

1142 
ex‹nsiÚ_¿nges
=[],

1143 
Úeofs
=[

1145 
£rŸlized_¡¬t
=3750,

1146 
£rŸlized_’d
=3935,

1150 
_SSDRANDOMCROP
 = 
_desütÜ
.
	`DesütÜ
(

1151 
Çme
='SSDRandomCrop',

1152 
fuÎ_Çme
='object_detection.protos.SSDRandomCrop',

1153 
f’ame
=
NÚe
,

1154 
fe
=
DESCRIPTOR
,

1155 
cÚššg_ty³
=
NÚe
,

1156 
f›lds
=[

1157 
_desütÜ
.
	`F›ldDesütÜ
(

1158 
Çme
='İ”©iÚs', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİ.İ”©iÚs', 
šdex
=0,

1159 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=3,

1160 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=[],

1161 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1162 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1163 
İtiÚs
=
NÚe
),

1165 
ex‹nsiÚs
=[

1167 
Ã¡ed_ty³s
=[],

1168 
’um_ty³s
=[

1170 
İtiÚs
=
NÚe
,

1171 
is_ex‹ndabË
=
F®£
,

1172 
syÁax
='proto2',

1173 
ex‹nsiÚ_¿nges
=[],

1174 
Úeofs
=[

1176 
£rŸlized_¡¬t
=3937,

1177 
£rŸlized_’d
=4021,

1181 
_SSDRANDOMCROPPADOPERATION
 = 
_desütÜ
.
	`DesütÜ
(

1182 
Çme
='SSDRandomCropPadOperation',

1183 
fuÎ_Çme
='object_detection.protos.SSDRandomCropPadOperation',

1184 
f’ame
=
NÚe
,

1185 
fe
=
DESCRIPTOR
,

1186 
cÚššg_ty³
=
NÚe
,

1187 
f›lds
=[

1188 
_desütÜ
.
	`F›ldDesütÜ
(

1189 
Çme
='mš_objeù_cov”ed', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİPadO³¿tiÚ.mš_objeù_cov”ed', 
šdex
=0,

1190 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1191 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1192 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1193 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1194 
İtiÚs
=
NÚe
),

1195 
_desütÜ
.
	`F›ldDesütÜ
(

1196 
Çme
='mš_a¥eù_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİPadO³¿tiÚ.mš_a¥eù_¿tio', 
šdex
=1,

1197 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1198 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1199 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1200 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1201 
İtiÚs
=
NÚe
),

1202 
_desütÜ
.
	`F›ldDesütÜ
(

1203 
Çme
='max_a¥eù_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİPadO³¿tiÚ.max_a¥eù_¿tio', 
šdex
=2,

1204 
numb”
=3, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1205 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1206 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1207 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1208 
İtiÚs
=
NÚe
),

1209 
_desütÜ
.
	`F›ldDesütÜ
(

1210 
Çme
='mš_¬—', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİPadO³¿tiÚ.mš_¬—', 
šdex
=3,

1211 
numb”
=4, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1212 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1213 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1214 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1215 
İtiÚs
=
NÚe
),

1216 
_desütÜ
.
	`F›ldDesütÜ
(

1217 
Çme
='max_¬—', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİPadO³¿tiÚ.max_¬—', 
šdex
=4,

1218 
numb”
=5, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1219 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1220 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1221 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1222 
İtiÚs
=
NÚe
),

1223 
_desütÜ
.
	`F›ldDesütÜ
(

1224 
Çme
='ov”Ïp_th»sh', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİPadO³¿tiÚ.ov”Ïp_th»sh', 
šdex
=5,

1225 
numb”
=6, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1226 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1227 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1228 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1229 
İtiÚs
=
NÚe
),

1230 
_desütÜ
.
	`F›ldDesütÜ
(

1231 
Çme
='¿ndom_cÛf', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİPadO³¿tiÚ.¿ndom_cÛf', 
šdex
=6,

1232 
numb”
=7, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1233 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1234 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1235 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1236 
İtiÚs
=
NÚe
),

1237 
_desütÜ
.
	`F›ldDesütÜ
(

1238 
Çme
='mš_·dded_size_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİPadO³¿tiÚ.mš_·dded_size_¿tio', 
šdex
=7,

1239 
numb”
=8, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=3,

1240 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=[],

1241 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1242 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1243 
İtiÚs
=
NÚe
),

1244 
_desütÜ
.
	`F›ldDesütÜ
(

1245 
Çme
='max_·dded_size_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİPadO³¿tiÚ.max_·dded_size_¿tio', 
šdex
=8,

1246 
numb”
=9, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=3,

1247 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=[],

1248 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1249 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1250 
İtiÚs
=
NÚe
),

1251 
_desütÜ
.
	`F›ldDesütÜ
(

1252 
Çme
='·d_cŞÜ_r', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİPadO³¿tiÚ.·d_cŞÜ_r', 
šdex
=9,

1253 
numb”
=10, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1254 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1255 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1256 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1257 
İtiÚs
=
NÚe
),

1258 
_desütÜ
.
	`F›ldDesütÜ
(

1259 
Çme
='·d_cŞÜ_g', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİPadO³¿tiÚ.·d_cŞÜ_g', 
šdex
=10,

1260 
numb”
=11, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1261 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1262 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1263 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1264 
İtiÚs
=
NÚe
),

1265 
_desütÜ
.
	`F›ldDesütÜ
(

1266 
Çme
='·d_cŞÜ_b', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİPadO³¿tiÚ.·d_cŞÜ_b', 
šdex
=11,

1267 
numb”
=12, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1268 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1269 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1270 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1271 
İtiÚs
=
NÚe
),

1273 
ex‹nsiÚs
=[

1275 
Ã¡ed_ty³s
=[],

1276 
’um_ty³s
=[

1278 
İtiÚs
=
NÚe
,

1279 
is_ex‹ndabË
=
F®£
,

1280 
syÁax
='proto2',

1281 
ex‹nsiÚ_¿nges
=[],

1282 
Úeofs
=[

1284 
£rŸlized_¡¬t
=4024,

1285 
£rŸlized_’d
=4337,

1289 
_SSDRANDOMCROPPAD
 = 
_desütÜ
.
	`DesütÜ
(

1290 
Çme
='SSDRandomCropPad',

1291 
fuÎ_Çme
='object_detection.protos.SSDRandomCropPad',

1292 
f’ame
=
NÚe
,

1293 
fe
=
DESCRIPTOR
,

1294 
cÚššg_ty³
=
NÚe
,

1295 
f›lds
=[

1296 
_desütÜ
.
	`F›ldDesütÜ
(

1297 
Çme
='İ”©iÚs', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİPad.İ”©iÚs', 
šdex
=0,

1298 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=3,

1299 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=[],

1300 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1301 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1302 
İtiÚs
=
NÚe
),

1304 
ex‹nsiÚs
=[

1306 
Ã¡ed_ty³s
=[],

1307 
’um_ty³s
=[

1309 
İtiÚs
=
NÚe
,

1310 
is_ex‹ndabË
=
F®£
,

1311 
syÁax
='proto2',

1312 
ex‹nsiÚ_¿nges
=[],

1313 
Úeofs
=[

1315 
£rŸlized_¡¬t
=4339,

1316 
£rŸlized_’d
=4429,

1320 
_SSDRANDOMCROPFIXEDASPECTRATIOOPERATION
 = 
_desütÜ
.
	`DesütÜ
(

1321 
Çme
='SSDRandomCropFixedAspectRatioOperation',

1322 
fuÎ_Çme
='object_detection.protos.SSDRandomCropFixedAspectRatioOperation',

1323 
f’ame
=
NÚe
,

1324 
fe
=
DESCRIPTOR
,

1325 
cÚššg_ty³
=
NÚe
,

1326 
f›lds
=[

1327 
_desütÜ
.
	`F›ldDesütÜ
(

1328 
Çme
='mš_objeù_cov”ed', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİFixedA¥eùR©ioO³¿tiÚ.mš_objeù_cov”ed', 
šdex
=0,

1329 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1330 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1331 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1332 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1333 
İtiÚs
=
NÚe
),

1334 
_desütÜ
.
	`F›ldDesütÜ
(

1335 
Çme
='mš_¬—', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİFixedA¥eùR©ioO³¿tiÚ.mš_¬—', 
šdex
=1,

1336 
numb”
=4, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1337 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1338 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1339 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1340 
İtiÚs
=
NÚe
),

1341 
_desütÜ
.
	`F›ldDesütÜ
(

1342 
Çme
='max_¬—', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİFixedA¥eùR©ioO³¿tiÚ.max_¬—', 
šdex
=2,

1343 
numb”
=5, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1344 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1345 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1346 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1347 
İtiÚs
=
NÚe
),

1348 
_desütÜ
.
	`F›ldDesütÜ
(

1349 
Çme
='ov”Ïp_th»sh', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİFixedA¥eùR©ioO³¿tiÚ.ov”Ïp_th»sh', 
šdex
=3,

1350 
numb”
=6, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1351 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1352 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1353 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1354 
İtiÚs
=
NÚe
),

1355 
_desütÜ
.
	`F›ldDesütÜ
(

1356 
Çme
='¿ndom_cÛf', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİFixedA¥eùR©ioO³¿tiÚ.¿ndom_cÛf', 
šdex
=4,

1357 
numb”
=7, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1358 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=(0),

1359 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1360 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1361 
İtiÚs
=
NÚe
),

1363 
ex‹nsiÚs
=[

1365 
Ã¡ed_ty³s
=[],

1366 
’um_ty³s
=[

1368 
İtiÚs
=
NÚe
,

1369 
is_ex‹ndabË
=
F®£
,

1370 
syÁax
='proto2',

1371 
ex‹nsiÚ_¿nges
=[],

1372 
Úeofs
=[

1374 
£rŸlized_¡¬t
=4432,

1375 
£rŸlized_’d
=4581,

1379 
_SSDRANDOMCROPFIXEDASPECTRATIO
 = 
_desütÜ
.
	`DesütÜ
(

1380 
Çme
='SSDRandomCropFixedAspectRatio',

1381 
fuÎ_Çme
='object_detection.protos.SSDRandomCropFixedAspectRatio',

1382 
f’ame
=
NÚe
,

1383 
fe
=
DESCRIPTOR
,

1384 
cÚššg_ty³
=
NÚe
,

1385 
f›lds
=[

1386 
_desütÜ
.
	`F›ldDesütÜ
(

1387 
Çme
='İ”©iÚs', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİFixedA¥eùR©io.İ”©iÚs', 
šdex
=0,

1388 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=3,

1389 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=[],

1390 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1391 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1392 
İtiÚs
=
NÚe
),

1393 
_desütÜ
.
	`F›ldDesütÜ
(

1394 
Çme
='a¥eù_¿tio', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SSDRªdomCrİFixedA¥eùR©io.a¥eù_¿tio', 
šdex
=1,

1395 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

1396 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1),

1397 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

1398 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

1399 
İtiÚs
=
NÚe
),

1401 
ex‹nsiÚs
=[

1403 
Ã¡ed_ty³s
=[],

1404 
’um_ty³s
=[

1406 
İtiÚs
=
NÚe
,

1407 
is_ex‹ndabË
=
F®£
,

1408 
syÁax
='proto2',

1409 
ex‹nsiÚ_¿nges
=[],

1410 
Úeofs
=[

1412 
£rŸlized_¡¬t
=4584,

1413 
£rŸlized_’d
=4725,

1416 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['nÜm®ize_image'].
mes§ge_ty³
 = 
_NORMALIZEIMAGE


1417 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_hÜizÚl_æ'].
mes§ge_ty³
 = 
_RANDOMHORIZONTALFLIP


1418 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_pix–_v®ue_sÿË'].
mes§ge_ty³
 = 
_RANDOMPIXELVALUESCALE


1419 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_image_sÿË'].
mes§ge_ty³
 = 
_RANDOMIMAGESCALE


1420 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_rgb_to_g¿y'].
mes§ge_ty³
 = 
_RANDOMRGBTOGRAY


1421 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_adju¡_brighŠess'].
mes§ge_ty³
 = 
_RANDOMADJUSTBRIGHTNESS


1422 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_adju¡_cÚŒa¡'].
mes§ge_ty³
 = 
_RANDOMADJUSTCONTRAST


1423 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_adju¡_hue'].
mes§ge_ty³
 = 
_RANDOMADJUSTHUE


1424 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_adju¡_§tu¿tiÚ'].
mes§ge_ty³
 = 
_RANDOMADJUSTSATURATION


1425 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_di¡Üt_cŞÜ'].
mes§ge_ty³
 = 
_RANDOMDISTORTCOLOR


1426 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_j™‹r_boxes'].
mes§ge_ty³
 = 
_RANDOMJITTERBOXES


1427 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_üİ_image'].
mes§ge_ty³
 = 
_RANDOMCROPIMAGE


1428 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_·d_image'].
mes§ge_ty³
 = 
_RANDOMPADIMAGE


1429 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_üİ_·d_image'].
mes§ge_ty³
 = 
_RANDOMCROPPADIMAGE


1430 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_üİ_to_a¥eù_¿tio'].
mes§ge_ty³
 = 
_RANDOMCROPTOASPECTRATIO


1431 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_bÏck_·tches'].
mes§ge_ty³
 = 
_RANDOMBLACKPATCHES


1432 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_»size_m‘hod'].
mes§ge_ty³
 = 
_RANDOMRESIZEMETHOD


1433 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['sÿË_boxes_to_pix–_coÜdš©es'].
mes§ge_ty³
 = 
_SCALEBOXESTOPIXELCOORDINATES


1434 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['»size_image'].
mes§ge_ty³
 = 
_RESIZEIMAGE


1435 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['subŒaù_chªÃl_m—n'].
mes§ge_ty³
 = 
_SUBTRACTCHANNELMEAN


1436 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['ssd_¿ndom_üİ'].
mes§ge_ty³
 = 
_SSDRANDOMCROP


1437 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['ssd_¿ndom_üİ_·d'].
mes§ge_ty³
 = 
_SSDRANDOMCROPPAD


1438 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['ssd_¿ndom_üİ_fixed_a¥eù_¿tio'].
mes§ge_ty³
 = 
_SSDRANDOMCROPFIXEDASPECTRATIO


1439 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1440 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['normalize_image'])

1441 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['nÜm®ize_image'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1442 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1443 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['random_horizontal_flip'])

1444 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_hÜizÚl_æ'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1445 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1446 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['random_pixel_value_scale'])

1447 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_pix–_v®ue_sÿË'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1448 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1449 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['random_image_scale'])

1450 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_image_sÿË'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1451 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1452 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['random_rgb_to_gray'])

1453 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_rgb_to_g¿y'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1454 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1455 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['random_adjust_brightness'])

1456 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_adju¡_brighŠess'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1457 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1458 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['random_adjust_contrast'])

1459 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_adju¡_cÚŒa¡'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1460 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1461 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['random_adjust_hue'])

1462 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_adju¡_hue'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1463 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1464 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['random_adjust_saturation'])

1465 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_adju¡_§tu¿tiÚ'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1466 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1467 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['random_distort_color'])

1468 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_di¡Üt_cŞÜ'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1469 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1470 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['random_jitter_boxes'])

1471 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_j™‹r_boxes'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1472 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1473 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['random_crop_image'])

1474 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_üİ_image'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1475 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1476 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['random_pad_image'])

1477 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_·d_image'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1478 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1479 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['random_crop_pad_image'])

1480 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_üİ_·d_image'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1481 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1482 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['random_crop_to_aspect_ratio'])

1483 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_üİ_to_a¥eù_¿tio'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1484 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1485 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['random_black_patches'])

1486 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_bÏck_·tches'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1487 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1488 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['random_resize_method'])

1489 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['¿ndom_»size_m‘hod'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1490 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1491 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['scale_boxes_to_pixel_coordinates'])

1492 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['sÿË_boxes_to_pix–_coÜdš©es'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1493 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1494 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['resize_image'])

1495 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['»size_image'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1496 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1497 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['subtract_channel_mean'])

1498 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['subŒaù_chªÃl_m—n'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1499 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1500 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['ssd_random_crop'])

1501 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['ssd_¿ndom_üİ'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1502 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1503 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['ssd_random_crop_pad'])

1504 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['ssd_¿ndom_üİ_·d'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1505 
_PREPROCESSINGSTEP
.
Úeofs_by_Çme
['´•roûssšg_¡•'].
f›lds
.
	`­³nd
(

1506 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['ssd_random_crop_fixed_aspect_ratio'])

1507 
_PREPROCESSINGSTEP
.
f›lds_by_Çme
['ssd_¿ndom_üİ_fixed_a¥eù_¿tio'].
cÚššg_Úeof
 = _PREPROCESSINGSTEP.
Úeofs_by_Çme
['preprocessing_step']

1508 
_RESIZEIMAGE
.
f›lds_by_Çme
['m‘hod'].
’um_ty³
 = 
_RESIZEIMAGE_METHOD


1509 
_RESIZEIMAGE_METHOD
.
cÚššg_ty³
 = 
_RESIZEIMAGE


1510 
_SSDRANDOMCROP
.
f›lds_by_Çme
['İ”©iÚs'].
mes§ge_ty³
 = 
_SSDRANDOMCROPOPERATION


1511 
_SSDRANDOMCROPPAD
.
f›lds_by_Çme
['İ”©iÚs'].
mes§ge_ty³
 = 
_SSDRANDOMCROPPADOPERATION


1512 
_SSDRANDOMCROPFIXEDASPECTRATIO
.
f›lds_by_Çme
['İ”©iÚs'].
mes§ge_ty³
 = 
_SSDRANDOMCROPFIXEDASPECTRATIOOPERATION


1513 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['P»´oûssšgS‹p'] = 
_PREPROCESSINGSTEP


1514 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['NÜm®izeImage'] = 
_NORMALIZEIMAGE


1515 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RªdomHÜizÚlFl'] = 
_RANDOMHORIZONTALFLIP


1516 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RªdomPix–V®ueSÿË'] = 
_RANDOMPIXELVALUESCALE


1517 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RªdomImageSÿË'] = 
_RANDOMIMAGESCALE


1518 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RªdomRGBtoG¿y'] = 
_RANDOMRGBTOGRAY


1519 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RªdomAdju¡BrighŠess'] = 
_RANDOMADJUSTBRIGHTNESS


1520 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RªdomAdju¡CÚŒa¡'] = 
_RANDOMADJUSTCONTRAST


1521 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RªdomAdju¡Hue'] = 
_RANDOMADJUSTHUE


1522 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RªdomAdju¡S©u¿tiÚ'] = 
_RANDOMADJUSTSATURATION


1523 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RªdomDi¡ÜtCŞÜ'] = 
_RANDOMDISTORTCOLOR


1524 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RªdomJ™‹rBoxes'] = 
_RANDOMJITTERBOXES


1525 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RªdomCrİImage'] = 
_RANDOMCROPIMAGE


1526 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RªdomPadImage'] = 
_RANDOMPADIMAGE


1527 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RªdomCrİPadImage'] = 
_RANDOMCROPPADIMAGE


1528 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RªdomCrİToA¥eùR©io'] = 
_RANDOMCROPTOASPECTRATIO


1529 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RªdomBÏckP©ches'] = 
_RANDOMBLACKPATCHES


1530 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RªdomResizeM‘hod'] = 
_RANDOMRESIZEMETHOD


1531 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['SÿËBoxesToPix–CoÜdš©es'] = 
_SCALEBOXESTOPIXELCOORDINATES


1532 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['ResizeImage'] = 
_RESIZEIMAGE


1533 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['SubŒaùChªÃlM—n'] = 
_SUBTRACTCHANNELMEAN


1534 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['SSDRªdomCrİO³¿tiÚ'] = 
_SSDRANDOMCROPOPERATION


1535 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['SSDRªdomCrİ'] = 
_SSDRANDOMCROP


1536 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['SSDRªdomCrİPadO³¿tiÚ'] = 
_SSDRANDOMCROPPADOPERATION


1537 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['SSDRªdomCrİPad'] = 
_SSDRANDOMCROPPAD


1538 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['SSDRªdomCrİFixedA¥eùR©ioO³¿tiÚ'] = 
_SSDRANDOMCROPFIXEDASPECTRATIOOPERATION


1539 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['SSDRªdomCrİFixedA¥eùR©io'] = 
_SSDRANDOMCROPFIXEDASPECTRATIO


1540 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

1542 
P»´oûssšgS‹p
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('P»´oûssšgS‹p', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1543 
DESCRIPTOR
 = 
_PREPROCESSINGSTEP
,

1544 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1545 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
P»´oûssšgS‹p
)

1547 
_sym_db
.
	$Regi¡”Mes§ge
(
P»´oûssšgS‹p
)

1549 
NÜm®izeImage
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('NÜm®izeImage', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1550 
DESCRIPTOR
 = 
_NORMALIZEIMAGE
,

1551 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1552 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
NÜm®izeImage
)

1554 
_sym_db
.
	$Regi¡”Mes§ge
(
NÜm®izeImage
)

1556 
RªdomHÜizÚlFl
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RªdomHÜizÚlFl', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1557 
DESCRIPTOR
 = 
_RANDOMHORIZONTALFLIP
,

1558 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1559 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RªdomHÜizÚlFl
)

1561 
_sym_db
.
	$Regi¡”Mes§ge
(
RªdomHÜizÚlFl
)

1563 
RªdomPix–V®ueSÿË
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RªdomPix–V®ueSÿË', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1564 
DESCRIPTOR
 = 
_RANDOMPIXELVALUESCALE
,

1565 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1566 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RªdomPix–V®ueSÿË
)

1568 
_sym_db
.
	$Regi¡”Mes§ge
(
RªdomPix–V®ueSÿË
)

1570 
RªdomImageSÿË
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RªdomImageSÿË', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1571 
DESCRIPTOR
 = 
_RANDOMIMAGESCALE
,

1572 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1573 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RªdomImageSÿË
)

1575 
_sym_db
.
	$Regi¡”Mes§ge
(
RªdomImageSÿË
)

1577 
RªdomRGBtoG¿y
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RªdomRGBtoG¿y', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1578 
DESCRIPTOR
 = 
_RANDOMRGBTOGRAY
,

1579 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1580 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RªdomRGBtoG¿y
)

1582 
_sym_db
.
	$Regi¡”Mes§ge
(
RªdomRGBtoG¿y
)

1584 
RªdomAdju¡BrighŠess
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RªdomAdju¡BrighŠess', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1585 
DESCRIPTOR
 = 
_RANDOMADJUSTBRIGHTNESS
,

1586 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1587 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RªdomAdju¡BrighŠess
)

1589 
_sym_db
.
	$Regi¡”Mes§ge
(
RªdomAdju¡BrighŠess
)

1591 
RªdomAdju¡CÚŒa¡
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RªdomAdju¡CÚŒa¡', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1592 
DESCRIPTOR
 = 
_RANDOMADJUSTCONTRAST
,

1593 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1594 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RªdomAdju¡CÚŒa¡
)

1596 
_sym_db
.
	$Regi¡”Mes§ge
(
RªdomAdju¡CÚŒa¡
)

1598 
RªdomAdju¡Hue
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RªdomAdju¡Hue', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1599 
DESCRIPTOR
 = 
_RANDOMADJUSTHUE
,

1600 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1601 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RªdomAdju¡Hue
)

1603 
_sym_db
.
	$Regi¡”Mes§ge
(
RªdomAdju¡Hue
)

1605 
RªdomAdju¡S©u¿tiÚ
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RªdomAdju¡S©u¿tiÚ', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1606 
DESCRIPTOR
 = 
_RANDOMADJUSTSATURATION
,

1607 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1608 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RªdomAdju¡S©u¿tiÚ
)

1610 
_sym_db
.
	$Regi¡”Mes§ge
(
RªdomAdju¡S©u¿tiÚ
)

1612 
RªdomDi¡ÜtCŞÜ
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RªdomDi¡ÜtCŞÜ', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1613 
DESCRIPTOR
 = 
_RANDOMDISTORTCOLOR
,

1614 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1615 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RªdomDi¡ÜtCŞÜ
)

1617 
_sym_db
.
	$Regi¡”Mes§ge
(
RªdomDi¡ÜtCŞÜ
)

1619 
RªdomJ™‹rBoxes
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RªdomJ™‹rBoxes', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1620 
DESCRIPTOR
 = 
_RANDOMJITTERBOXES
,

1621 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1622 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RªdomJ™‹rBoxes
)

1624 
_sym_db
.
	$Regi¡”Mes§ge
(
RªdomJ™‹rBoxes
)

1626 
RªdomCrİImage
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RªdomCrİImage', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1627 
DESCRIPTOR
 = 
_RANDOMCROPIMAGE
,

1628 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1629 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RªdomCrİImage
)

1631 
_sym_db
.
	$Regi¡”Mes§ge
(
RªdomCrİImage
)

1633 
RªdomPadImage
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RªdomPadImage', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1634 
DESCRIPTOR
 = 
_RANDOMPADIMAGE
,

1635 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1636 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RªdomPadImage
)

1638 
_sym_db
.
	$Regi¡”Mes§ge
(
RªdomPadImage
)

1640 
RªdomCrİPadImage
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RªdomCrİPadImage', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1641 
DESCRIPTOR
 = 
_RANDOMCROPPADIMAGE
,

1642 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1643 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RªdomCrİPadImage
)

1645 
_sym_db
.
	$Regi¡”Mes§ge
(
RªdomCrİPadImage
)

1647 
RªdomCrİToA¥eùR©io
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RªdomCrİToA¥eùR©io', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1648 
DESCRIPTOR
 = 
_RANDOMCROPTOASPECTRATIO
,

1649 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1650 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RªdomCrİToA¥eùR©io
)

1652 
_sym_db
.
	$Regi¡”Mes§ge
(
RªdomCrİToA¥eùR©io
)

1654 
RªdomBÏckP©ches
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RªdomBÏckP©ches', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1655 
DESCRIPTOR
 = 
_RANDOMBLACKPATCHES
,

1656 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1657 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RªdomBÏckP©ches
)

1659 
_sym_db
.
	$Regi¡”Mes§ge
(
RªdomBÏckP©ches
)

1661 
RªdomResizeM‘hod
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RªdomResizeM‘hod', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1662 
DESCRIPTOR
 = 
_RANDOMRESIZEMETHOD
,

1663 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1664 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RªdomResizeM‘hod
)

1666 
_sym_db
.
	$Regi¡”Mes§ge
(
RªdomResizeM‘hod
)

1668 
SÿËBoxesToPix–CoÜdš©es
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('SÿËBoxesToPix–CoÜdš©es', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1669 
DESCRIPTOR
 = 
_SCALEBOXESTOPIXELCOORDINATES
,

1670 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1671 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
SÿËBoxesToPix–CoÜdš©es
)

1673 
_sym_db
.
	$Regi¡”Mes§ge
(
SÿËBoxesToPix–CoÜdš©es
)

1675 
ResizeImage
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('ResizeImage', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1676 
DESCRIPTOR
 = 
_RESIZEIMAGE
,

1677 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1678 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
ResizeImage
)

1680 
_sym_db
.
	$Regi¡”Mes§ge
(
ResizeImage
)

1682 
SubŒaùChªÃlM—n
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('SubŒaùChªÃlM—n', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1683 
DESCRIPTOR
 = 
_SUBTRACTCHANNELMEAN
,

1684 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1685 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
SubŒaùChªÃlM—n
)

1687 
_sym_db
.
	$Regi¡”Mes§ge
(
SubŒaùChªÃlM—n
)

1689 
SSDRªdomCrİO³¿tiÚ
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('SSDRªdomCrİO³¿tiÚ', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1690 
DESCRIPTOR
 = 
_SSDRANDOMCROPOPERATION
,

1691 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1692 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
SSDRªdomCrİO³¿tiÚ
)

1694 
_sym_db
.
	$Regi¡”Mes§ge
(
SSDRªdomCrİO³¿tiÚ
)

1696 
SSDRªdomCrİ
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('SSDRªdomCrİ', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1697 
DESCRIPTOR
 = 
_SSDRANDOMCROP
,

1698 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1699 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
SSDRªdomCrİ
)

1701 
_sym_db
.
	$Regi¡”Mes§ge
(
SSDRªdomCrİ
)

1703 
SSDRªdomCrİPadO³¿tiÚ
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('SSDRªdomCrİPadO³¿tiÚ', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1704 
DESCRIPTOR
 = 
_SSDRANDOMCROPPADOPERATION
,

1705 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1706 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
SSDRªdomCrİPadO³¿tiÚ
)

1708 
_sym_db
.
	$Regi¡”Mes§ge
(
SSDRªdomCrİPadO³¿tiÚ
)

1710 
SSDRªdomCrİPad
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('SSDRªdomCrİPad', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1711 
DESCRIPTOR
 = 
_SSDRANDOMCROPPAD
,

1712 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1713 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
SSDRªdomCrİPad
)

1715 
_sym_db
.
	$Regi¡”Mes§ge
(
SSDRªdomCrİPad
)

1717 
SSDRªdomCrİFixedA¥eùR©ioO³¿tiÚ
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('SSDRªdomCrİFixedA¥eùR©ioO³¿tiÚ', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1718 
DESCRIPTOR
 = 
_SSDRANDOMCROPFIXEDASPECTRATIOOPERATION
,

1719 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1720 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
SSDRªdomCrİFixedA¥eùR©ioO³¿tiÚ
)

1722 
_sym_db
.
	$Regi¡”Mes§ge
(
SSDRªdomCrİFixedA¥eùR©ioO³¿tiÚ
)

1724 
SSDRªdomCrİFixedA¥eùR©io
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('SSDRªdomCrİFixedA¥eùR©io', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

1725 
DESCRIPTOR
 = 
_SSDRANDOMCROPFIXEDASPECTRATIO
,

1726 
__moduË__
 = 'object_detection.protos.preprocessor_pb2'

1727 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
SSDRªdomCrİFixedA¥eùR©io
)

1729 
_sym_db
.
	$Regi¡”Mes§ge
(
SSDRªdomCrİFixedA¥eùR©io
)

1732 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/region_similarity_calculator_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
»giÚ_sim¬™y_ÿlcuÏtÜ
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

18 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

19 
Çme
='object_detection/protos/region_similarity_calculator.proto',

20 
·ckage
='object_detection.protos',

21 
syÁax
='proto2',

22 
£rŸlized_pb
=
	`_b
('\n:object_detection/protos/region_similarity_calculator.proto\x12\x17object_detection.protos\"\x85\x02\n\x1aRegionSimilarityCalculator\x12N\n\x16neg_sq_dist_similarity\x18\x01 \x01(\x0b\x32,.object_detection.protos.NegSqDistSimilarityH\x00\x12@\n\x0eiou_similarity\x18\x02 \x01(\x0b\x32&.object_detection.protos.IouSimilarityH\x00\x12@\n\x0eioa_similarity\x18\x03 \x01(\x0b\x32&.object_detection.protos.IoaSimilarityH\x00\x42\x13\n\x11region_similarity\"\x15\n\x13NegSqDistSimilarity\"\x0f\n\rIouSimilarity\"\x0f\n\rIoaSimilarity')

28 
_REGIONSIMILARITYCALCULATOR
 = 
_desütÜ
.
	`DesütÜ
(

29 
Çme
='RegionSimilarityCalculator',

30 
fuÎ_Çme
='object_detection.protos.RegionSimilarityCalculator',

31 
f’ame
=
NÚe
,

32 
fe
=
DESCRIPTOR
,

33 
cÚššg_ty³
=
NÚe
,

34 
f›lds
=[

35 
_desütÜ
.
	`F›ldDesütÜ
(

36 
Çme
='Ãg_sq_di¡_sim¬™y', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RegiÚSim¬™yC®cuÏtÜ.Ãg_sq_di¡_sim¬™y', 
šdex
=0,

37 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

38 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

39 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

40 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

41 
İtiÚs
=
NÚe
),

42 
_desütÜ
.
	`F›ldDesütÜ
(

43 
Çme
='iou_sim¬™y', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RegiÚSim¬™yC®cuÏtÜ.iou_sim¬™y', 
šdex
=1,

44 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

45 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

46 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

47 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

48 
İtiÚs
=
NÚe
),

49 
_desütÜ
.
	`F›ldDesütÜ
(

50 
Çme
='iß_sim¬™y', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.RegiÚSim¬™yC®cuÏtÜ.iß_sim¬™y', 
šdex
=2,

51 
numb”
=3, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

52 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

53 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

54 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

55 
İtiÚs
=
NÚe
),

57 
ex‹nsiÚs
=[

59 
Ã¡ed_ty³s
=[],

60 
’um_ty³s
=[

62 
İtiÚs
=
NÚe
,

63 
is_ex‹ndabË
=
F®£
,

64 
syÁax
='proto2',

65 
ex‹nsiÚ_¿nges
=[],

66 
Úeofs
=[

67 
_desütÜ
.
	`OÃofDesütÜ
(

68 
Çme
='»giÚ_sim¬™y', 
fuÎ_Çme
='object_detection.protos.RegionSimilarityCalculator.region_similarity',

69 
šdex
=0, 
cÚššg_ty³
=
NÚe
, 
f›lds
=[]),

71 
£rŸlized_¡¬t
=88,

72 
£rŸlized_’d
=349,

76 
_NEGSQDISTSIMILARITY
 = 
_desütÜ
.
	`DesütÜ
(

77 
Çme
='NegSqDistSimilarity',

78 
fuÎ_Çme
='object_detection.protos.NegSqDistSimilarity',

79 
f’ame
=
NÚe
,

80 
fe
=
DESCRIPTOR
,

81 
cÚššg_ty³
=
NÚe
,

82 
f›lds
=[

84 
ex‹nsiÚs
=[

86 
Ã¡ed_ty³s
=[],

87 
’um_ty³s
=[

89 
İtiÚs
=
NÚe
,

90 
is_ex‹ndabË
=
F®£
,

91 
syÁax
='proto2',

92 
ex‹nsiÚ_¿nges
=[],

93 
Úeofs
=[

95 
£rŸlized_¡¬t
=351,

96 
£rŸlized_’d
=372,

100 
_IOUSIMILARITY
 = 
_desütÜ
.
	`DesütÜ
(

101 
Çme
='IouSimilarity',

102 
fuÎ_Çme
='object_detection.protos.IouSimilarity',

103 
f’ame
=
NÚe
,

104 
fe
=
DESCRIPTOR
,

105 
cÚššg_ty³
=
NÚe
,

106 
f›lds
=[

108 
ex‹nsiÚs
=[

110 
Ã¡ed_ty³s
=[],

111 
’um_ty³s
=[

113 
İtiÚs
=
NÚe
,

114 
is_ex‹ndabË
=
F®£
,

115 
syÁax
='proto2',

116 
ex‹nsiÚ_¿nges
=[],

117 
Úeofs
=[

119 
£rŸlized_¡¬t
=374,

120 
£rŸlized_’d
=389,

124 
_IOASIMILARITY
 = 
_desütÜ
.
	`DesütÜ
(

125 
Çme
='IoaSimilarity',

126 
fuÎ_Çme
='object_detection.protos.IoaSimilarity',

127 
f’ame
=
NÚe
,

128 
fe
=
DESCRIPTOR
,

129 
cÚššg_ty³
=
NÚe
,

130 
f›lds
=[

132 
ex‹nsiÚs
=[

134 
Ã¡ed_ty³s
=[],

135 
’um_ty³s
=[

137 
İtiÚs
=
NÚe
,

138 
is_ex‹ndabË
=
F®£
,

139 
syÁax
='proto2',

140 
ex‹nsiÚ_¿nges
=[],

141 
Úeofs
=[

143 
£rŸlized_¡¬t
=391,

144 
£rŸlized_’d
=406,

147 
_REGIONSIMILARITYCALCULATOR
.
f›lds_by_Çme
['Ãg_sq_di¡_sim¬™y'].
mes§ge_ty³
 = 
_NEGSQDISTSIMILARITY


148 
_REGIONSIMILARITYCALCULATOR
.
f›lds_by_Çme
['iou_sim¬™y'].
mes§ge_ty³
 = 
_IOUSIMILARITY


149 
_REGIONSIMILARITYCALCULATOR
.
f›lds_by_Çme
['iß_sim¬™y'].
mes§ge_ty³
 = 
_IOASIMILARITY


150 
_REGIONSIMILARITYCALCULATOR
.
Úeofs_by_Çme
['»giÚ_sim¬™y'].
f›lds
.
	`­³nd
(

151 
_REGIONSIMILARITYCALCULATOR
.
f›lds_by_Çme
['neg_sq_dist_similarity'])

152 
_REGIONSIMILARITYCALCULATOR
.
f›lds_by_Çme
['Ãg_sq_di¡_sim¬™y'].
cÚššg_Úeof
 = _REGIONSIMILARITYCALCULATOR.
Úeofs_by_Çme
['region_similarity']

153 
_REGIONSIMILARITYCALCULATOR
.
Úeofs_by_Çme
['»giÚ_sim¬™y'].
f›lds
.
	`­³nd
(

154 
_REGIONSIMILARITYCALCULATOR
.
f›lds_by_Çme
['iou_similarity'])

155 
_REGIONSIMILARITYCALCULATOR
.
f›lds_by_Çme
['iou_sim¬™y'].
cÚššg_Úeof
 = _REGIONSIMILARITYCALCULATOR.
Úeofs_by_Çme
['region_similarity']

156 
_REGIONSIMILARITYCALCULATOR
.
Úeofs_by_Çme
['»giÚ_sim¬™y'].
f›lds
.
	`­³nd
(

157 
_REGIONSIMILARITYCALCULATOR
.
f›lds_by_Çme
['ioa_similarity'])

158 
_REGIONSIMILARITYCALCULATOR
.
f›lds_by_Çme
['iß_sim¬™y'].
cÚššg_Úeof
 = _REGIONSIMILARITYCALCULATOR.
Úeofs_by_Çme
['region_similarity']

159 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['RegiÚSim¬™yC®cuÏtÜ'] = 
_REGIONSIMILARITYCALCULATOR


160 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['NegSqDi¡Sim¬™y'] = 
_NEGSQDISTSIMILARITY


161 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['IouSim¬™y'] = 
_IOUSIMILARITY


162 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['IßSim¬™y'] = 
_IOASIMILARITY


163 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

165 
RegiÚSim¬™yC®cuÏtÜ
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('RegiÚSim¬™yC®cuÏtÜ', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

166 
DESCRIPTOR
 = 
_REGIONSIMILARITYCALCULATOR
,

167 
__moduË__
 = 'object_detection.protos.region_similarity_calculator_pb2'

168 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
RegiÚSim¬™yC®cuÏtÜ
)

170 
_sym_db
.
	$Regi¡”Mes§ge
(
RegiÚSim¬™yC®cuÏtÜ
)

172 
NegSqDi¡Sim¬™y
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('NegSqDi¡Sim¬™y', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

173 
DESCRIPTOR
 = 
_NEGSQDISTSIMILARITY
,

174 
__moduË__
 = 'object_detection.protos.region_similarity_calculator_pb2'

175 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
NegSqDi¡Sim¬™y
)

177 
_sym_db
.
	$Regi¡”Mes§ge
(
NegSqDi¡Sim¬™y
)

179 
IouSim¬™y
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('IouSim¬™y', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

180 
DESCRIPTOR
 = 
_IOUSIMILARITY
,

181 
__moduË__
 = 'object_detection.protos.region_similarity_calculator_pb2'

182 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
IouSim¬™y
)

184 
_sym_db
.
	$Regi¡”Mes§ge
(
IouSim¬™y
)

186 
IßSim¬™y
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('IßSim¬™y', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

187 
DESCRIPTOR
 = 
_IOASIMILARITY
,

188 
__moduË__
 = 'object_detection.protos.region_similarity_calculator_pb2'

189 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
IßSim¬™y
)

191 
_sym_db
.
	$Regi¡”Mes§ge
(
IßSim¬™y
)

194 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/square_box_coder_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
squ¬e_box_cod”
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

18 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

19 
Çme
='object_detection/protos/square_box_coder.proto',

20 
·ckage
='object_detection.protos',

21 
syÁax
='proto2',

22 
£rŸlized_pb
=
	`_b
('\n.object_detection/protos/square_box_coder.proto\x12\x17object_detection.protos\"S\n\x0eSquareBoxCoder\x12\x13\n\x07y_scale\x18\x01 \x01(\x02:\x02\x31\x30\x12\x13\n\x07x_scale\x18\x02 \x01(\x02:\x02\x31\x30\x12\x17\n\x0clength_scale\x18\x03 \x01(\x02:\x01\x35')

28 
_SQUAREBOXCODER
 = 
_desütÜ
.
	`DesütÜ
(

29 
Çme
='SquareBoxCoder',

30 
fuÎ_Çme
='object_detection.protos.SquareBoxCoder',

31 
f’ame
=
NÚe
,

32 
fe
=
DESCRIPTOR
,

33 
cÚššg_ty³
=
NÚe
,

34 
f›lds
=[

35 
_desütÜ
.
	`F›ldDesütÜ
(

36 
Çme
='y_sÿË', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Squ¬eBoxCod”.y_sÿË', 
šdex
=0,

37 
numb”
=1, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

38 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(10),

39 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

40 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

41 
İtiÚs
=
NÚe
),

42 
_desütÜ
.
	`F›ldDesütÜ
(

43 
Çme
='x_sÿË', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Squ¬eBoxCod”.x_sÿË', 
šdex
=1,

44 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

45 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(10),

46 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

47 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

48 
İtiÚs
=
NÚe
),

49 
_desütÜ
.
	`F›ldDesütÜ
(

50 
Çme
='Ëngth_sÿË', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Squ¬eBoxCod”.Ëngth_sÿË', 
šdex
=2,

51 
numb”
=3, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

52 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(5),

53 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

54 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

55 
İtiÚs
=
NÚe
),

57 
ex‹nsiÚs
=[

59 
Ã¡ed_ty³s
=[],

60 
’um_ty³s
=[

62 
İtiÚs
=
NÚe
,

63 
is_ex‹ndabË
=
F®£
,

64 
syÁax
='proto2',

65 
ex‹nsiÚ_¿nges
=[],

66 
Úeofs
=[

68 
£rŸlized_¡¬t
=75,

69 
£rŸlized_’d
=158,

72 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Squ¬eBoxCod”'] = 
_SQUAREBOXCODER


73 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

75 
Squ¬eBoxCod”
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Squ¬eBoxCod”', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

76 
DESCRIPTOR
 = 
_SQUAREBOXCODER
,

77 
__moduË__
 = 'object_detection.protos.square_box_coder_pb2'

78 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Squ¬eBoxCod”
)

80 
_sym_db
.
	$Regi¡”Mes§ge
(
Squ¬eBoxCod”
)

83 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/ssd_anchor_generator_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
ssd_ªchÜ_g’”©Ü
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

18 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

19 
Çme
='object_detection/protos/ssd_anchor_generator.proto',

20 
·ckage
='object_detection.protos',

21 
syÁax
='proto2',

22 
£rŸlized_pb
=
	`_b
('\n2object_detection/protos/ssd_anchor_generator.proto\x12\x17object_detection.protos\"\x9f\x01\n\x12SsdAnchorGenerator\x12\x15\n\nnum_layers\x18\x01 \x01(\x05:\x01\x36\x12\x16\n\tmin_scale\x18\x02 \x01(\x02:\x03\x30.2\x12\x17\n\tmax_scale\x18\x03 \x01(\x02:\x04\x30.95\x12\x15\n\raspect_ratios\x18\x04 \x03(\x02\x12*\n\x1creduce_boxes_in_lowest_layer\x18\x05 \x01(\x08:\x04true')

28 
_SSDANCHORGENERATOR
 = 
_desütÜ
.
	`DesütÜ
(

29 
Çme
='SsdAnchorGenerator',

30 
fuÎ_Çme
='object_detection.protos.SsdAnchorGenerator',

31 
f’ame
=
NÚe
,

32 
fe
=
DESCRIPTOR
,

33 
cÚššg_ty³
=
NÚe
,

34 
f›lds
=[

35 
_desütÜ
.
	`F›ldDesütÜ
(

36 
Çme
='num_Ïy”s', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SsdAnchÜG’”©Ü.num_Ïy”s', 
šdex
=0,

37 
numb”
=1, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

38 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=6,

39 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

40 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

41 
İtiÚs
=
NÚe
),

42 
_desütÜ
.
	`F›ldDesütÜ
(

43 
Çme
='mš_sÿË', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SsdAnchÜG’”©Ü.mš_sÿË', 
šdex
=1,

44 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

45 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.2),

46 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

47 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

48 
İtiÚs
=
NÚe
),

49 
_desütÜ
.
	`F›ldDesütÜ
(

50 
Çme
='max_sÿË', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SsdAnchÜG’”©Ü.max_sÿË', 
šdex
=2,

51 
numb”
=3, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

52 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0.95),

53 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

54 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

55 
İtiÚs
=
NÚe
),

56 
_desütÜ
.
	`F›ldDesütÜ
(

57 
Çme
='a¥eù_¿tios', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SsdAnchÜG’”©Ü.a¥eù_¿tios', 
šdex
=3,

58 
numb”
=4, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=3,

59 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=[],

60 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

61 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

62 
İtiÚs
=
NÚe
),

63 
_desütÜ
.
	`F›ldDesütÜ
(

64 
Çme
='»duû_boxes_š_lowe¡_Ïy”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SsdAnchÜG’”©Ü.»duû_boxes_š_lowe¡_Ïy”', 
šdex
=4,

65 
numb”
=5, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

66 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=True,

67 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

68 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

69 
İtiÚs
=
NÚe
),

71 
ex‹nsiÚs
=[

73 
Ã¡ed_ty³s
=[],

74 
’um_ty³s
=[

76 
İtiÚs
=
NÚe
,

77 
is_ex‹ndabË
=
F®£
,

78 
syÁax
='proto2',

79 
ex‹nsiÚ_¿nges
=[],

80 
Úeofs
=[

82 
£rŸlized_¡¬t
=80,

83 
£rŸlized_’d
=239,

86 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['SsdAnchÜG’”©Ü'] = 
_SSDANCHORGENERATOR


87 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

89 
SsdAnchÜG’”©Ü
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('SsdAnchÜG’”©Ü', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

90 
DESCRIPTOR
 = 
_SSDANCHORGENERATOR
,

91 
__moduË__
 = 'object_detection.protos.ssd_anchor_generator_pb2'

92 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
SsdAnchÜG’”©Ü
)

94 
_sym_db
.
	$Regi¡”Mes§ge
(
SsdAnchÜG’”©Ü
)

97 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/ssd_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
ssd
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

16 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
ªchÜ_g’”©Ü_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ªchÜ__g’”©Ü__pb2


17 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
box_cod”_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_box__cod”__pb2


18 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
box_´ediùÜ_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_box__´ediùÜ__pb2


19 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
hy³½¬ams_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_hy³½¬ams__pb2


20 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
image_»siz”_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_image__»siz”__pb2


21 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
m©ch”_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_m©ch”__pb2


22 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
los£s_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_los£s__pb2


23 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
po¡_´oûssšg_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_po¡__´oûssšg__pb2


24 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
»giÚ_sim¬™y_ÿlcuÏtÜ_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_»giÚ__sim¬™y__ÿlcuÏtÜ__pb2


27 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

28 
Çme
='object_detection/protos/ssd.proto',

29 
·ckage
='object_detection.protos',

30 
syÁax
='proto2',

31 
£rŸlized_pb
=
	`_b
('\n!object_detection/protos/ssd.proto\x12\x17object_detection.protos\x1a.object_detection/protos/anchor_generator.proto\x1a\'object_detection/protos/box_coder.proto\x1a+object_detection/protos/box_predictor.proto\x1a)object_detection/protos/hyperparams.proto\x1a+object_detection/protos/image_resizer.proto\x1a%object_detection/protos/matcher.proto\x1a$object_detection/protos/losses.proto\x1a-object_detection/protos/post_processing.proto\x1a:object_detection/protos/region_similarity_calculator.proto\"\xfc\x04\n\x03Ssd\x12\x13\n\x0bnum_classes\x18\x01 \x01(\x05\x12<\n\rimage_resizer\x18\x02 \x01(\x0b\x32%.object_detection.protos.ImageResizer\x12G\n\x11\x66\x65\x61ture_extractor\x18\x03 \x01(\x0b\x32,.object_detection.protos.SsdFeatureExtractor\x12\x34\n\tbox_coder\x18\x04 \x01(\x0b\x32!.object_detection.protos.BoxCoder\x12\x31\n\x07matcher\x18\x05 \x01(\x0b\x32 .object_detection.protos.Matcher\x12R\n\x15similarity_calculator\x18\x06 \x01(\x0b\x32\x33.object_detection.protos.RegionSimilarityCalculator\x12<\n\rbox_predictor\x18\x07 \x01(\x0b\x32%.object_detection.protos.BoxPredictor\x12\x42\n\x10\x61nchor_generator\x18\x08 \x01(\x0b\x32(.object_detection.protos.AnchorGenerator\x12@\n\x0fpost_processing\x18\t \x01(\x0b\x32\'.object_detection.protos.PostProcessing\x12+\n\x1dnormalize_loss_by_num_matches\x18\n \x01(\x08:\x04true\x12+\n\x04loss\x18\x0b \x01(\x0b\x32\x1d.object_detection.protos.Loss\"\x97\x01\n\x13SsdFeatureExtractor\x12\x0c\n\x04type\x18\x01 \x01(\t\x12\x1b\n\x10\x64\x65pth_multiplier\x18\x02 \x01(\x02:\x01\x31\x12\x15\n\tmin_depth\x18\x03 \x01(\x05:\x02\x31\x36\x12>\n\x10\x63onv_hyperparams\x18\x04 \x01(\x0b\x32$.object_detection.protos.Hyperparams')

33 
d•’d’c›s
=[
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ªchÜ__g’”©Ü__pb2
.
DESCRIPTOR
,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_box__cod”__pb2
.DESCRIPTOR,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_box__´ediùÜ__pb2
.DESCRIPTOR,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_hy³½¬ams__pb2
.DESCRIPTOR,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_image__»siz”__pb2
.DESCRIPTOR,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_m©ch”__pb2
.DESCRIPTOR,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_los£s__pb2
.DESCRIPTOR,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_po¡__´oûssšg__pb2
.DESCRIPTOR,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_»giÚ__sim¬™y__ÿlcuÏtÜ__pb2
.DESCRIPTOR,])

38 
_SSD
 = 
_desütÜ
.
	`DesütÜ
(

39 
Çme
='Ssd',

40 
fuÎ_Çme
='object_detection.protos.Ssd',

41 
f’ame
=
NÚe
,

42 
fe
=
DESCRIPTOR
,

43 
cÚššg_ty³
=
NÚe
,

44 
f›lds
=[

45 
_desütÜ
.
	`F›ldDesütÜ
(

46 
Çme
='num_şas£s', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ssd.num_şas£s', 
šdex
=0,

47 
numb”
=1, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

48 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=0,

49 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

50 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

51 
İtiÚs
=
NÚe
),

52 
_desütÜ
.
	`F›ldDesütÜ
(

53 
Çme
='image_»siz”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ssd.image_»siz”', 
šdex
=1,

54 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

55 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

56 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

57 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

58 
İtiÚs
=
NÚe
),

59 
_desütÜ
.
	`F›ldDesütÜ
(

60 
Çme
='ã©u»_exŒaùÜ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ssd.ã©u»_exŒaùÜ', 
šdex
=2,

61 
numb”
=3, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

62 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

63 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

64 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

65 
İtiÚs
=
NÚe
),

66 
_desütÜ
.
	`F›ldDesütÜ
(

67 
Çme
='box_cod”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ssd.box_cod”', 
šdex
=3,

68 
numb”
=4, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

69 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

70 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

71 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

72 
İtiÚs
=
NÚe
),

73 
_desütÜ
.
	`F›ldDesütÜ
(

74 
Çme
='m©ch”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ssd.m©ch”', 
šdex
=4,

75 
numb”
=5, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

76 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

77 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

78 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

79 
İtiÚs
=
NÚe
),

80 
_desütÜ
.
	`F›ldDesütÜ
(

81 
Çme
='sim¬™y_ÿlcuÏtÜ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ssd.sim¬™y_ÿlcuÏtÜ', 
šdex
=5,

82 
numb”
=6, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

83 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

84 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

85 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

86 
İtiÚs
=
NÚe
),

87 
_desütÜ
.
	`F›ldDesütÜ
(

88 
Çme
='box_´ediùÜ', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ssd.box_´ediùÜ', 
šdex
=6,

89 
numb”
=7, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

90 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

91 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

92 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

93 
İtiÚs
=
NÚe
),

94 
_desütÜ
.
	`F›ldDesütÜ
(

95 
Çme
='ªchÜ_g’”©Ü', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ssd.ªchÜ_g’”©Ü', 
šdex
=7,

96 
numb”
=8, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

97 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

98 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

99 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

100 
İtiÚs
=
NÚe
),

101 
_desütÜ
.
	`F›ldDesütÜ
(

102 
Çme
='po¡_´oûssšg', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ssd.po¡_´oûssšg', 
šdex
=8,

103 
numb”
=9, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

104 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

105 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

106 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

107 
İtiÚs
=
NÚe
),

108 
_desütÜ
.
	`F›ldDesütÜ
(

109 
Çme
='nÜm®ize_loss_by_num_m©ches', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ssd.nÜm®ize_loss_by_num_m©ches', 
šdex
=9,

110 
numb”
=10, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

111 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=True,

112 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

113 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

114 
İtiÚs
=
NÚe
),

115 
_desütÜ
.
	`F›ldDesütÜ
(

116 
Çme
='loss', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.Ssd.loss', 
šdex
=10,

117 
numb”
=11, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

118 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

119 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

120 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

121 
İtiÚs
=
NÚe
),

123 
ex‹nsiÚs
=[

125 
Ã¡ed_ty³s
=[],

126 
’um_ty³s
=[

128 
İtiÚs
=
NÚe
,

129 
is_ex‹ndabË
=
F®£
,

130 
syÁax
='proto2',

131 
ex‹nsiÚ_¿nges
=[],

132 
Úeofs
=[

134 
£rŸlized_¡¬t
=469,

135 
£rŸlized_’d
=1105,

139 
_SSDFEATUREEXTRACTOR
 = 
_desütÜ
.
	`DesütÜ
(

140 
Çme
='SsdFeatureExtractor',

141 
fuÎ_Çme
='object_detection.protos.SsdFeatureExtractor',

142 
f’ame
=
NÚe
,

143 
fe
=
DESCRIPTOR
,

144 
cÚššg_ty³
=
NÚe
,

145 
f›lds
=[

146 
_desütÜ
.
	`F›ldDesütÜ
(

147 
Çme
='ty³', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SsdF—tu»ExŒaùÜ.ty³', 
šdex
=0,

148 
numb”
=1, 
ty³
=9, 
ıp_ty³
=9, 
Ïb–
=1,

149 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
	`_b
("").
	`decode
('utf-8'),

150 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

151 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

152 
İtiÚs
=
NÚe
),

153 
_desütÜ
.
	`F›ldDesütÜ
(

154 
Çme
='d•th_muÉl›r', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SsdF—tu»ExŒaùÜ.d•th_muÉl›r', 
šdex
=1,

155 
numb”
=2, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

156 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(1),

157 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

158 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

159 
İtiÚs
=
NÚe
),

160 
_desütÜ
.
	`F›ldDesütÜ
(

161 
Çme
='mš_d•th', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SsdF—tu»ExŒaùÜ.mš_d•th', 
šdex
=2,

162 
numb”
=3, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

163 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=16,

164 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

165 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

166 
İtiÚs
=
NÚe
),

167 
_desütÜ
.
	`F›ldDesütÜ
(

168 
Çme
='cÚv_hy³½¬ams', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SsdF—tu»ExŒaùÜ.cÚv_hy³½¬ams', 
šdex
=3,

169 
numb”
=4, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

170 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

171 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

172 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

173 
İtiÚs
=
NÚe
),

175 
ex‹nsiÚs
=[

177 
Ã¡ed_ty³s
=[],

178 
’um_ty³s
=[

180 
İtiÚs
=
NÚe
,

181 
is_ex‹ndabË
=
F®£
,

182 
syÁax
='proto2',

183 
ex‹nsiÚ_¿nges
=[],

184 
Úeofs
=[

186 
£rŸlized_¡¬t
=1108,

187 
£rŸlized_’d
=1259,

190 
_SSD
.
f›lds_by_Çme
['image_»siz”'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_image__»siz”__pb2
.
_IMAGERESIZER


191 
_SSD
.
f›lds_by_Çme
['ã©u»_exŒaùÜ'].
mes§ge_ty³
 = 
_SSDFEATUREEXTRACTOR


192 
_SSD
.
f›lds_by_Çme
['box_cod”'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_box__cod”__pb2
.
_BOXCODER


193 
_SSD
.
f›lds_by_Çme
['m©ch”'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_m©ch”__pb2
.
_MATCHER


194 
_SSD
.
f›lds_by_Çme
['sim¬™y_ÿlcuÏtÜ'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_»giÚ__sim¬™y__ÿlcuÏtÜ__pb2
.
_REGIONSIMILARITYCALCULATOR


195 
_SSD
.
f›lds_by_Çme
['box_´ediùÜ'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_box__´ediùÜ__pb2
.
_BOXPREDICTOR


196 
_SSD
.
f›lds_by_Çme
['ªchÜ_g’”©Ü'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_ªchÜ__g’”©Ü__pb2
.
_ANCHORGENERATOR


197 
_SSD
.
f›lds_by_Çme
['po¡_´oûssšg'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_po¡__´oûssšg__pb2
.
_POSTPROCESSING


198 
_SSD
.
f›lds_by_Çme
['loss'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_los£s__pb2
.
_LOSS


199 
_SSDFEATUREEXTRACTOR
.
f›lds_by_Çme
['cÚv_hy³½¬ams'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_hy³½¬ams__pb2
.
_HYPERPARAMS


200 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['Ssd'] = 
_SSD


201 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['SsdF—tu»ExŒaùÜ'] = 
_SSDFEATUREEXTRACTOR


202 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

204 
Ssd
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('Ssd', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

205 
DESCRIPTOR
 = 
_SSD
,

206 
__moduË__
 = 'object_detection.protos.ssd_pb2'

207 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
Ssd
)

209 
_sym_db
.
	$Regi¡”Mes§ge
(
Ssd
)

211 
SsdF—tu»ExŒaùÜ
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('SsdF—tu»ExŒaùÜ', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

212 
DESCRIPTOR
 = 
_SSDFEATUREEXTRACTOR
,

213 
__moduË__
 = 'object_detection.protos.ssd_pb2'

214 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
SsdF—tu»ExŒaùÜ
)

216 
_sym_db
.
	$Regi¡”Mes§ge
(
SsdF—tu»ExŒaùÜ
)

219 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/string_int_label_map_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
¡ršg_št_Ïb–_m­
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

18 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

19 
Çme
='object_detection/protos/string_int_label_map.proto',

20 
·ckage
='object_detection.protos',

21 
syÁax
='proto2',

22 
£rŸlized_pb
=
	`_b
('\n2object_detection/protos/string_int_label_map.proto\x12\x17object_detection.protos\"G\n\x15StringIntLabelMapItem\x12\x0c\n\x04name\x18\x01 \x01(\t\x12\n\n\x02id\x18\x02 \x01(\x05\x12\x14\n\x0c\x64isplay_name\x18\x03 \x01(\t\"Q\n\x11StringIntLabelMap\x12<\n\x04item\x18\x01 \x03(\x0b\x32..object_detection.protos.StringIntLabelMapItem')

28 
_STRINGINTLABELMAPITEM
 = 
_desütÜ
.
	`DesütÜ
(

29 
Çme
='StringIntLabelMapItem',

30 
fuÎ_Çme
='object_detection.protos.StringIntLabelMapItem',

31 
f’ame
=
NÚe
,

32 
fe
=
DESCRIPTOR
,

33 
cÚššg_ty³
=
NÚe
,

34 
f›lds
=[

35 
_desütÜ
.
	`F›ldDesütÜ
(

36 
Çme
='Çme', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SŒšgIÁLab–M­I‹m.Çme', 
šdex
=0,

37 
numb”
=1, 
ty³
=9, 
ıp_ty³
=9, 
Ïb–
=1,

38 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
	`_b
("").
	`decode
('utf-8'),

39 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

40 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

41 
İtiÚs
=
NÚe
),

42 
_desütÜ
.
	`F›ldDesütÜ
(

43 
Çme
='id', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SŒšgIÁLab–M­I‹m.id', 
šdex
=1,

44 
numb”
=2, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

45 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=0,

46 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

47 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

48 
İtiÚs
=
NÚe
),

49 
_desütÜ
.
	`F›ldDesütÜ
(

50 
Çme
='di¥Ïy_Çme', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SŒšgIÁLab–M­I‹m.di¥Ïy_Çme', 
šdex
=2,

51 
numb”
=3, 
ty³
=9, 
ıp_ty³
=9, 
Ïb–
=1,

52 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
	`_b
("").
	`decode
('utf-8'),

53 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

54 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

55 
İtiÚs
=
NÚe
),

57 
ex‹nsiÚs
=[

59 
Ã¡ed_ty³s
=[],

60 
’um_ty³s
=[

62 
İtiÚs
=
NÚe
,

63 
is_ex‹ndabË
=
F®£
,

64 
syÁax
='proto2',

65 
ex‹nsiÚ_¿nges
=[],

66 
Úeofs
=[

68 
£rŸlized_¡¬t
=79,

69 
£rŸlized_’d
=150,

73 
_STRINGINTLABELMAP
 = 
_desütÜ
.
	`DesütÜ
(

74 
Çme
='StringIntLabelMap',

75 
fuÎ_Çme
='object_detection.protos.StringIntLabelMap',

76 
f’ame
=
NÚe
,

77 
fe
=
DESCRIPTOR
,

78 
cÚššg_ty³
=
NÚe
,

79 
f›lds
=[

80 
_desütÜ
.
	`F›ldDesütÜ
(

81 
Çme
='™em', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.SŒšgIÁLab–M­.™em', 
šdex
=0,

82 
numb”
=1, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=3,

83 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=[],

84 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

85 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

86 
İtiÚs
=
NÚe
),

88 
ex‹nsiÚs
=[

90 
Ã¡ed_ty³s
=[],

91 
’um_ty³s
=[

93 
İtiÚs
=
NÚe
,

94 
is_ex‹ndabË
=
F®£
,

95 
syÁax
='proto2',

96 
ex‹nsiÚ_¿nges
=[],

97 
Úeofs
=[

99 
£rŸlized_¡¬t
=152,

100 
£rŸlized_’d
=233,

103 
_STRINGINTLABELMAP
.
f›lds_by_Çme
['™em'].
mes§ge_ty³
 = 
_STRINGINTLABELMAPITEM


104 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['SŒšgIÁLab–M­I‹m'] = 
_STRINGINTLABELMAPITEM


105 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['SŒšgIÁLab–M­'] = 
_STRINGINTLABELMAP


106 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

108 
SŒšgIÁLab–M­I‹m
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('SŒšgIÁLab–M­I‹m', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

109 
DESCRIPTOR
 = 
_STRINGINTLABELMAPITEM
,

110 
__moduË__
 = 'object_detection.protos.string_int_label_map_pb2'

111 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
SŒšgIÁLab–M­I‹m
)

113 
_sym_db
.
	$Regi¡”Mes§ge
(
SŒšgIÁLab–M­I‹m
)

115 
SŒšgIÁLab–M­
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('SŒšgIÁLab–M­', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

116 
DESCRIPTOR
 = 
_STRINGINTLABELMAP
,

117 
__moduË__
 = 'object_detection.protos.string_int_label_map_pb2'

118 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
SŒšgIÁLab–M­
)

120 
_sym_db
.
	$Regi¡”Mes§ge
(
SŒšgIÁLab–M­
)

123 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@protos/train_pb2.py

1 #G’”©ed 
by
 
the
 
´ÙocŞ
 
bufãr
 
comp”
. 
DO
 
NOT
 
EDIT
!

2 #sourû: 
objeù_d‘eùiÚ
/
´Ùos
/
Œaš
.
´Ùo


4 
impÜt
 
sys


5 
	g_b
=
sys
.
v”siÚ_šfo
[0]<3 
	$ªd
 (
Ïmbda
 
x
:xè
	`Ü
 (Ïmbd¨x:x.
	`’code
('latin1'))

6 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ
 
as
 
_desütÜ


7 
äom
 
googË
.
´Ùobuf
 
impÜt
 
mes§ge
 
as
 
_mes§ge


8 
äom
 
googË
.
´Ùobuf
 
impÜt
 
»æeùiÚ
 
as
 
_»æeùiÚ


9 
äom
 
googË
.
´Ùobuf
 
impÜt
 
symbŞ_d©aba£
 
as
 
_symbŞ_d©aba£


10 
äom
 
googË
.
´Ùobuf
 
impÜt
 
desütÜ_pb2


11 #@@
	`´Ùoc_š£¹iÚ_pošt
(
impÜts
)

13 
_sym_db
 = 
_symbŞ_d©aba£
.
	$DeçuÉ
()

16 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
İtimiz”_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_İtimiz”__pb2


17 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
´•roûssÜ_pb2
 
as
 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_´•roûssÜ__pb2


20 
DESCRIPTOR
 = 
_desütÜ
.
	`FeDesütÜ
(

21 
Çme
='object_detection/protos/train.proto',

22 
·ckage
='object_detection.protos',

23 
syÁax
='proto2',

24 
£rŸlized_pb
=
	`_b
('\n#object_detection/protos/train.proto\x12\x17object_detection.protos\x1a\'object_detection/protos/optimizer.proto\x1a*object_detection/protos/preprocessor.proto\"\xe6\x04\n\x0bTrainConfig\x12\x16\n\nbatch_size\x18\x01 \x01(\r:\x02\x33\x32\x12M\n\x19\x64\x61ta_augmentation_options\x18\x02 \x03(\x0b\x32*.object_detection.protos.PreprocessingStep\x12\x1c\n\rsync_replicas\x18\x03 \x01(\x08:\x05\x66\x61lse\x12+\n\x1dkeep_checkpoint_every_n_hours\x18\x04 \x01(\r:\x04\x31\x30\x30\x30\x12\x35\n\toptimizer\x18\x05 \x01(\x0b\x32\".object_detection.protos.Optimizer\x12$\n\x19gradient_clipping_by_norm\x18\x06 \x01(\x02:\x01\x30\x12\x1e\n\x14\x66ine_tune_checkpoint\x18\x07 \x01(\t:\x00\x12(\n\x19\x66rom_detection_checkpoint\x18\x08 \x01(\x08:\x05\x66\x61lse\x12\x14\n\tnum_steps\x18\t \x01(\r:\x01\x30\x12\x1f\n\x13startup_delay_steps\x18\n \x01(\x02:\x02\x31\x35\x12\x1f\n\x14\x62ias_grad_multiplier\x18\x0b \x01(\x02:\x01\x30\x12\x18\n\x10\x66reeze_variables\x18\x0c \x03(\t\x12 \n\x15replicas_to_aggregate\x18\r \x01(\x05:\x01\x31\x12!\n\x14\x62\x61tch_queue_capacity\x18\x0e \x01(\x05:\x03\x36\x30\x30\x12\"\n\x17num_batch_queue_threads\x18\x0f \x01(\x05:\x01\x38\x12#\n\x17prefetch_queue_capacity\x18\x10 \x01(\x05:\x02\x31\x30')

26 
d•’d’c›s
=[
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_İtimiz”__pb2
.
DESCRIPTOR
,
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_´•roûssÜ__pb2
.DESCRIPTOR,])

31 
_TRAINCONFIG
 = 
_desütÜ
.
	`DesütÜ
(

32 
Çme
='TrainConfig',

33 
fuÎ_Çme
='object_detection.protos.TrainConfig',

34 
f’ame
=
NÚe
,

35 
fe
=
DESCRIPTOR
,

36 
cÚššg_ty³
=
NÚe
,

37 
f›lds
=[

38 
_desütÜ
.
	`F›ldDesütÜ
(

39 
Çme
='b©ch_size', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šCÚfig.b©ch_size', 
šdex
=0,

40 
numb”
=1, 
ty³
=13, 
ıp_ty³
=3, 
Ïb–
=1,

41 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=32,

42 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

43 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

44 
İtiÚs
=
NÚe
),

45 
_desütÜ
.
	`F›ldDesütÜ
(

46 
Çme
='d©a_augm’tiÚ_İtiÚs', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šCÚfig.d©a_augm’tiÚ_İtiÚs', 
šdex
=1,

47 
numb”
=2, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=3,

48 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=[],

49 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

50 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

51 
İtiÚs
=
NÚe
),

52 
_desütÜ
.
	`F›ldDesütÜ
(

53 
Çme
='sync_»¶iÿs', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šCÚfig.sync_»¶iÿs', 
šdex
=2,

54 
numb”
=3, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

55 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

56 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

57 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

58 
İtiÚs
=
NÚe
),

59 
_desütÜ
.
	`F›ldDesütÜ
(

60 
Çme
='k“p_checkpošt_ev”y_n_hours', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šCÚfig.k“p_checkpošt_ev”y_n_hours', 
šdex
=3,

61 
numb”
=4, 
ty³
=13, 
ıp_ty³
=3, 
Ïb–
=1,

62 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=1000,

63 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

64 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

65 
İtiÚs
=
NÚe
),

66 
_desütÜ
.
	`F›ldDesütÜ
(

67 
Çme
='İtimiz”', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šCÚfig.İtimiz”', 
šdex
=4,

68 
numb”
=5, 
ty³
=11, 
ıp_ty³
=10, 
Ïb–
=1,

69 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=
NÚe
,

70 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

71 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

72 
İtiÚs
=
NÚe
),

73 
_desütÜ
.
	`F›ldDesütÜ
(

74 
Çme
='g¿d›Á_şpšg_by_nÜm', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šCÚfig.g¿d›Á_şpšg_by_nÜm', 
šdex
=5,

75 
numb”
=6, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

76 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0),

77 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

78 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

79 
İtiÚs
=
NÚe
),

80 
_desütÜ
.
	`F›ldDesütÜ
(

81 
Çme
='fše_tuÃ_checkpošt', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šCÚfig.fše_tuÃ_checkpošt', 
šdex
=6,

82 
numb”
=7, 
ty³
=9, 
ıp_ty³
=9, 
Ïb–
=1,

83 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
	`_b
("").
	`decode
('utf-8'),

84 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

85 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

86 
İtiÚs
=
NÚe
),

87 
_desütÜ
.
	`F›ldDesütÜ
(

88 
Çme
='äom_d‘eùiÚ_checkpošt', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šCÚfig.äom_d‘eùiÚ_checkpošt', 
šdex
=7,

89 
numb”
=8, 
ty³
=8, 
ıp_ty³
=7, 
Ïb–
=1,

90 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=
F®£
,

91 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

92 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

93 
İtiÚs
=
NÚe
),

94 
_desütÜ
.
	`F›ldDesütÜ
(

95 
Çme
='num_¡•s', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šCÚfig.num_¡•s', 
šdex
=8,

96 
numb”
=9, 
ty³
=13, 
ıp_ty³
=3, 
Ïb–
=1,

97 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=0,

98 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

99 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

100 
İtiÚs
=
NÚe
),

101 
_desütÜ
.
	`F›ldDesütÜ
(

102 
Çme
='¡¬tup_d–ay_¡•s', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šCÚfig.¡¬tup_d–ay_¡•s', 
šdex
=9,

103 
numb”
=10, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

104 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(15),

105 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

106 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

107 
İtiÚs
=
NÚe
),

108 
_desütÜ
.
	`F›ldDesütÜ
(

109 
Çme
='bŸs_g¿d_muÉl›r', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šCÚfig.bŸs_g¿d_muÉl›r', 
šdex
=10,

110 
numb”
=11, 
ty³
=2, 
ıp_ty³
=6, 
Ïb–
=1,

111 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=(0),

112 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

113 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

114 
İtiÚs
=
NÚe
),

115 
_desütÜ
.
	`F›ldDesütÜ
(

116 
Çme
='ä“ze_v¬ŸbËs', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šCÚfig.ä“ze_v¬ŸbËs', 
šdex
=11,

117 
numb”
=12, 
ty³
=9, 
ıp_ty³
=9, 
Ïb–
=3,

118 
has_deçuÉ_v®ue
=
F®£
, 
deçuÉ_v®ue
=[],

119 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

120 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

121 
İtiÚs
=
NÚe
),

122 
_desütÜ
.
	`F›ldDesütÜ
(

123 
Çme
='»¶iÿs_to_agg»g©e', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šCÚfig.»¶iÿs_to_agg»g©e', 
šdex
=12,

124 
numb”
=13, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

125 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=1,

126 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

127 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

128 
İtiÚs
=
NÚe
),

129 
_desütÜ
.
	`F›ldDesütÜ
(

130 
Çme
='b©ch_queue_ÿ·c™y', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šCÚfig.b©ch_queue_ÿ·c™y', 
šdex
=13,

131 
numb”
=14, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

132 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=600,

133 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

134 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

135 
İtiÚs
=
NÚe
),

136 
_desütÜ
.
	`F›ldDesütÜ
(

137 
Çme
='num_b©ch_queue_th»ads', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šCÚfig.num_b©ch_queue_th»ads', 
šdex
=14,

138 
numb”
=15, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

139 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=8,

140 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

141 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

142 
İtiÚs
=
NÚe
),

143 
_desütÜ
.
	`F›ldDesütÜ
(

144 
Çme
='´eãtch_queue_ÿ·c™y', 
fuÎ_Çme
='objeù_d‘eùiÚ.´Ùos.T¿šCÚfig.´eãtch_queue_ÿ·c™y', 
šdex
=15,

145 
numb”
=16, 
ty³
=5, 
ıp_ty³
=1, 
Ïb–
=1,

146 
has_deçuÉ_v®ue
=
True
, 
deçuÉ_v®ue
=10,

147 
mes§ge_ty³
=
NÚe
, 
’um_ty³
=NÚe, 
cÚššg_ty³
=None,

148 
is_ex‹nsiÚ
=
F®£
, 
ex‹nsiÚ_scİe
=
NÚe
,

149 
İtiÚs
=
NÚe
),

151 
ex‹nsiÚs
=[

153 
Ã¡ed_ty³s
=[],

154 
’um_ty³s
=[

156 
İtiÚs
=
NÚe
,

157 
is_ex‹ndabË
=
F®£
,

158 
syÁax
='proto2',

159 
ex‹nsiÚ_¿nges
=[],

160 
Úeofs
=[

162 
£rŸlized_¡¬t
=150,

163 
£rŸlized_’d
=764,

166 
_TRAINCONFIG
.
f›lds_by_Çme
['d©a_augm’tiÚ_İtiÚs'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_´•roûssÜ__pb2
.
_PREPROCESSINGSTEP


167 
_TRAINCONFIG
.
f›lds_by_Çme
['İtimiz”'].
mes§ge_ty³
 = 
objeù__d‘eùiÚ_dÙ_´Ùos_dÙ_İtimiz”__pb2
.
_OPTIMIZER


168 
DESCRIPTOR
.
mes§ge_ty³s_by_Çme
['T¿šCÚfig'] = 
_TRAINCONFIG


169 
_sym_db
.
	$Regi¡”FeDesütÜ
(
DESCRIPTOR
)

171 
T¿šCÚfig
 = 
_»æeùiÚ
.
	`G’”©edPrÙocŞMes§geTy³
('T¿šCÚfig', (
_mes§ge
.
Mes§ge
,), 
	`diù
(

172 
DESCRIPTOR
 = 
_TRAINCONFIG
,

173 
__moduË__
 = 'object_detection.protos.train_pb2'

174 #@@
	`´Ùoc_š£¹iÚ_pošt
(
şass_scİe
:
objeù_d‘eùiÚ
.
´Ùos
.
T¿šCÚfig
)

176 
_sym_db
.
	$Regi¡”Mes§ge
(
T¿šCÚfig
)

179 #@@
	`´Ùoc_š£¹iÚ_pošt
(
moduË_scİe
)

	@train.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

16 
	gr
"""Trainingƒxecutable for detection models.

18 
This
 
execubË
 
is
 
u£d
 
to
 
Œaš
 
	gD‘eùiÚMod–s
. 
Th”e
 
¬e
 
two
 
ways
 
of


19 
cÚfiguršg
 
the
 
Œaššg
 
	gjob
:

21 1è
A
 
sšgË
 
p–še_pb2
.
T¿šEv®P–šeCÚfig
 
cÚfigu¿tiÚ
 
fe


22 
ÿn
 
be
 
¥ecif›d
 
by
 --
p–še_cÚfig_·th
.

24 
Exam¶e
 
u§ge
:

25 ./
Œaš
 \

26 --
logto¡d”r
 \

27 --
Œaš_dœ
=
·th
/
to
/train_dir \

28 --
p–še_cÚfig_·th
=
p–še_cÚfig
.
pbtxt


30 2è
Th»e
 
cÚfigu¿tiÚ
 
fes
 
ÿn
 
be
 
´ovided
: 
a
 
mod–_pb2
.
D‘eùiÚMod–


31 
cÚfigu¿tiÚ
 
fe
 
to
 
defše
 
wh©
 
ty³
 
of
 
D‘eùiÚMod–
 
is
 
bešg
 
Œašed
, 
ª


32 
	gšput_»ad”_pb2
.
IÅutR—d”
 
fe
 
to
 
¥ecify
 
wh©
 
Œaššg
 
d©a
 
wl
 
be
 
u£d
 
ªd


33 
a
 
	gŒaš_pb2
.
T¿šCÚfig
 
fe
 
to
 
cÚfigu»
 
Œaššg
 
	g·¿m‘”s
.

35 
Exam¶e
 
	gu§ge
:

36 ./
Œaš
 \

37 --
logto¡d”r
 \

38 --
Œaš_dœ
=
·th
/
to
/train_dir \

39 --
mod–_cÚfig_·th
=
mod–_cÚfig
.
pbtxt
 \

40 --
Œaš_cÚfig_·th
=
Œaš_cÚfig
.
pbtxt
 \

41 --
šput_cÚfig_·th
=
Œaš_šput_cÚfig
.
pbtxt


44 
impÜt
 
funùoŞs


45 
impÜt
 
jsÚ


46 
impÜt
 
os


47 
impÜt
 
‹nsÜæow
 
as
 
tf


49 
äom
 
googË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


51 
äom
 
objeù_d‘eùiÚ
 
impÜt
 
Œaš”


52 
äom
 
objeù_d‘eùiÚ
.
bud”s
 
impÜt
 
šput_»ad”_bud”


53 
äom
 
objeù_d‘eùiÚ
.
bud”s
 
impÜt
 
mod–_bud”


54 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
šput_»ad”_pb2


55 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
mod–_pb2


56 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
p–še_pb2


57 
äom
 
objeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
Œaš_pb2


59 
tf
.
loggšg
.
	$£t_v”bos™y
(
tf
.
loggšg
.
INFO
)

61 
æags
 = 
tf
.
­p
.flags

62 
æags
.
	`DEFINE_¡ršg
('master', '', 'BNS‚ame ofhe TensorFlow mastero use.')

63 
æags
.
	`DEFINE_š‹g”
('task', 0, 'task id')

64 
æags
.
	`DEFINE_š‹g”
('num_clones', 1, 'Number of cloneso deploy…er worker.')

65 
æags
.
	`DEFINE_boŞ—n
('şÚe_Ú_ıu', 
F®£
,

69 
æags
.
	`DEFINE_š‹g”
('worker_replicas', 1, 'Number of worker+trainer '

71 
æags
.
	`DEFINE_š‹g”
('ps_tasks', 0,

74 
æags
.
	`DEFINE_¡ršg
('train_dir', '',

77 
æags
.
	`DEFINE_¡ršg
('pipeline_config_path', '',

81 
æags
.
	`DEFINE_¡ršg
('train_config_path', '',

83 
æags
.
	`DEFINE_¡ršg
('input_config_path', '',

85 
æags
.
	`DEFINE_¡ršg
('model_config_path', '',

88 
FLAGS
 = 
æags
.FLAGS

91 
def
 
	$g‘_cÚfigs_äom_p–še_fe
():

94 
R—ds
 
Œaššg
 
cÚfig
 
äom
 
fe
 
¥ecif›d
 
by
 
p–še_cÚfig_·th
 
æag
.

96 
R‘uºs
:

97 
mod–_cÚfig
: 
mod–_pb2
.
D‘eùiÚMod–


98 
Œaš_cÚfig
: 
Œaš_pb2
.
T¿šCÚfig


99 
šput_cÚfig
: 
šput_»ad”_pb2
.
IÅutR—d”


101 
p–še_cÚfig
 = 
p–še_pb2
.
	$T¿šEv®P–šeCÚfig
()

102 
w™h
 
tf
.
gfe
.
	`GFe
(
FLAGS
.
p–še_cÚfig_·th
, 'r'è
as
 
f
:

103 
‹xt_fÜm©
.
	`M”ge
(
f
.
	`»ad
(), 
p–še_cÚfig
)

105 
mod–_cÚfig
 = 
p–še_cÚfig
.
mod–


106 
Œaš_cÚfig
 = 
p–še_cÚfig
.train_config

107 
šput_cÚfig
 = 
p–še_cÚfig
.
Œaš_šput_»ad”


109  
mod–_cÚfig
, 
Œaš_cÚfig
, 
šput_cÚfig


112 
def
 
	$g‘_cÚfigs_äom_muÉË_fes
():

115 
R—ds
 
the
 
Œaššg
 
cÚfig
 
äom
h
fŞlowšg
 
fes
:

116 
mod–_cÚfig
: 
R—d
 
äom
 --
mod–_cÚfig_·th


117 
Œaš_cÚfig
: 
R—d
 
äom
 --
Œaš_cÚfig_·th


118 
šput_cÚfig
: 
R—d
 
äom
 --
šput_cÚfig_·th


120 
R‘uºs
:

121 
mod–_cÚfig
: 
mod–_pb2
.
D‘eùiÚMod–


122 
Œaš_cÚfig
: 
Œaš_pb2
.
T¿šCÚfig


123 
šput_cÚfig
: 
šput_»ad”_pb2
.
IÅutR—d”


125 
Œaš_cÚfig
 = 
Œaš_pb2
.
	$T¿šCÚfig
()

126 
w™h
 
tf
.
gfe
.
	`GFe
(
FLAGS
.
Œaš_cÚfig_·th
, 'r'è
as
 
f
:

127 
‹xt_fÜm©
.
	`M”ge
(
f
.
	`»ad
(), 
Œaš_cÚfig
)

129 
mod–_cÚfig
 = 
mod–_pb2
.
	$D‘eùiÚMod–
()

130 
w™h
 
tf
.
gfe
.
	`GFe
(
FLAGS
.
mod–_cÚfig_·th
, 'r'è
as
 
f
:

131 
‹xt_fÜm©
.
	`M”ge
(
f
.
	`»ad
(), 
mod–_cÚfig
)

133 
šput_cÚfig
 = 
šput_»ad”_pb2
.
	$IÅutR—d”
()

134 
w™h
 
tf
.
gfe
.
	`GFe
(
FLAGS
.
šput_cÚfig_·th
, 'r'è
as
 
f
:

135 
‹xt_fÜm©
.
	`M”ge
(
f
.
	`»ad
(), 
šput_cÚfig
)

137  
mod–_cÚfig
, 
Œaš_cÚfig
, 
šput_cÚfig


140 
def
 
	$maš
(
_
):

141 
as£¹
 
FLAGS
.
Œaš_dœ
, '`train_dir` is missing.'

142 
FLAGS
.
p–še_cÚfig_·th
:

143 
mod–_cÚfig
, 
Œaš_cÚfig
, 
šput_cÚfig
 = 
	$g‘_cÚfigs_äom_p–še_fe
()

145 
mod–_cÚfig
, 
Œaš_cÚfig
, 
šput_cÚfig
 = 
	$g‘_cÚfigs_äom_muÉË_fes
()

147 
mod–_â
 = 
funùoŞs
.
	$·¹Ÿl
(

148 
mod–_bud”
.
bud
,

149 
mod–_cÚfig
=model_config,

150 
is_Œaššg
=
True
)

152 
ü—‹_šput_diù_â
 = 
funùoŞs
.
	$·¹Ÿl
(

153 
šput_»ad”_bud”
.
bud
, 
šput_cÚfig
)

155 
’v
 = 
jsÚ
.
	`lßds
(
os
.
’vœÚ
.
	`g‘
('TF_CONFIG', '{}'))

156 
şu¡”_d©a
 = 
’v
.
	`g‘
('şu¡”', 
NÚe
)

157 
şu¡”
 = 
tf
.
Œaš
.
	$Clu¡”S³c
(
şu¡”_d©a
èşu¡”_d©¨
NÚe


158 
sk_d©a
 = 
’v
.
	`g‘
('sk', 
NÚe
è
Ü
 {'ty³': 'ma¡”', 'šdex': 0
	}
}

159 
sk_šfo
 = 
ty³
('TaskS³c', (
objeù
,), 
sk_d©a
)

161 #P¬am‘” 
a
 
sšgË
 
wÜk”
.

162 
	gps_sks
 = 0

163 
wÜk”_»¶iÿs
 = 1

164 
wÜk”_job_Çme
 = 'lonely_worker'

165 
sk
 = 0

166 
is_ch›f
 = 
True


167 
ma¡”
 = ''

169 
şu¡”_d©a
 
ªd
 'wÜk”' 
š
 cluster_data:

170 #Numb” 
of
 
tÙ®
 
wÜk”
 
»¶iÿs
 
šşude
 "wÜk”"
s
 
ªd
 
the
 "master".

171 
wÜk”_»¶iÿs
 = 
Ën
(
şu¡”_d©a
['worker']) + 1

172 
şu¡”_d©a
 
ªd
 'ps' 
š
 cluster_data:

173 
ps_sks
 = 
Ën
(
şu¡”_d©a
['ps'])

175 
wÜk”_»¶iÿs
 > 1 
ªd
 
ps_sks
 < 1:

176 
¿i£
 
V®ueE¼Ü
('At†east 1…sask is‚eeded for distributedraining.')

178 
wÜk”_»¶iÿs
 >ğ1 
ªd
 
ps_sks
 > 0:

179 #S‘ 
up
 
di¡ribu‹d
 
Œaššg
.

180 
£rv”
 = 
tf
.
Œaš
.
S”v”
Ñf.Œaš.
Clu¡”S³c
(
şu¡”
), 
´ÙocŞ
='grpc',

181 
job_Çme
=
sk_šfo
.
ty³
,

182 
sk_šdex
=
sk_šfo
.
šdex
)

183 
sk_šfo
.
ty³
 == 'ps':

184 
£rv”
.
	$još
()

187 
wÜk”_job_Çme
 = '%s/sk:%d' % (
sk_šfo
.
ty³
,ask_šfo.
šdex
)

188 
sk
 = 
sk_šfo
.
šdex


189 
is_ch›f
 = (
sk_šfo
.
ty³
 == 'master')

190 
ma¡”
 = 
£rv”
.
rg‘


192 
Œaš”
.
	$Œaš
(
ü—‹_šput_diù_â
, 
mod–_â
, 
Œaš_cÚfig
, 
ma¡”
, 
sk
,

193 
FLAGS
.
num_şÚes
, 
wÜk”_»¶iÿs
, FLAGS.
şÚe_Ú_ıu
, 
ps_sks
,

194 
wÜk”_job_Çme
, 
is_ch›f
, 
FLAGS
.
Œaš_dœ
)

197 
__Çme__
 == '__main__':

198 
tf
.
­p
.
	`run
()

	@trainer.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
This
 
fe
 
´ovides
 
a
 
g’”ic
 
Œaššg
 
m‘hod
 
th©
 
ÿn
 
be
 
u£d
 
to
 
Œaš
‡

19 
	gD‘eùiÚMod–
.

22 
impÜt
 
funùoŞs


24 
impÜt
 
‹nsÜæow
 
as
 
tf


26 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
İtimiz”_bud”


27 
äom
 
	gobjeù_d‘eùiÚ
.
bud”s
 
impÜt
 
´•roûssÜ_bud”


28 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
b©ch”


29 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
´•roûssÜ


30 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
¡ªd¬d_f›lds
 
as
 
f›lds


31 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
İs
 
as
 
ut_İs


32 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
v¬ŸbËs_h–³r


33 
äom
 
d•loym’t
 
impÜt
 
mod–_d•loy


35 
	g¦im
 = 
tf
.
cÚŒib
.
¦im


38 
def
 
	$_ü—‹_šput_queue
(
b©ch_size_³r_şÚe
, 
ü—‹_‹nsÜ_diù_â
,

39 
b©ch_queue_ÿ·c™y
, 
num_b©ch_queue_th»ads
,

40 
´eãtch_queue_ÿ·c™y
, 
d©a_augm’tiÚ_İtiÚs
):

43 
Args
:

44 
b©ch_size_³r_şÚe
: 
b©ch
 
size
 
to
 
u£
 
³r
 
şÚe
.

45 
ü—‹_‹nsÜ_diù_â
: 
funùiÚ
 
to
 
ü—‹
 
‹nsÜ
 
diùiÚ¬y
.

46 
b©ch_queue_ÿ·c™y
: 
maximum
 
numb”
 
of
 
–em’ts
 
to
 
¡Üe
 
w™hš
 
a
 
queue
.

47 
num_b©ch_queue_th»ads
: 
numb”
 
of
 
th»ads
 
to
 
u£
 
b©chšg
.

48 
´eãtch_queue_ÿ·c™y
: 
maximum
 
ÿ·c™y
 
of
 
the
 
queue
 
u£d
 
to
 
´eãtch


49 
as£mbËd
 
b©ches
.

50 
d©a_augm’tiÚ_İtiÚs
: 
a
 
li¡
 
of
 
tu¶es
, 
wh”e
 
—ch
 
tu¶e
 
cÚšs
‡

51 
d©a
 
augm’tiÚ
 
funùiÚ
 
ªd
 
a
 
diùiÚ¬y
 
cÚššg
 
¬gum’ts
‡nd 
theœ


52 
	`v®ues
 (
£e
 
´•roûssÜ
.
py
).

54 
R‘uºs
:

55 
šput
 
queue
: 
a
 
b©ch”
.
B©chQueue
 
objeù
 
hŞdšg
 
’queued
 
‹nsÜ_diùs


56 (
which
 
hŞd
 
images
, 
boxes
 
ªd
 
rg‘s
). 
To
 
g‘
 
a
 
b©ch
 
of
 
‹nsÜ_diùs
,

57 
ÿÎ
 
šput_queue
.
	`Dequeue
().

59 
‹nsÜ_diù
 = 
	$ü—‹_‹nsÜ_diù_â
()

61 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
] = 
tf
.
	$ex·nd_dims
(

62 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
], 0)

64 
images
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
]

65 
æßt_images
 = 
tf
.
	$to_æßt
(
images
)

66 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
image
] = 
æßt_images


68 
d©a_augm’tiÚ_İtiÚs
:

69 
‹nsÜ_diù
 = 
´•roûssÜ
.
	$´•roûss
(
‹nsÜ_diù
,

70 
d©a_augm’tiÚ_İtiÚs
)

72 
šput_queue
 = 
b©ch”
.
	$B©chQueue
(

73 
‹nsÜ_diù
,

74 
b©ch_size
=
b©ch_size_³r_şÚe
,

75 
b©ch_queue_ÿ·c™y
=batch_queue_capacity,

76 
num_b©ch_queue_th»ads
=num_batch_queue_threads,

77 
´eãtch_queue_ÿ·c™y
=prefetch_queue_capacity)

78  
šput_queue


81 
def
 
	$_g‘_šputs
(
šput_queue
, 
num_şas£s
):

84 
Args
:

85 
šput_queue
: 
B©chQueue
 
objeù
 
hŞdšg
 
’queued
 
‹nsÜ_diùs
.

86 
num_şas£s
: 
Numb”
 
of
 
şas£s
.

88 
R‘uºs
:

89 
images
: 
a
 
li¡
 
of
 3-
D
 
‹nsÜ
 of images.

90 
loÿtiÚs_li¡
: 
a
 
li¡
 
of
 
‹nsÜs
 oà
sh­e
 [
num_boxes
, 4]

91 
cÚššg
 
the
 
cÜÃrs
 
of
h
groundŒuth
 
boxes
.

92 
şas£s_li¡
: 
a
 
li¡
 
of
 
·dded
 
Úe
-
hÙ
 
‹nsÜs
 
cÚššg
 
rg‘
 
şas£s
.

93 
masks_li¡
: 
a
 
li¡
 
of
 3-
D
 
‹nsÜs
 oà
sh­e
 [
num_boxes
, 
image_height
,

94 
image_width
] 
cÚššg
 
š¡ªû
 
masks
 
objeùs
 
´e£Á
 
š
 
the


95 
šput_queue
. 
El£
 
»tuºs
 
NÚe
.

97 
»ad_d©a_li¡
 = 
šput_queue
.
	$dequeue
()

98 
Ïb–_id_off£t
 = 1

99 
def
 
	$exŒaù_images_ªd_rg‘s
(
»ad_d©a
):

100 
image
 = 
»ad_d©a
[
f›lds
.
IÅutD©aF›lds
.image]

101 
loÿtiÚ_gt
 = 
»ad_d©a
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]

102 
şas£s_gt
 = 
tf
.
	$ÿ¡
(
»ad_d©a
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
],

103 
tf
.
št32
)

104 
şas£s_gt
 -ğ
Ïb–_id_off£t


105 
şas£s_gt
 = 
ut_İs
.
	$·dded_Úe_hÙ_’codšg
(
šdiûs
=
şas£s_gt
,

106 
d•th
=
num_şas£s
, 
Ëá_·d
=0)

107 
masks_gt
 = 
»ad_d©a
.
	$g‘
(
f›lds
.
IÅutD©aF›lds
.
groundŒuth_š¡ªû_masks
)

108  
image
, 
loÿtiÚ_gt
, 
şas£s_gt
, 
masks_gt


109  
	`z
(*
	$m­
(
exŒaù_images_ªd_rg‘s
, 
»ad_d©a_li¡
))

112 
def
 
	$_ü—‹_los£s
(
šput_queue
, 
ü—‹_mod–_â
):

115 
Args
:

116 
šput_queue
: 
B©chQueue
 
objeù
 
hŞdšg
 
’queued
 
‹nsÜ_diùs
.

117 
ü—‹_mod–_â
: 
A
 
funùiÚ
 
to
 
ü—‹
 
the
 
D‘eùiÚMod–
.

119 
d‘eùiÚ_mod–
 = 
	$ü—‹_mod–_â
()

120 (
images
, 
groundŒuth_boxes_li¡
, 
groundŒuth_şas£s_li¡
,

121 
groundŒuth_masks_li¡


122 èğ
	$_g‘_šputs
(
šput_queue
, 
d‘eùiÚ_mod–
.
num_şas£s
)

123 
images
 = [
d‘eùiÚ_mod–
.
	$´•roûss
(
image
èimag
š
 
images
]

124 
images
 = 
tf
.
	$cÚÿt
(
images
, 0)

125 
	$ªy
(
mask
 
is
 
NÚe
 mask 
š
 
groundŒuth_masks_li¡
):

126 
groundŒuth_masks_li¡
 = 
NÚe


128 
d‘eùiÚ_mod–
.
	$´ovide_groundŒuth
(
groundŒuth_boxes_li¡
,

129 
groundŒuth_şas£s_li¡
,

130 
groundŒuth_masks_li¡
)

131 
´ediùiÚ_diù
 = 
d‘eùiÚ_mod–
.
	$´ediù
(
images
)

133 
los£s_diù
 = 
d‘eùiÚ_mod–
.
	$loss
(
´ediùiÚ_diù
)

134 
loss_‹nsÜ
 
š
 
los£s_diù
.
	$v®ues
():

135 
tf
.
los£s
.
	$add_loss
(
loss_‹nsÜ
)

138 
def
 
	$Œaš
(
ü—‹_‹nsÜ_diù_â
, 
ü—‹_mod–_â
, 
Œaš_cÚfig
, 
ma¡”
, 
sk
,

139 
num_şÚes
, 
wÜk”_»¶iÿs
, 
şÚe_Ú_ıu
, 
ps_sks
, 
wÜk”_job_Çme
,

140 
is_ch›f
, 
Œaš_dœ
):

143 
Args
:

144 
ü—‹_‹nsÜ_diù_â
: 
a
 
funùiÚ
 
to
 
ü—‹
‡ 
‹nsÜ
 
šput
 
diùiÚ¬y
.

145 
ü—‹_mod–_â
: 
a
 
funùiÚ
 
th©
 
ü—‹s
‡ 
D‘eùiÚMod–
 
ªd
 
g’”©es


146 
los£s
.

147 
Œaš_cÚfig
: 
a
 
Œaš_pb2
.
T¿šCÚfig
 
´Ùobuf
.

148 
ma¡”
: 
BNS
 
Çme
 
of
 
the
 
T’sÜFlow
 ma¡” 
to
 
u£
.

149 
sk
: 
The
ask 
id
 
of
 
this
 
Œaššg
 
š¡ªû
.

150 
num_şÚes
: 
The
 
numb”
 
of
 
şÚes
 
to
 
run
 
³r
 
machše
.

151 
wÜk”_»¶iÿs
: 
The
 
numb”
 
of
 
wÜk
 
»¶iÿs
 
to
 
Œaš
 
w™h
.

152 
şÚe_Ú_ıu
: 
True
 
şÚes
 
should
 
be
 
fÜûd
 
to
 
run
 
Ú
 
CPU
.

153 
ps_sks
: 
Numb”
 
of
 
·¿m‘”
 
£rv”
 
sks
.

154 
wÜk”_job_Çme
: 
Name
 
of
 
the
 
wÜk”
 
job
.

155 
is_ch›f
: 
Wh‘h”
 
this
 
»¶iÿ
 
is
 
the
 
ch›f
„eplica.

156 
Œaš_dœ
: 
DœeùÜy
 
to
 
wr™e
 
checkpošts
 
ªd
 
Œaššg
 
summ¬›s
o.

159 
d‘eùiÚ_mod–
 = 
	$ü—‹_mod–_â
()

160 
d©a_augm’tiÚ_İtiÚs
 = [

161 
´•roûssÜ_bud”
.
	$bud
(
¡•
)

162 
¡•
 
š
 
Œaš_cÚfig
.
d©a_augm’tiÚ_İtiÚs
]

164 
w™h
 
tf
.
	`G¿ph
().
	$as_deçuÉ
():

165 #Bud 
a
 
cÚfigu¿tiÚ
 
¥ecifyšg
 
muÉi
-
GPU
 
ªd
 muÉi-
»¶iÿs
.

166 
d•loy_cÚfig
 = 
mod–_d•loy
.
	$D•loym’tCÚfig
(

167 
num_şÚes
=num_clones,

168 
şÚe_Ú_ıu
=clone_on_cpu,

169 
»¶iÿ_id
=
sk
,

170 
num_»¶iÿs
=
wÜk”_»¶iÿs
,

171 
num_ps_sks
=
ps_sks
,

172 
wÜk”_job_Çme
=worker_job_name)

174 #PÏû 
the
 
glob®
 
¡•
 
Ú
h
deviû
 
¡Üšg
h
v¬ŸbËs
.

175 
w™h
 
tf
.
	`deviû
(
d•loy_cÚfig
.
	$v¬ŸbËs_deviû
()):

176 
glob®_¡•
 = 
¦im
.
	$ü—‹_glob®_¡•
()

178 
w™h
 
tf
.
	`deviû
(
d•loy_cÚfig
.
	$šputs_deviû
()):

179 
šput_queue
 = 
	$_ü—‹_šput_queue
(
Œaš_cÚfig
.
b©ch_size


180 
ü—‹_‹nsÜ_diù_â
,

181 
Œaš_cÚfig
.
b©ch_queue_ÿ·c™y
,

182 
Œaš_cÚfig
.
num_b©ch_queue_th»ads
,

183 
Œaš_cÚfig
.
´eãtch_queue_ÿ·c™y
,

184 
d©a_augm’tiÚ_İtiÚs
)

186 #G©h” 
š™Ÿl
 
summ¬›s
.

187 
summ¬›s
 = 
	`£t
(
tf
.
	$g‘_cŞËùiÚ
(
tf
.
G¿phKeys
.
SUMMARIES
))

188 
glob®_summ¬›s
 = 
	$£t
([])

190 
mod–_â
 = 
funùoŞs
.
	$·¹Ÿl
(
_ü—‹_los£s
,

191 
ü—‹_mod–_â
=create_model_fn)

192 
şÚes
 = 
mod–_d•loy
.
	$ü—‹_şÚes
(
d•loy_cÚfig
, 
mod–_â
, [
šput_queue
])

193 
fœ¡_şÚe_scİe
 = 
şÚes
[0].
scİe


195 #G©h” 
upd©e_İs
 
äom
 
the
 
fœ¡
 
şÚe
. 
The£
 
cÚš
, 
exam¶e
,

196 #th
upd©es
 
the
 
b©ch_nÜm
 
v¬ŸbËs
 
ü—‹d
 
by
 
mod–_â
.

197 
upd©e_İs
 = 
tf
.
	$g‘_cŞËùiÚ
(
tf
.
G¿phKeys
.
UPDATE_OPS
, 
fœ¡_şÚe_scİe
)

199 
w™h
 
tf
.
	`deviû
(
d•loy_cÚfig
.
	$İtimiz”_deviû
()):

200 
Œaššg_İtimiz”
 = 
İtimiz”_bud”
.
	$bud
(
Œaš_cÚfig
.
İtimiz”
,

201 
glob®_summ¬›s
)

203 
sync_İtimiz”
 = 
NÚe


204 
Œaš_cÚfig
.
sync_»¶iÿs
:

205 
Œaššg_İtimiz”
 = 
tf
.
	$SyncR•liÿsO±imiz”
(

206 
Œaššg_İtimiz”
,

207 
»¶iÿs_to_agg»g©e
=
Œaš_cÚfig
.replicas_to_aggregate,

208 
tÙ®_num_»¶iÿs
=
Œaš_cÚfig
.
wÜk”_»¶iÿs
)

209 
sync_İtimiz”
 = 
Œaššg_İtimiz”


211 #C»©
İs
 
»quœed
 
to
 
š™Ÿlize
 
the
 
mod–
 
äom
 
a
 
giv’
 
checkpošt
.

212 
š™_â
 = 
NÚe


213 
Œaš_cÚfig
.
fše_tuÃ_checkpošt
:

214 
v¬_m­
 = 
d‘eùiÚ_mod–
.
	$»¡Üe_m­
(

215 
äom_d‘eùiÚ_checkpošt
=
Œaš_cÚfig
.from_detection_checkpoint)

216 
avaabË_v¬_m­
 = (
v¬ŸbËs_h–³r
.

217 
	$g‘_v¬ŸbËs_avaabË_š_checkpošt
(

218 
v¬_m­
, 
Œaš_cÚfig
.
fše_tuÃ_checkpošt
))

219 
š™_§v”
 = 
tf
.
Œaš
.
	$Sav”
(
avaabË_v¬_m­
)

220 
def
 
	$š™Ÿliz”_â
(
£ss
):

221 
š™_§v”
.
	$»¡Üe
(
£ss
, 
Œaš_cÚfig
.
fše_tuÃ_checkpošt
)

222 
š™_â
 = 
š™Ÿliz”_â


224 
w™h
 
tf
.
	`deviû
(
d•loy_cÚfig
.
	$İtimiz”_deviû
()):

225 
tÙ®_loss
, 
g¿ds_ªd_v¬s
 = 
mod–_d•loy
.
	$İtimize_şÚes
(

226 
şÚes
, 
Œaššg_İtimiz”
, 
»guÏriz©iÚ_los£s
=
NÚe
)

227 
tÙ®_loss
 = 
tf
.
	`check_num”ics
(total_loss, 'LossTensor is inf or‚an.')

229 #O±iÚ®ly 
muÉly
 
bŸs
 
g¿d›Ás
 
by
 
Œaš_cÚfig
.
bŸs_g¿d_muÉl›r
.

230 
Œaš_cÚfig
.
bŸs_g¿d_muÉl›r
:

231 
bŸ£s_»gex_li¡
 = ['.*/biases']

232 
g¿ds_ªd_v¬s
 = 
v¬ŸbËs_h–³r
.
	$muÉly_g¿d›Ás_m©chšg_»gex
(

233 
g¿ds_ªd_v¬s
,

234 
bŸ£s_»gex_li¡
,

235 
muÉl›r
=
Œaš_cÚfig
.
bŸs_g¿d_muÉl›r
)

237 #O±iÚ®ly 
ä“ze
 
some
 
Ïy”s
 
by
 
£‰šg
 
theœ
 
g¿d›Ás
 
to
 
be
 
z”o
.

238 
Œaš_cÚfig
.
ä“ze_v¬ŸbËs
:

239 
g¿ds_ªd_v¬s
 = 
v¬ŸbËs_h–³r
.
	$ä“ze_g¿d›Ás_m©chšg_»gex
(

240 
g¿ds_ªd_v¬s
, 
Œaš_cÚfig
.
ä“ze_v¬ŸbËs
)

242 #O±iÚ®ly 
ş
 
g¿d›Ás


243 
Œaš_cÚfig
.
g¿d›Á_şpšg_by_nÜm
 > 0:

244 
w™h
 
tf
.
	`Çme_scİe
('clip_grads'):

245 
g¿ds_ªd_v¬s
 = 
¦im
.
Ë¬nšg
.
	$ş_g¿d›Á_nÜms
(

246 
g¿ds_ªd_v¬s
, 
Œaš_cÚfig
.
g¿d›Á_şpšg_by_nÜm
)

248 #C»©
g¿d›Á
 
upd©es
.

249 
g¿d_upd©es
 = 
Œaššg_İtimiz”
.
	$­¶y_g¿d›Ás
(
g¿ds_ªd_v¬s
,

250 
glob®_¡•
=global_step)

251 
upd©e_İs
.
	$­³nd
(
g¿d_upd©es
)

253 
upd©e_İ
 = 
tf
.
	$group
(*
upd©e_İs
)

254 
w™h
 
tf
.
	$cÚŒŞ_d•’d’c›s
([
upd©e_İ
]):

255 
Œaš_‹nsÜ
 = 
tf
.
	`id’t™y
(
tÙ®_loss
, 
Çme
='train_op')

257 #Add 
summ¬›s
.

258 
mod–_v¬
 
š
 
¦im
.
	$g‘_mod–_v¬ŸbËs
():

259 
glob®_summ¬›s
.
	`add
(
tf
.
summ¬y
.
	$hi¡og¿m
(
mod–_v¬
.
İ
.
Çme
, model_var))

260 
loss_‹nsÜ
 
š
 
tf
.
los£s
.
	$g‘_los£s
():

261 
glob®_summ¬›s
.
	`add
(
tf
.
summ¬y
.
	$sÿÏr
(
loss_‹nsÜ
.
İ
.
Çme
,†oss_tensor))

262 
glob®_summ¬›s
.
	`add
(

263 
tf
.
summ¬y
.
	`sÿÏr
('TÙ®Loss',f.
los£s
.
	$g‘_tÙ®_loss
()))

265 #Add 
the
 
summ¬›s
 
äom
h
fœ¡
 
şÚe
. 
The£
 
cÚš
he summaries

266 #ü—‹d 
by
 
mod–_â
 
ªd
 
e™h”
 
	`İtimize_şÚes
(è
Ü
 
	`_g©h”_şÚe_loss
().

267 
summ¬›s
 |ğ
	`£t
(
tf
.
	$g‘_cŞËùiÚ
(
tf
.
G¿phKeys
.
SUMMARIES
,

268 
fœ¡_şÚe_scİe
))

269 
summ¬›s
 |ğ
glob®_summ¬›s


271 #M”g
®l
 
summ¬›s
 
tog‘h”
.

272 
summ¬y_İ
 = 
tf
.
summ¬y
.
	`m”ge
(
	`li¡
(
summ¬›s
), 
Çme
='summary_op')

274 #Soá 
¶aûm’t
 
®lows
 
¶acšg
 
Ú
 
CPU
 
İs
 
w™hout
 
GPU
 
im¶em’tiÚ
.

275 
£ssiÚ_cÚfig
 = 
tf
.
	$CÚfigPrÙo
(
®low_soá_¶aûm’t
=
True
,

276 
log_deviû_¶aûm’t
=
F®£
)

278 #Sav
checkpošts
 
»guÏ¾y
.

279 
k“p_checkpošt_ev”y_n_hours
 = 
Œaš_cÚfig
.keep_checkpoint_every_n_hours

280 
§v”
 = 
tf
.
Œaš
.
	$Sav”
(

281 
k“p_checkpošt_ev”y_n_hours
=keep_checkpoint_every_n_hours)

283 
¦im
.
Ë¬nšg
.
	`Œaš
(

284 
Œaš_‹nsÜ
,

285 
logdœ
=
Œaš_dœ
,

286 
ma¡”
=master,

287 
is_ch›f
=is_chief,

288 
£ssiÚ_cÚfig
=session_config,

289 
¡¬tup_d–ay_¡•s
=
Œaš_cÚfig
.startup_delay_steps,

290 
š™_â
=init_fn,

291 
summ¬y_İ
=summary_op,

292 
numb”_of_¡•s
=(

293 
Œaš_cÚfig
.
num_¡•s
 Œaš_cÚfig.num_¡• 
NÚe
),

294 
§ve_summ¬›s_£cs
=120,

295 
sync_İtimiz”
=sync_optimizer,

296 
§v”
=saver)

	@trainer_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	ggoogË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


22 
äom
 
objeù_d‘eùiÚ
 
impÜt
 
Œaš”


23 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
los£s


24 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
mod–


25 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
¡ªd¬d_f›lds
 
as
 
f›lds


26 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
Œaš_pb2


29 
	gNUMBER_OF_CLASSES
 = 2

32 
def
 
	$g‘_šput_funùiÚ
():

34 
image
 = 
tf
.
	$¿ndom_unifÜm
([32, 32, 3], 
dty³
=
tf
.
æßt32
)

35 
şass_Ïb–
 = 
tf
.
	$¿ndom_unifÜm
(

36 [1], 
mšv®
=0, 
maxv®
=
NUMBER_OF_CLASSES
, 
dty³
=
tf
.
št32
)

37 
box_Ïb–
 = 
tf
.
	$¿ndom_unifÜm
(

38 [1, 4], 
mšv®
=0.4, 
maxv®
=0.6, 
dty³
=
tf
.
æßt32
)

41 
f›lds
.
IÅutD©aF›lds
.
image
: image,

42 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
şass_Ïb–
,

43 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
box_Ïb–


44 
	}
}

47 
şass
 
	$FakeD‘eùiÚMod–
(
mod–
.
D‘eùiÚMod–
):

50 
def
 
	$__š™__
(
£lf
):

51 
	`su³r
(
FakeD‘eùiÚMod–
, 
£lf
).
	$__š™__
(
num_şas£s
=
NUMBER_OF_CLASSES
)

52 
£lf
.
_şassifiÿtiÚ_loss
 = 
los£s
.
	$Weigh‹dSigmoidCÏssifiÿtiÚLoss
(

53 
ªchÜwi£_ouut
=
True
)

54 
£lf
.
_loÿliz©iÚ_loss
 = 
los£s
.
	$Weigh‹dSmoÙhL1Loÿliz©iÚLoss
(

55 
ªchÜwi£_ouut
=
True
)

57 
def
 
	$´•roûss
(
£lf
, 
šputs
):

60 
Args
:

61 
šputs
: 
a
 [
b©ch
, 
height_š
, 
width_š
, 
chªÃls
] 
æßt32
 
‹nsÜ


62 
»´e£Ášg
 
a
 
b©ch
 
of
 
images
 
w™h
 
v®ues
 
b‘w“n
 0 
ªd
 255.0.

64 
R‘uºs
:

65 
´•roûs£d_šputs
: 
a
 [
b©ch
, 28, 28, 
chªÃls
] 
æßt32
 
‹nsÜ
.

67  
tf
.
image
.
	$»size_images
(
šputs
, [28, 28])

69 
def
 
	$´ediù
(
£lf
, 
´•roûs£d_šputs
):

72 
Args
:

73 
´•roûs£d_šputs
: 
a
 [
b©ch
, 28, 28, 
chªÃls
] 
æßt32
 
‹nsÜ
.

75 
R‘uºs
:

76 
´ediùiÚ_diù
: 
a
 
diùiÚ¬y
 
hŞdšg
 
´ediùiÚ
 
‹nsÜs
 
to
 
be


77 
·s£d
 
to
 
the
 
Loss
 
Ü
 
Po¡´oûss
 
funùiÚs
.

79 
æ©‹Ãd_šputs
 = 
tf
.
cÚŒib
.
Ïy”s
.
	$æ©‹n
(
´•roûs£d_šputs
)

80 
şass_´ediùiÚ
 = 
tf
.
cÚŒib
.
Ïy”s
.
	$fuÎy_cÚÃùed
(

81 
æ©‹Ãd_šputs
, 
£lf
.
_num_şas£s
)

82 
box_´ediùiÚ
 = 
tf
.
cÚŒib
.
Ïy”s
.
	$fuÎy_cÚÃùed
(
æ©‹Ãd_šputs
, 4)

85 'şass_´ediùiÚs_w™h_background': 
tf
.
	`»sh­e
(

86 
şass_´ediùiÚ
, [-1, 1, 
£lf
.
_num_şas£s
]),

87 'box_’codšgs': 
tf
.
	`»sh­e
(
box_´ediùiÚ
, [-1, 1, 4])

88 
	}
}

90 
def
 
	$po¡´oûss
(
£lf
, 
´ediùiÚ_diù
, **
·¿ms
):

93 
Args
:

94 
´ediùiÚ_diù
: 
a
 
diùiÚ¬y
 
hŞdšg
 
´ediùiÚ
 
‹nsÜs
.

95 **
·¿ms
: 
Add™iÚ®
 
keywÜd
 
¬gum’ts
 
¥ecific
 
im¶em’tiÚs
 
of


96 
D‘eùiÚMod–
.

98 
R‘uºs
:

99 
d‘eùiÚs
: 
a
 
diùiÚ¬y
 
w™h
 
em±y
 
f›lds
.

102 'd‘eùiÚ_boxes': 
NÚe
,

103 'd‘eùiÚ_scÜes': 
NÚe
,

104 'd‘eùiÚ_şas£s': 
NÚe
,

105 'num_d‘eùiÚs': 
NÚe


106 
	}
}

108 
def
 
	$loss
(
£lf
, 
´ediùiÚ_diù
):

111 
C®lšg
 
this
 
funùiÚ
 
»quœes
 
th©
 
groundŒuth
 
‹nsÜs
 
have
 
b“n


112 
´ovided
 
vŸ
 
the
 
´ovide_groundŒuth
 
funùiÚ
.

114 
Args
:

115 
´ediùiÚ_diù
: 
a
 
diùiÚ¬y
 
hŞdšg
 
´ediùed
 
‹nsÜs


117 
R‘uºs
:

118 
a
 
diùiÚ¬y
 
m­pšg
 
	$¡ršgs
 (
loss
 
Çmes
è
to
 
sÿÏr
 
‹nsÜs
 
»´e£Ášg


119 
loss
 
v®ues
.

121 
b©ch_»g_rg‘s
 = 
tf
.
	`¡ack
(

122 
£lf
.
	$groundŒuth_li¡s
(
f›lds
.
BoxLi¡F›lds
.
boxes
))

123 
b©ch_şs_rg‘s
 = 
tf
.
	`¡ack
(

124 
£lf
.
	$groundŒuth_li¡s
(
f›lds
.
BoxLi¡F›lds
.
şas£s
))

125 
weights
 = 
tf
.
	`cÚ¡ªt
(

126 1.0, 
dty³
=
tf
.
æßt32
,

127 
sh­e
=[
	`Ën
(
£lf
.
	`groundŒuth_li¡s
(
f›lds
.
BoxLi¡F›lds
.
boxes
)), 1])

129 
loÿtiÚ_los£s
 = 
£lf
.
	`_loÿliz©iÚ_loss
(

130 
´ediùiÚ_diù
['box_’codšgs'], 
b©ch_»g_rg‘s
,

131 
weights
=weights)

132 
şs_los£s
 = 
£lf
.
	`_şassifiÿtiÚ_loss
(

133 
´ediùiÚ_diù
['şass_´ediùiÚs_w™h_background'], 
b©ch_şs_rg‘s
,

134 
weights
=weights)

136 
loss_diù
 = {

137 'loÿliz©iÚ_loss': 
tf
.
	`»duû_sum
(
loÿtiÚ_los£s
),

138 'şassifiÿtiÚ_loss': 
tf
.
	`»duû_sum
(
şs_los£s
),

139 
	}
}

140  
loss_diù


142 
def
 
	$»¡Üe_m­
(
£lf
, 
äom_d‘eùiÚ_checkpošt
=
True
):

145 
Args
:

146 
äom_d‘eùiÚ_checkpošt
: 
wh‘h”
 
to
 
»¡Üe
 
äom
 
a
 
fuÎ
 
d‘eùiÚ


147 
	$checkpošt
 (
w™h
 
com·tibË
 
v¬ŸbË
 
Çmes
è
Ü
 
to
 
»¡Üe
 
äom
 
a


148 
şassifiÿtiÚ
 
checkpošt
 
š™Ÿliz©iÚ
 
´iÜ
 
to
 
Œaššg
.

150 
R‘uºs
:

151 
A
 
diù
 
m­pšg
 
v¬ŸbË
 
Çmes
 
to
 
v¬ŸbËs
.

153  {
v¬
.
İ
.
Çme
: v¬ v¬ 
š
 
tf
.
	`glob®_v¬ŸbËs
()
	}
}

156 
şass
 
	$T¿š”Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

158 
def
 
	$‹¡_cÚfigu»_Œaš”_ªd_Œaš_two_¡•s
(
£lf
):

159 
Œaš_cÚfig_‹xt_´Ùo
 = """

160 
İtimiz”
 {

161 
adam_İtimiz”
 {

162 
Ë¬nšg_¿‹
 {

163 
cÚ¡ªt_Ë¬nšg_¿‹
 {

164 
Ë¬nšg_¿‹
: 0.01

168 
	}
}

169 
d©a_augm’tiÚ_İtiÚs
 {

170 
¿ndom_adju¡_brighŠess
 {

171 
max_d–
: 0.2

174 
d©a_augm’tiÚ_İtiÚs
 {

175 
¿ndom_adju¡_cÚŒa¡
 {

176 
mš_d–
: 0.7

177 
max_d–
: 1.1

180 
num_¡•s
: 2

182 
Œaš_cÚfig
 = 
Œaš_pb2
.
	$T¿šCÚfig
()

183 
‹xt_fÜm©
.
	$M”ge
(
Œaš_cÚfig_‹xt_´Ùo
, 
Œaš_cÚfig
)

185 
Œaš_dœ
 = 
£lf
.
	$g‘_‹mp_dœ
()

187 
Œaš”
.
	`Œaš
(
ü—‹_‹nsÜ_diù_â
=
g‘_šput_funùiÚ
,

188 
ü—‹_mod–_â
=
FakeD‘eùiÚMod–
,

189 
Œaš_cÚfig
=train_config,

190 
ma¡”
='',

191 
sk
=0,

192 
num_şÚes
=1,

193 
wÜk”_»¶iÿs
=1,

194 
şÚe_Ú_ıu
=
True
,

195 
ps_sks
=0,

196 
wÜk”_job_Çme
='worker',

197 
is_ch›f
=
True
,

198 
Œaš_dœ
=train_dir)

201 
__Çme__
 == '__main__':

202 
tf
.
‹¡
.
	`maš
()

	@utils/__init__.py

	@utils/category_util.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
csv


19 
impÜt
 
‹nsÜæow
 
as
 
tf


22 
def
 
	$lßd_ÿ‹gÜ›s_äom_csv_fe
(
csv_·th
):

25 
The
 
CSV
 
fe
 
should
 
have
 
Úe
 
comma
 
d–im™ed
 
num”ic
 
ÿ‹gÜy
 
id
 
ªd
 
¡ršg


26 
ÿ‹gÜy
 
Çme
 
·œ
 
³r
 
lše
. 
FÜ
 
exam¶e
:

33 
Args
:

34 
csv_·th
: 
P©h
 
to
 
the
 
csv
 
fe
Ø
be
 
·r£d
 
što
 
ÿ‹gÜ›s
.

35 
R‘uºs
:

36 
ÿ‹gÜ›s
: 
A
 
li¡
 
of
 
diùiÚ¬›s
 
»´e£Ášg
 
®l
 
possibË
 categories.

37 
The
 
ÿ‹gÜ›s
 
wl
 
cÚš
 
ª
 
š‹g”
 'id' 
f›ld
 
ªd
 
a
 
¡ršg


38 'Çme' 
f›ld
.

39 
Rai£s
:

40 
V®ueE¼Ü
: 
If
 
the
 
csv
 
fe
 
is
 
šcÜ»ùly
 
fÜm©‹d
.

42 
ÿ‹gÜ›s
 = []

44 
w™h
 
tf
.
gfe
.
	`O³n
(
csv_·th
, 'r'è
as
 
csvfe
:

45 
»ad”
 = 
csv
.
	`»ad”
(
csvfe
, 
d–im™”
=',', 
quÙech¬
='"')

46 
row
 
š
 
»ad”
:

47 
nÙ
 
row
:

50 
	`Ën
(
row
) != 2:

51 
¿i£
 
	`V®ueE¼Ü
('Ex³ùed 2 f›ld ³¸row iÀcsv: %s' % ','.
	$još
(
row
))

53 
ÿ‹gÜy_id
 = (
row
[0])

54 
ÿ‹gÜy_Çme
 = 
row
[1]

55 
ÿ‹gÜ›s
.
	`­³nd
({'id': 
ÿ‹gÜy_id
, 'Çme': 
ÿ‹gÜy_Çme
})

57  
ÿ‹gÜ›s


60 
def
 
	$§ve_ÿ‹gÜ›s_to_csv_fe
(
ÿ‹gÜ›s
, 
csv_·th
):

63 
Args
:

64 
ÿ‹gÜ›s
: 
A
 
li¡
 
of
 
diùiÚ¬›s
 
»´e£Ášg
 c©egÜ› 
to
 
§ve
Ø
fe
.

65 
Each
 
ÿ‹gÜy
 
mu¡
 
cÚš
 
ª
 'id' 
ªd
 'Çme' 
f›ld
.

66 
csv_·th
: 
P©h
 
to
 
the
 
csv
 
fe
Ø
be
 
·r£d
 
što
 
ÿ‹gÜ›s
.

68 
ÿ‹gÜ›s
.
	`sÜt
(
key
=
Ïmbda
 
x
: x['id'])

69 
w™h
 
tf
.
gfe
.
	`O³n
(
csv_·th
, 'w'è
as
 
csvfe
:

70 
wr™”
 = 
csv
.
	`wr™”
(
csvfe
, 
d–im™”
=',', 
quÙech¬
='"')

71 
ÿ‹gÜy
 
š
 
ÿ‹gÜ›s
:

72 
wr™”
.
	`wr™”ow
([
ÿ‹gÜy
['id'], category['name']])

	@utils/category_util_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
os


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
ÿ‹gÜy_ut


24 
şass
 
	$Ev®UtTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$‹¡_lßd_ÿ‹gÜ›s_äom_csv_fe
(
£lf
):

27 
csv_d©a
 = """

32 
csv_·th
 = 
os
.
·th
.
	`još
(
£lf
.
	`g‘_‹mp_dœ
(), 'test.csv')

33 
w™h
 
tf
.
gfe
.
	`O³n
(
csv_·th
, 'wb'è
as
 
f
:

34 
f
.
	$wr™e
(
csv_d©a
)

36 
ÿ‹gÜ›s
 = 
ÿ‹gÜy_ut
.
	$lßd_ÿ‹gÜ›s_äom_csv_fe
(
csv_·th
)

37 
£lf
.
	`as£¹True
({'id': 0, 'Çme': 'ÿt'
	}
} 
š
 
ÿ‹gÜ›s
)

38 
£lf
.
as£¹True
({'id': 1, 'Çme': 'dog'} 
š
 
ÿ‹gÜ›s
)

39 
£lf
.
as£¹True
({'id': 2, 'Çme': 'bœd'} 
š
 
ÿ‹gÜ›s
)

41 
def
 
	$‹¡_§ve_ÿ‹gÜ›s_to_csv_fe
(
£lf
):

42 
ÿ‹gÜ›s
 = [

43 {'id': 0, 'Çme': 'ÿt'
	}
},

47 
	gcsv_·th
 = 
os
.
·th
.
još
(
£lf
.
g‘_‹mp_dœ
(), 'test.csv')

48 
	gÿ‹gÜy_ut
.
	$§ve_ÿ‹gÜ›s_to_csv_fe
(
ÿ‹gÜ›s
, 
csv_·th
)

49 
§ved_ÿ‹gÜ›s
 = 
ÿ‹gÜy_ut
.
	$lßd_ÿ‹gÜ›s_äom_csv_fe
(
csv_·th
)

50 
£lf
.
	$as£¹Equ®
(
§ved_ÿ‹gÜ›s
, 
ÿ‹gÜ›s
)

53 
__Çme__
 == '__main__':

54 
tf
.
‹¡
.
	`maš
()

	@utils/dataset_util.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
def
 
	$št64_ã©u»
(
v®ue
):

22  
tf
.
Œaš
.
	`F—tu»
(
št64_li¡
ñf.Œaš.
	$IÁ64Li¡
(
v®ue
=[value]))

25 
def
 
	$št64_li¡_ã©u»
(
v®ue
):

26  
tf
.
Œaš
.
	`F—tu»
(
št64_li¡
ñf.Œaš.
	$IÁ64Li¡
(
v®ue
=value))

29 
def
 
	$by‹s_ã©u»
(
v®ue
):

30  
tf
.
Œaš
.
	`F—tu»
(
by‹s_li¡
ñf.Œaš.
	$By‹sLi¡
(
v®ue
=[value]))

33 
def
 
	$by‹s_li¡_ã©u»
(
v®ue
):

34  
tf
.
Œaš
.
	`F—tu»
(
by‹s_li¡
ñf.Œaš.
	$By‹sLi¡
(
v®ue
=value))

37 
def
 
	$æßt_li¡_ã©u»
(
v®ue
):

38  
tf
.
Œaš
.
	`F—tu»
(
æßt_li¡
ñf.Œaš.
	$FlßtLi¡
(
v®ue
=value))

41 
def
 
	$»ad_exam¶es_li¡
(
·th
):

44 
The
 
fe
 
is
 
assumed
 
to
 
cÚš
 
a
 
sšgË
 
exam¶e
 
³r
 
lše
 
wh”e
 
the
 
fœ¡


45 
tok’
 
š
 
the
 
lše
 
is
 
ª
 
id’tif›r
 
th©
 
®lows
 
us
 
to
 
fšd
h
image
 
ªd


46 
ªnÙ©iÚ
 
xml
 
th©
 
exam¶e
.

48 
FÜ
 
exam¶e
, 
the
 
lše
:

49 
xyz
 3

50 
would
 
®low
 
us
 
to
 
fšd
 
fes
 
xyz
.
jpg
 
ªd
 xyz.
	`xml
 (
the
 3 would 
be
 
ignÜed
).

52 
Args
:

53 
·th
: 
absŞu‹
…©h 
to
 
exam¶es
 
li¡
 
fe
.

55 
R‘uºs
:

56 
li¡
 
of
 
exam¶e
 
	`id’tif›rs
 (
¡ršgs
).

58 
w™h
 
tf
.
gfe
.
	$GFe
(
·th
è
as
 
fid
:

59 
lšes
 = 
fid
.
	$»adlšes
()

60  [
lše
.
	`¡r
().
	`¥l™
(' ')[0] lš
š
 
lšes
]

63 
def
 
	$»cursive_·r£_xml_to_diù
(
xml
):

66 
We
 
assume
 
th©
 `
objeù
` 
gs
 
¬e
 
the
 
Úly
 
Úes
h© 
ÿn
 
­³¬


67 
muÉË
 
times
 
©
 
the
 
§me
 
Ëv–
 
of
 
a
 
Œ“
.

69 
Args
:

70 
xml
: xmÈ
Œ“
 
obšed
 
by
 
·rsšg
 
XML
 
fe
 
cÚ‹Ás
 
usšg
 
lxml
.
‘»e


72 
R‘uºs
:

73 
PythÚ
 
diùiÚ¬y
 
hŞdšg
 
XML
 
cÚ‹Ás
.

75 
nÙ
 
xml
:

76  {
xml
.
g
: xml.
‹xt
}

77 
»suÉ
 = {}

78 
chd
 
š
 
xml
:

79 
chd_»suÉ
 = 
	$»cursive_·r£_xml_to_diù
(
chd
)

80 
chd
.
g
 != 'object':

81 
»suÉ
[
chd
.
g
] = 
chd_»suÉ
[child.tag]

83 
chd
.
g
 
nÙ
 
š
 
»suÉ
:

84 
»suÉ
[
chd
.
g
] = []

85 
»suÉ
[
chd
.
g
].
	$­³nd
(
chd_»suÉ
[
chd
.
g
])

86  {
xml
.
g
: 
»suÉ
}

	@utils/dataset_util_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
os


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
d©a£t_ut


24 
şass
 
	$D©a£tUtTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$‹¡_»ad_exam¶es_li¡
(
£lf
):

27 
exam¶e_li¡_d©a
 = """example1 1\nexample2 2"""

28 
exam¶e_li¡_·th
 = 
os
.
·th
.
	`još
(
£lf
.
	`g‘_‹mp_dœ
(), 'examples.txt')

29 
w™h
 
tf
.
gfe
.
	`O³n
(
exam¶e_li¡_·th
, 'wb'è
as
 
f
:

30 
f
.
	$wr™e
(
exam¶e_li¡_d©a
)

32 
exam¶es
 = 
d©a£t_ut
.
	$»ad_exam¶es_li¡
(
exam¶e_li¡_·th
)

33 
£lf
.
	`as£¹Li¡Equ®
(['exam¶e1', 'exam¶e2'], 
exam¶es
)

36 
__Çme__
 == '__main__':

37 
tf
.
‹¡
.
	`maš
()

	@utils/label_map_util.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
loggšg


20 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	ggoogË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


22 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
¡ršg_št_Ïb–_m­_pb2


25 
def
 
	$_v®id©e_Ïb–_m­
(
Ïb–_m­
):

28 
Args
:

29 
Ïb–_m­
: 
SŒšgIÁLab–M­
 
to
 
v®id©e
.

31 
Rai£s
:

32 
V®ueE¼Ü
: 
Ïb–
 
m­
 
is
 
šv®id
.

34 
™em
 
š
 
Ïb–_m­
.item:

35 
™em
.
id
 < 1:

36 
¿i£
 
	`V®ueE¼Ü
('Label map ids should be >= 1.')

39 
def
 
	$ü—‹_ÿ‹gÜy_šdex
(
ÿ‹gÜ›s
):

42 
Args
:

43 
ÿ‹gÜ›s
: 
a
 
li¡
 
of
 
diùs
, 
—ch
 oà
which
 
has
 
the
 
fŞlowšg
 
keys
:

44 'id': (
»quœed
è
ª
 
š‹g”
 
id
 
uniqu–y
 
id’tifyšg
 
this
 
ÿ‹gÜy
.

45 'Çme': (
»quœed
è
¡ršg
 
»´e£Ášg
 
ÿ‹gÜy
 
Çme


46 
e
.
g
., 'cat', 'dog', 'pizza'.

48 
R‘uºs
:

49 
ÿ‹gÜy_šdex
: 
a
 
diù
 
cÚššg
 
the
 
§me
 
’Œ›s
 
as
 
ÿ‹gÜ›s
, 
but
 
keyed


50 
by
 
the
 'id' 
f›ld
 
of
 
—ch
 
ÿ‹gÜy
.

52 
ÿ‹gÜy_šdex
 = {
	}
}

53 
ÿt
 
š
 
ÿ‹gÜ›s
:

54 
ÿ‹gÜy_šdex
[
ÿt
['id']] = cat

55  
ÿ‹gÜy_šdex


58 
def
 
	$cÚv”t_Ïb–_m­_to_ÿ‹gÜ›s
(
Ïb–_m­
,

59 
max_num_şas£s
,

60 
u£_di¥Ïy_Çme
=
True
):

63 
This
 
funùiÚ
 
lßds
 
a
 
Ïb–
 
m­
 
ªd
 
»tuºs
‡ 
li¡
 
of
 
diùs
, 
—ch
 oà
which


64 
has
 
the
 
fŞlowšg
 
keys
:

65 'id': (
»quœed
è
ª
 
š‹g”
 
id
 
uniqu–y
 
id’tifyšg
 
this
 
ÿ‹gÜy
.

66 'Çme': (
»quœed
è
¡ršg
 
»´e£Ášg
 
ÿ‹gÜy
 
Çme


67 
e
.
g
., 'cat', 'dog', 'pizza'.

68 
We
 
Úly
 
®low
 
şass
 
što
 
the
 
li¡
 
™s
 
id
-
Ïb–_id_off£t
 
is


69 
b‘w“n
 0 (
šşusive
è
ªd
 
	`max_num_şas£s
 (
exşusive
).

70 
If
 
th”e
 
¬e
 
£v”®
 
™ems
 
m­pšg
 
to
 
the
 
§me
 
id
 
š
h
Ïb–
 
m­
,

71 
we
 
wl
 
Úly
 
k“p
 
the
 
fœ¡
 
Úe
 
š
h
ÿ‹gÜ›s
 
li¡
.

73 
Args
:

74 
Ïb–_m­
: 
a
 
SŒšgIÁLab–M­PrÙo
 
Ü
 
NÚe
. 
If
 NÚe,‡  
ÿ‹gÜ›s


75 
li¡
 
is
 
ü—‹d
 
w™h
 
max_num_şas£s
 
ÿ‹gÜ›s
.

76 
max_num_şas£s
: 
maximum
 
numb”
 
	$of
 (
cÚ£cutive
è
Ïb–
 
šdiûs
 
to
 
šşude
.

77 
u£_di¥Ïy_Çme
: (
boŞ—n
è
choo£
 
wh‘h”
 
to
 
lßd
 'di¥Ïy_Çme' 
f›ld


78 
as
 
ÿ‹gÜy
 
Çme
. 
If
 
F®£
 
Ü
 
the
 
di¥Ïy_Çme
 
f›ld
 
dÛs
 
nÙ
 
exi¡
,

79 
u£s
 'Çme' 
f›ld
 
as
 
ÿ‹gÜy
 
Çmes
 
š¡—d
.

80 
R‘uºs
:

81 
ÿ‹gÜ›s
: 
a
 
li¡
 
of
 
diùiÚ¬›s
 
»´e£Ášg
 
®l
 
possibË
 categories.

83 
ÿ‹gÜ›s
 = []

84 
li¡_of_ids_®»ady_added
 = []

85 
nÙ
 
Ïb–_m­
:

86 
Ïb–_id_off£t
 = 1

87 
şass_id
 
š
 
	$¿nge
(
max_num_şas£s
):

88 
ÿ‹gÜ›s
.
	`­³nd
({

89 'id': 
şass_id
 + 
Ïb–_id_off£t
,

90 'Çme': 'ÿ‹gÜy_{}'.
	`fÜm©
(
şass_id
 + 
Ïb–_id_off£t
)

91 
	}
})

92  
ÿ‹gÜ›s


93 
™em
 
š
 
Ïb–_m­
.item:

94 
nÙ
 0 < 
™em
.
id
 <ğ
max_num_şas£s
:

95 
loggšg
.
šfo
('Ignore item %d since it falls outside of„equested '

96 'Ïb–„ªge.', 
™em
.
id
)

98 
u£_di¥Ïy_Çme
 
ªd
 
	g™em
.
HasF›ld
('display_name'):

99 
Çme
 = 
™em
.
di¥Ïy_Çme


101 
Çme
 = 
™em
.name

102 
™em
.
id
 
nÙ
 
š
 
li¡_of_ids_®»ady_added
:

103 
li¡_of_ids_®»ady_added
.
	$­³nd
(
™em
.
id
)

104 
ÿ‹gÜ›s
.
	`­³nd
({'id': 
™em
.
id
, 'Çme': 
Çme
})

105  
ÿ‹gÜ›s


108 
def
 
	$lßd_Ïb–m­
(
·th
):

111 
Args
:

112 
·th
:…©h 
to
 
SŒšgIÁLab–M­
 
´Ùo
 
‹xt
 
fe
.

113 
R‘uºs
:

114 
a
 
SŒšgIÁLab–M­PrÙo


116 
w™h
 
tf
.
gfe
.
	`GFe
(
·th
, 'r'è
as
 
fid
:

117 
Ïb–_m­_¡ršg
 = 
fid
.
	$»ad
()

118 
Ïb–_m­
 = 
¡ršg_št_Ïb–_m­_pb2
.
	$SŒšgIÁLab–M­
()

119 
Œy
:

120 
‹xt_fÜm©
.
	$M”ge
(
Ïb–_m­_¡ršg
, 
Ïb–_m­
)

121 
exû±
 
‹xt_fÜm©
.
P¬£E¼Ü
:

122 
Ïb–_m­
.
	$P¬£FromSŒšg
(
Ïb–_m­_¡ršg
)

123 
	$_v®id©e_Ïb–_m­
(
Ïb–_m­
)

124  
Ïb–_m­


127 
def
 
	$g‘_Ïb–_m­_diù
(
Ïb–_m­_·th
):

130 
Args
:

131 
Ïb–_m­_·th
: 
·th
 
to
 
Ïb–_m­
.

133 
R‘uºs
:

134 
A
 
diùiÚ¬y
 
m­pšg
 
Ïb–
 
Çmes
 
to
 
id
.

136 
Ïb–_m­
 = 
	$lßd_Ïb–m­
(
Ïb–_m­_·th
)

137 
Ïb–_m­_diù
 = {
	}
}

138 
™em
 
š
 
Ïb–_m­
.item:

139 
Ïb–_m­_diù
[
™em
.
Çme
] = i‹m.
id


140  
Ïb–_m­_diù


	@utils/label_map_util_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
os


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	ggoogË
.
´Ùobuf
 
impÜt
 
‹xt_fÜm©


22 
äom
 
	gobjeù_d‘eùiÚ
.
´Ùos
 
impÜt
 
¡ršg_št_Ïb–_m­_pb2


23 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
Ïb–_m­_ut


26 
şass
 
	$Lab–M­UtTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

28 
def
 
	$_g’”©e_Ïb–_m­
(
£lf
, 
num_şas£s
):

29 
Ïb–_m­_´Ùo
 = 
¡ršg_št_Ïb–_m­_pb2
.
	$SŒšgIÁLab–M­
()

30 
i
 
š
 
	`¿nge
(1, 
num_şas£s
 + 1):

31 
™em
 = 
Ïb–_m­_´Ùo
.™em.
	$add
()

32 
™em
.
id
 = 
i


33 
™em
.
Çme
 = 'Ïb–_' + 
	$¡r
(
i
)

34 
™em
.
di¥Ïy_Çme
 = 
	$¡r
(
i
)

35  
Ïb–_m­_´Ùo


37 
def
 
	$‹¡_g‘_Ïb–_m­_diù
(
£lf
):

38 
Ïb–_m­_¡ršg
 = """

39 
™em
 {

40 
id
:2

41 
Çme
:'cat'

42 
	}
}

43 
™em
 {

44 
id
:1

45 
Çme
:'dog'

48 
Ïb–_m­_·th
 = 
os
.
·th
.
još
(
£lf
.
g‘_‹mp_dœ
(), 'label_map.pbtxt')

49 
w™h
 
	gtf
.
	ggfe
.
O³n
(
Ïb–_m­_·th
, 'wb'è
as
 
	gf
:

50 
f
.
	$wr™e
(
Ïb–_m­_¡ršg
)

52 
Ïb–_m­_diù
 = 
Ïb–_m­_ut
.
	$g‘_Ïb–_m­_diù
(
Ïb–_m­_·th
)

53 
£lf
.
	`as£¹Equ®
(
Ïb–_m­_diù
['dog'], 1)

54 
£lf
.
	`as£¹Equ®
(
Ïb–_m­_diù
['cat'], 2)

56 
def
 
	$‹¡_lßd_bad_Ïb–_m­
(
£lf
):

57 
Ïb–_m­_¡ršg
 = """

58 
™em
 {

59 
id
:0

60 
Çme
:'classhat should‚ot be indexed‡t zero'

61 
	}
}

62 
™em
 {

63 
id
:2

64 
Çme
:'cat'

66 
™em
 {

67 
id
:1

68 
Çme
:'dog'

71 
Ïb–_m­_·th
 = 
os
.
·th
.
još
(
£lf
.
g‘_‹mp_dœ
(), 'label_map.pbtxt')

72 
w™h
 
	gtf
.
	ggfe
.
O³n
(
Ïb–_m­_·th
, 'wb'è
as
 
	gf
:

73 
f
.
	$wr™e
(
Ïb–_m­_¡ršg
)

75 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

76 
Ïb–_m­_ut
.
	$lßd_Ïb–m­
(
Ïb–_m­_·th
)

78 
def
 
	$‹¡_k“p_ÿ‹gÜ›s_w™h_unique_id
(
£lf
):

79 
Ïb–_m­_´Ùo
 = 
¡ršg_št_Ïb–_m­_pb2
.
	$SŒšgIÁLab–M­
()

80 
Ïb–_m­_¡ršg
 = """

81 
™em
 {

82 
id
:2

83 
Çme
:'cat'

84 
	}
}

85 
™em
 {

86 
id
:1

87 
Çme
:'child'

89 
™em
 {

90 
id
:1

91 
Çme
:'person'

93 
™em
 {

94 
id
:1

95 
Çme
:'n00007846'

98 
‹xt_fÜm©
.
	$M”ge
(
Ïb–_m­_¡ršg
, 
Ïb–_m­_´Ùo
)

99 
ÿ‹gÜ›s
 = 
Ïb–_m­_ut
.
	$cÚv”t_Ïb–_m­_to_ÿ‹gÜ›s
(

100 
Ïb–_m­_´Ùo
, 
max_num_şas£s
=3)

101 
£lf
.
	`as£¹Li¡Equ®
([{

103 'Çme': 
u
'cat'

104 
	}
}, {

106 'Çme': 
u
'child'

107 }], 
	gÿ‹gÜ›s
)

109 
def
 
	$‹¡_cÚv”t_Ïb–_m­_to_ÿ‹gÜ›s_no_Ïb–_m­
(
£lf
):

110 
ÿ‹gÜ›s
 = 
Ïb–_m­_ut
.
	$cÚv”t_Ïb–_m­_to_ÿ‹gÜ›s
(

111 
NÚe
, 
max_num_şas£s
=3)

112 
ex³ùed_ÿ‹gÜ›s_li¡
 = [{

113 'Çme': 
u
'category_1',

115 
	}
}, {

116 'Çme': 
u
'category_2',

119 'Çme': 
u
'category_3',

122 
£lf
.
	$as£¹Li¡Equ®
(
ex³ùed_ÿ‹gÜ›s_li¡
, 
ÿ‹gÜ›s
)

124 
def
 
	$‹¡_cÚv”t_Ïb–_m­_to_coco_ÿ‹gÜ›s
(
£lf
):

125 
Ïb–_m­_´Ùo
 = 
£lf
.
	$_g’”©e_Ïb–_m­
(
num_şas£s
=4)

126 
ÿ‹gÜ›s
 = 
Ïb–_m­_ut
.
	$cÚv”t_Ïb–_m­_to_ÿ‹gÜ›s
(

127 
Ïb–_m­_´Ùo
, 
max_num_şas£s
=3)

128 
ex³ùed_ÿ‹gÜ›s_li¡
 = [{

129 'Çme': 
u
'1',

131 
	}
}, {

132 'Çme': 
u
'2',

135 'Çme': 
u
'3',

138 
£lf
.
	$as£¹Li¡Equ®
(
ex³ùed_ÿ‹gÜ›s_li¡
, 
ÿ‹gÜ›s
)

140 
def
 
	$‹¡_cÚv”t_Ïb–_m­_to_coco_ÿ‹gÜ›s_w™h_ãw_şas£s
(
£lf
):

141 
Ïb–_m­_´Ùo
 = 
£lf
.
	$_g’”©e_Ïb–_m­
(
num_şas£s
=4)

142 
ÿt_no_off£t
 = 
Ïb–_m­_ut
.
	$cÚv”t_Ïb–_m­_to_ÿ‹gÜ›s
(

143 
Ïb–_m­_´Ùo
, 
max_num_şas£s
=2)

144 
ex³ùed_ÿ‹gÜ›s_li¡
 = [{

145 'Çme': 
u
'1',

147 
	}
}, {

148 'Çme': 
u
'2',

151 
£lf
.
	$as£¹Li¡Equ®
(
ex³ùed_ÿ‹gÜ›s_li¡
, 
ÿt_no_off£t
)

153 
def
 
	$‹¡_ü—‹_ÿ‹gÜy_šdex
(
£lf
):

154 
ÿ‹gÜ›s
 = [{'Çme': 
u
'1', 'id': 1
	}
}, {'name': u'2', 'id': 2}]

155 
ÿ‹gÜy_šdex
 = 
Ïb–_m­_ut
.
	$ü—‹_ÿ‹gÜy_šdex
(
ÿ‹gÜ›s
)

156 
£lf
.
	`as£¹DiùEqu®
({

158 'Çme': 
u
'1',

162 'Çme': 
u
'2',

165 
	}
}, 
	gÿ‹gÜy_šdex
)

168 
	g__Çme__
 == '__main__':

169 
tf
.
‹¡
.
maš
()

	@utils/learning_schedules.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
def
 
	$expÚ’tŸl_deÿy_w™h_buºš
(
glob®_¡•
,

22 
Ë¬nšg_¿‹_ba£
,

23 
Ë¬nšg_¿‹_deÿy_¡•s
,

24 
Ë¬nšg_¿‹_deÿy_çùÜ
,

25 
buºš_Ë¬nšg_¿‹
=0.0,

26 
buºš_¡•s
=0):

29 
In
 
this
 
scheduË
, 
Ë¬nšg
 
¿‹
 
is
 
fixed
 
©
 
buºš_Ë¬nšg_¿‹


30 
a
 
fixed
 
³riod
, 
befÜe
 
Œªs™iÚšg
 
to
‡ 
»guÏr
 
expÚ’tŸl


31 
deÿy
 
scheduË
.

33 
Args
:

34 
glob®_¡•
: 
‹nsÜ
 
»´e£Ášg
 
glob®
 
¡•
.

35 
Ë¬nšg_¿‹_ba£
: 
ba£
 
Ë¬nšg
 
¿‹
.

36 
Ë¬nšg_¿‹_deÿy_¡•s
: 
¡•s
 
to
 
ke
 
b‘w“n
 
deÿyšg
 
the
 
Ë¬nšg
 
¿‹
.

37 
NÙe
 
th©
 
this
 
šşudes
 
the
 
numb”
 
of
 
buº
-
š
 
¡•s
.

38 
Ë¬nšg_¿‹_deÿy_çùÜ
: 
muÉliÿtive
 
çùÜ
 
by
 
which
 
to
 
deÿy


39 
Ë¬nšg
 
¿‹
.

40 
buºš_Ë¬nšg_¿‹
: 
š™Ÿl
 
Ë¬nšg
 
¿‹
 
duršg
 
buº
-
š
 
³riod
. 
If


41 0.0 (
which
 
is
 
the
 ), 
th’
h
buº
-
š
 
Ë¬nšg
 
¿‹
 i 
sim¶y


42 
£t
 
to
 
Ë¬nšg_¿‹_ba£
.

43 
buºš_¡•s
: 
numb”
 
of
 
¡•s
 
to
 
u£
 
buºš
 
Ë¬nšg
 
¿‹
.

45 
R‘uºs
:

46 
	$a
 (
sÿÏr
è
‹nsÜ
 
»´e£Ášg
 
Ë¬nšg
 
¿‹


48 
buºš_Ë¬nšg_¿‹
 == 0:

49 
buºš_Ë¬nšg_¿‹
 = 
Ë¬nšg_¿‹_ba£


50 
po¡_buºš_Ë¬nšg_¿‹
 = 
tf
.
Œaš
.
	$expÚ’tŸl_deÿy
(

51 
Ë¬nšg_¿‹_ba£
,

52 
glob®_¡•
,

53 
Ë¬nšg_¿‹_deÿy_¡•s
,

54 
Ë¬nšg_¿‹_deÿy_çùÜ
,

55 
¡aœÿ£
=
True
)

56  
tf
.
	`cÚd
(

57 
tf
.
	`Ëss
(
glob®_¡•
, 
buºš_¡•s
),

58 
Ïmbda
: 
tf
.
	`cÚv”t_to_‹nsÜ
(
buºš_Ë¬nšg_¿‹
),

59 
Ïmbda
: 
po¡_buºš_Ë¬nšg_¿‹
)

62 
def
 
	$mªu®_¡•pšg
(
glob®_¡•
, 
bound¬›s
, 
¿‹s
):

65 
This
 
funùiÚ
 
´ovides
 
fše
 
g¿šed
 
cÚŒŞ
 
ov”
 
Ë¬nšg
 
¿‹s
. 
OÃ
 
mu¡


66 
¥ecify
 
a
 
£qu’û
 
of
 
Ë¬nšg
 
¿‹s
 
as
 
w–l
‡ ¨
£t
 oà
š‹g”
 
¡•s


67 
©
 
which
 
the
 
cu¼’t
 
Ë¬nšg
 
¿‹
 
mu¡
 
Œªs™iÚ
 
to
h
Ãxt
. 
FÜ
 
exam¶e
,

68 
bound¬›s
 = [5, 10] 
ªd
 
¿‹s
 = [.1, .01, .001], 
th’
 
the
 
Ë¬nšg


69 
¿‹
 
»tuºed
 
by
 
this
 
funùiÚ
 
is
 .1 
glob®_¡•
=0,...,4, .01 

70 
glob®_¡•
=5...9, 
ªd
 .001 glob®_¡•=10‡nd 
Úw¬d
.

72 
Args
:

73 
glob®_¡•
: 
	$št64
 (
sÿÏr
è
‹nsÜ
 
»´e£Ášg
 
glob®
 
¡•
.

74 
bound¬›s
: 
a
 
li¡
 
of
 
glob®
 
¡•s
 
©
 
which
 
to
 
Ë¬nšg


75 
¿‹s
. 
This
 
li¡
 
is
 
assumed
 
to
 
cÚsi¡
 
of
 
šü—sšg
 
pos™ive
 
š‹g”s
.

76 
¿‹s
: 
a
 
li¡
 
	$of
 (è
Ë¬nšg
 
¿‹s
 
cÜ»¥Údšg
 
to
 
š‹rv®s
 
b‘w“n


77 
the
 
bound¬›s
. 
The
 
Ëngth
 
of
 
this
 
li¡
 
mu¡
 
be
 
exaùly


78 
	`Ën
(
bound¬›s
) + 1.

80 
R‘uºs
:

81 
	$a
 (
sÿÏr
è
‹nsÜ
 
»´e£Ášg
 
Ë¬nšg
 
¿‹


82 
Rai£s
:

83 
V®ueE¼Ü
: 
Úe
 
of
 
the
 
fŞlowšg
 
checks
 
çs
:

84 1. 
bound¬›s
 
is
 
a
 
¡riùly
 
šü—sšg
 
li¡
 
of
 
pos™ive
 
š‹g”s


85 2. 
	`Ën
(
¿‹s
è=ğËn(
bound¬›s
) + 1

87 
	`ªy
([
b
 < 0 b 
š
 
bound¬›s
]è
Ü
‡ny(

88 [
nÙ
 
	$isš¡ªû
(
b
, èb 
š
 
bound¬›s
]):

89 
¿i£
 
	`V®ueE¼Ü
('boundaries must be‡†ist of…ositive integers')

90 
	`ªy
([
bÃxt
 <ğ
b
 bÃxt, b 
š
 
	`z
(
bound¬›s
[1:], boundaries[:-1])]):

91 
¿i£
 
	`V®ueE¼Ü
('Entries in boundaries must be strictly increasing.')

92 
	`ªy
([
nÙ
 
	$isš¡ªû
(
r
, è¸
š
 
¿‹s
]):

93 
¿i£
 
	`V®ueE¼Ü
('Learning„ates must be floats')

94 
	`Ën
(
¿‹s
è!ğËn(
bound¬›s
) + 1:

95 
¿i£
 
	`V®ueE¼Ü
('Number of…rovided†earning„ates mustƒxceed '

97 
¡•_bound¬›s
 = 
tf
.
	$cÚ¡ªt
(
bound¬›s
, 
tf
.
št64
)

98 
Ë¬nšg_¿‹s
 = 
tf
.
	$cÚ¡ªt
(
¿‹s
, 
tf
.
æßt32
)

99 
uÄ—ched_bound¬›s
 = 
tf
.
	`»sh­e
Ñf.
	`wh”e
(

100 
tf
.
	`g»©”
(
¡•_bound¬›s
, 
glob®_¡•
)), [-1])

101 
uÄ—ched_bound¬›s
 = 
tf
.
	`cÚÿt
([uÄ—ched_bound¬›s, [
	`Ën
(
bound¬›s
)]], 0)

102 
šdex
 = 
tf
.
	`»sh­e
Ñf.
	`»duû_mš
(
uÄ—ched_bound¬›s
), [1])

103  
tf
.
	`»sh­e
Ñf.
	`¦iû
(
Ë¬nšg_¿‹s
, 
šdex
, [1]), [])

	@utils/learning_schedules_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
‹nsÜæow
 
as
 
tf


19 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
Ë¬nšg_scheduËs


22 
şass
 
	$L—ºšgScheduËsTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

24 
def
 
	$‹¡ExpÚ’tŸlDeÿyW™hBuºš
(
£lf
):

25 
glob®_¡•
 = 
tf
.
	$¶aûhŞd”
(
tf
.
št32
, [])

26 
Ë¬nšg_¿‹_ba£
 = 1.0

27 
Ë¬nšg_¿‹_deÿy_¡•s
 = 3

28 
Ë¬nšg_¿‹_deÿy_çùÜ
 = .1

29 
buºš_Ë¬nšg_¿‹
 = .5

30 
buºš_¡•s
 = 2

31 
exp_¿‹s
 = [.5, .5, 1, .1, .1, .1, .01, .01]

32 
Ë¬nšg_¿‹
 = 
Ë¬nšg_scheduËs
.
	$expÚ’tŸl_deÿy_w™h_buºš
(

33 
glob®_¡•
, 
Ë¬nšg_¿‹_ba£
, 
Ë¬nšg_¿‹_deÿy_¡•s
,

34 
Ë¬nšg_¿‹_deÿy_çùÜ
, 
buºš_Ë¬nšg_¿‹
, 
buºš_¡•s
)

35 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

36 
ouut_¿‹s
 = []

37 
šput_glob®_¡•
 
š
 
	$¿nge
(8):

38 
ouut_¿‹
 = 
£ss
.
	`run
(
Ë¬nšg_¿‹
,

39 
ãed_diù
={
glob®_¡•
: 
šput_glob®_¡•
})

40 
ouut_¿‹s
.
	$­³nd
(
ouut_¿‹
)

41 
£lf
.
	$as£¹AÎClo£
(
ouut_¿‹s
, 
exp_¿‹s
)

43 
def
 
	$‹¡Mªu®S‹µšg
(
£lf
):

44 
glob®_¡•
 = 
tf
.
	$¶aûhŞd”
(
tf
.
št64
, [])

45 
bound¬›s
 = [2, 3, 7]

46 
¿‹s
 = [1.0, 2.0, 3.0, 4.0]

47 
exp_¿‹s
 = [1.0, 1.0, 2.0, 3.0, 3.0, 3.0, 3.0, 4.0, 4.0, 4.0]

48 
Ë¬nšg_¿‹
 = 
Ë¬nšg_scheduËs
.
	$mªu®_¡•pšg
(
glob®_¡•
, 
bound¬›s
,

49 
¿‹s
)

50 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

51 
ouut_¿‹s
 = []

52 
šput_glob®_¡•
 
š
 
	$¿nge
(10):

53 
ouut_¿‹
 = 
£ss
.
	`run
(
Ë¬nšg_¿‹
,

54 
ãed_diù
={
glob®_¡•
: 
šput_glob®_¡•
})

55 
ouut_¿‹s
.
	$­³nd
(
ouut_¿‹
)

56 
£lf
.
	$as£¹AÎClo£
(
ouut_¿‹s
, 
exp_¿‹s
)

58 
__Çme__
 == '__main__':

59 
tf
.
‹¡
.
	`maš
()

	@utils/metrics.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
äom
 
__futu»__
 
impÜt
 
divisiÚ


19 
impÜt
 
numpy
 
as
 
Å


20 
äom
 
six
 
impÜt
 
moves


23 
def
 
	$compu‹_´ecisiÚ_»ÿÎ
(
scÜes
, 
Ïb–s
, 
num_gt
):

26 
Args
:

27 
scÜes
: 
A
 
numpy
 
¬¿y
 
»´e£Ášg
 
d‘eùiÚ
 
scÜe


28 
Ïb–s
: 
A
 
boŞ—n
 
numpy
 
¬¿y
 
»´e£Ášg
 
Œue
/
çl£
 
pos™ive
†abels

29 
num_gt
: 
Numb”
 
of
 
ground
 
Œuth
 
š¡ªûs


31 
Rai£s
:

32 
V®ueE¼Ü
: 
the
 
šput
 
is
 
nÙ
 
of
h
cÜ»ù
 
fÜm©


34 
R‘uºs
:

35 
´ecisiÚ
: 
F¿ùiÚ
 
of
 
pos™ive
 
š¡ªûs
 
ov”
 
d‘eùed
 
Úes
. 
This
 
v®ue
 
is


36 
NÚe
 
no
 
ground
 
Œuth
 
Ïb–s
 
¬e
 
´e£Á
.

37 
»ÿÎ
: 
F¿ùiÚ
 
of
 
d‘eùed
 
pos™ive
 
š¡ªû
 
ov”
 
®l
…os™iv
š¡ªûs
.

38 
This
 
v®ue
 
is
 
NÚe
 
no
 
ground
 
Œuth
 
Ïb–s
 
¬e
 
´e£Á
.

41 
nÙ
 
	$isš¡ªû
(

42 
Ïb–s
, 
Å
.
nd¬¿y
è
Ü
†ab–s.
dty³
 !ğÅ.
boŞ
 o¸
	`Ën
Öab–s.
sh­e
) != 1:

43 
¿i£
 
	`V®ueE¼Ü
("labels must be single dimension bool‚umpy‡rray")

45 
nÙ
 
	$isš¡ªû
(

46 
scÜes
, 
Å
.
nd¬¿y
è
Ü
 
	`Ën
(scÜes.
sh­e
) != 1:

47 
¿i£
 
	`V®ueE¼Ü
("scores must be single dimension‚umpy‡rray")

49 
num_gt
 < 
Å
.
	$sum
(
Ïb–s
):

50 
¿i£
 
	`V®ueE¼Ü
("Number ofrue…ositives must be smallerhan‚um_gt.")

52 
	`Ën
(
scÜes
è!ğ
	$Ën
(
Ïb–s
):

53 
¿i£
 
	`V®ueE¼Ü
("scores‡nd†abels must be ofhe same size.")

55 
num_gt
 == 0:

56  
NÚe
, None

58 
sÜ‹d_šdiûs
 = 
Å
.
	$¬gsÜt
(
scÜes
)

59 
sÜ‹d_šdiûs
 = sorted_indices[::-1]

60 
Ïb–s
 =†ab–s.
	$a¡y³
()

61 
Œue_pos™ive_Ïb–s
 = 
Ïb–s
[
sÜ‹d_šdiûs
]

62 
çl£_pos™ive_Ïb–s
 = 1 - 
Œue_pos™ive_Ïb–s


63 
cum_Œue_pos™ives
 = 
Å
.
	$cumsum
(
Œue_pos™ive_Ïb–s
)

64 
cum_çl£_pos™ives
 = 
Å
.
	$cumsum
(
çl£_pos™ive_Ïb–s
)

65 
´ecisiÚ
 = 
cum_Œue_pos™ives
.
	`a¡y³
() / (

66 
cum_Œue_pos™ives
 + 
cum_çl£_pos™ives
)

67 
»ÿÎ
 = 
cum_Œue_pos™ives
.
	`a¡y³
(è/ 
num_gt


68  
´ecisiÚ
, 
»ÿÎ


71 
def
 
	$compu‹_av”age_´ecisiÚ
(
´ecisiÚ
, 
»ÿÎ
):

74 
P»cisiÚ
 
is
 
modif›d
 
to
 
’su»
 
th©
 
™
 
dÛs
 
nÙ
 
deü—£
 
as
 
»ÿÎ


75 
deü—£
.

77 
Args
:

78 
´ecisiÚ
: 
A
 [
N
, 1] 
numpy
 
¬¿y
 
of
 
´ecisiÚs


79 
»ÿÎ
: 
A
 [
N
, 1] 
numpy
 
¬¿y
 
of
 
»ÿÎs


81 
Rai£s
:

82 
V®ueE¼Ü
: 
the
 
šput
 
is
 
nÙ
 
of
h
cÜ»ù
 
fÜm©


84 
R‘uºs
:

85 
av”age_´ecisÚ
: 
The
 
¬—
 
und”
 
the
 
´ecisiÚ
 
»ÿÎ
 
curve
. 
NaN
 

86 
´ecisiÚ
 
ªd
 
»ÿÎ
 
¬e
 
NÚe
.

89 
´ecisiÚ
 
is
 
NÚe
:

90 
»ÿÎ
 
is
 
nÙ
 
NÚe
:

91 
¿i£
 
	`V®ueE¼Ü
("If…recision is None,„ecall must‡lso be None")

92  
Å
.
NAN


94 
nÙ
 
	$isš¡ªû
(
´ecisiÚ
, 
Å
.
nd¬¿y
è
Ü
 
nÙ
 
	$isš¡ªû
(
»ÿÎ
,

95 
Å
.
nd¬¿y
):

96 
¿i£
 
	`V®ueE¼Ü
("precision‡nd„ecall must be‚umpy‡rray")

97 
´ecisiÚ
.
dty³
 !ğ
Å
.
Ü
 
»ÿÎ
.dtype !=‚p.:

98 
¿i£
 
	`V®ueE¼Ü
("input must be float‚umpy‡rray.")

99 
	`Ën
(
´ecisiÚ
è!ğ
	$Ën
(
»ÿÎ
):

100 
¿i£
 
	`V®ueE¼Ü
("precision‡nd„ecall must be ofhe same size.")

101 
nÙ
 
´ecisiÚ
.
size
:

103 
Å
.
	`amš
(
´ecisiÚ
è< 0 
Ü
‚p.
	`amax
(precision) > 1:

104 
¿i£
 
	`V®ueE¼Ü
("Precision must be inhe„ange of [0, 1].")

105 
Å
.
	`amš
(
»ÿÎ
è< 0 
Ü
‚p.
	`amax
(recall) > 1:

106 
¿i£
 
	`V®ueE¼Ü
("recall must be inhe„ange of [0, 1].")

107 
nÙ
 
	`®l
(
»ÿÎ
[
i
] <ğ»ÿÎ[˜+ 1] ˜
š
 
moves
.
	`¿nge
(
	`Ën
(recall) - 1)):

108 
¿i£
 
	`V®ueE¼Ü
("recall must be‡‚on-decreasing‡rray")

110 
»ÿÎ
 = 
Å
.
	$cÚÿ‹Ç‹
([[0], 
»ÿÎ
, [1]])

111 
´ecisiÚ
 = 
Å
.
	$cÚÿ‹Ç‹
([[0], 
´ecisiÚ
, [0]])

113 #P»´oûs 
´ecisiÚ
 
to
 
be
 
a
 
nÚ
-
deü—sšg
 
¬¿y


114 
i
 
š
 
	`¿nge
(
	`Ën
(
´ecisiÚ
) - 2, -1, -1):

115 
´ecisiÚ
[
i
] = 
Å
.
	`maximum
(precision[i],…recision[i + 1])

117 
šdiûs
 = 
Å
.
	`wh”e
(
»ÿÎ
[1:] !=„ecall[:-1])[0] + 1

118 
av”age_´ecisiÚ
 = 
Å
.
	`sum
(

119 (
»ÿÎ
[
šdiûs
] -„eÿÎ[šdiû - 1]è* 
´ecisiÚ
[indices])

120  
av”age_´ecisiÚ


123 
def
 
	$compu‹_cÜ_loc
(
num_gt_imgs_³r_şass
,

124 
num_images_cÜ»ùly_d‘eùed_³r_şass
):

127 
h‰ps
:

129 
R‘uºs
 
Çns
 
th”e
 
¬e
 
no
 
ground
 
Œuth
 
images
 
a
 
şass
.

131 
Args
:

132 
num_gt_imgs_³r_şass
: 1D 
¬¿y
, 
»´e£Ášg
 
numb”
 
of
 
images
 
cÚššg


133 
©
 
Ëa¡
 
Úe
 
objeù
 
š¡ªû
 
of
 
a
 
·¹icuÏr
 
şass


134 
num_images_cÜ»ùly_d‘eùed_³r_şass
: 1D 
¬¿y
, 
»´e£Ášg
 
numb”
 
of


135 
images
 
th©
 
¬e
 
cÜ»ùly
 
d‘eùed
 
©
 
Ëa¡
 
Úe
 
objeù
 
š¡ªû
 
of
 
a


136 
·¹icuÏr
 
şass


138 
R‘uºs
:

139 
cÜloc_³r_şass
: 
A
 
numpy
 
¬¿y
 
»´e£Ás
 
the
 
cÜloc
 
scÜe
 
of
 
—ch


140 
şass


142  
Å
.
	`wh”e
(

143 
num_gt_imgs_³r_şass
 == 0,

144 
Å
.
Çn
,

145 
num_images_cÜ»ùly_d‘eùed_³r_şass
 / 
num_gt_imgs_³r_şass
)

	@utils/metrics_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
numpy
 
as
 
Å


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
m‘rics


24 
şass
 
	$M‘ricsTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$‹¡_compu‹_cÜ_loc
(
£lf
):

27 
num_gt_imgs_³r_şass
 = 
Å
.
	$¬¿y
([100, 1, 5, 1, 1], 
dty³
=)

28 
num_images_cÜ»ùly_d‘eùed_³r_şass
 = 
Å
.
	$¬¿y
([10, 0, 1, 0, 0],

29 
dty³
=)

30 
cÜloc
 = 
m‘rics
.
	$compu‹_cÜ_loc
(
num_gt_imgs_³r_şass
,

31 
num_images_cÜ»ùly_d‘eùed_³r_şass
)

32 
ex³ùed_cÜloc
 = 
Å
.
	$¬¿y
([0.1, 0, 0.2, 0, 0], 
dty³
=)

33 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
cÜloc
, 
ex³ùed_cÜloc
))

35 
def
 
	$‹¡_compu‹_cÜ_loc_Çns
(
£lf
):

36 
num_gt_imgs_³r_şass
 = 
Å
.
	$¬¿y
([100, 0, 0, 1, 1], 
dty³
=)

37 
num_images_cÜ»ùly_d‘eùed_³r_şass
 = 
Å
.
	$¬¿y
([10, 0, 1, 0, 0],

38 
dty³
=)

39 
cÜloc
 = 
m‘rics
.
	$compu‹_cÜ_loc
(
num_gt_imgs_³r_şass
,

40 
num_images_cÜ»ùly_d‘eùed_³r_şass
)

41 
ex³ùed_cÜloc
 = 
Å
.
	$¬¿y
([0.1, 
Å
.
Çn
,‚p.Çn, 0, 0], 
dty³
=)

42 
£lf
.
	$as£¹AÎClo£
(
cÜloc
, 
ex³ùed_cÜloc
)

44 
def
 
	$‹¡_compu‹_´ecisiÚ_»ÿÎ
(
£lf
):

45 
num_gt
 = 10

46 
scÜes
 = 
Å
.
	$¬¿y
([0.4, 0.3, 0.6, 0.2, 0.7, 0.1], 
dty³
=)

47 
Ïb–s
 = 
Å
.
	$¬¿y
([0, 1, 1, 0, 0, 1], 
dty³
=
boŞ
)

48 
accumuÏ‹d__couÁ
 = 
Å
.
	$¬¿y
([0, 1, 1, 2, 2, 3], 
dty³
=)

49 
ex³ùed_´ecisiÚ
 = 
accumuÏ‹d__couÁ
 / 
Å
.
	$¬¿y
([1, 2, 3, 4, 5, 6])

50 
ex³ùed_»ÿÎ
 = 
accumuÏ‹d__couÁ
 / 
num_gt


51 
´ecisiÚ
, 
»ÿÎ
 = 
m‘rics
.
	$compu‹_´ecisiÚ_»ÿÎ
(
scÜes
, 
Ïb–s
, 
num_gt
)

52 
£lf
.
	$as£¹AÎClo£
(
´ecisiÚ
, 
ex³ùed_´ecisiÚ
)

53 
£lf
.
	$as£¹AÎClo£
(
»ÿÎ
, 
ex³ùed_»ÿÎ
)

55 
def
 
	$‹¡_compu‹_av”age_´ecisiÚ
(
£lf
):

56 
´ecisiÚ
 = 
Å
.
	$¬¿y
([0.8, 0.76, 0.9, 0.65, 0.7, 0.5, 0.55, 0], 
dty³
=)

57 
»ÿÎ
 = 
Å
.
	$¬¿y
([0.3, 0.3, 0.4, 0.4, 0.45, 0.45, 0.5, 0.5], 
dty³
=)

58 
´oûs£d_´ecisiÚ
 = 
Å
.
	$¬¿y
([0.9, 0.9, 0.9, 0.7, 0.7, 0.55, 0.55, 0],

59 
dty³
=)

60 
»ÿÎ_š‹rv®
 = 
Å
.
	$¬¿y
([0.3, 0, 0.1, 0, 0.05, 0, 0.05, 0], 
dty³
=)

61 
ex³ùed_m—n_­
 = 
Å
.
	$sum
(
»ÿÎ_š‹rv®
 * 
´oûs£d_´ecisiÚ
)

62 
m—n_­
 = 
m‘rics
.
	$compu‹_av”age_´ecisiÚ
(
´ecisiÚ
, 
»ÿÎ
)

63 
£lf
.
	$as£¹Almo¡Equ®
(
ex³ùed_m—n_­
, 
m—n_­
)

65 
def
 
	$‹¡_compu‹_´ecisiÚ_»ÿÎ_ªd_­_no_groundŒuth
(
£lf
):

66 
num_gt
 = 0

67 
scÜes
 = 
Å
.
	$¬¿y
([0.4, 0.3, 0.6, 0.2, 0.7, 0.1], 
dty³
=)

68 
Ïb–s
 = 
Å
.
	$¬¿y
([0, 0, 0, 0, 0, 0], 
dty³
=
boŞ
)

69 
ex³ùed_´ecisiÚ
 = 
NÚe


70 
ex³ùed_»ÿÎ
 = 
NÚe


71 
´ecisiÚ
, 
»ÿÎ
 = 
m‘rics
.
	$compu‹_´ecisiÚ_»ÿÎ
(
scÜes
, 
Ïb–s
, 
num_gt
)

72 
£lf
.
	$as£¹Equ®s
(
´ecisiÚ
, 
ex³ùed_´ecisiÚ
)

73 
£lf
.
	$as£¹Equ®s
(
»ÿÎ
, 
ex³ùed_»ÿÎ
)

74 
­
 = 
m‘rics
.
	$compu‹_av”age_´ecisiÚ
(
´ecisiÚ
, 
»ÿÎ
)

75 
£lf
.
	`as£¹True
(
Å
.
	$i¢ª
(
­
))

78 
__Çme__
 == '__main__':

79 
tf
.
‹¡
.
	`maš
()

	@utils/np_box_list.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
numpy
 
as
 
Å


19 
äom
 
six
 
impÜt
 
moves


22 
şass
 
	$BoxLi¡
(
objeù
):

25 
BoxLi¡
 
»´e£Ás
 
a
 
li¡
 
of
 
boundšg
 
boxes
 
as
 
numpy
 
¬¿y
, 
wh”e
 
—ch


26 
boundšg
 
box
 
is
 
»´e£Áed
 
as
 
a
 
row
 
of
 4 
numb”s
,

27 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
]. 
It
 
is
 
assumed
 
th©
 
®l
 
boundšg
 
boxes
 
w™hš
 
a


28 
giv’
 
li¡
 
cÜ»¥Úd
 
to
 
a
 
sšgË
 
image
.

30 
O±iÚ®ly
, 
u£rs
 
ÿn
 
add
 
add™iÚ®
 
»Ï‹d
 
	`f›lds
 (
such
 
as


31 
objeùÃss
/
şassifiÿtiÚ
 
scÜes
).

34 
def
 
	$__š™__
(
£lf
, 
d©a
):

37 
Args
:

38 
d©a
: 
a
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 4] 
»´e£Ášg
 
box
 
coÜdš©es


40 
Rai£s
:

41 
V®ueE¼Ü
: 
bbox
 
d©a
 
is
 
nÙ
 
a
 
numpy
 
¬¿y


42 
V®ueE¼Ü
: 
šv®id
 
dim’siÚs
 
bbox
 
d©a


44 
nÙ
 
	$isš¡ªû
(
d©a
, 
Å
.
nd¬¿y
):

45 
¿i£
 
	`V®ueE¼Ü
('data must be‡‚umpy‡rray.')

46 
	`Ën
(
d©a
.
sh­e
è!ğ2 
Ü
 data.shape[1] != 4:

47 
¿i£
 
	`V®ueE¼Ü
('Invalid dimensions for box data.')

48 
d©a
.
dty³
 !ğ
Å
.
æßt32
 
ªd
 d©a.dty³ !ğÅ.
æßt64
:

49 
¿i£
 
	`V®ueE¼Ü
('Invalid dataype for box data: float is„equired.')

50 
nÙ
 
£lf
.
	$_is_v®id_boxes
(
d©a
):

51 
¿i£
 
	`V®ueE¼Ü
('Invalid box data. data must be‡‚umpy‡rray of '

53 
£lf
.
d©a
 = {'boxes': 
	}
data}

55 
def
 
	$num_boxes
(
£lf
):

57  
£lf
.
d©a
['boxes'].
sh­e
[0]

59 
def
 
	$g‘_exŒa_f›lds
(
£lf
):

61  [
k
 k 
š
 
£lf
.
d©a
.
	$keys
(è
k
 != 'boxes']

63 
def
 
	$has_f›ld
(
£lf
, 
f›ld
):

64  
f›ld
 
š
 
£lf
.
d©a


66 
def
 
	$add_f›ld
(
£lf
, 
f›ld
, 
f›ld_d©a
):

69 
Args
:

70 
f›ld
: 
a
 
¡ršg
 
·¿m‘”
 
u£d
 
to
 
¥eficy
‡ 
»Ï‹d
 f›ldØ
be
 
acûs£d
.

71 
f›ld_d©a
: 
a
 
numpy
 
¬¿y
 
of
 [
N
, ...] 
»´e£Ášg
 
the
 
d©a
 
assocŸ‹d


72 
w™h
 
the
 
f›ld
.

73 
Rai£s
:

74 
V®ueE¼Ü
: 
the
 
f›ld
 
is
 
®»ady
 
exi¡
 
Ü
h
dim’siÚ
 
of
he field

75 
d©a
 
dÛs
 
nÙ
 
m©ches
 
the
 
numb”
 
of
 
boxes
.

77 
£lf
.
	$has_f›ld
(
f›ld
):

78 
¿i£
 
	`V®ueE¼Ü
('F›ld ' + 
f›ld
 + 'alreadyƒxists')

79 
	`Ën
(
f›ld_d©a
.
sh­e
è< 1 
Ü
 f›ld_d©a.sh­e[0] !ğ
£lf
.
	$num_boxes
():

80 
¿i£
 
	`V®ueE¼Ü
('Invalid dimensions for field data')

81 
£lf
.
d©a
[
f›ld
] = 
f›ld_d©a


83 
def
 
	$g‘
(
£lf
):

86 
R‘uºs
:

87 
a
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 4] 
»´e£Ášg
 
box
 
cÜÃrs


89  
£lf
.
	`g‘_f›ld
('boxes')

91 
def
 
	$g‘_f›ld
(
£lf
, 
f›ld
):

94 
Args
:

95 
f›ld
: 
a
 
¡ršg
 
·¿m‘”
 
u£d
 
to
 
¥eficy
‡ 
»Ï‹d
 f›ldØ
be
 
acûs£d
.

97 
R‘uºs
:

98 
a
 
numpy
 1-
d
 
¬¿y
 
»´e£Ášg
 
d©a
 
of
 
ª
 
assocŸ‹d
 
f›ld


100 
Rai£s
:

101 
V®ueE¼Ü
: 
šv®id
 
f›ld


103 
nÙ
 
£lf
.
	$has_f›ld
(
f›ld
):

104 
¿i£
 
	`V®ueE¼Ü
('f›ld {} dÛ nÙƒxi¡'.
	$fÜm©
(
f›ld
))

105  
£lf
.
d©a
[
f›ld
]

107 
def
 
	$g‘_coÜdš©es
(
£lf
):

110 
R‘uºs
:

111 
a
 
li¡
 
of
 4 1-
d
 
numpy
 
¬¿ys
 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
]

113 
box_coÜdš©es
 = 
£lf
.
	$g‘
()

114 
y_mš
 = 
box_coÜdš©es
[:, 0]

115 
x_mš
 = 
box_coÜdš©es
[:, 1]

116 
y_max
 = 
box_coÜdš©es
[:, 2]

117 
x_max
 = 
box_coÜdš©es
[:, 3]

118  [
y_mš
, 
x_mš
, 
y_max
, 
x_max
]

120 
def
 
	$_is_v®id_boxes
(
£lf
, 
d©a
):

123 
Args
:

124 
d©a
: 
a
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 4] 
»´e£Ášg
 
box
 
coÜdš©es


126 
R‘uºs
:

127 
a
 
boŞ—n
 
šdiÿtšg
 
wh‘h”
 
®l
 
ymax
 
of
 
boxes
 
¬e
 
equ®
 
Ü
 
g»©”
 
thª


128 
ymš
, 
ªd
 
®l
 
xmax
 
of
 
boxes
 
¬e
 
equ®
 
Ü
 
g»©”
 
thª
 
xmš
.

130 
d©a
.
sh­e
[0] > 0:

131 
i
 
š
 
moves
.
	$¿nge
(
d©a
.
sh­e
[0]):

132 
d©a
[
i
, 0] > d©a[i, 2] 
Ü
 data[i, 1] > data[i, 3]:

133  
F®£


134  
True


	@utils/np_box_list_ops.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
Exam¶e
 
box
 
İ”©iÚs
 
th©
 
¬e
 
	gsuµÜ‹d
:

19 * 
A»as
: 
compu‹
 
boundšg
 
box
 
¬—s


20 * 
IOU
: 
·œwi£
 
š‹r£ùiÚ
-
ov”
-
scÜes


23 
impÜt
 
numpy
 
as
 
Å


25 
äom
 
objeù_d‘eùiÚ
.
uts
 
impÜt
 
Å_box_li¡


26 
äom
 
objeù_d‘eùiÚ
.
uts
 
impÜt
 
Å_box_İs


29 
şass
 
	$SÜtOrd”
(
objeù
):

32 
A‰ribu‹s
:

33 
asûnd
:‡sûnd 
Üd”
.

34 
desûnd
: desûnd 
Üd”
.

36 
ASCEND
 = 1

37 
DESCEND
 = 2

40 
def
 
	$¬—
(
boxli¡
):

43 
Args
:

44 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


46 
R‘uºs
:

47 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
N
*1] 
»´e£Ášg
 
box
 
¬—s


49 
y_mš
, 
x_mš
, 
y_max
, 
x_max
 = 
boxli¡
.
	$g‘_coÜdš©es
()

50  (
y_max
 - 
y_mš
è* (
x_max
 - 
x_mš
)

53 
def
 
	$š‹r£ùiÚ
(
boxli¡1
, 
boxli¡2
):

56 
Args
:

57 
boxli¡1
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


58 
boxli¡2
: 
BoxLi¡
 
hŞdšg
 
M
 
boxes


60 
R‘uºs
:

61 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
N
*
M
] 
»´e£Ášg
 
·œwi£
 
š‹r£ùiÚ
 
¬—


63  
Å_box_İs
.
	`š‹r£ùiÚ
(
boxli¡1
.
	`g‘
(), 
boxli¡2
.
	$g‘
())

66 
def
 
	$iou
(
boxli¡1
, 
boxli¡2
):

69 
Args
:

70 
boxli¡1
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


71 
boxli¡2
: 
BoxLi¡
 
hŞdšg
 
M
 
boxes


73 
R‘uºs
:

74 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
N
, 
M
] 
»´e£Ášg
 
·œwi£
 
iou
 
scÜes
.

76  
Å_box_İs
.
	`iou
(
boxli¡1
.
	`g‘
(), 
boxli¡2
.
	$g‘
())

79 
def
 
	$iß
(
boxli¡1
, 
boxli¡2
):

82 
IÁ”£ùiÚ
-
ov”
-
	$¬—
 (
iß
è
b‘w“n
 
two
 
boxes
 
box1
 
ªd
 
box2
 
is
 
defšed
 
as


83 
theœ
 
š‹r£ùiÚ
 
¬—
 
ov”
 
box2
's‡rea. Notehat ioa is‚ot symmetric,

84 
th©
 
is
, 
	`IOA
(
box1
, 
box2
) != IOA(box2, box1).

86 
Args
:

87 
boxli¡1
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


88 
boxli¡2
: 
BoxLi¡
 
hŞdšg
 
M
 
boxes


90 
R‘uºs
:

91 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
N
, 
M
] 
»´e£Ášg
 
·œwi£
 
iß
 
scÜes
.

93  
Å_box_İs
.
	`iß
(
boxli¡1
.
	`g‘
(), 
boxli¡2
.
	$g‘
())

96 
def
 
	$g©h”
(
boxli¡
, 
šdiûs
, 
f›lds
=
NÚe
):

99 
By
 , 
G©h”
 
»tuºs
 
boxes
 
cÜ»¥Údšg
 
to
 
the
 
šput
 
šdex
 
li¡
, 
as


100 
w–l
 
as
 
®l
 
add™iÚ®
 
f›lds
 
¡Üed
 
š
 
the
 
	`boxli¡
 (
šdexšg
 
što
he

101 
fœ¡
 
dim’siÚ
). 
Howev”
 
Úe
 
ÿn
 
İtiÚ®ly
 
Úly
 
g©h”
 
äom
 
a


102 
sub£t
 
of
 
f›lds
.

104 
Args
:

105 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


106 
šdiûs
: 
a
 1-
d
 
numpy
 
¬¿y
 
of
 
ty³
 
št_


107 
f›lds
: (
İtiÚ®
è
li¡
 
of
 f›ld 
to
 
®so
 
g©h”
 
äom
. 
If
 
	`NÚe
 (),

108 
®l
 
f›lds
 
¬e
 
g©h”ed
 
äom
. 
Pass
 
ª
 
em±y
 f›ld 
li¡
 
to
 
Úly
 
g©h”


109 
the
 
box
 
coÜdš©es
.

111 
R‘uºs
:

112 
subboxli¡
: 
a
 
BoxLi¡
 
cÜ»¥Údšg
 
to
 
the
 
sub£t
 
of
h
šput
 BoxList

113 
¥ecif›d
 
by
 
šdiûs


115 
Rai£s
:

116 
V®ueE¼Ü
: 
¥ecif›d
 
f›ld
 
is
 
nÙ
 
cÚšed
 
š
 
boxli¡
 
Ü
 
the


117 
šdiûs
 
¬e
 
nÙ
 
of
 
ty³
 
št_


119 
šdiûs
.
size
:

120 
Å
.
	`amax
(
šdiûs
è>ğ
boxli¡
.
	$num_boxes
(è
Ü
 
Å
.
	`amš
(
šdiûs
) < 0:

121 
¿i£
 
	`V®ueE¼Ü
('indices‡re out of valid„ange.')

122 
subboxli¡
 = 
Å_box_li¡
.
	`BoxLi¡
(
boxli¡
.
	`g‘
()[
šdiûs
, :])

123 
f›lds
 
is
 
NÚe
:

124 
f›lds
 = 
boxli¡
.
	$g‘_exŒa_f›lds
()

125 
f›ld
 
š
 
f›lds
:

126 
exŒa_f›ld_d©a
 = 
boxli¡
.
	$g‘_f›ld
(
f›ld
)

127 
subboxli¡
.
	$add_f›ld
(
f›ld
, 
exŒa_f›ld_d©a
[
šdiûs
, ...])

128  
subboxli¡


131 
def
 
	$sÜt_by_f›ld
(
boxli¡
, 
f›ld
, 
Üd”
=
SÜtOrd”
.
DESCEND
):

134 
A
 
commÚ
 
u£
 
is
 
»Üd”šg
 
the
 
boxes
 
accÜdšg
 
to
 
desûndšg
 
scÜes
.

136 
Args
:

137 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes
.

138 
f›ld
: 
A
 
BoxLi¡
 f›ld 
sÜtšg
 
ªd
 
»Üd”šg
 
the
 BoxList.

139 
Üd”
: (
O±iÚ®
è'desûnd' 
Ü
 'asûnd'. 
DeçuÉ
 
is
 
desûnd
.

141 
R‘uºs
:

142 
sÜ‹d_boxli¡
: 
A
 
sÜ‹d
 
BoxLi¡
 
w™h
 
the
 
f›ld
 
š
h
¥ecif›d
 
Üd”
.

144 
Rai£s
:

145 
V®ueE¼Ü
: 
¥ecif›d
 
f›ld
 
dÛs
 
nÙ
 
exi¡
 
Ü
 
is
‚Ù 
of
 
sšgË
 
dim’siÚ
.

146 
V®ueE¼Ü
: 
the
 
Üd”
 
is
 
nÙ
 
e™h”
 
desûnd
 
Ü
 
asûnd
.

148 
nÙ
 
boxli¡
.
	$has_f›ld
(
f›ld
):

149 
¿i£
 
	`V®ueE¼Ü
('F›ld ' + 
f›ld
 + ' does‚otƒxist')

150 
	`Ën
(
boxli¡
.
	`g‘_f›ld
(
f›ld
).
sh­e
) != 1:

151 
¿i£
 
	`V®ueE¼Ü
('F›ld ' + 
f›ld
 + 'should be single dimension.')

152 
Üd”
 !ğ
SÜtOrd”
.
DESCEND
 
ªd
 ord” !ğSÜtOrd”.
ASCEND
:

153 
¿i£
 
	`V®ueE¼Ü
('Invalid sort order')

155 
f›ld_to_sÜt
 = 
boxli¡
.
	$g‘_f›ld
(
f›ld
)

156 
sÜ‹d_šdiûs
 = 
Å
.
	$¬gsÜt
(
f›ld_to_sÜt
)

157 
Üd”
 =ğ
SÜtOrd”
.
DESCEND
:

158 
sÜ‹d_šdiûs
 = sorted_indices[::-1]

159  
	$g©h”
(
boxli¡
, 
sÜ‹d_šdiûs
)

162 
def
 
	`nÚ_max_suµ»ssiÚ
(
boxli¡
,

163 
max_ouut_size
=10000,

164 
iou_th»shŞd
=1.0,

165 
scÜe_th»shŞd
=-10.0):

168 
This
 
İ
 
g»edy
 
£Ëùs
 
a
 
sub£t
 
of
 
d‘eùiÚ
 
boundšg
 
boxes
, 
´unšg


169 
away
 
boxes
 
th©
 
have
 
high
 
	$IOU
 (
š‹r£ùiÚ
 
ov”
 è
	`ov”Ïp
 (> 
th»sh
)

170 
w™h
 
®»ady
 
£Ëùed
 
boxes
. 
In
 
—ch
 
™”©iÚ
, 
the
 
d‘eùed
 
boundšg
 
box
 with

171 
highe¡
 
scÜe
 
š
 
the
 
avaabË
 
poŞ
 
is
 
£Ëùed
.

173 
Args
:

174 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes
. 
Mu¡
 
cÚš
 
a
 'scÜes' 
f›ld


175 
»´e£Ášg
 
d‘eùiÚ
 
scÜes
. 
AÎ
 scÜe 
b–Úg
 
to
 
the
 
§me
 
şass
.

176 
max_ouut_size
: 
maximum
 
numb”
 
of
 
»šed
 
boxes


177 
iou_th»shŞd
: 
š‹r£ùiÚ
 
ov”
 
th»shŞd
.

178 
scÜe_th»shŞd
: 
mšimum
 
scÜe
 
th»shŞd
. 
Remove
 
the
 
boxes
 
w™h
 
scÜes


179 
Ëss
 
thª
 
this
 
v®ue
. 
DeçuÉ
 v®u
is
 
£t
 
to
 -10. 
A
 
v”y


180 
low
 
th»shŞd
 
to
 
·ss
 
´‘ty
 
much
 
®l
 
the
 
boxes
, 
uÆess


181 
the
 
u£r
 
£ts
 
a
 
difã»Á
 
scÜe
 
th»shŞd
.

183 
R‘uºs
:

184 
a
 
BoxLi¡
 
hŞdšg
 
M
 
boxes
 
wh”e
 M <ğ
max_ouut_size


185 
Rai£s
:

186 
V®ueE¼Ü
: 'scÜes' 
f›ld
 
dÛs
 
nÙ
 
exi¡


187 
V®ueE¼Ü
: 
th»shŞd
 
is
 
nÙ
 
š
 [0, 1]

188 
V®ueE¼Ü
: 
max_ouut_size
 < 0

190 
nÙ
 
boxli¡
.
	`has_f›ld
('scores'):

191 
¿i£
 
	`V®ueE¼Ü
('Field scores does‚otƒxist')

192 
iou_th»shŞd
 < 0. 
Ü
 iou_threshold > 1.0:

193 
¿i£
 
	`V®ueE¼Ü
('IOUhreshold must be in [0, 1]')

194 
max_ouut_size
 < 0:

195 
¿i£
 
	`V®ueE¼Ü
('max_output_size must be biggerhan 0.')

197 
boxli¡
 = 
	$f‹r_scÜes_g»©”_thª
(
boxli¡
, 
scÜe_th»shŞd
)

198 
boxli¡
.
	`num_boxes
() == 0:

199  
boxli¡


201 
boxli¡
 = 
	`sÜt_by_f›ld
(boxlist, 'scores')

203 #P»v’ˆ
fu¹h”
 
computiÚ
 
NMS
 
is
 
di§bËd
.

204 
iou_th»shŞd
 == 1.0:

205 
boxli¡
.
	`num_boxes
(è> 
max_ouut_size
:

206 
£Ëùed_šdiûs
 = 
Å
.
	$¬ªge
(
max_ouut_size
)

207  
	$g©h”
(
boxli¡
, 
£Ëùed_šdiûs
)

209  
boxli¡


211 
boxes
 = 
boxli¡
.
	$g‘
()

212 
num_boxes
 = 
boxli¡
.
	$num_boxes
()

213 #is_šdex_v®id 
is
 
True
 
Úly
 
®l
 
»maššg
 
v®id
 
boxes
,

214 
is_šdex_v®id
 = 
Å
.
	$fuÎ
(
num_boxes
, 1, 
dty³
=
boŞ
)

215 
£Ëùed_šdiûs
 = []

216 
num_ouut
 = 0

217 
i
 
š
 
	$x¿nge
(
num_boxes
):

218 
num_ouut
 < 
max_ouut_size
:

219 
is_šdex_v®id
[
i
]:

220 
num_ouut
 += 1

221 
£Ëùed_šdiûs
.
	$­³nd
(
i
)

222 
is_šdex_v®id
[
i
] = 
F®£


223 
v®id_šdiûs
 = 
Å
.
	`wh”e
(
is_šdex_v®id
)[0]

224 
v®id_šdiûs
.
size
 == 0:

227 
š‹r£ù_ov”_uniÚ
 = 
Å_box_İs
.
	`iou
(

228 
Å
.
	`ex·nd_dims
(
boxes
[
i
, :], 
axis
=0), boxes[
v®id_šdiûs
, :])

229 
š‹r£ù_ov”_uniÚ
 = 
Å
.
	$squ“ze
(
š‹r£ù_ov”_uniÚ
, 
axis
=0)

230 
is_šdex_v®id
[
v®id_šdiûs
] = 
Å
.
	`logiÿl_ªd
(

231 
is_šdex_v®id
[
v®id_šdiûs
],

232 
š‹r£ù_ov”_uniÚ
 <ğ
iou_th»shŞd
)

233  
	`g©h”
(
boxli¡
, 
Å
.
	$¬¿y
(
£Ëùed_šdiûs
))

236 
def
 
	$muÉi_şass_nÚ_max_suµ»ssiÚ
(
boxli¡
, 
scÜe_th»sh
, 
iou_th»sh
,

237 
max_ouut_size
):

240 
This
 
İ
 
g»edy
 
£Ëùs
 
a
 
sub£t
 
of
 
d‘eùiÚ
 
boundšg
 
boxes
, 
´unšg


241 
away
 
boxes
 
th©
 
have
 
high
 
	$IOU
 (
š‹r£ùiÚ
 
ov”
 è
	`ov”Ïp
 (> 
th»sh
)

242 
w™h
 
®»ady
 
£Ëùed
 
boxes
. 
It
 
İ”©es
 
šd•’d’y
 
—ch
 
şass
 

243 
which
 
scÜes
 
¬e
 
	`´ovided
 (
vŸ
 
the
 scÜe 
f›ld
 
of
h
šput
 
box_li¡
),

244 
´unšg
 
boxes
 
w™h
 
scÜe
 
Ëss
 
thª
 
a
 
´ovided
 
th»shŞd
 
´iÜ
 
to


245 
­¶yšg
 
NMS
.

247 
Args
:

248 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes
. 
Mu¡
 
cÚš
 
a
 'scÜes' 
f›ld


249 
»´e£Ášg
 
d‘eùiÚ
 
scÜes
. 
This
 scÜe 
f›ld
 
is
 
a
 
‹nsÜ
 
th©
 
ÿn


250 
be
 1 
	$dim’siÚ®
 (
š
 
the
 
of
 
a
 
sšgË
 
şass
è
Ü
 2-
dim’siÚ®
, 
which


251 
which
 
we
 
assume
 
th©
 
™
 
kes
 
the
 
sh­e
 [
num_boxes
, 
num_şas£s
].

252 
We
 
fu¹h”
 
assume
 
th©
 
this
 
¿nk
 
is
 
known
 
¡©iÿÎy
 
ªd
hat

253 
scÜes
.
sh­e
[1] 
is
 
®so
 
	`known
 (
i
.
e
., 
the
 
numb”
 
of
 
şas£s
 i 
fixed


254 
ªd
 
known
 
©
 
g¿ph
 
cÚ¡ruùiÚ
 
time
).

255 
scÜe_th»sh
: 
sÿÏr
 
th»shŞd
 
	`scÜe
 (
low
 
scÜšg
 
boxes
 
¬e
 
»moved
).

256 
iou_th»sh
: 
sÿÏr
 
th»shŞd
 
	`IOU
 (
boxes
 
th©
h© 
high
 
IOU
 
ov”Ïp


257 
w™h
 
´eviou¦y
 
£Ëùed
 
boxes
 
¬e
 
»moved
).

258 
max_ouut_size
: 
maximum
 
numb”
 
of
 
»šed
 
boxes
 
³r
 
şass
.

260 
R‘uºs
:

261 
a
 
BoxLi¡
 
hŞdšg
 
M
 
boxes
 
w™h
‡ 
¿nk
-1 
scÜes
 
f›ld
 
»´e£Ášg


262 
cÜ»¥Údšg
 
scÜes
 
—ch
 
box
 
w™h
 scÜe 
sÜ‹d
 
š
 
deü—sšg
 
Üd”


263 
ªd
 
a
 
¿nk
-1 
şas£s
 
f›ld
 
»´e£Ášg
‡ 
şass
 
Ïb–
 
—ch
 
box
.

264 
Rai£s
:

265 
V®ueE¼Ü
: 
iou_th»sh
 
is
 
nÙ
 
š
 [0, 1] 
Ü
 
šput
 
boxli¡
 
dÛs
‚Ù 
have


266 
a
 
v®id
 
scÜes
 
f›ld
.

268 
nÙ
 0 <ğ
iou_th»sh
 <= 1.0:

269 
¿i£
 
	`V®ueE¼Ü
('thresh must be between 0‡nd 1')

270 
nÙ
 
	$isš¡ªû
(
boxli¡
, 
Å_box_li¡
.
BoxLi¡
):

271 
¿i£
 
	`V®ueE¼Ü
('boxlist must be‡ BoxList')

272 
nÙ
 
boxli¡
.
	`has_f›ld
('scores'):

273 
¿i£
 
	`V®ueE¼Ü
('input boxlist must have \'scores\' field')

274 
scÜes
 = 
boxli¡
.
	`g‘_f›ld
('scores')

275 
	`Ën
(
scÜes
.
sh­e
) == 1:

276 
scÜes
 = 
Å
.
	`»sh­e
(scores, [-1, 1])

277 
–if
 
	`Ën
(
scÜes
.
sh­e
) == 2:

278 
scÜes
.
sh­e
[1] 
is
 
NÚe
:

279 
¿i£
 
	`V®ueE¼Ü
('scores field must have statically defined second '

282 
¿i£
 
	`V®ueE¼Ü
('scores field must be of„ank 1 or 2')

283 
num_boxes
 = 
boxli¡
.
	$num_boxes
()

284 
num_scÜes
 = 
scÜes
.
sh­e
[0]

285 
num_şas£s
 = 
scÜes
.
sh­e
[1]

287 
num_boxes
 !ğ
num_scÜes
:

288 
¿i£
 
	`V®ueE¼Ü
('Incorrect scores field†ength:‡ctual vsƒxpected.')

290 
£Ëùed_boxes_li¡
 = []

291 
şass_idx
 
š
 
	$¿nge
(
num_şas£s
):

292 
boxli¡_ªd_şass_scÜes
 = 
Å_box_li¡
.
	`BoxLi¡
(
boxli¡
.
	$g‘
())

293 
şass_scÜes
 = 
Å
.
	`»sh­e
(
scÜes
[0:
num_scÜes
, 
şass_idx
], [-1])

294 
boxli¡_ªd_şass_scÜes
.
	`add_f›ld
('scÜes', 
şass_scÜes
)

295 
boxli¡_ft
 = 
	$f‹r_scÜes_g»©”_thª
(
boxli¡_ªd_şass_scÜes
,

296 
scÜe_th»sh
)

297 
nms_»suÉ
 = 
	$nÚ_max_suµ»ssiÚ
(
boxli¡_ft
,

298 
max_ouut_size
=max_output_size,

299 
iou_th»shŞd
=
iou_th»sh
,

300 
scÜe_th»shŞd
=
scÜe_th»sh
)

301 
nms_»suÉ
.
	`add_f›ld
(

302 'şas£s', 
Å
.
	`z”os_like
(
nms_»suÉ
.
	`g‘_f›ld
('scÜes')è+ 
şass_idx
)

303 
£Ëùed_boxes_li¡
.
	$­³nd
(
nms_»suÉ
)

304 
£Ëùed_boxes
 = 
	$cÚÿ‹Ç‹
(
£Ëùed_boxes_li¡
)

305 
sÜ‹d_boxes
 = 
	`sÜt_by_f›ld
(
£Ëùed_boxes
, 'scores')

306  
sÜ‹d_boxes


309 
def
 
	$sÿË
(
boxli¡
, 
y_sÿË
, 
x_sÿË
):

312 
Args
:

313 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


314 
y_sÿË
: 

315 
x_sÿË
: 

317 
R‘uºs
:

318 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes


320 
y_mš
, 
x_mš
, 
y_max
, 
x_max
 = 
Å
.
	`¬¿y_¥l™
(
boxli¡
.
	`g‘
(), 4, 
axis
=1)

321 
y_mš
 = 
y_sÿË
 * y_min

322 
y_max
 = 
y_sÿË
 * y_max

323 
x_mš
 = 
x_sÿË
 * x_min

324 
x_max
 = 
x_sÿË
 * x_max

325 
sÿËd_boxli¡
 = 
Å_box_li¡
.
	`BoxLi¡
(
Å
.
	$h¡ack
([
y_mš
, 
x_mš
, 
y_max
, 
x_max
]))

327 
f›lds
 = 
boxli¡
.
	$g‘_exŒa_f›lds
()

328 
f›ld
 
š
 
f›lds
:

329 
exŒa_f›ld_d©a
 = 
boxli¡
.
	$g‘_f›ld
(
f›ld
)

330 
sÿËd_boxli¡
.
	$add_f›ld
(
f›ld
, 
exŒa_f›ld_d©a
)

332  
sÿËd_boxli¡


335 
def
 
	$ş_to_wšdow
(
boxli¡
, 
wšdow
):

338 
This
 
İ
 
şs
 
šput
 
boundšg
 
	$boxes
 (
»´e£Áed
 
by
 
boundšg
 
box


339 
cÜÃrs
è
to
 
a
 
wšdow
, 
İtiÚ®ly
 
f‹ršg
 
out
 
boxes
 
th©
 dØ
nÙ


340 
ov”Ïp
 
©
 
®l
 
w™h
 
the
 
wšdow
.

342 
Args
:

343 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
M_š
 
boxes


344 
wšdow
: 
a
 
numpy
 
¬¿y
 
of
 
sh­e
 [4] 
»´e£Ášg
 
the


345 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
] 
wšdow
 
to
 
which
 
the
 
İ


346 
should
 
ş
 
boxes
.

348 
R‘uºs
:

349 
a
 
BoxLi¡
 
hŞdšg
 
M_out
 
boxes
 
wh”e
 M_ouˆ<ğ
M_š


351 
y_mš
, 
x_mš
, 
y_max
, 
x_max
 = 
Å
.
	`¬¿y_¥l™
(
boxli¡
.
	`g‘
(), 4, 
axis
=1)

352 
wš_y_mš
 = 
wšdow
[0]

353 
wš_x_mš
 = 
wšdow
[1]

354 
wš_y_max
 = 
wšdow
[2]

355 
wš_x_max
 = 
wšdow
[3]

356 
y_mš_ş³d
 = 
Å
.
	`fmax
Òp.
	`fmš
(
y_mš
, 
wš_y_max
), 
wš_y_mš
)

357 
y_max_ş³d
 = 
Å
.
	`fmax
Òp.
	`fmš
(
y_max
, 
wš_y_max
), 
wš_y_mš
)

358 
x_mš_ş³d
 = 
Å
.
	`fmax
Òp.
	`fmš
(
x_mš
, 
wš_x_max
), 
wš_x_mš
)

359 
x_max_ş³d
 = 
Å
.
	`fmax
Òp.
	`fmš
(
x_max
, 
wš_x_max
), 
wš_x_mš
)

360 
ş³d
 = 
Å_box_li¡
.
	`BoxLi¡
(

361 
Å
.
	$h¡ack
([
y_mš_ş³d
, 
x_mš_ş³d
, 
y_max_ş³d
, 
x_max_ş³d
]))

362 
ş³d
 = 
	$_cİy_exŒa_f›lds
(
ş³d
, 
boxli¡
)

363 
¬—s
 = 
	$¬—
(
ş³d
)

364 
nÚz”o_¬—_šdiûs
 = 
Å
.
	`»sh­e
Òp.
	`nÚz”o
Òp.
	`g»©”
(
¬—s
, 0.0)),

365 [-1]).
	$a¡y³
(
Å
.
št32
)

366  
	$g©h”
(
ş³d
, 
nÚz”o_¬—_šdiûs
)

369 
def
 
	$´uÃ_nÚ_ov”Ïµšg_boxes
(
boxli¡1
, 
boxli¡2
, 
mšov”Ïp
=0.0):

372 
FÜ
 
—ch
 
box
 
š
 
boxli¡1
, 
we
 
wªt
 
™s
 
IOA
 
to
 
be
 
mÜe
 
thª
 
mšov”Ïp
 
w™h


373 
©
 
Ëa¡
 
Úe
 
of
 
the
 
boxes
 
š
 
boxli¡2
. 
If
 
™
 
dÛs
 
nÙ
, 
we
 
»move
 it.

375 
Args
:

376 
boxli¡1
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes
.

377 
boxli¡2
: 
BoxLi¡
 
hŞdšg
 
M
 
boxes
.

378 
mšov”Ïp
: 
Mšimum
 
»quœed
 
ov”Ïp
 
b‘w“n
 
boxes
, 
to
 
couÁ
 
them
 
as


379 
ov”Ïµšg
.

381 
R‘uºs
:

382 
A
 
´uÃd
 
boxli¡
 
w™h
 
size
 [
N
', 4].

384 
š‹r£ùiÚ_ov”_¬—
 = 
	$iß
(
boxli¡2
, 
boxli¡1
è#[
M
, 
N
] 
‹nsÜ


385 
š‹r£ùiÚ_ov”_¬—
 = 
Å
.
	$amax
(
š‹r£ùiÚ_ov”_¬—
, 
axis
=0è#[
N
] 
‹nsÜ


386 
k“p_boŞ
 = 
Å
.
	`g»©”_equ®
(
š‹r£ùiÚ_ov”_¬—
,‚p.
	$¬¿y
(
mšov”Ïp
))

387 
k“p_šds
 = 
Å
.
	`nÚz”o
(
k“p_boŞ
)[0]

388 
Ãw_boxli¡1
 = 
	$g©h”
(
boxli¡1
, 
k“p_šds
)

389  
Ãw_boxli¡1


392 
def
 
	$´uÃ_outside_wšdow
(
boxli¡
, 
wšdow
):

395 
This
 
funùiÚ
 
´uÃs
 
boundšg
 
boxes
 
th©
 
ev’
 
·¹ŸÎy
 
çÎ
 
outside
 
the
 
giv’


396 
wšdow
. 
S“
 
®so
 
ClToWšdow
 
which
 
Úly
 
´uÃs
 
boundšg
 
boxes
 
th©
 
çÎ


397 
com¶‘–y
 
outside
 
the
 
wšdow
, 
ªd
 
şs
 
ªy
 
boundšg
 
boxes
 
th©
 
·¹ŸÎy


398 
ov”æow
.

400 
Args
:

401 
boxli¡
: 
a
 
BoxLi¡
 
hŞdšg
 
M_š
 
boxes
.

402 
wšdow
: 
a
 
numpy
 
¬¿y
 
of
 
size
 4, 
»´e£Ášg
 [
ymš
, 
xmš
, 
ymax
, 
xmax
]

403 
of
 
the
 
wšdow
.

405 
R‘uºs
:

406 
´uÃd_cÜÃrs
: 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
M_out
, 4] 
wh”e
 M_ouˆ<ğ
M_š
.

407 
v®id_šdiûs
: 
a
 
‹nsÜ
 
w™h
 
sh­e
 [
M_out
] 
šdexšg
 
the
 
v®id
 
boundšg
 
boxes


408 
š
 
the
 
šput
 
‹nsÜ
.

411 
y_mš
, 
x_mš
, 
y_max
, 
x_max
 = 
Å
.
	`¬¿y_¥l™
(
boxli¡
.
	`g‘
(), 4, 
axis
=1)

412 
wš_y_mš
 = 
wšdow
[0]

413 
wš_x_mš
 = 
wšdow
[1]

414 
wš_y_max
 = 
wšdow
[2]

415 
wš_x_max
 = 
wšdow
[3]

416 
coÜdš©e_viŞ©iÚs
 = 
Å
.
	`h¡ack
([Å.
	`Ëss
(
y_mš
, 
wš_y_mš
),

417 
Å
.
	`Ëss
(
x_mš
, 
wš_x_mš
),

418 
Å
.
	`g»©”
(
y_max
, 
wš_y_max
),

419 
Å
.
	`g»©”
(
x_max
, 
wš_x_max
)])

420 
v®id_šdiûs
 = 
Å
.
	`»sh­e
(

421 
Å
.
	`wh”e
Òp.
	`logiÿl_nÙ
Òp.
	`max
(
coÜdš©e_viŞ©iÚs
, 
axis
=1))), [-1])

422  
	`g©h”
(
boxli¡
, 
v®id_šdiûs
), valid_indices

425 
def
 
	$cÚÿ‹Ç‹
(
boxli¡s
, 
f›lds
=
NÚe
):

428 
This
 
İ
 
cÚÿ‹Ç‹s
 
a
 
li¡
 
of
 
šput
 
BoxLi¡s
 
što
‡ 
Ïrg”
 
BoxLi¡
. 
It
 
®so


429 
hªdËs
 
cÚÿ‹ÇtiÚ
 
of
 
BoxLi¡
 
f›lds
 
as
 a 
the
 
f›ld
 
‹nsÜ
 
sh­es


430 
¬e
 
equ®
 
exû±
 
the
 
fœ¡
 
dim’siÚ
.

432 
Args
:

433 
boxli¡s
: 
li¡
 
of
 
BoxLi¡
 
objeùs


434 
f›lds
: 
İtiÚ®
 
li¡
 
of
 f›ld 
to
 
®so
 
cÚÿ‹Ç‹
. 
By
 , 
®l


435 
f›lds
 
äom
 
the
 
fœ¡
 
BoxLi¡
 
š
h
li¡
 
¬e
 
šşuded
 inhe

436 
cÚÿ‹ÇtiÚ
.

438 
R‘uºs
:

439 
a
 
BoxLi¡
 
w™h
 
numb”
 
of
 
boxes
 
equ®
 
to


440 
	`sum
([
boxli¡
.
	$num_boxes
(è
boxli¡
 
š
 
BoxLi¡
])

441 
Rai£s
:

442 
V®ueE¼Ü
: 
boxli¡s
 
is
 
	`šv®id
 (
i
.
e
., i 
nÙ
 
a
 
li¡
, i 
em±y
, 
Ü


443 
cÚšs
 
nÚ
 
BoxLi¡
 
objeùs
), 
Ü
 
»que¡ed
 
f›lds
 
¬e
 
nÙ
 
cÚšed
 
š


444 
®l
 
boxli¡s


446 
nÙ
 
	$isš¡ªû
(
boxli¡s
, 
li¡
):

447 
¿i£
 
	`V®ueE¼Ü
('boxlists should be‡†ist')

448 
nÙ
 
boxli¡s
:

449 
¿i£
 
	`V®ueE¼Ü
('boxlists should have‚onzero†ength')

450 
boxli¡
 
š
 
boxli¡s
:

451 
nÙ
 
	$isš¡ªû
(
boxli¡
, 
Å_box_li¡
.
BoxLi¡
):

452 
¿i£
 
	`V®ueE¼Ü
('allƒlements of boxlists should be BoxList objects')

453 
cÚÿ‹Ç‹d
 = 
Å_box_li¡
.
	`BoxLi¡
(

454 
Å
.
	`v¡ack
([
boxli¡
.
	$g‘
(è
boxli¡
 
š
 
boxli¡s
]))

455 
f›lds
 
is
 
NÚe
:

456 
f›lds
 = 
boxli¡s
[0].
	$g‘_exŒa_f›lds
()

457 
f›ld
 
š
 
f›lds
:

458 
fœ¡_f›ld_sh­e
 = 
boxli¡s
[0].
	`g‘_f›ld
(
f›ld
).
sh­e


459 
fœ¡_f›ld_sh­e
 = first_field_shape[1:]

460 
boxli¡
 
š
 
boxli¡s
:

461 
nÙ
 
boxli¡
.
	$has_f›ld
(
f›ld
):

462 
¿i£
 
	`V®ueE¼Ü
('boxlist must contain‡ll„equested fields')

463 
f›ld_sh­e
 = 
boxli¡
.
	`g‘_f›ld
(
f›ld
).
sh­e


464 
f›ld_sh­e
 = field_shape[1:]

465 
f›ld_sh­e
 !ğ
fœ¡_f›ld_sh­e
:

466 
¿i£
 
	`V®ueE¼Ü
('field %s must have same shape for‡ll boxlists '

467 'exû± fÜh0th dim’siÚ.' % 
f›ld
)

468 
cÚÿ‹Ç‹d_f›ld
 = 
Å
.
	`cÚÿ‹Ç‹
(

469 [
boxli¡
.
	$g‘_f›ld
(
f›ld
è
boxli¡
 
š
 
boxli¡s
], 
axis
=0)

470 
cÚÿ‹Ç‹d
.
	$add_f›ld
(
f›ld
, 
cÚÿ‹Ç‹d_f›ld
)

471  
cÚÿ‹Ç‹d


474 
def
 
	$f‹r_scÜes_g»©”_thª
(
boxli¡
, 
th»sh
):

477 
This
 
İ
 
k“ps
 
the
 
cŞËùiÚ
 
of
 
boxes
 
who£
 
cÜ»¥Údšg
 
scÜes
 
¬e


478 
g»©”
 
thª
 
the
 
šput
 
th»shŞd
.

480 
Args
:

481 
boxli¡
: 
BoxLi¡
 
hŞdšg
 
N
 
boxes
. 
Mu¡
 
cÚš
 
a
 'scÜes' 
f›ld


482 
»´e£Ášg
 
d‘eùiÚ
 
scÜes
.

483 
th»sh
: 
sÿÏr
 
th»shŞd


485 
R‘uºs
:

486 
a
 
BoxLi¡
 
hŞdšg
 
M
 
boxes
 
wh”e
 M <ğ
N


488 
Rai£s
:

489 
V®ueE¼Ü
: 
boxli¡
 
nÙ
 
a
 
BoxLi¡
 
objeù
 
Ü
 
™
 
dÛs
‚ot

490 
have
 
a
 
scÜes
 
f›ld


492 
nÙ
 
	$isš¡ªû
(
boxli¡
, 
Å_box_li¡
.
BoxLi¡
):

493 
¿i£
 
	`V®ueE¼Ü
('boxlist must be‡ BoxList')

494 
nÙ
 
boxli¡
.
	`has_f›ld
('scores'):

495 
¿i£
 
	`V®ueE¼Ü
('input boxlist must have \'scores\' field')

496 
scÜes
 = 
boxli¡
.
	`g‘_f›ld
('scores')

497 
	`Ën
(
scÜes
.
sh­e
) > 2:

498 
¿i£
 
	`V®ueE¼Ü
('Scores should have„ank 1 or 2')

499 
	`Ën
(
scÜes
.
sh­e
è=ğ2 
ªd
 scores.shape[1] != 1:

500 
¿i£
 
	`V®ueE¼Ü
('Scores should have„ank 1 or have shape '

502 
high_scÜe_šdiûs
 = 
Å
.
	`»sh­e
Òp.
	`wh”e
Òp.
	`g»©”
(
scÜes
, 
th»sh
)),

503 [-1]).
	$a¡y³
(
Å
.
št32
)

504  
	$g©h”
(
boxli¡
, 
high_scÜe_šdiûs
)

507 
def
 
	$chªge_coÜdš©e_äame
(
boxli¡
, 
wšdow
):

510 
Giv’
 
a
 
wšdow
 
of
 
the
 
fÜm
 [
ymš
, 
xmš
, 
ymax
, 
xmax
],

511 
chªges
 
boundšg
 
box
 
coÜdš©es
 
äom
 
boxli¡
 
to
 
be
 
»Ïtive
Ø
this
 
wšdow


512 (
e
.
g
., 
the
 
mš
 
cÜÃr
 
m­s
 
	$to
 (0,0è
ªd
 
the
 
max
 
cÜÃr
 
m­s
 
	`to
 (1,1)).

514 
An
 
exam¶e
 
u£
 
is
 
d©a
 
augm’tiÚ
: 
wh”e
 
we
 
¬e
 
giv’
 
groundŒuth


515 
	$boxes
 (
boxli¡
è
ªd
 
would
 
like
 
to
 
¿ndomly
 
üİ
 
the
 
image
Ø
some


516 
	`wšdow
 (
wšdow
). 
In
 
this
 
we
 
Ãed
 
to
 
chªge
 
the
 
coÜdš©e
 
äame
 
of


517 
—ch
 
groundŒuth
 
box
 
to
 
be
 
»Ïtive
Ø
this
 
Ãw
 
wšdow
.

519 
Args
:

520 
boxli¡
: 
A
 
BoxLi¡
 
objeù
 
hŞdšg
 
N
 
boxes
.

521 
wšdow
: 
a
 
size
 4 1-
D
 
numpy
 
¬¿y
.

523 
R‘uºs
:

524 
R‘uºs
 
a
 
BoxLi¡
 
objeù
 
w™h
 
N
 
boxes
.

526 
wš_height
 = 
wšdow
[2] - window[0]

527 
wš_width
 = 
wšdow
[3] - window[1]

528 
boxli¡_Ãw
 = 
	`sÿË
(

529 
Å_box_li¡
.
	`BoxLi¡
(
boxli¡
.
	`g‘
() -

530 [
wšdow
[0], window[1], window[0], window[1]]),

531 1.0 / 
wš_height
, 1.0 / 
wš_width
)

532 
	$_cİy_exŒa_f›lds
(
boxli¡_Ãw
, 
boxli¡
)

534  
boxli¡_Ãw


537 
def
 
	$_cİy_exŒa_f›lds
(
boxli¡_to_cİy_to
, 
boxli¡_to_cİy_äom
):

540 
Args
:

541 
boxli¡_to_cİy_to
: 
BoxLi¡
 
to
 
which
 
exŒa
 
f›lds
 
¬e
 
cİ›d
.

542 
boxli¡_to_cİy_äom
: 
BoxLi¡
 
äom
 
which
 
f›lds
 
¬e
 
cİ›d
.

544 
R‘uºs
:

545 
boxli¡_to_cİy_to
 
w™h
 
exŒa
 
f›lds
.

547 
f›ld
 
š
 
boxli¡_to_cİy_äom
.
	$g‘_exŒa_f›lds
():

548 
boxli¡_to_cİy_to
.
	`add_f›ld
(
f›ld
, 
boxli¡_to_cİy_äom
.
	$g‘_f›ld
(
f›ld
))

549  
boxli¡_to_cİy_to


552 
def
 
	$_upd©e_v®id_šdiûs_by_»movšg_high_iou_boxes
(

553 
£Ëùed_šdiûs
, 
is_šdex_v®id
, 
š‹r£ù_ov”_uniÚ
, 
th»shŞd
):

554 
max_iou
 = 
Å
.
	$max
(
š‹r£ù_ov”_uniÚ
[:, 
£Ëùed_šdiûs
], 
axis
=1)

555  
Å
.
	`logiÿl_ªd
(
is_šdex_v®id
, 
max_iou
 <ğ
th»shŞd
)

	@utils/np_box_list_ops_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
numpy
 
as
 
Å


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
Å_box_li¡


22 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
Å_box_li¡_İs


25 
şass
 
	$A»aR–©edTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

27 
def
 
	$£tUp
(
£lf
):

28 
boxes1
 = 
Å
.
	$¬¿y
([[4.0, 3.0, 7.0, 5.0], [5.0, 6.0, 10.0, 7.0]],

29 
dty³
=)

30 
boxes2
 = 
Å
.
	$¬¿y
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0],

32 
dty³
=)

33 
£lf
.
boxli¡1
 = 
Å_box_li¡
.
	$BoxLi¡
(
boxes1
)

34 
£lf
.
boxli¡2
 = 
Å_box_li¡
.
	$BoxLi¡
(
boxes2
)

36 
def
 
	$‹¡_¬—
(
£lf
):

37 
¬—s
 = 
Å_box_li¡_İs
.
	$¬—
(
£lf
.
boxli¡1
)

38 
ex³ùed_¬—s
 = 
Å
.
	$¬¿y
([6.0, 5.0], 
dty³
=)

39 
£lf
.
	$as£¹AÎClo£
(
ex³ùed_¬—s
, 
¬—s
)

41 
def
 
	$‹¡_š‹r£ùiÚ
(
£lf
):

42 
š‹r£ùiÚ
 = 
Å_box_li¡_İs
.
	$š‹r£ùiÚ
(
£lf
.
boxli¡1
, s–f.
boxli¡2
)

43 
ex³ùed_š‹r£ùiÚ
 = 
Å
.
	$¬¿y
([[2.0, 0.0, 6.0], [1.0, 0.0, 5.0]],

44 
dty³
=)

45 
£lf
.
	$as£¹AÎClo£
(
š‹r£ùiÚ
, 
ex³ùed_š‹r£ùiÚ
)

47 
def
 
	$‹¡_iou
(
£lf
):

48 
iou
 = 
Å_box_li¡_İs
.
	$iou
(
£lf
.
boxli¡1
, s–f.
boxli¡2
)

49 
ex³ùed_iou
 = 
Å
.
	`¬¿y
([[2.0 / 16.0, 0.0, 6.0 / 400.0],

51 
dty³
=)

52 
£lf
.
	$as£¹AÎClo£
(
iou
, 
ex³ùed_iou
)

54 
def
 
	$‹¡_iß
(
£lf
):

55 
boxli¡1
 = 
Å_box_li¡
.
	`BoxLi¡
(

56 
Å
.
	$¬¿y
(

57 [[0.25, 0.25, 0.75, 0.75], [0.0, 0.0, 0.5, 0.75]], 
dty³
=

58 
Å
.
æßt32
))

59 
boxli¡2
 = 
Å_box_li¡
.
	`BoxLi¡
(

60 
Å
.
	$¬¿y
(

61 [[0.5, 0.25, 1.0, 1.0], [0.0, 0.0, 1.0, 1.0]], 
dty³
=
Å
.
æßt32
))

62 
iß21
 = 
Å_box_li¡_İs
.
	$iß
(
boxli¡2
, 
boxli¡1
)

63 
ex³ùed_iß21
 = 
Å
.
	$¬¿y
([[0.5, 0.0],

65 
dty³
=
Å
.
æßt32
)

66 
£lf
.
	$as£¹AÎClo£
(
iß21
, 
ex³ùed_iß21
)

68 
def
 
	$‹¡_sÿË
(
£lf
):

69 
boxli¡
 = 
Å_box_li¡
.
	`BoxLi¡
(

70 
Å
.
	$¬¿y
(

71 [[0.25, 0.25, 0.75, 0.75], [0.0, 0.0, 0.5, 0.75]], 
dty³
=

72 
Å
.
æßt32
))

73 
boxli¡_sÿËd
 = 
Å_box_li¡_İs
.
	$sÿË
(
boxli¡
, 2.0, 3.0)

74 
ex³ùed_boxli¡_sÿËd
 = 
Å_box_li¡
.
	`BoxLi¡
(

75 
Å
.
	$¬¿y
(

76 [[0.5, 0.75, 1.5, 2.25], [0.0, 0.0, 1.0, 2.25]], 
dty³
=
Å
.
æßt32
))

77 
£lf
.
	`as£¹AÎClo£
(
ex³ùed_boxli¡_sÿËd
.
	`g‘
(), 
boxli¡_sÿËd
.
	$g‘
())

79 
def
 
	$‹¡_ş_to_wšdow
(
£lf
):

80 
boxli¡
 = 
Å_box_li¡
.
	`BoxLi¡
(

81 
Å
.
	`¬¿y
(

84 
dty³
=
Å
.
æßt32
))

85 
boxli¡_ş³d
 = 
Å_box_li¡_İs
.
	$ş_to_wšdow
(
boxli¡
,

87 
ex³ùed_boxli¡_ş³d
 = 
Å_box_li¡
.
	`BoxLi¡
(

88 
Å
.
	$¬¿y
(

91 
dty³
=
Å
.
æßt32
))

92 
£lf
.
	`as£¹AÎClo£
(
ex³ùed_boxli¡_ş³d
.
	`g‘
(), 
boxli¡_ş³d
.
	$g‘
())

94 
def
 
	$‹¡_´uÃ_outside_wšdow
(
£lf
):

95 
boxli¡
 = 
Å_box_li¡
.
	`BoxLi¡
(

96 
Å
.
	`¬¿y
(

99 
dty³
=
Å
.
æßt32
))

100 
boxli¡_´uÃd
, 
_
 = 
Å_box_li¡_İs
.
	$´uÃ_outside_wšdow
(

101 
boxli¡
, [0.0, 0.0, 1.0, 1.0])

102 
ex³ùed_boxli¡_´uÃd
 = 
Å_box_li¡
.
	`BoxLi¡
(

103 
Å
.
	$¬¿y
(

104 [[0.25, 0.25, 0.75, 0.75], [0.0, 0.0, 0.5, 0.75]], 
dty³
=

105 
Å
.
æßt32
))

106 
£lf
.
	`as£¹AÎClo£
(
ex³ùed_boxli¡_´uÃd
.
	`g‘
(), 
boxli¡_´uÃd
.
	$g‘
())

108 
def
 
	$‹¡_cÚÿ‹Ç‹
(
£lf
):

109 
boxli¡1
 = 
Å_box_li¡
.
	`BoxLi¡
(

110 
Å
.
	$¬¿y
(

111 [[0.25, 0.25, 0.75, 0.75], [0.0, 0.0, 0.5, 0.75]], 
dty³
=

112 
Å
.
æßt32
))

113 
boxli¡2
 = 
Å_box_li¡
.
	`BoxLi¡
(

114 
Å
.
	$¬¿y
(

115 [[0.5, 0.25, 1.0, 1.0], [0.0, 0.0, 1.0, 1.0]], 
dty³
=
Å
.
æßt32
))

116 
boxli¡s
 = [
boxli¡1
, 
boxli¡2
]

117 
boxli¡_cÚÿ‹Ç‹d
 = 
Å_box_li¡_İs
.
	$cÚÿ‹Ç‹
(
boxli¡s
)

118 
boxli¡_cÚÿ‹Ç‹d_ex³ùed
 = 
Å_box_li¡
.
	`BoxLi¡
(

119 
Å
.
	$¬¿y
(

122 
dty³
=
Å
.
æßt32
))

123 
£lf
.
	`as£¹AÎClo£
(
boxli¡_cÚÿ‹Ç‹d_ex³ùed
.
	`g‘
(),

124 
boxli¡_cÚÿ‹Ç‹d
.
	$g‘
())

126 
def
 
	$‹¡_chªge_coÜdš©e_äame
(
£lf
):

127 
boxli¡
 = 
Å_box_li¡
.
	`BoxLi¡
(

128 
Å
.
	$¬¿y
(

129 [[0.25, 0.25, 0.75, 0.75], [0.0, 0.0, 0.5, 0.75]], 
dty³
=

130 
Å
.
æßt32
))

131 
boxli¡_coÜd
 = 
Å_box_li¡_İs
.
	`chªge_coÜdš©e_äame
(

132 
boxli¡
, 
Å
.
	$¬¿y
([0, 0, 0.5, 0.5], 
dty³
=
Å
.
æßt32
))

133 
ex³ùed_boxli¡_coÜd
 = 
Å_box_li¡
.
	`BoxLi¡
(

134 
Å
.
	$¬¿y
([[0.5, 0.5, 1.5, 1.5], [0, 0, 1.0, 1.5]], 
dty³
=
Å
.
æßt32
))

135 
£lf
.
	`as£¹AÎClo£
(
boxli¡_coÜd
.
	`g‘
(), 
ex³ùed_boxli¡_coÜd
.
	$g‘
())

137 
def
 
	$‹¡_f‹r_scÜes_g»©”_thª
(
£lf
):

138 
boxli¡
 = 
Å_box_li¡
.
	`BoxLi¡
(

139 
Å
.
	$¬¿y
(

140 [[0.25, 0.25, 0.75, 0.75], [0.0, 0.0, 0.5, 0.75]], 
dty³
=

141 
Å
.
æßt32
))

142 
boxli¡
.
	`add_f›ld
('scÜes', 
Å
.
	$¬¿y
([0.8, 0.2], 
Å
.
æßt32
))

143 
boxli¡_g»©”
 = 
Å_box_li¡_İs
.
	$f‹r_scÜes_g»©”_thª
(
boxli¡
, 0.5)

145 
ex³ùed_boxli¡_g»©”
 = 
Å_box_li¡
.
	`BoxLi¡
(

146 
Å
.
	$¬¿y
([[0.25, 0.25, 0.75, 0.75]], 
dty³
=
Å
.
æßt32
))

148 
£lf
.
	`as£¹AÎClo£
(
boxli¡_g»©”
.
	`g‘
(), 
ex³ùed_boxli¡_g»©”
.
	$g‘
())

151 
şass
 
	$G©h”OpsTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

153 
def
 
	$£tUp
(
£lf
):

154 
boxes
 = 
Å
.
	$¬¿y
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0],

156 
dty³
=)

157 
£lf
.
boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
boxes
)

158 
£lf
.
boxli¡
.
	`add_f›ld
('scÜes', 
Å
.
	$¬¿y
([0.5, 0.7, 0.9], 
dty³
=))

159 
£lf
.
boxli¡
.
	`add_f›ld
('labels',

160 
Å
.
	$¬¿y
([[0, 0, 0, 1, 0], [0, 1, 0, 0, 0],

162 
dty³
=))

164 
def
 
	$‹¡_g©h”_w™h_out_of_¿nge_šdiûs
(
£lf
):

165 
šdiûs
 = 
Å
.
	$¬¿y
([3, 1], 
dty³
=)

166 
boxli¡
 = 
£lf
.boxlist

167 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

168 
Å_box_li¡_İs
.
	$g©h”
(
boxli¡
, 
šdiûs
)

170 
def
 
	$‹¡_g©h”_w™h_šv®id_muÉidim’siÚ®_šdiûs
(
£lf
):

171 
šdiûs
 = 
Å
.
	$¬¿y
([[0, 1], [1, 2]], 
dty³
=)

172 
boxli¡
 = 
£lf
.boxlist

173 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

174 
Å_box_li¡_İs
.
	$g©h”
(
boxli¡
, 
šdiûs
)

176 
def
 
	$‹¡_g©h”_w™hout_f›lds_¥ecif›d
(
£lf
):

177 
šdiûs
 = 
Å
.
	$¬¿y
([2, 0, 1], 
dty³
=)

178 
boxli¡
 = 
£lf
.boxlist

179 
subboxli¡
 = 
Å_box_li¡_İs
.
	$g©h”
(
boxli¡
, 
šdiûs
)

181 
ex³ùed_scÜes
 = 
Å
.
	$¬¿y
([0.9, 0.5, 0.7], 
dty³
=)

182 
£lf
.
	`as£¹AÎClo£
(
ex³ùed_scÜes
, 
subboxli¡
.
	`g‘_f›ld
('scores'))

184 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([[0.0, 0.0, 20.0, 20.0], [3.0, 4.0, 6.0, 8.0],

186 
dty³
=)

187 
£lf
.
	`as£¹AÎClo£
(
ex³ùed_boxes
, 
subboxli¡
.
	$g‘
())

189 
ex³ùed_Ïb–s
 = 
Å
.
	$¬¿y
([[0, 0, 0, 0, 1], [0, 0, 0, 1, 0],

191 
dty³
=)

192 
£lf
.
	`as£¹AÎClo£
(
ex³ùed_Ïb–s
, 
subboxli¡
.
	`g‘_f›ld
('labels'))

194 
def
 
	$‹¡_g©h”_w™h_šv®id_f›ld_¥ecif›d
(
£lf
):

195 
šdiûs
 = 
Å
.
	$¬¿y
([2, 0, 1], 
dty³
=)

196 
boxli¡
 = 
£lf
.boxlist

198 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

199 
Å_box_li¡_İs
.
	`g©h”
(
boxli¡
, 
šdiûs
, 'labels')

201 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

202 
Å_box_li¡_İs
.
	`g©h”
(
boxli¡
, 
šdiûs
, ['objectness'])

204 
def
 
	$‹¡_g©h”_w™h_f›lds_¥ecif›d
(
£lf
):

205 
šdiûs
 = 
Å
.
	$¬¿y
([2, 0, 1], 
dty³
=)

206 
boxli¡
 = 
£lf
.boxlist

207 
subboxli¡
 = 
Å_box_li¡_İs
.
	`g©h”
(
boxli¡
, 
šdiûs
, ['labels'])

209 
£lf
.
	`as£¹F®£
(
subboxli¡
.
	`has_f›ld
('scores'))

211 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([[0.0, 0.0, 20.0, 20.0], [3.0, 4.0, 6.0, 8.0],

213 
dty³
=)

214 
£lf
.
	`as£¹AÎClo£
(
ex³ùed_boxes
, 
subboxli¡
.
	$g‘
())

216 
ex³ùed_Ïb–s
 = 
Å
.
	$¬¿y
([[0, 0, 0, 0, 1], [0, 0, 0, 1, 0],

218 
dty³
=)

219 
£lf
.
	`as£¹AÎClo£
(
ex³ùed_Ïb–s
, 
subboxli¡
.
	`g‘_f›ld
('labels'))

222 
şass
 
	$SÜtByF›ldTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

224 
def
 
	$£tUp
(
£lf
):

225 
boxes
 = 
Å
.
	$¬¿y
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0],

227 
dty³
=)

228 
£lf
.
boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
boxes
)

229 
£lf
.
boxli¡
.
	`add_f›ld
('scÜes', 
Å
.
	$¬¿y
([0.5, 0.9, 0.4], 
dty³
=))

230 
£lf
.
boxli¡
.
	`add_f›ld
('labels',

231 
Å
.
	$¬¿y
([[0, 0, 0, 1, 0], [0, 1, 0, 0, 0],

233 
dty³
=))

235 
def
 
	$‹¡_w™h_šv®id_f›ld
(
£lf
):

236 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

237 
Å_box_li¡_İs
.
	`sÜt_by_f›ld
(
£lf
.
boxli¡
, 'objectness')

238 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

239 
Å_box_li¡_İs
.
	`sÜt_by_f›ld
(
£lf
.
boxli¡
, 'labels')

241 
def
 
	$‹¡_w™h_šv®id_sÜtšg_Üd”
(
£lf
):

242 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

243 
Å_box_li¡_İs
.
	`sÜt_by_f›ld
(
£lf
.
boxli¡
, 'scores', 'Descending')

245 
def
 
	$‹¡_w™h_desûndšg_sÜtšg
(
£lf
):

246 
sÜ‹d_boxli¡
 = 
Å_box_li¡_İs
.
	`sÜt_by_f›ld
(
£lf
.
boxli¡
, 'scores')

248 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([[14.0, 14.0, 15.0, 15.0], [3.0, 4.0, 6.0, 8.0],

250 
dty³
=)

251 
£lf
.
	`as£¹AÎClo£
(
ex³ùed_boxes
, 
sÜ‹d_boxli¡
.
	$g‘
())

253 
ex³ùed_scÜes
 = 
Å
.
	$¬¿y
([0.9, 0.5, 0.4], 
dty³
=)

254 
£lf
.
	`as£¹AÎClo£
(
ex³ùed_scÜes
, 
sÜ‹d_boxli¡
.
	`g‘_f›ld
('scores'))

256 
def
 
	$‹¡_w™h_asûndšg_sÜtšg
(
£lf
):

257 
sÜ‹d_boxli¡
 = 
Å_box_li¡_İs
.
	`sÜt_by_f›ld
(

258 
£lf
.
boxli¡
, 'scÜes', 
Å_box_li¡_İs
.
SÜtOrd”
.
ASCEND
)

260 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([[0.0, 0.0, 20.0, 20.0],

263 
dty³
=)

264 
£lf
.
	`as£¹AÎClo£
(
ex³ùed_boxes
, 
sÜ‹d_boxli¡
.
	$g‘
())

266 
ex³ùed_scÜes
 = 
Å
.
	$¬¿y
([0.4, 0.5, 0.9], 
dty³
=)

267 
£lf
.
	`as£¹AÎClo£
(
ex³ùed_scÜes
, 
sÜ‹d_boxli¡
.
	`g‘_f›ld
('scores'))

270 
şass
 
	$NÚMaximumSuµ»ssiÚTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

272 
def
 
	$£tUp
(
£lf
):

273 
£lf
.
_boxes
 = 
Å
.
	`¬¿y
([[0, 0, 1, 1],

279 
dty³
=)

280 
£lf
.
_boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
£lf
.
_boxes
)

282 
def
 
	$‹¡_w™h_no_scÜes_f›ld
(
£lf
):

283 
boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
£lf
.
_boxes
)

284 
max_ouut_size
 = 3

285 
iou_th»shŞd
 = 0.5

287 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

288 
Å_box_li¡_İs
.
	$nÚ_max_suµ»ssiÚ
(

289 
boxli¡
, 
max_ouut_size
, 
iou_th»shŞd
)

291 
def
 
	$‹¡_nms_di§bËd_max_ouut_size_equ®s_th»e
(
£lf
):

292 
boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
£lf
.
_boxes
)

293 
boxli¡
.
	`add_f›ld
('scores',

294 
Å
.
	$¬¿y
([.9, .75, .6, .95, .2, .3], 
dty³
=))

295 
max_ouut_size
 = 3

296 
iou_th»shŞd
 = 1. #NØ
NMS


298 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([[0, 10, 1, 11], [0, 0, 1, 1], [0, 0.1, 1, 1.1]],

299 
dty³
=)

300 
nms_boxli¡
 = 
Å_box_li¡_İs
.
	$nÚ_max_suµ»ssiÚ
(

301 
boxli¡
, 
max_ouut_size
, 
iou_th»shŞd
)

302 
£lf
.
	`as£¹AÎClo£
(
nms_boxli¡
.
	`g‘
(), 
ex³ùed_boxes
)

304 
def
 
	$‹¡_£Ëù_äom_th»e_şu¡”s
(
£lf
):

305 
boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
£lf
.
_boxes
)

306 
boxli¡
.
	`add_f›ld
('scores',

307 
Å
.
	$¬¿y
([.9, .75, .6, .95, .2, .3], 
dty³
=))

308 
max_ouut_size
 = 3

309 
iou_th»shŞd
 = 0.5

311 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([[0, 10, 1, 11], [0, 0, 1, 1], [0, 100, 1, 101]],

312 
dty³
=)

313 
nms_boxli¡
 = 
Å_box_li¡_İs
.
	$nÚ_max_suµ»ssiÚ
(

314 
boxli¡
, 
max_ouut_size
, 
iou_th»shŞd
)

315 
£lf
.
	`as£¹AÎClo£
(
nms_boxli¡
.
	`g‘
(), 
ex³ùed_boxes
)

317 
def
 
	$‹¡_£Ëù_©_mo¡_two_äom_th»e_şu¡”s
(
£lf
):

318 
boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
£lf
.
_boxes
)

319 
boxli¡
.
	`add_f›ld
('scores',

320 
Å
.
	$¬¿y
([.9, .75, .6, .95, .5, .3], 
dty³
=))

321 
max_ouut_size
 = 2

322 
iou_th»shŞd
 = 0.5

324 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([[0, 10, 1, 11], [0, 0, 1, 1]], 
dty³
=)

325 
nms_boxli¡
 = 
Å_box_li¡_İs
.
	$nÚ_max_suµ»ssiÚ
(

326 
boxli¡
, 
max_ouut_size
, 
iou_th»shŞd
)

327 
£lf
.
	`as£¹AÎClo£
(
nms_boxli¡
.
	`g‘
(), 
ex³ùed_boxes
)

329 
def
 
	$‹¡_£Ëù_©_mo¡_thœty_äom_th»e_şu¡”s
(
£lf
):

330 
boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
£lf
.
_boxes
)

331 
boxli¡
.
	`add_f›ld
('scores',

332 
Å
.
	$¬¿y
([.9, .75, .6, .95, .5, .3], 
dty³
=))

333 
max_ouut_size
 = 30

334 
iou_th»shŞd
 = 0.5

336 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([[0, 10, 1, 11], [0, 0, 1, 1], [0, 100, 1, 101]],

337 
dty³
=)

338 
nms_boxli¡
 = 
Å_box_li¡_İs
.
	$nÚ_max_suµ»ssiÚ
(

339 
boxli¡
, 
max_ouut_size
, 
iou_th»shŞd
)

340 
£lf
.
	`as£¹AÎClo£
(
nms_boxli¡
.
	`g‘
(), 
ex³ùed_boxes
)

342 
def
 
	$‹¡_£Ëù_äom_‹n_šd’tiÿl_boxes
(
£lf
):

343 
boxes
 = 
Å
.
	$¬¿y
(10 * [[0, 0, 1, 1]], 
dty³
=)

344 
boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
boxes
)

345 
boxli¡
.
	`add_f›ld
('scÜes', 
Å
.
	$¬¿y
(10 * [0.8]))

346 
iou_th»shŞd
 = .5

347 
max_ouut_size
 = 3

348 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([[0, 0, 1, 1]], 
dty³
=)

349 
nms_boxli¡
 = 
Å_box_li¡_İs
.
	$nÚ_max_suµ»ssiÚ
(

350 
boxli¡
, 
max_ouut_size
, 
iou_th»shŞd
)

351 
£lf
.
	`as£¹AÎClo£
(
nms_boxli¡
.
	`g‘
(), 
ex³ùed_boxes
)

353 
def
 
	$‹¡_difã»Á_iou_th»shŞd
(
£lf
):

354 
boxes
 = 
Å
.
	$¬¿y
([[0, 0, 20, 100], [0, 0, 20, 80], [200, 200, 210, 300],

356 
dty³
=)

357 
boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
boxes
)

358 
boxli¡
.
	`add_f›ld
('scÜes', 
Å
.
	$¬¿y
([0.9, 0.8, 0.7, 0.6]))

359 
max_ouut_size
 = 4

361 
iou_th»shŞd
 = .4

362 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([[0, 0, 20, 100],

364 
dty³
=)

365 
nms_boxli¡
 = 
Å_box_li¡_İs
.
	$nÚ_max_suµ»ssiÚ
(

366 
boxli¡
, 
max_ouut_size
, 
iou_th»shŞd
)

367 
£lf
.
	`as£¹AÎClo£
(
nms_boxli¡
.
	`g‘
(), 
ex³ùed_boxes
)

369 
iou_th»shŞd
 = .5

370 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([[0, 0, 20, 100], [200, 200, 210, 300],

372 
dty³
=)

373 
nms_boxli¡
 = 
Å_box_li¡_İs
.
	$nÚ_max_suµ»ssiÚ
(

374 
boxli¡
, 
max_ouut_size
, 
iou_th»shŞd
)

375 
£lf
.
	`as£¹AÎClo£
(
nms_boxli¡
.
	`g‘
(), 
ex³ùed_boxes
)

377 
iou_th»shŞd
 = .8

378 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([[0, 0, 20, 100], [0, 0, 20, 80],

380 
dty³
=)

381 
nms_boxli¡
 = 
Å_box_li¡_İs
.
	$nÚ_max_suµ»ssiÚ
(

382 
boxli¡
, 
max_ouut_size
, 
iou_th»shŞd
)

383 
£lf
.
	`as£¹AÎClo£
(
nms_boxli¡
.
	`g‘
(), 
ex³ùed_boxes
)

385 
def
 
	$‹¡_muÉişass_nms
(
£lf
):

386 
boxli¡
 = 
Å_box_li¡
.
	`BoxLi¡
(

387 
Å
.
	$¬¿y
(

389 
dty³
=
Å
.
æßt32
))

390 
scÜes
 = 
Å
.
	`¬¿y
([[-0.2, 0.1, 0.5, -0.4, 0.3],

393 
dty³
=
Å
.
æßt32
)

394 
boxli¡
.
	`add_f›ld
('scÜes', 
scÜes
)

395 
boxli¡_ş—n
 = 
Å_box_li¡_İs
.
	$muÉi_şass_nÚ_max_suµ»ssiÚ
(

396 
boxli¡
, 
scÜe_th»sh
=0.25, 
iou_th»sh
=0.1, 
max_ouut_size
=3)

398 
scÜes_ş—n
 = 
boxli¡_ş—n
.
	`g‘_f›ld
('scores')

399 
şas£s_ş—n
 = 
boxli¡_ş—n
.
	`g‘_f›ld
('classes')

400 
boxes
 = 
boxli¡_ş—n
.
	$g‘
()

401 
ex³ùed_scÜes
 = 
Å
.
	$¬¿y
([0.7, 0.6, 0.34, 0.31])

402 
ex³ùed_şas£s
 = 
Å
.
	$¬¿y
([0, 2, 1, 4])

403 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([[0.4, 0.2, 0.8, 0.8],

407 
dty³
=
Å
.
æßt32
)

408 
£lf
.
	$as£¹AÎClo£
(
scÜes_ş—n
, 
ex³ùed_scÜes
)

409 
£lf
.
	$as£¹AÎClo£
(
şas£s_ş—n
, 
ex³ùed_şas£s
)

410 
£lf
.
	$as£¹AÎClo£
(
boxes
, 
ex³ùed_boxes
)

413 
__Çme__
 == '__main__':

414 
tf
.
‹¡
.
	`maš
()

	@utils/np_box_list_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
numpy
 
as
 
Å


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
Å_box_li¡


24 
şass
 
	$BoxLi¡Te¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$‹¡_šv®id_box_d©a
(
£lf
):

27 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

28 
Å_box_li¡
.
	$BoxLi¡
([0, 0, 1, 1])

30 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

31 
Å_box_li¡
.
	`BoxLi¡
(
Å
.
	$¬¿y
([[0, 0, 1, 1]], 
dty³
=))

33 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

34 
Å_box_li¡
.
	`BoxLi¡
(
Å
.
	$¬¿y
([0, 1, 1, 3, 4], 
dty³
=))

36 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

37 
Å_box_li¡
.
	`BoxLi¡
(
Å
.
	$¬¿y
([[0, 1, 1, 3], [3, 1, 1, 5]], 
dty³
=))

39 
def
 
	$‹¡_has_f›ld_w™h_exi¡ed_f›ld
(
£lf
):

40 
boxes
 = 
Å
.
	$¬¿y
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0],

42 
dty³
=)

43 
boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
boxes
)

44 
£lf
.
	`as£¹True
(
boxli¡
.
	`has_f›ld
('boxes'))

46 
def
 
	$‹¡_has_f›ld_w™h_nÚexi¡ed_f›ld
(
£lf
):

47 
boxes
 = 
Å
.
	$¬¿y
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0],

49 
dty³
=)

50 
boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
boxes
)

51 
£lf
.
	`as£¹F®£
(
boxli¡
.
	`has_f›ld
('scores'))

53 
def
 
	$‹¡_g‘_f›ld_w™h_exi¡ed_f›ld
(
£lf
):

54 
boxes
 = 
Å
.
	$¬¿y
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0],

56 
dty³
=)

57 
boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
boxes
)

58 
£lf
.
	`as£¹True
(
Å
.
	`®lşo£
(
boxli¡
.
	`g‘_f›ld
('boxes'), 
boxes
))

60 
def
 
	$‹¡_g‘_f›ld_w™h_nÚex™ed_f›ld
(
£lf
):

61 
boxes
 = 
Å
.
	$¬¿y
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0],

63 
dty³
=)

64 
boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
boxes
)

65 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

66 
boxli¡
.
	`g‘_f›ld
('scores')

69 
şass
 
	$AddExŒaF›ldTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

71 
def
 
	$£tUp
(
£lf
):

72 
boxes
 = 
Å
.
	$¬¿y
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0],

74 
dty³
=)

75 
£lf
.
boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
boxes
)

77 
def
 
	$‹¡_add_®»ady_exi¡ed_f›ld
(
£lf
):

78 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

79 
£lf
.
boxli¡
.
	`add_f›ld
('boxes', 
Å
.
	$¬¿y
([[0, 0, 0, 1, 0]], 
dty³
=))

81 
def
 
	$‹¡_add_šv®id_f›ld_d©a
(
£lf
):

82 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

83 
£lf
.
boxli¡
.
	`add_f›ld
('scÜes', 
Å
.
	$¬¿y
([0.5, 0.7], 
dty³
=))

84 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

85 
£lf
.
boxli¡
.
	`add_f›ld
('scores',

86 
Å
.
	$¬¿y
([0.5, 0.7, 0.9, 0.1], 
dty³
=))

88 
def
 
	$‹¡_add_sšgË_dim’siÚ®_f›ld_d©a
(
£lf
):

89 
boxli¡
 = 
£lf
.boxlist

90 
scÜes
 = 
Å
.
	$¬¿y
([0.5, 0.7, 0.9], 
dty³
=)

91 
boxli¡
.
	`add_f›ld
('scÜes', 
scÜes
)

92 
£lf
.
	`as£¹True
(
Å
.
	`®lşo£
(
scÜes
, s–f.
boxli¡
.
	`g‘_f›ld
('scores')))

94 
def
 
	$‹¡_add_muÉi_dim’siÚ®_f›ld_d©a
(
£lf
):

95 
boxli¡
 = 
£lf
.boxlist

96 
Ïb–s
 = 
Å
.
	$¬¿y
([[0, 0, 0, 1, 0], [0, 1, 0, 0, 0], [0, 0, 0, 0, 1]],

97 
dty³
=)

98 
boxli¡
.
	`add_f›ld
('Ïb–s', 
Ïb–s
)

99 
£lf
.
	`as£¹True
(
Å
.
	`®lşo£
(
Ïb–s
, s–f.
boxli¡
.
	`g‘_f›ld
('labels')))

101 
def
 
	$‹¡_g‘_exŒa_f›lds
(
£lf
):

102 
boxli¡
 = 
£lf
.boxlist

103 
£lf
.
	`as£¹SameEËm’ts
(
boxli¡
.
	`g‘_exŒa_f›lds
(), [])

105 
scÜes
 = 
Å
.
	$¬¿y
([0.5, 0.7, 0.9], 
dty³
=)

106 
boxli¡
.
	`add_f›ld
('scÜes', 
scÜes
)

107 
£lf
.
	`as£¹SameEËm’ts
(
boxli¡
.
	`g‘_exŒa_f›lds
(), ['scores'])

109 
Ïb–s
 = 
Å
.
	$¬¿y
([[0, 0, 0, 1, 0], [0, 1, 0, 0, 0], [0, 0, 0, 0, 1]],

110 
dty³
=)

111 
boxli¡
.
	`add_f›ld
('Ïb–s', 
Ïb–s
)

112 
£lf
.
	`as£¹SameEËm’ts
(
boxli¡
.
	`g‘_exŒa_f›lds
(), ['scores', 'labels'])

114 
def
 
	$‹¡_g‘_coÜdš©es
(
£lf
):

115 
y_mš
, 
x_mš
, 
y_max
, 
x_max
 = 
£lf
.
boxli¡
.
	$g‘_coÜdš©es
()

117 
ex³ùed_y_mš
 = 
Å
.
	$¬¿y
([3.0, 14.0, 0.0], 
dty³
=)

118 
ex³ùed_x_mš
 = 
Å
.
	$¬¿y
([4.0, 14.0, 0.0], 
dty³
=)

119 
ex³ùed_y_max
 = 
Å
.
	$¬¿y
([6.0, 15.0, 20.0], 
dty³
=)

120 
ex³ùed_x_max
 = 
Å
.
	$¬¿y
([8.0, 15.0, 20.0], 
dty³
=)

122 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
y_mš
, 
ex³ùed_y_mš
))

123 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
x_mš
, 
ex³ùed_x_mš
))

124 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
y_max
, 
ex³ùed_y_max
))

125 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
x_max
, 
ex³ùed_x_max
))

127 
def
 
	$‹¡_num_boxes
(
£lf
):

128 
boxes
 = 
Å
.
	$¬¿y
([[0., 0., 100., 100.], [10., 30., 50., 70.]], 
dty³
=)

129 
boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
boxes
)

130 
ex³ùed_num_boxes
 = 2

131 
£lf
.
	`as£¹Equ®s
(
boxli¡
.
	`num_boxes
(), 
ex³ùed_num_boxes
)

134 
__Çme__
 == '__main__':

135 
tf
.
‹¡
.
	`maš
()

	@utils/np_box_ops.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
Exam¶e
 
box
 
İ”©iÚs
 
th©
 
¬e
 
	gsuµÜ‹d
:

19 * 
A»as
: 
compu‹
 
boundšg
 
box
 
¬—s


20 * 
IOU
: 
·œwi£
 
š‹r£ùiÚ
-
ov”
-
scÜes


22 
impÜt
 
numpy
 
as
 
Å


25 
def
 
	$¬—
(
boxes
):

28 
Args
:

29 
boxes
: 
Numpy
 
¬¿y
 
w™h
 
sh­e
 [
N
, 4] 
hŞdšg
 N boxes

31 
R‘uºs
:

32 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
N
*1] 
»´e£Ášg
 
box
 
¬—s


34  (
boxes
[:, 2] - boxes[:, 0]) * (boxes[:, 3] - boxes[:, 1])

37 
def
 
	$š‹r£ùiÚ
(
boxes1
, 
boxes2
):

40 
Args
:

41 
boxes1
: 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
N
, 4] 
hŞdšg
 N 
boxes


42 
boxes2
: 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
M
, 4] 
hŞdšg
 M 
boxes


44 
R‘uºs
:

45 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
N
*
M
] 
»´e£Ášg
 
·œwi£
 
š‹r£ùiÚ
 
¬—


47 [
y_mš1
, 
x_mš1
, 
y_max1
, 
x_max1
] = 
Å
.
	`¥l™
(
boxes1
, 4, 
axis
=1)

48 [
y_mš2
, 
x_mš2
, 
y_max2
, 
x_max2
] = 
Å
.
	$¥l™
(
boxes2
, 4, 
axis
=1)

50 
®l_·œs_mš_ymax
 = 
Å
.
	`mšimum
(
y_max1
,‚p.
	$Œª¥o£
(
y_max2
))

51 
®l_·œs_max_ymš
 = 
Å
.
	`maximum
(
y_mš1
,‚p.
	$Œª¥o£
(
y_mš2
))

52 
š‹r£ù_heights
 = 
Å
.
	`maximum
(

53 
Å
.
	`z”os
(
®l_·œs_max_ymš
.
sh­e
),

54 
®l_·œs_mš_ymax
 - 
®l_·œs_max_ymš
)

55 
®l_·œs_mš_xmax
 = 
Å
.
	`mšimum
(
x_max1
,‚p.
	$Œª¥o£
(
x_max2
))

56 
®l_·œs_max_xmš
 = 
Å
.
	`maximum
(
x_mš1
,‚p.
	$Œª¥o£
(
x_mš2
))

57 
š‹r£ù_widths
 = 
Å
.
	`maximum
(

58 
Å
.
	`z”os
(
®l_·œs_max_xmš
.
sh­e
),

59 
®l_·œs_mš_xmax
 - 
®l_·œs_max_xmš
)

60  
š‹r£ù_heights
 * 
š‹r£ù_widths


63 
def
 
	$iou
(
boxes1
, 
boxes2
):

66 
Args
:

67 
boxes1
: 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
N
, 4] 
hŞdšg
 N 
boxes
.

68 
boxes2
: 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
M
, 4] 
hŞdšg
 
N
 
boxes
.

70 
R‘uºs
:

71 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
N
, 
M
] 
»´e£Ášg
 
·œwi£
 
iou
 
scÜes
.

73 
š‹r£ù
 = 
	$š‹r£ùiÚ
(
boxes1
, 
boxes2
)

74 
¬—1
 = 
	$¬—
(
boxes1
)

75 
¬—2
 = 
	$¬—
(
boxes2
)

76 ğ
Å
.
	`ex·nd_dims
(
¬—1
, 
axis
=1) +‚p.expand_dims(

77 
¬—2
, 
axis
=0è- 
š‹r£ù


78  
š‹r£ù
 / 

81 
def
 
	$iß
(
boxes1
, 
boxes2
):

84 
IÁ”£ùiÚ
-
ov”
-
	$¬—
 (
iß
è
b‘w“n
 
two
 
boxes
 
box1
 
ªd
 
box2
 
is
 
defšed
 
as


85 
theœ
 
š‹r£ùiÚ
 
¬—
 
ov”
 
box2
's‡rea. Notehat ioa is‚ot symmetric,

86 
th©
 
is
, 
	`IOA
(
box1
, 
box2
) != IOA(box2, box1).

88 
Args
:

89 
boxes1
: 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
N
, 4] 
hŞdšg
 N 
boxes
.

90 
boxes2
: 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
M
, 4] 
hŞdšg
 
N
 
boxes
.

92 
R‘uºs
:

93 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
N
, 
M
] 
»´e£Ášg
 
·œwi£
 
iß
 
scÜes
.

95 
š‹r£ù
 = 
	$š‹r£ùiÚ
(
boxes1
, 
boxes2
)

96 
¬—s
 = 
Å
.
	`ex·nd_dims
(
	`¬—
(
boxes2
), 
axis
=0)

97  
š‹r£ù
 / 
¬—s


	@utils/np_box_ops_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
numpy
 
as
 
Å


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
Å_box_İs


24 
şass
 
	$BoxOpsTe¡s
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$£tUp
(
£lf
):

27 
boxes1
 = 
Å
.
	$¬¿y
([[4.0, 3.0, 7.0, 5.0], [5.0, 6.0, 10.0, 7.0]],

28 
dty³
=)

29 
boxes2
 = 
Å
.
	$¬¿y
([[3.0, 4.0, 6.0, 8.0], [14.0, 14.0, 15.0, 15.0],

31 
dty³
=)

32 
£lf
.
boxes1
 = boxes1

33 
£lf
.
boxes2
 = boxes2

35 
def
 
	$‹¡A»a
(
£lf
):

36 
¬—s
 = 
Å_box_İs
.
	$¬—
(
£lf
.
boxes1
)

37 
ex³ùed_¬—s
 = 
Å
.
	$¬¿y
([6.0, 5.0], 
dty³
=)

38 
£lf
.
	$as£¹AÎClo£
(
ex³ùed_¬—s
, 
¬—s
)

40 
def
 
	$‹¡IÁ”£ùiÚ
(
£lf
):

41 
š‹r£ùiÚ
 = 
Å_box_İs
.
	$š‹r£ùiÚ
(
£lf
.
boxes1
, s–f.
boxes2
)

42 
ex³ùed_š‹r£ùiÚ
 = 
Å
.
	$¬¿y
([[2.0, 0.0, 6.0], [1.0, 0.0, 5.0]],

43 
dty³
=)

44 
£lf
.
	$as£¹AÎClo£
(
š‹r£ùiÚ
, 
ex³ùed_š‹r£ùiÚ
)

46 
def
 
	$‹¡IOU
(
£lf
):

47 
iou
 = 
Å_box_İs
.
	$iou
(
£lf
.
boxes1
, s–f.
boxes2
)

48 
ex³ùed_iou
 = 
Å
.
	`¬¿y
([[2.0 / 16.0, 0.0, 6.0 / 400.0],

50 
dty³
=)

51 
£lf
.
	$as£¹AÎClo£
(
iou
, 
ex³ùed_iou
)

53 
def
 
	$‹¡IOA
(
£lf
):

54 
boxes1
 = 
Å
.
	$¬¿y
([[0.25, 0.25, 0.75, 0.75],

56 
dty³
=
Å
.
æßt32
)

57 
boxes2
 = 
Å
.
	$¬¿y
([[0.5, 0.25, 1.0, 1.0],

59 
dty³
=
Å
.
æßt32
)

60 
iß21
 = 
Å_box_İs
.
	$iß
(
boxes2
, 
boxes1
)

61 
ex³ùed_iß21
 = 
Å
.
	$¬¿y
([[0.5, 0.0],

63 
dty³
=
Å
.
æßt32
)

64 
£lf
.
	$as£¹AÎClo£
(
iß21
, 
ex³ùed_iß21
)

67 
__Çme__
 == '__main__':

68 
tf
.
‹¡
.
	`maš
()

	@utils/object_detection_evaluation.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
ObjeùD‘eùiÚEv®u©iÚ
 
is
 
a
 
şass
 
which
 
mªages
 
ground
 
Œuth
 
šfÜm©iÚ
 
of
‡

19 
objeù
 
d‘eùiÚ
 
	gd©a£t
, 
ªd
 
compu‹s
 
äequ’y
 
u£d
 d‘eùiÚ 
m‘rics
 
such
 
as


20 
	gP»cisiÚ
, 
	gReÿÎ
, 
CÜLoc
 
of
 
the
 
´ovided
 
d‘eùiÚ
 
	g»suÉs
.

21 
It
 
suµÜts
 
the
 
fŞlowšg
 
	gİ”©iÚs
:

22 1è
Add
 
ground
 
Œuth
 
šfÜm©iÚ
 
of
 
images
 
£qu’tŸÎy
.

23 2è
Add
 
d‘eùiÚ
 
»suÉ
 
of
 
images
 
£qu’tŸÎy
.

24 3è
Ev®u©e
 
d‘eùiÚ
 
m‘rics
 
Ú
 
®»ady
 
š£¹ed
 d‘eùiÚ 
»suÉs
.

25 4è
Wr™e
 
ev®u©iÚ
 
»suÉ
 
što
 
a
 
pickË
 
fe
 
futu»
 
´oûssšg
 
Ü


26 
visu®iz©iÚ
.

28 
NÙe
: 
This
 
moduË
 
İ”©es
 
Ú
 
numpy
 
boxes
 
ªd
 
box
 
li¡s
.

31 
impÜt
 
loggšg


32 
impÜt
 
numpy
 
as
 
Å


34 
äom
 
objeù_d‘eùiÚ
.
uts
 
impÜt
 
m‘rics


35 
äom
 
objeù_d‘eùiÚ
.
uts
 
impÜt
 
³r_image_ev®u©iÚ


38 
şass
 
	$ObjeùD‘eùiÚEv®u©iÚ
(
objeù
):

41 
def
 
	$__š™__
(
£lf
,

42 
num_groundŒuth_şas£s
,

43 
m©chšg_iou_th»shŞd
=0.5,

44 
nms_iou_th»shŞd
=1.0,

45 
nms_max_ouut_boxes
=10000):

46 
£lf
.
³r_image_ev®
 = 
³r_image_ev®u©iÚ
.
	$P”ImageEv®u©iÚ
(

47 
num_groundŒuth_şas£s
, 
m©chšg_iou_th»shŞd
, 
nms_iou_th»shŞd
,

48 
nms_max_ouut_boxes
)

49 
£lf
.
num_şass
 = 
num_groundŒuth_şas£s


51 
£lf
.
groundŒuth_boxes
 = {
	}
}

52 
£lf
.
groundŒuth_şass_Ïb–s
 = {}

53 
£lf
.
groundŒuth_is_difficuÉ_li¡
 = {}

54 
£lf
.
num_gt_š¡ªûs_³r_şass
 = 
Å
.
	$z”os
(
£lf
.
num_şass
, 
dty³
=)

55 
£lf
.
num_gt_imgs_³r_şass
 = 
Å
.
	$z”os
(
£lf
.
num_şass
, 
dty³
=)

57 
£lf
.
d‘eùiÚ_keys
 = 
	$£t
()

58 
£lf
.
scÜes_³r_şass
 = [[] 
_
 
š
 
	`¿nge
(£lf.
num_şass
)]

59 
£lf
.
_å_Ïb–s_³r_şass
 = [[] 
_
 
š
 
	`¿nge
(£lf.
num_şass
)]

60 
£lf
.
num_images_cÜ»ùly_d‘eùed_³r_şass
 = 
Å
.
	$z”os
(
£lf
.
num_şass
)

61 
£lf
.
av”age_´ecisiÚ_³r_şass
 = 
Å
.
	$em±y
(
£lf
.
num_şass
, 
dty³
=)

62 
£lf
.
av”age_´ecisiÚ_³r_şass
.
	$fl
(
Å
.
Çn
)

63 
£lf
.
´ecisiÚs_³r_şass
 = []

64 
£lf
.
»ÿÎs_³r_şass
 = []

65 
£lf
.
cÜloc_³r_şass
 = 
Å
.
	$Úes
(
£lf
.
num_şass
, 
dty³
=)

67 
def
 
	$ş—r_d‘eùiÚs
(
£lf
):

68 
£lf
.
d‘eùiÚ_keys
 = {
	}
}

69 
£lf
.
scÜes_³r_şass
 = [[] 
_
 
š
 
¿nge
(£lf.
num_şass
)]

70 
£lf
.
_å_Ïb–s_³r_şass
 = [[] 
_
 
š
 
¿nge
(£lf.
num_şass
)]

71 
£lf
.
num_images_cÜ»ùly_d‘eùed_³r_şass
 = 
Å
.
	$z”os
(
£lf
.
num_şass
)

72 
£lf
.
av”age_´ecisiÚ_³r_şass
 = 
Å
.
	$z”os
(
£lf
.
num_şass
, 
dty³
=)

73 
£lf
.
´ecisiÚs_³r_şass
 = []

74 
£lf
.
»ÿÎs_³r_şass
 = []

75 
£lf
.
cÜloc_³r_şass
 = 
Å
.
	$Úes
(
£lf
.
num_şass
, 
dty³
=)

77 
def
 
	$add_sšgË_ground_Œuth_image_šfo
(
£lf
,

78 
image_key
,

79 
groundŒuth_boxes
,

80 
groundŒuth_şass_Ïb–s
,

81 
groundŒuth_is_difficuÉ_li¡
=
NÚe
):

84 
Args
:

85 
image_key
: 
sha256
 
key
 
of
 
image
 
cÚ‹Á


86 
groundŒuth_boxes
: 
A
 
numpy
 
¬¿y
 
of
 
sh­e
 [
M
, 4] 
»´e£Ášg
 
objeù
 
box


87 
coÜdš©es
[
y_mš
, 
x_mš
, 
y_max
, 
x_max
]

88 
groundŒuth_şass_Ïb–s
: 
A
 1-
d
 
numpy
 
¬¿y
 
of
 
Ëngth
 
M
 
»´e£Ášg
 
şass


89 
Ïb–s


90 
groundŒuth_is_difficuÉ_li¡
: 
A
 
Ëngth
 
M
 
numpy
 
boŞ—n
 
¬¿y
 
d’Ùšg


91 
wh‘h”
 
a
 
ground
 
Œuth
 
box
 
is
‡ 
difficuÉ
 
š¡ªû
 
Ü
 
nÙ
. 
To
 
suµÜt


92 
the
 
th©
 
no
 
boxes
 
¬e
 
difficuÉ
, 
™
 
is
 
by
  
£t
 
as
 
NÚe
.

94 
image_key
 
š
 
£lf
.
groundŒuth_boxes
:

95 
loggšg
.
	`w¬n
(

97 
image_key
)

100 
£lf
.
groundŒuth_boxes
[
image_key
] = groundtruth_boxes

101 
£lf
.
groundŒuth_şass_Ïb–s
[
image_key
] = groundtruth_class_labels

102 
groundŒuth_is_difficuÉ_li¡
 
is
 
NÚe
:

103 
num_boxes
 = 
groundŒuth_boxes
.
sh­e
[0]

104 
groundŒuth_is_difficuÉ_li¡
 = 
Å
.
	$z”os
(
num_boxes
, 
dty³
=
boŞ
)

105 
£lf
.
groundŒuth_is_difficuÉ_li¡
[

106 
image_key
] = 
groundŒuth_is_difficuÉ_li¡
.
	$a¡y³
(
dty³
=
boŞ
)

107 
£lf
.
	$_upd©e_ground_Œuth_¡©i¡ics
(
groundŒuth_şass_Ïb–s
,

108 
groundŒuth_is_difficuÉ_li¡
)

110 
def
 
	$add_sšgË_d‘eùed_image_šfo
(
£lf
, 
image_key
, 
d‘eùed_boxes
,

111 
d‘eùed_scÜes
, 
d‘eùed_şass_Ïb–s
):

114 
Args
:

115 
image_key
: 
sha256
 
key
 
of
 
image
 
cÚ‹Á


116 
d‘eùed_boxes
: 
A
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 4] 
»´e£Ášg
 
d‘eùed
 
box


117 
coÜdš©es
[
y_mš
, 
x_mš
, 
y_max
, 
x_max
]

118 
d‘eùed_scÜes
: 
A
 1-
d
 
numpy
 
¬¿y
 
of
 
Ëngth
 
N
 
»´e£Ášg
 
şassifiÿtiÚ


119 
scÜe


120 
d‘eùed_şass_Ïb–s
: 
A
 1-
d
 
numpy
 
¬¿y
 
of
 
Ëngth
 
N
 
»´e£Ášg
 
şass


121 
Ïb–s


122 
Rai£s
:

123 
V®ueE¼Ü
: 
d‘eùed_boxes
, 
d‘eùed_scÜes
 
ªd
 
d‘eùed_şass_Ïb–s


124 dØ
nÙ
 
have
 
the
 
§me
 
Ëngth
.

126 ià(
	`Ën
(
d‘eùed_boxes
è!ğ
	$Ën
(
d‘eùed_scÜes
è
Ü


127 
	`Ën
(
d‘eùed_boxes
è!ğ
	$Ën
(
d‘eùed_şass_Ïb–s
)):

128 
¿i£
 
	`V®ueE¼Ü
('detected_boxes, detected_scores‡nd '

130 '[%d, %d, %d]' % 
	`Ën
(
d‘eùed_boxes
),

131 
	`Ën
(
d‘eùed_scÜes
), 
	$Ën
(
d‘eùed_şass_Ïb–s
))

133 
image_key
 
š
 
£lf
.
d‘eùiÚ_keys
:

134 
loggšg
.
	`w¬n
(

136 
image_key
)

139 
£lf
.
d‘eùiÚ_keys
.
	$add
(
image_key
)

140 
image_key
 
š
 
£lf
.
groundŒuth_boxes
:

141 
groundŒuth_boxes
 = 
£lf
.groundŒuth_boxes[
image_key
]

142 
groundŒuth_şass_Ïb–s
 = 
£lf
.groundŒuth_şass_Ïb–s[
image_key
]

143 
groundŒuth_is_difficuÉ_li¡
 = 
£lf
.groundtruth_is_difficult_list[

144 
image_key
]

146 
groundŒuth_boxes
 = 
Å
.
	$em±y
(
sh­e
=[0, 4], 
dty³
=)

147 
groundŒuth_şass_Ïb–s
 = 
Å
.
	$¬¿y
([], 
dty³
=)

148 
groundŒuth_is_difficuÉ_li¡
 = 
Å
.
	$¬¿y
([], 
dty³
=
boŞ
)

149 
scÜes
, 
_å_Ïb–s
, 
is_şass_cÜ»ùly_d‘eùed_š_image
 = (

150 
£lf
.
³r_image_ev®
.
	$compu‹_objeù_d‘eùiÚ_m‘rics
(

151 
d‘eùed_boxes
, 
d‘eùed_scÜes
, 
d‘eùed_şass_Ïb–s
,

152 
groundŒuth_boxes
, 
groundŒuth_şass_Ïb–s
,

153 
groundŒuth_is_difficuÉ_li¡
))

154 
i
 
š
 
	$¿nge
(
£lf
.
num_şass
):

155 
£lf
.
scÜes_³r_şass
[
i
].
	$­³nd
(
scÜes
[
i
])

156 
£lf
.
_å_Ïb–s_³r_şass
[
i
].
	$­³nd
(
_å_Ïb–s
[
i
])

157 (
£lf
.
num_images_cÜ»ùly_d‘eùed_³r_şass


158 è+ğ
is_şass_cÜ»ùly_d‘eùed_š_image


160 
def
 
	$_upd©e_ground_Œuth_¡©i¡ics
(
£lf
, 
groundŒuth_şass_Ïb–s
,

161 
groundŒuth_is_difficuÉ_li¡
):

164 1. 
DifficuÉ
 
boxes
 
¬e
 
ignÜed
 
wh’
 
couÁšg
 
the
 
numb”
 
of
 
ground
 
Œuth


165 
š¡ªûs
 
as
 
dÚe
 
š
 
Pasÿl
 
VOC
 
devk™
.

166 2. 
DifficuÉ
 
boxes
 
¬e
 
Œ—‹d
 
as
 
nÜm®
 boxe 
wh’
 
computšg
 
CÜLoc
 
»Ï‹d


167 
¡©™i¡ics
.

169 
Args
:

170 
groundŒuth_şass_Ïb–s
: 
An
 
š‹g”
 
numpy
 
¬¿y
 
of
 
Ëngth
 
M
,

171 
»´e£Ášg
 
M
 
şass
 
Ïb–s
 
of
 
objeù
 
š¡ªûs
 
š
 
ground
 
Œuth


172 
groundŒuth_is_difficuÉ_li¡
: 
A
 
boŞ—n
 
numpy
 
¬¿y
 
of
 
Ëngth
 
M
 
d’Ùšg


173 
wh‘h”
 
a
 
ground
 
Œuth
 
box
 
is
‡ 
difficuÉ
 
š¡ªû
 
Ü
 
nÙ


175 
şass_šdex
 
š
 
	$¿nge
(
£lf
.
num_şass
):

176 
num_gt_š¡ªûs
 = 
Å
.
	`sum
(
groundŒuth_şass_Ïb–s
[

177 ~
groundŒuth_is_difficuÉ_li¡
] =ğ
şass_šdex
)

178 
£lf
.
num_gt_š¡ªûs_³r_şass
[
şass_šdex
] +ğ
num_gt_š¡ªûs


179 
Å
.
	$ªy
(
groundŒuth_şass_Ïb–s
 =ğ
şass_šdex
):

180 
£lf
.
num_gt_imgs_³r_şass
[
şass_šdex
] += 1

182 
def
 
	$ev®u©e
(
£lf
):

185 
R‘uºs
:

186 
av”age_´ecisiÚ_³r_şass
: 
numpy
 
¬¿y
 
of
 
av”age
 
´ecisiÚ
 

187 
—ch
 
şass
.

188 
m—n_­
: 
m—n
 
av”age
 
´ecisiÚ
 
of
 
®l
 
şas£s
, 
sÿÏr


189 
´ecisiÚs_³r_şass
: 
Li¡
 
of
 
´ecisiÚs
, 
—ch
 
´ecisiÚ
 
is
 
a
 
numpy


190 
¬¿y


191 
»ÿÎs_³r_şass
: 
Li¡
 
of
 
»ÿÎs
, 
—ch
 
»ÿÎ
 
is
 
a
 
numpy
 
¬¿y


192 
cÜloc_³r_şass
: 
numpy
 
¬¿y


193 
m—n_cÜloc
: 
M—n
 
CÜLoc
 
scÜe
 
—ch
 
şass
, 
sÿÏr


195 ià(
£lf
.
num_gt_š¡ªûs_³r_şass
 =ğ0).
	$ªy
():

196 
loggšg
.
	`w¬n
(

198 
Å
.
	`squ“ze
Òp.
	$¬gwh”e
(
£lf
.
num_gt_š¡ªûs_³r_şass
 == 0)))

199 
şass_šdex
 
š
 
	$¿nge
(
£lf
.
num_şass
):

200 
£lf
.
num_gt_š¡ªûs_³r_şass
[
şass_šdex
] == 0:

202 
scÜes
 = 
Å
.
	$cÚÿ‹Ç‹
(
£lf
.
scÜes_³r_şass
[
şass_šdex
])

203 
_å_Ïb–s
 = 
Å
.
	$cÚÿ‹Ç‹
(
£lf
.
_å_Ïb–s_³r_şass
[
şass_šdex
])

204 
´ecisiÚ
, 
»ÿÎ
 = 
m‘rics
.
	$compu‹_´ecisiÚ_»ÿÎ
(

205 
scÜes
, 
_å_Ïb–s
, 
£lf
.
num_gt_š¡ªûs_³r_şass
[
şass_šdex
])

206 
£lf
.
´ecisiÚs_³r_şass
.
	$­³nd
(
´ecisiÚ
)

207 
£lf
.
»ÿÎs_³r_şass
.
	$­³nd
(
»ÿÎ
)

208 
av”age_´ecisiÚ
 = 
m‘rics
.
	$compu‹_av”age_´ecisiÚ
(
´ecisiÚ
, 
»ÿÎ
)

209 
£lf
.
av”age_´ecisiÚ_³r_şass
[
şass_šdex
] = 
av”age_´ecisiÚ


211 
£lf
.
cÜloc_³r_şass
 = 
m‘rics
.
	$compu‹_cÜ_loc
(

212 
£lf
.
num_gt_imgs_³r_şass
,

213 
£lf
.
num_images_cÜ»ùly_d‘eùed_³r_şass
)

215 
m—n_­
 = 
Å
.
	$Çnm—n
(
£lf
.
av”age_´ecisiÚ_³r_şass
)

216 
m—n_cÜloc
 = 
Å
.
	$Çnm—n
(
£lf
.
cÜloc_³r_şass
)

217  (
£lf
.
av”age_´ecisiÚ_³r_şass
, 
m—n_­
,

218 
£lf
.
´ecisiÚs_³r_şass
, s–f.
»ÿÎs_³r_şass
,

219 
£lf
.
cÜloc_³r_şass
, 
m—n_cÜloc
)

221 
def
 
	$g‘_ev®_»suÉ
(
£lf
):

222  
	$Ev®ResuÉ
(
£lf
.
av”age_´ecisiÚ_³r_şass
,

223 
£lf
.
´ecisiÚs_³r_şass
, s–f.
»ÿÎs_³r_şass
,

224 
£lf
.
cÜloc_³r_şass
)

227 
şass
 
	$Ev®ResuÉ
(
objeù
):

229 
def
 
	$__š™__
(
£lf
, 
av”age_´ecisiÚs
, 
´ecisiÚs
, 
»ÿÎs
, 
®l_cÜloc
):

230 
£lf
.
´ecisiÚs
 =…recisions

231 
£lf
.
»ÿÎs
 =„ecalls

232 
£lf
.
®l_cÜloc
 =‡ll_corloc

233 
£lf
.
av”age_´ecisiÚs
 =‡verage_precisions

	@utils/object_detection_evaluation_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
numpy
 
as
 
Å


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
objeù_d‘eùiÚ_ev®u©iÚ


24 
şass
 
	$ObjeùD‘eùiÚEv®u©iÚTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$£tUp
(
£lf
):

27 
num_groundŒuth_şas£s
 = 3

28 
£lf
.
od_ev®
 = 
objeù_d‘eùiÚ_ev®u©iÚ
.
	$ObjeùD‘eùiÚEv®u©iÚ
(

29 
num_groundŒuth_şas£s
)

31 
image_key1
 = "img1"

32 
groundŒuth_boxes1
 = 
Å
.
	$¬¿y
([[0, 0, 1, 1], [0, 0, 2, 2], [0, 0, 3, 3]],

33 
dty³
=)

34 
groundŒuth_şass_Ïb–s1
 = 
Å
.
	$¬¿y
([0, 2, 0], 
dty³
=)

35 
£lf
.
od_ev®
.
	$add_sšgË_ground_Œuth_image_šfo
(

36 
image_key1
, 
groundŒuth_boxes1
, 
groundŒuth_şass_Ïb–s1
)

37 
image_key2
 = "img2"

38 
groundŒuth_boxes2
 = 
Å
.
	$¬¿y
([[10, 10, 11, 11], [500, 500, 510, 510],

39 [10, 10, 12, 12]], 
dty³
=)

40 
groundŒuth_şass_Ïb–s2
 = 
Å
.
	$¬¿y
([0, 0, 2], 
dty³
=)

41 
groundŒuth_is_difficuÉ_li¡2
 = 
Å
.
	$¬¿y
([
F®£
, 
True
, F®£], 
dty³
=
boŞ
)

42 
£lf
.
od_ev®
.
	$add_sšgË_ground_Œuth_image_šfo
(

43 
image_key2
, 
groundŒuth_boxes2
, 
groundŒuth_şass_Ïb–s2
,

44 
groundŒuth_is_difficuÉ_li¡2
)

45 
image_key3
 = "img3"

46 
groundŒuth_boxes3
 = 
Å
.
	$¬¿y
([[0, 0, 1, 1]], 
dty³
=)

47 
groundŒuth_şass_Ïb–s3
 = 
Å
.
	$¬¿y
([1], 
dty³
=)

48 
£lf
.
od_ev®
.
	$add_sšgË_ground_Œuth_image_šfo
(

49 
image_key3
, 
groundŒuth_boxes3
, 
groundŒuth_şass_Ïb–s3
)

51 
image_key
 = "img2"

52 
d‘eùed_boxes
 = 
Å
.
	$¬¿y
(

54 
dty³
=)

55 
d‘eùed_şass_Ïb–s
 = 
Å
.
	$¬¿y
([0, 0, 2], 
dty³
=)

56 
d‘eùed_scÜes
 = 
Å
.
	$¬¿y
([0.7, 0.8, 0.9], 
dty³
=)

57 
£lf
.
od_ev®
.
	$add_sšgË_d‘eùed_image_šfo
(

58 
image_key
, 
d‘eùed_boxes
, 
d‘eùed_scÜes
, 
d‘eùed_şass_Ïb–s
)

60 
def
 
	$‹¡_add_sšgË_ground_Œuth_image_šfo
(
£lf
):

61 
ex³ùed_num_gt_š¡ªûs_³r_şass
 = 
Å
.
	$¬¿y
([3, 1, 2], 
dty³
=)

62 
ex³ùed_num_gt_imgs_³r_şass
 = 
Å
.
	$¬¿y
([2, 1, 2], 
dty³
=)

63 
£lf
.
	`as£¹True
(
Å
.
	$¬¿y_equ®
(
ex³ùed_num_gt_š¡ªûs_³r_şass
,

64 
£lf
.
od_ev®
.
num_gt_š¡ªûs_³r_şass
))

65 
£lf
.
	`as£¹True
(
Å
.
	$¬¿y_equ®
(
ex³ùed_num_gt_imgs_³r_şass
,

66 
£lf
.
od_ev®
.
num_gt_imgs_³r_şass
))

67 
groundŒuth_boxes2
 = 
Å
.
	$¬¿y
([[10, 10, 11, 11], [500, 500, 510, 510],

68 [10, 10, 12, 12]], 
dty³
=)

69 
£lf
.
	`as£¹True
(
Å
.
	`®lşo£
(£lf.
od_ev®
.
groundŒuth_boxes
["img2"],

70 
groundŒuth_boxes2
))

71 
groundŒuth_is_difficuÉ_li¡2
 = 
Å
.
	$¬¿y
([
F®£
, 
True
, F®£], 
dty³
=
boŞ
)

72 
£lf
.
	`as£¹True
(
Å
.
	`®lşo£
(

73 
£lf
.
od_ev®
.
groundŒuth_is_difficuÉ_li¡
["img2"],

74 
groundŒuth_is_difficuÉ_li¡2
))

75 
groundŒuth_şass_Ïb–s1
 = 
Å
.
	$¬¿y
([0, 2, 0], 
dty³
=)

76 
£lf
.
	`as£¹True
(
Å
.
	`¬¿y_equ®
(£lf.
od_ev®
.
groundŒuth_şass_Ïb–s
[

77 "img1"], 
groundŒuth_şass_Ïb–s1
))

79 
def
 
	$‹¡_add_sšgË_d‘eùed_image_šfo
(
£lf
):

80 
ex³ùed_scÜes_³r_şass
 = [[
Å
.
	`¬¿y
([0.8, 0.7], 
dty³
=)], [],

81 [
Å
.
	`¬¿y
([0.9], 
dty³
=)]]

82 
ex³ùed__å_Ïb–s_³r_şass
 = [[
Å
.
	`¬¿y
([0, 1], 
dty³
=
boŞ
)], [],

83 [
Å
.
	`¬¿y
([0], 
dty³
=
boŞ
)]]

84 
ex³ùed_num_images_cÜ»ùly_d‘eùed_³r_şass
 = 
Å
.
	$¬¿y
([0, 0, 0],

85 
dty³
=)

86 
i
 
š
 
	$¿nge
(
£lf
.
od_ev®
.
num_şass
):

87 
j
 
š
 
	`¿nge
(
	$Ën
(
ex³ùed_scÜes_³r_şass
[
i
])):

88 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
ex³ùed_scÜes_³r_şass
[
i
][
j
],

89 
£lf
.
od_ev®
.
scÜes_³r_şass
[
i
][
j
]))

90 
£lf
.
	`as£¹True
(
Å
.
	$¬¿y_equ®
(
ex³ùed__å_Ïb–s_³r_şass
[
i
][

91 
j
], 
£lf
.
od_ev®
.
_å_Ïb–s_³r_şass
[
i
][j]))

92 
£lf
.
	`as£¹True
(
Å
.
	$¬¿y_equ®
(

93 
ex³ùed_num_images_cÜ»ùly_d‘eùed_³r_şass
,

94 
£lf
.
od_ev®
.
num_images_cÜ»ùly_d‘eùed_³r_şass
))

96 
def
 
	$‹¡_ev®u©e
(
£lf
):

97 (
av”age_´ecisiÚ_³r_şass
, 
m—n_­
, 
´ecisiÚs_³r_şass
,

98 
»ÿÎs_³r_şass
, 
cÜloc_³r_şass
,

99 
m—n_cÜloc
èğ
£lf
.
od_ev®
.
	$ev®u©e
()

100 
ex³ùed_´ecisiÚs_³r_şass
 = [
Å
.
	`¬¿y
([0, 0.5], 
dty³
=),

101 
Å
.
	`¬¿y
([], 
dty³
=),

102 
Å
.
	`¬¿y
([0], 
dty³
=)]

103 
ex³ùed_»ÿÎs_³r_şass
 = [

104 
Å
.
	`¬¿y
([0, 1. / 3.], 
dty³
=),‚p.array([], dtype=),

105 
Å
.
	`¬¿y
([0], 
dty³
=)

107 
ex³ùed_av”age_´ecisiÚ_³r_şass
 = 
Å
.
	`¬¿y
([1. / 6., 0, 0],

108 
dty³
=)

109 
ex³ùed_cÜloc_³r_şass
 = 
Å
.
	`¬¿y
([0,‚p.
	`divide
(0, 0), 0], 
dty³
=)

110 
ex³ùed_m—n_­
 = 1. / 18

111 
ex³ùed_m—n_cÜloc
 = 0.0

112 
i
 
š
 
	$¿nge
(
£lf
.
od_ev®
.
num_şass
):

113 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
ex³ùed_´ecisiÚs_³r_şass
[
i
],

114 
´ecisiÚs_³r_şass
[
i
]))

115 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
ex³ùed_»ÿÎs_³r_şass
[
i
],

116 
»ÿÎs_³r_şass
[
i
]))

117 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
ex³ùed_av”age_´ecisiÚ_³r_şass
,

118 
av”age_´ecisiÚ_³r_şass
))

119 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
ex³ùed_cÜloc_³r_şass
, 
cÜloc_³r_şass
))

120 
£lf
.
	$as£¹Almo¡Equ®
(
ex³ùed_m—n_­
, 
m—n_­
)

121 
£lf
.
	$as£¹Almo¡Equ®
(
ex³ùed_m—n_cÜloc
, 
m—n_cÜloc
)

124 
__Çme__
 == "__main__":

125 
tf
.
‹¡
.
	`maš
()

	@utils/ops.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
m©h


18 
impÜt
 
six


20 
impÜt
 
‹nsÜæow
 
as
 
tf


22 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


23 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡_İs


24 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
¡ªd¬d_f›lds
 
as
 
f›lds


25 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
¡©ic_sh­e


28 
def
 
	$ex·nded_sh­e
(
Üig_sh­e
, 
¡¬t_dim
, 
num_dims
):

31 
In£¹s
 
ª
 
®l
-1 
veùÜ
 
of
 
Ëngth
 
num_dims
 
©
 
pos™iÚ
 
¡¬t_dim
 
što
 
a
 
sh­e
.

32 
Cª
 
be
 
combšed
 
w™h
 
tf
.
»sh­e
 
to
 
g’”®ize
f.
ex·nd_dims
.

34 
Args
:

35 
Üig_sh­e
: 
the
 
sh­e
 
što
 
which
h
®l
-1 
veùÜ
 
is
 
	$added
 (
št32
 
veùÜ
)

36 
¡¬t_dim
: 
š£¹iÚ
 
	$pos™iÚ
 (
sÿÏr
)

37 
num_dims
: 
Ëngth
 
of
 
the
 
š£¹ed
 
®l
-1 
	$veùÜ
 (
sÿÏr
)

38 
R‘uºs
:

39 
An
 
št32
 
veùÜ
 
of
 
Ëngth
 
tf
.
	`size
(
Üig_sh­e
è+ 
num_dims
.

41 
w™h
 
tf
.
	`Çme_scİe
('ExpandedShape'):

42 
¡¬t_dim
 = 
tf
.
	$ex·nd_dims
(
¡¬t_dim
, 0è#sÿÏ¸
to
 
¿nk
-1

43 
befÜe
 = 
tf
.
	$¦iû
(
Üig_sh­e
, [0], 
¡¬t_dim
)

44 
add_sh­e
 = 
tf
.
	`Úes
Ñf.
	`»sh­e
(
num_dims
, [1]), 
dty³
ñf.
št32
)

45 
aá”
 = 
tf
.
	`¦iû
(
Üig_sh­e
, 
¡¬t_dim
, [-1])

46 
Ãw_sh­e
 = 
tf
.
	$cÚÿt
([
befÜe
, 
add_sh­e
, 
aá”
], 0)

47  
Ãw_sh­e


50 
def
 
	$nÜm®ized_to_image_coÜdš©es
(
nÜm®ized_boxes
, 
image_sh­e
,

51 
·¿Î–_™”©iÚs
=32):

54 
Args
:

55 
nÜm®ized_boxes
: 
a
 
æßt32
 
‹nsÜ
 
of
 
sh­e
 [
NÚe
, 
num_boxes
, 4] 
š


56 
nÜm®ized
 
coÜdš©es
.

57 
image_sh­e
: 
a
 
æßt32
 
‹nsÜ
 
of
 
sh­e
 [4] 
cÚššg
 
the
 
image
 shape.

58 
·¿Î–_™”©iÚs
: 
·¿Î–ism
 
the
 
m­_â
 
İ
.

60 
R‘uºs
:

61 
absŞu‹_boxes
: 
a
 
æßt32
 
‹nsÜ
 
of
 
sh­e
 [
NÚe
, 
num_boxes
, 4] 
cÚšg
 
the


62 
boxes
 
š
 
image
 
coÜdš©es
.

64 
def
 
	$_to_absŞu‹_coÜdš©es
(
nÜm®ized_boxes
):

65  
box_li¡_İs
.
	`to_absŞu‹_coÜdš©es
(

66 
box_li¡
.
	`BoxLi¡
(
nÜm®ized_boxes
),

67 
image_sh­e
[1], image_sh­e[2], 
check_¿nge
=
F®£
).
	$g‘
()

69 
absŞu‹_boxes
 = 
tf
.
	`m­_â
(

70 
_to_absŞu‹_coÜdš©es
,

71 
–ems
=(
nÜm®ized_boxes
),

72 
dty³
=
tf
.
æßt32
,

73 
·¿Î–_™”©iÚs
=parallel_iterations,

74 
back_´İ
=
True
)

75  
absŞu‹_boxes


78 
def
 
	$meshgrid
(
x
, 
y
):

81 
MuÉidim’siÚ®
 
ª®og
 
of
 
numpy
.
meshgrid
, 
givšg
 
the
 
§me
 
behaviÜ
 
x
 
ªd
 
y


82 
¬e
 
veùÜs
. 
G’”®ly
, 
this
 
wl
 
give
:

84 
	`xgrid
(
i1
, ..., 
i_m
, 
j_1
, ..., 
j_n
èğ
	$x
(
j_1
, ..., 
j_n
)

85 
	`ygrid
(
i1
, ..., 
i_m
, 
j_1
, ..., 
j_n
èğ
	$y
(
i_1
, ..., 
i_m
)

87 
K“p
 
š
 
mšd
 
th©
 
the
 
Üd”
 
of
h
¬gum’ts
 
ªd
 
ouuts
 
is
 
»v”£
 
»Ïtive


88 
to
 
the
 
Üd”
 
of
h
šdiûs
 
they
 
go
 
što
, 
dÚe
 
com·tib™y
 
w™h
 
numpy
.

89 
The
 
ouut
 
‹nsÜs
 
have
 
the
 
§me
 
sh­es
. 
S³cifiÿÎy
:

91 
xgrid
.
	`g‘_sh­e
(èğ
y
.g‘_sh­e().
	`cÚÿ‹Ç‹
(
x
.
	$g‘_sh­e
())

92 
ygrid
.
	`g‘_sh­e
(èğ
y
.g‘_sh­e().
	`cÚÿ‹Ç‹
(
x
.
	$g‘_sh­e
())

94 
Args
:

95 
x
: 
A
 
‹nsÜ
 
of
 
¬b™¿ry
 
sh­e
 
ªd
 
¿nk
. 
xgrid
 
wl
 
cÚš
 
the£
 
v®ues


96 
v¬yšg
 
š
 
™s
 
Ï¡
 
dim’siÚs
.

97 
y
: 
A
 
‹nsÜ
 
of
 
¬b™¿ry
 
sh­e
 
ªd
 
¿nk
. 
ygrid
 
wl
 
cÚš
 
the£
 
v®ues


98 
v¬yšg
 
š
 
™s
 
fœ¡
 
dim’siÚs
.

99 
R‘uºs
:

100 
A
 
tu¶e
 
of
 
	`‹nsÜs
 (
xgrid
, 
ygrid
).

102 
w™h
 
tf
.
	`Çme_scİe
('Meshgrid'):

103 
x
 = 
tf
.
	$cÚv”t_to_‹nsÜ
(
x
)

104 
y
 = 
tf
.
	$cÚv”t_to_‹nsÜ
(
y
)

105 
x_exp_sh­e
 = 
	`ex·nded_sh­e
(
tf
.
	`sh­e
(
x
), 0,f.
	$¿nk
(
y
))

106 
y_exp_sh­e
 = 
	`ex·nded_sh­e
(
tf
.
	`sh­e
(
y
),f.
	`¿nk
(y),f.
	$¿nk
(
x
))

108 
xgrid
 = 
tf
.
	`te
Ñf.
	`»sh­e
(
x
, 
x_exp_sh­e
), 
y_exp_sh­e
)

109 
ygrid
 = 
tf
.
	`te
Ñf.
	`»sh­e
(
y
, 
y_exp_sh­e
), 
x_exp_sh­e
)

110 
Ãw_sh­e
 = 
y
.
	`g‘_sh­e
().
	`cÚÿ‹Ç‹
(
x
.
	$g‘_sh­e
())

111 
xgrid
.
	$£t_sh­e
(
Ãw_sh­e
)

112 
ygrid
.
	$£t_sh­e
(
Ãw_sh­e
)

114  
xgrid
, 
ygrid


117 
def
 
	$·d_to_muÉË
(
‹nsÜ
, 
muÉË
):

120 
Aµ’ds
 0
s
 
to
 
the
 
’d
 
of
h
fœ¡
 
ªd
 
£cÚd
 
	$dim’siÚ
 (
height
 
ªd
 
width
è
of


121 
the
 
‹nsÜ
 
uÁ
 
bÙh
 
dim’siÚs
 
¬e
 
a
 
muÉË
 
of
h
šput
 
¬gum’t


122 'muÉË'. 
E
.
g
. 
giv’
 
ª
 
šput
 
‹nsÜ
 
of
 
sh­e
 [1, 3, 5, 1] 
ªd
‡n input

123 
muÉË
 
of
 4, 
PadToMuÉË
 
wl
 
­³nd
 0
s
 
so
 
th©
 
the
 
»suÉšg
 
‹nsÜ
 will

124 
be
 
of
 
sh­e
 [1, 4, 8, 1].

126 
Args
:

127 
‹nsÜ
: 
¿nk
 4 
æßt32
’sÜ, 
wh”e


128 
‹nsÜ
 -> [
b©ch_size
, 
height
, 
width
, 
chªÃls
].

129 
muÉË
: 
the
 muÉË 
to
 
·d
o.

131 
R‘uºs
:

132 
·dded_‹nsÜ
: 
the
 
‹nsÜ
 
z”o
 
·dded
 
to
h
¥ecif›d
 
muÉË
.

134 
‹nsÜ_sh­e
 = 
‹nsÜ
.
	$g‘_sh­e
()

135 
b©ch_size
 = 
¡©ic_sh­e
.
	$g‘_b©ch_size
(
‹nsÜ_sh­e
)

136 
‹nsÜ_height
 = 
¡©ic_sh­e
.
	$g‘_height
(
‹nsÜ_sh­e
)

137 
‹nsÜ_width
 = 
¡©ic_sh­e
.
	$g‘_width
(
‹nsÜ_sh­e
)

138 
‹nsÜ_d•th
 = 
¡©ic_sh­e
.
	$g‘_d•th
(
‹nsÜ_sh­e
)

140 
b©ch_size
 
is
 
NÚe
:

141 
b©ch_size
 = 
tf
.
	`sh­e
(
‹nsÜ
)[0]

143 
‹nsÜ_height
 
is
 
NÚe
:

144 
‹nsÜ_height
 = 
tf
.
	`sh­e
(
‹nsÜ
)[1]

145 
·dded_‹nsÜ_height
 = 
tf
.
	`to_št32
(

146 
tf
.
	`û
Ñf.
	`to_æßt
(
‹nsÜ_height
è/f.to_æßt(
muÉË
))) * multiple

148 
·dded_‹nsÜ_height
 = (

149 
m©h
.
	`û
((
‹nsÜ_height
è/ 
muÉË
) * multiple)

151 
‹nsÜ_width
 
is
 
NÚe
:

152 
‹nsÜ_width
 = 
tf
.
	`sh­e
(
‹nsÜ
)[2]

153 
·dded_‹nsÜ_width
 = 
tf
.
	`to_št32
(

154 
tf
.
	`û
Ñf.
	`to_æßt
(
‹nsÜ_width
è/f.to_æßt(
muÉË
))) * multiple

156 
·dded_‹nsÜ_width
 = (

157 
m©h
.
	`û
((
‹nsÜ_width
è/ 
muÉË
) * multiple)

159 
‹nsÜ_d•th
 
is
 
NÚe
:

160 
‹nsÜ_d•th
 = 
tf
.
	`sh­e
(
‹nsÜ
)[3]

162 #U£ 
tf
.
cÚÿt
 
š¡—d
 
of
f.
·d
 
to
 
´e£rve
 
sh­e


163 
height_·d
 = 
tf
.
	`z”os
([

164 
b©ch_size
, 
·dded_‹nsÜ_height
 - 
‹nsÜ_height
, 
‹nsÜ_width
,

165 
‹nsÜ_d•th


167 
·dded_‹nsÜ
 = 
tf
.
	$cÚÿt
([
‹nsÜ
, 
height_·d
], 1)

168 
width_·d
 = 
tf
.
	`z”os
([

169 
b©ch_size
, 
·dded_‹nsÜ_height
, 
·dded_‹nsÜ_width
 - 
‹nsÜ_width
,

170 
‹nsÜ_d•th


172 
·dded_‹nsÜ
 = 
tf
.
	$cÚÿt
([
·dded_‹nsÜ
, 
width_·d
], 2)

174  
·dded_‹nsÜ


177 
def
 
	$·dded_Úe_hÙ_’codšg
(
šdiûs
, 
d•th
, 
Ëá_·d
):

180 
This
 
funùiÚ
 
cÚv”ts
 
a
 
¥¬£
 
»´e£Á©iÚ
 
of
 
	$šdiûs
 (
e
.
g
., [4]è
to
 
a


181 
z”o
 
·dded
 
Úe
-
hÙ
 
	`»´e£Á©iÚ
 (
e
.
g
., [0, 0, 0, 0, 1] 
w™h
 
d•th
 = 4 
ªd


182 
Ëá_·d
 = 1). 
If
 `
šdiûs
` 
is
 
em±y
, 
the
 
»suÉ
 
wl
 
sim¶y
 
be
 
a
 
‹nsÜ
 
of


183 
	`sh­e
 (0, 
d•th
 + 
Ëá_·d
). 
If
 d•th = 0, 
th’
 
this
 
funùiÚ
 
ju¡
 
»tuºs


184 `
NÚe
`.

186 
Args
:

187 
šdiûs
: 
ª
 
š‹g”
 
‹nsÜ
 
of
 
sh­e
 [
num_šdiûs
].

188 
d•th
: d•th 
the
 
Úe
-
hÙ
 
	`‹nsÜ
 (
š‹g”
).

189 
Ëá_·d
: 
numb”
 
of
 
z”os
 
to
 
Ëá
 
·d
 
the
 
Úe
-
hÙ
 
‹nsÜ
 
	`w™h
 (
š‹g”
).

191 
R‘uºs
:

192 
·dded_ÚehÙ
: 
a
 
‹nsÜ
 
w™h
 
	`sh­e
 (
num_šdiûs
, 
d•th
 + 
Ëá_·d
). 
R‘uºs


193 `
NÚe
` 
the
 
d•th
 
is
 
z”o
.

195 
Rai£s
:

196 
V®ueE¼Ü
: `
šdiûs
` 
dÛs
 
nÙ
 
have
 
¿nk
 1 
Ü
 `
Ëá_·d
` o¸`
d•th
 
¬e


197 
e™h”
 
Ãg©ive
 
Ü
 
nÚ
-
š‹g”s
.

199 
TODO
: 
add
 
ruÁime
 
checks
 
d•th
 
ªd
 
šdiûs
.

201 
d•th
 < 0 
Ü
 
nÙ
 
	`isš¡ªû
(d•th, (, è
six
.
PY2
 ):

202 
¿i£
 
	`V®ueE¼Ü
('`depth` must be‡‚on-negative integer.')

203 
Ëá_·d
 < 0 
Ü
 
nÙ
 
	`isš¡ªû
Öeá_·d, (, è
six
.
PY2
 ):

204 
¿i£
 
	`V®ueE¼Ü
('`left_pad` must be‡‚on-negative integer.')

205 
d•th
 == 0:

206  
NÚe


207 
	`Ën
(
šdiûs
.
	`g‘_sh­e
().
	`as_li¡
()) != 1:

208 
¿i£
 
	`V®ueE¼Ü
('`indices` must have„ank 1')

210 
def
 
	$Úe_hÙ_ªd_·d
():

211 
Úe_hÙ
 = 
tf
.
	`ÿ¡
Ñf.
	`Úe_hÙ
Ñf.ÿ¡(
šdiûs
,f.
št64
), 
d•th
,

212 
Ú_v®ue
=1, 
off_v®ue
=0), 
tf
.
æßt32
)

213  
tf
.
	`·d
(
Úe_hÙ
, [[0, 0], [
Ëá_·d
, 0]], 
mode
='CONSTANT')

214 
»suÉ
 = 
tf
.
	`cÚd
Ñf.
	`g»©”
Ñf.
	`size
(
šdiûs
), 0), 
Úe_hÙ_ªd_·d
,

215 
Ïmbda
: 
tf
.
	`z”os
((
d•th
 + 
Ëá_·d
, 0)))

216  
tf
.
	`»sh­e
(
»suÉ
, [-1, 
d•th
 + 
Ëá_·d
])

219 
def
 
	$d’£_to_¥¬£_boxes
(
d’£_loÿtiÚs
, 
d’£_num_boxes
, 
num_şas£s
):

222 
Args
:

223 
d’£_loÿtiÚs
: 
a
 [
max_num_boxes
, 4] 
‹nsÜ
 
š
 
which
 
Úly
 
the
 
fœ¡
 
k
 
rows


224 
¬e
 
v®id
 
boundšg
 
box
 
loÿtiÚ
 
coÜdš©es
, 
wh”e
 
k
 
is
 
the
 
sum
 
of


225 
–em’ts
 
š
 
d’£_num_boxes
.

226 
d’£_num_boxes
: 
a
 [
max_num_şas£s
] 
‹nsÜ
 
šdiÿtšg
 
the
 
couÁs
 
of


227 
v¬ious
 
boundšg
 
box
 
şas£s
 
e
.
g
. [1, 0, 0, 2] 
m—ns
 
th©
 
the
 
fœ¡


228 
boundšg
 
box
 
is
 
of
 
şass
 0 
ªd
 
the
 
£cÚd
‡nd 
thœd
 boundšg 
boxes
 
¬e


229 
of
 
şass
 3. 
The
 
sum
 oà
–em’ts
 
š
 
this
 
‹nsÜ
 
is
 
the
 
numb”
 oà
v®id


230 
boundšg
 
boxes
.

231 
num_şas£s
: 
numb”
 
of
 
şas£s


233 
R‘uºs
:

234 
box_loÿtiÚs
: 
a
 [
num_boxes
, 4] 
‹nsÜ
 
cÚššg
 
Úly
 
v®id
 
boundšg


235 
	$boxes
 (
i
.
e
. 
the
 
fœ¡
 
num_boxes
 
rows
 
of
 
d’£_loÿtiÚs
)

236 
box_şas£s
: 
a
 [
num_boxes
] 
‹nsÜ
 
cÚššg
 
the
 
şas£s
 
of
 
—ch
 
boundšg


237 
	`box
 (
e
.
g
. 
d’£_num_boxes
 = [1, 0, 0, 2] => 
box_şas£s
 = [0, 3, 3]

240 
num_v®id_boxes
 = 
tf
.
	$»duû_sum
(
d’£_num_boxes
)

241 
box_loÿtiÚs
 = 
tf
.
	`¦iû
(
d’£_loÿtiÚs
,

242 
tf
.
	`cÚ¡ªt
([0, 0]),f.
	$¡ack
([
num_v®id_boxes
, 4]))

243 
ted_şas£s
 = [
tf
.
	`te
([
i
],f.
	$ex·nd_dims
(
d’£_num_boxes
[
i
], 0))

244 
i
 
š
 
	`¿nge
(
num_şas£s
)]

245 
box_şas£s
 = 
tf
.
	$cÚÿt
(
ted_şas£s
, 0)

246 
box_loÿtiÚs
.
	$£t_sh­e
([
NÚe
, 4])

247  
box_loÿtiÚs
, 
box_şas£s


250 
def
 
	$šdiûs_to_d’£_veùÜ
(
šdiûs
,

251 
size
,

252 
šdiûs_v®ue
=1.,

253 
deçuÉ_v®ue
=0,

254 
dty³
=
tf
.
æßt32
):

257 
This
 
funùiÚ
 
exi¡s
 
beÿu£
 
™
 
is
 
unş—r
 ™ i 
§ã
 
to
 
u£


258 
tf
.
	$¥¬£_to_d’£
(
šdiûs
, [
size
], 1, 
v®id©e_šdiûs
=
F®£
)

259 
w™h
 
šdiûs
 
which
 
¬e
 
nÙ
 
Üd”ed
.

260 
This
 
funùiÚ
 
acû±s
 
a
 
dyÇmic
 
	`size
 (
e
.
g
. 
tf
.
	`sh­e
(
‹nsÜ
)[0])

262 
Args
:

263 
šdiûs
: 1d 
T’sÜ
 
w™h
 
š‹g”
 indiû 
which
 
¬e
 
to
 
be
 
£t
o

264 
šdiûs_v®ues
.

265 
size
: 
sÿÏr
 
w™h
 
	$size
 (
š‹g”
è
of
 
ouut
 
T’sÜ
.

266 
šdiûs_v®ue
: 
v®ues
 
of
 
–em’ts
 
¥ecif›d
 
by
 
šdiûs
 
š
 
the
 
ouut
 
veùÜ


267 
deçuÉ_v®ue
: 
v®ues
 
of
 
Ùh”
 
–em’ts
 
š
 
the
 
ouut
 
veùÜ
.

268 
dty³
: 
d©a
 
ty³
.

270 
R‘uºs
:

271 
d’£
 1D 
T’sÜ
 
of
 
sh­e
 [
size
] 
w™h
 
šdiûs
 
£t
 
to
 
šdiûs_v®ues
 
ªd
 
the


272 
»¡
 
£t
 
to
 
deçuÉ_v®ue
.

274 
size
 = 
tf
.
	$to_št32
(
size
)

275 
z”os
 = 
tf
.
	`Úes
([
size
], 
dty³
=dty³è* 
deçuÉ_v®ue


276 
v®ues
 = 
tf
.
	`Úes_like
(
šdiûs
, 
dty³
=dty³è* 
šdiûs_v®ue


278  
tf
.
	`dyÇmic_¡™ch
([tf.
	`¿nge
(
size
),f.
	`to_št32
(
šdiûs
)],

279 [
z”os
, 
v®ues
])

282 
def
 
	$»š_groundŒuth
(
‹nsÜ_diù
, 
v®id_šdiûs
):

285 
Args
:

286 
‹nsÜ_diù
: 
a
 
diùiÚ¬y
 
of
 
fŞlowšg
 
groundŒuth
 
‹nsÜs
 -

287 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes


288 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s


289 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd


290 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—


291 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_Ïb–_ty³s


292 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_difficuÉ


293 
v®id_šdiûs
: 
a
 
‹nsÜ
 
w™h
 
v®id
 
šdiûs
 
the
 
box
-
Ëv–
 
groundŒuth
.

295 
R‘uºs
:

296 
a
 
diùiÚ¬y
 
of
 
‹nsÜs
 
cÚššg
 
Úly
 
the
 
groundŒuth
 
v®id_šdiûs
.

298 
Rai£s
:

299 
V®ueE¼Ü
: 
If
 
the
 
sh­e
 
of
 
v®id_šdiûs
 
is
 
šv®id
.

300 
V®ueE¼Ü
: 
f›ld
 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
 
is


301 
nÙ
 
´e£Á
 
š
 
‹nsÜ_diù
.

303 
šput_sh­e
 = 
v®id_šdiûs
.
	`g‘_sh­e
().
	$as_li¡
()

304 
	`nÙ
 (
	`Ën
(
šput_sh­e
è=ğ1 
Ü


305 (
	`Ën
(
šput_sh­e
è=ğ2 
ªd
 input_shape[1] == 1)):

306 
¿i£
 
	`V®ueE¼Ü
('The shape of valid_indices is invalid.')

307 
v®id_šdiûs
 = 
tf
.
	`»sh­e
(valid_indices, [-1])

308 
v®id_diù
 = {
	}
}

309 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
 
š
 
‹nsÜ_diù
:

310 #P»v’t 
»sh­e
 
çu»
 
wh’
 
num_boxes
 
is
 0.

311 
num_boxes
 = 
tf
.
maximum
Ñf.
sh­e
(

312 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
])[0], 1)

313 
key
 
š
 
	g‹nsÜ_diù
:

314 
key
 
š
 [
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
,

315 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
]:

316 
v®id_diù
[
key
] = 
tf
.
	$g©h”
(
‹nsÜ_diù
[
key
], 
v®id_šdiûs
)

317 #IÅuˆ
decod”
 
»tuºs
 
em±y
 
‹nsÜ
 
wh’
 
the£
 
f›lds
 
¬e
 
nÙ
 
´ovided
.

318 #N“d 
to
 
»sh­e
 
što
 [
num_boxes
, -1] 
tf
.
	`g©h”
(ètØ
wÜk
.

319 
–if
 
key
 
š
 [
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd
,

320 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—
,

321 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_difficuÉ
,

322 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_Ïb–_ty³s
]:

323 
v®id_diù
[
key
] = 
tf
.
	`»sh­e
(

324 
tf
.
	`g©h”
Ñf.
	`»sh­e
(
‹nsÜ_diù
[
key
], [
num_boxes
, -1]),

325 
v®id_šdiûs
), [-1])

326 #F›ld 
th©
 
¬e
 
nÙ
 
assocŸ‹d
 
w™h
 
boxes
.

328 
v®id_diù
[
key
] = 
‹nsÜ_diù
[key]

330 
¿i£
 
	`V®ueE¼Ü
('%s‚ot…resent in inputensor dict.' % (

331 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
))

332  
v®id_diù


335 
def
 
	$»š_groundŒuth_w™h_pos™ive_şas£s
(
‹nsÜ_diù
):

338 
Args
:

339 
‹nsÜ_diù
: 
a
 
diùiÚ¬y
 
of
 
fŞlowšg
 
groundŒuth
 
‹nsÜs
 -

340 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes


341 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s


342 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd


343 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—


344 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_Ïb–_ty³s


345 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_difficuÉ


347 
R‘uºs
:

348 
a
 
diùiÚ¬y
 
of
 
‹nsÜs
 
cÚššg
 
Úly
 
the
 
groundŒuth
 
w™h
 
pos™ive


349 
şas£s
.

351 
Rai£s
:

352 
V®ueE¼Ü
: 
If
 
groundŒuth_şas£s
 
‹nsÜ
 
is
 
nÙ
 
š
 
‹nsÜ_diù
.

354 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
 
nÙ
 
š
 
‹nsÜ_diù
:

355 
¿i£
 
	`V®ueE¼Ü
('`groundtruth classes`‚ot inensor_dict.')

356 
k“p_šdiûs
 = 
tf
.
	`wh”e
Ñf.
	$g»©”
(

357 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
], 0))

358  
	$»š_groundŒuth
(
‹nsÜ_diù
, 
k“p_šdiûs
)

361 
def
 
	$f‹r_groundŒuth_w™h_Çn_box_coÜdš©es
(
‹nsÜ_diù
):

364 
Args
:

365 
‹nsÜ_diù
: 
a
 
diùiÚ¬y
 
of
 
fŞlowšg
 
groundŒuth
 
‹nsÜs
 -

366 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes


367 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s


368 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd


369 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—


370 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_Ïb–_ty³s


372 
R‘uºs
:

373 
a
 
diùiÚ¬y
 
of
 
‹nsÜs
 
cÚššg
 
Úly
 
the
 
groundŒuth
 
th©
 
have
 
boundšg


374 
boxes
.

376 
groundŒuth_boxes
 = 
‹nsÜ_diù
[
f›lds
.
IÅutD©aF›lds
.groundtruth_boxes]

377 
Çn_šdiÿtÜ_veùÜ
 = 
tf
.
	`g»©”
Ñf.
	`»duû_sum
Ñf.
	`to_št32
(

378 
tf
.
	`is_Çn
(
groundŒuth_boxes
)), 
»duùiÚ_šdiûs
=[1]), 0)

379 
v®id_šdiÿtÜ_veùÜ
 = 
tf
.
	$logiÿl_nÙ
(
Çn_šdiÿtÜ_veùÜ
)

380 
v®id_šdiûs
 = 
tf
.
	$wh”e
(
v®id_šdiÿtÜ_veùÜ
)

382  
	$»š_groundŒuth
(
‹nsÜ_diù
, 
v®id_šdiûs
)

385 
def
 
	`nÜm®ize_to_rg‘
(
šputs
,

386 
rg‘_nÜm_v®ue
,

387 
dim
,

388 
•sÚ
=1e-7,

389 
ŒašabË
=
True
,

390 
scİe
='NormalizeToTarget',

391 
summ¬ize
=
True
):

394 
This
 
İ
 
im¶em’ts
 
the
 
L2
 
NÜm®iz©iÚ
 
Ïy”
 
šŒoduûd
 
š


395 
Liu
, 
Wei
, 
‘
 
®
. "SSD: Single Shot MultiBox Detector."

396 
ªd
 
Liu
, 
Wei
, 
And»w
 
Rabšovich
,‡nd 
AËxªd”
 
C
. 
B”g
.

397 "P¬£Ãt: Lookšg wid”Ø£b‘‹r." 
ªd
 
is
 
u£ful
 
bršgšg


398 
aùiv©iÚs
 
äom
 
muÉË
 
Ïy”s
 
š
 
a
 
cÚvÃt
 
to
‡ 
¡ªd¬d
 
sÿË
.

400 
NÙe
 
th©
 
the
 
¿nk
 
of
 `
šputs
` 
mu¡
 
be
 
known
 
ªd
h
dim’siÚ
 
to
 
which


401 
nÜm®iz©iÚ
 
is
 
to
 
be
 
­¶›d
 
should
 b
¡©iÿÎy
 
defšed
.

403 
TODO
: 
Add
 
İtiÚ
 
to
 
sÿË
 
by
 
L2
 
nÜm
 
of
 
the
 
’tœe
 
šput
.

405 
Args
:

406 
šputs
: 
A
 `
T’sÜ
` 
of
 
¬b™¿ry
 
size
.

407 
rg‘_nÜm_v®ue
: 
A
 
v®ue
 
th©
 
¥ecif›s
 
ª
 
š™Ÿl
 
rg‘
 
nÜm
 
Ü


408 
a
 
li¡
 
of
 
	$æßts
 (
who£
 
Ëngth
 
mu¡
 
be
 
equ®
 
to
 
the
 
d•th
 
®Úg
he

409 
dim’siÚ
 
to
 
be
 
nÜm®ized
è
¥ecifyšg
 
a
 
³r
-dim’siÚ 
muÉl›r


410 
aá”
 
nÜm®iz©iÚ
.

411 
dim
: 
The
 
dim’siÚ
 
®Úg
 
which
 
the
 
šput
 
is
 
nÜm®ized
.

412 
•sÚ
: 
A
 
sm®l
 
v®ue
 
to
 
add
Ø
the
 
šputs
Ø
avoid
 
dividšg
 
by
 
z”o
.

413 
ŒašabË
: 
Wh‘h”
 
the
 
nÜm
 
is
¿šabË 
Ü
 
nÙ


414 
scİe
: 
O±iÚ®
 scİ
v¬ŸbË_scİe
.

415 
summ¬ize
: 
Wh‘h”
 
Ü
 
nÙ
 
to
 
add
 
a
 
‹nsÜæow
 
summ¬y
 
the
 
İ
.

417 
R‘uºs
:

418 
The
 
šput
 
‹nsÜ
 
nÜm®ized
 
to
 
the
 
¥ecif›d
 
rg‘
 
nÜm
.

420 
Rai£s
:

421 
V®ueE¼Ü
: 
If
 
dim
 
is
 
sm®Ër
 
thª
 
the
 
numb”
 
of
 
dim’siÚs
 
š
 'inputs'.

422 
V®ueE¼Ü
: 
If
 
rg‘_nÜm_v®ue
 
is
 
nÙ
 
a
 
Ü
‡ 
li¡
 
of
 
æßts
 
w™h


423 
Ëngth
 
equ®
 
to
 
the
 
d•th
 
®Úg
h
dim’siÚ
Ø
be
 
nÜm®ized
.

425 
w™h
 
tf
.
	`v¬ŸbË_scİe
(
scİe
, 'NÜm®izeToT¬g‘', [
šputs
]):

426 
nÙ
 
šputs
.
	$g‘_sh­e
():

427 
¿i£
 
	`V®ueE¼Ü
('The input„ank must be known.')

428 
šput_sh­e
 = 
šputs
.
	`g‘_sh­e
().
	$as_li¡
()

429 
šput_¿nk
 = 
	$Ën
(
šput_sh­e
)

430 
dim
 < 0 
Ü
 dim >ğ
šput_¿nk
:

431 
¿i£
 
	`V®ueE¼Ü
(

433 
nÙ
 
šput_sh­e
[
dim
]:

434 
¿i£
 
	`V®ueE¼Ü
('input shape should be statically defined‡long '

436 
d•th
 = 
šput_sh­e
[
dim
]

437 
	`nÙ
 (
	$isš¡ªû
(
rg‘_nÜm_v®ue
, è
Ü


438 (
	$isš¡ªû
(
rg‘_nÜm_v®ue
, 
li¡
è
ªd


439 
	`Ën
(
rg‘_nÜm_v®ue
è=ğ
d•th
è
ªd


440 
	`®l
([
	$isš¡ªû
(
v®
, èv® 
š
 
rg‘_nÜm_v®ue
])):

441 
¿i£
 
	`V®ueE¼Ü
('target_norm_value must be‡ float or‡†ist of floats '

444 
	$isš¡ªû
(
rg‘_nÜm_v®ue
, ):

445 
š™Ÿl_nÜm
 = 
d•th
 * [
rg‘_nÜm_v®ue
]

447 
š™Ÿl_nÜm
 = 
rg‘_nÜm_v®ue


448 
rg‘_nÜm
 = 
tf
.
cÚŒib
.
äamewÜk
.
	`mod–_v¬ŸbË
(

449 
Çme
='weights', 
dty³
=
tf
.
æßt32
,

450 
š™Ÿliz”
=
tf
.
	`cÚ¡ªt
(
š™Ÿl_nÜm
, 
dty³
ñf.
æßt32
),

451 
ŒašabË
=trainable)

452 
summ¬ize
:

453 
m—n
 = 
tf
.
	$»duû_m—n
(
rg‘_nÜm
)

454 
m—n
 = 
tf
.
	`Pršt
(mean, ['NormalizeToTarget:', mean])

455 
tf
.
summ¬y
.
	`sÿÏr
Ñf.
	`g‘_v¬ŸbË_scİe
().
Çme
, 
m—n
)

456 
Ëngths
 = 
•sÚ
 + 
tf
.
	`sq¹
Ñf.
	`»duû_sum
Ñf.
	`squ¬e
(
šputs
), 
dim
, 
True
))

457 
muÉ_sh­e
 = 
šput_¿nk
*[1]

458 
muÉ_sh­e
[
dim
] = 
d•th


459  
tf
.
	`»sh­e
(
rg‘_nÜm
, 
muÉ_sh­e
è*f.
	$Œuediv
(
šputs
, 
Ëngths
)

462 
def
 
	$pos™iÚ_£ns™ive_üİ_»giÚs
(
image
,

463 
boxes
,

464 
box_šd
,

465 
üİ_size
,

466 
num_¥©Ÿl_bšs
,

467 
glob®_poŞ
,

468 
exŒ­Ş©iÚ_v®ue
=
NÚe
):

471 
The
 
ouut
 
üİs
 
¬e
 
¥l™
 
što
 `
¥©Ÿl_bšs_y
` 
v”tiÿl
 
bšs


472 
ªd
 `
¥©Ÿl_bšs_x
` 
hÜizÚl
 
bšs
. 
FÜ
 
—ch
 
š‹r£ùiÚ
 
of
 
a
 
v”tiÿl


473 
ªd
 
a
 
hÜizÚl
 
bš
 
the
 
ouut
 
v®ues
 
¬e
 
g©h”ed
 
by
 
³rfÜmšg


474 `
tf
.
image
.
üİ_ªd_»size
` (
bš—r
 
»§m¶šg
è
Ú
 
a
‡ 
£·¿‹
 
sub£t
 
of


475 
chªÃls
 
of
 
the
 
image
. 
This
 
»duûs
 `
d•th
` 
by
 
a
 
çùÜ
 of

476 `(
¥©Ÿl_bšs_y
 * 
¥©Ÿl_bšs_x
)`.

478 
Wh’
 
glob®_poŞ
 
is
 
True
, 
this
 
funùiÚ
 
im¶em’ts
 
a
 
difã»ÁŸbË
 
v”siÚ


479 
of
 
pos™iÚ
-
£ns™ive
 
RoI
 
poŞšg
 
u£d
 
š


480 [
R
-
FCN
 
d‘eùiÚ
 
sy¡em
](
h‰ps
:

482 
Wh’
 
glob®_poŞ
 
is
 
F®£
, 
this
 
funùiÚ
 
im¶em’ts
 
a
 
difã»ÁŸbË
 
v”siÚ


483 
of
 
pos™iÚ
-
£ns™ive
 
as£mblšg
 
İ”©iÚ
 
u£d
 
š


484 [
š¡ªû
 
FCN
](
h‰ps
:

486 
Args
:

487 
image
: 
A
 `
T’sÜ
`. 
Mu¡
 
be
 
Úe
 
of
 
the
 
fŞlowšg
 
ty³s
: `
ušt8
`, `
št8
`,

488 `
št16
`, `
št32
`, `
št64
`, `
h®f
`, `
æßt32
`, `
æßt64
`.

489 
A
 4-
D
 
‹nsÜ
 
of
 
sh­e
 `[
b©ch
, 
image_height
, 
image_width
, 
d•th
]`.

490 
BÙh
 `
image_height
` 
ªd
 `
image_width
` 
Ãed
 
to
 
be
 
pos™ive
.

491 
boxes
: 
A
 `
T’sÜ
` 
of
 
ty³
 `
æßt32
`.

492 
A
 2-
D
 
‹nsÜ
 
of
 
sh­e
 `[
num_boxes
, 4]`. 
The
 `
i
`-
th
 
row
 oà
the
ensor

493 
¥ecif›s
 
the
 
coÜdš©es
 
of
 
a
 
box
 
š
h`
box_šd
[
i
]` 
image
 
ªd
 
is


494 
¥ecif›d
 
š
 
nÜm®ized
 
coÜdš©es
 `[
y1
, 
x1
, 
y2
, 
x2
]`. 
A
‚ormalized

495 
coÜdš©e
 
v®ue
 
of
 `
y
` 
is
 
m­³d
 
to
 
the
 
image
 coÜdš©
©


496 `
y
 * (
image_height
 - 1)`, 
so
 
as
 
the
 `[0, 1]` 
š‹rv®
 
of
 
nÜm®ized
 
image


497 
height
 
is
 
m­³d
 
to
 `[0, 
image_height
 - 1] 
š
 
image
 heighˆ
coÜdš©es
.

498 
We
 dØ
®low
 
y1
 > 
y2
, 
š
 
which
 
the
 
§m¶ed
 
üİ
 
is
 
ª
 
up
-
down
 
æ³d


499 
v”siÚ
 
of
 
the
 
Üigš®
 
image
. 
The
 
width
 
dim’siÚ
 
is
 
Œ—‹d
 
sim¬ly
.

500 
NÜm®ized
 
coÜdš©es
 
outside
 
the
 `[0, 1]` 
¿nge
 
¬e
 
®lowed
, 
š
 
which


501 
we
 
u£
 `
exŒ­Ş©iÚ_v®ue
` 
to
 
exŒ­Ş©e
 
the
 
šput
 
image
 
v®ues
.

502 
box_šd
: 
A
 `
T’sÜ
` 
of
 
ty³
 `
št32
`.

503 
A
 1-
D
 
‹nsÜ
 
of
 
sh­e
 `[
num_boxes
]` 
w™h
 
št32
 
v®ues
 
š
 `[0, 
b©ch
)`.

504 
The
 
v®ue
 
of
 `
box_šd
[
i
]` 
¥ecif›s
 
the
 
image
 
th©
h`i`-
th
 
box
 
»ãrs


505 
to
.

506 
üİ_size
: 
A
 
li¡
 
of
 
two
 
š‹g”s
 `[
üİ_height
, 
üİ_width
]`. 
AÎ


507 
üİ³d
 
image
 
·tches
 
¬e
 
»sized
 
to
 
this
 
size
. 
The
 
a¥eù
 
¿tio
 
of
 
the


508 
image
 
cÚ‹Á
 
is
 
nÙ
 
´e£rved
. 
BÙh
 `
üİ_height
` 
ªd
 `
üİ_width
` 
Ãed


509 
to
 
be
 
pos™ive
.

510 
num_¥©Ÿl_bšs
: 
A
 
li¡
 
of
 
two
 
š‹g”s
 `[
¥©Ÿl_bšs_y
, 
¥©Ÿl_bšs_x
]`.

511 
R•»£Ás
 
the
 
numb”
 
of
 
pos™iÚ
-
£ns™ive
 
bšs
 
š
 
y
 
ªd
 
x
 
dœeùiÚs
.

512 
BÙh
 
v®ues
 
should
 
be
 >ğ1. `
üİ_height
` should b
divisibË
 
by


513 `
¥©Ÿl_bšs_y
`, 
ªd
 
sim¬ly
 
width
.

514 
The
 
numb”
 
of
 
image
 
chªÃls
 
should
 
be
 
divisibË
 
by


515 (
¥©Ÿl_bšs_y
 * 
¥©Ÿl_bšs_x
).

516 
Sugge¡ed
 
v®ue
 
äom
 
R
-
FCN
 
·³r
: [3, 3].

517 
glob®_poŞ
: 
A
 
boŞ—n
 
v¬ŸbË
.

518 
If
 
True
, 
we
 
³rfÜm
 
av”age
 
glob®
 
poŞšg
 
Ú
 
the
 
ã©u»s
 
as£mbËd
 
äom


519 
the
 
pos™iÚ
-
£ns™ive
 
scÜe
 
m­s
.

520 
If
 
F®£
, 
we
 
k“p
 
the
 
pos™iÚ
-
poŞed
 
ã©u»s
 
w™hout
 
glob®
 
poŞšg


521 
ov”
 
the
 
¥©Ÿl
 
coÜdš©es
.

522 
NÙe
 
th©
 
usšg
 
glob®_poŞ
=
True
 
is
 
equiv®’t
 
to
 
but
 
mÜe
 
effic›Á
 
thª


523 
ruÂšg
 
the
 
funùiÚ
 
w™h
 
glob®_poŞ
=
F®£
 
ªd
 
th’
 
³rfÜmšg
 
glob®


524 
av”age
 
poŞšg
.

525 
exŒ­Ş©iÚ_v®ue
: 
An
 
İtiÚ®
 ``. 
DeçuÉs
 
to
 `0`.

526 
V®ue
 
u£d
 
exŒ­Ş©iÚ
, 
wh’
 
­¶iÿbË
.

527 
R‘uºs
:

528 
pos™iÚ_£ns™ive_ã©u»s
: 
A
 4-
D
 
‹nsÜ
 
of
 
sh­e


529 `[
num_boxes
, 
K
, K, 
üİ_chªÃls
]`,

530 
wh”e
 `
üİ_chªÃls
 = 
d•th
 / (
¥©Ÿl_bšs_y
 * 
¥©Ÿl_bšs_x
)`,

531 
wh”e
 
K
 = 1 
wh’
 
glob®_poŞ
 
is
 
	`True
 (
Av”age
-
poŞed
 
üİ³d
 
»giÚs
),

532 
ªd
 
K
 = 
üİ_size
 
wh’
 
glob®_poŞ
 
is
 
F®£
.

533 
Rai£s
:

534 
V®ueE¼Ü
: 
Rai£d
 
š
 
four
 
s™u©iÚs
:

535 `
num_¥©Ÿl_bšs
` 
is
 
nÙ
 >= 1;

536 `
num_¥©Ÿl_bšs
` 
dÛs
 
nÙ
 
divide
 `
üİ_size
`;

537 `(
¥©Ÿl_bšs_y
*
¥©Ÿl_bšs_x
)` 
dÛs
 
nÙ
 
divide
 `
d•th
`;

538 `
bš_üİ_size
` 
is
 
nÙ
 
squ¬e
 
wh’
 
glob®_poŞ
=
F®£
 
due
 
to
 
the


539 
cÚ¡¿št
 
š
 
funùiÚ
 
¥aû_to_d•th
.

541 
tÙ®_bšs
 = 1

542 
bš_üİ_size
 = []

544 
num_bšs
, 
üİ_dim
è
š
 
	$z
(
num_¥©Ÿl_bšs
, 
üİ_size
):

545 
num_bšs
 < 1:

546 
¿i£
 
	`V®ueE¼Ü
('num_spatial_bins should be >= 1')

548 
üİ_dim
 % 
num_bšs
 != 0:

549 
¿i£
 
	`V®ueE¼Ü
('crop_size should be divisible by‚um_spatial_bins')

551 
tÙ®_bšs
 *ğ
num_bšs


552 
bš_üİ_size
.
	`­³nd
(
üİ_dim


554 
nÙ
 
glob®_poŞ
 
ªd
 
bš_üİ_size
[0] != bin_crop_size[1]:

555 
¿i£
 
	`V®ueE¼Ü
('Only support square bin crop size for‚ow.')

557 
ymš
, 
xmš
, 
ymax
, 
xmax
 = 
tf
.
	$un¡ack
(
boxes
, 
axis
=1)

558 
¥©Ÿl_bšs_y
, 
¥©Ÿl_bšs_x
 = 
num_¥©Ÿl_bšs


560 #S¶™ 
—ch
 
box
 
što
 
¥©Ÿl_bšs_y
 * 
¥©Ÿl_bšs_x
 
bšs
.

561 
pos™iÚ_£ns™ive_boxes
 = []

562 
bš_y
 
š
 
	$¿nge
(
¥©Ÿl_bšs_y
):

563 
¡•_y
 = (
ymax
 - 
ymš
è/ 
¥©Ÿl_bšs_y


564 
bš_x
 
š
 
	$¿nge
(
¥©Ÿl_bšs_x
):

565 
¡•_x
 = (
xmax
 - 
xmš
è/ 
¥©Ÿl_bšs_x


566 
box_coÜdš©es
 = [
ymš
 + 
bš_y
 * 
¡•_y
,

567 
xmš
 + 
bš_x
 * 
¡•_x
,

568 
ymš
 + (
bš_y
 + 1è* 
¡•_y
,

569 
xmš
 + (
bš_x
 + 1è* 
¡•_x
,

571 
pos™iÚ_£ns™ive_boxes
.
	`­³nd
(
tf
.
	$¡ack
(
box_coÜdš©es
, 
axis
=1))

573 
image_¥l™s
 = 
tf
.
	$¥l™
(
v®ue
=
image
, 
num_Ü_size_¥l™s
=
tÙ®_bšs
, 
axis
=3)

575 
image_üİs
 = []

576 
¥l™
, 
box
è
š
 
	$z
(
image_¥l™s
, 
pos™iÚ_£ns™ive_boxes
):

577 
üİ
 = 
tf
.
image
.
	$üİ_ªd_»size
(
¥l™
, 
box
, 
box_šd
, 
bš_üİ_size
,

578 
exŒ­Ş©iÚ_v®ue
=extrapolation_value)

579 
image_üİs
.
	$­³nd
(
üİ
)

581 
glob®_poŞ
:

582 #Av”ag
ov”
 
®l
 
bšs
.

583 
pos™iÚ_£ns™ive_ã©u»s
 = 
tf
.
	`add_n
(
image_üİs
è/ 
	$Ën
(
image_üİs
)

584 #Th’ 
av”age
 
ov”
 
¥©Ÿl
 
pos™iÚs
 
w™hš
 
the
 
bšs
.

585 
pos™iÚ_£ns™ive_ã©u»s
 = 
tf
.
	$»duû_m—n
(

586 
pos™iÚ_£ns™ive_ã©u»s
, [1, 2], 
k“p_dims
=
True
)

588 #ReÜd” 
height
/
width
 
to
 
d•th
 
chªÃl
.

589 
block_size
 = 
bš_üİ_size
[0]

590 
block_size
 >= 2:

591 
image_üİs
 = [
tf
.
	$¥aû_to_d•th
(

592 
üİ
, 
block_size
=block_sizeèüİ 
š
 
image_üİs
]

594 #Pack 
image_üİs
 
so
 
th©
 
fœ¡
 
dim’siÚ
 
is
 
pos™iÚ
-
£n¡ive
 
boxes
.

595 
pos™iÚ_£ns™ive_ã©u»s
 = 
tf
.
	$¡ack
(
image_üİs
, 
axis
=0)

597 #UÄŞÈ
the
 
pos™iÚ
-
£ns™ive
 
boxes
 
to
 
¥©Ÿl
 
pos™iÚs
.

598 
pos™iÚ_£ns™ive_ã©u»s
 = 
tf
.
	`squ“ze
(

599 
tf
.
	`b©ch_to_¥aû_nd
(
pos™iÚ_£ns™ive_ã©u»s
,

600 
block_sh­e
=[1] + 
num_¥©Ÿl_bšs
,

601 
üİs
=
tf
.
	`z”os
((3, 2), 
dty³
ñf.
št32
)),

602 
squ“ze_dims
=[0])

604 #ReÜd” 
back
 
the
 
d•th
 
chªÃl
.

605 
block_size
 >= 2:

606 
pos™iÚ_£ns™ive_ã©u»s
 = 
tf
.
	$d•th_to_¥aû
(

607 
pos™iÚ_£ns™ive_ã©u»s
, 
block_size
=block_size)

609  
pos™iÚ_£ns™ive_ã©u»s


612 
def
 
	$»äame_box_masks_to_image_masks
(
box_masks
, 
boxes
, 
image_height
,

613 
image_width
):

616 
Embeds
 
masks
 
š
 
boundšg
 
boxes
 
of
 
Ïrg”
 mask 
who£
 
sh­es
 
cÜ»¥Úd
 
to


617 
image
 
sh­e
.

619 
Args
:

620 
box_masks
: 
A
 
tf
.
æßt32
 
‹nsÜ
 
of
 
size
 [
num_masks
, 
mask_height
, 
mask_width
].

621 
boxes
: 
A
 
tf
.
æßt32
 
‹nsÜ
 
of
 
size
 [
num_masks
, 4] 
cÚššg
 
the
 
box


622 
cÜÃrs
. 
Row
 
i
 
cÚšs
 [
ymš
, 
xmš
, 
ymax
, 
xmax
] 
of
 
the
 
box


623 
cÜ»¥Údšg
 
to
 
mask
 
i
. 
NÙe
 
th©
 
the
 
box
 
cÜÃrs
 
¬e
 
š


624 
nÜm®ized
 
coÜdš©es
.

625 
image_height
: 
Image
 
height
. 
The
 
ouut
 
mask
 
wl
 
have
 
the
 
§me
 heighˆ
as


626 
the
 
image
 
height
.

627 
image_width
: 
Image
 
width
. 
The
 
ouut
 
mask
 
wl
 
have
 
the
 
§me
 width 
as
he

628 
image
 
width
.

630 
R‘uºs
:

631 
A
 
tf
.
æßt32
 
‹nsÜ
 
of
 
size
 [
num_masks
, 
image_height
, 
image_width
].

633 #TODO: 
Make
 
this
 
a
 
public
 
funùiÚ
.

634 
def
 
	$ŒªsfÜm_boxes_»Ïtive_to_boxes
(
boxes
, 
»ã»nû_boxes
):

635 
boxes
 = 
tf
.
	`»sh­e
(boxes, [-1, 2, 2])

636 
mš_cÜÃr
 = 
tf
.
	$ex·nd_dims
(
»ã»nû_boxes
[:, 0:2], 1)

637 
max_cÜÃr
 = 
tf
.
	$ex·nd_dims
(
»ã»nû_boxes
[:, 2:4], 1)

638 
ŒªsfÜmed_boxes
 = (
boxes
 - 
mš_cÜÃr
è/ (
max_cÜÃr
 - min_corner)

639  
tf
.
	`»sh­e
(
ŒªsfÜmed_boxes
, [-1, 4])

641 
box_masks
 = 
tf
.
	$ex·nd_dims
(
box_masks
, 
axis
=3)

642 
num_boxes
 = 
tf
.
	`sh­e
(
box_masks
)[0]

643 
un™_boxes
 = 
tf
.
	`cÚÿt
(

644 [
tf
.
	`z”os
([
num_boxes
, 2]),f.
	`Úes
([num_boxes, 2])], 
axis
=1)

645 
»v”£_boxes
 = 
	$ŒªsfÜm_boxes_»Ïtive_to_boxes
(
un™_boxes
, 
boxes
)

646 
image_masks
 = 
tf
.
image
.
	`üİ_ªd_»size
(image=
box_masks
,

647 
boxes
=
»v”£_boxes
,

648 
box_šd
=
tf
.
	`¿nge
(
num_boxes
),

649 
üİ_size
=[
image_height
, 
image_width
],

650 
exŒ­Ş©iÚ_v®ue
=0.0)

651  
tf
.
	`squ“ze
(
image_masks
, 
axis
=3)

	@utils/ops_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
numpy
 
as
 
Å


18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
¡ªd¬d_f›lds
 
as
 
f›lds


21 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
İs


24 
şass
 
	$NÜm®izedToImageCoÜdš©esTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$‹¡_nÜm®ized_to_image_coÜdš©es
(
£lf
):

27 
nÜm®ized_boxes
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
, 1, 4))

28 
nÜm®ized_boxes_Å
 = 
Å
.
	$¬¿y
([[[0.0, 0.0, 1.0, 1.0]],

30 
image_sh­e
 = 
tf
.
	$cÚv”t_to_‹nsÜ
([1, 4, 4, 3], 
dty³
=
tf
.
št32
)

31 
absŞu‹_boxes
 = 
İs
.
	$nÜm®ized_to_image_coÜdš©es
(
nÜm®ized_boxes
,

32 
image_sh­e
,

33 
·¿Î–_™”©iÚs
=2)

35 
ex³ùed_boxes
 = 
Å
.
	$¬¿y
([[[0, 0, 4, 4]],

37 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

38 
absŞu‹_boxes
 = 
£ss
.
	`run
(absolute_boxes,

39 
ãed_diù
={
nÜm®ized_boxes
:

40 
nÜm®ized_boxes_Å
})

42 
£lf
.
	$as£¹AÎEqu®
(
absŞu‹_boxes
, 
ex³ùed_boxes
)

45 
şass
 
	$MeshgridTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

47 
def
 
	$‹¡_meshgrid_numpy_com·risÚ
(
£lf
):

49 
x
 = 
Å
.
	$¬ªge
(4)

50 
y
 = 
Å
.
	$¬ªge
(6)

51 
exp_xgrid
, 
exp_ygrid
 = 
Å
.
	$meshgrid
(
x
, 
y
)

52 
xgrid
, 
ygrid
 = 
İs
.
	$meshgrid
(
x
, 
y
)

53 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

54 
xgrid_ouut
, 
ygrid_ouut
 = 
£ss
.
	$run
([
xgrid
, 
ygrid
])

55 
£lf
.
	$as£¹AÎEqu®
(
xgrid_ouut
, 
exp_xgrid
)

56 
£lf
.
	$as£¹AÎEqu®
(
ygrid_ouut
, 
exp_ygrid
)

58 
def
 
	$‹¡_meshgrid_muÉidim’siÚ®
(
£lf
):

59 
Å
.
¿ndom
.
	$£ed
(18)

60 
x
 = 
Å
.
¿ndom
.
	`¿nd
(4, 1, 2).
	$a¡y³
(
Å
.
æßt32
)

61 
y
 = 
Å
.
¿ndom
.
	`¿nd
(2, 3).
	$a¡y³
(
Å
.
æßt32
)

63 
xgrid
, 
ygrid
 = 
İs
.
	$meshgrid
(
x
, 
y
)

65 
grid_sh­e
 = 
	`li¡
(
y
.
sh­e
è+ 
	$li¡
(
x
.
sh­e
)

66 
£lf
.
	`as£¹Equ®
(
xgrid
.
	`g‘_sh­e
().
	`as_li¡
(), 
grid_sh­e
)

67 
£lf
.
	`as£¹Equ®
(
ygrid
.
	`g‘_sh­e
().
	`as_li¡
(), 
grid_sh­e
)

68 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

69 
xgrid_ouut
, 
ygrid_ouut
 = 
£ss
.
	$run
([
xgrid
, 
ygrid
])

71 #Check 
the
 
sh­e
 
of
h
ouut
 
grids


72 
£lf
.
	`as£¹Equ®
(
xgrid_ouut
.
sh­e
, 
	$tu¶e
(
grid_sh­e
))

73 
£lf
.
	`as£¹Equ®
(
ygrid_ouut
.
sh­e
, 
	$tu¶e
(
grid_sh­e
))

75 #Check 
a
 
ãw
 
–em’ts


76 
‹¡_–em’ts
 = [((3, 0, 0), (1, 2)),

79 
xšd
, 
yšd
 
š
 
‹¡_–em’ts
:

80 #The£ 
¬e
 
equ®™y
 
‹¡s
, 
but
 
the
 
meshgrid
 
İ
 
should
 
nÙ
 
šŒoduû


82 
£lf
.
	`as£¹Equ®
(
xgrid_ouut
[
yšd
 + 
xšd
], 
x
[xind])

83 
£lf
.
	`as£¹Equ®
(
ygrid_ouut
[
yšd
 + 
xšd
], 
y
[yind])

86 
şass
 
	$OpsTe¡PadToMuÉË
(
tf
.
‹¡
.
Te¡Ca£
):

88 
def
 
	$‹¡_z”o_·ddšg
(
£lf
):

89 
‹nsÜ
 = 
tf
.
	$cÚ¡ªt
([[[[0.], [0.]], [[0.], [0.]]]])

90 
·dded_‹nsÜ
 = 
İs
.
	$·d_to_muÉË
(
‹nsÜ
, 1)

91 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

92 
·dded_‹nsÜ_out
 = 
£ss
.
	$run
(
·dded_‹nsÜ
)

93 
£lf
.
	`as£¹Equ®
((1, 2, 2, 1), 
·dded_‹nsÜ_out
.
sh­e
)

95 
def
 
	$‹¡_no_·ddšg
(
£lf
):

96 
‹nsÜ
 = 
tf
.
	$cÚ¡ªt
([[[[0.], [0.]], [[0.], [0.]]]])

97 
·dded_‹nsÜ
 = 
İs
.
	$·d_to_muÉË
(
‹nsÜ
, 2)

98 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

99 
·dded_‹nsÜ_out
 = 
£ss
.
	$run
(
·dded_‹nsÜ
)

100 
£lf
.
	`as£¹Equ®
((1, 2, 2, 1), 
·dded_‹nsÜ_out
.
sh­e
)

102 
def
 
	$‹¡_·ddšg
(
£lf
):

103 
‹nsÜ
 = 
tf
.
	$cÚ¡ªt
([[[[0.], [0.]], [[0.], [0.]]]])

104 
·dded_‹nsÜ
 = 
İs
.
	$·d_to_muÉË
(
‹nsÜ
, 4)

105 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

106 
·dded_‹nsÜ_out
 = 
£ss
.
	$run
(
·dded_‹nsÜ
)

107 
£lf
.
	`as£¹Equ®
((1, 4, 4, 1), 
·dded_‹nsÜ_out
.
sh­e
)

110 
şass
 
	$OpsTe¡PaddedOÃHÙEncodšg
(
tf
.
‹¡
.
Te¡Ca£
):

112 
def
 
	$‹¡_cÜ»ù_Úe_hÙ_‹nsÜ_w™h_no_·d
(
£lf
):

113 
šdiûs
 = 
tf
.
	$cÚ¡ªt
([1, 2, 3, 5])

114 
Úe_hÙ_‹nsÜ
 = 
İs
.
	$·dded_Úe_hÙ_’codšg
(
šdiûs
, 
d•th
=6, 
Ëá_·d
=0)

115 
ex³ùed_‹nsÜ
 = 
Å
.
	$¬¿y
([[0, 1, 0, 0, 0, 0],

118 [0, 0, 0, 0, 0, 1]], 
Å
.
æßt32
)

119 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

120 
out_Úe_hÙ_‹nsÜ
 = 
£ss
.
	$run
(
Úe_hÙ_‹nsÜ
)

121 
£lf
.
	`as£¹AÎClo£
(
out_Úe_hÙ_‹nsÜ
, 
ex³ùed_‹nsÜ
, 
¹Ş
=1e-10,

122 
©Ş
=1e-10)

124 
def
 
	$‹¡_cÜ»ù_Úe_hÙ_‹nsÜ_w™h_·d_Úe
(
£lf
):

125 
šdiûs
 = 
tf
.
	$cÚ¡ªt
([1, 2, 3, 5])

126 
Úe_hÙ_‹nsÜ
 = 
İs
.
	$·dded_Úe_hÙ_’codšg
(
šdiûs
, 
d•th
=6, 
Ëá_·d
=1)

127 
ex³ùed_‹nsÜ
 = 
Å
.
	$¬¿y
([[0, 0, 1, 0, 0, 0, 0],

130 [0, 0, 0, 0, 0, 0, 1]], 
Å
.
æßt32
)

131 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

132 
out_Úe_hÙ_‹nsÜ
 = 
£ss
.
	$run
(
Úe_hÙ_‹nsÜ
)

133 
£lf
.
	`as£¹AÎClo£
(
out_Úe_hÙ_‹nsÜ
, 
ex³ùed_‹nsÜ
, 
¹Ş
=1e-10,

134 
©Ş
=1e-10)

136 
def
 
	$‹¡_cÜ»ù_Úe_hÙ_‹nsÜ_w™h_·d_th»e
(
£lf
):

137 
šdiûs
 = 
tf
.
	$cÚ¡ªt
([1, 2, 3, 5])

138 
Úe_hÙ_‹nsÜ
 = 
İs
.
	$·dded_Úe_hÙ_’codšg
(
šdiûs
, 
d•th
=6, 
Ëá_·d
=3)

139 
ex³ùed_‹nsÜ
 = 
Å
.
	$¬¿y
([[0, 0, 0, 0, 1, 0, 0, 0, 0],

142 [0, 0, 0, 0, 0, 0, 0, 0, 1]], 
Å
.
æßt32
)

143 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

144 
out_Úe_hÙ_‹nsÜ
 = 
£ss
.
	$run
(
Úe_hÙ_‹nsÜ
)

145 
£lf
.
	`as£¹AÎClo£
(
out_Úe_hÙ_‹nsÜ
, 
ex³ùed_‹nsÜ
, 
¹Ş
=1e-10,

146 
©Ş
=1e-10)

148 
def
 
	$‹¡_cÜ»ù_·dded_Úe_hÙ_‹nsÜ_w™h_em±y_šdiûs
(
£lf
):

149 
d•th
 = 6

150 
·d
 = 2

151 
šdiûs
 = 
tf
.
	$cÚ¡ªt
([])

152 
Úe_hÙ_‹nsÜ
 = 
İs
.
	$·dded_Úe_hÙ_’codšg
(

153 
šdiûs
, 
d•th
=d•th, 
Ëá_·d
=
·d
)

154 
ex³ùed_‹nsÜ
 = 
Å
.
	`z”os
((0, 
d•th
 + 
·d
))

155 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

156 
out_Úe_hÙ_‹nsÜ
 = 
£ss
.
	$run
(
Úe_hÙ_‹nsÜ
)

157 
£lf
.
	`as£¹AÎClo£
(
out_Úe_hÙ_‹nsÜ
, 
ex³ùed_‹nsÜ
, 
¹Ş
=1e-10,

158 
©Ş
=1e-10)

160 
def
 
	$‹¡_»tuº_nÚe_Ú_z”o_d•th
(
£lf
):

161 
šdiûs
 = 
tf
.
	$cÚ¡ªt
([1, 2, 3, 4, 5])

162 
Úe_hÙ_‹nsÜ
 = 
İs
.
	$·dded_Úe_hÙ_’codšg
(
šdiûs
, 
d•th
=0, 
Ëá_·d
=2)

163 
£lf
.
	$as£¹Equ®
(
Úe_hÙ_‹nsÜ
, 
NÚe
)

165 
def
 
	$‹¡_¿i£_v®ue_”rÜ_Ú_¿nk_two_šput
(
£lf
):

166 
šdiûs
 = 
tf
.
	`cÚ¡ªt
(1.0, 
sh­e
=(2, 3))

167 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

168 
İs
.
	$·dded_Úe_hÙ_’codšg
(
šdiûs
, 
d•th
=6, 
Ëá_·d
=2)

170 
def
 
	$‹¡_¿i£_v®ue_”rÜ_Ú_Ãg©ive_·d
(
£lf
):

171 
šdiûs
 = 
tf
.
	`cÚ¡ªt
(1.0, 
sh­e
=(2, 3))

172 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

173 
İs
.
	`·dded_Úe_hÙ_’codšg
(
šdiûs
, 
d•th
=6, 
Ëá_·d
=-1)

175 
def
 
	$‹¡_¿i£_v®ue_”rÜ_Ú_æßt_·d
(
£lf
):

176 
šdiûs
 = 
tf
.
	`cÚ¡ªt
(1.0, 
sh­e
=(2, 3))

177 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

178 
İs
.
	$·dded_Úe_hÙ_’codšg
(
šdiûs
, 
d•th
=6, 
Ëá_·d
=0.1)

180 
def
 
	$‹¡_¿i£_v®ue_”rÜ_Ú_æßt_d•th
(
£lf
):

181 
šdiûs
 = 
tf
.
	`cÚ¡ªt
(1.0, 
sh­e
=(2, 3))

182 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

183 
İs
.
	$·dded_Úe_hÙ_’codšg
(
šdiûs
, 
d•th
=0.1, 
Ëá_·d
=2)

186 
şass
 
	$OpsD’£ToS·r£BoxesTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

188 
def
 
	$‹¡_»tuº_®l_boxes_wh’_®l_šput_boxes_¬e_v®id
(
£lf
):

189 
num_şas£s
 = 4

190 
num_v®id_boxes
 = 3

191 
code_size
 = 4

192 
d’£_loÿtiÚ_¶aûhŞd”
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
,

193 
sh­e
=(
num_v®id_boxes
,

194 
code_size
))

195 
d’£_num_boxes_¶aûhŞd”
 = 
tf
.
	`¶aûhŞd”
Ñf.
št32
, 
sh­e
=(
num_şas£s
))

196 
box_loÿtiÚs
, 
box_şas£s
 = 
İs
.
	$d’£_to_¥¬£_boxes
(

197 
d’£_loÿtiÚ_¶aûhŞd”
, 
d’£_num_boxes_¶aûhŞd”
, 
num_şas£s
)

198 
ãed_diù
 = {
d’£_loÿtiÚ_¶aûhŞd”
: 
Å
.
¿ndom
.
	`unifÜm
(

199 
size
=[
num_v®id_boxes
, 
code_size
]),

200 
d’£_num_boxes_¶aûhŞd”
: 
Å
.
	`¬¿y
([1, 0, 0, 2],

201 
dty³
=
Å
.
št32
)
	}
}

203 
	gex³ùed_box_loÿtiÚs
 = 
ãed_diù
[
d’£_loÿtiÚ_¶aûhŞd”
]

204 
ex³ùed_box_şass£s
 = 
Å
.
	$¬¿y
([0, 3, 3])

205 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

206 
box_loÿtiÚs
, 
box_şas£s
 = 
£ss
.
	$run
([
box_loÿtiÚs
, 
box_şas£s
],

207 
ãed_diù
=feed_dict)

209 
£lf
.
	`as£¹AÎClo£
(
box_loÿtiÚs
, 
ex³ùed_box_loÿtiÚs
, 
¹Ş
=1e-6,

210 
©Ş
=1e-6)

211 
£lf
.
	$as£¹AÎEqu®
(
box_şas£s
, 
ex³ùed_box_şass£s
)

213 
def
 
	$‹¡_»tuº_Úly_v®id_boxes_wh’_šput_cÚšs_šv®id_boxes
(
£lf
):

214 
num_şas£s
 = 4

215 
num_v®id_boxes
 = 3

216 
num_boxes
 = 10

217 
code_size
 = 4

219 
d’£_loÿtiÚ_¶aûhŞd”
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
num_boxes
,

220 
code_size
))

221 
d’£_num_boxes_¶aûhŞd”
 = 
tf
.
	`¶aûhŞd”
Ñf.
št32
, 
sh­e
=(
num_şas£s
))

222 
box_loÿtiÚs
, 
box_şas£s
 = 
İs
.
	$d’£_to_¥¬£_boxes
(

223 
d’£_loÿtiÚ_¶aûhŞd”
, 
d’£_num_boxes_¶aûhŞd”
, 
num_şas£s
)

224 
ãed_diù
 = {
d’£_loÿtiÚ_¶aûhŞd”
: 
Å
.
¿ndom
.
	`unifÜm
(

225 
size
=[
num_boxes
, 
code_size
]),

226 
d’£_num_boxes_¶aûhŞd”
: 
Å
.
	`¬¿y
([1, 0, 0, 2],

227 
dty³
=
Å
.
št32
)
	}
}

229 
	gex³ùed_box_loÿtiÚs
 = (
ãed_diù
[
d’£_loÿtiÚ_¶aûhŞd”
]

230 [:
num_v®id_boxes
])

231 
ex³ùed_box_şass£s
 = 
Å
.
	$¬¿y
([0, 3, 3])

232 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

233 
box_loÿtiÚs
, 
box_şas£s
 = 
£ss
.
	$run
([
box_loÿtiÚs
, 
box_şas£s
],

234 
ãed_diù
=feed_dict)

236 
£lf
.
	`as£¹AÎClo£
(
box_loÿtiÚs
, 
ex³ùed_box_loÿtiÚs
, 
¹Ş
=1e-6,

237 
©Ş
=1e-6)

238 
£lf
.
	$as£¹AÎEqu®
(
box_şas£s
, 
ex³ùed_box_şass£s
)

241 
şass
 
	$OpsTe¡IndiûsToD’£VeùÜ
(
tf
.
‹¡
.
Te¡Ca£
):

243 
def
 
	$‹¡_šdiûs_to_d’£_veùÜ
(
£lf
):

244 
size
 = 10000

245 
num_šdiûs
 = 
Å
.
¿ndom
.
	$¿ndšt
(
size
)

246 
¿nd_šdiûs
 = 
Å
.
¿ndom
.
	`³rmutiÚ
Òp.
	`¬ªge
(
size
))[0:
num_šdiûs
]

248 
ex³ùed_ouut
 = 
Å
.
	$z”os
(
size
, 
dty³
=
Å
.
æßt32
)

249 
ex³ùed_ouut
[
¿nd_šdiûs
] = 1.

251 
tf_¿nd_šdiûs
 = 
tf
.
	$cÚ¡ªt
(
¿nd_šdiûs
)

252 
šdiÿtÜ
 = 
İs
.
	$šdiûs_to_d’£_veùÜ
(
tf_¿nd_šdiûs
, 
size
)

254 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

255 
ouut
 = 
£ss
.
	$run
(
šdiÿtÜ
)

256 
£lf
.
	$as£¹AÎEqu®
(
ouut
, 
ex³ùed_ouut
)

257 
£lf
.
	$as£¹Equ®
(
ouut
.
dty³
, 
ex³ùed_ouut
.dtype)

259 
def
 
	$‹¡_šdiûs_to_d’£_veùÜ_size_©_šã»nû
(
£lf
):

260 
size
 = 5000

261 
num_šdiûs
 = 250

262 
®l_šdiûs
 = 
Å
.
	$¬ªge
(
size
)

263 
¿nd_šdiûs
 = 
Å
.
¿ndom
.
	`³rmutiÚ
(
®l_šdiûs
)[0:
num_šdiûs
]

265 
ex³ùed_ouut
 = 
Å
.
	$z”os
(
size
, 
dty³
=
Å
.
æßt32
)

266 
ex³ùed_ouut
[
¿nd_šdiûs
] = 1.

268 
tf_®l_šdiûs
 = 
tf
.
	$¶aûhŞd”
(
tf
.
št32
)

269 
tf_¿nd_šdiûs
 = 
tf
.
	$cÚ¡ªt
(
¿nd_šdiûs
)

270 
šdiÿtÜ
 = 
İs
.
	`šdiûs_to_d’£_veùÜ
(
tf_¿nd_šdiûs
,

271 
tf
.
	`sh­e
(
tf_®l_šdiûs
)[0])

272 
ãed_diù
 = {
tf_®l_šdiûs
: 
®l_šdiûs
}

274 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

275 
ouut
 = 
£ss
.
	$run
(
šdiÿtÜ
, 
ãed_diù
=feed_dict)

276 
£lf
.
	$as£¹AÎEqu®
(
ouut
, 
ex³ùed_ouut
)

277 
£lf
.
	$as£¹Equ®
(
ouut
.
dty³
, 
ex³ùed_ouut
.dtype)

279 
def
 
	$‹¡_šdiûs_to_d’£_veùÜ_št
(
£lf
):

280 
size
 = 500

281 
num_šdiûs
 = 25

282 
¿nd_šdiûs
 = 
Å
.
¿ndom
.
	`³rmutiÚ
Òp.
	`¬ªge
(
size
))[0:
num_šdiûs
]

284 
ex³ùed_ouut
 = 
Å
.
	$z”os
(
size
, 
dty³
=
Å
.
št64
)

285 
ex³ùed_ouut
[
¿nd_šdiûs
] = 1

287 
tf_¿nd_šdiûs
 = 
tf
.
	$cÚ¡ªt
(
¿nd_šdiûs
)

288 
šdiÿtÜ
 = 
İs
.
	$šdiûs_to_d’£_veùÜ
(

289 
tf_¿nd_šdiûs
, 
size
, 1, 
dty³
=
tf
.
št64
)

291 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

292 
ouut
 = 
£ss
.
	$run
(
šdiÿtÜ
)

293 
£lf
.
	$as£¹AÎEqu®
(
ouut
, 
ex³ùed_ouut
)

294 
£lf
.
	$as£¹Equ®
(
ouut
.
dty³
, 
ex³ùed_ouut
.dtype)

296 
def
 
	$‹¡_šdiûs_to_d’£_veùÜ_cu¡om_v®ues
(
£lf
):

297 
size
 = 100

298 
num_šdiûs
 = 10

299 
¿nd_šdiûs
 = 
Å
.
¿ndom
.
	`³rmutiÚ
Òp.
	`¬ªge
(
size
))[0:
num_šdiûs
]

300 
šdiûs_v®ue
 = 
Å
.
¿ndom
.
	$¿nd
(1)

301 
deçuÉ_v®ue
 = 
Å
.
¿ndom
.
	$¿nd
(1)

303 
ex³ùed_ouut
 = 
Å
.
	`æßt32
Òp.
	`Úes
(
size
è* 
deçuÉ_v®ue
)

304 
ex³ùed_ouut
[
¿nd_šdiûs
] = 
šdiûs_v®ue


306 
tf_¿nd_šdiûs
 = 
tf
.
	$cÚ¡ªt
(
¿nd_šdiûs
)

307 
šdiÿtÜ
 = 
İs
.
	$šdiûs_to_d’£_veùÜ
(

308 
tf_¿nd_šdiûs
,

309 
size
,

310 
šdiûs_v®ue
=indices_value,

311 
deçuÉ_v®ue
=default_value)

313 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

314 
ouut
 = 
£ss
.
	$run
(
šdiÿtÜ
)

315 
£lf
.
	$as£¹AÎClo£
(
ouut
, 
ex³ùed_ouut
)

316 
£lf
.
	$as£¹Equ®
(
ouut
.
dty³
, 
ex³ùed_ouut
.dtype)

318 
def
 
	$‹¡_šdiûs_to_d’£_veùÜ_®l_šdiûs_as_šput
(
£lf
):

319 
size
 = 500

320 
num_šdiûs
 = 500

321 
¿nd_šdiûs
 = 
Å
.
¿ndom
.
	`³rmutiÚ
Òp.
	`¬ªge
(
size
))[0:
num_šdiûs
]

323 
ex³ùed_ouut
 = 
Å
.
	$Úes
(
size
, 
dty³
=
Å
.
æßt32
)

325 
tf_¿nd_šdiûs
 = 
tf
.
	$cÚ¡ªt
(
¿nd_šdiûs
)

326 
šdiÿtÜ
 = 
İs
.
	$šdiûs_to_d’£_veùÜ
(
tf_¿nd_šdiûs
, 
size
)

328 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

329 
ouut
 = 
£ss
.
	$run
(
šdiÿtÜ
)

330 
£lf
.
	$as£¹AÎEqu®
(
ouut
, 
ex³ùed_ouut
)

331 
£lf
.
	$as£¹Equ®
(
ouut
.
dty³
, 
ex³ùed_ouut
.dtype)

333 
def
 
	$‹¡_šdiûs_to_d’£_veùÜ_em±y_šdiûs_as_šput
(
£lf
):

334 
size
 = 500

335 
¿nd_šdiûs
 = []

337 
ex³ùed_ouut
 = 
Å
.
	$z”os
(
size
, 
dty³
=
Å
.
æßt32
)

339 
tf_¿nd_šdiûs
 = 
tf
.
	$cÚ¡ªt
(
¿nd_šdiûs
)

340 
šdiÿtÜ
 = 
İs
.
	$šdiûs_to_d’£_veùÜ
(
tf_¿nd_šdiûs
, 
size
)

342 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

343 
ouut
 = 
£ss
.
	$run
(
šdiÿtÜ
)

344 
£lf
.
	$as£¹AÎEqu®
(
ouut
, 
ex³ùed_ouut
)

345 
£lf
.
	$as£¹Equ®
(
ouut
.
dty³
, 
ex³ùed_ouut
.dtype)

348 
şass
 
	$GroundŒuthF‹rTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

350 
def
 
	$‹¡_f‹r_groundŒuth
(
£lf
):

351 
šput_image
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
, None, 3))

352 
šput_boxes
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
, 4))

353 
šput_şas£s
 = 
tf
.
	`¶aûhŞd”
Ñf.
št32
, 
sh­e
=(
NÚe
,))

354 
šput_is_üowd
 = 
tf
.
	`¶aûhŞd”
Ñf.
boŞ
, 
sh­e
=(
NÚe
,))

355 
šput_¬—
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
,))

356 
šput_difficuÉ
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
,))

357 
šput_Ïb–_ty³s
 = 
tf
.
	`¶aûhŞd”
Ñf.
¡ršg
, 
sh­e
=(
NÚe
,))

358 
v®id_šdiûs
 = 
tf
.
	`¶aûhŞd”
Ñf.
št32
, 
sh­e
=(
NÚe
,))

359 
šput_‹nsÜs
 = {

360 
f›lds
.
IÅutD©aF›lds
.
image
: 
šput_image
,

361 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
šput_boxes
,

362 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
šput_şas£s
,

363 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd
: 
šput_is_üowd
,

364 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—
: 
šput_¬—
,

365 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_difficuÉ
: 
šput_difficuÉ
,

366 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_Ïb–_ty³s
: 
šput_Ïb–_ty³s


367 
	}
}

368 
ouut_‹nsÜs
 = 
İs
.
	$»š_groundŒuth
(
šput_‹nsÜs
, 
v®id_šdiûs
)

370 
image_‹nsÜ
 = 
Å
.
¿ndom
.
	$¿nd
(224, 224, 3)

371 
ãed_diù
 = {

372 
šput_image
: 
image_‹nsÜ
,

373 
šput_boxes
:

374 
Å
.
	`¬¿y
([[0.2, 0.4, 0.1, 0.8], [0.2, 0.4, 1.0, 0.8]], 
dty³
=np.),

375 
šput_şas£s
:

376 
Å
.
	`¬¿y
([1, 2], 
dty³
òp.
št32
),

377 
šput_is_üowd
:

378 
Å
.
	`¬¿y
([
F®£
, 
True
], 
dty³
òp.
boŞ
),

379 
šput_¬—
:

380 
Å
.
	`¬¿y
([32, 48], 
dty³
òp.
æßt32
),

381 
šput_difficuÉ
:

382 
Å
.
	`¬¿y
([
True
, 
F®£
], 
dty³
òp.
boŞ
),

383 
šput_Ïb–_ty³s
:

384 
Å
.
	`¬¿y
(['APPROPRIATE', 'INCORRECT'], 
dty³
òp.
¡ršg_
),

385 
v®id_šdiûs
:

386 
Å
.
	`¬¿y
([0], 
dty³
òp.
št32
)

387 
	}
}

388 
	gex³ùed_‹nsÜs
 = {

389 
f›lds
.
IÅutD©aF›lds
.
image
:

390 
image_‹nsÜ
,

391 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
:

393 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
:

395 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd
:

396 [
F®£
],

397 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—
:

399 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_difficuÉ
:

400 [
True
],

401 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_Ïb–_ty³s
:

404 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

405 
ouut_‹nsÜs
 = 
£ss
.
	$run
(
ouut_‹nsÜs
, 
ãed_diù
=feed_dict)

406 
key
 
š
 [
f›lds
.
IÅutD©aF›lds
.
image
,

407 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
,

408 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—
]:

409 
£lf
.
	$as£¹AÎClo£
(
ex³ùed_‹nsÜs
[
key
], 
ouut_‹nsÜs
[key])

410 
key
 
š
 [
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
,

411 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd
,

412 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_Ïb–_ty³s
]:

413 
£lf
.
	$as£¹AÎEqu®
(
ex³ùed_‹nsÜs
[
key
], 
ouut_‹nsÜs
[key])

415 
def
 
	$‹¡_f‹r_w™h_missšg_f›lds
(
£lf
):

416 
šput_boxes
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
, 4))

417 
šput_şas£s
 = 
tf
.
	`¶aûhŞd”
Ñf.
št32
, 
sh­e
=(
NÚe
,))

418 
šput_‹nsÜs
 = {

419 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
šput_boxes
,

420 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
šput_şas£s


421 
	}
}

422 
v®id_šdiûs
 = 
tf
.
¶aûhŞd”
Ñf.
št32
, 
sh­e
=(
NÚe
,))

424 
	gãed_diù
 = {

425 
šput_boxes
:

426 
Å
.
¬¿y
([[0.2, 0.4, 0.1, 0.8], [0.2, 0.4, 1.0, 0.8]], 
dty³
=np.),

427 
	gšput_şas£s
:

428 
Å
.
¬¿y
([1, 2], 
dty³
òp.
št32
),

429 
	gv®id_šdiûs
:

430 
Å
.
¬¿y
([0], 
dty³
òp.
št32
)

432 
	gex³ùed_‹nsÜs
 = {

433 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
:

435 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
:

439 
ouut_‹nsÜs
 = 
İs
.
	$»š_groundŒuth
(
šput_‹nsÜs
, 
v®id_šdiûs
)

440 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

441 
ouut_‹nsÜs
 = 
£ss
.
	$run
(
ouut_‹nsÜs
, 
ãed_diù
=feed_dict)

442 
key
 
š
 [
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
]:

443 
£lf
.
	$as£¹AÎClo£
(
ex³ùed_‹nsÜs
[
key
], 
ouut_‹nsÜs
[key])

444 
key
 
š
 [
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
]:

445 
£lf
.
	$as£¹AÎEqu®
(
ex³ùed_‹nsÜs
[
key
], 
ouut_‹nsÜs
[key])

447 
def
 
	$‹¡_f‹r_w™h_em±y_f›lds
(
£lf
):

448 
šput_boxes
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
, 4))

449 
šput_şas£s
 = 
tf
.
	`¶aûhŞd”
Ñf.
št32
, 
sh­e
=(
NÚe
,))

450 
šput_is_üowd
 = 
tf
.
	`¶aûhŞd”
Ñf.
boŞ
, 
sh­e
=(
NÚe
,))

451 
šput_¬—
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
,))

452 
šput_difficuÉ
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
,))

453 
v®id_šdiûs
 = 
tf
.
	`¶aûhŞd”
Ñf.
št32
, 
sh­e
=(
NÚe
,))

454 
šput_‹nsÜs
 = {

455 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
šput_boxes
,

456 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
šput_şas£s
,

457 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd
: 
šput_is_üowd
,

458 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—
: 
šput_¬—
,

459 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_difficuÉ
: 
šput_difficuÉ


460 
	}
}

461 
ouut_‹nsÜs
 = 
İs
.
	$»š_groundŒuth
(
šput_‹nsÜs
, 
v®id_šdiûs
)

463 
ãed_diù
 = {

464 
šput_boxes
:

465 
Å
.
	`¬¿y
([[0.2, 0.4, 0.1, 0.8], [0.2, 0.4, 1.0, 0.8]], 
dty³
=np.),

466 
šput_şas£s
:

467 
Å
.
	`¬¿y
([1, 2], 
dty³
òp.
št32
),

468 
šput_is_üowd
:

469 
Å
.
	`¬¿y
([
F®£
, 
True
], 
dty³
òp.
boŞ
),

470 
šput_¬—
:

471 
Å
.
	`¬¿y
([], 
dty³
òp.
æßt32
),

472 
šput_difficuÉ
:

473 
Å
.
	`¬¿y
([], 
dty³
òp.
æßt32
),

474 
v®id_šdiûs
:

475 
Å
.
	`¬¿y
([0], 
dty³
òp.
št32
)

476 
	}
}

477 
	gex³ùed_‹nsÜs
 = {

478 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
:

480 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
:

482 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd
:

483 [
F®£
],

484 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—
:

486 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_difficuÉ
:

489 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

490 
ouut_‹nsÜs
 = 
£ss
.
	$run
(
ouut_‹nsÜs
, 
ãed_diù
=feed_dict)

491 
key
 
š
 [
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
,

492 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—
]:

493 
£lf
.
	$as£¹AÎClo£
(
ex³ùed_‹nsÜs
[
key
], 
ouut_‹nsÜs
[key])

494 
key
 
š
 [
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
,

495 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd
]:

496 
£lf
.
	$as£¹AÎEqu®
(
ex³ùed_‹nsÜs
[
key
], 
ouut_‹nsÜs
[key])

498 
def
 
	$‹¡_f‹r_w™h_em±y_groundŒuth_boxes
(
£lf
):

499 
šput_boxes
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
, 4))

500 
šput_şas£s
 = 
tf
.
	`¶aûhŞd”
Ñf.
št32
, 
sh­e
=(
NÚe
,))

501 
šput_is_üowd
 = 
tf
.
	`¶aûhŞd”
Ñf.
boŞ
, 
sh­e
=(
NÚe
,))

502 
šput_¬—
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
,))

503 
šput_difficuÉ
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
,))

504 
v®id_šdiûs
 = 
tf
.
	`¶aûhŞd”
Ñf.
št32
, 
sh­e
=(
NÚe
,))

505 
šput_‹nsÜs
 = {

506 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
šput_boxes
,

507 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
šput_şas£s
,

508 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd
: 
šput_is_üowd
,

509 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—
: 
šput_¬—
,

510 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_difficuÉ
: 
šput_difficuÉ


511 
	}
}

512 
ouut_‹nsÜs
 = 
İs
.
	$»š_groundŒuth
(
šput_‹nsÜs
, 
v®id_šdiûs
)

514 
ãed_diù
 = {

515 
šput_boxes
:

516 
Å
.
	`¬¿y
([], 
dty³
òp.).
	`»sh­e
(0, 4),

517 
šput_şas£s
:

518 
Å
.
	`¬¿y
([], 
dty³
òp.
št32
),

519 
šput_is_üowd
:

520 
Å
.
	`¬¿y
([], 
dty³
òp.
boŞ
),

521 
šput_¬—
:

522 
Å
.
	`¬¿y
([], 
dty³
òp.
æßt32
),

523 
šput_difficuÉ
:

524 
Å
.
	`¬¿y
([], 
dty³
òp.
æßt32
),

525 
v®id_šdiûs
:

526 
Å
.
	`¬¿y
([], 
dty³
òp.
št32
)

527 
	}
}

528 
w™h
 
	g£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

529 
ouut_‹nsÜs
 = 
£ss
.
	$run
(
ouut_‹nsÜs
, 
ãed_diù
=feed_dict)

530 
key
 
š
 
šput_‹nsÜs
:

531 
key
 =ğ
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
:

532 
£lf
.
	$as£¹AÎEqu®
([0, 4], 
ouut_‹nsÜs
[
key
].
sh­e
)

534 
£lf
.
	$as£¹AÎEqu®
([0], 
ouut_‹nsÜs
[
key
].
sh­e
)

537 
şass
 
	$R‘ašGroundTruthW™hPos™iveCÏs£s
(
tf
.
‹¡
.
Te¡Ca£
):

539 
def
 
	$‹¡_f‹r_groundŒuth_w™h_pos™ive_şas£s
(
£lf
):

540 
šput_image
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
, None, 3))

541 
šput_boxes
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
, 4))

542 
šput_şas£s
 = 
tf
.
	`¶aûhŞd”
Ñf.
št32
, 
sh­e
=(
NÚe
,))

543 
šput_is_üowd
 = 
tf
.
	`¶aûhŞd”
Ñf.
boŞ
, 
sh­e
=(
NÚe
,))

544 
šput_¬—
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
,))

545 
šput_difficuÉ
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
,))

546 
šput_Ïb–_ty³s
 = 
tf
.
	`¶aûhŞd”
Ñf.
¡ršg
, 
sh­e
=(
NÚe
,))

547 
v®id_šdiûs
 = 
tf
.
	`¶aûhŞd”
Ñf.
št32
, 
sh­e
=(
NÚe
,))

548 
šput_‹nsÜs
 = {

549 
f›lds
.
IÅutD©aF›lds
.
image
: 
šput_image
,

550 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
: 
šput_boxes
,

551 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
: 
šput_şas£s
,

552 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd
: 
šput_is_üowd
,

553 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—
: 
šput_¬—
,

554 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_difficuÉ
: 
šput_difficuÉ
,

555 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_Ïb–_ty³s
: 
šput_Ïb–_ty³s


556 
	}
}

557 
ouut_‹nsÜs
 = 
İs
.
	$»š_groundŒuth_w™h_pos™ive_şas£s
(
šput_‹nsÜs
)

559 
image_‹nsÜ
 = 
Å
.
¿ndom
.
	$¿nd
(224, 224, 3)

560 
ãed_diù
 = {

561 
šput_image
: 
image_‹nsÜ
,

562 
šput_boxes
:

563 
Å
.
	`¬¿y
([[0.2, 0.4, 0.1, 0.8], [0.2, 0.4, 1.0, 0.8]], 
dty³
=np.),

564 
šput_şas£s
:

565 
Å
.
	`¬¿y
([1, 0], 
dty³
òp.
št32
),

566 
šput_is_üowd
:

567 
Å
.
	`¬¿y
([
F®£
, 
True
], 
dty³
òp.
boŞ
),

568 
šput_¬—
:

569 
Å
.
	`¬¿y
([32, 48], 
dty³
òp.
æßt32
),

570 
šput_difficuÉ
:

571 
Å
.
	`¬¿y
([
True
, 
F®£
], 
dty³
òp.
boŞ
),

572 
šput_Ïb–_ty³s
:

573 
Å
.
	`¬¿y
(['APPROPRIATE', 'INCORRECT'], 
dty³
òp.
¡ršg_
),

574 
v®id_šdiûs
:

575 
Å
.
	`¬¿y
([0], 
dty³
òp.
št32
)

576 
	}
}

577 
	gex³ùed_‹nsÜs
 = {

578 
f›lds
.
IÅutD©aF›lds
.
image
:

579 
image_‹nsÜ
,

580 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
:

582 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
:

584 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd
:

585 [
F®£
],

586 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—
:

588 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_difficuÉ
:

589 [
True
],

590 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_Ïb–_ty³s
:

593 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

594 
ouut_‹nsÜs
 = 
£ss
.
	$run
(
ouut_‹nsÜs
, 
ãed_diù
=feed_dict)

595 
key
 
š
 [
f›lds
.
IÅutD©aF›lds
.
image
,

596 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
,

597 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—
]:

598 
£lf
.
	$as£¹AÎClo£
(
ex³ùed_‹nsÜs
[
key
], 
ouut_‹nsÜs
[key])

599 
key
 
š
 [
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
,

600 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd
,

601 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_Ïb–_ty³s
]:

602 
£lf
.
	$as£¹AÎEqu®
(
ex³ùed_‹nsÜs
[
key
], 
ouut_‹nsÜs
[key])

605 
şass
 
	$GroundŒuthF‹rW™hNªBoxTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

607 
def
 
	$‹¡_f‹r_groundŒuth_w™h_Çn_box_coÜdš©es
(
£lf
):

608 
šput_‹nsÜs
 = {

609 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
:

610 [[
Å
.
Çn
,‚p.nan,‚p.nan,‚p.nan], [0.2, 0.4, 0.1, 0.8]],

611 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
:

613 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd
:

614 [
F®£
, 
True
],

615 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—
:

617 
	}
}

619 
ex³ùed_‹nsÜs
 = {

620 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
:

622 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
:

624 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd
:

625 [
True
],

626 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—
:

630 
ouut_‹nsÜs
 = 
İs
.
	$f‹r_groundŒuth_w™h_Çn_box_coÜdš©es
(

631 
šput_‹nsÜs
)

632 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

633 
ouut_‹nsÜs
 = 
£ss
.
	$run
(
ouut_‹nsÜs
)

634 
key
 
š
 [
f›lds
.
IÅutD©aF›lds
.
groundŒuth_boxes
,

635 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_¬—
]:

636 
£lf
.
	$as£¹AÎClo£
(
ex³ùed_‹nsÜs
[
key
], 
ouut_‹nsÜs
[key])

637 
key
 
š
 [
f›lds
.
IÅutD©aF›lds
.
groundŒuth_şas£s
,

638 
f›lds
.
IÅutD©aF›lds
.
groundŒuth_is_üowd
]:

639 
£lf
.
	$as£¹AÎEqu®
(
ex³ùed_‹nsÜs
[
key
], 
ouut_‹nsÜs
[key])

642 
şass
 
	$OpsTe¡NÜm®izeToT¬g‘
(
tf
.
‹¡
.
Te¡Ca£
):

644 
def
 
	$‹¡_ü—‹_nÜm®ize_to_rg‘
(
£lf
):

645 
šputs
 = 
tf
.
	$¿ndom_unifÜm
([5, 10, 12, 3])

646 
rg‘_nÜm_v®ue
 = 4.0

647 
dim
 = 3

648 
w™h
 
£lf
.
	$‹¡_£ssiÚ
():

649 
ouut
 = 
İs
.
	$nÜm®ize_to_rg‘
(
šputs
, 
rg‘_nÜm_v®ue
, 
dim
)

650 
£lf
.
	`as£¹Equ®
(
ouut
.
İ
.
Çme
, 'NormalizeToTarget/mul')

651 
v¬_Çme
 = 
tf
.
cÚŒib
.
äamewÜk
.
	`g‘_v¬ŸbËs
()[0].
Çme


652 
£lf
.
	`as£¹Equ®
(
v¬_Çme
, 'NormalizeToTarget/weights:0')

654 
def
 
	$‹¡_šv®id_dim
(
£lf
):

655 
šputs
 = 
tf
.
	$¿ndom_unifÜm
([5, 10, 12, 3])

656 
rg‘_nÜm_v®ue
 = 4.0

657 
dim
 = 10

658 
w™h
 
£lf
.
	`as£¹Rai£sRegexp
(

659 
V®ueE¼Ü
,

661 
İs
.
	$nÜm®ize_to_rg‘
(
šputs
, 
rg‘_nÜm_v®ue
, 
dim
)

663 
def
 
	$‹¡_šv®id_rg‘_nÜm_v®ues
(
£lf
):

664 
šputs
 = 
tf
.
	$¿ndom_unifÜm
([5, 10, 12, 3])

665 
rg‘_nÜm_v®ue
 = [4.0, 4.0]

666 
dim
 = 3

667 
w™h
 
£lf
.
	`as£¹Rai£sRegexp
(

668 
V®ueE¼Ü
, 'target_norm_value must be‡ float or‡†ist of floats'):

669 
İs
.
	$nÜm®ize_to_rg‘
(
šputs
, 
rg‘_nÜm_v®ue
, 
dim
)

671 
def
 
	$‹¡_cÜ»ù_ouut_sh­e
(
£lf
):

672 
šputs
 = 
tf
.
	$¿ndom_unifÜm
([5, 10, 12, 3])

673 
rg‘_nÜm_v®ue
 = 4.0

674 
dim
 = 3

675 
w™h
 
£lf
.
	$‹¡_£ssiÚ
():

676 
ouut
 = 
İs
.
	$nÜm®ize_to_rg‘
(
šputs
, 
rg‘_nÜm_v®ue
, 
dim
)

677 
£lf
.
	`as£¹Equ®
(
ouut
.
	`g‘_sh­e
().
	`as_li¡
(),

678 
šputs
.
	`g‘_sh­e
().
	$as_li¡
())

680 
def
 
	$‹¡_cÜ»ù_š™Ÿl_ouut_v®ues
(
£lf
):

681 
šputs
 = 
tf
.
	`cÚ¡ªt
([[[[3, 4], [7, 24]],

682 [[5, -12], [-1, 0]]]], 
tf
.
æßt32
)

683 
rg‘_nÜm_v®ue
 = 10.0

684 
dim
 = 3

685 
ex³ùed_ouut
 = [[[[30/5.0, 40/5.0], [70/25.0, 240/25.0]],

687 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

688 
nÜm®ized_šputs
 = 
İs
.
	$nÜm®ize_to_rg‘
(
šputs
, 
rg‘_nÜm_v®ue
,

689 
dim
)

690 
£ss
.
	`run
(
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
())

691 
ouut
 = 
nÜm®ized_šputs
.
	$ev®
()

692 
£lf
.
	$as£¹AÎClo£
(
ouut
, 
ex³ùed_ouut
)

694 
def
 
	$‹¡_muÉË_rg‘_nÜm_v®ues
(
£lf
):

695 
šputs
 = 
tf
.
	`cÚ¡ªt
([[[[3, 4], [7, 24]],

696 [[5, -12], [-1, 0]]]], 
tf
.
æßt32
)

697 
rg‘_nÜm_v®ue
 = [10.0, 20.0]

698 
dim
 = 3

699 
ex³ùed_ouut
 = [[[[30/5.0, 80/5.0], [70/25.0, 480/25.0]],

701 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

702 
nÜm®ized_šputs
 = 
İs
.
	$nÜm®ize_to_rg‘
(
šputs
, 
rg‘_nÜm_v®ue
,

703 
dim
)

704 
£ss
.
	`run
(
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
())

705 
ouut
 = 
nÜm®ized_šputs
.
	$ev®
()

706 
£lf
.
	$as£¹AÎClo£
(
ouut
, 
ex³ùed_ouut
)

709 
şass
 
	$OpsTe¡Pos™iÚS’s™iveCrİRegiÚs
(
tf
.
‹¡
.
Te¡Ca£
):

711 
def
 
	$‹¡_pos™iÚ_£ns™ive
(
£lf
):

712 
num_¥©Ÿl_bšs
 = [3, 2]

713 
image_sh­e
 = [1, 3, 2, 6]

715 #Fœ¡ 
chªÃl
 
is
 1's, secÚd chªÃÈi 2'
s
, 
‘c
.

716 
image
 = 
tf
.
	`cÚ¡ªt
(
	`¿nge
(1, 3 * 2 + 1è* 6, 
dty³
ñf.
æßt32
,

717 
sh­e
=
image_sh­e
)

718 
boxes
 = 
tf
.
	`¿ndom_unifÜm
((2, 4))

719 
box_šd
 = 
tf
.
	$cÚ¡ªt
([0, 0], 
dty³
=
tf
.
št32
)

721 #Th
»suÉ
 
bÙh
 
boxes
 
should
 
be
 [[1, 2], [3, 4], [5, 6]]

722 #befÜ
av”agšg
.

723 
ex³ùed_ouut
 = 
Å
.
	`¬¿y
([3.5, 3.5]).
	$»sh­e
([2, 1, 1, 1])

725 
üİ_size_muÉ
 
š
 
	$¿nge
(1, 3):

726 
üİ_size
 = [3 * 
üİ_size_muÉ
, 2 * crop_size_mult]

727 
ps_üİ_ªd_poŞ
 = 
İs
.
	$pos™iÚ_£ns™ive_üİ_»giÚs
(

728 
image
, 
boxes
, 
box_šd
, 
üİ_size
, 
num_¥©Ÿl_bšs
, 
glob®_poŞ
=
True
)

730 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

731 
ouut
 = 
£ss
.
	$run
(
ps_üİ_ªd_poŞ
)

732 
£lf
.
	$as£¹AÎClo£
(
ouut
, 
ex³ùed_ouut
)

734 
def
 
	$‹¡_pos™iÚ_£ns™ive_w™h_equ®_chªÃls
(
£lf
):

735 
num_¥©Ÿl_bšs
 = [2, 2]

736 
image_sh­e
 = [1, 3, 3, 4]

737 
üİ_size
 = [2, 2]

739 
image
 = 
tf
.
	`cÚ¡ªt
(
	`¿nge
(1, 3 * 3 + 1), 
dty³
ñf.
æßt32
,

740 
sh­e
=[1, 3, 3, 1])

741 
ted_image
 = 
tf
.
	$te
(
image
, [1, 1, 1, 
image_sh­e
[3]])

742 
boxes
 = 
tf
.
	`¿ndom_unifÜm
((3, 4))

743 
box_šd
 = 
tf
.
	$cÚ¡ªt
([0, 0, 0], 
dty³
=
tf
.
št32
)

745 #AÎ 
chªÃls
 
¬e
 
equ®
 
so
 
pos™iÚ
-
£ns™ive
 
üİ
 
ªd
 
»size
 
should


746 #wÜk 
as
 
the
 
usu®
 
üİ
 
ªd
 
»size
 
ju¡
 
Úe
 
chªÃl
.

747 
üİ
 = 
tf
.
image
.
	$üİ_ªd_»size
(
image
, 
boxes
, 
box_šd
, 
üİ_size
)

748 
üİ_ªd_poŞ
 = 
tf
.
	$»duû_m—n
(
üİ
, [1, 2], 
k“p_dims
=
True
)

750 
ps_üİ_ªd_poŞ
 = 
İs
.
	$pos™iÚ_£ns™ive_üİ_»giÚs
(

751 
ted_image
,

752 
boxes
,

753 
box_šd
,

754 
üİ_size
,

755 
num_¥©Ÿl_bšs
,

756 
glob®_poŞ
=
True
)

758 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

759 
ex³ùed_ouut
, 
ouut
 = 
£ss
.
	`run
((
üİ_ªd_poŞ
, 
ps_üİ_ªd_poŞ
))

760 
£lf
.
	$as£¹AÎClo£
(
ouut
, 
ex³ùed_ouut
)

762 
def
 
	$‹¡_pos™iÚ_£ns™ive_w™h_sšgË_bš
(
£lf
):

763 
num_¥©Ÿl_bšs
 = [1, 1]

764 
image_sh­e
 = [2, 3, 3, 4]

765 
üİ_size
 = [2, 2]

767 
image
 = 
tf
.
	$¿ndom_unifÜm
(
image_sh­e
)

768 
boxes
 = 
tf
.
	`¿ndom_unifÜm
((6, 4))

769 
box_šd
 = 
tf
.
	$cÚ¡ªt
([0, 0, 0, 1, 1, 1], 
dty³
=
tf
.
št32
)

771 #Wh’ 
a
 
sšgË
 
bš
 
is
 
u£d
, 
pos™iÚ
-
£ns™ive
 
üİ
 
ªd
 
poŞ
 
should
 
be


772 #th
§me
 
as
 
nÚ
-
pos™iÚ
 
£ns™ive
 
üİ
 
ªd
 
poŞ
.

773 
üİ
 = 
tf
.
image
.
	$üİ_ªd_»size
(
image
, 
boxes
, 
box_šd
, 
üİ_size
)

774 
üİ_ªd_poŞ
 = 
tf
.
	$»duû_m—n
(
üİ
, [1, 2], 
k“p_dims
=
True
)

776 
ps_üİ_ªd_poŞ
 = 
İs
.
	$pos™iÚ_£ns™ive_üİ_»giÚs
(

777 
image
, 
boxes
, 
box_šd
, 
üİ_size
, 
num_¥©Ÿl_bšs
, 
glob®_poŞ
=
True
)

779 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

780 
ex³ùed_ouut
, 
ouut
 = 
£ss
.
	`run
((
üİ_ªd_poŞ
, 
ps_üİ_ªd_poŞ
))

781 
£lf
.
	$as£¹AÎClo£
(
ouut
, 
ex³ùed_ouut
)

783 
def
 
	$‹¡_¿i£_v®ue_”rÜ_Ú_num_bšs_Ëss_thª_Úe
(
£lf
):

784 
num_¥©Ÿl_bšs
 = [1, -1]

785 
image_sh­e
 = [1, 1, 1, 2]

786 
üİ_size
 = [2, 2]

788 
image
 = 
tf
.
	$cÚ¡ªt
(1, 
dty³
=
tf
.
æßt32
, 
sh­e
=
image_sh­e
)

789 
boxes
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 1, 1]], 
dty³
=
tf
.
æßt32
)

790 
box_šd
 = 
tf
.
	$cÚ¡ªt
([0], 
dty³
=
tf
.
št32
)

792 
w™h
 
£lf
.
	`as£¹Rai£sRegexp
(
V®ueE¼Ü
, 'num_spatial_bins should be >= 1'):

793 
İs
.
	$pos™iÚ_£ns™ive_üİ_»giÚs
(

794 
image
, 
boxes
, 
box_šd
, 
üİ_size
, 
num_¥©Ÿl_bšs
, 
glob®_poŞ
=
True
)

796 
def
 
	$‹¡_¿i£_v®ue_”rÜ_Ú_nÚ_divisibË_üİ_size
(
£lf
):

797 
num_¥©Ÿl_bšs
 = [2, 3]

798 
image_sh­e
 = [1, 1, 1, 6]

799 
üİ_size
 = [3, 2]

801 
image
 = 
tf
.
	$cÚ¡ªt
(1, 
dty³
=
tf
.
æßt32
, 
sh­e
=
image_sh­e
)

802 
boxes
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 1, 1]], 
dty³
=
tf
.
æßt32
)

803 
box_šd
 = 
tf
.
	$cÚ¡ªt
([0], 
dty³
=
tf
.
št32
)

805 
w™h
 
£lf
.
	`as£¹Rai£sRegexp
(

806 
V®ueE¼Ü
, 'crop_size should be divisible by‚um_spatial_bins'):

807 
İs
.
	$pos™iÚ_£ns™ive_üİ_»giÚs
(

808 
image
, 
boxes
, 
box_šd
, 
üİ_size
, 
num_¥©Ÿl_bšs
, 
glob®_poŞ
=
True
)

810 
def
 
	$‹¡_¿i£_v®ue_”rÜ_Ú_nÚ_divisibË_num_chªÃls
(
£lf
):

811 
num_¥©Ÿl_bšs
 = [2, 2]

812 
image_sh­e
 = [1, 1, 1, 5]

813 
üİ_size
 = [2, 2]

815 
image
 = 
tf
.
	$cÚ¡ªt
(1, 
dty³
=
tf
.
æßt32
, 
sh­e
=
image_sh­e
)

816 
boxes
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 1, 1]], 
dty³
=
tf
.
æßt32
)

817 
box_šd
 = 
tf
.
	$cÚ¡ªt
([0], 
dty³
=
tf
.
št32
)

819 
w™h
 
£lf
.
	`as£¹Rai£sRegexp
(

820 
V®ueE¼Ü
, 'Dimension size must beƒvenly divisible by 4 but is 5'):

821 
İs
.
	$pos™iÚ_£ns™ive_üİ_»giÚs
(

822 
image
, 
boxes
, 
box_šd
, 
üİ_size
, 
num_¥©Ÿl_bšs
, 
glob®_poŞ
=
True
)

824 
def
 
	$‹¡_pos™iÚ_£ns™ive_w™h_glob®_poŞ_çl£
(
£lf
):

825 
num_¥©Ÿl_bšs
 = [3, 2]

826 
image_sh­e
 = [1, 3, 2, 6]

827 
num_boxes
 = 2

829 #Fœ¡ 
chªÃl
 
is
 1's, secÚd chªÃÈi 2'
s
, 
‘c
.

830 
image
 = 
tf
.
	`cÚ¡ªt
(
	`¿nge
(1, 3 * 2 + 1è* 6, 
dty³
ñf.
æßt32
,

831 
sh­e
=
image_sh­e
)

832 
boxes
 = 
tf
.
	`¿ndom_unifÜm
((
num_boxes
, 4))

833 
box_šd
 = 
tf
.
	$cÚ¡ªt
([0, 0], 
dty³
=
tf
.
št32
)

835 
ex³ùed_ouut
 = []

837 #Ex³ùed 
ouut
, 
wh’
 
üİ_size
 = [3, 2].

838 
ex³ùed_ouut
.
	`­³nd
(
Å
.
	`ex·nd_dims
(

839 
Å
.
	`te
Òp.
	`¬¿y
([[1, 2],

841 [5, 6]]), (
num_boxes
, 1, 1)),

842 
axis
=-1))

844 #Ex³ùed 
ouut
, 
wh’
 
üİ_size
 = [6, 4].

845 
ex³ùed_ouut
.
	`­³nd
(
Å
.
	`ex·nd_dims
(

846 
Å
.
	`te
Òp.
	`¬¿y
([[1, 1, 2, 2],

851 [5, 5, 6, 6]]), (
num_boxes
, 1, 1)),

852 
axis
=-1))

854 
üİ_size_muÉ
 
š
 
	$¿nge
(1, 3):

855 
üİ_size
 = [3 * 
üİ_size_muÉ
, 2 * crop_size_mult]

856 
ps_üİ
 = 
İs
.
	$pos™iÚ_£ns™ive_üİ_»giÚs
(

857 
image
, 
boxes
, 
box_šd
, 
üİ_size
, 
num_¥©Ÿl_bšs
, 
glob®_poŞ
=
F®£
)

858 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

859 
ouut
 = 
£ss
.
	$run
(
ps_üİ
)

861 
£lf
.
	`as£¹AÎEqu®
(
ouut
, 
ex³ùed_ouut
[
üİ_size_muÉ
 - 1])

863 
def
 
	$‹¡_pos™iÚ_£ns™ive_w™h_glob®_poŞ_çl£_ªd_known_boxes
(
£lf
):

864 
num_¥©Ÿl_bšs
 = [2, 2]

865 
image_sh­e
 = [2, 2, 2, 4]

866 
üİ_size
 = [2, 2]

868 
image
 = 
tf
.
	`cÚ¡ªt
(
	`¿nge
(1, 2 * 2 * 4 + 1è* 2, 
dty³
ñf.
æßt32
,

869 
sh­e
=
image_sh­e
)

871 #Fœ¡ 
box
 
cÚšs
 
whŞe
 
image
, 
ªd
 
£cÚd
 box cÚš 
Úly
 
fœ¡
 
row
.

872 
boxes
 = 
tf
.
	`cÚ¡ªt
(
Å
.
	`¬¿y
([[0., 0., 1., 1.],

873 [0., 0., 0.5, 1.]]), 
dty³
=
tf
.
æßt32
)

874 
box_šd
 = 
tf
.
	$cÚ¡ªt
([0, 1], 
dty³
=
tf
.
št32
)

876 
ex³ùed_ouut
 = []

878 #Ex³ùed 
ouut
, 
wh’
 
the
 
box
 
cÚššg
 
whŞe
 
image
.

879 
ex³ùed_ouut
.
	`­³nd
(

880 
Å
.
	`»sh­e
Òp.
	`¬¿y
([[4, 7],

885 #Ex³ùed 
ouut
, 
wh’
 
the
 
box
 
cÚššg
 
Úly
 
fœ¡
 
row
.

886 
ex³ùed_ouut
.
	`­³nd
(

887 
Å
.
	`»sh­e
Òp.
	`¬¿y
([[3, 6],

891 
ex³ùed_ouut
 = 
Å
.
	$cÚÿ‹Ç‹
(
ex³ùed_ouut
, 
axis
=0)

893 
ps_üİ
 = 
İs
.
	$pos™iÚ_£ns™ive_üİ_»giÚs
(

894 
image
, 
boxes
, 
box_šd
, 
üİ_size
, 
num_¥©Ÿl_bšs
, 
glob®_poŞ
=
F®£
)

896 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

897 
ouut
 = 
£ss
.
	$run
(
ps_üİ
)

898 
£lf
.
	$as£¹AÎEqu®
(
ouut
, 
ex³ùed_ouut
)

900 
def
 
	$‹¡_pos™iÚ_£ns™ive_w™h_glob®_poŞ_çl£_ªd_sšgË_bš
(
£lf
):

901 
num_¥©Ÿl_bšs
 = [1, 1]

902 
image_sh­e
 = [2, 3, 3, 4]

903 
üİ_size
 = [1, 1]

905 
image
 = 
tf
.
	$¿ndom_unifÜm
(
image_sh­e
)

906 
boxes
 = 
tf
.
	`¿ndom_unifÜm
((6, 4))

907 
box_šd
 = 
tf
.
	$cÚ¡ªt
([0, 0, 0, 1, 1, 1], 
dty³
=
tf
.
št32
)

909 #Sšû 
sšgË_bš
 
is
 
u£d
 
ªd
 
üİ_size
 = [1, 1] (
i
.
e
., 
no
 
üİ
 
»size
),

910 #th
ouuts
 
¬e
 
the
 
§me
 
wh©ev”
h
glob®_poŞ
 
v®ue
 
is
.

911 
ps_üİ_ªd_poŞ
 = 
İs
.
	$pos™iÚ_£ns™ive_üİ_»giÚs
(

912 
image
, 
boxes
, 
box_šd
, 
üİ_size
, 
num_¥©Ÿl_bšs
, 
glob®_poŞ
=
True
)

913 
ps_üİ
 = 
İs
.
	$pos™iÚ_£ns™ive_üİ_»giÚs
(

914 
image
, 
boxes
, 
box_šd
, 
üİ_size
, 
num_¥©Ÿl_bšs
, 
glob®_poŞ
=
F®£
)

916 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

917 
poŞed_ouut
, 
uÅoŞed_ouut
 = 
£ss
.
	`run
((
ps_üİ_ªd_poŞ
, 
ps_üİ
))

918 
£lf
.
	$as£¹AÎClo£
(
poŞed_ouut
, 
uÅoŞed_ouut
)

920 
def
 
	$‹¡_pos™iÚ_£ns™ive_w™h_glob®_poŞ_çl£_ªd_do_glob®_poŞ
(
£lf
):

921 
num_¥©Ÿl_bšs
 = [3, 2]

922 
image_sh­e
 = [1, 3, 2, 6]

923 
num_boxes
 = 2

925 #Fœ¡ 
chªÃl
 
is
 1's, secÚd chªÃÈi 2'
s
, 
‘c
.

926 
image
 = 
tf
.
	`cÚ¡ªt
(
	`¿nge
(1, 3 * 2 + 1è* 6, 
dty³
ñf.
æßt32
,

927 
sh­e
=
image_sh­e
)

928 
boxes
 = 
tf
.
	`¿ndom_unifÜm
((
num_boxes
, 4))

929 
box_šd
 = 
tf
.
	$cÚ¡ªt
([0, 0], 
dty³
=
tf
.
št32
)

931 
ex³ùed_ouut
 = []

933 #Ex³ùed 
ouut
, 
wh’
 
üİ_size
 = [3, 2].

934 
ex³ùed_ouut
.
	`­³nd
(
Å
.
	`m—n
(

935 
Å
.
	`ex·nd_dims
(

936 
Å
.
	`te
Òp.
	`¬¿y
([[1, 2],

938 [5, 6]]), (
num_boxes
, 1, 1)),

939 
axis
=-1),

940 
axis
=(1, 2), 
k“pdims
=
True
))

942 #Ex³ùed 
ouut
, 
wh’
 
üİ_size
 = [6, 4].

943 
ex³ùed_ouut
.
	`­³nd
(
Å
.
	`m—n
(

944 
Å
.
	`ex·nd_dims
(

945 
Å
.
	`te
Òp.
	`¬¿y
([[1, 1, 2, 2],

950 [5, 5, 6, 6]]), (
num_boxes
, 1, 1)),

951 
axis
=-1),

952 
axis
=(1, 2), 
k“pdims
=
True
))

954 
üİ_size_muÉ
 
š
 
	$¿nge
(1, 3):

955 
üİ_size
 = [3 * 
üİ_size_muÉ
, 2 * crop_size_mult]

957 #P”fÜm 
glob®_poŞšg
 
aá”
 
ruÂšg
 
the
 
funùiÚ
 
w™h


958 #glob®_poŞ=
F®£
.

959 
ps_üİ
 = 
İs
.
	$pos™iÚ_£ns™ive_üİ_»giÚs
(

960 
image
, 
boxes
, 
box_šd
, 
üİ_size
, 
num_¥©Ÿl_bšs
, 
glob®_poŞ
=
F®£
)

961 
ps_üİ_ªd_poŞ
 = 
tf
.
	`»duû_m—n
(

962 
ps_üİ
, 
»duùiÚ_šdiûs
=(1, 2), 
k“p_dims
=
True
)

964 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

965 
ouut
 = 
£ss
.
	$run
(
ps_üİ_ªd_poŞ
)

967 
£lf
.
	`as£¹AÎEqu®
(
ouut
, 
ex³ùed_ouut
[
üİ_size_muÉ
 - 1])

969 
def
 
	$‹¡_¿i£_v®ue_”rÜ_Ú_nÚ_squ¬e_block_size
(
£lf
):

970 
num_¥©Ÿl_bšs
 = [3, 2]

971 
image_sh­e
 = [1, 3, 2, 6]

972 
üİ_size
 = [6, 2]

974 
image
 = 
tf
.
	$cÚ¡ªt
(1, 
dty³
=
tf
.
æßt32
, 
sh­e
=
image_sh­e
)

975 
boxes
 = 
tf
.
	$cÚ¡ªt
([[0, 0, 1, 1]], 
dty³
=
tf
.
æßt32
)

976 
box_šd
 = 
tf
.
	$cÚ¡ªt
([0], 
dty³
=
tf
.
št32
)

978 
w™h
 
£lf
.
	`as£¹Rai£sRegexp
(

979 
V®ueE¼Ü
, 'Only support square bin crop size for‚ow.'):

980 
İs
.
	$pos™iÚ_£ns™ive_üİ_»giÚs
(

981 
image
, 
boxes
, 
box_šd
, 
üİ_size
, 
num_¥©Ÿl_bšs
, 
glob®_poŞ
=
F®£
)

984 
şass
 
	$ReäameBoxMasksToImageMasksTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

986 
def
 
	$‹¡Z”oImageOnEm±yMask
(
£lf
):

987 
box_masks
 = 
tf
.
	$cÚ¡ªt
([[[0, 0],

988 [0, 0]]], 
dty³
=
tf
.
æßt32
)

989 
boxes
 = 
tf
.
	$cÚ¡ªt
([[0.0, 0.0, 1.0, 1.0]], 
dty³
=
tf
.
æßt32
)

990 
image_masks
 = 
İs
.
	$»äame_box_masks_to_image_masks
(
box_masks
, 
boxes
,

991 
image_height
=4,

992 
image_width
=4)

993 
Å_ex³ùed_image_masks
 = 
Å
.
	$¬¿y
([[[0, 0, 0, 0],

996 [0, 0, 0, 0]]], 
dty³
=
Å
.
æßt32
)

997 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

998 
Å_image_masks
 = 
£ss
.
	$run
(
image_masks
)

999 
£lf
.
	$as£¹AÎClo£
(
Å_image_masks
, 
Å_ex³ùed_image_masks
)

1001 
def
 
	$‹¡MaskIsC’‹»dInImageWh’BoxIsC’‹»d
(
£lf
):

1002 
box_masks
 = 
tf
.
	$cÚ¡ªt
([[[1, 1],

1003 [1, 1]]], 
dty³
=
tf
.
æßt32
)

1004 
boxes
 = 
tf
.
	$cÚ¡ªt
([[0.25, 0.25, 0.75, 0.75]], 
dty³
=
tf
.
æßt32
)

1005 
image_masks
 = 
İs
.
	$»äame_box_masks_to_image_masks
(
box_masks
, 
boxes
,

1006 
image_height
=4,

1007 
image_width
=4)

1008 
Å_ex³ùed_image_masks
 = 
Å
.
	$¬¿y
([[[0, 0, 0, 0],

1011 [0, 0, 0, 0]]], 
dty³
=
Å
.
æßt32
)

1012 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1013 
Å_image_masks
 = 
£ss
.
	$run
(
image_masks
)

1014 
£lf
.
	$as£¹AÎClo£
(
Å_image_masks
, 
Å_ex³ùed_image_masks
)

1016 
def
 
	$‹¡MaskOffC’‹rRemašsOffC’‹rInImage
(
£lf
):

1017 
box_masks
 = 
tf
.
	$cÚ¡ªt
([[[1, 0],

1018 [0, 1]]], 
dty³
=
tf
.
æßt32
)

1019 
boxes
 = 
tf
.
	$cÚ¡ªt
([[0.25, 0.5, 0.75, 1.0]], 
dty³
=
tf
.
æßt32
)

1020 
image_masks
 = 
İs
.
	$»äame_box_masks_to_image_masks
(
box_masks
, 
boxes
,

1021 
image_height
=4,

1022 
image_width
=4)

1023 
Å_ex³ùed_image_masks
 = 
Å
.
	$¬¿y
([[[0, 0, 0, 0],

1026 [0, 0, 0, 0]]], 
dty³
=
Å
.
æßt32
)

1027 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

1028 
Å_image_masks
 = 
£ss
.
	$run
(
image_masks
)

1029 
£lf
.
	$as£¹AÎClo£
(
Å_image_masks
, 
Å_ex³ùed_image_masks
)

1032 
__Çme__
 == '__main__':

1033 
tf
.
‹¡
.
	`maš
()

	@utils/per_image_evaluation.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
AÂÙ©e
 
—ch
 
d‘eùed
 
»suÉ
 
as
 
Œue
 
pos™ives
 
Ü
 
çl£
 
pos™ive
 
accÜdšg
 
to


19 
a
 
´edefšed
 
IOU
 
	g¿tio
. 
NÚ
 
Maximum
 
Su´essiÚ
 
is
 
u£d
 
by
 . 
MuÉi
 
şass


20 
d‘eùiÚ
 
is
 
suµÜ‹d
 
by
 .

22 
impÜt
 
numpy
 
as
 
Å


24 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
Å_box_li¡


25 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
Å_box_li¡_İs


28 
şass
 
	$P”ImageEv®u©iÚ
(
objeù
):

31 
def
 
	$__š™__
(
£lf
,

32 
num_groundŒuth_şas£s
,

33 
m©chšg_iou_th»shŞd
=0.5,

34 
nms_iou_th»shŞd
=0.3,

35 
nms_max_ouut_boxes
=50):

38 
Args
:

39 
num_groundŒuth_şas£s
: 
Numb”
 
of
 
ground
 
Œuth
 
objeù
 
şas£s


40 
m©chšg_iou_th»shŞd
: 
A
 
¿tio
 
of
 
¬—
 
š‹r£ùiÚ
 
to
 , 
which
 
is


41 
the
 
th»shŞd
 
to
 
cÚsid”
 
wh‘h”
 
a
 
d‘eùiÚ
 
is
 
Œue
 
pos™ive
 
Ü
 
nÙ


42 
nms_iou_th»shŞd
: 
IOU
 
th»shŞd
 
u£d
 
š
 
NÚ
 
Maximum
 
Suµ»ssiÚ
.

43 
nms_max_ouut_boxes
: 
Numb”
 
of
 
maximum
 
ouut
 
boxes
 
š
 
NMS
.

45 
£lf
.
m©chšg_iou_th»shŞd
 = matching_iou_threshold

46 
£lf
.
nms_iou_th»shŞd
 =‚ms_iou_threshold

47 
£lf
.
nms_max_ouut_boxes
 =‚ms_max_output_boxes

48 
£lf
.
num_groundŒuth_şas£s
 =‚um_groundtruth_classes

50 
def
 
	$compu‹_objeù_d‘eùiÚ_m‘rics
(
£lf
, 
d‘eùed_boxes
, 
d‘eùed_scÜes
,

51 
d‘eùed_şass_Ïb–s
, 
groundŒuth_boxes
,

52 
groundŒuth_şass_Ïb–s
,

53 
groundŒuth_is_difficuÉ_li¡s
):

56 
Args
:

57 
d‘eùed_boxes
: 
A
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 4], 
»´e£Ášg
 N

58 
»giÚs
 
of
 
d‘eùed
 
objeù
„egions.

59 
Each
 
row
 
is
 
of
 
the
 
fÜm©
 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
]

60 
d‘eùed_scÜes
: 
A
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 1], 
»´e£Ášg


61 
the
 
cÚfid’û
 
scÜes
 
of
h
d‘eùed
 
N
 
objeù
 
š¡ªûs
.

62 
d‘eùed_şass_Ïb–s
: 
A
 
š‹g”
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 1], 
»´’‘šg


63 
the
 
şass
 
Ïb–s
 
of
h
d‘eùed
 
N
 
objeù
 
š¡ªûs
.

64 
groundŒuth_boxes
: 
A
 
numpy
 
¬¿y
 
of
 
sh­e
 [
M
, 4], 
»´e£Ášg
 M

65 
»giÚs
 
of
 
objeù
 
š¡ªûs
 
š
 
ground
 
Œuth


66 
groundŒuth_şass_Ïb–s
: 
An
 
š‹g”
 
numpy
 
¬¿y
 
of
 
sh­e
 [
M
, 1],

67 
»´e£Ášg
 
M
 
şass
 
Ïb–s
 
of
 
objeù
 
š¡ªûs
 
š
 
ground
 
Œuth


68 
groundŒuth_is_difficuÉ_li¡s
: 
A
 
boŞ—n
 
numpy
 
¬¿y
 
of
 
Ëngth
 
M
 
d’Ùšg


69 
wh‘h”
 
a
 
ground
 
Œuth
 
box
 
is
‡ 
difficuÉ
 
š¡ªû
 
Ü
 
nÙ


71 
R‘uºs
:

72 
scÜes
: 
A
 
li¡
 
of
 
C
 
numpy
 
¬¿ys
. 
Each
‚umpy 
¬¿y
 
is
 of

73 
sh­e
 [
K
, 1], 
»´e£Ášg
 K 
scÜes
 
d‘eùed
 
w™h
 
objeù
 
şass


74 
Ïb–
 
c


75 
_å_Ïb–s
: 
A
 
li¡
 
of
 
C
 
boŞ—n
 
numpy
 
¬¿ys
. 
Each
‚umpy 
¬¿y


76 
is
 
of
 
sh­e
 [
K
, 1], 
»´e£Ášg
 K 
True
/
F®£
 
pos™ive
 
Ïb–
 of

77 
objeù
 
š¡ªûs
 
d‘eùed
 
w™h
 
şass
 
Ïb–
 
c


78 
is_şass_cÜ»ùly_d‘eùed_š_image
: 
a
 
numpy
 
š‹g”
 
¬¿y
 
of


79 
sh­e
 [
C
, 1], 
šdiÿtšg
 
wh‘h”
 
the
 
cÜ»pÚdšg
 
şass
 
has
 
a
 
Ëa¡


80 
Úe
 
š¡ªû
 
bešg
 
cÜ»ùly
 
d‘eùed
 
š
 
the
 
image


82 
d‘eùed_boxes
, 
d‘eùed_scÜes
, 
d‘eùed_şass_Ïb–s
 = (

83 
£lf
.
	$_»move_šv®id_boxes
(
d‘eùed_boxes
, 
d‘eùed_scÜes
,

84 
d‘eùed_şass_Ïb–s
))

85 
scÜes
, 
_å_Ïb–s
 = 
£lf
.
	$_compu‹__å
(

86 
d‘eùed_boxes
, 
d‘eùed_scÜes
, 
d‘eùed_şass_Ïb–s
,

87 
groundŒuth_boxes
, 
groundŒuth_şass_Ïb–s
,

88 
groundŒuth_is_difficuÉ_li¡s
)

89 
is_şass_cÜ»ùly_d‘eùed_š_image
 = 
£lf
.
	$_compu‹_cÜ_loc
(

90 
d‘eùed_boxes
, 
d‘eùed_scÜes
, 
d‘eùed_şass_Ïb–s
,

91 
groundŒuth_boxes
, 
groundŒuth_şass_Ïb–s
)

92  
scÜes
, 
_å_Ïb–s
, 
is_şass_cÜ»ùly_d‘eùed_š_image


94 
def
 
	$_compu‹_cÜ_loc
(
£lf
, 
d‘eùed_boxes
, 
d‘eùed_scÜes
,

95 
d‘eùed_şass_Ïb–s
, 
groundŒuth_boxes
,

96 
groundŒuth_şass_Ïb–s
):

99 
Args
:

100 
d‘eùed_boxes
: 
A
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 4], 
»´e£Ášg
 N

101 
»giÚs
 
of
 
d‘eùed
 
objeù
„egions.

102 
Each
 
row
 
is
 
of
 
the
 
fÜm©
 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
]

103 
d‘eùed_scÜes
: 
A
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 1], 
»´e£Ášg


104 
the
 
cÚfid’û
 
scÜes
 
of
h
d‘eùed
 
N
 
objeù
 
š¡ªûs
.

105 
d‘eùed_şass_Ïb–s
: 
A
 
š‹g”
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 1], 
»´’‘šg


106 
the
 
şass
 
Ïb–s
 
of
h
d‘eùed
 
N
 
objeù
 
š¡ªûs
.

107 
groundŒuth_boxes
: 
A
 
numpy
 
¬¿y
 
of
 
sh­e
 [
M
, 4], 
»´e£Ášg
 M

108 
»giÚs
 
of
 
objeù
 
š¡ªûs
 
š
 
ground
 
Œuth


109 
groundŒuth_şass_Ïb–s
: 
An
 
š‹g”
 
numpy
 
¬¿y
 
of
 
sh­e
 [
M
, 1],

110 
»´e£Ášg
 
M
 
şass
 
Ïb–s
 
of
 
objeù
 
š¡ªûs
 
š
 
ground
 
Œuth


111 
R‘uºs
:

112 
is_şass_cÜ»ùly_d‘eùed_š_image
: 
a
 
numpy
 
š‹g”
 
¬¿y
 
of


113 
sh­e
 [
C
, 1], 
šdiÿtšg
 
wh‘h”
 
the
 
cÜ»pÚdšg
 
şass
 
has
 
a
 
Ëa¡


114 
Úe
 
š¡ªû
 
bešg
 
cÜ»ùly
 
d‘eùed
 
š
 
the
 
image


116 
is_şass_cÜ»ùly_d‘eùed_š_image
 = 
Å
.
	$z”os
(

117 
£lf
.
num_groundŒuth_şas£s
, 
dty³
=)

118 
i
 
š
 
	$¿nge
(
£lf
.
num_groundŒuth_şas£s
):

119 
gt_boxes_©_™h_şass
 = 
groundŒuth_boxes
[

120 
groundŒuth_şass_Ïb–s
 =ğ
i
, :]

121 
d‘eùed_boxes_©_™h_şass
 = 
d‘eùed_boxes
[

122 
d‘eùed_şass_Ïb–s
 =ğ
i
, :]

123 
d‘eùed_scÜes_©_™h_şass
 = 
d‘eùed_scÜes
[
d‘eùed_şass_Ïb–s
 =ğ
i
]

124 
is_şass_cÜ»ùly_d‘eùed_š_image
[
i
] = (

125 
£lf
.
	$_compu‹_is_aşass_cÜ»ùly_d‘eùed_š_image
(

126 
d‘eùed_boxes_©_™h_şass
, 
d‘eùed_scÜes_©_™h_şass
,

127 
gt_boxes_©_™h_şass
))

129  
is_şass_cÜ»ùly_d‘eùed_š_image


131 
def
 
	$_compu‹_is_aşass_cÜ»ùly_d‘eùed_š_image
(

132 
£lf
, 
d‘eùed_boxes
, 
d‘eùed_scÜes
, 
groundŒuth_boxes
):

135 
Args
:

136 
d‘eùed_boxes
: 
A
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 4] 
»´e£Ášg
 
d‘eùed
 
box


137 
coÜdš©es


138 
d‘eùed_scÜes
: 
A
 1-
d
 
numpy
 
¬¿y
 
of
 
Ëngth
 
N
 
»´e£Ášg
 
şassifiÿtiÚ


139 
scÜe


140 
groundŒuth_boxes
: 
A
 
numpy
 
¬¿y
 
of
 
sh­e
 [
M
, 4] 
»´e£Ášg
 
ground
 
Œuth


141 
box
 
coÜdš©es


143 
R‘uºs
:

144 
is_şass_cÜ»ùly_d‘eùed_š_image
: 
An
 
š‹g”
 1 
Ü
 0 
d’Ùšg
 
wh‘h”
 
a


145 
şass
 
is
 
cÜ»ùly
 
d‘eùed
 
š
 
the
 
image
 
Ü
 
nÙ


147 
d‘eùed_boxes
.
size
 > 0:

148 
groundŒuth_boxes
.
size
 > 0:

149 
max_scÜe_id
 = 
Å
.
	$¬gmax
(
d‘eùed_scÜes
)

150 
d‘eùed_boxli¡
 = 
Å_box_li¡
.
	`BoxLi¡
(

151 
Å
.
	$ex·nd_dims
(
d‘eùed_boxes
[
max_scÜe_id
, :], 
axis
=0))

152 
gt_boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
groundŒuth_boxes
)

153 
iou
 = 
Å_box_li¡_İs
.
	$iou
(
d‘eùed_boxli¡
, 
gt_boxli¡
)

154 
Å
.
	`max
(
iou
è>ğ
£lf
.
m©chšg_iou_th»shŞd
:

158 
def
 
	$_compu‹__å
(
£lf
, 
d‘eùed_boxes
, 
d‘eùed_scÜes
,

159 
d‘eùed_şass_Ïb–s
, 
groundŒuth_boxes
,

160 
groundŒuth_şass_Ïb–s
, 
groundŒuth_is_difficuÉ_li¡s
):

163 
Args
:

164 
d‘eùed_boxes
: 
A
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 4], 
»´e£Ášg
 N

165 
»giÚs
 
of
 
d‘eùed
 
objeù
„egions.

166 
Each
 
row
 
is
 
of
 
the
 
fÜm©
 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
]

167 
d‘eùed_scÜes
: 
A
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 1], 
»´e£Ášg


168 
the
 
cÚfid’û
 
scÜes
 
of
h
d‘eùed
 
N
 
objeù
 
š¡ªûs
.

169 
d‘eùed_şass_Ïb–s
: 
A
 
š‹g”
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 1], 
»´’‘šg


170 
the
 
şass
 
Ïb–s
 
of
h
d‘eùed
 
N
 
objeù
 
š¡ªûs
.

171 
groundŒuth_boxes
: 
A
 
numpy
 
¬¿y
 
of
 
sh­e
 [
M
, 4], 
»´e£Ášg
 M

172 
»giÚs
 
of
 
objeù
 
š¡ªûs
 
š
 
ground
 
Œuth


173 
groundŒuth_şass_Ïb–s
: 
An
 
š‹g”
 
numpy
 
¬¿y
 
of
 
sh­e
 [
M
, 1],

174 
»´e£Ášg
 
M
 
şass
 
Ïb–s
 
of
 
objeù
 
š¡ªûs
 
š
 
ground
 
Œuth


175 
groundŒuth_is_difficuÉ_li¡s
: 
A
 
boŞ—n
 
numpy
 
¬¿y
 
of
 
Ëngth
 
M
 
d’Ùšg


176 
wh‘h”
 
a
 
ground
 
Œuth
 
box
 
is
‡ 
difficuÉ
 
š¡ªû
 
Ü
 
nÙ


178 
R‘uºs
:

179 
»suÉ_scÜes
: 
A
 
li¡
 
of
 
numpy
 
¬¿ys
. 
Each
‚umpy 
¬¿y
 
is
 of

180 
sh­e
 [
K
, 1], 
»´e£Ášg
 K 
scÜes
 
d‘eùed
 
w™h
 
objeù
 
şass


181 
Ïb–
 
c


182 
»suÉ__å_Ïb–s
: 
A
 
li¡
 
of
 
boŞ—n
 
numpy
 
¬¿y
. 
Each
‚umpy‡¼ay 
is
 of

183 
sh­e
 [
K
, 1], 
»´e£Ášg
 K 
True
/
F®£
 
pos™ive
 
Ïb–
 
of
 
objeù


184 
š¡ªûs
 
d‘eùed
 
w™h
 
şass
 
Ïb–
 
c


186 
»suÉ_scÜes
 = []

187 
»suÉ__å_Ïb–s
 = []

188 
i
 
š
 
	$¿nge
(
£lf
.
num_groundŒuth_şas£s
):

189 
gt_boxes_©_™h_şass
 = 
groundŒuth_boxes
[(
groundŒuth_şass_Ïb–s
 =ğ
i


191 
groundŒuth_is_difficuÉ_li¡_©_™h_şass
 = (

192 
groundŒuth_is_difficuÉ_li¡s
[
groundŒuth_şass_Ïb–s
 =ğ
i
])

193 
d‘eùed_boxes_©_™h_şass
 = 
d‘eùed_boxes
[(
d‘eùed_şass_Ïb–s
 =ğ
i


195 
d‘eùed_scÜes_©_™h_şass
 = 
d‘eùed_scÜes
[
d‘eùed_şass_Ïb–s
 =ğ
i
]

196 
scÜes
, 
_å_Ïb–s
 = 
£lf
.
	$_compu‹__å_fÜ_sšgË_şass
(

197 
d‘eùed_boxes_©_™h_şass
, 
d‘eùed_scÜes_©_™h_şass
,

198 
gt_boxes_©_™h_şass
, 
groundŒuth_is_difficuÉ_li¡_©_™h_şass
)

199 
»suÉ_scÜes
.
	$­³nd
(
scÜes
)

200 
»suÉ__å_Ïb–s
.
	$­³nd
(
_å_Ïb–s
)

201  
»suÉ_scÜes
, 
»suÉ__å_Ïb–s


203 
def
 
	$_»move_šv®id_boxes
(
£lf
, 
d‘eùed_boxes
, 
d‘eùed_scÜes
,

204 
d‘eùed_şass_Ïb–s
):

205 
v®id_šdiûs
 = 
Å
.
	`logiÿl_ªd
(
d‘eùed_boxes
[:, 0] < detected_boxes[:, 2],

206 
d‘eùed_boxes
[:, 1] < detected_boxes[:, 3])

207  (
d‘eùed_boxes
[
v®id_šdiûs
, :], 
d‘eùed_scÜes
[valid_indices],

208 
d‘eùed_şass_Ïb–s
[
v®id_šdiûs
])

210 
def
 
	$_compu‹__å_fÜ_sšgË_şass
(
£lf
, 
d‘eùed_boxes
, 
d‘eùed_scÜes
,

211 
groundŒuth_boxes
,

212 
groundŒuth_is_difficuÉ_li¡
):

215 
Args
:

216 
d‘eùed_boxes
: 
A
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 4] 
»´e£Ášg
 
d‘eùed
 
box


217 
coÜdš©es


218 
d‘eùed_scÜes
: 
A
 1-
d
 
numpy
 
¬¿y
 
of
 
Ëngth
 
N
 
»´e£Ášg
 
şassifiÿtiÚ


219 
scÜe


220 
groundŒuth_boxes
: 
A
 
numpy
 
¬¿y
 
of
 
sh­e
 [
M
, 4] 
»´e£Ášg
 
ground
 
Œuth


221 
box
 
coÜdš©es


222 
groundŒuth_is_difficuÉ_li¡
: 
A
 
boŞ—n
 
numpy
 
¬¿y
 
of
 
Ëngth
 
M
 
d’Ùšg


223 
wh‘h”
 
a
 
ground
 
Œuth
 
box
 
is
‡ 
difficuÉ
 
š¡ªû
 
Ü
 
nÙ


225 
R‘uºs
:

226 
scÜes
: 
A
 
numpy
 
¬¿y
 
»´e£Ášg
 
the
 
d‘eùiÚ
 scores

227 
_å_Ïb–s
: 
a
 
boŞ—n
 
numpy
 
¬¿y
 
šdiÿtšg
 
wh‘h”
‡ 
d‘eùiÚ
 
is
‡

228 
Œue
 
pos™ive
.

231 
d‘eùed_boxes
.
size
 == 0:

232  
Å
.
	`¬¿y
([], 
dty³
=),‚p.
	$¬¿y
([], 
dty³
=
boŞ
)

233 
d‘eùed_boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
d‘eùed_boxes
)

234 
d‘eùed_boxli¡
.
	`add_f›ld
('scÜes', 
d‘eùed_scÜes
)

235 
d‘eùed_boxli¡
 = 
Å_box_li¡_İs
.
	$nÚ_max_suµ»ssiÚ
(

236 
d‘eùed_boxli¡
, 
£lf
.
nms_max_ouut_boxes
, s–f.
nms_iou_th»shŞd
)

238 
scÜes
 = 
d‘eùed_boxli¡
.
	`g‘_f›ld
('scores')

240 
groundŒuth_boxes
.
size
 == 0:

241  
scÜes
, 
Å
.
	`z”os
(
d‘eùed_boxli¡
.
	`num_boxes
(), 
dty³
=
boŞ
)

242 
gt_boxli¡
 = 
Å_box_li¡
.
	$BoxLi¡
(
groundŒuth_boxes
)

244 
iou
 = 
Å_box_li¡_İs
.
	$iou
(
d‘eùed_boxli¡
, 
gt_boxli¡
)

245 
max_ov”Ïp_gt_ids
 = 
Å
.
	$¬gmax
(
iou
, 
axis
=1)

246 
is_gt_box_d‘eùed
 = 
Å
.
	`z”os
(
gt_boxli¡
.
	`num_boxes
(), 
dty³
=
boŞ
)

247 
_å_Ïb–s
 = 
Å
.
	`z”os
(
d‘eùed_boxli¡
.
	`num_boxes
(), 
dty³
=
boŞ
)

248 
is_m©ched_to_difficuÉ_box
 = 
Å
.
	`z”os
(

249 
d‘eùed_boxli¡
.
	`num_boxes
(), 
dty³
=
boŞ
)

250 
i
 
š
 
	`¿nge
(
d‘eùed_boxli¡
.
	$num_boxes
()):

251 
gt_id
 = 
max_ov”Ïp_gt_ids
[
i
]

252 
iou
[
i
, 
gt_id
] >ğ
£lf
.
m©chšg_iou_th»shŞd
:

253 
nÙ
 
groundŒuth_is_difficuÉ_li¡
[
gt_id
]:

254 
nÙ
 
is_gt_box_d‘eùed
[
gt_id
]:

255 
_å_Ïb–s
[
i
] = 
True


256 
is_gt_box_d‘eùed
[
gt_id
] = 
True


258 
is_m©ched_to_difficuÉ_box
[
i
] = 
True


259  
scÜes
[~
is_m©ched_to_difficuÉ_box
], 
_å_Ïb–s
[

260 ~
is_m©ched_to_difficuÉ_box
]

	@utils/per_image_evaluation_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
numpy
 
as
 
Å


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
³r_image_ev®u©iÚ


24 
şass
 
	$SšgËCÏssTpFpW™hDifficuÉBoxesTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$£tUp
(
£lf
):

27 
num_groundŒuth_şas£s
 = 1

28 
m©chšg_iou_th»shŞd
 = 0.5

29 
nms_iou_th»shŞd
 = 1.0

30 
nms_max_ouut_boxes
 = 10000

31 
£lf
.
ev®
 = 
³r_image_ev®u©iÚ
.
	$P”ImageEv®u©iÚ
(

32 
num_groundŒuth_şas£s
, 
m©chšg_iou_th»shŞd
, 
nms_iou_th»shŞd
,

33 
nms_max_ouut_boxes
)

35 
£lf
.
d‘eùed_boxes
 = 
Å
.
	$¬¿y
([[0, 0, 1, 1], [0, 0, 2, 2], [0, 0, 3, 3]],

36 
dty³
=)

37 
£lf
.
d‘eùed_scÜes
 = 
Å
.
	$¬¿y
([0.6, 0.8, 0.5], 
dty³
=)

38 
£lf
.
groundŒuth_boxes
 = 
Å
.
	$¬¿y
([[0, 0, 1, 1], [0, 0, 10, 10]],

39 
dty³
=)

41 
def
 
	$‹¡_m©ch_to_nÙ_difficuÉ_box
(
£lf
):

42 
groundŒuth_groundŒuth_is_difficuÉ_li¡
 = 
Å
.
	$¬¿y
([
F®£
, 
True
],

43 
dty³
=
boŞ
)

44 
scÜes
, 
_å_Ïb–s
 = 
£lf
.
ev®
.
	$_compu‹__å_fÜ_sšgË_şass
(

45 
£lf
.
d‘eùed_boxes
, s–f.
d‘eùed_scÜes
, s–f.
groundŒuth_boxes
,

46 
groundŒuth_groundŒuth_is_difficuÉ_li¡
)

47 
ex³ùed_scÜes
 = 
Å
.
	$¬¿y
([0.8, 0.6, 0.5], 
dty³
=)

48 
ex³ùed__å_Ïb–s
 = 
Å
.
	$¬¿y
([
F®£
, 
True
, F®£], 
dty³
=
boŞ
)

49 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
ex³ùed_scÜes
, 
scÜes
))

50 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
ex³ùed__å_Ïb–s
, 
_å_Ïb–s
))

52 
def
 
	$‹¡_m©ch_to_difficuÉ_box
(
£lf
):

53 
groundŒuth_groundŒuth_is_difficuÉ_li¡
 = 
Å
.
	$¬¿y
([
True
, 
F®£
],

54 
dty³
=
boŞ
)

55 
scÜes
, 
_å_Ïb–s
 = 
£lf
.
ev®
.
	$_compu‹__å_fÜ_sšgË_şass
(

56 
£lf
.
d‘eùed_boxes
, s–f.
d‘eùed_scÜes
, s–f.
groundŒuth_boxes
,

57 
groundŒuth_groundŒuth_is_difficuÉ_li¡
)

58 
ex³ùed_scÜes
 = 
Å
.
	$¬¿y
([0.8, 0.5], 
dty³
=)

59 
ex³ùed__å_Ïb–s
 = 
Å
.
	$¬¿y
([
F®£
, F®£], 
dty³
=
boŞ
)

60 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
ex³ùed_scÜes
, 
scÜes
))

61 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
ex³ùed__å_Ïb–s
, 
_å_Ïb–s
))

64 
şass
 
	$SšgËCÏssTpFpNoDifficuÉBoxesTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

66 
def
 
	$£tUp
(
£lf
):

67 
num_groundŒuth_şas£s
 = 1

68 
m©chšg_iou_th»shŞd1
 = 0.5

69 
m©chšg_iou_th»shŞd2
 = 0.1

70 
nms_iou_th»shŞd
 = 1.0

71 
nms_max_ouut_boxes
 = 10000

72 
£lf
.
ev®1
 = 
³r_image_ev®u©iÚ
.
	$P”ImageEv®u©iÚ
(

73 
num_groundŒuth_şas£s
, 
m©chšg_iou_th»shŞd1
, 
nms_iou_th»shŞd
,

74 
nms_max_ouut_boxes
)

76 
£lf
.
ev®2
 = 
³r_image_ev®u©iÚ
.
	$P”ImageEv®u©iÚ
(

77 
num_groundŒuth_şas£s
, 
m©chšg_iou_th»shŞd2
, 
nms_iou_th»shŞd
,

78 
nms_max_ouut_boxes
)

80 
£lf
.
d‘eùed_boxes
 = 
Å
.
	$¬¿y
([[0, 0, 1, 1], [0, 0, 2, 2], [0, 0, 3, 3]],

81 
dty³
=)

82 
£lf
.
d‘eùed_scÜes
 = 
Å
.
	$¬¿y
([0.6, 0.8, 0.5], 
dty³
=)

84 
def
 
	$‹¡_no_Œue_pos™ives
(
£lf
):

85 
groundŒuth_boxes
 = 
Å
.
	$¬¿y
([[100, 100, 105, 105]], 
dty³
=)

86 
groundŒuth_groundŒuth_is_difficuÉ_li¡
 = 
Å
.
	$z”os
(1, 
dty³
=
boŞ
)

87 
scÜes
, 
_å_Ïb–s
 = 
£lf
.
ev®1
.
	$_compu‹__å_fÜ_sšgË_şass
(

88 
£lf
.
d‘eùed_boxes
, s–f.
d‘eùed_scÜes
, 
groundŒuth_boxes
,

89 
groundŒuth_groundŒuth_is_difficuÉ_li¡
)

90 
ex³ùed_scÜes
 = 
Å
.
	$¬¿y
([0.8, 0.6, 0.5], 
dty³
=)

91 
ex³ùed__å_Ïb–s
 = 
Å
.
	$¬¿y
([
F®£
, F®£, F®£], 
dty³
=
boŞ
)

92 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
ex³ùed_scÜes
, 
scÜes
))

93 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
ex³ùed__å_Ïb–s
, 
_å_Ïb–s
))

95 
def
 
	$‹¡_Úe_Œue_pos™ives_w™h_Ïrge_iou_th»shŞd
(
£lf
):

96 
groundŒuth_boxes
 = 
Å
.
	$¬¿y
([[0, 0, 1, 1]], 
dty³
=)

97 
groundŒuth_groundŒuth_is_difficuÉ_li¡
 = 
Å
.
	$z”os
(1, 
dty³
=
boŞ
)

98 
scÜes
, 
_å_Ïb–s
 = 
£lf
.
ev®1
.
	$_compu‹__å_fÜ_sšgË_şass
(

99 
£lf
.
d‘eùed_boxes
, s–f.
d‘eùed_scÜes
, 
groundŒuth_boxes
,

100 
groundŒuth_groundŒuth_is_difficuÉ_li¡
)

101 
ex³ùed_scÜes
 = 
Å
.
	$¬¿y
([0.8, 0.6, 0.5], 
dty³
=)

102 
ex³ùed__å_Ïb–s
 = 
Å
.
	$¬¿y
([
F®£
, 
True
, F®£], 
dty³
=
boŞ
)

103 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
ex³ùed_scÜes
, 
scÜes
))

104 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
ex³ùed__å_Ïb–s
, 
_å_Ïb–s
))

106 
def
 
	$‹¡_Úe_Œue_pos™ives_w™h_v”y_sm®l_iou_th»shŞd
(
£lf
):

107 
groundŒuth_boxes
 = 
Å
.
	$¬¿y
([[0, 0, 1, 1]], 
dty³
=)

108 
groundŒuth_groundŒuth_is_difficuÉ_li¡
 = 
Å
.
	$z”os
(1, 
dty³
=
boŞ
)

109 
scÜes
, 
_å_Ïb–s
 = 
£lf
.
ev®2
.
	$_compu‹__å_fÜ_sšgË_şass
(

110 
£lf
.
d‘eùed_boxes
, s–f.
d‘eùed_scÜes
, 
groundŒuth_boxes
,

111 
groundŒuth_groundŒuth_is_difficuÉ_li¡
)

112 
ex³ùed_scÜes
 = 
Å
.
	$¬¿y
([0.8, 0.6, 0.5], 
dty³
=)

113 
ex³ùed__å_Ïb–s
 = 
Å
.
	$¬¿y
([
True
, 
F®£
, F®£], 
dty³
=
boŞ
)

114 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
ex³ùed_scÜes
, 
scÜes
))

115 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
ex³ùed__å_Ïb–s
, 
_å_Ïb–s
))

117 
def
 
	$‹¡_two_Œue_pos™ives_w™h_Ïrge_iou_th»shŞd
(
£lf
):

118 
groundŒuth_boxes
 = 
Å
.
	$¬¿y
([[0, 0, 1, 1], [0, 0, 3.5, 3.5]], 
dty³
=)

119 
groundŒuth_groundŒuth_is_difficuÉ_li¡
 = 
Å
.
	$z”os
(2, 
dty³
=
boŞ
)

120 
scÜes
, 
_å_Ïb–s
 = 
£lf
.
ev®1
.
	$_compu‹__å_fÜ_sšgË_şass
(

121 
£lf
.
d‘eùed_boxes
, s–f.
d‘eùed_scÜes
, 
groundŒuth_boxes
,

122 
groundŒuth_groundŒuth_is_difficuÉ_li¡
)

123 
ex³ùed_scÜes
 = 
Å
.
	$¬¿y
([0.8, 0.6, 0.5], 
dty³
=)

124 
ex³ùed__å_Ïb–s
 = 
Å
.
	$¬¿y
([
F®£
, 
True
, True], 
dty³
=
boŞ
)

125 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
ex³ùed_scÜes
, 
scÜes
))

126 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
ex³ùed__å_Ïb–s
, 
_å_Ïb–s
))

129 
şass
 
	$MuÉiCÏs£sTpFpTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

131 
def
 
	$‹¡__å
(
£lf
):

132 
num_groundŒuth_şas£s
 = 3

133 
m©chšg_iou_th»shŞd
 = 0.5

134 
nms_iou_th»shŞd
 = 1.0

135 
nms_max_ouut_boxes
 = 10000

136 
ev®1
 = 
³r_image_ev®u©iÚ
.
	$P”ImageEv®u©iÚ
(
num_groundŒuth_şas£s
,

137 
m©chšg_iou_th»shŞd
,

138 
nms_iou_th»shŞd
,

139 
nms_max_ouut_boxes
)

140 
d‘eùed_boxes
 = 
Å
.
	$¬¿y
([[0, 0, 1, 1], [10, 10, 5, 5], [0, 0, 2, 2],

142 
dty³
=)

143 
d‘eùed_scÜes
 = 
Å
.
	$¬¿y
([0.8, 0.1, 0.8, 0.9, 0.7, 0.8], 
dty³
=)

144 
d‘eùed_şass_Ïb–s
 = 
Å
.
	$¬¿y
([0, 1, 1, 2, 0, 2], 
dty³
=)

145 
groundŒuth_boxes
 = 
Å
.
	$¬¿y
([[0, 0, 1, 1], [0, 0, 3.5, 3.5]], 
dty³
=)

146 
groundŒuth_şass_Ïb–s
 = 
Å
.
	$¬¿y
([0, 2], 
dty³
=)

147 
groundŒuth_groundŒuth_is_difficuÉ_li¡
 = 
Å
.
	$z”os
(2, 
dty³
=)

148 
scÜes
, 
_å_Ïb–s
, 
_
 = 
ev®1
.
	$compu‹_objeù_d‘eùiÚ_m‘rics
(

149 
d‘eùed_boxes
, 
d‘eùed_scÜes
, 
d‘eùed_şass_Ïb–s
,

150 
groundŒuth_boxes
, 
groundŒuth_şass_Ïb–s
,

151 
groundŒuth_groundŒuth_is_difficuÉ_li¡
)

152 
ex³ùed_scÜes
 = [
Å
.
	`¬¿y
([0.8], 
dty³
=)] * 3

153 
ex³ùed__å_Ïb–s
 = [
Å
.
	`¬¿y
([
True
]),‚p.¬¿y([
F®£
]),‚p.array([True

155 
i
 
š
 
	`¿nge
(
	$Ën
(
ex³ùed_scÜes
)):

156 
£lf
.
	`as£¹True
(
Å
.
	$®lşo£
(
ex³ùed_scÜes
[
i
], 
scÜes
[i]))

157 
£lf
.
	`as£¹True
(
Å
.
	$¬¿y_equ®
(
ex³ùed__å_Ïb–s
[
i
], 
_å_Ïb–s
[i]))

160 
şass
 
	$CÜLocTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

162 
def
 
	$‹¡_compu‹_cÜloc_w™h_nÜm®_iou_th»shŞd
(
£lf
):

163 
num_groundŒuth_şas£s
 = 3

164 
m©chšg_iou_th»shŞd
 = 0.5

165 
nms_iou_th»shŞd
 = 1.0

166 
nms_max_ouut_boxes
 = 10000

167 
ev®1
 = 
³r_image_ev®u©iÚ
.
	$P”ImageEv®u©iÚ
(
num_groundŒuth_şas£s
,

168 
m©chšg_iou_th»shŞd
,

169 
nms_iou_th»shŞd
,

170 
nms_max_ouut_boxes
)

171 
d‘eùed_boxes
 = 
Å
.
	$¬¿y
([[0, 0, 1, 1], [0, 0, 2, 2], [0, 0, 3, 3],

172 [0, 0, 5, 5]], 
dty³
=)

173 
d‘eùed_scÜes
 = 
Å
.
	$¬¿y
([0.9, 0.9, 0.1, 0.9], 
dty³
=)

174 
d‘eùed_şass_Ïb–s
 = 
Å
.
	$¬¿y
([0, 1, 0, 2], 
dty³
=)

175 
groundŒuth_boxes
 = 
Å
.
	$¬¿y
([[0, 0, 1, 1], [0, 0, 3, 3], [0, 0, 6, 6]],

176 
dty³
=)

177 
groundŒuth_şass_Ïb–s
 = 
Å
.
	$¬¿y
([0, 0, 2], 
dty³
=)

179 
is_şass_cÜ»ùly_d‘eùed_š_image
 = 
ev®1
.
	$_compu‹_cÜ_loc
(

180 
d‘eùed_boxes
, 
d‘eùed_scÜes
, 
d‘eùed_şass_Ïb–s
,

181 
groundŒuth_boxes
, 
groundŒuth_şass_Ïb–s
)

182 
ex³ùed_»suÉ
 = 
Å
.
	$¬¿y
([1, 0, 1], 
dty³
=)

183 
£lf
.
	`as£¹True
(
Å
.
	$¬¿y_equ®
(
ex³ùed_»suÉ
,

184 
is_şass_cÜ»ùly_d‘eùed_š_image
))

186 
def
 
	$‹¡_compu‹_cÜloc_w™h_v”y_Ïrge_iou_th»shŞd
(
£lf
):

187 
num_groundŒuth_şas£s
 = 3

188 
m©chšg_iou_th»shŞd
 = 0.9

189 
nms_iou_th»shŞd
 = 1.0

190 
nms_max_ouut_boxes
 = 10000

191 
ev®1
 = 
³r_image_ev®u©iÚ
.
	$P”ImageEv®u©iÚ
(
num_groundŒuth_şas£s
,

192 
m©chšg_iou_th»shŞd
,

193 
nms_iou_th»shŞd
,

194 
nms_max_ouut_boxes
)

195 
d‘eùed_boxes
 = 
Å
.
	$¬¿y
([[0, 0, 1, 1], [0, 0, 2, 2], [0, 0, 3, 3],

196 [0, 0, 5, 5]], 
dty³
=)

197 
d‘eùed_scÜes
 = 
Å
.
	$¬¿y
([0.9, 0.9, 0.1, 0.9], 
dty³
=)

198 
d‘eùed_şass_Ïb–s
 = 
Å
.
	$¬¿y
([0, 1, 0, 2], 
dty³
=)

199 
groundŒuth_boxes
 = 
Å
.
	$¬¿y
([[0, 0, 1, 1], [0, 0, 3, 3], [0, 0, 6, 6]],

200 
dty³
=)

201 
groundŒuth_şass_Ïb–s
 = 
Å
.
	$¬¿y
([0, 0, 2], 
dty³
=)

203 
is_şass_cÜ»ùly_d‘eùed_š_image
 = 
ev®1
.
	$_compu‹_cÜ_loc
(

204 
d‘eùed_boxes
, 
d‘eùed_scÜes
, 
d‘eùed_şass_Ïb–s
,

205 
groundŒuth_boxes
, 
groundŒuth_şass_Ïb–s
)

206 
ex³ùed_»suÉ
 = 
Å
.
	$¬¿y
([1, 0, 0], 
dty³
=)

207 
£lf
.
	`as£¹True
(
Å
.
	$¬¿y_equ®
(
ex³ùed_»suÉ
,

208 
is_şass_cÜ»ùly_d‘eùed_š_image
))

211 
__Çme__
 == '__main__':

212 
tf
.
‹¡
.
	`maš
()

	@utils/shape_utils.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
def
 
	$_is_‹nsÜ
(
t
):

24 
Args
:

25 
t
: 
the
 
šput
 
to
 
be
 
‹¡ed
.

27 
R‘uºs
:

28 
a
 
boŞ—n
 
th©
 
šdiÿ‹s
 
wh‘h”
 
t
 
is
‡ 
‹nsÜ
.

30  
	`isš¡ªû
(
t
, (
tf
.
T’sÜ
,f.
S·r£T’sÜ
,f.
V¬ŸbË
))

33 
def
 
	$_£t_dim_0
(
t
, 
d0
):

36 
Args
:

37 
t
: 
the
 
šput
 
‹nsÜ
, 
assumšg
h
¿nk
 
is
 
©
 
Ëa¡
 1.

38 
d0
: 
ª
 
š‹g”
 
šdiÿtšg
 
the
 0-
th
 
dim’siÚ
 
of
h
šput
 
‹nsÜ
.

40 
R‘uºs
:

41 
the
 
‹nsÜ
 
t
 
w™h
h0-
th
 
dim’siÚ
 
£t
.

43 
t_sh­e
 = 
t
.
	`g‘_sh­e
().
	$as_li¡
()

44 
t_sh­e
[0] = 
d0


45 
t
.
	$£t_sh­e
(
t_sh­e
)

46  
t


49 
def
 
	$·d_‹nsÜ
(
t
, 
Ëngth
):

52 
Args
:

53 
t
: 
the
 
šput
 
‹nsÜ
, 
assumšg
h
¿nk
 
is
 
©
 
Ëa¡
 1.

54 
Ëngth
: 
a
 
‹nsÜ
 
of
 
sh­e
 [1] 
Ü
 
ª
 
š‹g”
, 
šdiÿtšg
 
the
 
fœ¡
 
dim’siÚ


55 
of
 
the
 
šput
 
‹nsÜ
 
t
 
aá”
 
·ddšg
, 
assumšg
 
Ëngth
 <ğt.
sh­e
[0].

57 
R‘uºs
:

58 
·dded_t
: 
the
 
·dded
 
‹nsÜ
, 
who£
 
fœ¡
 
dim’siÚ
 
is
 
Ëngth
. 
If
he†ength

59 
is
 
ª
 
š‹g”
, 
the
 
fœ¡
 
dim’siÚ
 
of
 
·dded_t
 i 
£t
 
to
 
Ëngth


60 
¡©iÿÎy
.

62 
t_¿nk
 = 
tf
.
	$¿nk
(
t
)

63 
t_sh­e
 = 
tf
.
	$sh­e
(
t
)

64 
t_d0
 = 
t_sh­e
[0]

65 
·d_d0
 = 
tf
.
	`ex·nd_dims
(
Ëngth
 - 
t_d0
, 0)

66 
·d_sh­e
 = 
tf
.
	`cÚd
(

67 
tf
.
	`g»©”
(
t_¿nk
, 1), 
Ïmbda
:f.
	`cÚÿt
([
·d_d0
, 
t_sh­e
[1:]], 0),

68 
Ïmbda
: 
tf
.
	`ex·nd_dims
(
Ëngth
 - 
t_d0
, 0))

69 
·dded_t
 = 
tf
.
	`cÚÿt
([
t
,f.
	`z”os
(
·d_sh­e
, 
dty³
=t.dtype)], 0)

70 
nÙ
 
	$_is_‹nsÜ
(
Ëngth
):

71 
·dded_t
 = 
	$_£t_dim_0
(
·dded_t
, 
Ëngth
)

72  
·dded_t


75 
def
 
	$ş_‹nsÜ
(
t
, 
Ëngth
):

78 
Args
:

79 
t
: 
the
 
šput
 
‹nsÜ
, 
assumšg
h
¿nk
 
is
 
©
 
Ëa¡
 1.

80 
Ëngth
: 
a
 
‹nsÜ
 
of
 
sh­e
 [1] 
Ü
 
ª
 
š‹g”
, 
šdiÿtšg
 
the
 
fœ¡
 
dim’siÚ


81 
of
 
the
 
šput
 
‹nsÜ
 
t
 
aá”
 
şpšg
, 
assumšg
 
Ëngth
 <ğt.
sh­e
[0].

83 
R‘uºs
:

84 
ş³d_t
: 
the
 
ş³d
 
‹nsÜ
, 
who£
 
fœ¡
 
dim’siÚ
 
is
 
Ëngth
. 
If
he

85 
Ëngth
 
is
 
ª
 
š‹g”
, 
the
 
fœ¡
 
dim’siÚ
 
of
 
ş³d_t
 i 
£t
 
to
†ength

86 
¡©iÿÎy
.

88 
ş³d_t
 = 
tf
.
	`g©h”
(
t
,f.
	$¿nge
(
Ëngth
))

89 
nÙ
 
	$_is_‹nsÜ
(
Ëngth
):

90 
ş³d_t
 = 
	$_£t_dim_0
(
ş³d_t
, 
Ëngth
)

91  
ş³d_t


94 
def
 
	$·d_Ü_ş_‹nsÜ
(
t
, 
Ëngth
):

97 
Args
:

98 
t
: 
the
 
šput
 
‹nsÜ
, 
assumšg
h
¿nk
 
is
 
©
 
Ëa¡
 1.

99 
Ëngth
: 
a
 
‹nsÜ
 
of
 
sh­e
 [1] 
Ü
 
ª
 
š‹g”
, 
šdiÿtšg
 
the
 
fœ¡
 
dim’siÚ


100 
of
 
the
 
šput
 
‹nsÜ
 
t
 
aá”
 
´oûssšg
.

102 
R‘uºs
:

103 
´oûs£d_t
: 
the
 
´oûs£d
 
‹nsÜ
, 
who£
 
fœ¡
 
dim’siÚ
 
is
 
Ëngth
. 
If
he

104 
Ëngth
 
is
 
ª
 
š‹g”
, 
the
 
fœ¡
 
dim’siÚ
 
of
h
´oûs£d
 
‹nsÜ
 i 
£t


105 
to
 
Ëngth
 
¡©iÿÎy
.

107 
´oûs£d_t
 = 
tf
.
	`cÚd
(

108 
tf
.
	`g»©”
Ñf.
	`sh­e
(
t
)[0], 
Ëngth
),

109 
Ïmbda
: 
	`ş_‹nsÜ
(
t
, 
Ëngth
),

110 
Ïmbda
: 
	$·d_‹nsÜ
(
t
, 
Ëngth
))

111 
nÙ
 
	$_is_‹nsÜ
(
Ëngth
):

112 
´oûs£d_t
 = 
	$_£t_dim_0
(
´oûs£d_t
, 
Ëngth
)

113  
´oûs£d_t


116 
def
 
	$combšed_¡©ic_ªd_dyÇmic_sh­e
(
‹nsÜ
):

119 
R‘uºs
 
a
 
li¡
 
of
 
ªd
 
dyÇmic
 
v®ues
 
sh­e
 
dim’siÚs
. 
This
 
is


120 
u£ful
 
to
 
´e£rve
 
sh­es
 
wh’
 
avaabË
 
š
 
»sh­e
 
İ”©iÚ
.

122 
Args
:

123 
‹nsÜ
: 
A
’sÜ 
of
 
ªy
 
ty³
.

125 
R‘uºs
:

126 
A
 
li¡
 
of
 
size
 
‹nsÜ
.
sh­e
.
ndims
 
cÚššg
 
š‹g”s
 
Ü
 
a
 
sÿÏr
ensor.

128 
¡©ic_sh­e
 = 
‹nsÜ
.
sh­e
.
	$as_li¡
()

129 
dyÇmic_sh­e
 = 
tf
.
	$sh­e
(
‹nsÜ
)

130 
combšed_sh­e
 = []

131 
šdex
, 
dim
 
š
 
	$’um”©e
(
¡©ic_sh­e
):

132 
dim
 
is
 
nÙ
 
NÚe
:

133 
combšed_sh­e
.
	$­³nd
(
dim
)

135 
combšed_sh­e
.
	$­³nd
(
dyÇmic_sh­e
[
šdex
])

136  
combšed_sh­e


	@utils/shape_utils_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
sh­e_uts


23 
şass
 
	$UtTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

25 
def
 
	$‹¡_·d_‹nsÜ_usšg_š‹g”_šput
(
£lf
):

26 
t1
 = 
tf
.
	$cÚ¡ªt
([1], 
dty³
=
tf
.
št32
)

27 
·d_t1
 = 
sh­e_uts
.
	$·d_‹nsÜ
(
t1
, 2)

28 
t2
 = 
tf
.
	$cÚ¡ªt
([[0.1, 0.2]], 
dty³
=
tf
.
æßt32
)

29 
·d_t2
 = 
sh­e_uts
.
	$·d_‹nsÜ
(
t2
, 2)

31 
£lf
.
	`as£¹Equ®
(2, 
·d_t1
.
	`g‘_sh­e
()[0])

32 
£lf
.
	`as£¹Equ®
(2, 
·d_t2
.
	`g‘_sh­e
()[0])

34 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

35 
·d_t1_»suÉ
, 
·d_t2_»suÉ
 = 
£ss
.
	$run
([
·d_t1
, 
·d_t2
])

36 
£lf
.
	$as£¹AÎEqu®
([1, 0], 
·d_t1_»suÉ
)

37 
£lf
.
	$as£¹AÎClo£
([[0.1, 0.2], [0, 0]], 
·d_t2_»suÉ
)

39 
def
 
	$‹¡_·d_‹nsÜ_usšg_‹nsÜ_šput
(
£lf
):

40 
t1
 = 
tf
.
	$cÚ¡ªt
([1], 
dty³
=
tf
.
št32
)

41 
·d_t1
 = 
sh­e_uts
.
	`·d_‹nsÜ
(
t1
, 
tf
.
	$cÚ¡ªt
(2))

42 
t2
 = 
tf
.
	$cÚ¡ªt
([[0.1, 0.2]], 
dty³
=
tf
.
æßt32
)

43 
·d_t2
 = 
sh­e_uts
.
	`·d_‹nsÜ
(
t2
, 
tf
.
	$cÚ¡ªt
(2))

45 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

46 
·d_t1_»suÉ
, 
·d_t2_»suÉ
 = 
£ss
.
	$run
([
·d_t1
, 
·d_t2
])

47 
£lf
.
	$as£¹AÎEqu®
([1, 0], 
·d_t1_»suÉ
)

48 
£lf
.
	$as£¹AÎClo£
([[0.1, 0.2], [0, 0]], 
·d_t2_»suÉ
)

50 
def
 
	$‹¡_ş_‹nsÜ_usšg_š‹g”_šput
(
£lf
):

51 
t1
 = 
tf
.
	$cÚ¡ªt
([1, 2, 3], 
dty³
=
tf
.
št32
)

52 
ş_t1
 = 
sh­e_uts
.
	$ş_‹nsÜ
(
t1
, 2)

53 
t2
 = 
tf
.
	$cÚ¡ªt
([[0.1, 0.2], [0.2, 0.4], [0.5, 0.8]], 
dty³
=
tf
.
æßt32
)

54 
ş_t2
 = 
sh­e_uts
.
	$ş_‹nsÜ
(
t2
, 2)

56 
£lf
.
	`as£¹Equ®
(2, 
ş_t1
.
	`g‘_sh­e
()[0])

57 
£lf
.
	`as£¹Equ®
(2, 
ş_t2
.
	`g‘_sh­e
()[0])

59 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

60 
ş_t1_»suÉ
, 
ş_t2_»suÉ
 = 
£ss
.
	$run
([
ş_t1
, 
ş_t2
])

61 
£lf
.
	$as£¹AÎEqu®
([1, 2], 
ş_t1_»suÉ
)

62 
£lf
.
	$as£¹AÎClo£
([[0.1, 0.2], [0.2, 0.4]], 
ş_t2_»suÉ
)

64 
def
 
	$‹¡_ş_‹nsÜ_usšg_‹nsÜ_šput
(
£lf
):

65 
t1
 = 
tf
.
	$cÚ¡ªt
([1, 2, 3], 
dty³
=
tf
.
št32
)

66 
ş_t1
 = 
sh­e_uts
.
	`ş_‹nsÜ
(
t1
, 
tf
.
	$cÚ¡ªt
(2))

67 
t2
 = 
tf
.
	$cÚ¡ªt
([[0.1, 0.2], [0.2, 0.4], [0.5, 0.8]], 
dty³
=
tf
.
æßt32
)

68 
ş_t2
 = 
sh­e_uts
.
	`ş_‹nsÜ
(
t2
, 
tf
.
	$cÚ¡ªt
(2))

70 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

71 
ş_t1_»suÉ
, 
ş_t2_»suÉ
 = 
£ss
.
	$run
([
ş_t1
, 
ş_t2
])

72 
£lf
.
	$as£¹AÎEqu®
([1, 2], 
ş_t1_»suÉ
)

73 
£lf
.
	$as£¹AÎClo£
([[0.1, 0.2], [0.2, 0.4]], 
ş_t2_»suÉ
)

75 
def
 
	$‹¡_·d_Ü_ş_‹nsÜ_usšg_š‹g”_šput
(
£lf
):

76 
t1
 = 
tf
.
	$cÚ¡ªt
([1], 
dty³
=
tf
.
št32
)

77 
‰1
 = 
sh­e_uts
.
	$·d_Ü_ş_‹nsÜ
(
t1
, 2)

78 
t2
 = 
tf
.
	$cÚ¡ªt
([[0.1, 0.2]], 
dty³
=
tf
.
æßt32
)

79 
‰2
 = 
sh­e_uts
.
	$·d_Ü_ş_‹nsÜ
(
t2
, 2)

81 
t3
 = 
tf
.
	$cÚ¡ªt
([1, 2, 3], 
dty³
=
tf
.
št32
)

82 
‰3
 = 
sh­e_uts
.
	$ş_‹nsÜ
(
t3
, 2)

83 
t4
 = 
tf
.
	$cÚ¡ªt
([[0.1, 0.2], [0.2, 0.4], [0.5, 0.8]], 
dty³
=
tf
.
æßt32
)

84 
‰4
 = 
sh­e_uts
.
	$ş_‹nsÜ
(
t4
, 2)

86 
£lf
.
	`as£¹Equ®
(2, 
‰1
.
	`g‘_sh­e
()[0])

87 
£lf
.
	`as£¹Equ®
(2, 
‰2
.
	`g‘_sh­e
()[0])

88 
£lf
.
	`as£¹Equ®
(2, 
‰3
.
	`g‘_sh­e
()[0])

89 
£lf
.
	`as£¹Equ®
(2, 
‰4
.
	`g‘_sh­e
()[0])

91 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

92 
‰1_»suÉ
, 
‰2_»suÉ
, 
‰3_»suÉ
, 
‰4_»suÉ
 = 
£ss
.
	$run
(

93 [
‰1
, 
‰2
, 
‰3
, 
‰4
])

94 
£lf
.
	$as£¹AÎEqu®
([1, 0], 
‰1_»suÉ
)

95 
£lf
.
	$as£¹AÎClo£
([[0.1, 0.2], [0, 0]], 
‰2_»suÉ
)

96 
£lf
.
	$as£¹AÎEqu®
([1, 2], 
‰3_»suÉ
)

97 
£lf
.
	$as£¹AÎClo£
([[0.1, 0.2], [0.2, 0.4]], 
‰4_»suÉ
)

99 
def
 
	$‹¡_·d_Ü_ş_‹nsÜ_usšg_‹nsÜ_šput
(
£lf
):

100 
t1
 = 
tf
.
	$cÚ¡ªt
([1], 
dty³
=
tf
.
št32
)

101 
‰1
 = 
sh­e_uts
.
	`·d_Ü_ş_‹nsÜ
(
t1
, 
tf
.
	$cÚ¡ªt
(2))

102 
t2
 = 
tf
.
	$cÚ¡ªt
([[0.1, 0.2]], 
dty³
=
tf
.
æßt32
)

103 
‰2
 = 
sh­e_uts
.
	`·d_Ü_ş_‹nsÜ
(
t2
, 
tf
.
	$cÚ¡ªt
(2))

105 
t3
 = 
tf
.
	$cÚ¡ªt
([1, 2, 3], 
dty³
=
tf
.
št32
)

106 
‰3
 = 
sh­e_uts
.
	`ş_‹nsÜ
(
t3
, 
tf
.
	$cÚ¡ªt
(2))

107 
t4
 = 
tf
.
	$cÚ¡ªt
([[0.1, 0.2], [0.2, 0.4], [0.5, 0.8]], 
dty³
=
tf
.
æßt32
)

108 
‰4
 = 
sh­e_uts
.
	`ş_‹nsÜ
(
t4
, 
tf
.
	$cÚ¡ªt
(2))

110 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

111 
‰1_»suÉ
, 
‰2_»suÉ
, 
‰3_»suÉ
, 
‰4_»suÉ
 = 
£ss
.
	$run
(

112 [
‰1
, 
‰2
, 
‰3
, 
‰4
])

113 
£lf
.
	$as£¹AÎEqu®
([1, 0], 
‰1_»suÉ
)

114 
£lf
.
	$as£¹AÎClo£
([[0.1, 0.2], [0, 0]], 
‰2_»suÉ
)

115 
£lf
.
	$as£¹AÎEqu®
([1, 2], 
‰3_»suÉ
)

116 
£lf
.
	$as£¹AÎClo£
([[0.1, 0.2], [0.2, 0.4]], 
‰4_»suÉ
)

118 
def
 
	$‹¡_combšes_¡©ic_dyÇmic_sh­e
(
£lf
):

119 
‹nsÜ
 = 
tf
.
	`¶aûhŞd”
Ñf.
æßt32
, 
sh­e
=(
NÚe
, 2, 3))

120 
combšed_sh­e
 = 
sh­e_uts
.
	$combšed_¡©ic_ªd_dyÇmic_sh­e
(

121 
‹nsÜ
)

122 
£lf
.
	`as£¹True
(
tf
.
cÚŒib
.
äamewÜk
.
	$is_‹nsÜ
(
combšed_sh­e
[0]))

123 
£lf
.
	$as£¹Li¡Equ®
(
combšed_sh­e
[1:], [2, 3])

126 
__Çme__
 == '__main__':

127 
tf
.
‹¡
.
	`maš
()

	@utils/static_shape.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
The
 
	g¿nk
 4 
‹nsÜ_sh­e
 
mu¡
 
be
 
of
 
the
 
	gfÜm
 [
b©ch_size
, 
height
, 
width
, 
d•th
].

22 
def
 
	$g‘_b©ch_size
(
‹nsÜ_sh­e
):

25 
Args
:

26 
‹nsÜ_sh­e
: 
A
 
¿nk
 4 
T’sÜSh­e
.

28 
R‘uºs
:

29 
An
 
š‹g”
 
»´e£Ášg
 
the
 
b©ch
 
size
 
of
h
‹nsÜ
.

31 
‹nsÜ_sh­e
.
	$as£¹_has_¿nk
(
¿nk
=4)

32  
‹nsÜ_sh­e
[0].
v®ue


35 
def
 
	$g‘_height
(
‹nsÜ_sh­e
):

38 
Args
:

39 
‹nsÜ_sh­e
: 
A
 
¿nk
 4 
T’sÜSh­e
.

41 
R‘uºs
:

42 
An
 
š‹g”
 
»´e£Ášg
 
the
 
height
 
of
h
‹nsÜ
.

44 
‹nsÜ_sh­e
.
	$as£¹_has_¿nk
(
¿nk
=4)

45  
‹nsÜ_sh­e
[1].
v®ue


48 
def
 
	$g‘_width
(
‹nsÜ_sh­e
):

51 
Args
:

52 
‹nsÜ_sh­e
: 
A
 
¿nk
 4 
T’sÜSh­e
.

54 
R‘uºs
:

55 
An
 
š‹g”
 
»´e£Ášg
 
the
 
width
 
of
h
‹nsÜ
.

57 
‹nsÜ_sh­e
.
	$as£¹_has_¿nk
(
¿nk
=4)

58  
‹nsÜ_sh­e
[2].
v®ue


61 
def
 
	$g‘_d•th
(
‹nsÜ_sh­e
):

64 
Args
:

65 
‹nsÜ_sh­e
: 
A
 
¿nk
 4 
T’sÜSh­e
.

67 
R‘uºs
:

68 
An
 
š‹g”
 
»´e£Ášg
 
the
 
d•th
 
of
h
‹nsÜ
.

70 
‹nsÜ_sh­e
.
	$as£¹_has_¿nk
(
¿nk
=4)

71  
‹nsÜ_sh­e
[3].
v®ue


	@utils/static_shape_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
¡©ic_sh­e


23 
şass
 
	$SticSh­eTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

25 
def
 
	$‹¡_»tuº_cÜ»ù_b©chSize
(
£lf
):

26 
‹nsÜ_sh­e
 = 
tf
.
	$T’sÜSh­e
(
dims
=[32, 299, 384, 3])

27 
£lf
.
	`as£¹Equ®
(32, 
¡©ic_sh­e
.
	$g‘_b©ch_size
(
‹nsÜ_sh­e
))

29 
def
 
	$‹¡_»tuº_cÜ»ù_height
(
£lf
):

30 
‹nsÜ_sh­e
 = 
tf
.
	$T’sÜSh­e
(
dims
=[32, 299, 384, 3])

31 
£lf
.
	`as£¹Equ®
(299, 
¡©ic_sh­e
.
	$g‘_height
(
‹nsÜ_sh­e
))

33 
def
 
	$‹¡_»tuº_cÜ»ù_width
(
£lf
):

34 
‹nsÜ_sh­e
 = 
tf
.
	$T’sÜSh­e
(
dims
=[32, 299, 384, 3])

35 
£lf
.
	`as£¹Equ®
(384, 
¡©ic_sh­e
.
	$g‘_width
(
‹nsÜ_sh­e
))

37 
def
 
	$‹¡_»tuº_cÜ»ù_d•th
(
£lf
):

38 
‹nsÜ_sh­e
 = 
tf
.
	$T’sÜSh­e
(
dims
=[32, 299, 384, 3])

39 
£lf
.
	`as£¹Equ®
(3, 
¡©ic_sh­e
.
	$g‘_d•th
(
‹nsÜ_sh­e
))

41 
def
 
	$‹¡_d›_Ú_‹nsÜ_sh­e_w™h_¿nk_th»e
(
£lf
):

42 
‹nsÜ_sh­e
 = 
tf
.
	$T’sÜSh­e
(
dims
=[32, 299, 384])

43 
w™h
 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
):

44 
¡©ic_sh­e
.
	$g‘_b©ch_size
(
‹nsÜ_sh­e
)

45 
¡©ic_sh­e
.
	$g‘_height
(
‹nsÜ_sh­e
)

46 
¡©ic_sh­e
.
	$g‘_width
(
‹nsÜ_sh­e
)

47 
¡©ic_sh­e
.
	$g‘_d•th
(
‹nsÜ_sh­e
)

49 
__Çme__
 == '__main__':

50 
tf
.
‹¡
.
	`maš
()

	@utils/test_utils.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
numpy
 
as
 
Å


18 
impÜt
 
‹nsÜæow
 
as
 
tf


20 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
ªchÜ_g’”©Ü


21 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_cod”


22 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_li¡


23 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
box_´ediùÜ


24 
äom
 
	gobjeù_d‘eùiÚ
.
cÜe
 
impÜt
 
m©ch”


25 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
sh­e_uts


28 
şass
 
	$MockBoxCod”
(
box_cod”
.
BoxCod”
):

31 @
´İ”ty


32 
def
 
	$code_size
(
£lf
):

35 
def
 
	$_’code
(
£lf
, 
boxes
, 
ªchÜs
):

36  
boxes
.
	`g‘
(è- 
ªchÜs
.
	$g‘
()

38 
def
 
	$_decode
(
£lf
, 
»l_codes
, 
ªchÜs
):

39  
box_li¡
.
	`BoxLi¡
(
»l_codes
 + 
ªchÜs
.
	$g‘
())

42 
şass
 
	$MockBoxP»diùÜ
(
box_´ediùÜ
.
BoxP»diùÜ
):

45 
def
 
	$__š™__
(
£lf
, 
is_Œaššg
, 
num_şas£s
):

46 
	`su³r
(
MockBoxP»diùÜ
, 
£lf
).
	$__š™__
(
is_Œaššg
, 
num_şas£s
)

48 
def
 
	$_´ediù
(
£lf
, 
image_ã©u»s
, 
num_´ediùiÚs_³r_loÿtiÚ
):

49 
combšed_ã©u»_sh­e
 = 
sh­e_uts
.
	$combšed_¡©ic_ªd_dyÇmic_sh­e
(

50 
image_ã©u»s
)

51 
b©ch_size
 = 
combšed_ã©u»_sh­e
[0]

52 
num_ªchÜs
 = (
combšed_ã©u»_sh­e
[1] * combined_feature_shape[2])

53 
code_size
 = 4

54 
z”o
 = 
tf
.
	$»duû_sum
(0 * 
image_ã©u»s
)

55 
box_’codšgs
 = 
z”o
 + 
tf
.
	`z”os
(

56 (
b©ch_size
, 
num_ªchÜs
, 1, 
code_size
), 
dty³
=
tf
.
æßt32
)

57 
şass_´ediùiÚs_w™h_background
 = 
z”o
 + 
tf
.
	`z”os
(

58 (
b©ch_size
, 
num_ªchÜs
, 
£lf
.
num_şas£s
 + 1), 
dty³
=
tf
.
æßt32
)

59  {
box_´ediùÜ
.
BOX_ENCODINGS
: 
box_’codšgs
,

60 
box_´ediùÜ
.
CLASS_PREDICTIONS_WITH_BACKGROUND
:

61 
şass_´ediùiÚs_w™h_background
}

64 
şass
 
	$MockAnchÜG’”©Ü
(
ªchÜ_g’”©Ü
.
AnchÜG’”©Ü
):

67 
def
 
	$Çme_scİe
(
£lf
):

70 
def
 
	$num_ªchÜs_³r_loÿtiÚ
(
£lf
):

73 
def
 
	$_g’”©e
(
£lf
, 
ã©u»_m­_sh­e_li¡
):

74 
num_ªchÜs
 = 
	$sum
([
sh­e
[0] * sh­e[1] sh­
š
 
ã©u»_m­_sh­e_li¡
])

75  
box_li¡
.
	`BoxLi¡
(
tf
.
	`z”os
((
num_ªchÜs
, 4), 
dty³
ñf.
æßt32
))

78 
şass
 
	$MockM©ch”
(
m©ch”
.
M©ch”
):

81 
def
 
	$_m©ch
(
£lf
, 
sim¬™y_m©rix
):

82  
tf
.
	`cÚ¡ªt
([0, -1, -1, -1], 
dty³
ñf.
št32
)

85 
def
 
	$ü—‹_dŸgÚ®_g¿d›Á_image
(
height
, 
width
, 
d•th
):

88 
FÜ
 
exam¶e
, 
	$py¿mid_image
(5, 6, 1è
looks
 
like
:

95 
Args
:

96 
height
: heighˆ
of
 
image


97 
width
: width 
of
 
image


98 
d•th
: d•th 
of
 
image


100 
R‘uºs
:

101 
py¿mid
 
image


103 
row
 = 
Å
.
	$¬ªge
(
height
)

104 
cŞ
 = 
Å
.
	`¬ªge
(
width
)[::-1]

105 
image_Ïy”
 = 
Å
.
	`ex·nd_dims
(
row
, 1è+ 
cŞ


106 
image_Ïy”
 = 
Å
.
	$ex·nd_dims
(
image_Ïy”
, 2)

108 
image
 = 
image_Ïy”


109 
i
 
š
 
	$¿nge
(1, 
d•th
):

110 
image
 = 
Å
.
	`cÚÿ‹Ç‹
((image, 
image_Ïy”
 * 
	`pow
(10, 
i
)), 2)

112  
image
.
	$a¡y³
(
Å
.
æßt32
)

115 
def
 
	$ü—‹_¿ndom_boxes
(
num_boxes
, 
max_height
, 
max_width
):

118 
Args
:

119 
num_boxes
: 
numb”
 
of
 
boxes
.

120 
max_height
: 
maximum
 
height
 
of
 
boxes
.

121 
max_width
: 
maximum
 
width
 
of
 
boxes
.

123 
R‘uºs
:

124 
boxes
: 
numpy
 
¬¿y
 
of
 
sh­e
 [
num_boxes
, 4]. 
Each
 
row
 
is
 
š
 
fÜm


125 [
y_mš
, 
x_mš
, 
y_max
, 
x_max
].

128 
y_1
 = 
Å
.
¿ndom
.
	`unifÜm
(
size
=(1, 
num_boxes
)è* 
max_height


129 
y_2
 = 
Å
.
¿ndom
.
	`unifÜm
(
size
=(1, 
num_boxes
)è* 
max_height


130 
x_1
 = 
Å
.
¿ndom
.
	`unifÜm
(
size
=(1, 
num_boxes
)è* 
max_width


131 
x_2
 = 
Å
.
¿ndom
.
	`unifÜm
(
size
=(1, 
num_boxes
)è* 
max_width


133 
boxes
 = 
Å
.
	`z”os
(
sh­e
=(
num_boxes
, 4))

134 
boxes
[:, 0] = 
Å
.
	$mšimum
(
y_1
, 
y_2
)

135 
boxes
[:, 1] = 
Å
.
	$mšimum
(
x_1
, 
x_2
)

136 
boxes
[:, 2] = 
Å
.
	$maximum
(
y_1
, 
y_2
)

137 
boxes
[:, 3] = 
Å
.
	$maximum
(
x_1
, 
x_2
)

139  
boxes
.
	`a¡y³
(
Å
.
æßt32
)

	@utils/test_utils_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
numpy
 
as
 
Å


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
‹¡_uts


24 
şass
 
	$Te¡UtsTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$‹¡_dŸgÚ®_g¿d›Á_image
(
£lf
):

28 
py¿mid_image
 = 
‹¡_uts
.
	$ü—‹_dŸgÚ®_g¿d›Á_image
(3, 4, 2)

30 #Te¡ 
which
 
is
 
—sy
 
to
 
und”¡ªd
.

31 
ex³ùed_fœ¡_chªÃl
 = 
Å
.
	$¬¿y
([[3, 2, 1, 0],

33 [5, 4, 3, 2]], 
dty³
=
Å
.
æßt32
)

34 
£lf
.
	`as£¹AÎEqu®
(
Å
.
	`squ“ze
(
py¿mid_image
[:, :, 0]),

35 
ex³ùed_fœ¡_chªÃl
)

37 #Aùu® 
‹¡
.

38 
ex³ùed_image
 = 
Å
.
	$¬¿y
([[[3, 30],

49 [2, 20]]], 
dty³
=
Å
.
æßt32
)

51 
£lf
.
	$as£¹AÎEqu®
(
py¿mid_image
, 
ex³ùed_image
)

53 
def
 
	$‹¡_¿ndom_boxes
(
£lf
):

55 
num_boxes
 = 1000

56 
max_height
 = 3

57 
max_width
 = 5

58 
boxes
 = 
‹¡_uts
.
	$ü—‹_¿ndom_boxes
(
num_boxes
,

59 
max_height
,

60 
max_width
)

62 
Œue_cŞumn
 = 
Å
.
	`Úes
(
sh­e
=(
num_boxes
)) == 1

63 
£lf
.
	`as£¹AÎEqu®
(
boxes
[:, 0] < boxes[:, 2], 
Œue_cŞumn
)

64 
£lf
.
	`as£¹AÎEqu®
(
boxes
[:, 1] < boxes[:, 3], 
Œue_cŞumn
)

66 
£lf
.
	`as£¹True
(
boxes
[:, 0].
	`mš
() >= 0)

67 
£lf
.
	`as£¹True
(
boxes
[:, 1].
	`mš
() >= 0)

68 
£lf
.
	`as£¹True
(
boxes
[:, 2].
	`max
(è<ğ
max_height
)

69 
£lf
.
	`as£¹True
(
boxes
[:, 3].
	`max
(è<ğ
max_width
)

72 
__Çme__
 == '__main__':

73 
tf
.
‹¡
.
	`maš
()

	@utils/variables_helper.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
impÜt
 
loggšg


19 
impÜt
 
»


21 
impÜt
 
‹nsÜæow
 
as
 
tf


23 
	g¦im
 = 
tf
.
cÚŒib
.
¦im


26 #TODO: 
CÚsid”
 
»¶acšg
 
w™h
 
tf
.
cÚŒib
.
f‹r_v¬ŸbËs
 
š


27 #‹nsÜæow/
cÚŒib
/
äamewÜk
/
pythÚ
/
İs
/
v¬ŸbËs
.
py


28 
def
 
	$f‹r_v¬ŸbËs
(
v¬ŸbËs
, 
f‹r_»gex_li¡
, 
šv”t
=
F®£
):

31 
F‹r
 
out
 
the
 
v¬ŸbËs
 
who£
 
Çme
 
m©ches
h
ªy
 
of
h
»guÏr


32 
ex´essiÚs
 
š
 
f‹r_»gex_li¡
 
ªd
 
»tuºs
 
the
 
»maššg
 
v¬ŸbËs
.

33 
O±iÚ®ly
, 
šv”t
=
True
, 
the
 
com¶em’t
 
£t
 
is
 
»tuºed
.

35 
Args
:

36 
v¬ŸbËs
: 
a
 
li¡
 
of
 
‹nsÜæow
 variables.

37 
f‹r_»gex_li¡
: 
a
 
li¡
 
of
 
¡ršg
 
»guÏr
 
ex´essiÚs
.

38 
šv”t
: (
boŞ—n
). 
If
 
True
, 
»tuºs
 
the
 
com¶em’t
 
of
h
f‹r
 
£t
; 
th©


39 
is
, 
®l
 
v¬ŸbËs
 
m©chšg
 
f‹r_»gex
 
¬e
 
k•t
 
ªd
‡Î 
Ùh”s
 
disÿrded
.

41 
R‘uºs
:

42 
a
 
li¡
 
of
 
f‹»d
 
v¬ŸbËs
.

44 
k•t_v¬s
 = []

45 
v¬ŸbËs_to_ignÜe_·‰”ns
 = 
	$f‹r
(
NÚe
, 
f‹r_»gex_li¡
)

46 
v¬
 
š
 
v¬ŸbËs
:

47 
add
 = 
True


48 
·‰”n
 
š
 
v¬ŸbËs_to_ignÜe_·‰”ns
:

49 
»
.
	$m©ch
(
·‰”n
, 
v¬
.
İ
.
Çme
):

50 
add
 = 
F®£


52 
add
 !ğ
šv”t
:

53 
k•t_v¬s
.
	$­³nd
(
v¬
)

54  
k•t_v¬s


57 
def
 
	$muÉly_g¿d›Ás_m©chšg_»gex
(
g¿ds_ªd_v¬s
, 
»gex_li¡
, 
muÉl›r
):

60 
Args
:

61 
g¿ds_ªd_v¬s
: 
A
 
li¡
 
of
 
g¿d›Á
 
to
 
v¬ŸbË
 
	`·œs
 (
tu¶es
).

62 
»gex_li¡
: 
A
 
li¡
 
of
 
¡ršg
 
»guÏr
 
ex´essiÚs
.

63 
muÉl›r
: 
	$A
 (è
muÉl›r
 
to
 
­¶y
Ø
—ch
 
g¿d›Á
 
m©chšg
 
the


64 
»guÏr
 
ex´essiÚ
.

66 
R‘uºs
:

67 
g¿ds_ªd_v¬s
: 
A
 
li¡
 
of
 
g¿d›Á
 
to
 
v¬ŸbË
 
	`·œs
 (
tu¶es
).

69 
v¬ŸbËs
 = [
·œ
[1] ·œ 
š
 
g¿ds_ªd_v¬s
]

70 
m©chšg_v¬s
 = 
	$f‹r_v¬ŸbËs
(
v¬ŸbËs
, 
»gex_li¡
, 
šv”t
=
True
)

71 
v¬
 
š
 
m©chšg_v¬s
:

72 
loggšg
.
	`šfo
('Applying multiplier %fo variable [%s]',

73 
muÉl›r
, 
v¬
.
İ
.
Çme
)

74 
g¿d_muÉl›rs
 = {
v¬
: (
muÉl›r
èv¬ 
š
 
m©chšg_v¬s
}

75  
¦im
.
Ë¬nšg
.
	$muÉly_g¿d›Ás
(
g¿ds_ªd_v¬s
,

76 
g¿d_muÉl›rs
)

79 
def
 
	$ä“ze_g¿d›Ás_m©chšg_»gex
(
g¿ds_ªd_v¬s
, 
»gex_li¡
):

82 
Args
:

83 
g¿ds_ªd_v¬s
: 
A
 
li¡
 
of
 
g¿d›Á
 
to
 
v¬ŸbË
 
	`·œs
 (
tu¶es
).

84 
»gex_li¡
: 
A
 
li¡
 
of
 
¡ršg
 
»guÏr
 
ex´essiÚs
.

86 
R‘uºs
:

87 
g¿ds_ªd_v¬s
: 
A
 
li¡
 
of
 
g¿d›Á
 
to
 
v¬ŸbË
 
	$·œs
 (
tu¶es
è
th©
 dØ
nÙ


88 
cÚš
 
the
 
v¬ŸbËs
 
ªd
 
g¿d›Ás
 
m©chšg
h
»gex
.

90 
v¬ŸbËs
 = [
·œ
[1] ·œ 
š
 
g¿ds_ªd_v¬s
]

91 
m©chšg_v¬s
 = 
	$f‹r_v¬ŸbËs
(
v¬ŸbËs
, 
»gex_li¡
, 
šv”t
=
True
)

92 
k•t_g¿ds_ªd_v¬s
 = [
·œ
 ·œ 
š
 
g¿ds_ªd_v¬s


93 
·œ
[1] 
nÙ
 
š
 
m©chšg_v¬s
]

94 
v¬
 
š
 
m©chšg_v¬s
:

95 
loggšg
.
	`šfo
('F»ezšg v¬ŸbË [%s]', 
v¬
.
İ
.
Çme
)

96  
k•t_g¿ds_ªd_v¬s


99 
def
 
	$g‘_v¬ŸbËs_avaabË_š_checkpošt
(
v¬ŸbËs
, 
checkpošt_·th
):

102 
In¥eùs
 
giv’
 
checkpošt
 
ªd
 
»tuºs
 
the
 
sub£t
 
of
 
v¬ŸbËs
 
th©
 
¬e


103 
avaabË
 
š
 
™
.

105 
TODO
: 
fÜû
 
šput
 
ªd
 
ouut
 
to
 
be
 
a
 
diùiÚ¬y
.

107 
Args
:

108 
v¬ŸbËs
: 
a
 
li¡
 
Ü
 
diùiÚ¬y
 
of
 v¬ŸbË 
to
 
fšd
 
š
 
checkpošt
.

109 
checkpošt_·th
: 
·th
 
to
 
the
 
checkpošt
Ø
»¡Üe
 
v¬ŸbËs
 
äom
.

111 
R‘uºs
:

112 
A
 
li¡
 
Ü
 
diùiÚ¬y
 
of
 
v¬ŸbËs
.

113 
Rai£s
:

114 
V®ueE¼Ü
: `
v¬ŸbËs
` 
is
 
nÙ
 
a
 
li¡
 
Ü
 
diù
.

116 
	$isš¡ªû
(
v¬ŸbËs
, 
li¡
):

117 
v¬ŸbË_Çmes_m­
 = {
v¬ŸbË
.
İ
.
Çme
: v¬ŸbË v¬ŸbË 
š
 
v¬ŸbËs
}

118 
–if
 
	$isš¡ªû
(
v¬ŸbËs
, 
diù
):

119 
v¬ŸbË_Çmes_m­
 = 
v¬ŸbËs


121 
¿i£
 
	`V®ueE¼Ü
('`variables` isƒxpectedo be‡†ist or dict.')

122 
ck±_»ad”
 = 
tf
.
Œaš
.
	$NewCheckpoštR—d”
(
checkpošt_·th
)

123 
ck±_v¬s
 = 
ck±_»ad”
.
	`g‘_v¬ŸbË_to_sh­e_m­
().
	$keys
()

124 
v¬s_š_ck±
 = {
	}
}

125 
v¬ŸbË_Çme
, 
v¬ŸbË
 
š
 
sÜ‹d
(
v¬ŸbË_Çmes_m­
.
	$™ems
()):

126 
v¬ŸbË_Çme
 
š
 
ck±_v¬s
:

127 
v¬s_š_ck±
[
v¬ŸbË_Çme
] = 
v¬ŸbË


129 
loggšg
.
	`w¬nšg
('Variable [%s]‚ot‡vailable in checkpoint',

130 
v¬ŸbË_Çme
)

131 
	$isš¡ªû
(
v¬ŸbËs
, 
li¡
):

132  
v¬s_š_ck±
.
	$v®ues
()

133  
v¬s_š_ck±


	@utils/variables_helper_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

17 
impÜt
 
os


19 
impÜt
 
‹nsÜæow
 
as
 
tf


21 
äom
 
	gobjeù_d‘eùiÚ
.
uts
 
impÜt
 
v¬ŸbËs_h–³r


24 
şass
 
	$F‹rV¬ŸbËsTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

26 
def
 
	$_ü—‹_v¬ŸbËs
(
£lf
):

27  [
tf
.
	`V¬ŸbË
(1.0, 
Çme
='FeatureExtractor/InceptionV3/weights'),

28 
tf
.
	`V¬ŸbË
(1.0, 
Çme
='FeatureExtractor/InceptionV3/biases'),

29 
tf
.
	`V¬ŸbË
(1.0, 
Çme
='StackProposalGenerator/weights'),

30 
tf
.
	`V¬ŸbË
(1.0, 
Çme
='StackProposalGenerator/biases')]

32 
def
 
	$‹¡_»tuº_®l_v¬ŸbËs_wh’_em±y_»gex
(
£lf
):

33 
v¬ŸbËs
 = 
£lf
.
	$_ü—‹_v¬ŸbËs
()

34 
out_v¬ŸbËs
 = 
v¬ŸbËs_h–³r
.
	`f‹r_v¬ŸbËs
(
v¬ŸbËs
, [''])

35 
£lf
.
	$as£¹I‹msEqu®
(
out_v¬ŸbËs
, 
v¬ŸbËs
)

37 
def
 
	$‹¡_»tuº_v¬ŸbËs_which_do_nÙ_m©ch_sšgË_»gex
(
£lf
):

38 
v¬ŸbËs
 = 
£lf
.
	$_ü—‹_v¬ŸbËs
()

39 
out_v¬ŸbËs
 = 
v¬ŸbËs_h–³r
.
	`f‹r_v¬ŸbËs
(
v¬ŸbËs
,

41 
£lf
.
	$as£¹I‹msEqu®
(
out_v¬ŸbËs
, 
v¬ŸbËs
[2:])

43 
def
 
	$‹¡_»tuº_v¬ŸbËs_which_do_nÙ_m©ch_ªy_»gex_š_li¡
(
£lf
):

44 
v¬ŸbËs
 = 
£lf
.
	$_ü—‹_v¬ŸbËs
()

45 
out_v¬ŸbËs
 = 
v¬ŸbËs_h–³r
.
	`f‹r_v¬ŸbËs
(
v¬ŸbËs
, [

48 
£lf
.
	$as£¹I‹msEqu®
(
out_v¬ŸbËs
, [
v¬ŸbËs
[0], variables[2]])

50 
def
 
	$‹¡_»tuº_v¬ŸbËs_m©chšg_em±y_»gex_li¡
(
£lf
):

51 
v¬ŸbËs
 = 
£lf
.
	$_ü—‹_v¬ŸbËs
()

52 
out_v¬ŸbËs
 = 
v¬ŸbËs_h–³r
.
	`f‹r_v¬ŸbËs
(

53 
v¬ŸbËs
, [''], 
šv”t
=
True
)

54 
£lf
.
	$as£¹I‹msEqu®
(
out_v¬ŸbËs
, [])

56 
def
 
	$‹¡_»tuº_v¬ŸbËs_m©chšg_some_»gex_š_li¡
(
£lf
):

57 
v¬ŸbËs
 = 
£lf
.
	$_ü—‹_v¬ŸbËs
()

58 
out_v¬ŸbËs
 = 
v¬ŸbËs_h–³r
.
	`f‹r_v¬ŸbËs
(

59 
v¬ŸbËs
,

61 
šv”t
=
True
)

62 
£lf
.
	$as£¹I‹msEqu®
(
out_v¬ŸbËs
, [
v¬ŸbËs
[1], variables[3]])

65 
şass
 
	$MuÉlyG¿d›ÁsM©chšgRegexTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

67 
def
 
	$_ü—‹_g¿ds_ªd_v¬s
(
£lf
):

68  [(
tf
.
	`cÚ¡ªt
(1.0),

69 
tf
.
	`V¬ŸbË
(1.0, 
Çme
='FeatureExtractor/InceptionV3/weights')),

70 (
tf
.
	`cÚ¡ªt
(2.0),

71 
tf
.
	`V¬ŸbË
(2.0, 
Çme
='FeatureExtractor/InceptionV3/biases')),

72 (
tf
.
	`cÚ¡ªt
(3.0),

73 
tf
.
	`V¬ŸbË
(3.0, 
Çme
='StackProposalGenerator/weights')),

74 (
tf
.
	`cÚ¡ªt
(4.0),

75 
tf
.
	`V¬ŸbË
(4.0, 
Çme
='StackProposalGenerator/biases'))]

77 
def
 
	$‹¡_muÉly_®l_ã©u»_exŒaùÜ_v¬ŸbËs
(
£lf
):

78 
g¿ds_ªd_v¬s
 = 
£lf
.
	$_ü—‹_g¿ds_ªd_v¬s
()

79 
»gex_li¡
 = ['FeatureExtractor/.*']

80 
muÉl›r
 = 0.0

81 
g¿ds_ªd_v¬s
 = 
v¬ŸbËs_h–³r
.
	$muÉly_g¿d›Ás_m©chšg_»gex
(

82 
g¿ds_ªd_v¬s
, 
»gex_li¡
, 
muÉl›r
)

83 
exp_ouut
 = [(0.0, 1.0), (0.0, 2.0), (3.0, 3.0), (4.0, 4.0)]

84 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

85 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

86 
£ss
.
	$run
(
š™_İ
)

87 
ouut
 = 
£ss
.
	$run
(
g¿ds_ªd_v¬s
)

88 
£lf
.
	$as£¹I‹msEqu®
(
ouut
, 
exp_ouut
)

90 
def
 
	$‹¡_muÉly_®l_bŸs_v¬ŸbËs
(
£lf
):

91 
g¿ds_ªd_v¬s
 = 
£lf
.
	$_ü—‹_g¿ds_ªd_v¬s
()

92 
»gex_li¡
 = ['.*/biases']

93 
muÉl›r
 = 0.0

94 
g¿ds_ªd_v¬s
 = 
v¬ŸbËs_h–³r
.
	$muÉly_g¿d›Ás_m©chšg_»gex
(

95 
g¿ds_ªd_v¬s
, 
»gex_li¡
, 
muÉl›r
)

96 
exp_ouut
 = [(1.0, 1.0), (0.0, 2.0), (3.0, 3.0), (0.0, 4.0)]

97 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

98 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

99 
£ss
.
	$run
(
š™_İ
)

100 
ouut
 = 
£ss
.
	$run
(
g¿ds_ªd_v¬s
)

101 
£lf
.
	$as£¹I‹msEqu®
(
ouut
, 
exp_ouut
)

104 
şass
 
	$F»ezeG¿d›ÁsM©chšgRegexTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

106 
def
 
	$_ü—‹_g¿ds_ªd_v¬s
(
£lf
):

107  [(
tf
.
	`cÚ¡ªt
(1.0),

108 
tf
.
	`V¬ŸbË
(1.0, 
Çme
='FeatureExtractor/InceptionV3/weights')),

109 (
tf
.
	`cÚ¡ªt
(2.0),

110 
tf
.
	`V¬ŸbË
(2.0, 
Çme
='FeatureExtractor/InceptionV3/biases')),

111 (
tf
.
	`cÚ¡ªt
(3.0),

112 
tf
.
	`V¬ŸbË
(3.0, 
Çme
='StackProposalGenerator/weights')),

113 (
tf
.
	`cÚ¡ªt
(4.0),

114 
tf
.
	`V¬ŸbË
(4.0, 
Çme
='StackProposalGenerator/biases'))]

116 
def
 
	$‹¡_ä“ze_®l_ã©u»_exŒaùÜ_v¬ŸbËs
(
£lf
):

117 
g¿ds_ªd_v¬s
 = 
£lf
.
	$_ü—‹_g¿ds_ªd_v¬s
()

118 
»gex_li¡
 = ['FeatureExtractor/.*']

119 
g¿ds_ªd_v¬s
 = 
v¬ŸbËs_h–³r
.
	$ä“ze_g¿d›Ás_m©chšg_»gex
(

120 
g¿ds_ªd_v¬s
, 
»gex_li¡
)

121 
exp_ouut
 = [(3.0, 3.0), (4.0, 4.0)]

122 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

123 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

124 
£ss
.
	$run
(
š™_İ
)

125 
ouut
 = 
£ss
.
	$run
(
g¿ds_ªd_v¬s
)

126 
£lf
.
	$as£¹I‹msEqu®
(
ouut
, 
exp_ouut
)

129 
şass
 
	$G‘V¬ŸbËsAvaabËInCheckpoštTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

131 
def
 
	$‹¡_»tuº_®l_v¬ŸbËs_äom_checkpošt
(
£lf
):

132 
v¬ŸbËs
 = [

133 
tf
.
	`V¬ŸbË
(1.0, 
Çme
='weights'),

134 
tf
.
	`V¬ŸbË
(1.0, 
Çme
='biases')

136 
checkpošt_·th
 = 
os
.
·th
.
	`još
(
£lf
.
	`g‘_‹mp_dœ
(), 'graph.pb')

137 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

138 
§v”
 = 
tf
.
Œaš
.
	$Sav”
(
v¬ŸbËs
)

139 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

140 
£ss
.
	$run
(
š™_İ
)

141 
§v”
.
	$§ve
(
£ss
, 
checkpošt_·th
)

142 
out_v¬ŸbËs
 = 
v¬ŸbËs_h–³r
.
	$g‘_v¬ŸbËs_avaabË_š_checkpošt
(

143 
v¬ŸbËs
, 
checkpošt_·th
)

144 
£lf
.
	$as£¹I‹msEqu®
(
out_v¬ŸbËs
, 
v¬ŸbËs
)

146 
def
 
	$‹¡_»tuº_v¬ŸbËs_avaabË_š_checkpošt
(
£lf
):

147 
checkpošt_·th
 = 
os
.
·th
.
	`još
(
£lf
.
	`g‘_‹mp_dœ
(), 'graph.pb')

148 
g¿ph1_v¬ŸbËs
 = [

149 
tf
.
	`V¬ŸbË
(1.0, 
Çme
='weights'),

151 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

152 
§v”
 = 
tf
.
Œaš
.
	$Sav”
(
g¿ph1_v¬ŸbËs
)

153 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

154 
£ss
.
	$run
(
š™_İ
)

155 
§v”
.
	$§ve
(
£ss
, 
checkpošt_·th
)

157 
g¿ph2_v¬ŸbËs
 = 
g¿ph1_v¬ŸbËs
 + [
tf
.
	`V¬ŸbË
(1.0, 
Çme
='biases')]

158 
out_v¬ŸbËs
 = 
v¬ŸbËs_h–³r
.
	$g‘_v¬ŸbËs_avaabË_š_checkpošt
(

159 
g¿ph2_v¬ŸbËs
, 
checkpošt_·th
)

160 
£lf
.
	$as£¹I‹msEqu®
(
out_v¬ŸbËs
, 
g¿ph1_v¬ŸbËs
)

162 
def
 
	$‹¡_»tuº_v¬ŸbËs_avaabË_ª_checkpošt_w™h_diù_šputs
(
£lf
):

163 
checkpošt_·th
 = 
os
.
·th
.
	`još
(
£lf
.
	`g‘_‹mp_dœ
(), 'graph.pb')

164 
g¿ph1_v¬ŸbËs
 = [

165 
tf
.
	`V¬ŸbË
(1.0, 
Çme
='ckpt_weights'),

167 
š™_İ
 = 
tf
.
	$glob®_v¬ŸbËs_š™Ÿliz”
()

168 
§v”
 = 
tf
.
Œaš
.
	$Sav”
(
g¿ph1_v¬ŸbËs
)

169 
w™h
 
£lf
.
	$‹¡_£ssiÚ
(è
as
 
£ss
:

170 
£ss
.
	$run
(
š™_İ
)

171 
§v”
.
	$§ve
(
£ss
, 
checkpošt_·th
)

173 
g¿ph2_v¬ŸbËs_diù
 = {

174 'ck±_weights': 
tf
.
	`V¬ŸbË
(1.0, 
Çme
='weights'),

175 'ck±_bŸ£s': 
tf
.
	`V¬ŸbË
(1.0, 
Çme
='biases')

176 
	}
}

177 
	gout_v¬ŸbËs
 = 
v¬ŸbËs_h–³r
.
	$g‘_v¬ŸbËs_avaabË_š_checkpošt
(

178 
g¿ph2_v¬ŸbËs_diù
, 
checkpošt_·th
)

179 
£lf
.
	`as£¹True
(
	$isš¡ªû
(
out_v¬ŸbËs
, 
diù
))

180 
£lf
.
	`as£¹I‹msEqu®
(
out_v¬ŸbËs
.
	`keys
(), ['ckpt_weights'])

181 
£lf
.
	`as£¹True
(
out_v¬ŸbËs
['ck±_weights'].
İ
.
Çme
 == 'weights')

184 
__Çme__
 == '__main__':

185 
tf
.
‹¡
.
	`maš
()

	@utils/visualization_utils.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
The£
 
funùiÚs
 
oá’
 
»ûive
 
ª
 
	gimage
, 
³rfÜm
 
some
 
visu®iz©iÚ
 
Ú
 
the
 image.

19 
The
 
funùiÚs
 dØ
nÙ
  
a
 
	gv®ue
, 
š¡—d
 
they
 
modify
 
the
 
image
 
	g™£lf
.

22 
impÜt
 
cŞËùiÚs


23 
impÜt
 
numpy
 
as
 
Å


24 
impÜt
 
	gPIL
.
Image
 
as
 Image

25 
impÜt
 
	gPIL
.
ImageCŞÜ
 
as
 ImageColor

26 
impÜt
 
	gPIL
.
ImageD¿w
 
as
 ImageDraw

27 
impÜt
 
	gPIL
.
ImageFÚt
 
as
 ImageFont

28 
impÜt
 
six


29 
impÜt
 
‹nsÜæow
 
as
 
tf


32 
	g_TITLE_LEFT_MARGIN
 = 10

33 
_TITLE_TOP_MARGIN
 = 10

34 
STANDARD_COLORS
 = [

61 
def
 
	$§ve_image_¬¿y_as_²g
(
image
, 
ouut_·th
):

64 
Args
:

65 
image
: 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
height
, 
width
, 3].

66 
ouut_·th
: 
·th
 
to
 
which
 
image
 
should
 
be
 
wr™‹n
.

68 
image_p
 = 
Image
.
	`äom¬¿y
(
Å
.
	`ušt8
(
image
)).
	`cÚv”t
('RGB')

69 
w™h
 
tf
.
gfe
.
	`O³n
(
ouut_·th
, 'w'è
as
 
fid
:

70 
image_p
.
	`§ve
(
fid
, 'PNG')

73 
def
 
	$’code_image_¬¿y_as_²g_¡r
(
image
):

76 
Args
:

77 
image
: 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
height
, 
width
, 3].

79 
R‘uºs
:

80 
PNG
 
’coded
 
image
 
¡ršg
.

82 
image_p
 = 
Image
.
	`äom¬¿y
(
Å
.
	$ušt8
(
image
))

83 
ouut
 = 
six
.
	$By‹sIO
()

84 
image_p
.
	`§ve
(
ouut
, 
fÜm©
='PNG')

85 
²g_¡ršg
 = 
ouut
.
	$g‘v®ue
()

86 
ouut
.
	$şo£
()

87  
²g_¡ršg


90 
def
 
	`d¿w_boundšg_box_Ú_image_¬¿y
(
image
,

91 
ymš
,

92 
xmš
,

93 
ymax
,

94 
xmax
,

95 
cŞÜ
='red',

96 
thickÃss
=4,

97 
di¥Ïy_¡r_li¡
=(),

98 
u£_nÜm®ized_coÜdš©es
=
True
):

101 
Args
:

102 
image
: 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
height
, 
width
, 3].

103 
ymš
: ymš 
of
 
boundšg
 
box
 
š
 
nÜm®ized
 
	`coÜdš©es
 (
§me
 
b–ow
).

104 
xmš
: xmš 
of
 
boundšg
 
box
.

105 
ymax
: ymax 
of
 
boundšg
 
box
.

106 
xmax
: xmax 
of
 
boundšg
 
box
.

107 
cŞÜ
: cŞÜ 
to
 
d¿w
 
boundšg
 
box
. 
DeçuÉ
 
is
 
»d
.

108 
thickÃss
: 
lše
hickÃss. 
DeçuÉ
 
v®ue
 
is
 4.

109 
di¥Ïy_¡r_li¡
: 
li¡
 
of
 
¡ršgs
 
to
 
di¥Ïy
 
š
 
box


110 (
—ch
 
to
 
be
 
shown
 
Ú
 
™s
 
own
 
lše
).

111 
u£_nÜm®ized_coÜdš©es
: 
If
 
	`True
 (), 
Œ—t
 
coÜdš©es


112 
ymš
, 
xmš
, 
ymax
, 
xmax
 
as
 
»Ïtive
 
to
 
the
 
image
. 
Oth”wi£
 
Œ—t


113 
coÜdš©es
 
as
 
absŞu‹
.

115 
image_p
 = 
Image
.
	`äom¬¿y
(
Å
.
	`ušt8
(
image
)).
	`cÚv”t
('RGB')

116 
	$d¿w_boundšg_box_Ú_image
(
image_p
, 
ymš
, 
xmš
, 
ymax
, 
xmax
, 
cŞÜ
,

117 
thickÃss
, 
di¥Ïy_¡r_li¡
,

118 
u£_nÜm®ized_coÜdš©es
)

119 
Å
.
	`cİyto
(
image
,‚p.
	$¬¿y
(
image_p
))

122 
def
 
	`d¿w_boundšg_box_Ú_image
(
image
,

123 
ymš
,

124 
xmš
,

125 
ymax
,

126 
xmax
,

127 
cŞÜ
='red',

128 
thickÃss
=4,

129 
di¥Ïy_¡r_li¡
=(),

130 
u£_nÜm®ized_coÜdš©es
=
True
):

133 
Each
 
¡ršg
 
š
 
di¥Ïy_¡r_li¡
 
is
 
di¥Ïyed
 
Ú
 
a
 
£·¿‹
 
lše
 
above
 
the


134 
boundšg
 
box
 
š
 
bÏck
 
‹xt
 
Ú
 
a
 
»ùªgË
 
fËd
 
w™h
 
the
 
šput
 'color'.

136 
Args
:

137 
image
: 
a
 
PIL
.
Image
 
objeù
.

138 
ymš
: ymš 
of
 
boundšg
 
box
.

139 
xmš
: xmš 
of
 
boundšg
 
box
.

140 
ymax
: ymax 
of
 
boundšg
 
box
.

141 
xmax
: xmax 
of
 
boundšg
 
box
.

142 
cŞÜ
: cŞÜ 
to
 
d¿w
 
boundšg
 
box
. 
DeçuÉ
 
is
 
»d
.

143 
thickÃss
: 
lše
hickÃss. 
DeçuÉ
 
v®ue
 
is
 4.

144 
di¥Ïy_¡r_li¡
: 
li¡
 
of
 
¡ršgs
 
to
 
di¥Ïy
 
š
 
box


145 (
—ch
 
to
 
be
 
shown
 
Ú
 
™s
 
own
 
lše
).

146 
u£_nÜm®ized_coÜdš©es
: 
If
 
	`True
 (), 
Œ—t
 
coÜdš©es


147 
ymš
, 
xmš
, 
ymax
, 
xmax
 
as
 
»Ïtive
 
to
 
the
 
image
. 
Oth”wi£
 
Œ—t


148 
coÜdš©es
 
as
 
absŞu‹
.

150 
d¿w
 = 
ImageD¿w
.
	$D¿w
(
image
)

151 
im_width
, 
im_height
 = 
image
.
size


152 
u£_nÜm®ized_coÜdš©es
:

153 (
Ëá
, 
right
, 
tİ
, 
bÙtom
èğ(
xmš
 * 
im_width
, 
xmax
 * im_width,

154 
ymš
 * 
im_height
, 
ymax
 * im_height)

156 (
Ëá
, 
right
, 
tİ
, 
bÙtom
èğ(
xmš
, 
xmax
, 
ymš
, 
ymax
)

157 
d¿w
.
	`lše
([(
Ëá
, 
tİ
), (Ëá, 
bÙtom
), (
right
, bottom),

158 (
right
, 
tİ
), (
Ëá
,İ)], 
width
=
thickÃss
, 
fl
=
cŞÜ
)

159 
Œy
:

160 
fÚt
 = 
ImageFÚt
.
	`Œu‘y³
('arial.ttf', 24)

161 
exû±
 
IOE¼Ü
:

162 
fÚt
 = 
ImageFÚt
.
	$lßd_deçuÉ
()

164 
‹xt_bÙtom
 = 
tİ


165 #Rev”£ 
li¡
 
ªd
 
´št
 
äom
 
bÙtom
 
to
 
tİ
.

166 
di¥Ïy_¡r
 
š
 
di¥Ïy_¡r_li¡
[::-1]:

167 
‹xt_width
, 
‹xt_height
 = 
fÚt
.
	$g‘size
(
di¥Ïy_¡r
)

168 
m¬gš
 = 
Å
.
	$û
(0.05 * 
‹xt_height
)

169 
d¿w
.
	`»ùªgË
(

170 [(
Ëá
, 
‹xt_bÙtom
 - 
‹xt_height
 - 2 * 
m¬gš
), (Ëá + 
‹xt_width
,

171 
‹xt_bÙtom
)],

172 
fl
=
cŞÜ
)

173 
d¿w
.
	`‹xt
(

174 (
Ëá
 + 
m¬gš
, 
‹xt_bÙtom
 - 
‹xt_height
 - margin),

175 
di¥Ïy_¡r
,

176 
fl
='black',

177 
fÚt
=font)

178 
‹xt_bÙtom
 -ğ
‹xt_height
 - 2 * 
m¬gš


181 
def
 
	`d¿w_boundšg_boxes_Ú_image_¬¿y
(
image
,

182 
boxes
,

183 
cŞÜ
='red',

184 
thickÃss
=4,

185 
di¥Ïy_¡r_li¡_li¡
=()):

188 
Args
:

189 
image
: 
a
 
numpy
 
¬¿y
 
objeù
.

190 
boxes
: 
a
 2 
dim’siÚ®
 
numpy
 
¬¿y
 
of
 [
N
, 4]: (
ymš
, 
xmš
, 
ymax
, 
xmax
).

191 
The
 
coÜdš©es
 
¬e
 
š
 
nÜm®ized
 
fÜm©
 
b‘w“n
 [0, 1].

192 
cŞÜ
: cŞÜ 
to
 
d¿w
 
boundšg
 
box
. 
DeçuÉ
 
is
 
»d
.

193 
thickÃss
: 
lše
hickÃss. 
DeçuÉ
 
v®ue
 
is
 4.

194 
di¥Ïy_¡r_li¡_li¡
: 
li¡
 
of
†i¡ oà
¡ršgs
.

195 
a
 
li¡
 
of
 
¡ršgs
 
—ch
 
boundšg
 
box
.

196 
The
 
»asÚ
 
to
 
·ss
 
a
 
li¡
 
of
 
¡ršgs
 a

197 
boundšg
 
box
 
is
 
th©
 
™
 
might
 
cÚš


198 
muÉË
 
Ïb–s
.

200 
Rai£s
:

201 
V®ueE¼Ü
: 
boxes
 
is
 
nÙ
 
a
 [
N
, 4] 
¬¿y


203 
image_p
 = 
Image
.
	$äom¬¿y
(
image
)

204 
	$d¿w_boundšg_boxes_Ú_image
(
image_p
, 
boxes
, 
cŞÜ
, 
thickÃss
,

205 
di¥Ïy_¡r_li¡_li¡
)

206 
Å
.
	`cİyto
(
image
,‚p.
	$¬¿y
(
image_p
))

209 
def
 
	`d¿w_boundšg_boxes_Ú_image
(
image
,

210 
boxes
,

211 
cŞÜ
='red',

212 
thickÃss
=4,

213 
di¥Ïy_¡r_li¡_li¡
=()):

216 
Args
:

217 
image
: 
a
 
PIL
.
Image
 
objeù
.

218 
boxes
: 
a
 2 
dim’siÚ®
 
numpy
 
¬¿y
 
of
 [
N
, 4]: (
ymš
, 
xmš
, 
ymax
, 
xmax
).

219 
The
 
coÜdš©es
 
¬e
 
š
 
nÜm®ized
 
fÜm©
 
b‘w“n
 [0, 1].

220 
cŞÜ
: cŞÜ 
to
 
d¿w
 
boundšg
 
box
. 
DeçuÉ
 
is
 
»d
.

221 
thickÃss
: 
lše
hickÃss. 
DeçuÉ
 
v®ue
 
is
 4.

222 
di¥Ïy_¡r_li¡_li¡
: 
li¡
 
of
†i¡ oà
¡ršgs
.

223 
a
 
li¡
 
of
 
¡ršgs
 
—ch
 
boundšg
 
box
.

224 
The
 
»asÚ
 
to
 
·ss
 
a
 
li¡
 
of
 
¡ršgs
 a

225 
boundšg
 
box
 
is
 
th©
 
™
 
might
 
cÚš


226 
muÉË
 
Ïb–s
.

228 
Rai£s
:

229 
V®ueE¼Ü
: 
boxes
 
is
 
nÙ
 
a
 [
N
, 4] 
¬¿y


231 
boxes_sh­e
 = 
boxes
.
sh­e


232 
nÙ
 
boxes_sh­e
:

234 
	`Ën
(
boxes_sh­e
è!ğ2 
Ü
 boxes_shape[1] != 4:

235 
¿i£
 
	`V®ueE¼Ü
('Input must be of size [N, 4]')

236 
i
 
š
 
	$¿nge
(
boxes_sh­e
[0]):

237 
di¥Ïy_¡r_li¡
 = ()

238 
di¥Ïy_¡r_li¡_li¡
:

239 
di¥Ïy_¡r_li¡
 = 
di¥Ïy_¡r_li¡_li¡
[
i
]

240 
	$d¿w_boundšg_box_Ú_image
(
image
, 
boxes
[
i
, 0], boxes[i, 1], boxes[i, 2],

241 
boxes
[
i
, 3], 
cŞÜ
, 
thickÃss
, 
di¥Ïy_¡r_li¡
)

244 
def
 
	`d¿w_keypošts_Ú_image_¬¿y
(
image
,

245 
keypošts
,

246 
cŞÜ
='red',

247 
¿dius
=2,

248 
u£_nÜm®ized_coÜdš©es
=
True
):

251 
Args
:

252 
image
: 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
height
, 
width
, 3].

253 
keypošts
: 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
num_keypošts
, 2].

254 
cŞÜ
: cŞÜ 
to
 
d¿w
 
the
 
keypošts
 
w™h
. 
DeçuÉ
 
is
 
»d
.

255 
¿dius
: 
keypošt
„adius. 
DeçuÉ
 
v®ue
 
is
 2.

256 
u£_nÜm®ized_coÜdš©es
: 
	`True
 (), 
Œ—t
 
keypošt
 
v®ues
 
as


257 
»Ïtive
 
to
 
the
 
image
. 
Oth”wi£
 
Œ—t
 
them
 
as
 
absŞu‹
.

259 
image_p
 = 
Image
.
	`äom¬¿y
(
Å
.
	`ušt8
(
image
)).
	`cÚv”t
('RGB')

260 
	$d¿w_keypošts_Ú_image
(
image_p
, 
keypošts
, 
cŞÜ
, 
¿dius
,

261 
u£_nÜm®ized_coÜdš©es
)

262 
Å
.
	`cİyto
(
image
,‚p.
	$¬¿y
(
image_p
))

265 
def
 
	`d¿w_keypošts_Ú_image
(
image
,

266 
keypošts
,

267 
cŞÜ
='red',

268 
¿dius
=2,

269 
u£_nÜm®ized_coÜdš©es
=
True
):

272 
Args
:

273 
image
: 
a
 
PIL
.
Image
 
objeù
.

274 
keypošts
: 
a
 
numpy
 
¬¿y
 
w™h
 
sh­e
 [
num_keypošts
, 2].

275 
cŞÜ
: cŞÜ 
to
 
d¿w
 
the
 
keypošts
 
w™h
. 
DeçuÉ
 
is
 
»d
.

276 
¿dius
: 
keypošt
„adius. 
DeçuÉ
 
v®ue
 
is
 2.

277 
u£_nÜm®ized_coÜdš©es
: 
	`True
 (), 
Œ—t
 
keypošt
 
v®ues
 
as


278 
»Ïtive
 
to
 
the
 
image
. 
Oth”wi£
 
Œ—t
 
them
 
as
 
absŞu‹
.

280 
d¿w
 = 
ImageD¿w
.
	$D¿w
(
image
)

281 
im_width
, 
im_height
 = 
image
.
size


282 
keypošts_x
 = [
k
[1] k 
š
 
keypošts
]

283 
keypošts_y
 = [
k
[0] k 
š
 
keypošts
]

284 
u£_nÜm®ized_coÜdš©es
:

285 
keypošts_x
 = 
	$tu¶e
([
im_width
 * 
x
 x 
š
 
keypošts_x
])

286 
keypošts_y
 = 
	$tu¶e
([
im_height
 * 
y
 y 
š
 
keypošts_y
])

287 
keypošt_x
, 
keypošt_y
 
š
 
	$z
(
keypošts_x
, 
keypošts_y
):

288 
d¿w
.
	`–l£
([(
keypošt_x
 - 
¿dius
, 
keypošt_y
 -„adius),

289 (
keypošt_x
 + 
¿dius
, 
keypošt_y
 +„adius)],

290 
ouše
=
cŞÜ
, 
fl
=color)

293 
def
 
	`d¿w_mask_Ú_image_¬¿y
(
image
, 
mask
, 
cŞÜ
='»d', 
®pha
=0.7):

296 
Args
:

297 
image
: 
ušt8
 
numpy
 
¬¿y
 
w™h
 
	$sh­e
 (
img_height
, img_height, 3)

298 
mask
: 
a
 
numpy
 
¬¿y
 
of
 
	$sh­e
 (
img_height
, img_heightè
w™h


299 
v®ues
 
b‘w“n
 0 
ªd
 1

300 
cŞÜ
: cŞÜ 
to
 
d¿w
 
the
 
keypošts
 
w™h
. 
DeçuÉ
 
is
 
»d
.

301 
®pha
: 
Œª¥¬’cy
 
v®ue
 
b‘w“n
 0 
ªd
 1. (: 0.7)

303 
Rai£s
:

304 
V®ueE¼Ü
: 
On
 
šcÜ»ù
 
d©a
 
ty³
 
image
 
Ü
 
masks
.

306 
image
.
dty³
 !ğ
Å
.
ušt8
:

307 
¿i£
 
	`V®ueE¼Ü
('`image`‚ot ofype‚p.uint8')

308 
mask
.
dty³
 !ğ
Å
.
æßt32
:

309 
¿i£
 
	`V®ueE¼Ü
('`mask`‚ot ofype‚p.float32')

310 
Å
.
	`ªy
Òp.
	`logiÿl_Ü
(
mask
 > 1.0, mask < 0.0)):

311 
¿i£
 
	`V®ueE¼Ü
('`mask`ƒlements should be in [0, 1]')

312 
rgb
 = 
ImageCŞÜ
.
	$g‘rgb
(
cŞÜ
)

313 
p_image
 = 
Image
.
	$äom¬¿y
(
image
)

315 
sŞid_cŞÜ
 = 
Å
.
	`ex·nd_dims
(

316 
Å
.
	`Úes_like
(
mask
), 
axis
=2è*‚p.
	`»sh­e
(
	`li¡
(
rgb
), [1, 1, 3])

317 
p_sŞid_cŞÜ
 = 
Image
.
	`äom¬¿y
(
Å
.
	`ušt8
(
sŞid_cŞÜ
)).
	`cÚv”t
('RGBA')

318 
p_mask
 = 
Image
.
	`äom¬¿y
(
Å
.
	`ušt8
(255.0*
®pha
*
mask
)).
	`cÚv”t
('L')

319 
p_image
 = 
Image
.
	$compos™e
(
p_sŞid_cŞÜ
, 
p_image
, 
p_mask
)

320 
Å
.
	`cİyto
(
image
,‚p.
	`¬¿y
(
p_image
.
	`cÚv”t
('RGB')))

323 
def
 
	$visu®ize_boxes_ªd_Ïb–s_Ú_image_¬¿y
(
image
,

324 
boxes
,

325 
şas£s
,

326 
scÜes
,

327 
ÿ‹gÜy_šdex
,

328 
š¡ªû_masks
=
NÚe
,

329 
keypošts
=
NÚe
,

330 
u£_nÜm®ized_coÜdš©es
=
F®£
,

331 
max_boxes_to_d¿w
=20,

332 
mš_scÜe_th»sh
=.5,

333 
agno¡ic_mode
=
F®£
,

334 
lše_thickÃss
=4):

337 
This
 
funùiÚ
 
groups
 
boxes
 
th©
 
cÜ»¥Úd
 
to
 
the
 
§me
 
loÿtiÚ


338 
ªd
 
ü—‹s
 
a
 
di¥Ïy
 
¡ršg
 
—ch
 
d‘eùiÚ
‡nd 
ov”Ïys
 
the£


339 
Ú
 
the
 
image
. 
NÙe
 
th©
 
this
 
funùiÚ
 
modif›s
himag
¬¿y
 
š
-
¶aû


340 
ªd
 
dÛs
 
nÙ
  
ªythšg
.

342 
Args
:

343 
image
: 
ušt8
 
numpy
 
¬¿y
 
w™h
 
	$sh­e
 (
img_height
, 
img_width
, 3)

344 
boxes
: 
a
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 4]

345 
şas£s
: 
a
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
]

346 
scÜes
: 
a
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
] 
Ü
 
NÚe
. 
If
 scÜes=NÚe, 
th’


347 
this
 
funùiÚ
 
assumes
 
th©
 
the
 
boxes
 
to
 
be
 
¶Ù‹d
 
¬e
 
groundŒuth


348 
boxes
 
ªd
 
¶Ù
 
®l
 boxe 
as
 
bÏck
 
w™h
 
no
 
şas£s
 
Ü
 
scÜes
.

349 
ÿ‹gÜy_šdex
: 
a
 
diù
 
cÚššg
 
ÿ‹gÜy
 
	`diùiÚ¬›s
 (
—ch
 
hŞdšg


350 
ÿ‹gÜy
 
šdex
 `
id
` 
ªd
 c©egÜy 
Çme
 `Çme`è
keyed
 
by
 c©egÜy 
šdiûs
.

351 
š¡ªû_masks
: 
a
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 
image_height
, 
image_width
], 
ÿn


352 
be
 
NÚe


353 
keypošts
: 
a
 
numpy
 
¬¿y
 
of
 
sh­e
 [
N
, 
num_keypošts
, 2], 
ÿn


354 
be
 
NÚe


355 
u£_nÜm®ized_coÜdš©es
: 
wh‘h”
 
boxes
 
is
 
to
 
be
 
š‹½»‹d
 
as


356 
nÜm®ized
 
coÜdš©es
 
Ü
 
nÙ
.

357 
max_boxes_to_d¿w
: 
maximum
 
numb”
 
of
 
boxes
 
to
 
visu®ize
. 
If
 
NÚe
, 
d¿w


358 
®l
 
boxes
.

359 
mš_scÜe_th»sh
: 
mšimum
 
scÜe
 
th»shŞd
 
a
 
box
 
to
 
be
 
visu®ized


360 
agno¡ic_mode
: 
	$boŞ—n
 (: 
F®£
è
cÚŒŞlšg
 
wh‘h”
 
to
 
ev®u©e
 
š


361 
şass
-
agno¡ic
 
mode
 
Ü
 
nÙ
. 
This
 mod
wl
 
di¥Ïy
 
scÜes
 
but
 
ignÜe


362 
şas£s
.

363 
lše_thickÃss
: 
	$š‹g”
 (: 4è
cÚŒŞlšg
 
lše
 
width
 
of
 
the
 
boxes
.

365 #C»©
a
 
di¥Ïy
 
	`¡ršg
 (
ªd
 
cŞÜ
è
ev”y
 
box
 
loÿtiÚ
, 
group
 
ªy
 
boxes


366 #th© 
cÜ»¥Úd
 
to
 
the
 
§me
 
loÿtiÚ
.

367 
box_to_di¥Ïy_¡r_m­
 = 
cŞËùiÚs
.
	$deçuÉdiù
(
li¡
)

368 
box_to_cŞÜ_m­
 = 
cŞËùiÚs
.
	$deçuÉdiù
(
¡r
)

369 
box_to_š¡ªû_masks_m­
 = {
	}
}

370 
box_to_keypošts_m­
 = 
cŞËùiÚs
.
	$deçuÉdiù
(
li¡
)

371 
nÙ
 
max_boxes_to_d¿w
:

372 
max_boxes_to_d¿w
 = 
boxes
.
sh­e
[0]

373 
i
 
š
 
	`¿nge
(
	$mš
(
max_boxes_to_d¿w
, 
boxes
.
sh­e
[0])):

374 
scÜes
 
is
 
NÚe
 
Ü
 scÜes[
i
] > 
mš_scÜe_th»sh
:

375 
box
 = 
	`tu¶e
(
boxes
[
i
].
	$tŞi¡
())

376 
š¡ªû_masks
 
is
 
nÙ
 
NÚe
:

377 
box_to_š¡ªû_masks_m­
[
box
] = 
š¡ªû_masks
[
i
]

378 
keypošts
 
is
 
nÙ
 
NÚe
:

379 
box_to_keypošts_m­
[
box
].
	$ex‹nd
(
keypošts
[
i
])

380 
scÜes
 
is
 
NÚe
:

381 
box_to_cŞÜ_m­
[
box
] = 'black'

383 
nÙ
 
agno¡ic_mode
:

384 
şas£s
[
i
] 
š
 
ÿ‹gÜy_šdex
.
	$keys
():

385 
şass_Çme
 = 
ÿ‹gÜy_šdex
[
şas£s
[
i
]]['name']

387 
şass_Çme
 = 'N/A'

388 
di¥Ïy_¡r
 = '{}: {}%'.
	`fÜm©
(

389 
şass_Çme
,

390 (100*
scÜes
[
i
]))

392 
di¥Ïy_¡r
 = 'scÜe: {}%'.
	`fÜm©
((100 * 
scÜes
[
i
]))

393 
box_to_di¥Ïy_¡r_m­
[
box
].
	$­³nd
(
di¥Ïy_¡r
)

394 
agno¡ic_mode
:

395 
box_to_cŞÜ_m­
[
box
] = 'DarkOrange'

397 
box_to_cŞÜ_m­
[
box
] = 
STANDARD_COLORS
[

398 
şas£s
[
i
] % 
	`Ën
(
STANDARD_COLORS
)]

400 #D¿w 
®l
 
boxes
 
Úto
 
image
.

401 
box
, 
cŞÜ
 
š
 
box_to_cŞÜ_m­
.
	$™ems
():

402 
ymš
, 
xmš
, 
ymax
, 
xmax
 = 
box


403 
š¡ªû_masks
 
is
 
nÙ
 
NÚe
:

404 
	$d¿w_mask_Ú_image_¬¿y
(

405 
image
,

406 
box_to_š¡ªû_masks_m­
[
box
],

407 
cŞÜ
=color

409 
	$d¿w_boundšg_box_Ú_image_¬¿y
(

410 
image
,

411 
ymš
,

412 
xmš
,

413 
ymax
,

414 
xmax
,

415 
cŞÜ
=color,

416 
thickÃss
=
lše_thickÃss
,

417 
di¥Ïy_¡r_li¡
=
box_to_di¥Ïy_¡r_m­
[
box
],

418 
u£_nÜm®ized_coÜdš©es
=use_normalized_coordinates)

419 
keypošts
 
is
 
nÙ
 
NÚe
:

420 
	`d¿w_keypošts_Ú_image_¬¿y
(

421 
image
,

422 
box_to_keypošts_m­
[
box
],

423 
cŞÜ
=color,

424 
¿dius
=
lše_thickÃss
 / 2,

425 
u£_nÜm®ized_coÜdš©es
=use_normalized_coordinates)

	@utils/visualization_utils_test.py

1 #Cİyrighˆ2017 
The
 
T’sÜFlow
 
AuthÜs
. 
AÎ
 
Rights
 
Re£rved
.

2 #
#Liûn£d 
und”
 
the
 
A·che
 
Liûn£
, 
V”siÚ
 2.0 (the "License");

4 #you 
may
 
nÙ
 
u£
 
this
 
fe
 
exû±
 
š
 
com¶Ÿnû
 
w™h
 
the
 
Liûn£
.

5 #You 
may
 
obš
 
a
 
cİy
 
of
 
the
 
Liûn£
 
©


8 #
#UÆes 
»quœed
 
by
 
­¶iÿbË
 
Ïw
 
Ü
 
ag»ed
 
to
 
š
 
wr™šg
, 
soáw¬e


10 #di¡ribu‹d 
und”
 
the
 
Liûn£
 
is
 
di¡ribu‹d
 
Ú
 
ª
 "AS IS" 
BASIS
,

11 #WITHOUT 
WARRANTIES
 
OR
 
CONDITIONS
 
OF
 
ANY
 
KIND
, 
e™h”
 
ex´ess
 
Ü
 
im¶›d
.

12 #S“ 
the
 
Liûn£
 th
¥ecific
 
Ïnguage
 
gov”nšg
 
³rmissiÚs
 
ªd


13 #lim™©iÚ 
und”
 
the
 
Liûn£
.

18 
Te¡šg
 
w™h
 
visu®iz©iÚ
 
š
 
the
 
fŞlowšg
 
	gcŞab
:

19 
h‰ps
:

24 
impÜt
 
numpy
 
as
 
Å


25 
impÜt
 
PIL
.
Image
 
as
 Image

26 
impÜt
 
‹nsÜæow
 
as
 
tf


28 
äom
 
objeù_d‘eùiÚ
.
uts
 
impÜt
 
visu®iz©iÚ_uts


31 
şass
 
	$Visu®iz©iÚUtsTe¡
(
tf
.
‹¡
.
Te¡Ca£
):

33 
def
 
	$ü—‹_cŞÜful_‹¡_image
(
£lf
):

36 
It
 
makes
 
ª
 
image
 
compo£d
 
of
 
four
 
cŞÜed
 
»ùªgËs
.

38 
R‘uºs
:

39 
cŞÜful
 
‹¡
 
numpy
 
¬¿y
 
image
.

41 
ch255
 = 
Å
.
	$fuÎ
([100, 200, 1], 255, 
dty³
=
Å
.
ušt8
)

42 
ch128
 = 
Å
.
	$fuÎ
([100, 200, 1], 128, 
dty³
=
Å
.
ušt8
)

43 
ch0
 = 
Å
.
	$fuÎ
([100, 200, 1], 0, 
dty³
=
Å
.
ušt8
)

44 
imr
 = 
Å
.
	`cÚÿ‹Ç‹
((
ch255
, 
ch128
, ch128), 
axis
=2)

45 
img
 = 
Å
.
	`cÚÿ‹Ç‹
((
ch255
, ch255, 
ch0
), 
axis
=2)

46 
imb
 = 
Å
.
	`cÚÿ‹Ç‹
((
ch255
, 
ch0
, ch255), 
axis
=2)

47 
imw
 = 
Å
.
	`cÚÿ‹Ç‹
((
ch128
, ch128, ch128), 
axis
=2)

48 
imu
 = 
Å
.
	`cÚÿ‹Ç‹
((
imr
, 
img
), 
axis
=1)

49 
imd
 = 
Å
.
	`cÚÿ‹Ç‹
((
imb
, 
imw
), 
axis
=1)

50 
image
 = 
Å
.
	`cÚÿ‹Ç‹
((
imu
, 
imd
), 
axis
=0)

51  
image


53 
def
 
	$‹¡_d¿w_boundšg_box_Ú_image
(
£lf
):

54 
‹¡_image
 = 
£lf
.
	$ü—‹_cŞÜful_‹¡_image
()

55 
‹¡_image
 = 
Image
.
	$äom¬¿y
(
‹¡_image
)

56 
width_Üigš®
, 
height_Üigš®
 = 
‹¡_image
.
size


57 
ymš
 = 0.25

58 
ymax
 = 0.75

59 
xmš
 = 0.4

60 
xmax
 = 0.6

62 
visu®iz©iÚ_uts
.
	$d¿w_boundšg_box_Ú_image
(
‹¡_image
, 
ymš
, 
xmš
, 
ymax
,

63 
xmax
)

64 
width_fš®
, 
height_fš®
 = 
‹¡_image
.
size


66 
£lf
.
	$as£¹Equ®
(
width_Üigš®
, 
width_fš®
)

67 
£lf
.
	$as£¹Equ®
(
height_Üigš®
, 
height_fš®
)

69 
def
 
	$‹¡_d¿w_boundšg_box_Ú_image_¬¿y
(
£lf
):

70 
‹¡_image
 = 
£lf
.
	$ü—‹_cŞÜful_‹¡_image
()

71 
width_Üigš®
 = 
‹¡_image
.
sh­e
[0]

72 
height_Üigš®
 = 
‹¡_image
.
sh­e
[1]

73 
ymš
 = 0.25

74 
ymax
 = 0.75

75 
xmš
 = 0.4

76 
xmax
 = 0.6

78 
visu®iz©iÚ_uts
.
	$d¿w_boundšg_box_Ú_image_¬¿y
(

79 
‹¡_image
, 
ymš
, 
xmš
, 
ymax
, 
xmax
)

80 
width_fš®
 = 
‹¡_image
.
sh­e
[0]

81 
height_fš®
 = 
‹¡_image
.
sh­e
[1]

83 
£lf
.
	$as£¹Equ®
(
width_Üigš®
, 
width_fš®
)

84 
£lf
.
	$as£¹Equ®
(
height_Üigš®
, 
height_fš®
)

86 
def
 
	$‹¡_d¿w_boundšg_boxes_Ú_image
(
£lf
):

87 
‹¡_image
 = 
£lf
.
	$ü—‹_cŞÜful_‹¡_image
()

88 
‹¡_image
 = 
Image
.
	$äom¬¿y
(
‹¡_image
)

89 
width_Üigš®
, 
height_Üigš®
 = 
‹¡_image
.
size


90 
boxes
 = 
Å
.
	$¬¿y
([[0.25, 0.75, 0.4, 0.6],

93 
visu®iz©iÚ_uts
.
	$d¿w_boundšg_boxes_Ú_image
(
‹¡_image
, 
boxes
)

94 
width_fš®
, 
height_fš®
 = 
‹¡_image
.
size


96 
£lf
.
	$as£¹Equ®
(
width_Üigš®
, 
width_fš®
)

97 
£lf
.
	$as£¹Equ®
(
height_Üigš®
, 
height_fš®
)

99 
def
 
	$‹¡_d¿w_boundšg_boxes_Ú_image_¬¿y
(
£lf
):

100 
‹¡_image
 = 
£lf
.
	$ü—‹_cŞÜful_‹¡_image
()

101 
width_Üigš®
 = 
‹¡_image
.
sh­e
[0]

102 
height_Üigš®
 = 
‹¡_image
.
sh­e
[1]

103 
boxes
 = 
Å
.
	$¬¿y
([[0.25, 0.75, 0.4, 0.6],

106 
visu®iz©iÚ_uts
.
	$d¿w_boundšg_boxes_Ú_image_¬¿y
(
‹¡_image
, 
boxes
)

107 
width_fš®
 = 
‹¡_image
.
sh­e
[0]

108 
height_fš®
 = 
‹¡_image
.
sh­e
[1]

110 
£lf
.
	$as£¹Equ®
(
width_Üigš®
, 
width_fš®
)

111 
£lf
.
	$as£¹Equ®
(
height_Üigš®
, 
height_fš®
)

113 
def
 
	$‹¡_d¿w_keypošts_Ú_image
(
£lf
):

114 
‹¡_image
 = 
£lf
.
	$ü—‹_cŞÜful_‹¡_image
()

115 
‹¡_image
 = 
Image
.
	$äom¬¿y
(
‹¡_image
)

116 
width_Üigš®
, 
height_Üigš®
 = 
‹¡_image
.
size


117 
keypošts
 = [[0.25, 0.75], [0.4, 0.6], [0.1, 0.1], [0.9, 0.9]]

119 
visu®iz©iÚ_uts
.
	$d¿w_keypošts_Ú_image
(
‹¡_image
, 
keypošts
)

120 
width_fš®
, 
height_fš®
 = 
‹¡_image
.
size


122 
£lf
.
	$as£¹Equ®
(
width_Üigš®
, 
width_fš®
)

123 
£lf
.
	$as£¹Equ®
(
height_Üigš®
, 
height_fš®
)

125 
def
 
	$‹¡_d¿w_keypošts_Ú_image_¬¿y
(
£lf
):

126 
‹¡_image
 = 
£lf
.
	$ü—‹_cŞÜful_‹¡_image
()

127 
width_Üigš®
 = 
‹¡_image
.
sh­e
[0]

128 
height_Üigš®
 = 
‹¡_image
.
sh­e
[1]

129 
keypošts
 = [[0.25, 0.75], [0.4, 0.6], [0.1, 0.1], [0.9, 0.9]]

131 
visu®iz©iÚ_uts
.
	$d¿w_keypošts_Ú_image_¬¿y
(
‹¡_image
, 
keypošts
)

132 
width_fš®
 = 
‹¡_image
.
sh­e
[0]

133 
height_fš®
 = 
‹¡_image
.
sh­e
[1]

135 
£lf
.
	$as£¹Equ®
(
width_Üigš®
, 
width_fš®
)

136 
£lf
.
	$as£¹Equ®
(
height_Üigš®
, 
height_fš®
)

138 
def
 
	$‹¡_d¿w_mask_Ú_image_¬¿y
(
£lf
):

139 
‹¡_image
 = 
Å
.
	$a§¼ay
([[[0, 0, 0], [0, 0, 0]],

140 [[0, 0, 0], [0, 0, 0]]], 
dty³
=
Å
.
ušt8
)

141 
mask
 = 
Å
.
	$a§¼ay
([[0.0, 1.0],

142 [1.0, 1.0]], 
dty³
=
Å
.
æßt32
)

143 
ex³ùed_»suÉ
 = 
Å
.
	$a§¼ay
([[[0, 0, 0], [0, 0, 127]],

144 [[0, 0, 127], [0, 0, 127]]], 
dty³
=
Å
.
ušt8
)

145 
visu®iz©iÚ_uts
.
	`d¿w_mask_Ú_image_¬¿y
(
‹¡_image
, 
mask
,

146 
cŞÜ
='Blue', 
®pha
=.5)

147 
£lf
.
	$as£¹AÎEqu®
(
‹¡_image
, 
ex³ùed_»suÉ
)

150 
__Çme__
 == '__main__':

151 
tf
.
‹¡
.
	`maš
()

	@
1
.
1
/usr/include
177
5293
__init__.py
anchor_generators/__init__.py
anchor_generators/grid_anchor_generator.py
anchor_generators/grid_anchor_generator_test.py
anchor_generators/multiple_grid_anchor_generator.py
anchor_generators/multiple_grid_anchor_generator_test.py
box_coders/__init__.py
box_coders/faster_rcnn_box_coder.py
box_coders/faster_rcnn_box_coder_test.py
box_coders/keypoint_box_coder.py
box_coders/keypoint_box_coder_test.py
box_coders/mean_stddev_box_coder.py
box_coders/mean_stddev_box_coder_test.py
box_coders/square_box_coder.py
box_coders/square_box_coder_test.py
builders/__init__.py
builders/anchor_generator_builder.py
builders/anchor_generator_builder_test.py
builders/box_coder_builder.py
builders/box_coder_builder_test.py
builders/box_predictor_builder.py
builders/box_predictor_builder_test.py
builders/hyperparams_builder.py
builders/hyperparams_builder_test.py
builders/image_resizer_builder.py
builders/image_resizer_builder_test.py
builders/input_reader_builder.py
builders/input_reader_builder_test.py
builders/losses_builder.py
builders/losses_builder_test.py
builders/matcher_builder.py
builders/matcher_builder_test.py
builders/model_builder.py
builders/model_builder_test.py
builders/optimizer_builder.py
builders/optimizer_builder_test.py
builders/post_processing_builder.py
builders/post_processing_builder_test.py
builders/preprocessor_builder.py
builders/preprocessor_builder_test.py
builders/region_similarity_calculator_builder.py
builders/region_similarity_calculator_builder_test.py
core/__init__.py
core/anchor_generator.py
core/balanced_positive_negative_sampler.py
core/balanced_positive_negative_sampler_test.py
core/batcher.py
core/batcher_test.py
core/box_coder.py
core/box_coder_test.py
core/box_list.py
core/box_list_ops.py
core/box_list_ops_test.py
core/box_list_test.py
core/box_predictor.py
core/box_predictor_test.py
core/data_decoder.py
core/keypoint_ops.py
core/keypoint_ops_test.py
core/losses.py
core/losses_test.py
core/matcher.py
core/matcher_test.py
core/minibatch_sampler.py
core/minibatch_sampler_test.py
core/model.py
core/post_processing.py
core/post_processing_test.py
core/prefetcher.py
core/prefetcher_test.py
core/preprocessor.py
core/preprocessor_test.py
core/region_similarity_calculator.py
core/region_similarity_calculator_test.py
core/standard_fields.py
core/target_assigner.py
core/target_assigner_test.py
create_pascal_tf_record.py
create_pascal_tf_record_test.py
create_pet_tf_record.py
data_decoders/__init__.py
data_decoders/tf_example_decoder.py
data_decoders/tf_example_decoder_test.py
eval.py
eval_util.py
evaluator.py
export_inference_graph.py
exporter.py
exporter_test.py
matchers/__init__.py
matchers/argmax_matcher.py
matchers/argmax_matcher_test.py
matchers/bipartite_matcher.py
matchers/bipartite_matcher_test.py
meta_architectures/__init__.py
meta_architectures/faster_rcnn_meta_arch.py
meta_architectures/faster_rcnn_meta_arch_test.py
meta_architectures/faster_rcnn_meta_arch_test_lib.py
meta_architectures/rfcn_meta_arch.py
meta_architectures/rfcn_meta_arch_test.py
meta_architectures/ssd_meta_arch.py
meta_architectures/ssd_meta_arch_test.py
models/__init__.py
models/faster_rcnn_inception_resnet_v2_feature_extractor.py
models/faster_rcnn_inception_resnet_v2_feature_extractor_test.py
models/faster_rcnn_resnet_v1_feature_extractor.py
models/faster_rcnn_resnet_v1_feature_extractor_test.py
models/feature_map_generators.py
models/feature_map_generators_test.py
models/ssd_feature_extractor_test.py
models/ssd_inception_v2_feature_extractor.py
models/ssd_inception_v2_feature_extractor_test.py
models/ssd_mobilenet_v1_feature_extractor.py
models/ssd_mobilenet_v1_feature_extractor_test.py
protos/__init__.py
protos/anchor_generator_pb2.py
protos/argmax_matcher_pb2.py
protos/bipartite_matcher_pb2.py
protos/box_coder_pb2.py
protos/box_predictor_pb2.py
protos/eval_pb2.py
protos/faster_rcnn_box_coder_pb2.py
protos/faster_rcnn_pb2.py
protos/grid_anchor_generator_pb2.py
protos/hyperparams_pb2.py
protos/image_resizer_pb2.py
protos/input_reader_pb2.py
protos/losses_pb2.py
protos/matcher_pb2.py
protos/mean_stddev_box_coder_pb2.py
protos/model_pb2.py
protos/optimizer_pb2.py
protos/pipeline_pb2.py
protos/post_processing_pb2.py
protos/preprocessor_pb2.py
protos/region_similarity_calculator_pb2.py
protos/square_box_coder_pb2.py
protos/ssd_anchor_generator_pb2.py
protos/ssd_pb2.py
protos/string_int_label_map_pb2.py
protos/train_pb2.py
train.py
trainer.py
trainer_test.py
utils/__init__.py
utils/category_util.py
utils/category_util_test.py
utils/dataset_util.py
utils/dataset_util_test.py
utils/label_map_util.py
utils/label_map_util_test.py
utils/learning_schedules.py
utils/learning_schedules_test.py
utils/metrics.py
utils/metrics_test.py
utils/np_box_list.py
utils/np_box_list_ops.py
utils/np_box_list_ops_test.py
utils/np_box_list_test.py
utils/np_box_ops.py
utils/np_box_ops_test.py
utils/object_detection_evaluation.py
utils/object_detection_evaluation_test.py
utils/ops.py
utils/ops_test.py
utils/per_image_evaluation.py
utils/per_image_evaluation_test.py
utils/shape_utils.py
utils/shape_utils_test.py
utils/static_shape.py
utils/static_shape_test.py
utils/test_utils.py
utils/test_utils_test.py
utils/variables_helper.py
utils/variables_helper_test.py
utils/visualization_utils.py
utils/visualization_utils_test.py
